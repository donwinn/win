!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="//a.msstatic.com/huya/h5player/room/2509100944/",i(i.s="xUJ5")}({bfxC:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(t,e,i,s,r){var a=e.split("\n"),o=Math.max(s-3,0),n=Math.min(a.length,s+3),h=r(i),d=a.slice(o,n).map((function(t,e){var i=e+o+1;return(i==s?" >> ":"    ")+i+"| "+t})).join("\n");throw t.path=h,t.message=(h||"ejs")+":"+s+"\n"+d+"\n\n"+t.message,t},escapeFn=escapeFn||function(t){return null==t?"":String(t).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(t){return _ENCODE_HTML_RULES[t]||t}var __line=1,__lines='<div class="player-wrap" id="player-wrap">\n    <div class="player-video" id="player-video">\n        <div id="hy-watermark" class="hy-watermark-normal"></div>\n        <div id="player-watermark"></div>\n        <div id="player-ext-wrap-under-barrage"></div>\n        <div id="player-mouse-event-wrap"></div>\n        <div id="danmuwrap">\n            <div id="danmudiv"></div>\n            <div id="danmudiv2"></div>\n        </div>\n    </div>\n    <div class="player-loading" id="player-loading">\n        <div class="player-loading-content">\n            <div class="player-loading-logo"></div>\n            <div id="player-loading-text">正在加载</div>\n            <div id="player-loading-progress" alt="进度条"></div>\n            <div class="player-loading-changeline">\n                <p>目前网络有点卡，试试下面的方法吧</p>\n                <p>推荐去PC端观看，占用更少CPU、更流畅</p>\n                <div class="change-line-g">\n                    <div  id="change-line-btn">切换线路</div>\n                    <div  id="download-pc-btn">去PC端看<i></i></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="pre-ab-video"></div>',__filename="vsrc/vplayer.ejs";try{var __output="";function __append(t){null!=t&&(__output+=t)}with(locals||{})__append('<div class="player-wrap" id="player-wrap">\n    <div class="player-video" id="player-video">\n        <div id="hy-watermark" class="hy-watermark-normal"></div>\n        <div id="player-watermark"></div>\n        <div id="player-ext-wrap-under-barrage"></div>\n        <div id="player-mouse-event-wrap"></div>\n        <div id="danmuwrap">\n            <div id="danmudiv"></div>\n            <div id="danmudiv2"></div>\n        </div>\n    </div>\n    <div class="player-loading" id="player-loading">\n        <div class="player-loading-content">\n            <div class="player-loading-logo"></div>\n            <div id="player-loading-text">正在加载</div>\n            <div id="player-loading-progress" alt="进度条"></div>\n            <div class="player-loading-changeline">\n                <p>目前网络有点卡，试试下面的方法吧</p>\n                <p>推荐去PC端观看，占用更少CPU、更流畅</p>\n                <div class="change-line-g">\n                    <div  id="change-line-btn">切换线路</div>\n                    <div  id="download-pc-btn">去PC端看<i></i></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="pre-ab-video"></div>'),__line=28;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},f08Q:function(t,i,s){!function(e,i){t.exports=i()}(0,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=27)}([function(t,e,i){"use strict";var s=i(8),r=i(4),a=i(2),o=99;function n(){return r.a.getDateTimeStr()+" "}var h=!1,d=!0;let l={_data:[],_data2:[],_length:0,debug:function(){var t=n(),e=Array.apply(null,arguments);e[0]=t+e[0],o<=-1&&console.log.apply(console,e)},log:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=0&&console.log.apply(console,i),l.record(i,"log")},info:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=1&&console.info.apply(console,i),l.record(i,"info")},warn:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=2&&console.warn.apply(console,i),l.record(i,"warn")},error:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=3&&console.error.apply(console,i),l.record(i,"error")},group:function(t){var e=n(),i=Array.apply(null,arguments);if(i[0]=e+i[0],o<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}l.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=o&&(console.log(n()+" set log level from "+o+" to "+t),o=t)},getLevel:function(){return o},record:function(t,e){if(!d)return;const i=a.a.logMaxLen||1e3;l._length===i+100&&(l._data.splice(0,100),l._data2.splice(0,100),l._length=i);var s=0,r=(t.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(t,e){return s++,""}));s--&&t.length;)t.shift();for(var o=0,n=t.length;o<n;o++)"object"==typeof t[o]&&(t[o]="");t.unshift(r);var h=t.join(" ");l._length++,l._data.push("[".concat(e,"]").concat(h)),l._data2.push("[".concat(e,"]").concat(h))},getLog:function(){return h||(h=!0,l._data.unshift(s.a.platform+" "+s.a.name+" "+s.a.version.string)),l._data},getNewLog:function(){h||(h=!0,l._data2.unshift(s.a.platform+" "+s.a.name+" "+s.a.version.string));const t=[...l._data2];return l._data2.length=0,t},logcss:function(t,e,i){let s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s},padNum:function(t,e){let i=t.toString().length,s=Math.max(0,e-i);return"0".repeat(s)+t},setLogFlag:function(t){d=t},loggerCallback:function(){let t=Array.apply(null,arguments);l.log("HYCodec.setLogCallback",t.join(" "))}};e.a=l},function(t,e,i){"use strict";e.a={KEY_VALUE:"value",KEY_STR:"str",KEY_DIM:"dim",K:"k",LIVE_TYPE:{FLV:0,P2P:1,HLS:2},HEART_TYPE:{START:0,CONTINUS:1,END:2},DIM_COM:{SDK_VER:"sdk_ver",P2P:"p2p",AD_BLOCK:"ad_block",STAT_BW_FLAG:"stat_bw_flag",OEXP:"oexp",MPS_CROSS:"mps_cross",STREAM_URL:"stream_url",STREAM_302_URL:"stream_302_url",CDNDOMAIN:"cdndomain",USER_UUID:"user_uuid",STREAM:"stream",CDNP_CONNECT_IP:"cdnp_connect_ip",CDNP_CONNECTED:"cdnp_connected",CDP_ID:"cdp_id",USER_WAN_IP:"user_wan_ip",VIDEO_LOGIN_FAIL:"video_login_fail",ORIGINAL_BITRATE:"original_bitrate",BROWSER_NAME:"browser_name",BROWSER_VERSION:"browser_version",BROWSER_KERNEL:"browser_kernel",BROWSER_KERNEL_VERSION:"browser_kernel_version",OS_NAME:"os_name",OS_VERSION:"os_version",RENDER_INFO:"render_info",SPHD_TYPE:"sphd_type",DPI:"dpi",CDNIP:"cdnip",AUTO_BITRATE:"auto_bitrate",P2P_COOL_FLAG:"p2p_cool_flag",MP_EXPERIMENT:"mp_experiment",ACT_LOAD_TYPE:"act_load_type",STREAM_INDEX:"stream_index",OBS_RENDER_MODE:"obs_render_mode",PLAYER_TYPE:"player_type",LIVE_TYPE:"live_type",STREAM_TYPE:"stream_type",HLS_TYPE:"hls_type",VR_ENABLE:"vr_enable",VR_MODE:"vr_mode",CODEC_TYPE:"codec_type",SUPPORT_AV1:"support_av1",CDN_CIP:"cdn_cip",CDN_SIP:"cdn_sip",ALT_SVC:"alt_svc",QUIC:"quic",START_TYPE:"start_type",PCDN_ORIGIN:"pcdn_origin",EXPECT_PCDN_NAME:"expect_pcdn_name",CLI_ISP:"cli_isp",CLI_PROV:"cli_prov",SUB_PCDN_STATE:"sub_pcdn_state",STREAM_TOTAL_DURATION:"stream_total_duration",CODERATE_BPS:"coderatebps",LINE:"line",CODERATE:"coderate",VOD_CODERATE:"vod_coderate",PLAYBACK_RATE:"playbackrate",ANCHOR_UID:"anchoruid",FLV_PCDN_STATE:"flv_pcdn_state",H265:"h265",V_DECODEC:"v_decodec",V_RECV_FRAME:"v_recv_frames",V_TO_DECODE_FRAMES:"v_to_decode_frames",V_DECODE_FRAME:"v_decode_frames",V_PLAY_FRAME:"v_play_frame",V_TO_PLAY_FRAME:"v_to_play_frames",AV_DELTA:"av_delta",A_RENDER_SILENCE_TIME:"a_render_silence_time",SIGNAL_RTT:"signal_rtt",SIGNAL_RTT_MAX:"signal_rtt_max",CDNP_RTT:"cdnp_rtt",CDNP_RTT_MAX:"cdnp_rtt_max",SUB_CHANGE_STATE:"sub_change_state",FORCE_SUB_TYPE:"force_sub_type",USE_PCDN:"use_pcdn",MUTE_DATA:"mute_data",VISIBILITY_STATE:"visibility_state",SESSION_ID:"session_id",VIDEO_MIN_BUF:"video_min_buf",AUTO_VERSION:"auto_version",MSE_PLAYER:"mse_player",DECODE_HARDWARE_ACCELERATION:"decode_hardware_acceleration",HARDWARE_CONCURRENCY:"hardware_concurrency",START_CODERATEBPS:"start_coderatebps",DEFAULT_BITRATEBPS:"default_bitratebps",MEMORY_BITRATEBPS:"memory_bitratebps",RECOMMEND_BITRATEBPS:"recommend_bitratebps",AUTO_USER_TAGS:"auto_user_tags",AUTO_OPEN:"auto_open",V_RECV_FRAMES:"v_recv_frames",H265_SUPPORT_REASON:"h265_support_reason",PLACE:"place",PULLSTREAM_REASOM:"pullstream_reason",VIDEO_PAUSE_BUFFERS:"video_pause_buffers",VIDEO_PAUSE_CONTINUE_BUFFERS:"video_pause_continue_buffers",HARDDECODE:"harddecode",DECODE_SUPPORT:"deocode_support",IS_TIE_STREAM:"is_tie_stream",IS_REDIRECT:"is_redirect",CLOSE_EXTSTREAM:"close_extstream",MOSAIC_DATA:"mosaic_data",PCDN_IAAS:"pcdn_iaas",P2P_TO_FLV_DOMAIN:"p2p_to_flv_domain",DECODE_CAPABILITY:"decode_capability",WEBCODECS_BACK_REASON:"webcodecs_back_reason",STREAM_FORMAT:"stream_format",A_CFG:"a_cfg",IS_MUTE:"is_mute",IS_MOSAIC:"is_mosaic",I_GPU:"i_gpu",P_IAAS_INFO:"p_iaas_info",UA:"ua",IAAS_BW_INFO:"iaas_bw_info",IS_PAID_ROOM:"is_paid_room",SUB_STATA_INFO:"sub_state_info",PSUB_PROXY_INFO:"psub_proxy_info",I_AVC_CHANGE:"i_avc_change",FEATURE_STATUS:"features_status",V_ENHANCE_TYPE:"v_enhance_type",V_ENHANCE_ENTRY:"v_enhance_entry",ENHANCE_BACK_REASON:"enhance_back_reason",FRAMERATE:"framerate",GAMEID:"gameid",NAT:"nat",NAT_SYNC:"nat_sync",MPS_STATUS:"mps_status",IP_STACK_TYPE:"ip_stack_type",TEAM_PORT:"team_port"},DIM_CORE:{V_BAD_FRONT:"v_bad_front",REPROT_TIME:"reprot_time",BATCH_ID:"batch_id",REPORT_TYPE:"report_type",CREATE_TIME:"create_time",VIDEO_BAD_QUALITY_OLD:"video_bad_quality_old",VIDEO_BAD_QUALITY:"video_bad_quality",VIDEO_BAD_REASON:"video_bad_reason",USER_PROPERTY:"user_property",HEART_TYPE:"heart_type",SIGNAL_USER_PROPERTY:"signal_user_property",F_BUF:"f_buf",VTDAVG:"vtdavg",VTDMAX:"vtdmax",ATDAVG:"atdavg",ATDMAX:"atdmax",VRTADE:"vrtade",VRTADEMAX:"vrtademax",VATRDE:"vatrde",VATRDEMAX:"vatrdemax",ARTADE:"artade",ARTADEMAX:"artademax",AATRDE:"aatrde",AATRDEMAX:"aatrdemax",VRDFPS:"vrdfps",VRCFPS:"vrcfps",VDF:"vdf",PFPS:"pfps",PFPSMAX:"pfpsmax",PFPSMIN:"pfpsmin",VRBQ:"vrbq",VRBQC:"vrbqc",VRBQD:"vrbqd",AVSDA:"avsda",AVSDM:"avsdm",AVEFS:"avefs",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality",AUTO_U_REASON:"auto_u_reason",AUTO_D_REASON:"auto_down_reason",AUTO_HEART_TYPE:"auto_heart_type",AUTO_CODEC_CHANGE_TYPE:"auto_codec_change_type",AUTO_BAD_REASON:"auto_bad_reason",AUTO_BAD_MIN_REASON:"auto_bad_min_reason",DISPATCH_ID:"dispatch_id",PCDN_SVR_ISP:"pcdn_svr_isp",PCDN_SVR_AREA:"pcdn_svr_area",UNOPEND_CPFLV_BW:"unopend_cpflv_bw",NORETURN_CPFLV_BW:"noreturn_cpflv_bw",UNSUPPORT_CPFLV_BW:"unsupport_cpflv_bw",LOAD_LIB_CPFLV_BW:"load_lib_cpflv_bw",GATHER_CPFLV_BW:"gather_cpflv_bw",GATHER_FAIL_CPFLV_BW:"gather_fail_cpflv_bw",LOAD_SUC_CPFLV_BW:"load_suc_cpflv_bw",ERROR_CPFLV_BW:"error_cpflv_bw",KICK_CPFLV_BW:"kick_cpflv_bw",WAIT_CDN_LOAD_CPFLV_BW:"wait_cdn_load_cpflv_bw",DTS_ERROR_CPFLV_BW:"dts_error_cpflv_bw",OTHER_CPFLV_BW:"other_cpflv_bw",ENHANCE_TOTAL:"enhance_total",ENHACNE_LESS_30:"enhance_less_30",ENHACNE_LESS_150:"enhance_less_150",ENHACNE_LESS_200:"enhance_less_200",ENHACNE_LARGE_200:"enhance_large_200"},PCDN_DATA:{GET_PCDN_URL_TOTAL_CNT:"get_pcdn_url_total_cnt",GET_PCDN_URL_SUCCESS:"get_pcdn_url_success",GET_PCDN_URL_SUC_FREETIME:"get_pcdn_url_suc_freetime",GET_PCDN_ERR_NOT_REACHED:"get_pcdn_err_not_reached",GET_PCDN_ERR_OVER_RUN:"get_pcdn_err_over_run",GET_PCDN_ERR_OVER_RUN_FREETIME:"get_pcdn_err_over_run_freetime",GET_PCDN_ERR_NOT_COVERD:"get_pcdn_err_not_coverd",GET_PCDN_ERR_OTHER:"get_pcdn_err_other",GET_PCDN_ERROR_REQ:"get_pcdn_err_req",GET_SUBS_URL_ERROR_CNT:"get_subs_url_error_cnt",GET_PCDN_DATA_TIME:"get_pcdn_data_time",GET_PCDN_DATA_TIME_CNT:"get_pcdn_data_time_cnt",GET_PCDN_SUBS_URL_TIME:"get_pcdn_subs_url_time",GET_PCDN_SUBS_URL_TIME_CNT:"get_pcdn_subs_url_time_cnt",GET_CDN_DATA_TIME:"get_cdn_data_time",GET_CDN_DATA_TIME_CNT:"get_cdn_data_time_cnt",PCDN_REPEAT_BW:"pcdn_repeat_bw",USE_PCDN:"use_pcdn"},DIM_LINK_STA:{name:"link_sta",CONNECT_SUC:"cns",HAS_DATA:"hd",DATA_ENOUGH:"de",AUDIO_CONFIG:"acf",VIDEO_CONFIG:"vcf",VIDEO_IFRAME:"vif",VIDEO_FRAME:"vf",AUDIO_FRAME:"af",NO_SLICE_DATA:"nsd",H265:"h265"},DIM_LINK_SAM:{name:"link_sam",AUDIO_DTS:"ad",VIDEO_DTS:"vd",AUDIO_RATE:"ar",VIDEO_RATE:"vr",AUDIO_WAIT_PUSH:"awp",VIDEO_WAIT_PUSH:"vwp",AUDIO_WAIT_REASON:"awr",VIDEO_WAIT_REASON:"vwr",AUDIO_WAIT_GAP:"awg",VIDEO_WAIT_GAP:"vwg",VIDEO_DROP_FRAMES:"vdf",VIDEO_AUDIO_GAP:"vag",VIDEO_BUFFER_EMPTY_TIME:"vbet",VIDEO_BUFFER_EMPTY_COUNT:"vbec",SPEED:"sp"},DIM_H265_SAM:{name:"h265_sam",decode_fps:"decode_fps",render_fps:"render_fps",frame_list_len:"frame_list_len"},DIM_EXT:{CDN_IP:"cdn_ip"},CORE:{name:"yspwl.web.live.user.heart20",PUNCHED_UUIDS:"punched_uuids",MPS_SUBS:"mps_subs",MPS_SRC:"mps_src",MPS_UP:"mps_up",MPS_SRC_BW:"mps_src_bw",MPS_UP_BW:"mps_up_bw",HTD:"htd",AUDIO_CNT:"audio_cnt",BIG_AUDIO_CNT:"big_audio_cnt",A_VOL:"a_vol",A_E_DUR:"a_e_dur",A_E_CNT:"a_e_cnt",V_CAPTURE_JITTERS:"v_capture_jitters",V_CAPTURE_JITTER_MAX:"v_capture_jitter_max",V_CTS_MAX:"v_cts_max",A_CAPTURE_JITTERS:"a_capture_jitters",A_CAPTURE_JITTER_MAX:"a_capture_jitter_max",STAT_BW:"stat_bw",CDN_TOTAL_BW:"cdn_total_bw",CDN_VALID_BW:"cdn_valid_bw",CDN_REPEAT_BW:"cdn_repeat_bw",P2P_TOTAL_BW:"p2p_total_bw",P2P_REPEAT_BW:"p2p_repeat_bw",P2P_VALID_BW:"p2p_valid_bw",RANGE_TOTAL_BW:"range_total_bw",RANGE_VALID_BW:"range_valid_bw",PEER_RANGE_TOTAL_BW:"peer_range_total_bw",PEER_RANGE_VALID_BW:"peer_range_valid_bw",PEER_RANGE_REPEAT_BW:"peer_range_repeat_bw",DEFAULT_BW:"default_bw",FAST_BW:"fast_bw",PATCH_BW:"patch_bw",COMPETE_BW:"compete_bw",FIXED_BW:"fixed_bw",FORCE_BW:"force_bw",SIGNAL_UP_BW:"signal_up_bw",SIGNAL_DOWN_BW:"signal_down_bw",ENC_FLOW:"enc_flow",DEC_FLOW:"dec_flow",DEC_OK_CNT:"dec_ok_cnt",DEC_FAIL_CNT:"dec_fail_cnt",BUFFER_LENGTH:"buffer_length",PLAY_DELAY:"play_delay",DELAY_ANCHOR:"delay_anchor",DELAY_SERVER:"delay_server",DELAY_NET:"delay_net",SVR_DELAY_INFOS:"svr_delay_infos",DELAY_NODE_INFO:"delay_node_info",SVR_LAST_P_DELAY:"svr_last_p_delay",UPLOADER_TYPE:"uploader_type",ENCODER_SOURCE:"encoder_source",OBS_FPS:"obs_fps",OBS_UPLOAD_TS:"obs_upload_ts",VIDEO_BLOCK_COUNT:"video_block_count",VIDEO_BLOCK_DURATION:"video_block_duration",VIDEO_BAD_BUFFER:"video_bad_buffer",VIDEO_CONTINUE_BUFFER:"video_continue_buffer",PRTTCNT:"prttcnt",PRSUCNT:"prsucnt",PRNNCnt:"prnncnt",PRTOCNT:"prtocnt",PRFTCNT:"prftcnt",PRFSCNT:"prfscnt",PRNPID:"prnpid",PRNSDK:"prnsdk",PRNPUB:"prnpub",PRNSUB:"prnsub",PRNPEER:"prnpeer",PRNSTREAM:"prnstream",PRNLATE:"prnlate",PRNRTT:"prnrtt",PRNNONE:"prnnone",AUTO_SWITCH_CNT:"auto_switch_cnt",AUTO_SWITCH_SAME_CNT:"auto_switch_same_cnt",AUTO_BAD_QUALITY:"auto_bad_quality",AUTO_BAD_QUALITY_UP:"auto_bad_quality_up",AUTO_BAD_DURATION:"auto_bad_duration",AUTO_BAD_DURATION_UP:"auto_bad_duration_up",AUTO_BAD_SWITCH:"auto_bad_switch",AUTO_BAD_SWITCH_SAME:"auto_bad_switch_same",AUTO_BAD_SWITCH_UP:"auto_bad_switch_up",AUTO_BAD_DONE:"auto_bad_done",AUTO_BAD_BUFFER:"auto_bad_buffer",AUTO_CONTINUE_BUFFER:"auto_continue_buffer",PCDN_TOTAL_BW:"pcdn_total_bw",PCDN_FREETIME_BW:"pcdn_freetime_bw",PCDN_REALTIME_BW:"pcdn_realtime_bw",SWITCH_CDN_CNT:"switch_cdn_cnt",GET_STREAM_CNT:"get_stream_cnt",GET_STREAM_ERROR_CNT:"get_stream_error_cnt",GET_STREAM_LINK_ERROR_CNT:"get_stream_link_error_cnt",GET_STREAM_LINK_TIMEOUT_CNT:"get_stream_link_timeout_cnt",GET_STREAM_LOW_DATA_CNT:"get_stream_low_data_cnt",REAL_KBPS_SAMPLE:"real_kbps_sample",REAL_FLAC_KBPS_SAMPLE:"real_flac_kbps_sample",RECV_TOTAL_SAMPLE:"recv_total_sample",RECV_LAN_SAMPLE:"recv_lan_sample",HAS_PUNCH_NODES:"has_punch_nodes",HAS_PUNCH_NODES_SDKV2:"has_punch_nodes_sdkv2",HAS_PUNCH_NODES_WEBV2:"has_punch_nodes_webv2",HAS_PUNCH_NODES_MEDIA:"has_punch_nodes_media",HAS_PUNCH_NODES_SIGNAL:"has_punch_nodes_signal",FORWARD_REJECT_CNT:"forward_reject_cnt",FRAME_BUFFER_DELAY:"frame_buffer_delay",STREAM_BUFFERED:"stream_buffered",RANGE_SIP_SUC_CNT:"range_sip_suc_cnt",RANGE_SIP_DIF_CNT:"range_sip_dif_cnt",RANGE_REQ_CNT:"range_req_cnt",RANGE_RSP_CNT:"range_rsp_cnt",RANGE_CONNECT_TIME:"range_connect_time",RANGE_RSP_TIME:"range_rsp_time",VISIBILITY_HIDDEN_TIME:"visibility_hidden_time",VIDEO_PERFPAUSE_CONTINUE_CNT:"video_perfpause_continue_cnt",VIDEO_PERFPAUSE_CNT:"video_perfpause_cnt",FULL_CDN_CNT:"full_cdn_cnt",SUB_CDN_CNT:"sub_cdn_cnt",PATCH_CDN_CNT:"patch_cdn_cnt",MOSAIC_DURATION:"mosaic_duration",MOSAIC_COUNT:"mosaic_count",MUTE_DURATION:"mute_duration",MUTE_COUNT:"mute_count",USED_XP2P:"used_xp2p"},VIDEO_LINK:{PVSSC:"pvssc",PVFSC:"pvfsc",PVLSC:"pvlsc",PVLFC:"pvlfc",PVPFC:"pvpfc",PVPTC:"pvptc",PVPAFC:"pvpafc",PVRFC:"pvrfc"},UPDOWN_INFO:{name:"updown_info",UPLINK_BW:"uplink_bw",DOWNLINK_BW:"downlink_bw",UPLINK_CNT:"uplink_cnt",UPLINK_LIMIT_CNT:"uplink_limit_cnt"},SIGNAL_HEART20:{name:"yspwl.web.live.signal.heart20",STREAM_NAME:"stream_name",STREAM_DELAY:"stream_delay",FULL_FRAME_NUM:"full_frame_num",LOST_FRAME_NUM:"lost_frame_num",P2P_FLOW_DANMU:"p2p_flow_danmu",P2P_FLOW_EMPTY:"p2p_flow_empty",RESEND_TOTAL_CNT:"resend_total_cnt",RESEND_TIMEOUT_CNT:"resend_timeout_cnt",RESEND_ERROR_CNT:"resend_error_cnt",MIN_DELAY:"min_delay",MAX_DELAY:"max_delay",AVE_DELAY:"ave_delay",SER_2_REC_DELAY:"ser_2_rec_delay",REC_2_MERGE_DELAY:"rec_2_merge_delay",MERGE_2_NOTIFY_DELAY:"merge_2_notify_delay",CDN_FLOW_DANMU_VALID:"cdn_flow_danmu_valid",CDN_FLOW_DANMU_TOTAL:"cdn_flow_danmu_total",CDN_FLOW_EMPTY_VALID:"cdn_flow_empty_valid",CDN_FLOW_EMPTY_TOTAL:"cdn_flow_empty_total"},HLS_INFO:{name:"hls_info",M3U8_CNT:"m3u8_cnt",M3U8_SUC_CNT:"m3u8_suc_cnt",M3U8_FAIL_CNT:"m3u8_fail_cnt",M3U8_EMPTY_CNT:"m3u8_empty_cnt",M3U8_WRONG_CNT:"m3u8_wrong_cnt",M3U8_TIMEOUT_CNT:"m3u8_timeout_cnt",TS_CNT:"ts_cnt",TS_SUC_CNT:"ts_suc_cnt",TS_FAIL_CNT:"ts_fail_cnt",TS_TIMEOUT_CNT:"ts_timeout_cnt",TS_OPEN_AVG:"ts_open_avg",TS_LOADED_AVG:"ts_loaded_avg",TS_SPEED_AVG:"ts_speed_avg",TS_SIZE_AVG:"ts_size_avg"},FRAME_INFO:{name:"frame_info",LATE_SEQS:"late_seqs",LOSS_FRAMES:"loss_frames",PLAY_FRAMES:"play_frames",DTS_JUMPPAUSE_CNT:"dts_jumppause_cnt",SKIP_PAUSE_CNT:"skip_pause_cnt",EMPTY_FRAMES:"empty_frames",FULL_RATIO:"full_ratio"},SUB_INFO:{name:"sub_info",TOTAL_CNT:"total_cnt",SUCC_CNT:"succ_cnt",FAIL_CNT:"fail_cnt",TIMEOUT_CNT:"timeout_cnt",KICK_CNT:"kick_cnt",TRY_CNT:"try_cnt",CMP_TOTAL_CNT:"cmp_total_cnt",CMP_SUCC_CNT:"cmp_succ_cnt",CMP_FAIL_CNT:"cmp_fail_cnt",CMP_TIMEOUT_CNT:"cmp_timeout_cnt",FORCE_CNT:"force_cnt"},PUNCH_INFO:{name:"punch_info",TOTAL_CNT:"total_cnt",VALID_CNT:"valid_cnt",TRY_CNT:"try_cnt",SUCC_CNT:"succ_cnt",BACK_CNT:"back_cnt",BACK_SUCC_CNT:"back_succ_cnt",BACK_TRY_CNT:"back_try_cnt"},PUNCH_BACK_RET:{name:"punch_back_ret"},RESEND_INFO:{name:"resend_info",RESEND_CNT:"resend_cnt",TIMEOUT_CNT:"timeout_cnt",ERROR_CNT:"error_cnt",SLICE_CNT:"slice_cnt",RESPOND_CNT:"respond_cnt",LATE_CNT:"late_cnt",MISS_CNT:"miss_cnt",REPEAT_CNT:"repeat_cnt",REPEAT_SUCC_CNT:"repeat_succ_cnt",REPEAT_FAIL_CNT:"repeat_fail_cnt",LIMIT_CNT:"limit_cnt"},SUBSTREAM_INFO:{name:"substream_info",FIXED_CNT:"fixed_cnt",FORCE_CNT:"force_cnt",COMPETE_CNT:"compete_cnt"},FORCESUB_REASON:{name:"forcesub_reason",NOPEER_CNT:"nopeer_cnt",SUBEND_CNT:"subend_cnt",TIMEOUT_CNT:"timeout_cnt"},SUB_RETURN:{sub_name:"sub_return",switch_name:"switch_return",last_name:"last_return"},NONODE_RETURN:{name:"nonode_return",PRESENTER_CNT:"presenter_cnt",UPLINK_LESS_CNT:"uplink_less_cnt",PULL_SAME_CNT:"pull_same_cnt",SUBED_CNT:"subed_cnt",COOL_CNT:"cool_cnt",DELAY_CNT:"delay_cnt",RTT_CNT:"rtt_cnt",LATE_CNT:"late_cnt",FAST_CNT:"fast_cnt",NONE_CNT:"none_cnt"},AUTO_INFO:{name:"auto_info",UP_CNT:"up_cnt",DOWN_CNT:"down_cnt",BACK_CNT:"back_cnt"},P2P_TCP_TYPE:{name:"p2p_tcp_type"},P2P_TCP_STATE:{name:"p2p_tcp_state"},PCDN_BW_DATA:{name:"pcdn_bw_data"},AI_CONTROL_DATA:{name:"ai_control_data",AI_P2P_CNT:"ai_p2p_cnt",AI_FLV_CNT:"ai_flv_cnt",AI_P2P_TIMEOUT_CNT:"ai_p2p_timeout_cnt",AI_FLV_TIMEOUT_CNT:"ai_flv_timeout_cnt",AI_P2P_ERROR_CNT:"ai_p2p_error_cnt",AI_FLV_ERROR_CNT:"ai_flv_error_cnt",AI_P2P_SWITCH_CNT:"ai_p2p_switch_cnt",AI_FLV_SWITCH_CNT:"ai_flv_switch_cnt",AI_P2P_NOT_SWITCH_CNT:"ai_p2p_not_switch_cnt",AI_FLV_NOT_SWITCH_CNT:"ai_flv_not_switch_cnt",AI_FLV_ERROR_SWITCH_CNT:"ai_flv_error_switch_cnt",AI_FLV_ERROR_NOT_SWITCH_CNT:"ai_flv_error_not_switch_cnt：flv",AI_START_P2P_CNT:"ai_start_p2p_cnt",AI_START_FLV_CNT:"ai_start_flv_cnt"},ACT:{name:"yspwl.web.live.user.act",field:"act_type",SWITCH_BITRATE:"switch_bitrate",SWITCH_AUTO:"switch_auto",SWITCH_LINE:"switch_line",SWITCH_PTS:"switch_pts",FAST_SAMPLE:"fast_sample",NO_PICTURE:"no_picture",NO_PICTURE_ALL:"no_picture_all",NO_PICTURE_P2P:"no_picture_p2p",LINK_STA:"link_sta",HLS_PLAY_SUCC:"hls_play_succ",HLS_LOAD_SUCC:"hls_load_succ",P2P_PLAY_FAIL:"p2p_play_fail",P2P_LOAD_VIDEO:"p2p_load_video",P2P_RESTART:"p2p_restart",TCP_NO_SLICE:"tcp_no_slice",TCP_OPEN_TIME:"tcp_open_time",HTTP_CODE_:"http_code_",HTTP_CLOSE:"http_close",TCP_TIMEOUT:"tcp_timeout",P2P_COOLING:"p2p_cooling",CONNECT_VIDEO_TS:"connect_video_ts",RECV_VIDEO_TS:"recv_video_ts",FIRST_VIDEO_PKG_TS:"first_video_pkg_ts",FIRST_VIDEO_IFRAME_TS:"first_video_iframe_ts",VIDEO_IFRAME_TS:"video_iframe_ts",FIRST_VIDEO_RENDER_TS:"first_video_render_ts",VIDEO_PLAYED_TS:"video_played_ts",VIDEO_LOAD_TS:"video_load_ts",VIDEO_LOAD_SEG:"video_load_seg",VIDEO_LOAD_TS_ALL:"video_load_ts_all",VIDEO_LOAD_TS_V2:"video_load_ts_v2",AUTO_TEST_RESULT:"auto_test_result",VIDEO_GET_VP_TS:"video_get_vp_ts",VIDEO_LOGIN_TS:"video_login_ts",LOAD_M3U8_TS:"load_m3u8_ts",FIRST_FRAG_LOAD_TS:"first_frag_load_ts",FIRST_FRAG_LOADED_TS:"first_frag_loaded_ts",FIRST_FRAG_SIZE:"first_frag_size",SIGNAL_TURN_BACK:"signal_turn_back",SWITCH_COST:"switch_cost",OB_BG_DURATION:"ob_bg_duration",LOAD_P2PLIB_ERROR:"load_p2plib_error",LOAD_PCDNLIB_ERROR:"load_pcdnlib_error",PCDN_TO_CDN:"pcdn_to_cdn",MUTE_STATUS:"mute_status",NO_PICTURE2:"no_picture2",H265_WORKER_LOAD_TS:"h265_worker_load_ts",H265_STATUS:"h265_status",MOSAIC_STATUS:"mosaic_status",AI_P2P_FLV_SWITCH:"ai_p2p_flv_switch",BLOCK_BAD:"block_bad",SWITCH_AUDIO_RES:"switch_audio_res"},VOD_ACT:{name:"yspwl.web.vod.user.act"},VOD_CORE:{name:"yspwl.web.vod.user.heart20",AV1_SVR:"av1_svr",AV1_SPT:"av1_spt",AV1_USE:"av1_use",VOD_BAD_QUALITY:"vod_bad_quality",VOD_BAD_REASON:"vod_bad_reason",VOD_NO_PICTURE:"vod_no_picture",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",VOD_DTS_JUMP:"vod_dts_jump",V_BAD_FRONT:"v_bad_front",VOD_BLOCK_COUNT:"vod_block_count",VOD_BLOCK_DURATION:"vod_block_duration",M3U8_FILE_BW:"m3u8_file_bw",TS_PLAY_TIME:"ts_play_time",TS_SIZE:"ts_size",VOD_PCDN_STATE:"vod_pcdn_state",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality"},VOD_DIM_CORE:{TS_START_TIME:"ts_start_time",TS_END_TIME:"ts_end_time",ENHANCE_TOTAL:"enhance_total",ENHACNE_LESS_30:"enhance_less_30",ENHACNE_LESS_150:"enhance_less_150",ENHACNE_LESS_200:"enhance_less_200",ENHACNE_LARGE_200:"enhance_large_200"},VOD_DIM_COM:{VOD_VIDEOSOURCEID:"vod_videosourceid",VOD_CODERATE:"vod_coderate",VODANCHORID:"vodanchorid",STREAMTYPE:"streamtype",RESOURCE_TYPE:"resource_type",HAS_302:"has_302",VOD_FIRST_TS:"vod_first_ts",SGUID:"sguid",M3U8_FILE_BW:"m3u8_file_bw",VOD_AB_SWITCH:"vod_ab_switch",CREATE_TIME:"create_time",VOD_PLACE:"vod_place",VOD_MP4_SIZE:"vod_mp4_size",VOD_DURATION:"vod_duration",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",LINE:"line",BACKUP_FIELD1:"backup_field1",BACKUP_FIELD2:"backup_field2",BACKUP_FIELD3:"backup_field3",BACKUP_FIELD4:"backup_field4",BACKUP_FIELD5:"backup_field5",BACKUP_FIELD6:"backup_field6",RENDER_INFO:"render_info",HARDWARE_CONCURRENCY:"hardware_concurrency",MSE_PLAYER:"mse_player",DECODE_HARDWARE_ACCELERATION:"decode_hard_acc",HARDDECODE:"harddecode",DECODE_SUPPORT:"deocode_support",DECODE_CAPABILITY:"decode_capability",WEBCODECS_BACK_REASON:"webcodecs_back_reason",I_GPU:"i_gpu",FEATURE_STATUS:"features_status",V_ENHANCE_TYPE:"v_enhance_type",V_ENHANCE_ENTRY:"v_enhance_entry",ENHANCE_BACK_REASON:"enhance_back_reason",FRAMERATE:"framerate",GAMEID:"gameid",PULLSTREAM_REASOM:"pullstream_reason",IS_MEMORY_GEAR:"is_memory_gear"},VOD_EXT_COM:{VID:"vid",CLIENT:"client",PID:"pid",BITRATE:"bitrate",DEFINITION:"definition",SCENE:"scene"},ROOM_HEART60:{name:"yspwl.sdk.liveroom.user.heart",DURATION:"duration",SESSION_ID:"session_id",ANCHORUID:"anchoruid",LINE:"line",CODERATE:"coderate",H265:"h265",P2P:"p2p",BLIVE:"blive",BUSI_PLAY:"busi_play",BUSI_STOP:"busi_stop",RNR_CNT:"rnr_cnt",RNR_DUR:"rnr_dur",RNR_DUR_MAX:"rnr_dur_max",SNR_INFOS:"snr_infos"}}},function(t,e,i){"use strict";var s=i(6),r=i(0),a=i(5),o=i(8);let n=new class{constructor(){this.audioCtx=1,this.pushGop=!1,this.jitBufLen=3e3,this.jitMaxBufLen=4e3,this.jitMinBufLen=2e3,this.resendPlayThreshold=1500,this.mutilLinkConfig=[[0,4e3],[8,4]],this.resendModeConfig=[[0,2e3],[1,2]],this.resendMode=1,this.resendWaitLimitList={500:2500,2e3:2500,4e3:2500,8e3:2500,1e4:2500,12e3:2500,2e4:2500},this.sliceListLengthMaxList={500:1e3,2e3:25e3,8e3:1e4,1e4:12500,2e4:25e3},this.noUrgentResentBuffer=2e3,this.latency=[[3e3,2e3,4e3,2e3],[1e3,500,1500,1e3]],this.jitTest=[2e3,5e3,1500],this.jitPid=[],this.hlsJitCfg=[6e3,4e3,8e3],this.hlsUseFetch=100,this.obsUseFull=0,this.obsFullRatio=1,this.obsBgRatio=0,this.obsFaceRatio=0,this.obsSrAudio=1,this.obsFrame=0,this.obsSyncTs=50,this.obsSeekTs=200,this.obsSeekJumpTs=0,this.obsRateTs=10,this.p2pQuicktime=5e3,this.baseSubs=10,this.urgentResend=1,this.urgentResendAudio=1,this.crossPunchPloy=1,this.crossClientPer="all|all:100",this.crossClientUpBwMod=1,this.crossClientClose=-1,this.crossClientCloseCfg="all|all:0",this.syncMob=1,this.noSignalNode=1,this.crossCdn=1,this.crossLineSub="all",this.punchWan="",this.p2pWssLines="all",this.connectTotalTime=6e3,this.connectTimeout=2e3,this.connectPcdnTimeout=4e3,this.flowTimeout=2e3,this.flowRetryTimes=3,this.renderTimeout=3e3,this.noDataTimeout=4e3,this.noSliceTimeout=1e4,this.noPcdnDataTimeout=2e3,this.testResender=0,this.maxResendTimes=3,this.resendDelayTs=400,this.patchSubTs=500,this.http2Channel="",this.rangeNums=1e3,this.rangeV2=1,this.deleteH264Aud=[],this.useChangeRate=[],this.audioEmptyDur=100,this.p2pMediaLogCfg="all|all:0",this.p2pSignalLogCfg="all|all:0",this.p2pPunchMode=2,this.freeBufferBitrate=15e3,this.needCooling=1,this.needQueue=0,this.queueTime=500,this.punchedCoolingTime=1e4,this.delayCloseNum=200,this.punchTimeout=7e3,this.maxPunchedCnt=50,this.maxPunchedCntMore=60,this.maxNodeCnt=50,this.maxPunchedCntSdk=10,this.maxNodeCntSdk=10,this.maxPunchedCntNat4=10,this.punchCfg=[[999,40,50,10,10,40,10,10],[1,50,60,10,10,40,10,10]],this.punchBackCooling=2e4,this.punchIgnoreTime=3e4,this.coefficient=8,this.trySubNum=5,this.trySubTime=7e3,this.fastTime=5e3,this.lostSeqTime=6,this.sliceLate=1e3,this.sliceFast=1500,this.sliceConstraints=6e3,this.sliceConstraintBad=8e3,this.pubSelectorConstraint=0,this.badDelay=1e3,this.emuteDelay=2200,this.switchDelay=500,this.aliveTimeout=1e3,this.resubTime=3e4,this.sliceTimeout=1e3,this.maxPeerStreamNum=7,this.maxPeerStreamNum1=8,this.maxPeerStreamNum20M=8,this.maxUplinkBw=6e3,this.closeUids=[],this.closeSub=0,this.closeSubRooms=[],this.closeAllUids=[],this.p2pMediaCfg="all|all:100",this.p2pSignalCfg="all|all:100",this.ignoreUids=[1259515661837,1354740567,2368274334,1706479145,2367547387,1099531787526,1827824615,1531433300,1680925919,2227875499,2272316519,367138632,1677942333,157525e4,1610145122,1199534013894,813535483,1259553301717,570184355,679257140,1067459140,2222971974,1279514601966,1199577571975,294636272,518969542,745373351,1199515480194,1199568157971,1199517808234,1430972471,1356299405,1724691,10748220,1199525977184,2176998321,1099531752788,1487476672,1199536349047,1259525634703,17363578,1191588902,1629021815,124902116,1705516953,1199536199401,1120785052,1852594244,2285403183,1199526826004,2250967121,2208606321],this.flvEmptyAudioFrame=1,this.sendHeartBeatAlone=0,this.signalNoCdnp=[],this.switchSeamLessLine=0,this.isProduce=!0,this.coderates=[[15e3,0,8e3,5,5,230,1,20],[8e3,0,4e3,5,5,230,5,10],[6e3,0,4e3,5,5,170,5,10],[4e3,0,4e3,5,5,120,5,10],[3e3,0,4e3,5,5,80,5,10],[0,0,4e3,5,5,50,5,10]],this.seaSubNums=[],this.swapdomain={},this.iP2PType=2,this.danmuZipPids=[],this.randomPercent=1e4,this.frameBufLen=[2500,1500,1500,3500],this.bufferMode=2,this.bufferConfig=[],this.urgentResendTime=1500,this.forceSkipFrameTime=3900,this.frameTimeout=3e3,this.p2pBuffer=[3500,2500,4500],this.p2pOpenBrowsers=["opera"],this.jitAB=[],this.jitCfgFlv=[[0,1500,1e3,2e3]],this.jitCfg=[[15e3,4e3,3e3,5e3],[0,3e3,2e3,4e3]],this.jitCfgPidFlv=[],this.jitCfgPid=[],this.jitJump=[2e4,8e3],this.jitLowLatency=2e3,this.jitLow=[1500,1e3,2e3],this.safariPlayDelay=500,this.safariFirstLoad=!0,this.waitAudio=1,this._isFrameBuffer=-1,this.isSubUseHttps=1,this.usePcdn=1,this.pcdnSubsConfig=[1,1,1],this.vipUsers=[1199640152004,1199629649413,1199637548568,2221926148,50014085,1279513106277,1504206970,961143155,1279546440890,1199626834332,50016090,1319533242210,1199633418849,1199628818935,1199522152648,1633578507,1279511735113],this.autoViewUsers=[1259515288802,1199577719291],this.notUsePcdnBrowsers=[],this.notUsePcdnUids=[],this.notUsePcdnUsers=[],this.notUseFlvPcdnUsers=[],this.notUseFlvPcdnPids=[],this.notUseP2PPcdnUsers=[],this.notUseP2PPcdnPids=[],this.isPcdnReportErr=0,this.pcdnNoDataMod=2,this.pcdnSlowTime=2,this.pcdnSlowCoolTime=6e4,this.pcdnSowCnt=5,this.pcdnSwitchUrls=["xd"],this.pcdnPubIceCfg="all|all:100",this.pcdnPubIceOpen=!1,this.isMute=1,this.muteCfg=[1e4],this.isAutoNoPicture=0,this.notImgplusUas=["huya-pc exe"],this.playbackrateMin=.95,this.playbackrateMax=1.05,this.pcdnFlv=1,this.pcdnMseFlv=1,this.pcdnFlvSyncMob=1,this.pcdnFlvIgnore=0,this.flvToPcdnBuf=2400,this.flvToCdnBuf=1e3,this.isAiP2PToFlv=0,this.randomAIP2PFlvPercent=Math.floor(1e4*Math.random()),this.aiRandomPercent=5e3,this.aiABRandomPercent=2e3,this.aiUids=[],this.aiBlackUids=[],this.aiBlackLines=[],this.aiBlack2Uids=[],this.isAutoH265=0,this.renderDelta=300,this.autoReportTime=1e3,this.autoReportUsers=[],this.h265Config=[[[2e3,4e3],[4e4,4e4]],[4e3,2e3,1300,1e3,500,6e3,8e3],75,[[500,1e3,1300,2e3,4e3,6e3,8e3],[3,3,3,3,4,4,4]],30,3,[!0,!0]],this.h265MseConfig=[1,[86],[500,1e3,1300,2e3,4e3,6e3,8e3],[],[[500,1e3,1300,2e3,4e3,6e3,8e3],[5,5,5,5,5,5,5],[],[]],1],this.h265MseChromeConfig=[107,3e4,4,0,1],this.vodH265Config=[1,0,1],this.wcs265BlackUids=[],this.mse265BlackUids=[1225100385,1199560999561,1199636047603,1647046597,1199627582352,1609064756,1807493940,1624909255,1624909255,2364972864,1259514251347,1782184421,1564616639,1259524774186,1199518148059,1579681436,1866277950820,1488231977,1346502221,124968931,1465100418,1199538749015,1700394847,1199554450502],this.wcsGBlackIds=[],this.hardH265UidList=[],this.h265MseWhiteBlackUids=[[],[]],this.h265BlackUids=[],this.replayH265BlackUids=[],this.whiteH265Uids=[[],1],this.h265NoPushVideoDis=1e4,this.randomH265Percent=Math.floor(1e4*Math.random()),this.h265PercentConfig=1e5,this.enableAiMosaic=1,this.limitMosaicAreas=40,this.aiMosaicUis=[],this.aiRequestInterval=5e3,this.aiBathRequestInterval=3e4,this.aiBufferEmptyRequestInterval=3e5,this.playerdata={profileP2POpt:""},this.isCommonAb=1,this.aiP2PFlvConfig=[5e3,5],this.closePcdnBitrate=8e4,this.closePcdn500=0,this.setVideoCTCfg=[-100,1500,1e4],this.jumpBufferCfg=[30,1e3,1e4,5e3,30,25],this.jumpBufferCfg2=[0,500],this.jumpBufferCfgAids=[],this.jumpBufferVer=80,this.sliceQuantityPerSecond=1,this.useNewPloy=1,this.minPlayout=170,this.maxPlayout=500,this.playoutUids=[],this.isMuteAct=0,this.useAV1=!1,this.useAV1PidList=[],this.useAV1LinesAndBitRates=[[],0],this.isClosePlayBackRate=1,this.pcdnAbConnectData=[0,[1e3,2e3,3e3,4e3]],this.isForceUseWorker=1,this.platform=a.a.PLATFORM_TYPE_NAME.web,this.av1PercentConfig=5e3,this.isConfigSupportH265=1,this.vodConvertIDR=0,this.isVodSupportH265=0,this.isVodTurnTo264=1,this.abUseAv1=1,this.platform=a.a.PLATFORM_TYPE_NAME.web,this.h265GameIds=[!0,[]],this.isNoVideoReport=0,this.simdAbPercentConfig=5e3,this.vodAbSwitch=0,this.dropFrameAb=0,this.useNewParser=1,this.maxGop=3e3,this.autoCfg={close:0,closeLines:[],closePids:[],upGap:0,downGap:15e3,backGap:15e3,upPer:.8,downPer:.3,downNowPer:.2,waitPer:.8,downBitrate:2e3,slow:.85,bufCnt:10,sucPer:.9,sampleTime:200,minTime:1e4,maxTime:3e5,sysTime:1e4,evalTime:300,highRate:4e3,badBuf:2e3,badCnt:3,badS:[1e4,3],badL:[6e4,5],noRederTime:12e4,monitorTime:15e3},this.continueBufferDeltaStart=6e3,this.continueBufferDeltaEnd=3e3,this.autoBufferScore=1e3,this.autoConnectScore=500,this.autoFirstScore=500,this.autoPtsScore=500,this.force_auto_count=9999,this.force_auto_effective_time=2592e5,this.autoReportCfg=[1,3,0,1],this.autoReportSea=0,this.isWebAutoAB=0,this.maxBitRate=500,this.recSysExpiredTime=6e4,this.autoDownTimer=0,this.autoDownMaxBitrate=1,this.minFps=24,this.dropTime=0,this.perfBitrate=2e3,this.perfCnt=1,this.perfBuf=2e3,this.p2p302Config=[[[6,1,0,1]],1],this.sdkCloseAutoAi=0,this.closeP2PPids=[],this.closeP2PConfig=[1,1],this.enableAutoCloseP2P=1,this.isCloseVodPcdn=0,this.is265VideoLoadTs=1,this.isSendPlaybackLoadTime=0,this.vodPcdnOpenBuffer=1e4,this.vodPcdnCloseBuffer=7e3,this.vodPcdnCoolTime=6e4,this.vodPcdnBufferCfg=[[1e4,7e3,6e4],[],[]],this.perfBlockCfg=[2e3,3e3,6e3],this.vodPcdnStatCfg=[0],this.vodAv1Cfg="all|all:100",this.vodAv1Cd=6e4,this.vodAv1CdCnt=5,this.vodAv1CloseCfg=[[[4e3,8],[1300,2]],[4e3,4]],this.vodAv1UseFirst=1,this.vodUseBackupField=[1,1,1,1,1,1,0],this.vodDtsFixCfg=[0,0],this.vodRetryTime=5e3,this.vodBs2Delay=3e3,this.blockBadCfg=[800,1],this.perfWin7kaCfg=[2e3,3],this.openWebcodec=1,this.vodOpenWebcodecs=0,this.av1Webcodecs=0,this.webCodecBlackUids=[],this.webCodecsAnchoruids=[],this.vodWebcodecsGameIds=[],this.replayWebcodecsGameIds=[1],this.vodWebcodecsVids=[],this.vodWcsBroCfg=[0],this.wcsBlackAids=[],this.webCodecCfg=[4,8e3,2e3,1,1500,[2e3,1e4,2e4]],this.webCodecAVDeltaCfg=[5e3,2e3],this.noNextWcsTimeUids=[],this.useNextWcsTime=1,this.hardHevcConfig=[0,0,0],this.repairSameDtsCfg="",this.repairSameDts=0,this.useNewCdnp=1,this.shieldAudioCfg=[1,3e3,6e3,15e3,15e3,3e3],this.useCdnpFixed="all|all:100",this.signalClose="",this.signalExperiment=0,this.signalRangeGap="all|all:1000",this.signalSubGap="all|all:1000",this.signalBaseIndexExp=0,this.signalBaseIndexExpCfg="",this.signalBaseIndexMode=3,this.signalBaseIndexCfg="all|all:3",this.fakeHdrBlackPids=[],this.fakeHdrBitrateMap=[{4100:17200,4200:17100,20100:19200,4300:17300,14100:14200}],this.fakeHdrBlackPids=[],this.fakeHdrCfg=[{auid:[],bitrateMap:{4100:17200,4200:17100,20100:19200,4300:17300,14100:14200}}],this.fpsBitrateCfg=[100,[],{4200:17300},120],this.signalSliceCache="all|all:750",this.signalSliceDispatch="all|all:750",this.signalOpenExp="",this.signalOpen=-1,this.statLv=[1,1,0,1,0,2,0,0,1,0,2,1,1,1,1,1,0],this.statCfg="all|all:100",this.statIgnoreActsMps=["control","player_to_mps","mps_to_player","player_to_mps_err","nat_fail"],this.statHoldActsMps=[],this.statIgnoreFieldsMps=["loss_rates"],this.statHoldFieldsMps=[],this.statCoverFieldsMps=["oexp"],this.statIgnoreOpen=-1,this.statIgnoreOpenCfg="all|all:50",this.statIgnoreActsSdk=["h265_status","block_bad","fast_sample","p2p_load_video","connect_video_ts","load_p2plib_error","video_played_ts","first_video_iframe_ts","video_iframe_ts","first_video_render_ts","first_video_pkg_ts","load_m3u8_ts","first_frag_load_ts","first_frag_loaded_ts","first_frag_size","video_load_seg","h265_worker_load_ts","ai_p2p_flv_switch","pcdn_to_cdn","p2p_play_fail","pcdn_video_load_ts","recv_video_ts","cdnp_error","hls_play_succ","hls_load_succ","signal_turn_back","tcp_open_time","tcp_no_slice","p2p_cooling","cdnp_close","p2p_restart"],this.statHoldActsSdk=[],this.statIgnoreFieldsSdk=["a_render_silence_time","ai_control_data","cdnp_rtt","features_status","frame_info","link_sam","nonode_return","p_iaas_info","psub_proxy_info","sub_state_info","punch_info","punched_uuids","real_kbps_sample","recv_total_sample","signal_rtt","sub_pcdn_state","delay_node_info","svr_delay_infos","svr_last_p_delay","updown_info","h265_sam","sub_info"],this.statHoldFieldsSdk=[],this.mediaRangeGap="all|all:90",this.mediaSubGap="all|all:500",this.mediaBaseIndexExp=0,this.mediaBaseIndexExpCfg="",this.mediaBaseIndexMode=1,this.mediaBaseIndexCfg="all|all:3",this.mediaSliceCache="all|all:750",this.mediaSliceDispatch="all|all:750",this.dropFrameUids=[1],this.dropFrameDts=[1e4,2e4],this.usePullPunch="all|all:100",this.closeLowBufResend="",this.renderStat=[1],this.signalRttPids="all|all:0",this.signalRttUids=[],this.pause500Cfg=[300,[]],this.closePause500=0,this.recvProcesser=-1,this.recvCfg="all|all:100",this.isQQSoft=1,this.isWin7WcsSoft=1,this.isLimitNaluType=1,this.isCloseMseDrop=0,this.isAutoWcsReport=1,this.avHeaderChangeCfg=[[],0,300,1e4],this.avHeaderChangeStatCfg=[[],3e3,1],this.enableHvcc=1,this.videoMaxGap=2e4,this.iaasCfg=[1,1,3,.3,4e3,600,200,5e3,5,.4],this.iaasCfgWhiteAuids=[0,[]],this.iaasCfgBlackAuids=[],this.iaasCloseGather=1,this.p2pSubSdkV2=0,this.p2pSubSdkCfg="all|all:0",this.h265BlackBrows=[],this.wcsSoftBrows=[],this.wcsBlackBrowVers=[],this.p2pBlackBrowVers=[],this.pcdnBlackBrowVers=[],this.pcdnFlvBlackBrowVers=[],this.pcdnFlvBlackBrowVerMax=49,this.wasm265BlackBrowVers=[],this.mse265BlackBrowVers=[],this.wcs265BlackBrowVers=[],this.wcs264BlackBrowVers=[],this.bitrateBrowHard265Cfg=[0,4e3,[]],this.wcsSoft264Uids=[],this.popSize0Brows=[],this.payRoomCfg=[0,5],this.mobVBlockCfg=1,this.wasmCloseCfg=[0,[]],this.wcs265BlackBrowNames=[],this.enhanceVCfg=[1,4e3,6,1080],this.enhanceGameIds=[1,2336,5699,1663,2168,2633,7185,5485,7,6203,393,9521,2793,3203,5937,862,4,2413,100032,1964,1997,6219,7579,2,4921,9961,802,7601,1732],this.enhanceGameIdRatioMap={2793:[720,1080],3203:[720,1080],5937:[720,1080],862:[720,1080],4:[720,1080],2413:[720,1080],100032:[720,1080],1964:[720,1080],1997:[720,1080],6219:[720,1080],7579:[720,1080],2:[720,1080],4921:[720,1080],9961:[720,1080],802:[720,1080],7601:[720,1080],1732:[720,1080]},this.eHBlackUids=[],this.eHBlackAnchoruids=[],this.eHBlackBrowVers=[],this.eHBlackBrowVerList=[],this.eHBlackRenderList=[],this.ehWhiteAnchoruids=[0,[]],this.enhanceSupportMode=1,this.enhanceVodVCfg=[0,4e3,6,1080],this.enhanceVodGameIds=[1,2336],this.eHVodBlackUids=[],this.eHVodBlackAnchoruids=[],this.eHVodBlackVids=[],this.eHVodBlackBrowVers=[],this.eHVodBlackRenderList=[],this.ehVodWhiteAnchoruids=[0,[]],this.ehVodWhiteVids=[0,[]],this.vodEnhanceChannelMap=[{vhuyalol:1},{9521:9521},{vhuyawzry:2336}],this.popDuration=200,this.decodeDelay=100,this.p2pRangePeerMode=1,this.rtPeerMax=1,this.rtPeerPer=0,this.rtPeerCfg=[[0,3,0]],this.rtPeerTimeout=300,this.rtPeerPRN=1,this.rtPeerSelectorCfg="all|all:100",this.rtPeerSelector=!1,this.resendUrgentCfg=[[1,[[0,700]]]],this.resendUrgentMse=[[1,[[0,700]]]],this.resendUrgentWcs=[[1,[[0,400]]]],this.rtPeerAsk=0,this.rtPeerSrc=1,this.rtPeerTopN=5,this.rtPeerUrgent=1,this.rtPeerUrgentOpt=0,this.rtPeerRTONum=2,this.rtPeerBeforeHand=0,this.rtPeerRandom=1,this.rtPeerUgMin=300,this.fastTimeCfg="all|all:0",this.urgentBuffer=201,this.resendAudioCfg="all|all:500",this.resendAudioBufCfg="all|all:1500",this.useFastTime=!1,this.logMaxLen=4e3,this.hisLogMaxLen=2e3,this.isHisLog=1,this.pcdnProTimoutTs=3e3,this.heartMode="all|all:1",this.heartQpsPids="all|all:100",this.heartQps="all|all:3",this.pcdn302FlvCfg=[1,15],this.pcdn302FlvBakCfg=[1,1],this.pcdn302BlackAids=[],this.flvPcdn302Ab=10001,this.enableBroMseCfg=[117],this.audioDtsOpen=!1,this.audioDtsCfg="all|all:0",this.dtsJumpOpen=!1,this.dtsJumpCfg="all|all:100",this.dtsJumpThreshold=2e4,this.enableEdgeBroMseCfg=[117],this.audioDropTime=1e4,this.audioDropOpen=!1,this.audioDropCfg="all|all:100",this.isAudioEmptyLimit=1,this.isFilterMsePause=1,this.isMseCheckRcRd=1,this.testRenderCfg=[5,2e4,500,[120]],this.testRenderSwitchCfg=[1,1],this.noRenderMetricTime=6e4,this.noRenderValidTime=1e3,this.noRenderDur=500,this.forbidWapShare=1,this.closePcdnOrigins=[],this.isPause5SecRetry=1,this.isFlvUrlRetry=1,this.wapPcdnWhiteAids=[],this.wapP2pWhiteAids=[],this.isWapSupportPcdnP2p=0,this.isCloseXiaomiPcdnP2p=1,this.mosaicGlassHardCfg=[0,["nvidia","amd"],6],this.mp4ErrorReportRandom=100,this.mosaicGlassUseFps=1,this.mosaicGrassExpired=1,this.grassModeAllowFPS=45,this.voiceTimer=50,this.wupFailCnt=20,this.wupFailPer=90,this.hlsLiveMaxFragNum=10,this.h5FirstPlay=0,this.h5WaitTime=1e4,this.mpsCrossCfg="all|all:0",this.mpsCross=-1,this.mpsCrossBlackUids=[],this.mpsCrossWhiteUids=[],this.mpsNotCrossBrowsers=["firefox","safari"],this.mpsCrossV6=1,this.mpsCfg="all|all:100",this.mpsSupportReverse=1,this.mpsWebrtcLimitTime=6e4,this.mpsWhiteUids=[],this.mpsBlackUids=[1279546440890,1199629649413,1199626834332],this.mpsSub=-1,this.mpsSubCfg="all|all:100",this.mpsUseCfg=[1,1,1],this.mpsSubBlackUids=[],this.mpsSubWhiteUids=[],this.mpsLibName="Mps.js",this.mpsFailMax=1e5,this.mpsFailTime=5,this.mpsPolicy=1,this.mpsMergeReq=0,this.mpsSrcStartMode=1,this.mpsSrcWaitStopTime=2e4,this.mpsBufferSendModeCfg="all|all:0",this.mpsBufferMode=0,this.mpsBufferTime=20,this.mpsBufferSize=20,this.mpsBufferSendMode=1,this.mpsBufferSendPowerFast=1.5,this.mpsBufferSendPowerNormal=1.1,this.mpsBufferSendFastTime=8e3,this.mpsBufferSendMaxSize=64,this.mpsBufferDropLimit=3e3,this.mpsBufferDropTime=500,this.mpsBufferSendRateLimit=3,this.mpsBufferSendRatePower=.6,this.mpsBufferBlockLimit=2500,this.mpsBufferDropLimitTime=1e4,this.mpsBufferBlock=8,this.mpsBufferBlockSenders=2,this.mpsBufferBlockPer=10,this.mpsBufferBlockDelTime=15e3,this.mpsBufferBlockResumeTime=2e4,this.mpsGroupOpen=-1,this.mpsGroupOpenCfg="all|all:100",this.mpsCloseV6=1,this.useSvrNat=100,this.notUseNatSync=0,this.competeNat1=0,this.punchByNat=0,this.nat1First=0,this.punchNat1FailCnt=3,this.keepAliveNat1=0,this.keepAliveCnt=1,this.keepAliveCntNat1=6,this.cdnpIp="",this.cdnpPort=0,this.p2pPacketLifeTime=-1,this.p2pRetransmits=-1,this.mpsLossRateClose=8,this.mpsLossRateCloseTime=1e4,this.mpsLossRateOpen=5,this.mpsLossRateOpenTime=5e3,this.mpsUpUserCnt=1e4,this.mpsUpUserBw=1e6,this.pcdnUseSvrReqGap=1,this.pcdnReqGap=15e3,this.pcdnResCfg="all:https_4|wss_4,xd|huya:webrtc_8",this.autoReportNoAnwser=0,this.useMuteBiAudio=!0,this.closePunchUsers=[],this.mmsOpen=!0}isClosePunch(t){return this._isContainsUser(this.closePunchUsers,t)||this._isContainsUser(this.vipUsers,t)}isAutoReport(t){return this._isContainsUser(this.autoReportUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isSignalRttOpen(t){return this._isContainsUser(this.signalRttUids,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}initRTPeerCfg(t){let e=this.rtPeerCfg;for(let i=0;i<e.length;i++)if(t>=e[i][0]){this.rtPeerMax=e[i][1],this.rtPeerPer=e[i][2],r.a.log("Config.initRTPeerCfg bitrate=".concat(t," rtPeerMax=").concat(this.rtPeerMax," rtPeerPer=").concat(this.rtPeerPer));break}}getAvHeaderChangeStat(t){let e=this.avHeaderChangeStatCfg[0],i=!1;for(let s=0;s<e.length;s++)e[s]==t&&(i=!0);return 1==this.avHeaderChangeStatCfg[2]&&(i=!0),i}initOpens(t,e,i){let s=["recvCfg","mpsSubCfg","mpsCrossCfg","crossClientCloseCfg"],r=["recvProcesser","mpsSub","mpsCross","crossClientClose"],a=["","","mpsCrossWhiteUids",""],o=["","","mpsCrossBlackUids",""];for(let n=0;n<s.length;n++){let h=a[n],d=o[n],l=!1,c=!1;h&&(l=this._isContainsUser(this[h],i)),d&&(c=this._isContainsUser(this[d],i)),this.initOpen(t,e,s[n],r[n],l,c)}}initOpen(t,e,i,r,a,o){-1===this[r]&&(s.b.isOpen(this[i],t,e,!1)?this[r]=1:this[r]=0),a?this[r]=1:o&&(this[r]=0)}get isFrameBuffer(){return 2}initByBitrate(t){if(this.initRTPeerCfg(t),this.maxPeerStreamNum=t>=1e4?this.maxPeerStreamNum20M:this.maxPeerStreamNum1,this.resendMode=1,this.resendModeConfig&&this.resendModeConfig[0].length===this.resendModeConfig[1].length)for(let e=this.resendModeConfig[0].length-1;e>=0;e--)if(t>=this.resendModeConfig[0][e]){this.resendMode=this.resendModeConfig[1][e];break}}isAutoClose(t,e){if(1===this.autoCfg.close||-1!==this.autoCfg.closeLines.indexOf(Number(t)))return!0;let i=this.autoCfg.closePids.length;for(let s=0;s<i;s++){let i=this.autoCfg.closePids[s];if(Number(i.pid)===Number(e))return!i.hasOwnProperty("lines")||-1!==i.lines.indexOf(t)}return!1}initRepaireSameDtsCfg(t){"all"===this.repairSameDtsCfg||-1!==this.repairSameDtsCfg.indexOf(t)?this.repairSameDts=1:this.repairSameDts=0,r.a.log("Config.initRepaireSameDtsCfg=".concat(this.repairSameDts))}setLowLatency(t){t&&t.setJitter(this.jitLow[0],this.jitLow[1],this.jitLow[2])}setJitterCfg(t,e,i,s){if(!this.setJitterAB(t,e,i)&&!this.setJitterByPid(t,e,i,s)){let e="flv"===s?this.jitCfgFlv:this.jitCfg;this.setJitterByRate(t,i,e)}}setJitterAB(t,e,i){if(this.jitAB.length>0){let s=this.jitAB[0],a=this.jitAB[1],o=this.jitAB[2];if("all"===s||-1!==s.indexOf(e+"")){let e=this.getGroupNum(o.length);return r.a.log("setJitterAB name=".concat(a," group=").concat(e)),this.setJitterByRate(t,i,o[e]),!0}}return!1}getGroupNum(t){let e=1e4*Math.random();for(let i=t-1;i<t;i--)if(e>1e4/t*i)return i;return 0}setJitterByPid(t,e,i,s){let a="flv"===s?this.jitCfgPidFlv:this.jitCfgPid;for(let s=0;s<a.length;s++){let o=a[s];if(-1!==o[0].indexOf(e+""))return r.a.log("setJitterByPid"),this.setJitterByRate(t,i,o[1]),!0}return!1}setJitterByRate(t,e,i){for(let s=0;s<i.length;s++){let r=i[s];if(e>=r[0])return t&&t.setJitter(r[1],r[2],r[3]),!0}return!1}init(t){if(!t)return;Object.assign(this,t);let e=["mpsGroupOpenCfg","statIgnoreOpenCfg","crossClientCloseCfg","mpsBufferSendModeCfg","cdnpIp","100","p2pWssLines","http2Channel","crossLineSub","punchWan","repairSameDtsCfg","signalClose","signalRangeGap","signalSubGap","signalBaseIndexCfg","signalBaseIndexExpCfg","useCdnpFixed","signalSliceCache","signalSliceDispatch","mediaRangeGap","mediaSubGap","mediaBaseIndexCfg","mediaBaseIndexExpCfg","mediaSliceCache","mediaSliceDispatch","usePullPunch","closeLowBufResend","statCfg","signalOpenExp","recvCfg","vodAv1Cfg","platform","crossClientPer","p2pSubSdkCfg","p2pMediaCfg","p2pSignalCfg","fastTimeCfg","rtPeerTimeCfg","rtPeerSelectorCfg","heartMode","heartQpsPids","heartQps","audioDtsCfg","dtsJumpCfg","resendAudioCfg","resendAudioBufCfg","pcdnPubIceCfg","p2pMediaLogCfg","p2pSignalLogCfg","signalRttPids","mpsCfg","mpsSubCfg","mpsLibName","pcdnResCfg","mpsCrossCfg"];r.a.group("Configs");let i=["Configs:"];for(let t in this){let r=this[t];"string"==typeof r&&("pushGop"==t?r=!!Number(r):"coderates"==t||"testCoderates"==t||"swapdomain"==t?(r=r.replace(/[↵\s+\n]/gm,""),r=JSON.parse(r)):-1===e.indexOf(t)&&(r=Number(r))),this[t]=r,"object"==typeof r&&(r=JSON.stringify(r)),t=s.b.padStrLen(t,18,!1),i.push("\t"+t+" => "+r)}r.a.log(i.join("\n")),r.a.groupEnd(),r.a.log("Config",this)}setAiP2PToFlv(t){1!==Number(t)&&(this.isAiP2PToFlv=t)}setUseAV1(t){let e=this.useAV1PidList,i=t.presenterUid,s=!1,r=this.useAV1LinesAndBitRates[0],a=this.useAV1LinesAndBitRates[1];e.forEach(t=>{i&&t.toString()==i.toString()&&(s=!0)}),s&&(r.forEach(e=>{e==t.lineType&&(s=!1)}),t.curBitrate<Number(a)&&(s=!1)),this.useAV1=s,s&&(this.autoCfg.close=1)}isCloseP2P(t){return t&&this.closeUids&&-1!==this.closeUids.indexOf(t)}isClosePidMediaP2P(t,e){return!s.b.isOpen(this.p2pMediaCfg,t,e,!1)}isClosePidSignalP2P(t,e){return!s.b.isOpen(this.p2pSignalCfg,t,e,!1)}isCloseP2PBroVer(){const t=o.a.version.major;return t&&this.p2pBlackBrowVers&&-1!==this.p2pBlackBrowVers.indexOf(t)}isClosePcdnBroVer(){const t=o.a.version.major;return t&&this.pcdnBlackBrowVers&&-1!==this.pcdnBlackBrowVers.indexOf(t)}isCloseP2PAid(t){return this.platform===a.a.PLATFORM_TYPE_NAME.wap&&0==this.isWapSupportPcdnP2p&&-1==this.wapP2pWhiteAids.indexOf(t)}getEnableAiMosaic(t){return!!this.enableAiMosaic}setMute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.isMute=t}setUseAuto(t){t&&(this.isConfigSupportH265=0)}getEnableJumpBuffer(){let t=o.a.version.major>=this.jumpBufferVer;return o.a.chrome&&t||"firefox"===o.a.name}isCloseAllFuncs(t){return-1!==this.ignoreUids.indexOf(Number(t))||this.closeAllUids&&-1!==this.closeAllUids.indexOf(Number(t))}isCloseMps(t){return this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.mpsBlackUids,t)||this._isContainsUser(this.ignoreUids,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseFlvPcdnUser(t){return this._isContainsUser(this.notUseFlvPcdnUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseFlvPcdnPid(t){return this._isClosePid(this.notUseFlvPcdnPids,t)}isCloseFlvPcdnBroVer(){const t=o.a.version.major;return t<=this.pcdnFlvBlackBrowVerMax||-1!==this.pcdnFlvBlackBrowVers.indexOf(t)}isCloseP2PPcdnUser(t){return this._isContainsUser(this.notUseP2PPcdnUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseP2PPcdnPid(t){return this._isClosePid(this.notUseP2PPcdnPids,t)}_isContainsUser(t,e){return t&&-1!==t.indexOf(Number(e))}_isClosePid(t,e){return!!t&&("all"===t[0]||-1!==t.indexOf(Number(e)))}isNotUsePcdn(t,e){let i=!1;return this.notUsePcdnUids.forEach(e=>{Number(e)===Number(t)&&(i=!0)}),this._isContainsUser(this.notUsePcdnUsers,e)&&(i=!0),this._isContainsUser(this.vipUsers,e)&&(i=!0),this._isContainsUser(this.autoViewUsers,e)&&(i=!0),i}setVodPcdnConfig(t){let{vid:e,anchoruid:i,useVodPcdnAbCfg:s=!1}=t;if(!e&&!i)return;if(s&&this.vodPcdnBufferCfg[0].length>=3)return this.vodPcdnOpenBuffer=this.vodPcdnBufferCfg[0][0],this.vodPcdnCloseBuffer=this.vodPcdnBufferCfg[0][1],void(this.vodPcdnCoolTime=this.vodPcdnBufferCfg[0][2]);const r=(t,e)=>{t.some(t=>!(t.length<4&&t[3].length<=0)&&(t[3].indexOf(e)>=0?(this.vodPcdnOpenBuffer=t[0],this.vodPcdnCloseBuffer=t[1],this.vodPcdnCoolTime=t[2],!0):void 0))};this.vodPcdnBufferCfg[1].length>0&&4===this.vodPcdnBufferCfg[1][0].length&&r(this.vodPcdnBufferCfg[1],Number(i)),this.vodPcdnBufferCfg[2].length>0&&4===this.vodPcdnBufferCfg[2][0].length&&r(this.vodPcdnBufferCfg[2],String(e))}enableWebCodec(){this.openWebcodec=1}enableVodWebCodecs(){this.vodOpenWebcodecs=1}getFakeHdrBitrate(t,e,i){let s=e;if(-1===this.fakeHdrBlackPids.indexOf(Number(t))){s=this.fakeHdrBitrateMap[0][e]||s}const r=this.fpsBitrateCfg[1],a=this.fpsBitrateCfg[3]||120;if(-1!=r.indexOf(t)&&i==a){const t=this.fpsBitrateCfg[2];for(let i in t)t.hasOwnProperty(i)&&i==e&&(s=t[i])}return s}getFpsBitrate(t,e){let i=!1;const s=this.fpsBitrateCfg[1],r=this.fpsBitrateCfg[0];return s.indexOf(Number(t))>=0&&e>=r&&(i=!0),i}setClosePause500(t){let e=this.pause500Cfg[1];e.length>0&&-1!=e.indexOf(Number(t))&&(r.a.log("Config.closePause500Report"),this.closePause500=1)}setEnableIaas(t,e,i){1==this.iaasCfgWhiteAuids[0]&&(this.iaasCfg[0]=0,-1!=this.iaasCfgWhiteAuids[1].indexOf(Number(e.presenterUid))&&(this.iaasCfg[0]=1)),-1!=this.iaasCfgBlackAuids.indexOf(Number(e.presenterUid))&&(this.iaasCfg[0]=0)}setJumpCfg(t){this.jumpBufferCfgAids.length>0&&-1!=this.jumpBufferCfgAids.indexOf(Number(t.presenterUid))&&(this.jumpBufferCfg[1]=this.jumpBufferCfg2[1])}};e.a=n},function(t,e,i){"use strict";let s=(()=>{let t=null;try{t=window.localStorage}catch(e){t={removeItem:function(t){},getItem:function(t){return null},setItem:function(t,e){},clear:function(){}}}return t})();e.a=s},function(t,e,i){"use strict";var s=i(11);e.a=s.TimeUtilImpl},function(t,e,i){"use strict";var s=i(10);let r={SLICE_SPEED:12.5,MAX_PACKET_CNT:1e4,SWITCH_INTERVAL:10,MAX_DELAY:66e4,DEFAULT_DELAY:65535,SUBSCRIBE_TIMEOUT:1e4,PUNCH_BACK_COOLING:2e4,PUNCH_IGNORE_TIME:3e5,SUB_TIMEOUT:5e3,RESUB_TIMEOUT:3e4,STREAM_DELAY:2e3,EMULATE_DELAY:1800,MAX_DEPTH:1,PROXY_NUM:3,MAX_PEER_STREAM_NUM:8,MAX_PUSH_NUM:3,MAX_PULL_NUM:3,SLICE_DELAY:100,SLICE_LATE:50,SLICE_FAST:50,SLICE_TIMEOUT:2e3,SWITCH_DELAY:500,StreamType:{NONE:0,FORCE:1,FIXED:2,COMPETE:3,PEER:4},LeaveReason:{PING_DIF:1,RESET:2},DEL_REASON:{CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15},PERIOD:{UPLINK_CALC:10,CHECK_SEED:20,GET_NODE:5},SubType:{SUBSCRIBE_FORCE:0,SUBSCRIBE_NORMAL:1},LoadVideoTimeoutReason:{FLV_DISCONNECTED:0,FLV_CONNECTED:1,FLV_CONNECT_ERROR:2,FLV_RECV_DATA:3,FLV_DATA_INVALID:4,FLV_STARTPLAY:5,FLV_PLAYERROR:6,HLS_DISCONNECTED:7,HLS_LOADMANIFEST_ERROR:8,HLS_LOADMANIFEST_SUCCESS:9,HLS_LOADFRAMENT:10,HLS_LOADFRAMENT_ERROR:11,HLS_LOADFRAMENT_SUCCESS:12,HLS_PLAY_ERROR:13},SubResCode:{ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28},VIDEO_COMPETE_UID:4294967295,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:-1,VIDEO_DEFAULT_UID:-2,isProxyUid:function(t){return t===r.VIDEO_COMPETE_UID||t===r.VIDEO_FORCE_UID||t===r.VIDEO_FIXED_UID||t===r.VIDEO_DEFAULT_UID},isCompete:function(t){return t===r.VIDEO_COMPETE_UID},isForce:function(t){return t===r.VIDEO_FORCE_UID},isFixed:function(t){return t===r.VIDEO_FIXED_UID},isDefault:function(t){return t===r.VIDEO_DEFAULT_UID},isSliceJumpFromPeer:function(t,e){return e.isFromPeer&&t>0&&e.seq-t>10*r.LOST_SEQ_NUM},offerReject:{REASON_NOTSTART:1,REASON_PUNCHFAILED_CD:2,REASON_PUNCHED_FULL:3,REASON_QUOTA_EXHAUST:4,REASON_VERSION:5,REASON_DIF_LINE:6,REASON_FAIL:7,REASON_IGNORE:8,REASON_HAS_NODE:9,REASON_WAITING:10,REASON_OTHER:100},offerRejectTime:12e4,punchBackRet:{SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5},restartReason:{RANGE_SEQ_MAX:1,RANGE_SEQ_LARGE:2,CDN_JUMP:3,PLAYER_NO_DATA:4,LOST_SEQ:5,CONNECT:6,WORKER_ERROR:7,MULTI_CDN:8,FLV_TO_P2P:9,PLAYER_ERROR:10,PLAYER_DISPOSE:11,LOST_SEQ_JUMP:12},turnToFlvReason:{FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17,NO_DATA_TIMEOUT:18,IS_NOT_FIRST_FETCH:19,VIDEO_BUFFER_EMPTY:20,PLAY_TIMEOUT:21,NOT_SUPPORT_P2P:22},userProperty:{SERVER_CLOSE:1,CLIENT_CLOSE:2,BROWSER_UN_SUPPORT:3,FLASH:4,UNKNOW:5,P2P:6,FIRST_FULL_CONNECT_TIMEOUT:7,FIRST_FULL_PLAY_FAIL:8,FIRST_FULL_NO_DATA:17,RESTART_RANGE_MAX:9,RESTART_RANGE_LARGE:10,RESTART_CONNECT:11,RESTART_MUTI_CDN:12,RESTART_PLAYER_NO_DATA:13,RESTART_PLAYER_ERROR:14,SUB_NO_DATA:15,SUB_CONNECT_TIMEOUT:16,P2P_ARGS_ERROR:18,FLV_TO_P2P:19,LOST_SEQ:20,P2P_COOLING:21,IS_NOT_FIRST_FETCH:22,VIDEO_BUFFER_EMPTY:23},h265TurnToH264Reason:{DECODE_ERROR:1,RENDER_ERROR:2},pauseReason:{FLV_NO_BUFF:1,FLV_UNKNOW_PAUSE:2,FLV_NET_SLOW:3,P2P_NO_BUFF:4,P2P_UNKNOW_PAUSE:5,P2P_FULL_LOADER_NO_DATA:10,P2P_FULL_LOADER_CONNECT_FAIL:11,P2P_SUB_LOADER_NO_DATA:12,P2P_SUB_LOADER_CONNECT_FAIL:13,FLV_NO_DATA:14,P2P_NO_SLICE:15,P2P_RESEND_SKIP_FRAME:20,P2P_RESEND_TOOLATE:21,P2P_RESEND_TIMEOUT:22,P2P_RESEND_ERROR:23,P2P_RESEND_MISSING:24,P2P_DTS_JUMP:25,P2P_NET_SLOW:26},DataType:{SIGNALLING:0,PING:1,SLICE:2},LOST_SEQ_NUM:4e3,BAD_REASONS:{UNKNOW:100,SUB_LINK:1,DOWN_LINK:2,RANGE_MISS:3,RANGE_RECV_TIMEOUT:4,FRAME_SEQ_LOST:5,BUFFER_JUMP:6,TIMESTAMP_JUMP:7,FRAME_VIDEO_JUMP:8,FRAME_AUDIO_JUMP:9,FRAME_DROP:10,PERFORMANCE:11},initConfig:function(t,e){let i=e.coderates,a=null;for(let e=0;e<i.length;e++)if(a=i[e],t>Number(a[0])){r.PROXY_NUM=Number(a[1]),r.SLICE_DELAY=Number(a[2]),r.MAX_PUSH_NUM=Number(a[3]),r.MAX_PULL_NUM=Number(a[4]),r.SLICE_LARGE=Number(a[5]);break}r.MAX_PEER_STREAM_NUM=Number(e.maxPeerStreamNum)||8;let o=r.SLICE_SPEED*s.a.baseSubs*(t/1e3);r.SLICE_LATE=parseInt(o*((Number(e.sliceLate)||1e3)/1e3)),r.SLICE_FAST=parseInt(o*((Number(e.sliceFast)||2e3)/1e3)),r.STREAM_DELAY=Number(e.badDelay)||2e3,r.EMULATE_DELAY=Number(e.emuteDelay)||1800,r.RESUB_TIMEOUT=Number(e.resubTime)||3e4,r.SLICE_TIMEOUT=Number(e.sliceTimeout)||2e3,r.SWITCH_DELAY=Number(e.switchDelay)||500},HLS_LOAD_TYPE:{FETCH:1,XHR:2},LATENCY_MODEL_TYPE:{NONE:0,CONTROL_MODEL:2,RTC_MODEL:4,TOPSPEED_MODEL:99},PLATFORM_TYPE:{web:100,mini_app:102,wap:103,huya_liveshareh5:104,adr:2,ios:3},PLATFORM_TYPE_NAME:{web:"web",wap:"wap"},H5_ERROR_CODE:{VIDEO_ERROR:-1e3,PLAY_TIMEOUT:-1001},VISIBILITY_STATE:{VISIBLE:"visible",HIDDEN:"hidden",PRERENDER:"prerender"},PCDN_OPEN_BUFFER:1e4,PCDN_CLOSE_BUFFER:7e3,PCDN_COOL_TIME:6e4,PLAYER_CORE_TYPE:{MSE:1,WEBCODECS:2,MMS:3}};e.a=r},function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var s=i(21),r=i(2),a=i(13),o=i(0),n=i(8),h=i(16),d=i(14),l=i(1),c=i(15),u=i(3);class p{static turnStr(t,e,i){let s=t.toString(e);for(let t=s.length;t<i;t++)s="0"+s;return s}static rotl64(t,e){let i=p.turnStr(t,2,64),s=i.substring(0,32),r=i.substring(32),a=r.substr(e,32-e)+r.substr(0,e);return parseInt(s+a,2)}static rotr64(t,e){let i=p.turnStr(t,2,64),s=i.substring(0,32),r=i.substring(32),a=r.substr(32-e,e)+r.substr(0,32-e);return parseInt(s+a,2)}static rotUid(t,e){return 0===t&&(t="1234"+p.turnStr(parseInt(9999*Math.random()),10,4)),isNaN(e)&&(e=0),t=parseInt(t),e=parseInt(e),p.rotl64(t,8)}static revertUid(t,e){return t=parseInt(t),p.rotr64(t,8)}static inet_ntoa(t){let e,i,s,r,a="",o=new Uint8Array(4),n=new DataView(o.buffer);return n.setUint32(0,t),e=n.getUint8(0),i=n.getUint8(1),s=n.getUint8(2),r=n.getUint8(3),a=r+"."+s+"."+i+"."+e,a}static ip2uint(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}static isBiggerUint(t,e){return t!==e&&(t>e?t-e<2147483647:!(e-t<2147483647))}static isEqualOrBiggerUint(t,e){return t===e||(t>e?t-e<2147483647:!(e-t<2147483647))}static isUintMax(t){return 4294967295===t}static isUint64Max(t){return 0x10000000000000000===t}static getQueryString(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=(e||window.location.search.substr(1)).match(i);return null!=s?unescape(s[2]):null}static printHexBytes(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i=new DataView(t.buffer),s=e?10:0,r=[];s<i.byteLength;){var a=i.getUint8(s++);(a=a.toString(16).toUpperCase()).length<2&&(a="0"+a),r.push(a,"\t"),s%10==0&&r.push("\n")}console.log(r.join("")+"\tsize:",i.byteLength)}static getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(e))return a.substr(e.length)}return""}static formatByteSize(t){let e=t/1024;return e>1024?(e/=1024,e=e.toFixed(1)+"MB"):e=e.toFixed(1)+"KB",e}static padStrLen(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length>=e)return t;let s=" ".repeat(e-t.length);return i?s+t:t+s}static xhr(t,e,i,s,r){var a=new XMLHttpRequest;a.overrideMimeType("text/plain; charset=x-user-defined");var o=function(){4===a.readyState&&(200===a.status||304===a.status?s(a.response):r(a.status),a.removeEventListener("readystatechange",o),a=void 0)};a.addEventListener("readystatechange",o),a.open(e,t,!0),a.send(i)}static getAv1Random(t,e){if(!t)return!1;let i=u.a.av1PresentUid,s=t.presenterUid;u.a.randomAv1Percent&&i==s||(u.a.randomAv1Percent=Math.floor(1e4*Math.random()));let r=Number(u.a.randomAv1Percent);return u.a.av1PresentUid=t.presenterUid,r<e}static is64bitSoftware(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}static isGameIdSupport265(t,e){if(t[0])return!0;let i=!1;return t[1].map(t=>{e&&e.toString()==t.toString()&&(i=!0)}),i}static unescapeHTML(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}static getSdkAbRandom(t,e){let i=u.a.abPresentUid;u.a.randomAbPercent&&i==t.presenterUid||(u.a.randomAbPercent=Math.floor(1e4*Math.random()));let s=Number(u.a.randomAbPercent);return u.a.abPresentUid=t.presenterUid,s<e}static removeUrlParam(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)return t;const i=t.split("?"),s=i[0],r=i.length>1?i[1]:"";if(!r)return t;let a=t;const o={},n=r.split("&");for(var h=0;h<n.length;h++)n[h]=n[h].split("="),o[n[h][0]]=n[h][1];return e.forEach(t=>{r.indexOf(t)>-1&&delete o[t]}),a=s+JSON.stringify(o).replace(/[\"\{\}]/g,"").replace(/\:/g,"=").replace(/\,/g,"&"),a}static removeUrlAllParam(t){return t?t.split("?")[0]:t}static getBrowserHidden(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden}static isWebCodecsSupported(){return!("undefined"==typeof VideoDecoder||"undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)&&navigator.hardwareConcurrency>=r.a.webCodecCfg[0]}static isManagerMediaSourceSupported(){return!!window.ManagedMediaSource||!!window.MediaSource}static isWebcodecsBrowserSupported(){const t=navigator.userAgent.toLowerCase(),e=-1!=t.indexOf("yabrowser")||-1!=t.indexOf("yowser");return"opera"!=n.a.name&&!e}static checkWebCodec(t,e,i){if(i&&!h.a.isMseSupportedHevc())return!1;if(i&&0==r.a.vodH265Config[0]&&t.liveType!=c.a.LIVE)return!1;const s=t.presenterUid,m=(t.uid,t.curBitrate);r.a.webCodecsAnchoruids.indexOf(Number(s))>=0&&r.a.enableWebCodec(),t.liveType!=c.a.LIVE&&(t.liveType==c.a.REPLAY?-1!==r.a.replayWebcodecsGameIds.indexOf(t.gameId)&&r.a.enableVodWebCodecs():-1!==r.a.vodWebcodecsGameIds.indexOf(t.gameId)&&r.a.enableVodWebCodecs(),-1!==r.a.vodWebcodecsVids.indexOf(t.vid)&&r.a.enableVodWebCodecs());const _=m<=r.a.webCodecCfg[1];let f=r.a.openWebcodec&&_;t.liveType!=c.a.LIVE&&(f=r.a.vodOpenWebcodecs&&_,n.a.version.major<r.a.vodWcsBroCfg[0]&&(f=!1));let g=a.a.os||"",S=a.a.osVersion||"",y=!0;if("windows"==g.toLocaleLowerCase()&&Number(S)>=10&&-1!==n.a.name.indexOf("edg")&&n.a.version.major>=r.a.h265MseChromeConfig[0]&&i||"windows"==g.toLocaleLowerCase()&&Number(S)>=10&&-1!==n.a.name.indexOf("chrome")&&n.a.version.major>=r.a.h265MseChromeConfig[0]&&i?y=!0:i&&(y=!1),i&&(f=f&&y),-1!==r.a.wcs265BlackUids.indexOf(Number(t.uid))&&(f=!1),r.a.webCodecBlackUids.indexOf(Number(s))>=0&&(f=!1),r.a.wcsBlackAids.indexOf(Number(s))>=0&&(f=!1),-1!=r.a.wcsBlackBrowVers.indexOf(n.a.version.major)&&(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS)),-1!==r.a.wcs265BlackBrowVers.indexOf(n.a.version.major)&&i){f=!1;const i=r.a.bitrateBrowHard265Cfg[0],s=r.a.bitrateBrowHard265Cfg[1],a=r.a.bitrateBrowHard265Cfg[2];1==i&&t.curBitrate<=s&&-1!==a.indexOf(n.a.version.major)&&(f=!0),f||e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS_H265)}return-1===r.a.wcs264BlackBrowVers.indexOf(n.a.version.major)||i||(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS_H264)),o.a.log("Utils.checkWebCodec",r.a.wcs265BlackBrowNames,n.a.name),r.a.wcs265BlackBrowNames.map(t=>{-1!==n.a.name.indexOf(t)&&i&&(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_NAME_NOT_SUPPORTED_WCS_H265),o.a.log("Utils.checkWebCodec, Browser name close webcodecs!"))}),f=f&&p.isWebCodecsSupported(),1==Number(u.a._forceWebcodecs)&&(f=!0),1==Number(u.a._forceMse)&&(f=!1),f}static getDecodeMod(t,e,i){let s="mseh";return t?s="wcs":e?s="wasm":i&&(s=n.a.chrome&&n.a.version.major>104||"safari"==n.a.name?"mseh":"mses"),s}static getDMod(t,e){return"mseh"!==t&&"wcs"!==t&&"wasm"!==t&&"mses"!==t&&(t="unknow"),e=Number(e),isNaN(e)&&(e=0),"".concat(t,"-").concat(e)}static checkDMod(t,e,i){return-1===t.indexOf("&dMod=")&&(t+=-1===t.indexOf("?")?"?":"&",t+="dMod=".concat(p.getDMod(e,i))),t}static getAv1Support(t,e,i,s){let r=5;return t&&(r=e?i?2:s?3:4:1),r}static getSupportMod(t,e,i,s){let a=h.a.isMseSupportedHevc(),o=a&&n.a.chrome&&n.a.version.major>=r.a.h265MseChromeConfig[0],d=0;if(i&&(d|=64),3!==s&&4!==s||(d|=128),p.isWebCodecsSupported()&&(d|=1),t&&(d|=2),o&&(d|=8,p.isWebCodecsSupported()&&(d|=16)),a){const t=r.a.h265MseConfig[1];if(t.length>0){const e=n.a.version.major;n.a.chrome&&t.indexOf(e)>=0&&(d|=4)}}return e&&(d|=32),d}static isOpen(t,e,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=p.getCfgValue(t,e,i);return-1===r?s:100*Math.random()<r}static getCfgValue(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;e+="|",i="line"+i+":";let r=(t+="").split(","),a="",o="",n=r.length;for(let t=0;t<n;t++){let i=r[t];-1!==i.indexOf(e)?a=i.replace(e,""):-1!==i.indexOf("all|")&&(o=i.replace("all|",""))}let h=s,d=s;return""!==a&&(h=p.getLineValue(a,i,s)),""!==o&&(d=p.getLineValue(o,i,s)),h!==s?h:d!==s?d:s}static getLineValue(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=t.split("_"),r=s.length,a=i,o=i;for(let t=0;t<r;t++){let r=s[t];-1!==r.indexOf("all")?a=p.getValue(r,i):-1!==r.indexOf(e)&&(o=p.getValue(r,i))}return o!==i?o:a!==i?a:i}static getValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=e,s=t.split(":");return s.length>1&&(i=parseInt(s[1]),isNaN(i)&&(i=e)),i}static getBrowserHidden(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden}static isMseSupportedHevc(){return h.a.isMseSupportedHevc()}static isXiaomi(t){var e="mi "==(t=t.toLowerCase()).match(/mi\s/i)||"xiaomi"==t.match(/xiaomi/i)||"xiaomi"==t.match(/miuibrowser/i),i="mix "==t.match(/mix\s/i),s="redmi"==t.match(/redmi/i);return e||i||s}static urlInfoParams(t,e){return t+="&sv=".concat(2508270844,"&sdk_sid=").concat(e._sessionId,"&a_block=").concat(1===Number(e.adBlock)?1:0),p.isWupFail()&&(t+="&sf=1"),t}static isWupFail(){if(u.a.hasOwnProperty("statInfo")){let t=null;try{t=JSON.parse(u.a.statInfo)}catch(e){t=null}if(t&&t.hasOwnProperty("totalCnt")&&t.hasOwnProperty("failCnt")){const e=Number(t.totalCnt),i=Number(t.failCnt);if(e>=r.a.wupFailCnt)return i/e*100>r.a.wupFailPer}}return!1}static getBufferedLog(t){if(t){let e=t.buffered,i=[];for(let t=0;t<e.length;t++)i.push("[".concat(e.start(t),", ").concat(e.end(t),"]"));return"video.buffered=".concat(i.join(" "),", video.currentTime=").concat(t.currentTime)}return"video.buffered=null"}}function m(t){return atob(t)}Object(s.a)(p,"indateLocalStorage",{set(t,e,i){const s={value:e,expirse:new Date(i).getTime()};u.a[t]=JSON.stringify(s)},get(t){const e=JSON.parse(u.a[t]);if(null!==e){if(!(null!=e.expirse&&e.expirse<(new Date).getTime()))return e.value;delete u.a[t]}return null},update(t,e){const i=JSON.parse(u.a[t]);i&&(i.value=e,u.a[t]=JSON.stringify(i))}}),p.IntMax=2147483647,p.IntMin=-2147483647,p.UintMax=4294967295,e.b=p},function(t,e,i){"use strict";function s(t,e){let i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(let t=0;t<s;t++)r+="0";return r+t}i.r(e);let r=new class{constructor(){this.logArr=[]}getNow(){let t=0;return t=null!=typeof performance?performance.now():Date.now(),t}log(){for(var t=function(){var t=new Date,e=t.getFullYear(),i=s(t.getMonth()+1,2),r=s(t.getDate(),2),a=s(t.getHours(),2),o=s(t.getMinutes(),2),n=s(t.getSeconds(),2);return"["+"".concat(e,"-").concat(i,"-").concat(r," ").concat(a,":").concat(o,":").concat(n)+"."+s(t.getMilliseconds(),3)+"][w-webcodecs]"}(),e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i[0]=t+i[0],this.logArr.push(i)}postMessage(t,e){let i={type:t};null!=e&&(i.data=e),self.postMessage(i)}};e.default=r},function(t,e,i){"use strict";var s=i(11);e.a=s.BrowserImpl},function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return r})),i.d(e,"d",(function(){return a})),i.d(e,"e",(function(){return o})),i.d(e,"a",(function(){return n}));const s={START:1,POSTFRAME:2,RESIZE:3,CLOSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27,SET_ENHANCE:28,SET_SEGMENTTION:29,RECV_FAST_OVER:30,AV1_INIT_SEG:31,SEEK_TIME:32,SET_PLAYBACKRATE:33,SET_VOD_AV1:34},r={WEBGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,RENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23,VIDEO_ENHANCE_ERROR:24,VIDEO_ENHANCE_SUCCESS:25,ON_WCS_VIDEO_SEEK:26},a={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6,AUDIORENDERERROR:7,NOT_SUPPORT_MEDIASRTREAMTRACK:8,DISABLE_HARDWARE_ACCELERATION:9,SOFT_TURN_TO_MSE:10,WIN_PERF_INSUFFICIENT:11,RETRY_MAX_TIMES:12,DECODE_COST:13,DECODE_DTS:14,BROWSER_NOT_SUPPORTED:15,IS_PUREAUDIO:16,ANGLE_NULL:17,DECODE_ERROR_COOL:18,CHROME_H265_RENDER_INFO_EMPTY:19,IS_NOT_SUPPORT_CONFIGURE:20,IS_NOT_SUPPORT_OS:21,AUDIO_DATA_NAN:22,AUDIO_FORMAT_ERROR:23,AUDIO_DATA_MUTE:24,IS_NOT_SUPPORT_CATEGORY:25,BROWSER_VERSION_NOT_SUPPORTED_WCS:26,BROWSER_VERSION_NOT_SUPPORTED_WCS_H265:27,BROWSER_VERSION_NOT_SUPPORTED_WCS_H264:28,VOD_AV1_CLOSE_CFg:29,NOT_SUPPORT_AUDIO_SAMPLERATE:30},o={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14,VIDEO_DECODED_DELAY_SMOOTH:21,VIDEO_ENHANCE_NUMS:22,VIDEO_ENAHNCE_COST:23,VIDEO_ENHANCE_LESS30_NUMS:24,VIDEO_ENHANCE_LESS150_NUMS:25,VIDEO_ENHANCE_LESS200_NUMS:26,VIDEO_ENHANCE_LARGE200_NUMS:27,VIDEO_ENHANCE_TOTAL:28,AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES:31,VIDEO_FIRST_FRAME_DECODEC_COST:32,AUDIO_FIRST_FRAME_DECODEC_COST:33},n={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20,LAST_VIDEO_RCV_TS:29,BROWSER_PAUSE_STATUS:30}},function(t,e,i){"use strict";var s=i(0),r=i(3);let a=new class{constructor(){this.sdkVersion=2508270844,this.version=1100,this.baseSubs=10,this.uid=0,this.sGuid="",this.roomId=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66,this.p2pCooling=!1,this.flvTryToP2P=0}initUUId(){0===this.uuid&&(this.uuid=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295));let t=Number(r.a.appid);t&&(this.appid=t,s.a.warn("--- test appid "+t+" ---",this))}getAnonymouUid(){let t=Number(r.a.sdk_anonymousuid);return t||(t=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295),r.a.sdk_anonymousuid=t),t}};e.a=a},function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=109)}([function(t,e,i){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,i){"use strict";e.__esModule=!0;var s,r=(s=i(116))&&s.__esModule?s:{default:s};e.default=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,r.default)(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.default)(this,t),this.hasHeader=e,this.segments=[],this.data=null,this.totalLen=0,this.uri=0,this.hasHeader&&(this.pushUInt32(10),this.pushUInt32(this.uri),this.pushUInt16(200))}return(0,r.default)(t,[{key:"marshall",value:function(){if(0===this.segments.length)return null;this.data=new Uint8Array(this.totalLen);for(var t=0,e=0;e<this.segments.length;++e){var i=this.segments[e];this.data.set(i,t),t+=i.length}return this.hasHeader&&(this.replaceUInt32(0,this.totalLen),this.replaceUInt32(4,this.uri)),this.data}},{key:"setUri",value:function(t){this.uri=t}},{key:"replaceUInt32",value:function(t,e){new DataView(this.data.buffer).setUint32(t,e,!0)}},{key:"pushBool",value:function(t){this.pushUInt8(t?1:0)}},{key:"pushUInt8",value:function(t){var e=new Uint8Array(1);new DataView(e.buffer).setUint8(0,t),this.segments.push(e),this.totalLen++}},{key:"pushUInt16",value:function(t){var e=new Uint8Array(2);new DataView(e.buffer).setUint16(0,t,!0),this.segments.push(e),this.totalLen+=2}},{key:"pushUInt32",value:function(t){var e=new Uint8Array(4);new DataView(e.buffer).setUint32(0,t,!0),this.segments.push(e),this.totalLen+=4}},{key:"pushUInt64",value:function(t){var e=new Uint8Array(8),i=new DataView(e.buffer),s=t%4294967296,r=t/4294967296>>0;i.setUint32(0,s,!0),i.setUint32(4,r,!0),this.segments.push(e),this.totalLen+=8}},{key:"pushUint8Array",value:function(t){this.pushUInt16(t.length),this.segments.push(t),this.totalLen+=t.length}},{key:"pushUint8ArrayWithoutLen",value:function(t){this.segments.push(t),this.totalLen+=t.length}},{key:"pushUint8Array32",value:function(t){this.pushUInt32(t.length),this.segments.push(t),this.totalLen+=t.length}},{key:"pushUInt32Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt32(t[e])}},{key:"pushUInt64Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt64(t[e])}},{key:"pushUInt16Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt16(t[e])}},{key:"popObjVector",value:function(t){for(var e=this.popUInt32(),i=[],s=0;s<e;s++){var r=new t;i.push(r.unmarshall(this))}return i}},{key:"pushString",value:function(t){this.pushUInt16(t.length);for(var e=new Uint8Array(t.length),i=new DataView(e.buffer),s=0;s<t.length;++s)i.setUint8(s,t.charCodeAt(s));this.segments.push(e),this.totalLen+=t.length}},{key:"pushString32",value:function(t){this.pushUInt32(t.length);for(var e=new Uint8Array(t.length),i=new DataView(e.buffer),s=0;s<t.length;++s)i.setUint8(s,t.charCodeAt(s));this.segments.push(e),this.totalLen+=t.length}}]),t}();e.default=o},function(t,e){var i=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PLoginVideoProxyUniformly:5650690,PLoginVideoProxyUniformlyRes:5650434,PNotifyCurrentCdnStream:2739202,PNotifyCurrentStream4:2675714,PSubscribeStream3:2667266,PSubscribeStreamRes3:2667522,PStreamData3:2666754,PStopStream3:2666498,PStopStream:2560514,PPullStreamData:2694146,PResendStreamData4:2689026,PResendStreamDataFailAck:2694402,PVideoSyncSpeakerTime3:2674690,PForceConnectVideoProxy3:2685442,PVideoProxyPing3:2669570,PVideoProxyPingRes4:2683650,PNotifyMultiVideo:2746370,PLoginAndSubscribe:4097282,PLoginAndSubscribeRes:4097538,PNotifyUplinkRecvCount3:2672642,PVideoBroadcast4:2754050,PUpdateVideoConfig2:2569474,PVideoQualityStatistics:2591746,PP2pPing2:40706,PP2pPing3:41218,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,P2PKeepAliveWebrtc:3075842,P2PKeepAliveWebrtcRes:3076098,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:12316162,P2PAnswer:12316418,P2PCandidate:12316674,P2POfferReject:12316930,P2PRequestOffer:12317186,P2PVersionFailed:12317442,P2PPingOverProxy:12317698,P2PPunchBackReq:12317954,P2PPunchBackRsp:12318210,PCDNNotifyUrl:20740866,PCDNStatusReport:20741122,PCDNGetUrl:20741378,PCDNSwitchUrl:20741634,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceAudioDataV2:517411,PP2pSliceAudioDataV3:517667,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042,HuyaDelaySeiData:17920770};!function t(){if(!t.done){t.done=!0;var e=[];for(var i in s){var r=s[i];e.push({uri:r,name:i})}e.forEach((function(t){s[t.uri]=t.name}))}}(),e.default=s},function(t,e,i){var s=i(8),r=i(3),a=i(17),o=i(12),n=i(14),h=function(t,e,i){var d,l,c,u=t&h.F,p=t&h.G,m=t&h.S,_=t&h.P,f=t&h.B,g=t&h.W,S=p?r:r[e]||(r[e]={}),y=S.prototype,T=p?s:m?s[e]:(s[e]||{}).prototype;for(d in p&&(i=e),i)(l=!u&&T&&void 0!==T[d])&&n(S,d)||(c=l?T[d]:i[d],S[d]=p&&"function"!=typeof T[d]?i[d]:f&&l?a(c,s):g&&T[d]==c?function(t){var e=function(e,i,s){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,s)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):_&&"function"==typeof c?a(Function.call,c):c,_&&((S.virtual||(S.virtual={}))[d]=c,t&h.R&&y&&!y[d]&&o(y,d,c)))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},function(t,e,i){t.exports=!i(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e,i){var s=i(43)("wks"),r=i(28),a=i(8).Symbol,o="function"==typeof a;(t.exports=function(t){return s[t]||(s[t]=o&&a[t]||(o?a:r)("Symbol."+t))}).store=s},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e,i){var s=i(13),r=i(76),a=i(44),o=Object.defineProperty;e.f=i(6)?Object.defineProperty:function(t,e,i){if(s(t),e=a(e,!0),s(i),r)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){t.exports={default:i(143),__esModule:!0}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var s=i(9),r=i(29);t.exports=i(6)?function(t,e,i){return s.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var s=i(11);t.exports=function(t){if(!s(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={logger:null}},function(t,e,i){var s=i(75);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,r){return t.call(e,i,s,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var s=i(48),r=i(41);t.exports=function(t){return s(r(t))}},function(t,e,i){"use strict";function s(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+t}Object.defineProperty(e,"__esModule",{value:!0});var r=0,a={now:function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return~~t.now();if(void 0!==t.webkitNow)return~~t.webkitNow();if(void 0!==t.mozNow)return~~t.mozNow();if(void 0!==t.msNow)return~~t.msNow()}0===r&&(r=Date.now()-1);var e=Date.now()-r;return e>4294967295?(r+=4294967295,e-4294967295):e},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=null,i=(e=t?new Date(t):new Date).getFullYear(),r=s(e.getMonth()+1,2),a=s(e.getDate(),2);return i+"-"+r+"-"+a},getTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=s((i=t?new Date(t):new Date).getHours(),2),a=s(i.getMinutes(),2),o=s(i.getSeconds(),2),n=r+":"+a+":"+o;if(e){var h=s(i.getMilliseconds(),3);n+="."+h}return n},getDateTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=(i=t?new Date(t):new Date).getFullYear(),a=s(i.getMonth()+1,2),o=s(i.getDate(),2),n=s(i.getHours(),2),h=s(i.getMinutes(),2),d=s(i.getSeconds(),2),l=r+"-"+a+"-"+o+" "+n+":"+h+":"+d;if(e){var c=s(i.getMilliseconds(),3);l+="."+c}return l}};e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(59)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamName="",this.codecType=0,this.cdnBrand=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushString(this.streamName),t.pushUInt16(this.codecType),t.pushUInt16(this.cdnBrand),t.marshall()}},{key:"unmarshall",value:function(t){return this.streamName=t.popString(),this.codecType=t.popUInt16(),this.cdnBrand=t.popUInt16(),this}},{key:"getDefCodecRate",value:function(){return this.codecType>=a.default.VIDEO_264_START&&this.codecType<=a.default.VIDEO_H264_END?100*(this.codecType-a.default.VIDEO_264_START):this.codecType>=a.default.VIDEO_265_START&&this.codecType<=a.default.VIDEO_H265_END?100*(this.codecType-a.default.VIDEO_265_START):128}},{key:"text",value:function(){return this.streamName+"_"+this.codecType+"_"+this.cdnBrand}},{key:"equal",value:function(t){return!!t&&this.streamName==t.streamName&&this.codecType==t.codecType&&this.cdnBrand==t.cdnBrand}},{key:"isValidID",get:function(){return this.codecType>0}},{key:"isH264",get:function(){return this.codecType>=a.default.VIDEO_264_START&&this.codecType<=a.default.VIDEO_H264_END}},{key:"isH265",get:function(){return this.codecType>=a.default.VIDEO_265_START&&this.codecType<=a.default.VIDEO_H265_END}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={},r={setTaf:function(t){return s=t}};e.default=r,r.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},r.UserId.prototype._clone=function(){return new r.UserId},r.UserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.UserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.UserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sHuYaUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType)},r.UserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sHuYaUA=t.readString(3,!1,this.sHuYaUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType)},r.VideoGatewayProxy2VGPingReq=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingReq.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingReq},r.VideoGatewayProxy2VGPingReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingReq.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingReq.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingRsp.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingRsp},r.VideoGatewayProxy2VGPingRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.GetInfoFromVGReq=function(){this.lUid=0,this.iServiceType=0,this.iClientType=0,this.iClientIp=0,this.iTerminalType=0,this.iRequestVPType=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName="",this.lSid=0,this.vStreamName=new s.Vector(new s.STRING),this.tId=new r.UserId},r.GetInfoFromVGReq.prototype._clone=function(){return new r.GetInfoFromVGReq},r.GetInfoFromVGReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt32(1,this.iServiceType),t.writeInt32(2,this.iClientType),t.writeInt64(3,this.iClientIp),t.writeInt32(4,this.iTerminalType),t.writeInt32(5,this.iRequestVPType),t.writeBytes(6,this.sMsg),t.writeInt64(7,this.iUri),t.writeString(8,this.sProtoName),t.writeInt64(9,this.lSid),t.writeVector(10,this.vStreamName),t.writeStruct(11,this.tId)},r.GetInfoFromVGReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.iServiceType=t.readInt32(1,!1,this.iServiceType),this.iClientType=t.readInt32(2,!1,this.iClientType),this.iClientIp=t.readInt64(3,!1,this.iClientIp),this.iTerminalType=t.readInt32(4,!1,this.iTerminalType),this.iRequestVPType=t.readInt32(5,!1,this.iRequestVPType),this.sMsg=t.readBytes(6,!1,this.sMsg),this.iUri=t.readInt64(7,!1,this.iUri),this.sProtoName=t.readString(8,!1,this.sProtoName),this.lSid=t.readInt64(9,!1,this.lSid),this.vStreamName=t.readVector(10,!1,this.vStreamName),this.tId=t.readStruct(11,!1,this.tId)},r.GetInfoFromVGRsp=function(){this.lUid=0,this.ServerId=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName=""},r.GetInfoFromVGRsp.prototype._clone=function(){return new r.GetInfoFromVGRsp},r.GetInfoFromVGRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.ServerId),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.iUri),t.writeString(4,this.sProtoName)},r.GetInfoFromVGRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.ServerId=t.readInt64(1,!1,this.ServerId),this.sMsg=t.readBytes(2,!1,this.sMsg),this.iUri=t.readInt64(3,!1,this.iUri),this.sProtoName=t.readString(4,!1,this.sProtoName)},r.GetCdnTokenExReq=function(){this.sFlvUrl="",this.sStreamName="",this.iLoopTime=0,this.tId=new r.UserId,this.iAppId=66},r.GetCdnTokenExReq.prototype._clone=function(){return new r.GetCdnTokenExReq},r.GetCdnTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sFlvUrl),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iLoopTime),t.writeStruct(3,this.tId),t.writeInt32(4,this.iAppId)},r.GetCdnTokenExReq.prototype.readFrom=function(t){this.sFlvUrl=t.readString(0,!1,this.sFlvUrl),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iLoopTime=t.readInt32(2,!1,this.iLoopTime),this.tId=t.readStruct(3,!1,this.tId),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.GetCdnTokenExRsp=function(){this.sFlvToken="",this.iExpireTime=0},r.GetCdnTokenExRsp.prototype._clone=function(){return new r.GetCdnTokenExRsp},r.GetCdnTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sFlvToken),t.writeInt32(1,this.iExpireTime)},r.GetCdnTokenExRsp.prototype.readFrom=function(t){this.sFlvToken=t.readString(0,!1,this.sFlvToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.LiveScenarioType={ECommon_Live:0,EAudio_Only:1,EVideo_Only:2,ELink_Live:3},r.LimitedStreamInfo=function(){this.iVerMin=0,this.iVerMax=0,this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0},r.LimitedStreamInfo.prototype._clone=function(){return new r.LimitedStreamInfo},r.LimitedStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LimitedStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LimitedStreamInfo.prototype.writeTo=function(t){t.writeInt32(0,this.iVerMin),t.writeInt32(1,this.iVerMax),t.writeString(2,this.sCdnType),t.writeInt32(3,this.iIsMaster),t.writeInt64(4,this.lChannelId),t.writeInt64(5,this.lSubChannelId),t.writeInt64(6,this.lPresenterUid),t.writeString(7,this.sStreamName),t.writeString(8,this.sFlvUrl),t.writeString(9,this.sFlvUrlSuffix),t.writeString(10,this.sFlvAntiCode),t.writeString(11,this.sHlsUrl),t.writeString(12,this.sHlsUrlSuffix),t.writeString(13,this.sHlsAntiCode),t.writeInt32(14,this.iLineIndex),t.writeInt32(15,this.iIsMultiStream),t.writeInt32(16,this.iPCPriorityRate),t.writeInt32(17,this.iWebPriorityRate),t.writeInt32(18,this.iMobilePriorityRate),t.writeVector(19,this.vFlvIPList),t.writeInt32(20,this.iIsP2PSupport),t.writeString(21,this.sP2pUrl),t.writeString(22,this.sP2pUrlSuffix),t.writeString(23,this.sP2pAntiCode),t.writeInt64(24,this.lFreeFlag)},r.LimitedStreamInfo.prototype.readFrom=function(t){this.iVerMin=t.readInt32(0,!1,this.iVerMin),this.iVerMax=t.readInt32(1,!1,this.iVerMax),this.sCdnType=t.readString(2,!1,this.sCdnType),this.iIsMaster=t.readInt32(3,!1,this.iIsMaster),this.lChannelId=t.readInt64(4,!1,this.lChannelId),this.lSubChannelId=t.readInt64(5,!1,this.lSubChannelId),this.lPresenterUid=t.readInt64(6,!1,this.lPresenterUid),this.sStreamName=t.readString(7,!1,this.sStreamName),this.sFlvUrl=t.readString(8,!1,this.sFlvUrl),this.sFlvUrlSuffix=t.readString(9,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=t.readString(10,!1,this.sFlvAntiCode),this.sHlsUrl=t.readString(11,!1,this.sHlsUrl),this.sHlsUrlSuffix=t.readString(12,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=t.readString(13,!1,this.sHlsAntiCode),this.iLineIndex=t.readInt32(14,!1,this.iLineIndex),this.iIsMultiStream=t.readInt32(15,!1,this.iIsMultiStream),this.iPCPriorityRate=t.readInt32(16,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(17,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(18,!1,this.iMobilePriorityRate),this.vFlvIPList=t.readVector(19,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(20,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(21,!1,this.sP2pUrl),this.sP2pUrlSuffix=t.readString(22,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=t.readString(23,!1,this.sP2pAntiCode),this.lFreeFlag=t.readInt64(24,!1,this.lFreeFlag)},r.ClassifiedStreamInfoPack=function(){this.iLiveScenarioType=0,this.vStreamInfo=new s.Vector(new r.LimitedStreamInfo),this.vCdnList=new s.Vector(new s.STRING),this.lLiveId=0,this.sLinkGroupId="",this.mStreamRatioWeb=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioPC=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioMobile=new s.Map(new s.STRING,new s.INT32)},r.ClassifiedStreamInfoPack.prototype._clone=function(){return new r.ClassifiedStreamInfoPack},r.ClassifiedStreamInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClassifiedStreamInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClassifiedStreamInfoPack.prototype.writeTo=function(t){t.writeInt32(0,this.iLiveScenarioType),t.writeVector(1,this.vStreamInfo),t.writeVector(2,this.vCdnList),t.writeInt64(3,this.lLiveId),t.writeString(4,this.sLinkGroupId),t.writeMap(5,this.mStreamRatioWeb),t.writeMap(6,this.mStreamRatioPC),t.writeMap(7,this.mStreamRatioMobile)},r.ClassifiedStreamInfoPack.prototype.readFrom=function(t){this.iLiveScenarioType=t.readInt32(0,!1,this.iLiveScenarioType),this.vStreamInfo=t.readVector(1,!1,this.vStreamInfo),this.vCdnList=t.readVector(2,!1,this.vCdnList),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.sLinkGroupId=t.readString(4,!1,this.sLinkGroupId),this.mStreamRatioWeb=t.readMap(5,!1,this.mStreamRatioWeb),this.mStreamRatioPC=t.readMap(6,!1,this.mStreamRatioPC),this.mStreamRatioMobile=t.readMap(7,!1,this.mStreamRatioMobile)},r.LivingStreamInfoNotice=function(){this.lPresenterUid=0,this.lLiveId=0,this.mStreamInfo=new s.Map(new s.INT32,new r.ClassifiedStreamInfoPack)},r.LivingStreamInfoNotice.prototype._clone=function(){return new r.LivingStreamInfoNotice},r.LivingStreamInfoNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamInfoNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamInfoNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt64(1,this.lLiveId),t.writeMap(2,this.mStreamInfo)},r.LivingStreamInfoNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.mStreamInfo=t.readMap(2,!1,this.mStreamInfo)},r.LivingStreamEndNotice=function(){this.sStreamName="",this.sCdnType="",this.iLineIndex=0,this.lLiveId=0,this.iLiveScenarioType=0},r.LivingStreamEndNotice.prototype._clone=function(){return new r.LivingStreamEndNotice},r.LivingStreamEndNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamEndNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamEndNotice.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeString(1,this.sCdnType),t.writeInt32(2,this.iLineIndex),t.writeInt64(3,this.lLiveId),t.writeInt32(4,this.iLiveScenarioType)},r.LivingStreamEndNotice.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.sCdnType=t.readString(1,!1,this.sCdnType),this.iLineIndex=t.readInt32(2,!1,this.iLineIndex),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.iLiveScenarioType=t.readInt32(4,!1,this.iLiveScenarioType)},r.GetLivingStreamInfoReq=function(){this.tId=new r.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource=""},r.GetLivingStreamInfoReq.prototype._clone=function(){return new r.GetLivingStreamInfoReq},r.GetLivingStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopSid),t.writeInt64(2,this.lSubSid),t.writeInt64(3,this.lPresenterUid),t.writeString(4,this.sTraceSource)},r.GetLivingStreamInfoReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopSid=t.readInt64(1,!1,this.lTopSid),this.lSubSid=t.readInt64(2,!1,this.lSubSid),this.lPresenterUid=t.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=t.readString(4,!1,this.sTraceSource)},r.GetLivingStreamInfoRsp=function(){this.bIsLiving=0,this.tNotice=new r.LivingStreamInfoNotice,this.bIsSelfLiving=0},r.GetLivingStreamInfoRsp.prototype._clone=function(){return new r.GetLivingStreamInfoRsp},r.GetLivingStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.bIsLiving),t.writeStruct(1,this.tNotice),t.writeInt32(2,this.bIsSelfLiving)},r.GetLivingStreamInfoRsp.prototype.readFrom=function(t){this.bIsLiving=t.readInt32(0,!1,this.bIsLiving),this.tNotice=t.readStruct(1,!1,this.tNotice),this.bIsSelfLiving=t.readInt32(2,!1,this.bIsSelfLiving)},r.VideoClientReportReq=function(){this.iReportType=0,this.sReportString="",this.sMsg=new s.BinBuffer,this.lUid=0},r.VideoClientReportReq.prototype._clone=function(){return new r.VideoClientReportReq},r.VideoClientReportReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoClientReportReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoClientReportReq.prototype.writeTo=function(t){t.writeInt32(0,this.iReportType),t.writeString(1,this.sReportString),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.lUid)},r.VideoClientReportReq.prototype.readFrom=function(t){this.iReportType=t.readInt32(0,!1,this.iReportType),this.sReportString=t.readString(1,!1,this.sReportString),this.sMsg=t.readBytes(2,!1,this.sMsg),this.lUid=t.readInt64(3,!1,this.lUid)},r.LiveMeetingSyncNotice=function(){this.tStat=new r.MeetingStat,this.vSeats=new s.Vector(new r.MeetingSeat),this.iVersion=0,this.sMessage=""},r.LiveMeetingSyncNotice.prototype._clone=function(){return new r.LiveMeetingSyncNotice},r.LiveMeetingSyncNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LiveMeetingSyncNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LiveMeetingSyncNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tStat),t.writeVector(1,this.vSeats),t.writeInt32(2,this.iVersion),t.writeString(3,this.sMessage)},r.LiveMeetingSyncNotice.prototype.readFrom=function(t){this.tStat=t.readStruct(0,!1,this.tStat),this.vSeats=t.readVector(1,!1,this.vSeats),this.iVersion=t.readInt32(2,!1,this.iVersion),this.sMessage=t.readString(3,!1,this.sMessage)},r.MeetingStat=function(){this.lPresenterUid=0,this.sPresenterNick="",this.sPresenterAvatarUrl="",this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iVersion=0,this.iCurAction=0,this.sPassword="",this.lSessionId=0,this.vApplyList=new s.Vector(new r.ApplyUser),this.iState=0,this.iSilence=0,this.iActiveTime=0,this.iLastSyncTime=0,this.mpUserSession=new s.Map(new s.INT64,new s.STRING),this.iBeginTime=0,this.iPresenterGender=0,this.tTransferRoom=new r.TransferLiveRoomState,this.iMode=0,this.iModeV2=0,this.iOfficialType=0},r.MeetingStat.prototype._clone=function(){return new r.MeetingStat},r.MeetingStat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingStat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingStat.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeString(1,this.sPresenterNick),t.writeString(2,this.sPresenterAvatarUrl),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iVersion),t.writeInt32(6,this.iCurAction),t.writeString(7,this.sPassword),t.writeInt64(8,this.lSessionId),t.writeVector(9,this.vApplyList),t.writeInt32(10,this.iState),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iActiveTime),t.writeInt32(13,this.iLastSyncTime),t.writeMap(14,this.mpUserSession),t.writeInt32(15,this.iBeginTime),t.writeInt32(16,this.iPresenterGender),t.writeStruct(17,this.tTransferRoom),t.writeInt32(18,this.iMode),t.writeInt32(19,this.iModeV2),t.writeInt32(20,this.iOfficialType)},r.MeetingStat.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.sPresenterNick=t.readString(1,!1,this.sPresenterNick),this.sPresenterAvatarUrl=t.readString(2,!1,this.sPresenterAvatarUrl),this.mpContext=t.readMap(4,!1,this.mpContext),this.iVersion=t.readInt32(5,!1,this.iVersion),this.iCurAction=t.readInt32(6,!1,this.iCurAction),this.sPassword=t.readString(7,!1,this.sPassword),this.lSessionId=t.readInt64(8,!1,this.lSessionId),this.vApplyList=t.readVector(9,!1,this.vApplyList),this.iState=t.readInt32(10,!1,this.iState),this.iSilence=t.readInt32(11,!1,this.iSilence),this.iActiveTime=t.readInt32(12,!1,this.iActiveTime),this.iLastSyncTime=t.readInt32(13,!1,this.iLastSyncTime),this.mpUserSession=t.readMap(14,!1,this.mpUserSession),this.iBeginTime=t.readInt32(15,!1,this.iBeginTime),this.iPresenterGender=t.readInt32(16,!1,this.iPresenterGender),this.tTransferRoom=t.readStruct(17,!1,this.tTransferRoom),this.iMode=t.readInt32(18,!1,this.iMode),this.iModeV2=t.readInt32(19,!1,this.iModeV2),this.iOfficialType=t.readInt32(20,!1,this.iOfficialType)},r.MeetingSeat=function(){this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iPos=0,this.iLocked=0,this.lUid=0,this.sNick="",this.sAvatarUrl="",this.iMute=0,this.iVersion=0,this.iCurAction=0,this.iActiveTime=0,this.iSilence=0,this.iGender=0,this.lOfferSeatTimeStamp=0,this.iSilenceTime=0,this.iMuteTime=0,this.iSeatType=0,this.iSeatTypeV2=0,this.sSeatUrl="",this.sCharm="",this.sName="",this.sSourceUrl="",this.sRippleUrl=""},r.MeetingSeat.prototype._clone=function(){return new r.MeetingSeat},r.MeetingSeat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingSeat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingSeat.prototype.writeTo=function(t){t.writeMap(0,this.mpContext),t.writeInt32(1,this.iPos),t.writeInt32(2,this.iLocked),t.writeInt64(3,this.lUid),t.writeString(4,this.sNick),t.writeString(5,this.sAvatarUrl),t.writeInt32(7,this.iMute),t.writeInt32(8,this.iVersion),t.writeInt32(9,this.iCurAction),t.writeInt32(10,this.iActiveTime),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iGender),t.writeInt64(13,this.lOfferSeatTimeStamp),t.writeInt32(14,this.iSilenceTime),t.writeInt32(15,this.iMuteTime),t.writeInt32(16,this.iSeatType),t.writeInt32(17,this.iSeatTypeV2),t.writeString(18,this.sSeatUrl),t.writeString(19,this.sCharm),t.writeString(20,this.sName),t.writeString(21,this.sSourceUrl),t.writeString(22,this.sRippleUrl)},r.MeetingSeat.prototype.readFrom=function(t){this.mpContext=t.readMap(0,!1,this.mpContext),this.iPos=t.readInt32(1,!1,this.iPos),this.iLocked=t.readInt32(2,!1,this.iLocked),this.lUid=t.readInt64(3,!1,this.lUid),this.sNick=t.readString(4,!1,this.sNick),this.sAvatarUrl=t.readString(5,!1,this.sAvatarUrl),this.iMute=t.readInt32(7,!1,this.iMute),this.iVersion=t.readInt32(8,!1,this.iVersion),this.iCurAction=t.readInt32(9,!1,this.iCurAction),this.iActiveTime=t.readInt32(10,!1,this.iActiveTime),this.iSilence=t.readInt32(11,!1,this.iSilence),this.iGender=t.readInt32(12,!1,this.iGender),this.lOfferSeatTimeStamp=t.readInt64(13,!1,this.lOfferSeatTimeStamp),this.iSilenceTime=t.readInt32(14,!1,this.iSilenceTime),this.iMuteTime=t.readInt32(15,!1,this.iMuteTime),this.iSeatType=t.readInt32(16,!1,this.iSeatType),this.iSeatTypeV2=t.readInt32(17,!1,this.iSeatTypeV2),this.sSeatUrl=t.readString(18,!1,this.sSeatUrl),this.sCharm=t.readString(19,!1,this.sCharm),this.sName=t.readString(20,!1,this.sName),this.sSourceUrl=t.readString(21,!1,this.sSourceUrl),this.sRippleUrl=t.readString(22,!1,this.sRippleUrl)},r.ApplyUser=function(){this.lUid=0,this.sNick="",this.sAvatarUrl="",this.lActiveTime=0,this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iGender=0,this.sStreamName="",this.iSeatType=0},r.ApplyUser.prototype._clone=function(){return new r.ApplyUser},r.ApplyUser.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ApplyUser.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ApplyUser.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sNick),t.writeString(2,this.sAvatarUrl),t.writeInt64(3,this.lActiveTime),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iGender),t.writeString(6,this.sStreamName),t.writeInt32(7,this.iSeatType)},r.ApplyUser.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sNick=t.readString(1,!1,this.sNick),this.sAvatarUrl=t.readString(2,!1,this.sAvatarUrl),this.lActiveTime=t.readInt64(3,!1,this.lActiveTime),this.mpContext=t.readMap(4,!1,this.mpContext),this.iGender=t.readInt32(5,!1,this.iGender),this.sStreamName=t.readString(6,!1,this.sStreamName),this.iSeatType=t.readInt32(7,!1,this.iSeatType)},r.TransferLiveRoomState=function(){this.lTargetUid=0,this.iInviteTime=0,this.iTokeOverTime=0,this.iBeginLiveTime=0,this.lNewLiveId=0,this.iInviteExpire=0,this.iState=0,this.iResult=0,this.iSuccessTime=0,this.sTargetNick=""},r.TransferLiveRoomState.prototype._clone=function(){return new r.TransferLiveRoomState},r.TransferLiveRoomState.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.TransferLiveRoomState.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.TransferLiveRoomState.prototype.writeTo=function(t){t.writeInt64(0,this.lTargetUid),t.writeInt32(1,this.iInviteTime),t.writeInt32(2,this.iTokeOverTime),t.writeInt32(3,this.iBeginLiveTime),t.writeInt64(4,this.lNewLiveId),t.writeInt32(5,this.iInviteExpire),t.writeInt32(6,this.iState),t.writeInt32(7,this.iResult),t.writeInt32(8,this.iSuccessTime),t.writeString(9,this.sTargetNick)},r.TransferLiveRoomState.prototype.readFrom=function(t){this.lTargetUid=t.readInt64(0,!1,this.lTargetUid),this.iInviteTime=t.readInt32(1,!1,this.iInviteTime),this.iTokeOverTime=t.readInt32(2,!1,this.iTokeOverTime),this.iBeginLiveTime=t.readInt32(3,!1,this.iBeginLiveTime),this.lNewLiveId=t.readInt64(4,!1,this.lNewLiveId),this.iInviteExpire=t.readInt32(5,!1,this.iInviteExpire),this.iState=t.readInt32(6,!1,this.iState),this.iResult=t.readInt32(7,!1,this.iResult),this.iSuccessTime=t.readInt32(8,!1,this.iSuccessTime),this.sTargetNick=t.readString(9,!1,this.sTargetNick)},r.GetP2PStreamInfoReq=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sClientUA=""},r.GetP2PStreamInfoReq.prototype._clone=function(){return new r.GetP2PStreamInfoReq},r.GetP2PStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType),t.writeString(3,this.sClientUA)},r.GetP2PStreamInfoReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType),this.sClientUA=t.readString(3,!1,this.sClientUA)},r.GetP2PStreamInfoRsp=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sP2PToken="",this.iP2PExpireTime=0,this.sP2PUrl="",this.sCodecType="",this.sCdnBrand="",this.mpOption=new s.Map(new s.INT16,new s.INT64),this.line=0},r.GetP2PStreamInfoRsp.prototype._clone=function(){return new r.GetP2PStreamInfoRsp},r.GetP2PStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType),t.writeString(3,this.sP2PToken),t.writeInt32(4,this.iP2PExpireTime),t.writeString(5,this.sP2PUrl),t.writeString(6,this.sCodecType),t.writeString(7,this.sCdnBrand),t.writeMap(8,this.mpOption),t.writeUInt8(9,this.line)},r.GetP2PStreamInfoRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType),this.sP2PToken=t.readString(3,!1,this.sP2PToken),this.iP2PExpireTime=t.readInt32(4,!1,this.iP2PExpireTime),this.sP2PUrl=t.readString(5,!1,this.sP2PUrl),this.sCodecType=t.readString(6,!1,this.sCodecType),this.sCdnBrand=t.readString(7,!1,this.sCdnBrand),this.mpOption=t.readMap(8,!1,this.mpOption),this.line=t.readUInt8(9,!1,this.line)},r.GetP2PStreamTokenExReq=function(){this.sStreamName="",this.iLoopTime=0},r.GetP2PStreamTokenExReq.prototype._clone=function(){return new r.GetP2PStreamTokenExReq},r.GetP2PStreamTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeInt32(1,this.iLoopTime)},r.GetP2PStreamTokenExReq.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.iLoopTime=t.readInt32(1,!1,this.iLoopTime)},r.GetP2PStreamTokenExRsp=function(){this.sP2PToken="",this.iExpireTime=0},r.GetP2PStreamTokenExRsp.prototype._clone=function(){return new r.GetP2PStreamTokenExRsp},r.GetP2PStreamTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sP2PToken),t.writeInt32(1,this.iExpireTime)},r.GetP2PStreamTokenExRsp.prototype.readFrom=function(t){this.sP2PToken=t.readString(0,!1,this.sP2PToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.HttpDnsItem=function(){this.vIp=new s.Vector(new s.STRING),this.iExpireTime=0,this.vIpv6=new s.Vector(new s.STRING)},r.HttpDnsItem.prototype._clone=function(){return new r.HttpDnsItem},r.HttpDnsItem.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.HttpDnsItem.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.HttpDnsItem.prototype.writeTo=function(t){t.writeVector(0,this.vIp),t.writeInt64(1,this.iExpireTime),t.writeVector(2,this.vIpv6)},r.HttpDnsItem.prototype.readFrom=function(t){this.vIp=t.readVector(0,!1,this.vIp),this.iExpireTime=t.readInt64(1,!1,this.iExpireTime),this.vIpv6=t.readVector(2,!1,this.vIpv6)},r.QueryHttpDnsReq=function(){this.lUid=0,this.sUA="",this.vDomain=new s.Vector(new s.STRING),this.sAppSrc=""},r.QueryHttpDnsReq.prototype._clone=function(){return new r.QueryHttpDnsReq},r.QueryHttpDnsReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sUA),t.writeVector(2,this.vDomain),t.writeString(3,this.sAppSrc)},r.QueryHttpDnsReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sUA=t.readString(1,!1,this.sUA),this.vDomain=t.readVector(2,!1,this.vDomain),this.sAppSrc=t.readString(3,!1,this.sAppSrc)},r.QueryHttpDnsRsp=function(){this.mDomain2Ip=new s.Map(new s.STRING,new r.HttpDnsItem)},r.QueryHttpDnsRsp.prototype._clone=function(){return new r.QueryHttpDnsRsp},r.QueryHttpDnsRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsRsp.prototype.writeTo=function(t){t.writeMap(0,this.mDomain2Ip)},r.QueryHttpDnsRsp.prototype.readFrom=function(t){this.mDomain2Ip=t.readMap(0,!1,this.mDomain2Ip)},r.WSTimeSyncReq=function(){this.sGuid="",this.lClientTime=0},r.WSTimeSyncReq.prototype._clone=function(){return new r.WSTimeSyncReq},r.WSTimeSyncReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncReq.prototype.writeTo=function(t){t.writeString(0,this.sGuid),t.writeInt64(1,this.lClientTime)},r.WSTimeSyncReq.prototype.readFrom=function(t){this.sGuid=t.readString(0,!1,this.sGuid),this.lClientTime=t.readInt64(1,!1,this.lClientTime)},r.WSTimeSyncRsp=function(){this.lServerTime=0},r.WSTimeSyncRsp.prototype._clone=function(){return new r.WSTimeSyncRsp},r.WSTimeSyncRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lServerTime)},r.WSTimeSyncRsp.prototype.readFrom=function(t){this.lServerTime=t.readInt64(0,!1,this.lServerTime)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iTokenType=0,this.iAppid=0,this.bAnonymous=0,this.sStrUid=""},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaUserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaUserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType),t.writeInt32(6,this.iAppid),t.writeInt32(7,this.bAnonymous),t.writeString(8,this.sStrUid)},r.MediaUserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sUA=t.readString(3,!1,this.sUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType),this.iAppid=t.readInt32(6,!1,this.iAppid),this.bAnonymous=t.readInt32(7,!1,this.bAnonymous),this.sStrUid=t.readString(8,!1,this.sStrUid)},r.LoginVerifyReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.LoginVerifyReq.prototype._clone=function(){return new r.LoginVerifyReq},r.LoginVerifyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt32(1,this.iCookieDeadTime)},r.LoginVerifyReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.iCookieDeadTime=t.readInt32(1,!1,this.iCookieDeadTime)},r.LoginVerifyRsp=function(){this.iResCode=0,this.lUid=0,this.sCookie="",this.sUid="",this.iAppId=0},r.LoginVerifyRsp.prototype._clone=function(){return new r.LoginVerifyRsp},r.LoginVerifyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeInt64(1,this.lUid),t.writeString(2,this.sCookie),t.writeString(3,this.sUid),t.writeInt32(4,this.iAppId)},r.LoginVerifyRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.lUid=t.readInt64(1,!1,this.lUid),this.sCookie=t.readString(2,!1,this.sCookie),this.sUid=t.readString(3,!1,this.sUid),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.JoinMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupReq.prototype._clone=function(){return new r.JoinMediaGroupReq},r.JoinMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.JoinMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.JoinMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupRsp.prototype._clone=function(){return new r.JoinMediaGroupRsp},r.JoinMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.JoinMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.QuitMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupReq.prototype._clone=function(){return new r.QuitMediaGroupReq},r.QuitMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.QuitMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.QuitMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupRsp.prototype._clone=function(){return new r.QuitMediaGroupRsp},r.QuitMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.QuitMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.ikk=1,r.skk="123",r.eIType={k4AM:10001,k6AM:10002},r.EM_PCDN_MODE={E_PcdnMode_Min:0,E_PcdnMode_P2pHttpSubstream:1,E_PcdnMode_P2pOutsideSdkSubstream:2,E_PcdnMode_FlvHttpFullstream:3,E_PcdnMode_FlvOutsideSdkFullstream:4,E_PcdnMode_Max:255,E_PcdnVodMode_Http302:21},r.EM_BUSI_TYPE={E_BusiType_Min:0,E_BusiType_Live:1,E_BusiType_Max:255,E_BusiType_Vod:2},r.EM_CLINET_TYPE={E_CLIENT_MIN:0,E_CLIENT_PC:1,E_CLIENT_ADR:2,E_CLIENT_IOS:3,E_CLIENT_WEB:4,E_CLIENT_MAX:255,E_CLIENT_NFTV:5},r.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP={E_SUCCESS:0,E_HYGW_ERR:1,E_PCDNGW_40X:2,E_PCDNGW_50X:3,E_PCDNGW_TIO:4,E_PCDNGW_RSPERR:5,E_CLIREQ_ERR:6,E_PCDN_OFF:7,E_LIMIT_FLOWS:8},r.MyReq=function(){this.name="",this.opt="",this.mMap=new s.Map(new s.STRING,new s.STRING)},r.MyReq.prototype._clone=function(){return new r.MyReq},r.MyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyReq.prototype.writeTo=function(t){t.writeString(0,this.name),t.writeString(1,this.opt),t.writeMap(2,this.mMap)},r.MyReq.prototype.readFrom=function(t){this.name=t.readString(0,!1,this.name),this.opt=t.readString(1,!1,this.opt),this.mMap=t.readMap(2,!1,this.mMap)},r.MyRsp=function(){this.value=0,this.origin=new r.MyReq,this.types=new s.Vector(new s.INT32),this.eType=0},r.MyRsp.prototype._clone=function(){return new r.MyRsp},r.MyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.value),t.writeStruct(1,this.origin),t.writeVector(2,this.types),t.writeInt32(3,this.eType)},r.MyRsp.prototype.readFrom=function(t){this.value=t.readInt32(0,!1,this.value),this.origin=t.readStruct(1,!1,this.origin),this.types=t.readVector(2,!1,this.types),this.eType=t.readInt32(3,!1,this.eType)},r.ClientQueryPcdnScheduleReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.vPcdnMode=new s.Vector(new s.INT32),this.iBusiType=0,this.sStreamName="",this.mPcdnModeCliSupportPcdns=new s.Map(new s.INT32,new s.Vector(new s.STRING)),this.vSupportMode=new s.Vector(new s.INT32),this.sUserAgent="",this.iRatio=0,this.sCodec=""},r.ClientQueryPcdnScheduleReq.prototype._clone=function(){return new r.ClientQueryPcdnScheduleReq},r.ClientQueryPcdnScheduleReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeInt32(5,this.iCliType),t.writeInt64(6,this.lBucketPara),t.writeVector(30,this.vPcdnMode),t.writeInt32(31,this.iBusiType),t.writeString(32,this.sStreamName),t.writeMap(100,this.mPcdnModeCliSupportPcdns),t.writeVector(101,this.vSupportMode),t.writeString(102,this.sUserAgent),t.writeInt32(103,this.iRatio),t.writeString(104,this.sCodec)},r.ClientQueryPcdnScheduleReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.iCliType=t.readInt32(5,!1,this.iCliType),this.lBucketPara=t.readInt64(6,!1,this.lBucketPara),this.vPcdnMode=t.readVector(30,!1,this.vPcdnMode),this.iBusiType=t.readInt32(31,!1,this.iBusiType),this.sStreamName=t.readString(32,!1,this.sStreamName),this.mPcdnModeCliSupportPcdns=t.readMap(100,!1,this.mPcdnModeCliSupportPcdns),this.vSupportMode=t.readVector(101,!1,this.vSupportMode),this.sUserAgent=t.readString(102,!1,this.sUserAgent),this.iRatio=t.readInt32(103,!1,this.iRatio),this.sCodec=t.readString(104,!1,this.sCodec)},r.ClientQueryPcdnScheduleRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.mPcdnModeSwitch=new s.Map(new s.INT32,new s.INT32),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.mPcdnModePcdnName=new s.Map(new s.INT32,new s.STRING)},r.ClientQueryPcdnScheduleRsp.prototype._clone=function(){return new r.ClientQueryPcdnScheduleRsp},r.ClientQueryPcdnScheduleRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeMap(10,this.mPcdnModeSwitch),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeMap(200,this.mPcdnModePcdnName)},r.ClientQueryPcdnScheduleRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.mPcdnModeSwitch=t.readMap(10,!1,this.mPcdnModeSwitch),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.mPcdnModePcdnName=t.readMap(200,!1,this.mPcdnModePcdnName)},r.ClientGetStunAndPcdnProxyReq=function(){this.lReqTs=0,this.lUid=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.curPcdnName="",this.supportV6=0,this.retryCnt=0,this.sUserAgent="",this.iRatio=0,this.sCodec="",this.natType=9,this.recentMinutes=0,this.recentMiniPcdnFailedTimes=new s.Map(new s.INT32,new s.INT32),this.hotReqFlag=0,this.isSupportMiniPcdn=0,this.extMap=new s.Map(new s.STRING,new s.STRING)},r.ClientGetStunAndPcdnProxyReq.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyReq},r.ClientGetStunAndPcdnProxyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sStreamname),t.writeInt32(3,this.iBaseSubs),t.writeVector(4,this.vSub),t.writeString(5,this.sGuid),t.writeInt64(6,this.lAnchorUid),t.writeInt32(7,this.iCdnLine),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeString(11,this.curPcdnName),t.writeInt32(12,this.supportV6),t.writeInt32(13,this.retryCnt),t.writeString(14,this.sUserAgent),t.writeInt32(15,this.iRatio),t.writeString(16,this.sCodec),t.writeInt32(17,this.natType),t.writeInt32(18,this.recentMinutes),t.writeMap(19,this.recentMiniPcdnFailedTimes),t.writeInt32(20,this.hotReqFlag),t.writeInt32(21,this.isSupportMiniPcdn),t.writeMap(22,this.extMap)},r.ClientGetStunAndPcdnProxyReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sStreamname=t.readString(2,!1,this.sStreamname),this.iBaseSubs=t.readInt32(3,!1,this.iBaseSubs),this.vSub=t.readVector(4,!1,this.vSub),this.sGuid=t.readString(5,!1,this.sGuid),this.lAnchorUid=t.readInt64(6,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(7,!1,this.iCdnLine),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.curPcdnName=t.readString(11,!1,this.curPcdnName),this.supportV6=t.readInt32(12,!1,this.supportV6),this.retryCnt=t.readInt32(13,!1,this.retryCnt),this.sUserAgent=t.readString(14,!1,this.sUserAgent),this.iRatio=t.readInt32(15,!1,this.iRatio),this.sCodec=t.readString(16,!1,this.sCodec),this.natType=t.readInt32(17,!1,this.natType),this.recentMinutes=t.readInt32(18,!1,this.recentMinutes),this.recentMiniPcdnFailedTimes=t.readMap(19,!1,this.recentMiniPcdnFailedTimes),this.hotReqFlag=t.readInt32(20,!1,this.hotReqFlag),this.isSupportMiniPcdn=t.readInt32(21,!1,this.isSupportMiniPcdn),this.extMap=t.readMap(22,!1,this.extMap)},r.PCdnProxyUrl=function(){this.sProtocol="",this.vUrl=new s.Vector(new s.STRING),this.iStatusPcdn=0,this.iPcdnThresholdHotDegreeIn=-1,this.iPcdnThresholdHotDegreeKick=-1,this.iPcdnNowHotDegree=-1,this.iPcdnNowPullstreamUcnt=-1,this.iPcdnNowGetpcdnUcnt=-1},r.PCdnProxyUrl.prototype._clone=function(){return new r.PCdnProxyUrl},r.PCdnProxyUrl.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.PCdnProxyUrl.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.PCdnProxyUrl.prototype.writeTo=function(t){t.writeString(0,this.sProtocol),t.writeVector(2,this.vUrl),t.writeInt32(3,this.iStatusPcdn),t.writeInt32(10,this.iPcdnThresholdHotDegreeIn),t.writeInt32(11,this.iPcdnThresholdHotDegreeKick),t.writeInt32(12,this.iPcdnNowHotDegree),t.writeInt32(13,this.iPcdnNowPullstreamUcnt),t.writeInt32(14,this.iPcdnNowGetpcdnUcnt)},r.PCdnProxyUrl.prototype.readFrom=function(t){this.sProtocol=t.readString(0,!1,this.sProtocol),this.vUrl=t.readVector(2,!1,this.vUrl),this.iStatusPcdn=t.readInt32(3,!1,this.iStatusPcdn),this.iPcdnThresholdHotDegreeIn=t.readInt32(10,!1,this.iPcdnThresholdHotDegreeIn),this.iPcdnThresholdHotDegreeKick=t.readInt32(11,!1,this.iPcdnThresholdHotDegreeKick),this.iPcdnNowHotDegree=t.readInt32(12,!1,this.iPcdnNowHotDegree),this.iPcdnNowPullstreamUcnt=t.readInt32(13,!1,this.iPcdnNowPullstreamUcnt),this.iPcdnNowGetpcdnUcnt=t.readInt32(14,!1,this.iPcdnNowGetpcdnUcnt)},r.ClientGetStunAndPcdnProxyRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamname="",this.iErrCode=0,this.iBaseSubs=0,this.mSubToPullStreamUrl=new s.Map(new s.INT32,new s.Map(new s.STRING,new r.PCdnProxyUrl)),this.cliProv="",this.cliIsp="",this.pcdnName="",this.iCdnLine=0,this.sPcdnIsp="",this.sPcdnArea="",this.requestGap=0,this.subIndexPcdnName=new s.Map(new s.INT32,new s.STRING),this.minipcdnFailedTimesLimit=3,this.expectPcdnNane="",this.extMap=new s.Map(new s.STRING,new s.STRING)},r.ClientGetStunAndPcdnProxyRsp.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyRsp},r.ClientGetStunAndPcdnProxyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sStreamname),t.writeInt32(4,this.iErrCode),t.writeInt32(5,this.iBaseSubs),t.writeMap(12,this.mSubToPullStreamUrl),t.writeString(13,this.cliProv),t.writeString(14,this.cliIsp),t.writeString(15,this.pcdnName),t.writeInt32(100,this.iCdnLine),t.writeString(200,this.sPcdnIsp),t.writeString(201,this.sPcdnArea),t.writeInt32(210,this.requestGap),t.writeMap(211,this.subIndexPcdnName),t.writeInt32(212,this.minipcdnFailedTimesLimit),t.writeString(213,this.expectPcdnNane),t.writeMap(214,this.extMap)},r.ClientGetStunAndPcdnProxyRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sStreamname=t.readString(3,!1,this.sStreamname),this.iErrCode=t.readInt32(4,!1,this.iErrCode),this.iBaseSubs=t.readInt32(5,!1,this.iBaseSubs),this.mSubToPullStreamUrl=t.readMap(12,!1,this.mSubToPullStreamUrl),this.cliProv=t.readString(13,!1,this.cliProv),this.cliIsp=t.readString(14,!1,this.cliIsp),this.pcdnName=t.readString(15,!1,this.pcdnName),this.iCdnLine=t.readInt32(100,!1,this.iCdnLine),this.sPcdnIsp=t.readString(200,!1,this.sPcdnIsp),this.sPcdnArea=t.readString(201,!1,this.sPcdnArea),this.requestGap=t.readInt32(210,!1,this.requestGap),this.subIndexPcdnName=t.readMap(211,!1,this.subIndexPcdnName),this.minipcdnFailedTimesLimit=t.readInt32(212,!1,this.minipcdnFailedTimesLimit),this.expectPcdnNane=t.readString(213,!1,this.expectPcdnNane),this.extMap=t.readMap(214,!1,this.extMap)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamname),t.writeInt32(6,this.iBaseSubs),t.writeVector(7,this.vSub),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamname=t.readString(5,!1,this.sStreamname),this.iBaseSubs=t.readInt32(6,!1,this.iBaseSubs),this.vSub=t.readVector(7,!1,this.vSub),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.mP2pSubstreamUrl=new s.Map(new s.INT32,new s.STRING),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamname=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeMap(11,this.mP2pSubstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamname)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.mP2pSubstreamUrl=t.readMap(11,!1,this.mP2pSubstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamname=t.readString(102,!1,this.sStreamname)},r.ClientGetPcdnFlvHttpFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.lBucketPara=0,this.iBusiType=0,this.curPcdnName="",this.supportV6=0,this.sUserAgent=""},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvHttpFullstreamInfoReq},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeInt32(5,this.iCliType),t.writeString(6,this.sStreamName),t.writeInt32(7,this.iRatio),t.writeString(8,this.sCodec),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeString(11,this.curPcdnName),t.writeInt32(12,this.supportV6),t.writeString(13,this.sUserAgent)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.iCliType=t.readInt32(5,!1,this.iCliType),this.sStreamName=t.readString(6,!1,this.sStreamName),this.iRatio=t.readInt32(7,!1,this.iRatio),this.sCodec=t.readString(8,!1,this.sCodec),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.curPcdnName=t.readString(11,!1,this.curPcdnName),this.supportV6=t.readInt32(12,!1,this.supportV6),this.sUserAgent=t.readString(13,!1,this.sUserAgent)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamName="",this.iErrCode=0,this.sPcdnName="",this.pullStreamUrl=new r.PCdnProxyUrl,this.cliProv="",this.cliIsp="",this.iCdnLine=0,this.iRatio=0,this.sCodec="",this.mAllPullStreamUrl=new s.Map(new s.STRING,new r.PCdnProxyUrl)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvHttpFullstreamInfoRsp},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sStreamName),t.writeInt32(4,this.iErrCode),t.writeString(5,this.sPcdnName),t.writeStruct(6,this.pullStreamUrl),t.writeString(7,this.cliProv),t.writeString(8,this.cliIsp),t.writeInt32(9,this.iCdnLine),t.writeInt32(10,this.iRatio),t.writeString(11,this.sCodec),t.writeMap(12,this.mAllPullStreamUrl)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sStreamName=t.readString(3,!1,this.sStreamName),this.iErrCode=t.readInt32(4,!1,this.iErrCode),this.sPcdnName=t.readString(5,!1,this.sPcdnName),this.pullStreamUrl=t.readStruct(6,!1,this.pullStreamUrl),this.cliProv=t.readString(7,!1,this.cliProv),this.cliIsp=t.readString(8,!1,this.cliIsp),this.iCdnLine=t.readInt32(9,!1,this.iCdnLine),this.iRatio=t.readInt32(10,!1,this.iRatio),this.sCodec=t.readString(11,!1,this.sCodec),this.mAllPullStreamUrl=t.readMap(12,!1,this.mAllPullStreamUrl)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamName),t.writeInt32(6,this.iRatio),t.writeString(7,this.sCodec),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamName=t.readString(5,!1,this.sStreamName),this.iRatio=t.readInt32(6,!1,this.iRatio),this.sCodec=t.readString(7,!1,this.sCodec),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.sFlvFullstreamUrl="",this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sTransUid=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeString(11,this.sFlvFullstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeInt32(103,this.iRatio),t.writeString(104,this.sTransUid)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.sFlvFullstreamUrl=t.readString(11,!1,this.sFlvFullstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.iRatio=t.readInt32(103,!1,this.iRatio),this.sTransUid=t.readString(104,!1,this.sTransUid)},r.RecSysInfo=function(){this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.sStrategy="",this.lServerTs=0,this.lAction=0,this.sActionReason="",this.sActValue=""},r.RecSysInfo.prototype._clone=function(){return new r.RecSysInfo},r.RecSysInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysInfo.prototype.writeTo=function(t){t.writeString(0,this.sAnchorUid),t.writeString(1,this.sRoomId),t.writeString(2,this.sDispatchId),t.writeInt32(3,this.iScene),t.writeString(4,this.sStrategy),t.writeInt64(5,this.lServerTs),t.writeInt64(6,this.lAction),t.writeString(7,this.sActionReason),t.writeString(8,this.sActValue)},r.RecSysInfo.prototype.readFrom=function(t){this.sAnchorUid=t.readString(0,!1,this.sAnchorUid),this.sRoomId=t.readString(1,!1,this.sRoomId),this.sDispatchId=t.readString(2,!1,this.sDispatchId),this.iScene=t.readInt32(3,!1,this.iScene),this.sStrategy=t.readString(4,!1,this.sStrategy),this.lServerTs=t.readInt64(5,!1,this.lServerTs),this.lAction=t.readInt64(6,!1,this.lAction),this.sActionReason=t.readString(7,!1,this.sActionReason),this.sActValue=t.readString(8,!1,this.sActValue)},r.RecSysReq=function(){this.tId=new r.MediaUserId,this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.bDebug=0,this.sNet="",this.sSdkVer="",this.mAppendInfo=new s.Map(new s.STRING,new s.STRING)},r.RecSysReq.prototype._clone=function(){return new r.RecSysReq},r.RecSysReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeString(1,this.sAnchorUid),t.writeString(2,this.sRoomId),t.writeString(3,this.sDispatchId),t.writeInt32(4,this.iScene),t.writeInt32(5,this.bDebug),t.writeString(6,this.sNet),t.writeString(7,this.sSdkVer),t.writeMap(8,this.mAppendInfo)},r.RecSysReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.sAnchorUid=t.readString(1,!1,this.sAnchorUid),this.sRoomId=t.readString(2,!1,this.sRoomId),this.sDispatchId=t.readString(3,!1,this.sDispatchId),this.iScene=t.readInt32(4,!1,this.iScene),this.bDebug=t.readInt32(5,!1,this.bDebug),this.sNet=t.readString(6,!1,this.sNet),this.sSdkVer=t.readString(7,!1,this.sSdkVer),this.mAppendInfo=t.readMap(8,!1,this.mAppendInfo)},r.RecSysRsp=function(){this.iStatus=0,this.sError="",this.tRecSysInfo=new r.RecSysInfo},r.RecSysRsp.prototype._clone=function(){return new r.RecSysRsp},r.RecSysRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iStatus),t.writeString(1,this.sError),t.writeStruct(2,this.tRecSysInfo)},r.RecSysRsp.prototype.readFrom=function(t){this.iStatus=t.readInt32(0,!1,this.iStatus),this.sError=t.readString(1,!1,this.sError),this.tRecSysInfo=t.readStruct(2,!1,this.tRecSysInfo)},r.RecSysNotice=function(){this.tRecSysInfo=new r.RecSysInfo},r.RecSysNotice.prototype._clone=function(){return new r.RecSysNotice},r.RecSysNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tRecSysInfo)},r.RecSysNotice.prototype.readFrom=function(t){this.tRecSysInfo=t.readStruct(0,!1,this.tRecSysInfo)},r.VodUrlRange=function(){this.sUrl="",this.sRange="",this.index=0},r.VodUrlRange.prototype._clone=function(){return new r.VodUrlRange},r.VodUrlRange.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VodUrlRange.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VodUrlRange.prototype.writeTo=function(t){t.writeString(0,this.sUrl),t.writeString(1,this.sRange),t.writeInt64(2,this.index)},r.VodUrlRange.prototype.readFrom=function(t){this.sUrl=t.readString(0,!1,this.sUrl),this.sRange=t.readString(1,!1,this.sRange),this.index=t.readInt64(2,!1,this.index)},r.VodPcdnProxyUrl=function(){this.reqKey=new r.VodUrlRange,this.iStatusPcdn=0,this.iVodPcdnHotDegreeIn=-1,this.iVodPcdnHotDegreeNow=-1,this.vUrls=new s.Vector(new s.STRING)},r.VodPcdnProxyUrl.prototype._clone=function(){return new r.VodPcdnProxyUrl},r.VodPcdnProxyUrl.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VodPcdnProxyUrl.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VodPcdnProxyUrl.prototype.writeTo=function(t){t.writeStruct(0,this.reqKey),t.writeInt32(1,this.iStatusPcdn),t.writeInt32(2,this.iVodPcdnHotDegreeIn),t.writeInt32(3,this.iVodPcdnHotDegreeNow),t.writeVector(4,this.vUrls)},r.VodPcdnProxyUrl.prototype.readFrom=function(t){this.reqKey=t.readStruct(0,!1,this.reqKey),this.iStatusPcdn=t.readInt32(1,!1,this.iStatusPcdn),this.iVodPcdnHotDegreeIn=t.readInt32(2,!1,this.iVodPcdnHotDegreeIn),this.iVodPcdnHotDegreeNow=t.readInt32(3,!1,this.iVodPcdnHotDegreeNow),this.vUrls=t.readVector(4,!1,this.vUrls)},r.ClientGetVodPcdnProxyReq=function(){this.appid=0,this.lReqTs=0,this.lUid=0,this.sGuid="",this.iCliType=0,this.lBucketPara=0,this.sOrigUrl="",this.vKeys=new s.Vector(new r.VodUrlRange)},r.ClientGetVodPcdnProxyReq.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReq},r.ClientGetVodPcdnProxyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetVodPcdnProxyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetVodPcdnProxyReq.prototype.writeTo=function(t){t.writeInt32(0,this.appid),t.writeInt64(1,this.lReqTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sGuid),t.writeInt32(4,this.iCliType),t.writeInt64(5,this.lBucketPara),t.writeString(6,this.sOrigUrl),t.writeVector(7,this.vKeys)},r.ClientGetVodPcdnProxyReq.prototype.readFrom=function(t){this.appid=t.readInt32(0,!1,this.appid),this.lReqTs=t.readInt64(1,!1,this.lReqTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sGuid=t.readString(3,!1,this.sGuid),this.iCliType=t.readInt32(4,!1,this.iCliType),this.lBucketPara=t.readInt64(5,!1,this.lBucketPara),this.sOrigUrl=t.readString(6,!1,this.sOrigUrl),this.vKeys=t.readVector(7,!1,this.vKeys)},r.ClientGetVodPcdnProxyReqRsp=function(){this.appid=0,this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sOrigUrl="",this.iErrCode=0,this.vPcdnUrls=new s.Vector(new r.VodPcdnProxyUrl),this.cliProv="",this.cliIsp="",this.pcdnName="",this.sPcdnIsp="",this.sPcdnArea=""},r.ClientGetVodPcdnProxyReqRsp.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReqRsp},r.ClientGetVodPcdnProxyReqRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetVodPcdnProxyReqRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetVodPcdnProxyReqRsp.prototype.writeTo=function(t){t.writeInt32(0,this.appid),t.writeInt64(1,this.lReqTs),t.writeInt64(2,this.lRspTs),t.writeInt64(3,this.lUid),t.writeString(4,this.sOrigUrl),t.writeInt32(5,this.iErrCode),t.writeVector(6,this.vPcdnUrls),t.writeString(7,this.cliProv),t.writeString(8,this.cliIsp),t.writeString(9,this.pcdnName),t.writeString(10,this.sPcdnIsp),t.writeString(11,this.sPcdnArea)},r.ClientGetVodPcdnProxyReqRsp.prototype.readFrom=function(t){this.appid=t.readInt32(0,!1,this.appid),this.lReqTs=t.readInt64(1,!1,this.lReqTs),this.lRspTs=t.readInt64(2,!1,this.lRspTs),this.lUid=t.readInt64(3,!1,this.lUid),this.sOrigUrl=t.readString(4,!1,this.sOrigUrl),this.iErrCode=t.readInt32(5,!1,this.iErrCode),this.vPcdnUrls=t.readVector(6,!1,this.vPcdnUrls),this.cliProv=t.readString(7,!1,this.cliProv),this.cliIsp=t.readString(8,!1,this.cliIsp),this.pcdnName=t.readString(9,!1,this.pcdnName),this.sPcdnIsp=t.readString(10,!1,this.sPcdnIsp),this.sPcdnArea=t.readString(11,!1,this.sPcdnArea)},r.GetVideoHisUponReq=function(){this.lUid=0,this.lLiveId=0,this.tId=new r.UserId},r.GetVideoHisUponReq.prototype._clone=function(){return new r.GetVideoHisUponReq},r.GetVideoHisUponReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVideoHisUponReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVideoHisUponReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.lLiveId),t.writeStruct(2,this.tId)},r.GetVideoHisUponReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.tId=t.readStruct(2,!1,this.tId)},r.GetVideoHisUponRsp=function(){this.lUid=0,this.vHistoryList=new s.Vector(new r.GameLiveHlsInfo)},r.GetVideoHisUponRsp.prototype._clone=function(){return new r.GetVideoHisUponRsp},r.GetVideoHisUponRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVideoHisUponRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVideoHisUponRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeVector(1,this.vHistoryList)},r.GetVideoHisUponRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.vHistoryList=t.readVector(1,!1,this.vHistoryList)},r.ImgplusABTestNotice=function(){this.lPid=0,this.iAppid=0,this.iSwitch=0},r.ImgplusABTestNotice.prototype._clone=function(){return new r.ImgplusABTestNotice},r.ImgplusABTestNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ImgplusABTestNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ImgplusABTestNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPid),t.writeInt32(1,this.iAppid),t.writeInt32(2,this.iSwitch)},r.ImgplusABTestNotice.prototype.readFrom=function(t){this.lPid=t.readInt64(0,!1,this.lPid),this.iAppid=t.readInt32(1,!1,this.iAppid),this.iSwitch=t.readInt32(2,!1,this.iSwitch)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iAppid=0,this.sStrUid="",this.sUAppId="",this.iNetType=127},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaUserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaUserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sUA),t.writeString(4,this.sCookie),t.writeInt32(6,this.iAppid),t.writeString(8,this.sStrUid),t.writeString(9,this.sUAppId),t.writeInt32(10,this.iNetType)},r.MediaUserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sUA=t.readString(3,!1,this.sUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iAppid=t.readInt32(6,!1,this.iAppid),this.sStrUid=t.readString(8,!1,this.sStrUid),this.sUAppId=t.readString(9,!1,this.sUAppId),this.iNetType=t.readInt32(10,!1,this.iNetType)},r.MediaResolution=function(){this.iWidth=0,this.iHeight=0},r.MediaResolution.prototype._clone=function(){return new r.MediaResolution},r.MediaResolution.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaResolution.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaResolution.prototype.writeTo=function(t){t.writeInt32(0,this.iWidth),t.writeInt32(1,this.iHeight)},r.MediaResolution.prototype.readFrom=function(t){this.iWidth=t.readInt32(0,!1,this.iWidth),this.iHeight=t.readInt32(1,!1,this.iHeight)},r.MediaStreamFormatInfo=function(){this.sFormatName="",this.sUrl="",this.sSuffix="",this.vIPList=new s.Vector(new s.STRING),this.iIsSupport=0,this.iRate=0,this.sAdditionalParam="",this.lFormatPropertyFlag=0},r.MediaStreamFormatInfo.prototype._clone=function(){return new r.MediaStreamFormatInfo},r.MediaStreamFormatInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamFormatInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamFormatInfo.prototype.writeTo=function(t){t.writeString(0,this.sFormatName),t.writeString(1,this.sUrl),t.writeString(2,this.sSuffix),t.writeVector(3,this.vIPList),t.writeInt32(4,this.iIsSupport),t.writeInt32(5,this.iRate),t.writeString(6,this.sAdditionalParam),t.writeInt64(7,this.lFormatPropertyFlag)},r.MediaStreamFormatInfo.prototype.readFrom=function(t){this.sFormatName=t.readString(0,!1,this.sFormatName),this.sUrl=t.readString(1,!1,this.sUrl),this.sSuffix=t.readString(2,!1,this.sSuffix),this.vIPList=t.readVector(3,!1,this.vIPList),this.iIsSupport=t.readInt32(4,!1,this.iIsSupport),this.iRate=t.readInt32(5,!1,this.iRate),this.sAdditionalParam=t.readString(6,!1,this.sAdditionalParam),this.lFormatPropertyFlag=t.readInt64(7,!1,this.lFormatPropertyFlag)},r.MediaStreamInfo=function(){this.sCdnName="",this.sStreamName="",this.sFlvUrl="",this.sFlvSuffix="",this.sHlsUrl="",this.sHlsSuffix="",this.iLineIndex=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pSuffix="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new s.Vector(new s.STRING),this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.sAdditionalParam="",this.mMediaStreamFormatInfo=new s.Map(new s.STRING,new r.MediaStreamFormatInfo)},r.MediaStreamInfo.prototype._clone=function(){return new r.MediaStreamInfo},r.MediaStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sCdnName),t.writeString(1,this.sStreamName),t.writeString(2,this.sFlvUrl),t.writeString(3,this.sFlvSuffix),t.writeString(4,this.sHlsUrl),t.writeString(5,this.sHlsSuffix),t.writeInt32(6,this.iLineIndex),t.writeVector(7,this.vFlvIPList),t.writeInt32(8,this.iIsP2PSupport),t.writeString(9,this.sP2pUrl),t.writeString(10,this.sP2pSuffix),t.writeInt64(11,this.lFreeFlag),t.writeInt32(12,this.iIsHEVCSupport),t.writeVector(13,this.vP2pIPList),t.writeInt32(14,this.iPCPriorityRate),t.writeInt32(15,this.iWebPriorityRate),t.writeInt32(16,this.iMobilePriorityRate),t.writeString(17,this.sAdditionalParam),t.writeMap(18,this.mMediaStreamFormatInfo)},r.MediaStreamInfo.prototype.readFrom=function(t){this.sCdnName=t.readString(0,!1,this.sCdnName),this.sStreamName=t.readString(1,!1,this.sStreamName),this.sFlvUrl=t.readString(2,!1,this.sFlvUrl),this.sFlvSuffix=t.readString(3,!1,this.sFlvSuffix),this.sHlsUrl=t.readString(4,!1,this.sHlsUrl),this.sHlsSuffix=t.readString(5,!1,this.sHlsSuffix),this.iLineIndex=t.readInt32(6,!1,this.iLineIndex),this.vFlvIPList=t.readVector(7,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(8,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(9,!1,this.sP2pUrl),this.sP2pSuffix=t.readString(10,!1,this.sP2pSuffix),this.lFreeFlag=t.readInt64(11,!1,this.lFreeFlag),this.iIsHEVCSupport=t.readInt32(12,!1,this.iIsHEVCSupport),this.vP2pIPList=t.readVector(13,!1,this.vP2pIPList),this.iPCPriorityRate=t.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(16,!1,this.iMobilePriorityRate),this.sAdditionalParam=t.readString(17,!1,this.sAdditionalParam),this.mMediaStreamFormatInfo=t.readMap(18,!1,this.mMediaStreamFormatInfo)},r.StreamGearInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iHEVCBitRate=-1,this.tResolution=new r.MediaResolution,this.sAdditionalParam="",this.mSupportFormat=new s.Map(new s.STRING,new s.INT64),this.sBusiGearIndex=""},r.StreamGearInfo.prototype._clone=function(){return new r.StreamGearInfo},r.StreamGearInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.StreamGearInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.StreamGearInfo.prototype.writeTo=function(t){t.writeString(0,this.sDisplayName),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iCodecType),t.writeInt32(3,this.iHEVCBitRate),t.writeStruct(4,this.tResolution),t.writeString(5,this.sAdditionalParam),t.writeMap(6,this.mSupportFormat),t.writeString(7,this.sBusiGearIndex)},r.StreamGearInfo.prototype.readFrom=function(t){this.sDisplayName=t.readString(0,!1,this.sDisplayName),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iCodecType=t.readInt32(2,!1,this.iCodecType),this.iHEVCBitRate=t.readInt32(3,!1,this.iHEVCBitRate),this.tResolution=t.readStruct(4,!1,this.tResolution),this.sAdditionalParam=t.readString(5,!1,this.sAdditionalParam),this.mSupportFormat=t.readMap(6,!1,this.mSupportFormat),this.sBusiGearIndex=t.readString(7,!1,this.sBusiGearIndex)},r.MediaStreamNameInfoPack=function(){this.vMediaStreamInfo=new s.Vector(new r.MediaStreamInfo),this.vStreamGearInfo=new s.Vector(new r.StreamGearInfo),this.sStreamGroupId="",this.lLiveCompatibleFlag=0,this.sAntiCode="",this.lStreamId=0,this.lUid=0,this.iStreamProperty=0,this.iBitRate=0,this.iStreamType=0,this.iPcDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.sStreamBusiProperty="",this.sAdditionalParam="",this.iStreamCategory=0},r.MediaStreamNameInfoPack.prototype._clone=function(){return new r.MediaStreamNameInfoPack},r.MediaStreamNameInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamNameInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamNameInfoPack.prototype.writeTo=function(t){t.writeVector(0,this.vMediaStreamInfo),t.writeVector(1,this.vStreamGearInfo),t.writeString(2,this.sStreamGroupId),t.writeInt64(3,this.lLiveCompatibleFlag),t.writeString(4,this.sAntiCode),t.writeInt64(5,this.lStreamId),t.writeInt64(6,this.lUid),t.writeInt32(7,this.iStreamProperty),t.writeInt32(8,this.iBitRate),t.writeInt32(9,this.iStreamType),t.writeInt32(10,this.iPcDefaultBitRate),t.writeInt32(11,this.iWebDefaultBitRate),t.writeInt32(12,this.iMobileDefaultBitRate),t.writeString(13,this.sStreamBusiProperty),t.writeString(14,this.sAdditionalParam),t.writeInt32(15,this.iStreamCategory)},r.MediaStreamNameInfoPack.prototype.readFrom=function(t){this.vMediaStreamInfo=t.readVector(0,!1,this.vMediaStreamInfo),this.vStreamGearInfo=t.readVector(1,!1,this.vStreamGearInfo),this.sStreamGroupId=t.readString(2,!1,this.sStreamGroupId),this.lLiveCompatibleFlag=t.readInt64(3,!1,this.lLiveCompatibleFlag),this.sAntiCode=t.readString(4,!1,this.sAntiCode),this.lStreamId=t.readInt64(5,!1,this.lStreamId),this.lUid=t.readInt64(6,!1,this.lUid),this.iStreamProperty=t.readInt32(7,!1,this.iStreamProperty),this.iBitRate=t.readInt32(8,!1,this.iBitRate),this.iStreamType=t.readInt32(9,!1,this.iStreamType),this.iPcDefaultBitRate=t.readInt32(10,!1,this.iPcDefaultBitRate),this.iWebDefaultBitRate=t.readInt32(11,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=t.readInt32(12,!1,this.iMobileDefaultBitRate),this.sStreamBusiProperty=t.readString(13,!1,this.sStreamBusiProperty),this.sAdditionalParam=t.readString(14,!1,this.sAdditionalParam),this.iStreamCategory=t.readInt32(15,!1,this.iStreamCategory)},r.MediaStreamInfoPack=function(){this.mMediaStreamInfoPack=new s.Map(new s.STRING,new r.MediaStreamNameInfoPack)},r.MediaStreamInfoPack.prototype._clone=function(){return new r.MediaStreamInfoPack},r.MediaStreamInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamInfoPack.prototype.writeTo=function(t){t.writeMap(0,this.mMediaStreamInfoPack)},r.MediaStreamInfoPack.prototype.readFrom=function(t){this.mMediaStreamInfoPack=t.readMap(0,!1,this.mMediaStreamInfoPack)},r.GetStreamInfoByRoomFakeReq=function(){this.tId=new r.MediaUserId,this.sRoomId="",this.mpVariable=new s.Map(new s.STRING,new s.STRING),this.iMediaPackType=-1,this.mBusiParams=new s.Map(new s.STRING,new s.STRING)},r.GetStreamInfoByRoomFakeReq.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeReq},r.GetStreamInfoByRoomFakeReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetStreamInfoByRoomFakeReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetStreamInfoByRoomFakeReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeString(1,this.sRoomId),t.writeMap(2,this.mpVariable),t.writeInt32(3,this.iMediaPackType),t.writeMap(4,this.mBusiParams)},r.GetStreamInfoByRoomFakeReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.sRoomId=t.readString(1,!1,this.sRoomId),this.mpVariable=t.readMap(2,!1,this.mpVariable),this.iMediaPackType=t.readInt32(3,!1,this.iMediaPackType),this.mBusiParams=t.readMap(4,!1,this.mBusiParams)},r.GetStreamInfoByRoomFakeRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack,this.mpConfig=new s.Map(new s.STRING,new s.STRING),this.sRoomId=""},r.GetStreamInfoByRoomFakeRsp.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeRsp},r.GetStreamInfoByRoomFakeRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetStreamInfoByRoomFakeRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetStreamInfoByRoomFakeRsp.prototype.writeTo=function(t){t.writeStruct(0,this.tStreamInfoPack),t.writeMap(1,this.mpConfig),t.writeString(2,this.sRoomId)},r.GetStreamInfoByRoomFakeRsp.prototype.readFrom=function(t){this.tStreamInfoPack=t.readStruct(0,!1,this.tStreamInfoPack),this.mpConfig=t.readMap(1,!1,this.mpConfig),this.sRoomId=t.readString(2,!1,this.sRoomId)},r.PingSignalContext=function(){this.sWupServant="launch",this.sFuncName="pingSignal",this.mTracePoint=new s.Map(new s.STRING,new s.INT64)},r.PingSignalContext.prototype._clone=function(){return new r.PingSignalContext},r.PingSignalContext.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.PingSignalContext.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.PingSignalContext.prototype.writeTo=function(t){t.writeString(0,this.sWupServant),t.writeString(1,this.sFuncName),t.writeMap(2,this.mTracePoint)},r.PingSignalContext.prototype.readFrom=function(t){this.sWupServant=t.readString(0,!1,this.sWupServant),this.sFuncName=t.readString(1,!1,this.sFuncName),this.mTracePoint=t.readMap(2,!1,this.mTracePoint)},r.GetVodAntiCodeReq=function(){this.iAppId=0,this.sUrl="",this.iValidTime=0,this.lClientUid=0,this.sClientUa="",this.sStreamId=""},r.GetVodAntiCodeReq.prototype._clone=function(){return new r.GetVodAntiCodeReq},r.GetVodAntiCodeReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVodAntiCodeReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVodAntiCodeReq.prototype.writeTo=function(t){t.writeInt32(0,this.iAppId),t.writeString(1,this.sUrl),t.writeInt32(2,this.iValidTime),t.writeInt64(3,this.lClientUid),t.writeString(4,this.sClientUa),t.writeString(5,this.sStreamId)},r.GetVodAntiCodeReq.prototype.readFrom=function(t){this.iAppId=t.readInt32(0,!1,this.iAppId),this.sUrl=t.readString(1,!1,this.sUrl),this.iValidTime=t.readInt32(2,!1,this.iValidTime),this.lClientUid=t.readInt64(3,!1,this.lClientUid),this.sClientUa=t.readString(4,!1,this.sClientUa),this.sStreamId=t.readString(5,!1,this.sStreamId)},r.GetVodAntiCodeRsp=function(){this.sAntiCode="",this.iExpireTime=0,this.sStreamId=""},r.GetVodAntiCodeRsp.prototype._clone=function(){return new r.GetVodAntiCodeRsp},r.GetVodAntiCodeRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVodAntiCodeRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVodAntiCodeRsp.prototype.writeTo=function(t){t.writeString(0,this.sAntiCode),t.writeInt32(1,this.iExpireTime),t.writeString(2,this.sStreamId)},r.GetVodAntiCodeRsp.prototype.readFrom=function(t){this.sAntiCode=t.readString(0,!1,this.sAntiCode),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime),this.sStreamId=t.readString(2,!1,this.sStreamId)}},function(t,e,i){t.exports={default:i(113),__esModule:!0}},function(t,e,i){var s=i(41);t.exports=function(t){return Object(s(t))}},function(t,e,i){"use strict";e.__esModule=!0;var s,r=(s=i(78))&&s.__esModule?s:{default:s};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}},function(t,e){t.exports={}},function(t,e,i){"use strict";e.__esModule=!0;var s=o(i(136)),r=o(i(140)),a=o(i(78));function o(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,a.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(s.default?(0,s.default)(t,e):t.__proto__=e)}},function(t,e){t.exports=!0},function(t,e){var i=0,s=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+s).toString(36))}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){var s=i(13),r=i(123),a=i(51),o=i(42)("IE_PROTO"),n=function(){},h=function(){var t,e=i(77)("iframe"),s=a.length;for(e.style.display="none",i(126).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),h=t.F;s--;)delete h.prototype[a[s]];return h()};t.exports=Object.create||function(t,e){var i;return null!==t?(n.prototype=s(t),i=new n,n.prototype=null,i[o]=t):i=h(),void 0===e?i:r(i,e)}},function(t,e,i){var s=i(80),r=i(51);t.exports=Object.keys||function(t){return s(t,r)}},function(t,e,i){var s=i(9).f,r=i(14),a=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,a)&&s(t,a,{configurable:!0,value:e})}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(10)),r=o(i(0)),a=o(i(1));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,r.default)(this,t),this.view=e,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===i&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return(0,a.default)(t,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var t=this.view.getUint8(this.pos);return this.pos++,t}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);this.pos+=4;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,4294967296*e+t}},{key:"popInt64",value:function(){for(var t=0,e=(128&this.view.getUint8(this.pos+7))>0,i=!0,s=0;s<8;s++){var r=this.view.getUint8(this.pos+s);e&&(i?0!=r&&(r=255&~(r-1),i=!1):r=255&~r),t+=r*Math.pow(2,8*s)}return e&&(t=-t),this.pos+=8,t}},{key:"popUint8Array",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUint8Array32",value:function(){var t=this.popUInt32();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUInt64Vector",value:function(){var t=this.popUInt32();if(this.pos+8*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt64());return e}},{key:"popUInt32Vector",value:function(){var t=this.popUInt32();if(this.pos+4*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt32());return e}},{key:"popUInt16Vector",value:function(){var t=this.popUInt32();if(this.pos+2*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt16());return e}},{key:"popString",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;for(var e=[],i=0;i<t;++i)e[i]=String.fromCharCode(this.popUInt8());return e.join("")}},{key:"popMapKey8Val32",value:function(){for(var t=this.popUInt32(),e=new s.default,i=0;i<t;i++){var r=this.popUInt8(),a=this.popUInt32();e.set(r,a)}return e}},{key:"popMapKey64Val64",value:function(){for(var t=this.popUInt32(),e=new s.default,i=0;i<t;i++){var r=this.popUInt64(),a=this.popUInt64();e.set(r,a)}return e}}]),t}();e.default=n},function(t,e,i){var s=i(17),r=i(146),a=i(147),o=i(13),n=i(50),h=i(89),d={},l={};(e=t.exports=function(t,e,i,c,u){var p,m,_,f,g=u?function(){return t}:h(t),S=s(i,c,e?2:1),y=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(a(g)){for(p=n(t.length);p>y;y++)if((f=e?S(o(m=t[y])[0],m[1]):S(t[y]))===d||f===l)return f}else for(_=g.call(t);!(m=_.next()).done;)if((f=r(_,S,m.value,e))===d||f===l)return f}).BREAK=d,e.RETURN=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return"number"==typeof this.ip?t.pushUInt32(this.ip):t.pushUInt32(this.ip2uint(this.ip)),t.pushUInt16Vector(this.tcpPorts),t.pushUInt16Vector(this.udpPorts),t.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.marshall()}},{key:"unmarshall",value:function(t){this.ip=this.uint2ip(t.popUInt32()),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this.videoProxyInfo.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.videoProxyInfo.set(s,r)}return this}},{key:"ip2uint",value:function(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}},{key:"uint2ip",value:function(t){return(255&t)+"."+(t>>8&255)+"."+(t>>16&255)+"."+(t>>24&255)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(63)),o=h(i(64)),n=h(i(2));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(){(0,s.default)(this,t),this.appid=0,this.streamType=0,this.codecType=0,this.sid=0,this.startTs=0,this.serverGenSeq=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new n.default(!1);return t.pushUInt8(this.appid),t.pushUInt8(this.streamType),t.pushUInt16(this.codecType),t.pushUInt64(this.sid),t.pushUInt32(this.startTs),t.pushUInt16(this.serverGenSeq),t.marshall()}},{key:"unmarshall",value:function(t){return this.appid=t.popUInt8(),this.streamType=t.popUInt8(),this.codecType=t.popUInt16(),this.sid=t.popUInt64(),this.startTs=t.popUInt32(),this.serverGenSeq=t.popUInt16(),this}},{key:"text",value:function(){return this.appid+"-"+this.streamType+"-"+this.codecType+"-"+this.sid+"-"+this.startTs+"-"+this.serverGenSeq}},{key:"equal",value:function(t){return null!==t&&this.appid===t.appid&&this.streamType===t.streamType&&this.codecType===t.codecType&&this.sid===t.sid&&this.startTs===t.startTs&&this.serverGenSeq===t.serverGenSeq}},{key:"isValidID",get:function(){return this.appid>0}},{key:"isTransStream",get:function(){return 1==(1&this.streamType)}},{key:"isAudioStream",get:function(){return this.streamType>=a.default.STRAEM_TYPE_AUDIO_START}},{key:"isVideoStream",get:function(){return this.streamType<a.default.STRAEM_TYPE_AUDIO_START}},{key:"isH264VideoStream",get:function(){return this.isVideoStream&&this.codecType>=o.default.VIDEO_264_START&&this.codecType<=o.default.VIDEO_H264_END}},{key:"isH265VideoStream",get:function(){return this.isVideoStream&&this.codecType>=o.default.VIDEO_265_START&&this.codecType<=o.default.VIDEO_H265_END}},{key:"videoTypeId",get:function(){return this.appid<<24|this.streamType<<16|this.codecType}},{key:"hashKey",get:function(){return 4294967296*this.sid+(this.codecType<<16|this.appid<<8|this.streamType)}},{key:"streamId",get:function(){return 281474976710656*this.streamType+4294967296*this.codecType+this.startTs}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return"number"==typeof this.ip?t.pushUInt32(this.ip):t.pushUInt32(this.ip2uint(this.ip)),t.pushUInt16Vector(this.tcpPorts),t.pushUInt16Vector(this.udpPorts),t.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.marshall()}},{key:"unmarshall",value:function(t){this.ip=this.uint2ip(t.popUInt32()),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this.videoProxyInfo.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.videoProxyInfo.set(s,r)}return this}},{key:"ip2uint",value:function(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}},{key:"uint2ip",value:function(t){return(255&t)+"."+(t>>8&255)+"."+(t>>16&255)+"."+(t>>24&255)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(65));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.sid=0,this.fuzzyParam=new o.default}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushUInt64(this.sid),t.pushUint8ArrayWithoutLen(this.fuzzyParam.marshall()),t.marshall()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(21).default;e.default=s},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var s=i(43)("keys"),r=i(28);t.exports=function(t){return s[t]||(s[t]=r(t))}},function(t,e,i){var s=i(3),r=i(8),a=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return a[t]||(a[t]=void 0!==e?e:{})})("versions",[]).push({version:s.version,mode:i(27)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var s=i(11);t.exports=function(t,e){if(!s(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!s(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){"use strict";var s=i(121)(!0);i(47)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=s(e,i),this._i+=t.length,{value:t,done:!1})}))},function(t,e){var i=Math.ceil,s=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?s:i)(t)}},function(t,e,i){"use strict";var s=i(27),r=i(5),a=i(79),o=i(12),n=i(25),h=i(122),d=i(32),l=i(74),c=i(7)("iterator"),u=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,m,_,f,g){h(i,e,m);var S,y,T,P=function(t){if(!u&&t in I)return I[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},v=e+" Iterator",E="values"==_,C=!1,I=t.prototype,A=I[c]||I["@@iterator"]||_&&I[_],D=A||P(_),R=_?E?P("entries"):D:void 0,O="Array"==e&&I.entries||A;if(O&&(T=l(O.call(new t)))!==Object.prototype&&T.next&&(d(T,v,!0),s||"function"==typeof T[c]||o(T,c,p)),E&&A&&"values"!==A.name&&(C=!0,D=function(){return A.call(this)}),s&&!g||!u&&!C&&I[c]||o(I,c,D),n[e]=D,n[v]=p,_)if(S={values:E?D:P("values"),keys:f?D:P("keys"),entries:R},g)for(y in S)y in I||a(I,y,S[y]);else r(r.P+r.F*(u||C),e,S);return S}},function(t,e,i){var s=i(49);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==s(t)?t.split(""):Object(t)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var s=i(46),r=Math.min;t.exports=function(t){return t>0?r(s(t),9007199254740991):0}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){i(127);for(var s=i(8),r=i(12),a=i(25),o=i(7)("toStringTag"),n="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),h=0;h<n.length;h++){var d=n[h],l=s[d],c=l&&l.prototype;c&&!c[o]&&r(c,o,d),a[d]=a.Array}},function(t,e,i){e.f=i(7)},function(t,e,i){var s=i(28)("meta"),r=i(11),a=i(14),o=i(9).f,n=0,h=Object.isExtensible||function(){return!0},d=!i(15)((function(){return h(Object.preventExtensions({}))})),l=function(t){o(t,s,{value:{i:"O"+ ++n,w:{}}})},c=t.exports={KEY:s,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,s)){if(!h(t))return"F";if(!e)return"E";l(t)}return t[s].i},getWeak:function(t,e){if(!a(t,s)){if(!h(t))return!0;if(!e)return!1;l(t)}return t[s].w},onFreeze:function(t){return d&&c.NEED&&h(t)&&!a(t,s)&&l(t),t}}},function(t,e,i){var s=i(8),r=i(3),a=i(27),o=i(53),n=i(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=a?{}:s.Symbol||{});"_"==t.charAt(0)||t in e||n(e,t,{value:o.f(t)})}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=null;try{t=window.localStorage}catch(e){t={removeItem:function(t){},getItem:function(t){return null},setItem:function(t,e){},clear:function(){}}}return t}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(20)),o=n(i(36));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamId=new a.default,this.videoProxyInfos=[],this.token="",this.streamSeqSN=0,this.quickAccessBeginIndex=0,this.quickAccessEndIndex=0,this.ip=0,this.urlTokenTime=0,this.urlToken=""}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.streamId.unmarshall(t),this.videoProxyInfos=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new o.default;this.videoProxyInfos.push(s.unmarshall(t))}return this.token=t.popString(),this.streamSeqSN=t.popUInt64(),this.quickAccessBeginIndex=t.popUInt64(),this.quickAccessEndIndex=t.popUInt64(),this.ip=t.popUInt32(),this.urlTokenTime=t.popUInt32(),this.urlToken=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,SIGNAL_STREAM_DATA:47,SIGNAL_STREAM_COMPRESS_DATA:48,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580,VIDEO_H264_EX_BASE:1e3,VIDEO_H264_EX_START:1005,VIDEO_H264_EX_500K:1005,VIDEO_H264_EX_1M:1010,VIDEO_H264_EX_5M:1050,VIDEO_H264_EX_8M:1080,VIDEO_H264_EX_10M:1100,VIDEO_H264_EX_12M:1120,VIDEO_H264_EX_15M:1150,VIDEO_H264_EX_20M:1200,VIDEO_H264_EX_END:1200,VIDEO_H265_EX_BASE:4e3,VIDEO_H265_EX_START:4005,VIDEO_H265_EX_500K:4005,VIDEO_H265_EX_1M:4010,VIDEO_H265_EX_5M:4050,VIDEO_H265_EX_8M:4080,VIDEO_H265_EX_10M:4100,VIDEO_H265_EX_12M:4120,VIDEO_H265_EX_15M:4150,VIDEO_H265_EX_20M:4200,VIDEO_H265_EX_END:4200}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(2)),n=d(i(20)),h=d(i(36));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.currentProxyInfos=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach((function(e,i){t.pushUint8ArrayWithoutLen(i.marshall()),t.pushUInt32(e.length),e.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())}))})),t.marshall()}},{key:"unmarshall",value:function(t){this.currentProxyInfos.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=new n.default;s.unmarshall(t);for(var r=[],a=t.popUInt32(),o=0;o<a;o++){var d=new h.default;r.push(d.unmarshall(t))}this.currentProxyInfos.set(s,r)}return this}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(4)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.uri=0,this.from=0,this.uid=0,this.streamSeqSN=0,this.payload=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceData),t.pushUInt64(this.seq),t.pushUInt32(this.uri),t.pushUInt8(this.from),t.pushUInt64(this.uid),t.pushUInt64(this.streamSeqSN),t.pushUint8Array(this.payload),t.marshall()}},{key:"unmarshall",value:function(t){return this.seq=t.popUInt64(),this.uri=t.popUInt32(),this.from=t.popUInt8(),this.uid=t.popUInt64(),this.streamSeqSN=t.popUInt64(),this.payload=t.popUint8Array(),this}},{key:"isAudio",get:function(){return this.uri==a.default.PP2pSliceAudioData}},{key:"isVideo",get:function(){return this.uri==a.default.PP2pSliceVideoData}},{key:"isCtrlSlice",get:function(){return this.uri==a.default.PP2pSliceControlData}},{key:"isFullSlice",get:function(){return 1==this.from}},{key:"isSubSlice",get:function(){return 2==this.from}},{key:"isResend",get:function(){return 3==this.from&&0==this.uid}},{key:"isPatchSlice",get:function(){return 4==this.from}},{key:"isFromPeer",get:function(){return 0!==this.uid}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(2)),n=d(i(37)),h=d(i(38));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.currentProxyInfos=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach((function(e,i){t.pushUint8ArrayWithoutLen(i.marshall()),t.pushUInt32(e.length),e.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())}))})),t.marshall()}},{key:"unmarshall",value:function(t){this.currentProxyInfos.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=new n.default;s.unmarshall(t);for(var r=[],a=t.popUInt32(),o=0;o<a;o++){var d=new h.default;r.push(d.unmarshall(t))}this.currentProxyInfos.set(s,r)}return this}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_VIDEO_RAW:0,STREAM_VIDEO_TRANSCODE:1,STREAM_VIDEO_RTMP_RAW:2,STREAM_VIDEO_RTMP_TRANSCODE:3,STRAEM_TYPE_AUDIO_START:32,STREAM_AUDIO_RAW:32,STREAM_AUDIO_TRANSCODE:33,STREAM_AUDIO_FLV_RAW:34,STREAM_AUDIO_FLV_TRANSCODE:35,STREAM_AUDIO_RTMP_RAW:36,STREAM_AUDIO_RTMP_TRANSCODE:37,STREAM_AUDIO_ALL_SID:39,STREAM_TYPE_UNKNOWN:255}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.h264Only=!1,this.maxCodeRateH264=0,this.maxCodeRateH265=0,this.reserve=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushBool(this.h264Only),t.pushUInt16(this.maxCodeRateH264),t.pushUInt16(this.maxCodeRateH265),t.pushUInt32(this.reserve),t.marshall()}},{key:"unmarshall",value:function(t){return this.h264Only=t.popBool(),this.maxCodeRateH264=t.popUInt16(),this.maxCodeRateH265=t.popUInt16(),this.reserve=t.popUInt32(),this}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(4)),n=d(i(2)),h=(d(i(39)),d(i(62)));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.uid=0,this.version=0,this.streamNames=[],this.fuzzyQueryKeys=[],this.currentInfo=new h.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.useCase=0,this.appSysName="",this.appUA="",this.retryFailCount=0,this.extInfo=new s.default,this.latencyModel=0}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new n.default;return t.setUri(o.default.PAudienceGetProxyListReq),t.pushUInt64(this.uid),t.pushUInt8(this.version),t.pushUInt32(this.streamNames.length),this.streamNames.forEach((function(e){t.pushString(e)})),t.pushUInt32(this.fuzzyQueryKeys.length),this.fuzzyQueryKeys.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())})),t.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),t.pushUInt8(this.appid),t.pushUInt32(this.clientAppid),t.pushUInt32(this.clientType),t.pushUInt32(this.ip),t.pushUInt32(this.sendTime),t.pushUInt32(this.sdkVersion),t.pushUInt64(this.imsi),t.pushUInt8(this.useCase),t.pushString(this.appSysName),t.pushString(this.appUA),t.pushUInt8(this.retryFailCount),t.pushUInt32(this.extInfo.size),this.extInfo.forEach((function(e,i){t.pushString(i),t.pushString(e)})),t.pushUInt16(this.latencyModel),t.marshall()}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=(n(i(4)),n(i(68)));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.uid=0,this.allocatedStreams=new s.default,this.clientAppid=0,this.clientType=0,this.sendTime=0,this.userArea=0,this.videoGroupId=0,this.retryType=0,this.retryFreq=0,this.result=0,this.proxyType=0,this.tokenVersion=0,this.sslUrl=""}return(0,a.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.allocatedStreams.clear();for(var e=t.popUInt32(),i=0;i<e;i++){for(var s=t.popString(),r=[],a=t.popUInt32(),n=0;n<a;n++){var h=new o.default;r.push(h.unmarshall(t))}this.allocatedStreams.set(s,r)}return this.clientAppid=t.popUInt32(),this.clientType=t.popUInt32(),this.sendTime=t.popUInt32(),this.userArea=t.popUInt32(),this.videoGroupId=t.popUInt32(),this.retryType=t.popUInt8(),this.retryFreq=t.popUInt16(),this.result=t.popUInt32(),this.proxyType=t.popUInt32(),this.tokenVersion=t.popUInt32(),this.sslUrl=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(37)),o=n(i(38));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamId=new a.default,this.videoProxyInfos=[],this.token=""}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.streamId.unmarshall(t),this.videoProxyInfos=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new o.default;this.videoProxyInfos.push(s.unmarshall(t))}return this.token=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=p(i(22)),r=p(i(0)),a=p(i(1)),o=p(i(24)),n=p(i(26)),h=p(i(106)),d=p(i(4)),l=p(i(34)),c=p(i(16)),u=p(i(57));function p(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(){(0,r.default)(this,e);var t=(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this));return t.printProtocol=!!Number(u.default._printProtocol),t}return(0,n.default)(e,t),(0,a.default)(e,[{key:"onData",value:function(t,e){var i=this.unmarshall(t,e);this.trigger(t,i)}},{key:"unmarshall",value:function(t,e){var i=new l.default(e),s=d.default[t],r=i,a=null;try{a=this.getClass(s)}catch(e){c.default.logger.warn("%c[x] Unmatched protocol "+(t>>8)+" "+s,"color:red;background:#FFF0F0")}return a&&(void 0===(r=new a).unmarshall?c.default.logger.error("[x]"+s+".unmarshall undefined!"):r.unmarshall(i)),this.printProtocol&&!_[s]&&c.default.logger.debug("%c<<<<< "+s,"font-weight:900;color:#0000E3",r),r}},{key:"getClass",value:function(t){return null}}]),e}(h.default),_={PCdnProxyPing:1,PCdnProxyPingRes:1,PP2pSliceAudioData:1,PP2pSliceVideoData:1,PP2pSliceControlData:1,PCdnP2pGetNode:1,PCdnP2pGetNodeRes:1,P2POffer:1,P2PAnswer:1,P2PCandidate:1,P2POfferReject:1,P2PRequestOffer:1,PCdnP2PWSForward:1,PCdnP2PWSForwardReject:1,PCdnP2pReportLog:1,PCDNSubscribeReq:1,PCDNSubscribeRes:1,PCDNCompeteSubscribeReq:1,PCDNCompeteSubscribeRes:1,P2PPunchBackReq:1,P2PPunchBackRsp:1,HuyaDelaySeiData:1};e.default=m},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.uid=0,this.encoderSource=0,this.uploadType=0,this.frameDts=0,this.caputureTime=0,this.encodeEndTime=0,this.sendFrameTime=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.encoderSource=t.popUInt8(),this.uploadType=t.popUInt8(),this.frameDts=t.popUInt64(),this.caputureTime=t.popUInt64(),this.encodeEndTime=t.popUInt64(),this.sendFrameTime=t.popUInt64()}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(72));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.dtsGapSum=0,this.delaySum=0,this.serverInfos=[]}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.dtsGapSum=t.popInt64(),this.delaySum=t.popUInt64();for(var e=t.popUInt32();e>0;){e--;var i=new a.default;i.unmarshall(t),this.serverInfos.push(i)}}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.enable=0,
//!=0时表示有效数据
this.proxyIdLow=0,this.proxyIdHigh=0,this.proxyType=0,this.serverDelay=0,this.lastPeriodDelay=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.enable=t.popUInt8(),this.proxyIdLow=t.popUInt32(),this.proxyIdHigh=t.popUInt32(),this.proxyType=t.popUInt16(),this.serverDelay=t.popUInt32(),this.lastPeriodDelay=t.popUInt32()}},{key:"getProxyIdStr",value:function(){return this.proxyIdHigh.toString(16)+this.proxyIdLow.toString(16)}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={};e.default=s,s.INT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt8(e,i)},this._read=function(t,e,i){return t.readInt8(e,!0,i)},this._className=function(){return s.CHAR}},s.INT16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return s.SHORT}},s.INT32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return s.INT32}},s.INT64=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return s.INT64}},s.UINT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return s.SHORT}},s.UInt16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return s.INT32}},s.UInt32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return s.INT64}},s.Float=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeFloat(e,i)},this._read=function(t,e,i){return t.readFloat(e,!0,i)},this._className=function(){return s.FLOAT}},s.Double=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeDouble(e,i)},this._read=function(t,e,i){return t.readDouble(e,!0,i)},this._className=function(){return s.DOUBLE}},s.STRING=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeString(e,i)},this._read=function(t,e,i){return t.readString(e,!0,i)},this._className=function(){return s.STRING}},s.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(t,e,i){return t.writeBoolean(e,i)},this._read=function(t,e,i){return t.readBoolean(e,!0,i)},this._className=function(){return s.BOOLEAN}},s.ENUM=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)}},s.Vector=function(t){this.proto=t,this.value=new Array},s.Vector.prototype._clone=function(){return new s.Vector(this.proto)},s.Vector.prototype._write=function(t,e,i){return t.writeVector(e,i)},s.Vector.prototype._read=function(t,e,i){return t.readVector(e,!0,i)},s.Vector.prototype._className=function(){return s.TypeHelp.VECTOR.replace("$t",this.proto._className())},s.Map=function(t,e){this.kproto=t,this.vproto=e,this.value=new Object},s.Map.prototype._clone=function(){return new s.Map(this.kproto,this.vproto)},s.Map.prototype._write=function(t,e,i){return t.writeMap(e,i)},s.Map.prototype._read=function(t,e,i){return t.readMap(e,!0,i)},s.Map.prototype.put=function(t,e){this.value[t]=e},s.Map.prototype.get=function(t){return this.value[t]},s.Map.prototype.getKeys=function(){var t=[];for(var e in this.value)""!=e&&t.push(e);return t},s.Map.prototype.hasKey=function(t){return this.value.hasOwnProperty(t)},s.Map.prototype.remove=function(t){delete this.value[t]},s.Map.prototype.clear=function(){this.value=new Object},s.Map.prototype.size=function(){var t=0;for(var e in this.value)t++;return t},s.Vector.prototype._className=function(){return s.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())},s.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},s.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},s.BinBuffer=function(t){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=t&&null!=t&&(t instanceof ArrayBuffer?(this.buf=t,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0):(this.buf=t.buf,this.vew=new DataView(this.buf),this.len=t.length,this.position=t.position)),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},s.BinBuffer.prototype._write=function(t,e,i){return t.writeBytes(e,i)},s.BinBuffer.prototype._read=function(t,e,i){return t.readBytes(e,!0,i)},s.BinBuffer.prototype._clone=function(){return new s.BinBuffer},s.BinBuffer.prototype.allocate=function(t){if(t=this.position+t,!(null!=this.buf&&this.buf.length>t)){var e=new ArrayBuffer(Math.max(256,2*t));null!=this.buf&&(new Uint8Array(e).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=e,this.vew=void 0,this.vew=new DataView(this.buf)}},s.BinBuffer.prototype.getBuffer=function(){var t=new ArrayBuffer(this.len);return new Uint8Array(t).set(new Uint8Array(this.buf,0,this.len)),t},s.BinBuffer.prototype.memset=function(t,e,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(t,e,i),this.position)},s.BinBuffer.prototype.writeInt8=function(t){this.allocate(1),this.vew.setInt8(this.position,t),this.position+=1,this.len=this.position},s.BinBuffer.prototype.writeUInt8=function(t){this.allocate(1),this.vew.setUint8(this.position++,t),this.len=this.position},s.BinBuffer.prototype.writeInt16=function(t){this.allocate(2),this.vew.setInt16(this.position,t),this.position+=2,this.len=this.position},s.BinBuffer.prototype.writeUInt16=function(t){this.allocate(2),this.vew.setUint16(this.position,t),this.position+=2,this.len=this.position},s.BinBuffer.prototype.writeInt32=function(t){this.allocate(4),this.vew.setInt32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeUInt32=function(t){this.allocate(4),this.vew.setUint32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeInt64=function(t){this.allocate(8),this.vew.setUint32(this.position,parseInt(t/4294967296)),this.vew.setUint32(this.position+4,t%4294967296),this.position+=8,this.len=this.position},s.BinBuffer.prototype.writeFloat=function(t){this.allocate(4),this.vew.setFloat32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeDouble=function(t){this.allocate(8),this.vew.setFloat64(this.position,t),this.position+=8,this.len=this.position},s.BinBuffer.prototype.writeString=function(t){for(var e=[],i=0;i<t.length;i++)e.push(255&t.charCodeAt(i));this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e),this.position),this.position+=e.length,this.len=this.position},s.BinBuffer.prototype.writeBytes=function(t){0!=t.length&&null!=t.buf&&(this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t.buf,0,t.length),this.position),this.position+=t.length,this.len=this.position)},s.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},s.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},s.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},s.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},s.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},s.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},s.BinBuffer.prototype.readInt64=function(){var t=this.vew.getUint32(this.position),e=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*t+e},s.BinBuffer.prototype.readFloat=function(){var t=this.vew.getFloat32(this.position);return this.position+=4,t},s.BinBuffer.prototype.readDouble=function(){var t=this.vew.getFloat64(this.position);return this.position+=8,t},s.BinBuffer.prototype.readString=function(t){for(var e=[],i=0;i<t;i++)e.push(String.fromCharCode(this.vew.getUint8(this.position++)));var s=e.join("");try{s=decodeURIComponent(escape(s))}catch(t){}return s},s.BinBuffer.prototype.readBytes=function(t){var e=new s.BinBuffer;return e.allocate(t),e.memset(this.buf,this.position,t),e.position=0,e.len=t,this.position=this.position+t,e},s.JceOutputStream=function(){this.buf=new s.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},s.JceOutputStream.prototype.clear=function(){return this.buf=new s.BinBuffer,this},s.JceOutputStream.prototype.writeTo=function(t,e){t<15?this.buf.writeUInt8(t<<4&240|e):this.buf.writeUInt16((240|e)<<8|t)},s.JceOutputStream.prototype.writeBoolean=function(t,e){this.writeInt8(t,1==e?1:0)},s.JceOutputStream.prototype.writeInt8=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_INT8),this.buf.writeInt8(e))},s.JceOutputStream.prototype.writeInt16=function(t,e){e>=-128&&e<=127?this.writeInt8(t,e):(this.writeTo(t,s.DataHelp.EN_INT16),this.buf.writeInt16(e))},s.JceOutputStream.prototype.writeInt32=function(t,e){e>=-32768&&e<=32767?this.writeInt16(t,e):(this.writeTo(t,s.DataHelp.EN_INT32),this.buf.writeInt32(e))},s.JceOutputStream.prototype.writeInt64=function(t,e){e>=-2147483648&&e<=2147483647?this.writeInt32(t,e):(this.writeTo(t,s.DataHelp.EN_INT64),this.buf.writeInt64(e))},s.JceOutputStream.prototype.writeUInt8=function(t,e){this.writeInt16(t,e)},s.JceOutputStream.prototype.writeUInt16=function(t,e){this.writeInt32(t,e)},s.JceOutputStream.prototype.writeUInt32=function(t,e){this.writeInt64(t,e)},s.JceOutputStream.prototype.writeFloat=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_FLOAT),this.buf.writeFloat(e))},s.JceOutputStream.prototype.writeDouble=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_DOUBLE),this.buf.writeDouble(e))},s.JceOutputStream.prototype.writeStruct=function(t,e){if(null==e.writeTo)throw Error("not defined writeTo Function");this.writeTo(t,s.DataHelp.EN_STRUCTBEGIN),e.writeTo(this),this.writeTo(0,s.DataHelp.EN_STRUCTEND)},s.JceOutputStream.prototype.writeString=function(t,e){var i=e;try{i=unescape(encodeURIComponent(i))}catch(t){}i.length>255?(this.writeTo(t,s.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(t,s.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},s.JceOutputStream.prototype.writeBytes=function(t,e){this.writeTo(t,s.DataHelp.EN_SIMPLELIST),this.writeTo(0,s.DataHelp.EN_INT8),this.writeInt32(0,e.length),this.buf.writeBytes(e)},s.JceOutputStream.prototype.writeVector=function(t,e){this.writeTo(t,s.DataHelp.EN_LIST),this.writeInt32(0,e.value.length);for(var i=0;i<e.value.length;i++)e.proto._write(this,0,e.value[i])},s.JceOutputStream.prototype.writeMap=function(t,e){for(var i in this.writeTo(t,s.DataHelp.EN_MAP),this.writeInt32(0,e.size()),e.value)e.kproto._write(this,0,i),e.vproto._write(this,1,e.value[i])},s.JceInputStream=function(t){this.buf=new s.BinBuffer(t)},s.JceInputStream.prototype.setBuffer=function(t){return this.buf=new s.BinBuffer(t),this},s.JceInputStream.prototype.readFrom=function(){var t=this.buf.readUInt8(),e=(240&t)>>4,i=15&t;return e>=15&&(e=this.buf.readUInt8()),{tag:e,type:i}},s.JceInputStream.prototype.peekFrom=function(){var t=this.buf.position,e=this.readFrom();return this.buf.position=t,{tag:e.tag,type:e.type,size:e.tag>=15?2:1}},s.JceInputStream.prototype.skipField=function(t){switch(t){case s.DataHelp.EN_INT8:this.buf.position+=1;break;case s.DataHelp.EN_INT16:this.buf.position+=2;break;case s.DataHelp.EN_INT32:this.buf.position+=4;break;case s.DataHelp.EN_INT64:this.buf.position+=8;break;case s.DataHelp.EN_STRING1:var e=this.buf.readUInt8();this.buf.position+=e;break;case s.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case s.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case s.DataHelp.EN_STRUCTEND:case s.DataHelp.EN_ZERO:break;case s.DataHelp.EN_MAP:for(var r=this.readInt32(0,!0),a=0;a<2*r;++a){var o=this.readFrom();this.skipField(o.type)}break;case s.DataHelp.EN_SIMPLELIST:if((o=this.readFrom()).type!=s.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+t+","+o.type);e=this.readInt32(0,!0),this.buf.position+=e;break;case s.DataHelp.EN_LIST:for(r=this.readInt32(0,!0),a=0;a<r;++a)o=this.readFrom(),this.skipField(o.type);break;default:throw new Error("skipField with invalid type, type value: "+t)}},s.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var t=this.readFrom();if(this.skipField(t.type),t.type==s.DataHelp.EN_STRUCTEND)return}},s.JceInputStream.prototype.skipToTag=function(t,e){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(t<=i.tag||i.type==s.DataHelp.EN_STRUCTEND)return i.type!=s.DataHelp.EN_STRUCTEND&&t==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(e)throw Error("require field not exist, tag:"+t);return!1},s.JceInputStream.prototype.readBoolean=function(t,e,i){return 1==this.readInt8(t,e,i)},s.JceInputStream.prototype.readInt8=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt16=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt32=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16();case s.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt64=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16();case s.DataHelp.EN_INT32:return this.buf.readInt32();case s.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readFloat=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readDouble=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readUInt8=function(t,e,i){return this.readInt16(t,e,i)},s.JceInputStream.prototype.readUInt16=function(t,e,i){return this.readInt32(t,e,i)},s.JceInputStream.prototype.readUInt32=function(t,e,i){return this.readInt64(t,e,i)},s.JceInputStream.prototype.readStruct=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+t+", get type:"+r.type);return i.readFrom(this),this.skipToStructEnd(),i},s.JceInputStream.prototype.readString=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(r.type==s.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+r.type+".")},s.JceInputStream.prototype.readString2=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(r.type==s.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+r.type+".")},s.JceInputStream.prototype.readBytes=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_SIMPLELIST){var a=this.readFrom();if(a.type!=s.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+t+",type:"+r.type+","+a.type);if((o=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+t+",type:"+r.type+","+a.type);return this.buf.readBytes(o)}if(r.type==s.DataHelp.EN_LIST){var o=this.readInt32(0,!0);return this.buf.readBytes(o)}throw Error("type mismatch, tag:"+t+",type:"+r.type)},s.JceInputStream.prototype.readVector=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+t+", get type: "+r.type);var a=this.readInt32(0,!0);if(a<0)throw Error("invalid size, tag: "+t+", type: "+r.type+", size: "+a);for(var o=0;o<a;++o)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},s.JceInputStream.prototype.readMap=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+t+", get type: "+r.type);var a=this.readInt32(0,!0);if(a<0)throw Error("invalid map, tag: "+t+", size: "+a);for(var o=0;o<a;o++){var n=i.kproto._read(this,0,i.kproto._clone()),h=i.vproto._read(this,1,i.vproto._clone());i.put(n,h)}return i},s.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new s.BinBuffer,this.iTimeout=0,this.context=new s.Map(new s.STRING,new s.STRING),this.status=new s.Map(new s.STRING,new s.STRING),this.data=new s.Map(new s.STRING,new s.Map(new s.STRING,new s.BinBuffer)),this.newdata=new s.Map(new s.STRING,new s.BinBuffer),this.iStream=new s.JceInputStream,this.oStream=new s.JceOutputStream},s.Wup.prototype.hasKey=function(t){return this.newdata.hasKey(t)},s.Wup.prototype.setVersion=function(t){this.iVersion=t},s.Wup.prototype.getVersion=function(t){return this.iVersion},s.Wup.prototype.setServant=function(t){this.sServantName=t},s.Wup.prototype.setFunc=function(t){this.sFuncName=t},s.Wup.prototype.setRequestId=function(t){this.iRequestId=t||++this.iRequestId},s.Wup.prototype.getRequestId=function(){return this.iRequestId},s.Wup.prototype.setTimeOut=function(t){this.iTimeout=t},s.Wup.prototype.getTimeOut=function(){return this.iTimeout},s.Wup.prototype.writeTo=function(){var t=this.oStream.clear();return t.writeInt16(1,this.iVersion),t.writeInt8(2,this.cPacketType),t.writeInt32(3,this.iMessageType),t.writeInt32(4,this.iRequestId),t.writeString(5,this.sServantName),t.writeString(6,this.sFuncName),t.writeBytes(7,this.sBuffer),t.writeInt32(8,this.iTimeout),t.writeMap(9,this.context),t.writeMap(10,this.status),new s.BinBuffer(t.getBuffer())},s.Wup.prototype.encode=function(){var t=this.oStream.clear();3==this.iVersion?t.writeMap(0,this.newdata):t.writeMap(0,this.data),this.sBuffer=t.getBinBuffer();var e=this.writeTo(),i=new s.BinBuffer;return i.writeInt32(4+e.len),i.writeBytes(e),i},s.Wup.prototype.writeBoolean=function(t,e){var i=this.oStream.clear();if(i.writeBoolean(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.BOOLEAN;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new s.BinBuffer(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt8=function(t,e){var i=this.oStream.clear();if(i.writeInt8(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.CHAR;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new s.BinBuffer(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt16=function(t,e){var i=this.oStream.clear();if(i.writeInt16(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.SHORT;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt32=function(t,e){var i=this.oStream.clear();if(i.writeInt32(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.INT32;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt64=function(t,e){var i=this.oStream.clear();if(i.writeInt64(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.INT64;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeFloat=function(t,e){var i=this.oStream.clear();if(i.writeFloat(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.FLOAT;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeDouble=function(t,e){var i=this.oStream.clear();if(i.writeDouble(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.DOUBLE;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeString=function(t,e){var i=this.oStream.clear();if(i.writeString(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=s.TypeHelp.STRING;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeVector=function(t,e){var i=this.oStream.clear();if(i.writeVector(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBinBuffer()));else{var r=this.data.get(t),a=e._className();null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeStruct=function(t,e){var i=this.oStream.clear();if(i.writeStruct(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(" ",new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeBytes=function(t,e){var i=this.oStream.clear();if(i.writeBytes(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put("vec",new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeMap=function(t,e){var i=this.oStream.clear();if(i.writeMap(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=s.Util.getClassType(e);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.readFrom=function(t){this.iVersion=t.readInt16(1,!0),this.cPacketType=t.readInt8(2,!0),this.iMessageType=t.readInt32(3,!0),this.iRequestId=t.readInt32(4,!0),this.sServantName=t.readString(5,!0),this.sFuncName=t.readString(6,!0),this.sBuffer=t.readBytes(7,!0),this.iTimeout=t.readInt32(8,!0),this.context=t.readMap(9,!0,this.context),this.status=t.readMap(10,!0,this.status)},s.Wup.prototype.decode=function(t){var e=this.iStream.setBuffer(t);if(e.buf.vew.getInt32(e.buf.position)<4)throw Error("packet length too short");e.buf.position+=4,this.readFrom(e),e=this.iStream.setBuffer(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),e.readMap(0,!0,this.newdata)):(this.data.clear(),e.readMap(0,!0,this.data))},s.Wup.prototype.readBoolean=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readBoolean(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.BOOLEAN,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readBoolean(0,!0,i)}return i},s.Wup.prototype.readInt8=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt8(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.CHAR,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt8(0,!0,i)}return i},s.Wup.prototype.readInt16=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=(o=this.iStream.setBuffer(e.buffer)).readInt16(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.SHORT,a=e.get(r),o=this.iStream.setBuffer(a);if(null==a)throw Error("UniAttribute not found type:"+r);i=o.readInt16(0,!0,i)}return i},s.Wup.prototype.readInt32=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt32(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.INT32,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt32(0,!0,i)}return i},s.Wup.prototype.readInt64=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt64(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.INT64,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt64(0,!0,i)}return i},s.Wup.prototype.readFloat=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readFloat(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.FLOAT,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readFloat(0,!0,i)}return i},s.Wup.prototype.readDouble=function(t){var e;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);var i=this.iStream.setBuffer(e.buffer);def=i.readDouble(0,!0,def)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.DOUBLE,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a),def=i.readDouble(0,!0,def)}return def},s.Wup.prototype.readVector=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readVector(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readVector(0,!0,e)}return e},s.Wup.prototype.readStruct=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readStruct(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readStruct(0,!0,e)}return e},s.Wup.prototype.readMap=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readMap(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readMap(0,!0,e)}return e},s.Wup.prototype.readBytes=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readBytes(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readBytes(0,!0,e)}return e},s.Util=s.Util||{},s.Util.jcestream=function(t,e){if(null!=t&&null!=t)if(t instanceof ArrayBuffer){e=e||16;for(var i=new Uint8Array(t),s="",r=0;r<i.length;r++)0!=r&&r%e==0?s+="\n":0!=r&&(s+=" "),s+=(i[r]>15?"":"0")+i[r].toString(16);console.log(s.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},s.Util.str2ab=function(t){var e,i=t.length,s=new Array(i);for(e=0;e<i;++e)s[e]=t.charCodeAt(e);return new Uint8Array(s).buffer},s.Util.ajax=function(t,e,i,r){var a=new XMLHttpRequest;a.overrideMimeType("text/plain; charset=x-user-defined"),a.addEventListener("readystatechange",(function t(){4===a.readyState&&(200===a.status||304===a.status?i(s.Util.str2ab(a.response)):r(a.status),a.removeEventListener("readystatechange",t),a=void 0)})),a.open("post",t),a.send(e)}},function(t,e,i){var s=i(14),r=i(23),a=i(42)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),s(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){t.exports=!i(6)&&!i(15)((function(){return 7!=Object.defineProperty(i(77)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,i){var s=i(11),r=i(8).document,a=s(r)&&s(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},function(t,e,i){"use strict";e.__esModule=!0;var s=o(i(119)),r=o(i(129)),a="function"==typeof r.default&&"symbol"==typeof s.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};function o(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof r.default&&"symbol"===a(s.default)?function(t){return void 0===t?"undefined":a(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":a(t)}},function(t,e,i){t.exports=i(12)},function(t,e,i){var s=i(14),r=i(18),a=i(124)(!1),o=i(42)("IE_PROTO");t.exports=function(t,e){var i,n=r(t),h=0,d=[];for(i in n)i!=o&&s(n,i)&&d.push(i);for(;e.length>h;)s(n,i=e[h++])&&(~a(d,i)||d.push(i));return d}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){var s=i(49);t.exports=Array.isArray||function(t){return"Array"==s(t)}},function(t,e,i){var s=i(80),r=i(51).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,r)}},function(t,e,i){var s=i(33),r=i(29),a=i(18),o=i(44),n=i(14),h=i(76),d=Object.getOwnPropertyDescriptor;e.f=i(6)?d:function(t,e){if(t=a(t),e=o(e,!0),h)try{return d(t,e)}catch(t){}if(n(t,e))return r(!s.f.call(t,e),t[e])}},function(t,e){},function(t,e,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function n(){n.init.call(this)}t.exports=n,t.exports.once=function(t,e){return new Promise((function(i,s){function r(i){t.removeListener(e,a),s(i)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}g(t,e,a,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&g(t,"error",e,{once:!0})}(t,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var h=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function c(t,e,i,s){var r,a,o,n;if(d(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=s?[i,o]:[o,i]:s?o.unshift(i):o.push(i),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,n=h,console&&console.warn&&console.warn(n)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=u.bind(s);return r.listener=i,s.wrapFn=r,r}function m(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):f(r,r.length)}function _(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}function g(t,e,i,s){if("function"==typeof t.on)s.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(a){s.once&&t.removeEventListener(e,r),i(a)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var n=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw n.context=o,n}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)a(h,this,e);else{var d=h.length,l=f(h,d);for(i=0;i<d;++i)a(l[i],this,e)}return!0},n.prototype.addListener=function(t,e){return c(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return c(this,t,e,!0)},n.prototype.once=function(t,e){return d(e),this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,s,r,a,o;if(d(e),void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,o||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},n.prototype.listeners=function(t){return m(this,t,!0)},n.prototype.rawListeners=function(t){return m(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},n.prototype.listenerCount=_,n.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,e,i){var s=i(12);t.exports=function(t,e,i){for(var r in e)i&&t[r]?t[r]=e[r]:s(t,r,e[r]);return t}},function(t,e){t.exports=function(t,e,i,s){if(!(t instanceof e)||void 0!==s&&s in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var s=i(90),r=i(7)("iterator"),a=i(25);t.exports=i(3).getIteratorMethod=function(t){if(null!=t)return t[r]||t["@@iterator"]||a[s(t)]}},function(t,e,i){var s=i(49),r=i(7)("toStringTag"),a="Arguments"==s(function(){return arguments}());t.exports=function(t){var e,i,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:a?s(e):"Object"==(o=s(e))&&"function"==typeof e.callee?"Arguments":o}},function(t,e,i){var s=i(11);t.exports=function(t,e){if(!s(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){var s={"./CdnAllocateInfo":58,"./CdnAllocateInfo.js":58,"./CdnGroupID":20,"./CdnGroupID.js":20,"./CurrentCdnProxyInfo":60,"./CurrentCdnProxyInfo.js":60,"./PCDNGetProxyListReq":93,"./PCDNGetProxyListReq.js":93,"./PCDNGetProxyListRsp":94,"./PCDNGetProxyListRsp.js":94,"./PP2pSliceAudioData":95,"./PP2pSliceAudioData.js":95,"./PP2pSliceAudioDataV2":96,"./PP2pSliceAudioDataV2.js":96,"./PP2pSliceAudioDataV3":97,"./PP2pSliceAudioDataV3.js":97,"./PP2pSliceControlData":98,"./PP2pSliceControlData.js":98,"./PP2pSliceData":61,"./PP2pSliceData.js":61,"./PP2pSliceVideoData":99,"./PP2pSliceVideoData.js":99,"./SlaveProxyInfo":36,"./SlaveProxyInfo.js":36,"./StreamCodecType":59,"./StreamCodecType.js":59};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=92},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(160)),r=l(i(10)),a=l(i(0)),o=l(i(1)),n=l(i(4)),h=l(i(2)),d=(l(i(20)),l(i(60)));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(){(0,a.default)(this,t),this.uid=0,this.version=0,this.cdnGroupIdList=[],this.currentInfo=new d.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.appId=0,this.anchorStreamNam2UId=new r.default}return(0,o.default)(t,[{key:"marshall",value:function(){var t=new h.default;t.setUri(n.default.PCDNGetProxyListReq),t.pushUInt64(this.uid),t.pushUInt8(this.version),t.pushUInt32(this.cdnGroupIdList.length),this.cdnGroupIdList.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())})),t.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),t.pushUInt8(this.appid),t.pushUInt32(this.clientAppid),t.pushUInt32(this.clientType),t.pushUInt32(this.ip),t.pushUInt32(this.sendTime),t.pushUInt32(this.sdkVersion),t.pushUInt64(this.imsi),t.pushUInt32(this.appId),t.pushUInt32(this.anchorStreamNam2UId.size);var e=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.anchorStreamNam2UId.keys());!(e=(a=o.next()).done);e=!0){var d=a.value;t.pushString(d),t.pushUInt64(this.anchorStreamNam2UId.get(d))}}catch(t){i=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw r}}return t.marshall()}}]),t}();e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=(o(i(4)),o(i(58)));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.uid=0,this.allocatedStreams=[],this.clientAppid=0,this.clientType=0,this.sendTime=0,this.userArea=0,this.videoGroupId=0,this.retryType=0,this.retryFreq=0,this.result=0,this.proxyType=0,this.tokenVersion=0,this.sslUrl="",this.appId=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.allocatedStreams=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new a.default;this.allocatedStreams.push(s.unmarshall(t))}return this.clientAppid=t.popUInt32(),this.clientType=t.popUInt32(),this.sendTime=t.popUInt32(),this.userArea=t.popUInt32(),this.videoGroupId=t.popUInt32(),this.retryType=t.popUInt8(),this.retryFreq=t.popUInt16(),this.result=t.popUInt32(),this.proxyType=t.popUInt32(),this.tokenVersion=t.popUInt32(),this.sslUrl=t.popString(),this.appId=t.popUInt32(),this}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(4)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.checkSum=0,this.codecType=0,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceAudioData),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){return this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.streamData=t.popUint8Array(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(4));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default;t.setUri(o.default.PP2pSliceAudioDataV2),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUint8Array(this.audioHeader),t.pushUint8Array(this.streamData)}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.audioHeader=t.popUint8Array(),this.streamData=t.popUint8Array()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(4));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default;return t.setUri(o.default.PP2pSliceAudioDataV3),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUint8Array(this.audioHeader),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.audioHeader=t.popUint8Array(),this.streamData=t.popUint8Array()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(4)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.strData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceControlData),t.pushUint8Array(this.strData),t.marshall()}},{key:"unmarshall",value:function(t){return this.strData=t.popUint8Array(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(10)),r=h(i(0)),a=h(i(1)),o=h(i(4)),n=h(i(2));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(){(0,r.default)(this,t),this.seq=0,this.uid=0,this.isResend=!1,this.checkSum=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.config=new s.default,this.streamData=null}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new n.default;return t.setUri(o.default.PP2pSliceVideoData),t.pushUInt8(this.checkSum),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUInt32(this.config.size),this.config.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.config.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.config.set(s,r)}return this.streamData=t.popUint8Array(),this}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.strToken=""}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushString(this.strToken),t.marshall()}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[]}return(0,r.default)(t,[{key:"unmarshall",value:function(t){return this.ip=t.popUInt32(),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ACCEPT_SUBSCRIBE:0,EMPTY_UPLINK_BW:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,SUBSCRIBER_NO_PERMISSION:15}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.ssrc=0,this.framenum=0,this.type=0,this.framebase=0,this.critical=!1,this.payload=null,this.transMode=0,this.packData=!1,this.bHasVideoSid=!1,this.byteVoiceMarks=0,this.capTimeStamp=0,this.m_isMarshalVoiceMarks=!1}return(0,r.default)(t,[{key:"unmarshall",value:function(e){this.capTimeStamp=e.popUInt32(),this.ssrc=e.popUInt8();var i=e.popUInt8();return this.type=e.popUInt16(),this.framebase=e.popUInt32(),this.payload=e.popUint8Array(),e.bytesAvailable()?this.byteVoiceMarks=e.popUInt8():this.byteVoiceMarks=t.VOICE_MARK_KEY_BIT0,this.framenum=i&t.FRAMENUM_MASK,this.critical=!!(i&t.CRITICAL_MASK),this.bHasVideoSid=!!(i&t.VIDEOSID_MASK),this.transMode=1+((i&t.FTMMODE_MASK)>>4),this}},{key:"setIsKeyVoice",value:function(e){this.byteVoiceMarks|=e?t.VOICE_MARK_KEY_BIT0:0}},{key:"isKeyVoice",get:function(){return this.byteVoiceMarks&t.VOICE_MARK_KEY_BIT0}}]),t}();o.FRAMENUM_MASK=15,o.FTMMODE_MASK=48,o.VIDEOSID_MASK=64,o.CRITICAL_MASK=128,o.VOICE_MARK_KEY_BIT0=1,e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.strToken=""}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushString(this.strToken),t.marshall()}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(e))return a.substr(e.length)}return""}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.listeners={}}return(0,r.default)(t,[{key:"clear",value:function(){this.listeners={}}},{key:"has",value:function(t,e,i){var s=this.listeners[t];if(!s)return!1;for(var r=0,a=s.length;r<a;r++){var o=s[r];if(o.callback==e&&o.thisObj==i)return!0}return!1}},{key:"on",value:function(t,e,i,s){if(!this.has(t,e,i)){var r=this.listeners[t]||[];r.push({priority:s||0,callback:e,thisObj:i,bindCallback:i?e.bind(i):e}),r.sort((function(t,e){return e.priority-t.priority})),this.listeners[t]=r}}},{key:"off",value:function(t,e,i){var s=this.listeners[t];if(s)for(var r=s.length-1;r>=0;r--){var a=s[r];if(a.callback==e&&a.thisObj==i)return void s.splice(r,1)}}},{key:"trigger",value:function(t,e){var i=this.listeners[t];if(i)for(var s=i.length-1;s>=0;s--)(0,i[s].bindCallback)(e)}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.systime=0,this.encode_delay=0,this.send_buffer=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.systime=t.popUInt64(),this.encode_delay=t.popUInt32(),this.send_buffer=t.popUInt32()}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(70)),o=n(i(71));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.anchorSei=new a.default,this.serverSei=new o.default}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.anchorSei.unmarshall(t),this.serverSei.unmarshall(t)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=C(i(40)),r=C(i(110)),a=C(i(111)),o=C(i(164)),n=C(i(4)),h=C(i(2)),d=C(i(34)),l=C(i(166)),c=C(i(167)),u=C(i(20)),p=C(i(61)),m=C(i(73)),_=C(i(170)),f=C(i(106)),g=C(i(19)),S=C(i(171)),y=C(i(69)),T=C(i(172)),P=C(i(174)),v=C(i(16)),E=C(i(179));function C(t){return t&&t.__esModule?t:{default:t}}e.default={setLogger:function(t){v.default.logger=t},TafBase:m.default,HUYA:s.default,HUYA_Local:r.default,ProtoUri:n.default,ProtoMarshall:h.default,ProtoUnmarshall:d.default,TafLinkImpl:a.default,NtpImpl:o.default,SignalRttImpl:l.default,TafLinkSignalImpl:c.default,MediaLink:_.default,ListenerImpl:f.default,TimeUtilImpl:g.default,BrowserImpl:P.default,CdnGroupID:u.default,PP2pSliceData:p.default,PcdnVodProxy:E.default,ProtoHandler:y.default,SliceProtoHandler:S.default,SeiProtoHandler:T.default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=(s=i(73))&&s.__esModule?s:{default:s},a={};e.default=a,a.EWebSocketCommandType={EWSCmd_NULL:0,EWSCmd_RegisterReq:1,EWSCmd_RegisterRsp:2,EWSCmd_WupReq:3,EWSCmd_WupRsp:4,EWSCmdC2S_HeartBeat:5,EWSCmdS2C_HeartBeatAck:6,EWSCmdS2C_MsgPushReq:7,EWSCmdC2S_DeregisterReq:8,EWSCmdS2C_DeRegisterRsp:9,EWSCmdC2S_VerifyCookieReq:10,EWSCmdS2C_VerifyCookieRsp:11,EWSCmdC2S_VerifyHuyaTokenReq:12,EWSCmdS2C_VerifyHuyaTokenRsp:13,EWSCmdC2S_UNVerifyReq:14,EWSCmdS2C_UNVerifyRsp:15,EWSCmdC2S_RegisterGroupReq:16,EWSCmdS2C_RegisterGroupRsp:17,EWSCmdC2S_UnRegisterGroupReq:18,EWSCmdS2C_UnRegisterGroupRsp:19,EWSCmdC2S_HeartBeatReq:20,EWSCmdS2C_HeartBeatRsp:21,EWSCmdS2C_MsgPushReq_V2:22},a.WebSocketCommand=function(){this.iCmdType=0,this.vData=new r.default.BinBuffer,this.lRequestId=0,this.traceId=""},a.WebSocketCommand.prototype._clone=function(){return new a.WebSocketCommand},a.WebSocketCommand.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WebSocketCommand.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WebSocketCommand.prototype.writeTo=function(t){t.writeInt32(0,this.iCmdType),t.writeBytes(1,this.vData),t.writeInt64(2,this.lRequestId),t.writeString(3,this.traceId)},a.WebSocketCommand.prototype.readFrom=function(t){this.iCmdType=t.readInt32(0,!1,this.iCmdType),this.vData=t.readBytes(1,!1,this.vData),this.lRequestId=t.readInt64(2,!1,this.lRequestId),this.traceId=t.readString(3,!1,this.traceId)},a.WSPushMessage=function(){this.ePushType=0,this.iUri=0,this.sMsg=new r.default.BinBuffer,this.iProtocolType=0,this.sGroupId=""},a.WSPushMessage.prototype._clone=function(){return new a.WSPushMessage},a.WSPushMessage.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSPushMessage.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSPushMessage.prototype.writeTo=function(t){t.writeInt32(0,this.ePushType),t.writeInt64(1,this.iUri),t.writeBytes(2,this.sMsg),t.writeInt32(3,this.iProtocolType),t.writeString(4,this.sGroupId)},a.WSPushMessage.prototype.readFrom=function(t){this.ePushType=t.readInt32(0,!1,this.ePushType),this.iUri=t.readInt64(1,!1,this.iUri),this.sMsg=t.readBytes(2,!1,this.sMsg),this.iProtocolType=t.readInt32(3,!1,this.iProtocolType),this.sGroupId=t.readString(4,!1,this.sGroupId)},a.WSUserInfo=function(){this.lUid=0,this.bAnonymous=!0,this.sGuid="",this.sToken="",this.lTid=0,this.lSid=0,this.lGroupId=0,this.lGroupType=0,this.sAppId="",this.sUA=""},a.WSUserInfo.prototype._clone=function(){return new a.WSUserInfo},a.WSUserInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSUserInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSUserInfo.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeBoolean(1,this.bAnonymous),t.writeString(2,this.sGuid),t.writeString(3,this.sToken),t.writeInt64(4,this.lTid),t.writeInt64(5,this.lSid),t.writeInt64(6,this.lGroupId),t.writeInt64(7,this.lGroupType),t.writeString(8,this.sAppId),t.writeString(9,this.sUA)},a.WSUserInfo.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.bAnonymous=t.readBoolean(1,!1,this.bAnonymous),this.sGuid=t.readString(2,!1,this.sGuid),this.sToken=t.readString(3,!1,this.sToken),this.lTid=t.readInt64(4,!1,this.lTid),this.lSid=t.readInt64(5,!1,this.lSid),this.lGroupId=t.readInt64(6,!1,this.lGroupId),this.lGroupType=t.readInt64(7,!1,this.lGroupType),this.sAppId=t.readString(8,!1,this.sAppId),this.sUA=t.readString(9,!1,this.sUA)},a.WSRegisterRsp=function(){this.iResCode=0,this.lRequestId=0,this.sMessage="",this.sBCConnHost=""},a.WSRegisterRsp.prototype._clone=function(){return new a.WSRegisterRsp},a.WSRegisterRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeInt64(1,this.lRequestId),t.writeString(2,this.sMessage),t.writeString(3,this.sBCConnHost)},a.WSRegisterRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.lRequestId=t.readInt64(1,!1,this.lRequestId),this.sMessage=t.readString(2,!1,this.sMessage),this.sBCConnHost=t.readString(3,!1,this.sBCConnHost)},a.UserChannelReq=function(){this.tId=new a.UserId,this.lTopcid=0,this.lSubcid=0,this.sSendContent=""},a.UserChannelReq.prototype._clone=function(){return new a.UserChannelReq},a.UserChannelReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserChannelReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserChannelReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopcid),t.writeInt64(2,this.lSubcid),t.writeString(3,this.sSendContent)},a.UserChannelReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopcid=t.readInt64(1,!1,this.lTopcid),this.lSubcid=t.readInt64(2,!1,this.lSubcid),this.sSendContent=t.readString(3,!1,this.sSendContent)},a.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},a.UserId.prototype._clone=function(){return new a.UserId},a.UserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sHuYaUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType)},a.UserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sHuYaUA=t.readString(3,!1,this.sHuYaUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType)},a.LiveLaunchReq=function(){this.tId=new a.UserId,this.tLiveUB=new a.LiveUserbase,this.bSupportDomain=0},a.LiveLaunchReq.prototype._clone=function(){return new a.LiveLaunchReq},a.LiveLaunchReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveLaunchReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveLaunchReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeStruct(1,this.tLiveUB),t.writeInt32(2,this.bSupportDomain)},a.LiveLaunchReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.tLiveUB=t.readStruct(1,!1,this.tLiveUB),this.bSupportDomain=t.readInt32(2,!1,this.bSupportDomain)},a.LiveLaunchRsp=function(){this.sGuid="",this.iTime=0,this.vProxyList=new r.default.Vector(new a.LiveProxyValue),this.eAccess=0,this.sClientIp=""},a.LiveLaunchRsp.prototype._clone=function(){return new a.LiveLaunchRsp},a.LiveLaunchRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveLaunchRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveLaunchRsp.prototype.writeTo=function(t){t.writeString(0,this.sGuid),t.writeInt32(1,this.iTime),t.writeVector(2,this.vProxyList),t.writeInt32(3,this.eAccess),t.writeString(4,this.sClientIp)},a.LiveLaunchRsp.prototype.readFrom=function(t){this.sGuid=t.readString(0,!1,this.sGuid),this.iTime=t.readInt32(1,!1,this.iTime),this.vProxyList=t.readVector(2,!1,this.vProxyList),this.eAccess=t.readInt32(3,!1,this.eAccess),this.sClientIp=t.readString(4,!1,this.sClientIp)},a.LiveUserbase=function(){this.eSource=0,this.eType=0,this.tUAEx=new a.LiveAppUAEx},a.LiveUserbase.prototype._clone=function(){return new a.LiveUserbase},a.LiveUserbase.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveUserbase.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveUserbase.prototype.writeTo=function(t){t.writeInt32(0,this.eSource),t.writeInt32(1,this.eType),t.writeStruct(2,this.tUAEx)},a.LiveUserbase.prototype.readFrom=function(t){this.eSource=t.readInt32(0,!1,this.eSource),this.eType=t.readInt32(1,!1,this.eType),this.tUAEx=t.readStruct(2,!1,this.tUAEx)},a.LiveAppUAEx=function(){this.sIMEI="",this.sAPN="",this.sNetType="",this.sDeviceId=""},a.LiveAppUAEx.prototype._clone=function(){return new a.LiveAppUAEx},a.LiveAppUAEx.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveAppUAEx.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveAppUAEx.prototype.writeTo=function(t){t.writeString(1,this.sIMEI),t.writeString(2,this.sAPN),t.writeString(3,this.sNetType),t.writeString(4,this.sDeviceId)},a.LiveAppUAEx.prototype.readFrom=function(t){this.sIMEI=t.readString(1,!1,this.sIMEI),this.sAPN=t.readString(2,!1,this.sAPN),this.sNetType=t.readString(3,!1,this.sNetType),this.sDeviceId=t.readString(4,!1,this.sDeviceId)},a.LiveProxyValue=function(){this.eProxyType=0,this.sProxy=new r.default.Vector(new r.default.STRING)},a.LiveProxyValue.prototype._clone=function(){return new a.LiveProxyValue},a.LiveProxyValue.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveProxyValue.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveProxyValue.prototype.writeTo=function(t){t.writeInt32(0,this.eProxyType),t.writeVector(1,this.sProxy)},a.LiveProxyValue.prototype.readFrom=function(t){this.eProxyType=t.readInt32(0,!1,this.eProxyType),this.sProxy=t.readVector(1,!1,this.sProxy)},a.GetLivingInfoReq=function(){this.tId=new a.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource="",this.sPassword="",this.iRoomId=0,this.iFreeFlowFlag=0},a.GetLivingInfoReq.prototype._clone=function(){return new a.GetLivingInfoReq},a.GetLivingInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetLivingInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetLivingInfoReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopSid),t.writeInt64(2,this.lSubSid),t.writeInt64(3,this.lPresenterUid),t.writeString(4,this.sTraceSource),t.writeString(5,this.sPassword),t.writeInt64(6,this.iRoomId),t.writeInt32(7,this.iFreeFlowFlag)},a.GetLivingInfoReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopSid=t.readInt64(1,!1,this.lTopSid),this.lSubSid=t.readInt64(2,!1,this.lSubSid),this.lPresenterUid=t.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=t.readString(4,!1,this.sTraceSource),this.sPassword=t.readString(5,!1,this.sPassword),this.iRoomId=t.readInt64(6,!1,this.iRoomId),this.iFreeFlowFlag=t.readInt32(7,!1,this.iFreeFlowFlag)},a.GetLivingInfoRsp=function(){this.bIsLiving=0,this.tNotice=new a.BeginLiveNotice,this.tStreamSettingNotice=new a.StreamSettingNotice,this.bIsSelfLiving=0,this.sMessage=""},a.GetLivingInfoRsp.prototype._clone=function(){return new a.GetLivingInfoRsp},a.GetLivingInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetLivingInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetLivingInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.bIsLiving),t.writeStruct(1,this.tNotice),t.writeStruct(2,this.tStreamSettingNotice),t.writeInt32(3,this.bIsSelfLiving),t.writeString(4,this.sMessage)},a.GetLivingInfoRsp.prototype.readFrom=function(t){this.bIsLiving=t.readInt32(0,!1,this.bIsLiving),this.tNotice=t.readStruct(1,!1,this.tNotice),this.tStreamSettingNotice=t.readStruct(2,!1,this.tStreamSettingNotice),this.bIsSelfLiving=t.readInt32(3,!1,this.bIsSelfLiving),this.sMessage=t.readString(4,!1,this.sMessage)},a.BeginLiveNotice=function(){this.lPresenterUid=0,this.iGameId=0,this.sGameName="",this.iRandomRange=0,this.iStreamType=0,this.vStreamInfo=new r.default.Vector(new a.StreamInfo),this.vCdnList=new r.default.Vector(new r.default.STRING),this.lLiveId=0,this.iPCDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.lMultiStreamFlag=0,this.sNick="",this.lYYId=0,this.lAttendeeCount=0,this.iCodecType=0,this.iScreenType=0,this.vMultiStreamInfo=new r.default.Vector(new a.MultiStreamInfo),this.sLiveDesc="",this.lLiveCompatibleFlag=0,this.sAvatarUrl="",this.iSourceType=0,this.sSubchannelName="",this.sVideoCaptureUrl="",this.iStartTime=0,this.lChannelId=0,this.lSubChannelId=0,this.sLocation="",this.iCdnPolicyLevel=0,this.iGameType=0,this.mMiscInfo=new r.default.Map(new r.default.STRING,new r.default.STRING),this.iShortChannel=0,this.iRoomId=0,this.bIsRoomSecret=0,this.iHashPolicy=0},a.BeginLiveNotice.prototype._clone=function(){return new a.BeginLiveNotice},a.BeginLiveNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.BeginLiveNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.BeginLiveNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt32(1,this.iGameId),t.writeString(2,this.sGameName),t.writeInt32(3,this.iRandomRange),t.writeInt32(4,this.iStreamType),t.writeVector(5,this.vStreamInfo),t.writeVector(6,this.vCdnList),t.writeInt64(7,this.lLiveId),t.writeInt32(8,this.iPCDefaultBitRate),t.writeInt32(9,this.iWebDefaultBitRate),t.writeInt32(10,this.iMobileDefaultBitRate),t.writeInt64(11,this.lMultiStreamFlag),t.writeString(12,this.sNick),t.writeInt64(13,this.lYYId),t.writeInt64(14,this.lAttendeeCount),t.writeInt32(15,this.iCodecType),t.writeInt32(16,this.iScreenType),t.writeVector(17,this.vMultiStreamInfo),t.writeString(18,this.sLiveDesc),t.writeInt64(19,this.lLiveCompatibleFlag),t.writeString(20,this.sAvatarUrl),t.writeInt32(21,this.iSourceType),t.writeString(22,this.sSubchannelName),t.writeString(23,this.sVideoCaptureUrl),t.writeInt32(24,this.iStartTime),t.writeInt64(25,this.lChannelId),t.writeInt64(26,this.lSubChannelId),t.writeString(27,this.sLocation),t.writeInt32(28,this.iCdnPolicyLevel),t.writeInt32(29,this.iGameType),t.writeMap(30,this.mMiscInfo),t.writeInt32(31,this.iShortChannel),t.writeInt32(32,this.iRoomId),t.writeInt32(33,this.bIsRoomSecret),t.writeInt32(34,this.iHashPolicy)},a.BeginLiveNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.iGameId=t.readInt32(1,!1,this.iGameId),this.sGameName=t.readString(2,!1,this.sGameName),this.iRandomRange=t.readInt32(3,!1,this.iRandomRange),this.iStreamType=t.readInt32(4,!1,this.iStreamType),this.vStreamInfo=t.readVector(5,!1,this.vStreamInfo),this.vCdnList=t.readVector(6,!1,this.vCdnList),this.lLiveId=t.readInt64(7,!1,this.lLiveId),this.iPCDefaultBitRate=t.readInt32(8,!1,this.iPCDefaultBitRate),this.iWebDefaultBitRate=t.readInt32(9,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=t.readInt32(10,!1,this.iMobileDefaultBitRate),this.lMultiStreamFlag=t.readInt64(11,!1,this.lMultiStreamFlag),this.sNick=t.readString(12,!1,this.sNick),this.lYYId=t.readInt64(13,!1,this.lYYId),this.lAttendeeCount=t.readInt64(14,!1,this.lAttendeeCount),this.iCodecType=t.readInt32(15,!1,this.iCodecType),this.iScreenType=t.readInt32(16,!1,this.iScreenType),this.vMultiStreamInfo=t.readVector(17,!1,this.vMultiStreamInfo),this.sLiveDesc=t.readString(18,!1,this.sLiveDesc),this.lLiveCompatibleFlag=t.readInt64(19,!1,this.lLiveCompatibleFlag),this.sAvatarUrl=t.readString(20,!1,this.sAvatarUrl),this.iSourceType=t.readInt32(21,!1,this.iSourceType),this.sSubchannelName=t.readString(22,!1,this.sSubchannelName),this.sVideoCaptureUrl=t.readString(23,!1,this.sVideoCaptureUrl),this.iStartTime=t.readInt32(24,!1,this.iStartTime),this.lChannelId=t.readInt64(25,!1,this.lChannelId),this.lSubChannelId=t.readInt64(26,!1,this.lSubChannelId),this.sLocation=t.readString(27,!1,this.sLocation),this.iCdnPolicyLevel=t.readInt32(28,!1,this.iCdnPolicyLevel),this.iGameType=t.readInt32(29,!1,this.iGameType),this.mMiscInfo=t.readMap(30,!1,this.mMiscInfo),this.iShortChannel=t.readInt32(31,!1,this.iShortChannel),this.iRoomId=t.readInt32(32,!1,this.iRoomId),this.bIsRoomSecret=t.readInt32(33,!1,this.bIsRoomSecret),this.iHashPolicy=t.readInt32(34,!1,this.iHashPolicy)},a.StreamSettingNotice=function(){this.lPresenterUid=0,this.iBitRate=0,this.iResolution=0,this.iFrameRate=0,this.lLiveId=0,this.sDisplayName=""},a.StreamSettingNotice.prototype._clone=function(){return new a.StreamSettingNotice},a.StreamSettingNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.StreamSettingNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.StreamSettingNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iResolution),t.writeInt32(3,this.iFrameRate),t.writeInt64(4,this.lLiveId),t.writeString(5,this.sDisplayName)},a.StreamSettingNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iResolution=t.readInt32(2,!1,this.iResolution),this.iFrameRate=t.readInt32(3,!1,this.iFrameRate),this.lLiveId=t.readInt64(4,!1,this.lLiveId),this.sDisplayName=t.readString(5,!1,this.sDisplayName)},a.StreamInfo=function(){this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new r.default.Vector(new r.default.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new r.default.Vector(new r.default.STRING),this.mpExtArgs=new r.default.Map(new r.default.STRING,new r.default.STRING),this.lTimespan=0},a.StreamInfo.prototype._clone=function(){return new a.StreamInfo},a.StreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.StreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.StreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sCdnType),t.writeInt32(1,this.iIsMaster),t.writeInt64(2,this.lChannelId),t.writeInt64(3,this.lSubChannelId),t.writeInt64(4,this.lPresenterUid),t.writeString(5,this.sStreamName),t.writeString(6,this.sFlvUrl),t.writeString(7,this.sFlvUrlSuffix),t.writeString(8,this.sFlvAntiCode),t.writeString(9,this.sHlsUrl),t.writeString(10,this.sHlsUrlSuffix),t.writeString(11,this.sHlsAntiCode),t.writeInt32(12,this.iLineIndex),t.writeInt32(13,this.iIsMultiStream),t.writeInt32(14,this.iPCPriorityRate),t.writeInt32(15,this.iWebPriorityRate),t.writeInt32(16,this.iMobilePriorityRate),t.writeVector(17,this.vFlvIPList),t.writeInt32(18,this.iIsP2PSupport),t.writeString(19,this.sP2pUrl),t.writeString(20,this.sP2pUrlSuffix),t.writeString(21,this.sP2pAntiCode),t.writeInt64(22,this.lFreeFlag),t.writeInt32(23,this.iIsHEVCSupport),t.writeVector(24,this.vP2pIPList),t.writeMap(25,this.mpExtArgs),t.writeInt64(26,this.lTimespan)},a.StreamInfo.prototype.readFrom=function(t){this.sCdnType=t.readString(0,!1,this.sCdnType),this.iIsMaster=t.readInt32(1,!1,this.iIsMaster),this.lChannelId=t.readInt64(2,!1,this.lChannelId),this.lSubChannelId=t.readInt64(3,!1,this.lSubChannelId),this.lPresenterUid=t.readInt64(4,!1,this.lPresenterUid),this.sStreamName=t.readString(5,!1,this.sStreamName),this.sFlvUrl=t.readString(6,!1,this.sFlvUrl),this.sFlvUrlSuffix=t.readString(7,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=t.readString(8,!1,this.sFlvAntiCode),this.sHlsUrl=t.readString(9,!1,this.sHlsUrl),this.sHlsUrlSuffix=t.readString(10,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=t.readString(11,!1,this.sHlsAntiCode),this.iLineIndex=t.readInt32(12,!1,this.iLineIndex),this.iIsMultiStream=t.readInt32(13,!1,this.iIsMultiStream),this.iPCPriorityRate=t.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(16,!1,this.iMobilePriorityRate),this.vFlvIPList=t.readVector(17,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(18,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(19,!1,this.sP2pUrl),this.sP2pUrlSuffix=t.readString(20,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=t.readString(21,!1,this.sP2pAntiCode),this.lFreeFlag=t.readInt64(22,!1,this.lFreeFlag),this.iIsHEVCSupport=t.readInt32(23,!1,this.iIsHEVCSupport),this.vP2pIPList=t.readVector(24,!1,this.vP2pIPList),this.mpExtArgs=t.readMap(25,!1,this.mpExtArgs),this.lTimespan=t.readInt64(26,!1,this.lTimespan)},a.MultiStreamInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iCompatibleFlag=0,this.iHEVCBitRate=-1},a.MultiStreamInfo.prototype._clone=function(){return new a.MultiStreamInfo},a.MultiStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MultiStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MultiStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sDisplayName),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iCodecType),t.writeInt32(3,this.iCompatibleFlag),t.writeInt32(4,this.iHEVCBitRate)},a.MultiStreamInfo.prototype.readFrom=function(t){this.sDisplayName=t.readString(0,!1,this.sDisplayName),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iCodecType=t.readInt32(2,!1,this.iCodecType),this.iCompatibleFlag=t.readInt32(3,!1,this.iCompatibleFlag),this.iHEVCBitRate=t.readInt32(4,!1,this.iHEVCBitRate)},a.WSRegisterGroupReq=function(){this.vGroupId=new r.default.Vector(new r.default.STRING),this.sToken=""},a.WSRegisterGroupReq.prototype._clone=function(){return new a.WSRegisterGroupReq},a.WSRegisterGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterGroupReq.prototype.writeTo=function(t){t.writeVector(0,this.vGroupId),t.writeString(1,this.sToken)},a.WSRegisterGroupReq.prototype.readFrom=function(t){this.vGroupId=t.readVector(0,!1,this.vGroupId),this.sToken=t.readString(1,!1,this.sToken)},a.WSRegisterGroupRsp=function(){this.iResCode=0,this.vSupportP2PGroupId=new r.default.Vector(new r.default.STRING)},a.WSRegisterGroupRsp.prototype._clone=function(){return new a.WSRegisterGroupRsp},a.WSRegisterGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeVector(1,this.vSupportP2PGroupId)},a.WSRegisterGroupRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.vSupportP2PGroupId=t.readVector(1,!1,this.vSupportP2PGroupId)},a.GetOrderBroadcastInfoReq=function(){this.busses=new r.default.Vector(new r.default.STRING),this.anthorId=0,this.streamName="",this.appid=0},a.GetOrderBroadcastInfoReq.prototype._clone=function(){return new a.GetOrderBroadcastInfoReq},a.GetOrderBroadcastInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetOrderBroadcastInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetOrderBroadcastInfoReq.prototype.writeTo=function(t){t.writeVector(0,this.busses),t.writeInt64(1,this.anthorId),t.writeString(2,this.streamName),t.writeInt32(3,this.appid)},a.GetOrderBroadcastInfoReq.prototype.readFrom=function(t){this.busses=t.readVector(0,!1,this.busses),this.anthorId=t.readInt64(1,!1,this.anthorId),this.streamName=t.readString(2,!1,this.streamName),this.appid=t.readInt32(3,!1,this.appid)},a.GetOrderBroadcastInfoRsp=function(){this.ret=0,this.anthorId=0,this.broadcastInfos=new r.default.Vector(new a.OrderBroadcastInfo)},a.GetOrderBroadcastInfoRsp.prototype._clone=function(){return new a.GetOrderBroadcastInfoRsp},a.GetOrderBroadcastInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetOrderBroadcastInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetOrderBroadcastInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.ret),t.writeInt64(1,this.anthorId),t.writeVector(2,this.broadcastInfos)},a.GetOrderBroadcastInfoRsp.prototype.readFrom=function(t){this.ret=t.readInt32(0,!1,this.ret),this.anthorId=t.readInt64(1,!1,this.anthorId),this.broadcastInfos=t.readVector(2,!1,this.broadcastInfos)},a.OrderBroadcastInfo=function(){this.buss="",this.enable=0,this.broadcastGroup="",this.uri=0,this.configJson=""},a.OrderBroadcastInfo.prototype._clone=function(){return new a.OrderBroadcastInfo},a.OrderBroadcastInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.OrderBroadcastInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.OrderBroadcastInfo.prototype.writeTo=function(t){t.writeString(0,this.buss),t.writeInt32(1,this.enable),t.writeString(2,this.broadcastGroup),t.writeInt32(3,this.uri),t.writeString(4,this.configJson)},a.OrderBroadcastInfo.prototype.readFrom=function(t){this.buss=t.readString(0,!1,this.buss),this.enable=t.readInt32(1,!1,this.enable),this.broadcastGroup=t.readString(2,!1,this.broadcastGroup),this.uri=t.readInt32(3,!1,this.uri),this.configJson=t.readString(4,!1,this.configJson)},(a=a||{}).PixelateInfo=function(){this.dtsType=0,this.beginDts=0,this.endDts=0,this.pixelateKey=0,this.shapeInfos=new r.default.BinBuffer},a.PixelateInfo.prototype._clone=function(){return new a.PixelateInfo},a.PixelateInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.PixelateInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.PixelateInfo.prototype.writeTo=function(t){t.writeInt32(0,this.dtsType),t.writeUInt32(1,this.beginDts),t.writeUInt32(2,this.endDts),t.writeUInt32(3,this.pixelateKey),t.writeBytes(4,this.shapeInfos)},a.PixelateInfo.prototype.readFrom=function(t){this.dtsType=t.readInt32(0,!1,this.dtsType),this.beginDts=t.readUInt32(1,!1,this.beginDts),this.endDts=t.readUInt32(2,!1,this.endDts),this.pixelateKey=t.readUInt32(3,!1,this.pixelateKey),this.shapeInfos=t.readBytes(4,!1,this.shapeInfos)},a.MaskShape=function(){this.points=new r.default.Vector(new r.default.INT64),this.type=0,this.x=0,this.y=0,this.w=0,this.h=0,this.ext="",this.pixelcolor=0},a.MaskShape.prototype._clone=function(){return new a.MaskShape},a.MaskShape.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MaskShape.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MaskShape.prototype.writeTo=function(t){t.writeVector(0,this.points),t.writeUInt32(1,this.type),t.writeUInt32(2,this.x),t.writeUInt32(3,this.y),t.writeUInt32(4,this.w),t.writeUInt32(5,this.h),t.writeString(6,this.ext),t.writeUInt32(8,this.pixelcolor)},a.MaskShape.prototype.readFrom=function(t){this.points=t.readVector(0,!1,this.points),this.type=t.readUInt32(1,!1,this.type),this.x=t.readUInt32(2,!1,this.x),this.y=t.readUInt32(3,!1,this.y),this.w=t.readUInt32(4,!1,this.w),this.h=t.readUInt32(5,!1,this.h),this.ext=t.readString(6,!1,this.ext),this.pixelcolor=t.readUInt32(8,!1,this.pixelcolor)},a.SafeRoiMaskProto=function(){this.ver_no=0,this.dts=0,this.frame_width=0,this.frame_height=0,this.contrs=new r.default.Vector(new a.MaskShape),this.ext=""},a.SafeRoiMaskProto.prototype._clone=function(){return new a.SafeRoiMaskProto},a.SafeRoiMaskProto.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.SafeRoiMaskProto.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.SafeRoiMaskProto.prototype.writeTo=function(t){t.writeUInt32(0,this.ver_no),t.writeUInt32(1,this.dts),t.writeUInt32(2,this.frame_width),t.writeUInt32(3,this.frame_height),t.writeVector(4,this.contrs),t.writeString(5,this.ext)},a.SafeRoiMaskProto.prototype.readFrom=function(t){this.ver_no=t.readUInt32(0,!1,this.ver_no),this.dts=t.readUInt32(1,!1,this.dts),this.frame_width=t.readUInt32(2,!1,this.frame_width),this.frame_height=t.readUInt32(3,!1,this.frame_height),this.contrs=t.readVector(4,!1,this.contrs),this.ext=t.readString(5,!1,this.ext)},a.GetVideoHisUponReq=function(){this.lUid=0,this.lLiveId=0,this.tId=new a.UserId},a.GetVideoHisUponReq.prototype._clone=function(){return new a.GetVideoHisUponReq},a.GetVideoHisUponReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetVideoHisUponReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetVideoHisUponReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.lLiveId),t.writeStruct(2,this.tId)},a.GetVideoHisUponReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.tId=t.readStruct(2,!1,this.tId)},a.GetVideoHisUponRsp=function(){this.lUid=0,this.vHistoryList=new r.default.Vector(new a.GameLiveHlsInfo)},a.GetVideoHisUponRsp.prototype._clone=function(){return new a.GetVideoHisUponRsp},a.GetVideoHisUponRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetVideoHisUponRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetVideoHisUponRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeVector(1,this.vHistoryList)},a.GetVideoHisUponRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.vHistoryList=t.readVector(1,!1,this.vHistoryList)},a.GameLiveHlsInfo=function(){this.tGameInfo=new a.GameLiveInfo,this.sHlsUrl="",this.iVideoSyncTime=0,this.vDefinitions=new r.default.Vector(new a.VideoDefinition)},a.GameLiveHlsInfo.prototype._clone=function(){return new a.GameLiveHlsInfo},a.GameLiveHlsInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveHlsInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveHlsInfo.prototype.writeTo=function(t){t.writeStruct(0,this.tGameInfo),t.writeString(1,this.sHlsUrl),t.writeInt32(2,this.iVideoSyncTime),t.writeVector(3,this.vDefinitions)},a.GameLiveHlsInfo.prototype.readFrom=function(t){this.tGameInfo=t.readStruct(0,!1,this.tGameInfo),this.sHlsUrl=t.readString(1,!1,this.sHlsUrl),this.iVideoSyncTime=t.readInt32(2,!1,this.iVideoSyncTime),this.vDefinitions=t.readVector(3,!1,this.vDefinitions)},a.EGender={MALE:0,FEMALE:1},a.VideoStreamInfo=function(){this.sSize="",this.sWidth="",this.sHeight="",this.sFormat="",this.sUrl="",this.sM3u8="",this.sTs1Url="",this.sTs1Offset="",this.iBitRate=0,this.sCodec="",this.mpExtraParam=new r.default.Map(new r.default.STRING,new r.default.STRING)},a.VideoStreamInfo.prototype._clone=function(){return new a.VideoStreamInfo},a.VideoStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.VideoStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.VideoStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sSize),t.writeString(1,this.sWidth),t.writeString(2,this.sHeight),t.writeString(3,this.sFormat),t.writeString(4,this.sUrl),t.writeString(5,this.sM3u8),t.writeString(6,this.sTs1Url),t.writeString(7,this.sTs1Offset),t.writeInt32(8,this.iBitRate),t.writeString(9,this.sCodec),t.writeMap(10,this.mpExtraParam)},a.VideoStreamInfo.prototype.readFrom=function(t){this.sSize=t.readString(0,!1,this.sSize),this.sWidth=t.readString(1,!1,this.sWidth),this.sHeight=t.readString(2,!1,this.sHeight),this.sFormat=t.readString(3,!1,this.sFormat),this.sUrl=t.readString(4,!1,this.sUrl),this.sM3u8=t.readString(5,!1,this.sM3u8),this.sTs1Url=t.readString(6,!1,this.sTs1Url),this.sTs1Offset=t.readString(7,!1,this.sTs1Offset),this.iBitRate=t.readInt32(8,!1,this.iBitRate),this.sCodec=t.readString(9,!1,this.sCodec),this.mpExtraParam=t.readMap(10,!1,this.mpExtraParam)},a.VideoDefinition=function(){this.sSize="",this.sWidth="",this.sHeight="",this.sDefinition="",this.sUrl="",this.sM3u8="",this.sDefName="",this.sTs1Url="",this.sTs1Offset="",this.iLineIndex=0,this.iBitRate=0,this.mpExtraParam=new r.default.Map(new r.default.STRING,new r.default.STRING),this.vStreamInfo=new r.default.Vector(new a.VideoStreamInfo),this.sCodec="",this.sFormat="",this.sDuration=""},a.VideoDefinition.prototype._clone=function(){return new a.VideoDefinition},a.VideoDefinition.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.VideoDefinition.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.VideoDefinition.prototype.writeTo=function(t){t.writeString(0,this.sSize),t.writeString(1,this.sWidth),t.writeString(2,this.sHeight),t.writeString(3,this.sDefinition),t.writeString(4,this.sUrl),t.writeString(5,this.sM3u8),t.writeString(6,this.sDefName),t.writeString(7,this.sTs1Url),t.writeString(8,this.sTs1Offset),t.writeInt32(9,this.iLineIndex),t.writeInt32(10,this.iBitRate),t.writeMap(11,this.mpExtraParam),t.writeVector(12,this.vStreamInfo),t.writeString(13,this.sCodec),t.writeString(14,this.sFormat),t.writeString(15,this.sDuration)},a.VideoDefinition.prototype.readFrom=function(t){this.sSize=t.readString(0,!1,this.sSize),this.sWidth=t.readString(1,!1,this.sWidth),this.sHeight=t.readString(2,!1,this.sHeight),this.sDefinition=t.readString(3,!1,this.sDefinition),this.sUrl=t.readString(4,!1,this.sUrl),this.sM3u8=t.readString(5,!1,this.sM3u8),this.sDefName=t.readString(6,!1,this.sDefName),this.sTs1Url=t.readString(7,!1,this.sTs1Url),this.sTs1Offset=t.readString(8,!1,this.sTs1Offset),this.iLineIndex=t.readInt32(9,!1,this.iLineIndex),this.iBitRate=t.readInt32(10,!1,this.iBitRate),this.mpExtraParam=t.readMap(11,!1,this.mpExtraParam),this.vStreamInfo=t.readVector(12,!1,this.vStreamInfo),this.sCodec=t.readString(13,!1,this.sCodec),this.sFormat=t.readString(14,!1,this.sFormat),this.sDuration=t.readString(15,!1,this.sDuration)},a.GameLiveTag=function(){this.iTagId=0,this.sTagName="",this.bIsShow=!0,this.iBindingGameId=0,this.iShowType=0},a.GameLiveTag.prototype._clone=function(){return new a.GameLiveTag},a.GameLiveTag.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveTag.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveTag.prototype.writeTo=function(t){t.writeInt32(0,this.iTagId),t.writeString(1,this.sTagName),t.writeBoolean(2,this.bIsShow),t.writeInt32(3,this.iBindingGameId),t.writeInt32(4,this.iShowType)},a.GameLiveTag.prototype.readFrom=function(t){this.iTagId=t.readInt32(0,!1,this.iTagId),this.sTagName=t.readString(1,!1,this.sTagName),this.bIsShow=t.readBoolean(2,!1,this.bIsShow),this.iBindingGameId=t.readInt32(3,!1,this.iBindingGameId),this.iShowType=t.readInt32(4,!1,this.iShowType)},a.GameLiveInfo=function(){this.lLiveId=0,this.lUid=0,this.lChannelId=0,this.iShortChannel=0,this.lSubchannel=0,this.sSubchannelName="",this.iGameId=0,this.sGameName="",this.iAttendeeCount=0,this.eGender=a.EGender.MALE,this.iAid=0,this.sNick="",this.sAvatarUrl="",this.iStartTime=0,this.iEndTime=0,this.iSourceType=0,this.bIsCameraOpen=!1,this.bIsRoomSecret=!1,this.sVideoCaptureUrl="",this.iCdnAttendee=0,this.lYYId=0,this.bCertified=!1,this.iRecType=0,this.lSignChannel=0,this.sLiveDesc="",this.iLevel=0,this.sGameShortName="",this.iGameType=0,this.sPrivateHost="",this.iActivityCount=0,this.iStreamType=0,this.iBitRate=0,this.iResolution=0,this.iFrameRate=0,this.iIsMultiStream=0,this.iExeGameId=0,this.lExp=0,this.sReplayHls="",this.lMultiStreamFlag=0,this.iScreenType=0,this.iChannelType=0,this.sLocation="",this.iCodecType=0,this.vPresenterTags=new r.default.Vector(new a.GameLiveTag),this.vGameTags=new r.default.Vector(new a.GameLiveTag),this.lLiveCompatibleFlag=0,this.sTraceId="",this.iRoomId=0,this.mpExtInfo=new r.default.Map(new r.default.STRING,new r.default.STRING)},a.GameLiveInfo.prototype._clone=function(){return new a.GameLiveInfo},a.GameLiveInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveInfo.prototype.writeTo=function(t){t.writeInt64(0,this.lLiveId),t.writeInt64(1,this.lUid),t.writeInt64(2,this.lChannelId),t.writeInt32(3,this.iShortChannel),t.writeInt64(4,this.lSubchannel),t.writeString(5,this.sSubchannelName),t.writeInt32(6,this.iGameId),t.writeString(7,this.sGameName),t.writeInt32(8,this.iAttendeeCount),t.writeInt32(9,this.eGender),t.writeInt32(10,this.iAid),t.writeString(11,this.sNick),t.writeString(12,this.sAvatarUrl),t.writeInt32(13,this.iStartTime),t.writeInt32(14,this.iEndTime),t.writeInt32(15,this.iSourceType),t.writeBoolean(16,this.bIsCameraOpen),t.writeBoolean(17,this.bIsRoomSecret),t.writeString(18,this.sVideoCaptureUrl),t.writeInt32(19,this.iCdnAttendee),t.writeInt64(20,this.lYYId),t.writeBoolean(21,this.bCertified),t.writeInt32(22,this.iRecType),t.writeInt64(23,this.lSignChannel),t.writeString(24,this.sLiveDesc),t.writeInt32(25,this.iLevel),t.writeString(26,this.sGameShortName),t.writeInt32(27,this.iGameType),t.writeString(28,this.sPrivateHost),t.writeInt32(29,this.iActivityCount),t.writeInt32(30,this.iStreamType),t.writeInt32(31,this.iBitRate),t.writeInt32(32,this.iResolution),t.writeInt32(33,this.iFrameRate),t.writeInt32(34,this.iIsMultiStream),t.writeInt32(35,this.iExeGameId),t.writeInt64(36,this.lExp),t.writeString(37,this.sReplayHls),t.writeInt64(38,this.lMultiStreamFlag),t.writeInt32(39,this.iScreenType),t.writeInt32(40,this.iChannelType),t.writeString(41,this.sLocation),t.writeInt32(42,this.iCodecType),t.writeVector(43,this.vPresenterTags),t.writeVector(44,this.vGameTags),t.writeInt64(45,this.lLiveCompatibleFlag),t.writeString(46,this.sTraceId),t.writeInt32(47,this.iRoomId),t.writeMap(48,this.mpExtInfo)},a.GameLiveInfo.prototype.readFrom=function(t){this.lLiveId=t.readInt64(0,!1,this.lLiveId),this.lUid=t.readInt64(1,!1,this.lUid),this.lChannelId=t.readInt64(2,!1,this.lChannelId),this.iShortChannel=t.readInt32(3,!1,this.iShortChannel),this.lSubchannel=t.readInt64(4,!1,this.lSubchannel),this.sSubchannelName=t.readString(5,!1,this.sSubchannelName),this.iGameId=t.readInt32(6,!1,this.iGameId),this.sGameName=t.readString(7,!1,this.sGameName),this.iAttendeeCount=t.readInt32(8,!1,this.iAttendeeCount),this.eGender=t.readInt32(9,!1,this.eGender),this.iAid=t.readInt32(10,!1,this.iAid),this.sNick=t.readString(11,!1,this.sNick),this.sAvatarUrl=t.readString(12,!1,this.sAvatarUrl),this.iStartTime=t.readInt32(13,!1,this.iStartTime),this.iEndTime=t.readInt32(14,!1,this.iEndTime),this.iSourceType=t.readInt32(15,!1,this.iSourceType),this.bIsCameraOpen=t.readBoolean(16,!1,this.bIsCameraOpen),this.bIsRoomSecret=t.readBoolean(17,!1,this.bIsRoomSecret),this.sVideoCaptureUrl=t.readString(18,!1,this.sVideoCaptureUrl),this.iCdnAttendee=t.readInt32(19,!1,this.iCdnAttendee),this.lYYId=t.readInt64(20,!1,this.lYYId),this.bCertified=t.readBoolean(21,!1,this.bCertified),this.iRecType=t.readInt32(22,!1,this.iRecType),this.lSignChannel=t.readInt64(23,!1,this.lSignChannel),this.sLiveDesc=t.readString(24,!1,this.sLiveDesc),this.iLevel=t.readInt32(25,!1,this.iLevel),this.sGameShortName=t.readString(26,!1,this.sGameShortName),this.iGameType=t.readInt32(27,!1,this.iGameType),this.sPrivateHost=t.readString(28,!1,this.sPrivateHost),this.iActivityCount=t.readInt32(29,!1,this.iActivityCount),this.iStreamType=t.readInt32(30,!1,this.iStreamType),this.iBitRate=t.readInt32(31,!1,this.iBitRate),this.iResolution=t.readInt32(32,!1,this.iResolution),this.iFrameRate=t.readInt32(33,!1,this.iFrameRate),this.iIsMultiStream=t.readInt32(34,!1,this.iIsMultiStream),this.iExeGameId=t.readInt32(35,!1,this.iExeGameId),this.lExp=t.readInt64(36,!1,this.lExp),this.sReplayHls=t.readString(37,!1,this.sReplayHls),this.lMultiStreamFlag=t.readInt64(38,!1,this.lMultiStreamFlag),this.iScreenType=t.readInt32(39,!1,this.iScreenType),this.iChannelType=t.readInt32(40,!1,this.iChannelType),this.sLocation=t.readString(41,!1,this.sLocation),this.iCodecType=t.readInt32(42,!1,this.iCodecType),this.vPresenterTags=t.readVector(43,!1,this.vPresenterTags),this.vGameTags=t.readVector(44,!1,this.vGameTags),this.lLiveCompatibleFlag=t.readInt64(45,!1,this.lLiveCompatibleFlag),this.sTraceId=t.readString(46,!1,this.sTraceId),this.iRoomId=t.readInt32(47,!1,this.iRoomId),this.mpExtInfo=t.readMap(48,!1,this.mpExtInfo)},a.UserEventReq=function(){this.tId=new a.UserId,this.lTid=0,this.lSid=0,this.eOp=0,this.sChan="",this.eSource=0,this.lPid=0,this.bWatchVideo=!1,this.bAnonymous=!1,this.eTemplateType=a.TemplateType.PRIMARY,this.sTraceSource=""},a.UserEventReq.prototype._clone=function(){return new a.UserEventReq},a.UserEventReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserEventReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserEventReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTid),t.writeInt64(2,this.lSid),t.writeInt32(4,this.eOp),t.writeString(5,this.sChan),t.writeInt32(6,this.eSource),t.writeInt64(7,this.lPid),t.writeBoolean(8,this.bWatchVideo),t.writeBoolean(9,this.bAnonymous),t.writeInt32(10,this.eTemplateType),t.writeString(11,this.sTraceSource)},a.UserEventRsp=function(){this.lTid=0,this.lSid=0,this.iUserHeartBeatInterval=60,this.iPresentHeartBeatInterval=60},a.UserEventRsp.prototype._clone=function(){return new a.UserEventRsp},a.UserEventRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserEventRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserEventRsp.prototype.readFrom=function(t){this.lTid=t.readInt64(0,!1,this.lTid),this.lSid=t.readInt64(1,!1,this.lSid),this.iUserHeartBeatInterval=t.readInt32(2,!1,this.iUserHeartBeatInterval),this.iPresentHeartBeatInterval=t.readInt32(3,!1,this.iPresentHeartBeatInterval)},a.UserHeartBeatReq=function(){this.tId=new a.UserId,this.lTid=0,this.lSid=0,this.lPid=0,this.bWatchVideo=!1,this.eLineType=0,this.iFps=0,this.iAttendee=0,this.iBandwidth=0,this.iLastHeartElapseTime=0},a.UserHeartBeatReq.prototype._clone=function(){return new a.UserHeartBeatReq},a.UserHeartBeatReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserHeartBeatReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserHeartBeatReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTid),t.writeInt64(2,this.lSid),t.writeInt64(4,this.lPid),t.writeBoolean(5,this.bWatchVideo),t.writeInt32(6,this.eLineType),t.writeInt32(7,this.iFps),t.writeInt32(8,this.iAttendee),t.writeInt32(9,this.iBandwidth),t.writeInt32(10,this.iLastHeartElapseTime)},a.UserHeartBeatRsp=function(){this.iRet=0},a.UserHeartBeatRsp.prototype._clone=function(){return new a.UserHeartBeatRsp},a.UserHeartBeatRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserHeartBeatRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserHeartBeatRsp.prototype.readFrom=function(t){this.iRet=t.readInt32(0,!1,this.iRet)},a.TemplateType={PRIMARY:1,RECEPTION:2},a.MetricDetailSet=function(){this.tId=new a.UserId,this.vMetricDetail=new r.default.Vector(new a.MetricDetail)},a.MetricDetailSet.prototype._clone=function(){return new a.MetricDetailSet},a.MetricDetailSet.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MetricDetailSet.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MetricDetailSet.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vMetricDetail)},a.MetricDetailSet.prototype.readFrom=function(t){this.tId=t.readStruct(0,!0,this.tId),this.vMetricDetail=t.readVector(1,!0,this.vMetricDetail)},a.MetricDetail=function(){this.sMetricName="",this.iTS=0,this.vDimension=new r.default.Vector(new a.Dimension),this.vFiled=new r.default.Vector(new a.Field),this.vExLog=new r.default.Vector(new a.Dimension)},a.MetricDetail.prototype._clone=function(){return new a.MetricDetail},a.MetricDetail.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MetricDetail.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MetricDetail.prototype.writeTo=function(t){t.writeString(0,this.sMetricName),t.writeInt64(1,this.iTS),t.writeVector(2,this.vDimension),t.writeVector(3,this.vFiled),t.writeVector(4,this.vExLog)},a.MetricDetail.prototype.readFrom=function(t){this.sMetricName=t.readString(0,!0,this.sMetricName),this.iTS=t.readInt64(1,!1,this.iTS),this.vDimension=t.readVector(2,!1,this.vDimension),this.vFiled=t.readVector(3,!1,this.vFiled),this.vExLog=t.readVector(4,!1,this.vExLog)},a.Field=function(){this.sName="",this.fValue=0},a.Field.prototype._clone=function(){return new a.Field},a.Field.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Field.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Field.prototype.writeTo=function(t){t.writeString(0,this.sName),t.writeDouble(1,this.fValue)},a.Field.prototype.readFrom=function(t){this.sName=t.readString(0,!1,this.sName),this.fValue=t.readDouble(1,!1,this.fValue)},a.Metric=function(){this.sMetricName="",this.vDimension=new r.default.Vector(new a.Dimension),this.iTS=0,this.iSuccess=0,this.iRetCode=0,this.fValue=0,this.eUnit=0,this.tStatsSet=new a.StatsSet,this.sExtDesc="",this.vExLog=new r.default.Vector(new a.Dimension)},a.Metric.prototype._clone=function(){return new a.Metric},a.Metric.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Metric.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Metric.prototype.writeTo=function(t){t.writeString(0,this.sMetricName),t.writeVector(1,this.vDimension),t.writeInt64(2,this.iTS),t.writeInt32(3,this.iSuccess),t.writeInt32(4,this.iRetCode),t.writeDouble(5,this.fValue),t.writeInt32(6,this.eUnit),t.writeStruct(7,this.tStatsSet),t.writeString(8,this.sExtDesc),t.writeVector(9,this.vExLog)},a.Metric.prototype.readFrom=function(t){this.sMetricName=t.readString(0,!0,this.sMetricName),this.vDimension=t.readVector(1,!1,this.vDimension),this.iTS=t.readInt64(2,!1,this.iTS),this.iSuccess=t.readInt32(3,!1,this.iSuccess),this.iRetCode=t.readInt32(4,!1,this.iRetCode),this.fValue=t.readDouble(5,!1,this.fValue),this.eUnit=t.readInt32(6,!1,this.eUnit),this.tStatsSet=t.readStruct(7,!1,this.tStatsSet),this.sExtDesc=t.readString(8,!1,this.sExtDesc),this.vExLog=t.readVector(9,!1,this.vExLog)},a.Dimension=function(){this.sName="",this.sValue=""},a.Dimension.prototype._clone=function(){return new a.Dimension},a.Dimension.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Dimension.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Dimension.prototype.writeTo=function(t){t.writeString(0,this.sName),t.writeString(1,this.sValue)},a.Dimension.prototype.readFrom=function(t){this.sName=t.readString(0,!1,this.sName),this.sValue=t.readString(1,!1,this.sValue)},a.HuYaUdbNotify=function(){this.eNotifyType=0,this.sMsg=""},a.HuYaUdbNotify.prototype._clone=function(){return new a.HuYaUdbNotify},a.HuYaUdbNotify.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.HuYaUdbNotify.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.HuYaUdbNotify.prototype.writeTo=function(t){t.writeInt32(0,this.eNotifyType),t.writeString(1,this.sMsg)},a.HuYaUdbNotify.prototype.readFrom=function(t){this.eNotifyType=t.readInt32(0,!1,this.eNotifyType),this.sMsg=t.readString(1,!1,this.sMsg)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(112).default;e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=_(i(22)),r=_(i(0)),a=_(i(1)),o=_(i(24)),n=_(i(26)),h=i(86),d=_(i(19)),l=_(i(21)),c=_(i(4)),u=_(i(34)),p=_(i(16)),m=_(i(57));function _(t){return t&&t.__esModule?t:{default:t}}var f=!!Number(m.default._printProtocol),g=!!Number(m.default._printGateway),S=function(t){function e(t,i){(0,r.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this));return a.WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",a.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",a.WEBSOCKET_ERROR="WEBSOCKET_ERROR",a.TAFLINK_INITED="TAFLINK_INITED",a._taf=null,a.delayWup=[],a.delayListener=[],a.streamName=null,a.requestId=1,a.config=t,a.const=i,a._onConnectedBind=a._onConnected.bind(a),a}return(0,n.default)(e,t),(0,a.default)(e,[{key:"destroy",value:function(){this._taf&&(this._taf.off&&this._taf.off(this.WEBSOCKET_CONNECTED,this._onConnectedBind),this._taf.removeListener&&this._taf.removeListener(this.WEBSOCKET_CONNECTED,this._onConnectedBind)),this._taf=null,this.delayWup=null,this.delayListener=null}},{key:"getRequestId",value:function(){return this.requestId++,1e5===this.requestId&&(this.requestId=1),this.requestId}},{key:"getTaf",value:function(){return this._taf}},{key:"isWap",value:function(){return 1==m.default._testUa||this.config.platform==this.const.PLATFORM_TYPE_NAME.wap}},{key:"setTafHandler",value:function(t){var e=d.default.now();p.default.logger.log("%c[TIME] initTafTime="+e,"color:#A23400;background:#FFF5C2"),this._delTafListner(this.WEBSOCKET_CONNECTED,this._onConnectedBind),t.getTaf&&l.default.setTaf(t.getTaf()),t.registerUriMap(T.UriMapping),t.registerWupMap(T.WupMapping),this._taf=t,this.isWap()?this._taf.isWSConnected()?this._onConnected():this._taf.on(this.WEBSOCKET_CONNECTED,this._onConnectedBind):this._taf.connected?this._onConnected():this._addTafListener(this.WEBSOCKET_CONNECTED,this._onConnectedBind),this.emit(this.TAFLINK_INITED)}},{key:"_addTafListener",value:function(t,e){this._taf&&(this._taf.addListener?this._taf.addListener(t,e):this._taf.on&&this._taf.on(t,e))}},{key:"_delTafListner",value:function(t,e){this._taf&&(this._taf.off&&this._taf.off(t,e),this._taf.removeListener&&this._taf.removeListener(t,e))}},{key:"_onConnected",value:function(){p.default.logger.log("TafLink._onConnected sendWup size="+this.delayWup.length);var t=this;this.delayWup.forEach((function(e){var i=e.servantName,s=e.funcName,r=e.data,a=e.callback,o=e.once,n=e.iRequestId,h=e.noTid;t.sendWup(i,s,r,a,o,n,h)})),this.delayWup=[],this.delayListener.forEach((function(e){var i=e.p0,s=e.p1,r=e.p2;switch(i){case"add":t.addListener(s,r);break;case"remove":t.removeListener(s,r);break;case"dispatch":t.dispatch(s,r)}})),this.delayListener=[]}},{key:"getUserId",value:function(){return this._taf.getUserId()}},{key:"sendWup",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!this.connected)return p.default.logger.log("TafLink.sendWup connected=false",t,e),void this.delayWup.push({servantName:t,funcName:e,data:i,callback:s,once:r,iRequestId:a,noTid:o});this._taf.sendWup2?this._taf.sendWup2(t,e,i,s,r,a,o):this._taf.sendWup(t,e,i,s,r,a,o)}},{key:"getInfoFromVG",value:function(t,e,i,s){if(this._taf){var r=this._taf.getTaf().BinBuffer,a=new l.default.GetInfoFromVGReq;a.lUid=t,a.sMsg=new r(i.marshall().buffer),a.sProtoName="yy",a.iUri=e,a.tId=this.getUserId(),this.sendWup("videogateway","getInfoFromVG",a,(function(t){s(t)}),!0)}else p.default.logger.warn("TafLink.sendYY taf not init!")}},{key:"sendYY",value:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._taf){var o=t.constructor.name,n=c.default[o];n||"function"!=typeof t.marshall||(n=new DataView(t.marshall().buffer).getUint32(4,!0)),f&&p.default.logger.log("%c>>>>>>> "+o,y("#009100"),"uri="+n,t);var h=null,d="mediaui",m="getInfoFromVGM";if("function"==typeof this._taf.packVGInfo)h=this._taf.packVGInfo(n,t,this.streamName);else{var _=this._taf.getTaf().BinBuffer;d="videogateway",m=a?"getInfoFromCdnVG":"getInfoFromVG",(h=new l.default.GetInfoFromVGReq).lUid=s||0,h.sMsg=new _(t.marshall().buffer),h.sProtoName="yy",h.iUri=n||0,h.lSid=0,h.tId=this.getUserId()}this.sendWup(d,m,h,function(s){if(0!=s.sMsg.len){if(!s.lUid||!h.lUid||s.lUid==h.lUid){var r=new DataView(s.sMsg.buffer),n=new u.default(r);if(!(o=c.default[n.uri]))throw g||p.default.logger.log("%c<<<<<<< %crspWup:%c GetInfoFromVG",y("#0000E3"),y("black"),y("#0000E3"),"videogateway",s),new Error("[x] Unmatched protocol, uri="+(n.uri>>8)+" resCode="+n.resCode+" len="+n.len);var d=n,l=null;try{l=a?i(92)("./"+o).default:i(163)("./"+o).default}catch(t){p.default.logger.warn("[x] Unmatched protocol",n.uri>>8,o)}l&&(d=new l).unmarshall(n),f&&p.default.logger.log("%c<<<<<<< "+o,y("#0000E3"),d),"function"==typeof e?e(d):this.dispatch(n.uri,d)}}else p.default.logger.warn("GetInfoFromVG response an empty pkg.",t,h,s)}.bind(this),r)}else p.default.logger.warn("TafLink.sendYY taf not init!")}},{key:"addListener",value:function(t,e){this.connected?this._addTafListener(t,e):this.delayListener.push({p0:"add",p1:t,p2:e})}},{key:"removeListener",value:function(t,e){this.connected?this._taf.removeListener(t,e):this.delayListener.push({p0:"remove",p1:t,p2:e})}},{key:"inited",get:function(){return!!this._taf}},{key:"connected",get:function(){if(this._taf)return this._taf.isWSConnected?this._taf.isWSConnected():this._taf.connected}}]),e}(h.EventEmitter);function y(t,e,i){var s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s}var T={UriMapping:{8102:l.default.LivingStreamInfoNotice,8103:l.default.LivingStreamEndNotice,1025601:l.default.LiveMeetingSyncNotice,1400200:l.default.ImgplusABTestNotice},WupMapping:{getInfoFromVG:l.default.GetInfoFromVGRsp,GetInfoFromVG:l.default.GetInfoFromVGRsp,getInfoFromCdnVG:l.default.GetInfoFromVGRsp,getCdnTokenInfoEx:l.default.GetCdnTokenExRsp,getLivingStreamInfo:l.default.GetLivingStreamInfoRsp,getP2PStreamInfo:l.default.GetP2PStreamInfoRsp,getP2PStreamTokenInfoEx:l.default.GetP2PStreamTokenExRsp,queryHttpDns:l.default.QueryHttpDnsRsp,loginVerify:l.default.LoginVerifyRsp,joinGroup:l.default.JoinMediaGroupRsp,quitGroup:l.default.QuitMediaGroupRsp,wsTimeSync:l.default.WSTimeSyncRsp,pingSignal:l.default.PingSignalContext,onClientGetStunAndPcdnProxyReq:l.default.ClientGetStunAndPcdnProxyRsp,clientQueryPcdnSchedule:l.default.ClientQueryPcdnScheduleRsp,onClientGetPcdnFlvOutsideSdkFullstreamInfo:l.default.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp,onClientGetPcdnFlvHttpFullstreamInfo:l.default.ClientGetPcdnFlvHttpFullstreamInfoRsp,onClientGetVodPcdnProxyReq:l.default.ClientGetVodPcdnProxyReqRsp,getMediaRec:l.default.RecSysRsp,getStreamInfoByRoomFake:l.default.GetStreamInfoByRoomFakeRsp,getVodAntiCode:l.default.GetVodAntiCodeRsp},NoLog:{8102:1,8103:1,1025601:1,getInfoFromVG:1,GetInfoFromVG:1,getInfoFromCdnVG:1,getInfoFromVGM:1,getCdnTokenInfoEx:1,videoClientReport:1}};e.default=S},function(t,e,i){i(114),t.exports=i(3).Object.getPrototypeOf},function(t,e,i){var s=i(23),r=i(74);i(115)("getPrototypeOf",(function(){return function(t){return r(s(t))}}))},function(t,e,i){var s=i(5),r=i(3),a=i(15);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],o={};o[t]=e(i),s(s.S+s.F*a((function(){i(1)})),"Object",o)}},function(t,e,i){t.exports={default:i(117),__esModule:!0}},function(t,e,i){i(118);var s=i(3).Object;t.exports=function(t,e,i){return s.defineProperty(t,e,i)}},function(t,e,i){var s=i(5);s(s.S+s.F*!i(6),"Object",{defineProperty:i(9).f})},function(t,e,i){t.exports={default:i(120),__esModule:!0}},function(t,e,i){i(45),i(52),t.exports=i(53).f("iterator")},function(t,e,i){var s=i(46),r=i(41);t.exports=function(t){return function(e,i){var a,o,n=String(r(e)),h=s(i),d=n.length;return h<0||h>=d?t?"":void 0:(a=n.charCodeAt(h))<55296||a>56319||h+1===d||(o=n.charCodeAt(h+1))<56320||o>57343?t?n.charAt(h):a:t?n.slice(h,h+2):o-56320+(a-55296<<10)+65536}}},function(t,e,i){"use strict";var s=i(30),r=i(29),a=i(32),o={};i(12)(o,i(7)("iterator"),(function(){return this})),t.exports=function(t,e,i){t.prototype=s(o,{next:r(1,i)}),a(t,e+" Iterator")}},function(t,e,i){var s=i(9),r=i(13),a=i(31);t.exports=i(6)?Object.defineProperties:function(t,e){r(t);for(var i,o=a(e),n=o.length,h=0;n>h;)s.f(t,i=o[h++],e[i]);return t}},function(t,e,i){var s=i(18),r=i(50),a=i(125);t.exports=function(t){return function(e,i,o){var n,h=s(e),d=r(h.length),l=a(o,d);if(t&&i!=i){for(;d>l;)if((n=h[l++])!=n)return!0}else for(;d>l;l++)if((t||l in h)&&h[l]===i)return t||l||0;return!t&&-1}}},function(t,e,i){var s=i(46),r=Math.max,a=Math.min;t.exports=function(t,e){return(t=s(t))<0?r(t+e,0):a(t,e)}},function(t,e,i){var s=i(8).document;t.exports=s&&s.documentElement},function(t,e,i){"use strict";var s=i(128),r=i(81),a=i(25),o=i(18);t.exports=i(47)(Array,"Array",(function(t,e){this._t=o(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values"),a.Arguments=a.Array,s("keys"),s("values"),s("entries")},function(t,e){t.exports=function(){}},function(t,e,i){t.exports={default:i(130),__esModule:!0}},function(t,e,i){i(131),i(85),i(134),i(135),t.exports=i(3).Symbol},function(t,e,i){"use strict";var s=i(8),r=i(14),a=i(6),o=i(5),n=i(79),h=i(54).KEY,d=i(15),l=i(43),c=i(32),u=i(28),p=i(7),m=i(53),_=i(55),f=i(132),g=i(82),S=i(13),y=i(11),T=i(23),P=i(18),v=i(44),E=i(29),C=i(30),I=i(133),A=i(84),D=i(56),R=i(9),O=i(31),L=A.f,M=R.f,w=I.f,F=s.Symbol,b=s.JSON,V=b&&b.stringify,N=p("_hidden"),B=p("toPrimitive"),k={}.propertyIsEnumerable,U=l("symbol-registry"),x=l("symbols"),H=l("op-symbols"),W=Object.prototype,G="function"==typeof F&&!!D.f,Y=s.QObject,q=!Y||!Y.prototype||!Y.prototype.findChild,K=a&&d((function(){return 7!=C(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a}))?function(t,e,i){var s=L(W,e);s&&delete W[e],M(t,e,i),s&&t!==W&&M(W,e,s)}:M,j=function(t){var e=x[t]=C(F.prototype);return e._k=t,e},z=G&&"symbol"==typeof F.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof F},J=function(t,e,i){return t===W&&J(H,e,i),S(t),e=v(e,!0),S(i),r(x,e)?(i.enumerable?(r(t,N)&&t[N][e]&&(t[N][e]=!1),i=C(i,{enumerable:E(0,!1)})):(r(t,N)||M(t,N,E(1,{})),t[N][e]=!0),K(t,e,i)):M(t,e,i)},Q=function(t,e){S(t);for(var i,s=f(e=P(e)),r=0,a=s.length;a>r;)J(t,i=s[r++],e[i]);return t},X=function(t){var e=k.call(this,t=v(t,!0));return!(this===W&&r(x,t)&&!r(H,t))&&(!(e||!r(this,t)||!r(x,t)||r(this,N)&&this[N][t])||e)},$=function(t,e){if(t=P(t),e=v(e,!0),t!==W||!r(x,e)||r(H,e)){var i=L(t,e);return!i||!r(x,e)||r(t,N)&&t[N][e]||(i.enumerable=!0),i}},Z=function(t){for(var e,i=w(P(t)),s=[],a=0;i.length>a;)r(x,e=i[a++])||e==N||e==h||s.push(e);return s},tt=function(t){for(var e,i=t===W,s=w(i?H:P(t)),a=[],o=0;s.length>o;)!r(x,e=s[o++])||i&&!r(W,e)||a.push(x[e]);return a};G||(n((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor!");var t=u(arguments.length>0?arguments[0]:void 0),e=function(i){this===W&&e.call(H,i),r(this,N)&&r(this[N],t)&&(this[N][t]=!1),K(this,t,E(1,i))};return a&&q&&K(W,t,{configurable:!0,set:e}),j(t)}).prototype,"toString",(function(){return this._k})),A.f=$,R.f=J,i(83).f=I.f=Z,i(33).f=X,D.f=tt,a&&!i(27)&&n(W,"propertyIsEnumerable",X,!0),m.f=function(t){return j(p(t))}),o(o.G+o.W+o.F*!G,{Symbol:F});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)p(et[it++]);for(var st=O(p.store),rt=0;st.length>rt;)_(st[rt++]);o(o.S+o.F*!G,"Symbol",{for:function(t){return r(U,t+="")?U[t]:U[t]=F(t)},keyFor:function(t){if(!z(t))throw TypeError(t+" is not a symbol!");for(var e in U)if(U[e]===t)return e},useSetter:function(){q=!0},useSimple:function(){q=!1}}),o(o.S+o.F*!G,"Object",{create:function(t,e){return void 0===e?C(t):Q(C(t),e)},defineProperty:J,defineProperties:Q,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:tt});var at=d((function(){D.f(1)}));o(o.S+o.F*at,"Object",{getOwnPropertySymbols:function(t){return D.f(T(t))}}),b&&o(o.S+o.F*(!G||d((function(){var t=F();return"[null]"!=V([t])||"{}"!=V({a:t})||"{}"!=V(Object(t))}))),"JSON",{stringify:function(t){for(var e,i,s=[t],r=1;arguments.length>r;)s.push(arguments[r++]);if(i=e=s[1],(y(e)||void 0!==t)&&!z(t))return g(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!z(e))return e}),s[1]=e,V.apply(b,s)}}),F.prototype[B]||i(12)(F.prototype,B,F.prototype.valueOf),c(F,"Symbol"),c(Math,"Math",!0),c(s.JSON,"JSON",!0)},function(t,e,i){var s=i(31),r=i(56),a=i(33);t.exports=function(t){var e=s(t),i=r.f;if(i)for(var o,n=i(t),h=a.f,d=0;n.length>d;)h.call(t,o=n[d++])&&e.push(o);return e}},function(t,e,i){var s=i(18),r=i(83).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==a.call(t)?function(t){try{return r(t)}catch(t){return o.slice()}}(t):r(s(t))}},function(t,e,i){i(55)("asyncIterator")},function(t,e,i){i(55)("observable")},function(t,e,i){t.exports={default:i(137),__esModule:!0}},function(t,e,i){i(138),t.exports=i(3).Object.setPrototypeOf},function(t,e,i){var s=i(5);s(s.S,"Object",{setPrototypeOf:i(139).set})},function(t,e,i){var s=i(11),r=i(13),a=function(t,e){if(r(t),!s(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,s){try{(s=i(17)(Function.call,i(84).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return a(t,i),e?t.__proto__=i:s(t,i),t}}({},!1):void 0),check:a}},function(t,e,i){t.exports={default:i(141),__esModule:!0}},function(t,e,i){i(142);var s=i(3).Object;t.exports=function(t,e){return s.create(t,e)}},function(t,e,i){var s=i(5);s(s.S,"Object",{create:i(30)})},function(t,e,i){i(85),i(45),i(52),i(144),i(153),i(156),i(158),t.exports=i(3).Map},function(t,e,i){"use strict";var s=i(145),r=i(91);t.exports=i(149)("Map",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=s.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return s.def(r(this,"Map"),0===t?0:t,e)}},s,!0)},function(t,e,i){"use strict";var s=i(9).f,r=i(30),a=i(87),o=i(17),n=i(88),h=i(35),d=i(47),l=i(81),c=i(148),u=i(6),p=i(54).fastKey,m=i(91),_=u?"_s":"size",f=function(t,e){var i,s=p(e);if("F"!==s)return t._i[s];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,d){var l=t((function(t,s){n(t,l,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[_]=0,null!=s&&h(s,i,t[d],t)}));return a(l.prototype,{clear:function(){for(var t=m(this,e),i=t._i,s=t._f;s;s=s.n)s.r=!0,s.p&&(s.p=s.p.n=void 0),delete i[s.i];t._f=t._l=void 0,t[_]=0},delete:function(t){var i=m(this,e),s=f(i,t);if(s){var r=s.n,a=s.p;delete i._i[s.i],s.r=!0,a&&(a.n=r),r&&(r.p=a),i._f==s&&(i._f=r),i._l==s&&(i._l=a),i[_]--}return!!s},forEach:function(t){m(this,e);for(var i,s=o(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(s(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!f(m(this,e),t)}}),u&&s(l.prototype,"size",{get:function(){return m(this,e)[_]}}),l},def:function(t,e,i){var s,r,a=f(t,e);return a?a.v=i:(t._l=a={i:r=p(e,!0),k:e,v:i,p:s=t._l,n:void 0,r:!1},t._f||(t._f=a),s&&(s.n=a),t[_]++,"F"!==r&&(t._i[r]=a)),t},getEntry:f,setStrong:function(t,e,i){d(t,e,(function(t,i){this._t=m(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?l(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,l(1))}),i?"entries":"values",!i,!0),c(e)}}},function(t,e,i){var s=i(13);t.exports=function(t,e,i,r){try{return r?e(s(i)[0],i[1]):e(i)}catch(e){var a=t.return;throw void 0!==a&&s(a.call(t)),e}}},function(t,e,i){var s=i(25),r=i(7)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(s.Array===t||a[r]===t)}},function(t,e,i){"use strict";var s=i(8),r=i(3),a=i(9),o=i(6),n=i(7)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:s[t];o&&e&&!e[n]&&a.f(e,n,{configurable:!0,get:function(){return this}})}},function(t,e,i){"use strict";var s=i(8),r=i(5),a=i(54),o=i(15),n=i(12),h=i(87),d=i(35),l=i(88),c=i(11),u=i(32),p=i(9).f,m=i(150)(0),_=i(6);t.exports=function(t,e,i,f,g,S){var y=s[t],T=y,P=g?"set":"add",v=T&&T.prototype,E={};return _&&"function"==typeof T&&(S||v.forEach&&!o((function(){(new T).entries().next()})))?(T=e((function(e,i){l(e,T,t,"_c"),e._c=new y,null!=i&&d(i,g,e[P],e)})),m("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(t){var e="add"==t||"set"==t;!(t in v)||S&&"clear"==t||n(T.prototype,t,(function(i,s){if(l(this,T,t),!e&&S&&!c(i))return"get"==t&&void 0;var r=this._c[t](0===i?0:i,s);return e?this:r}))})),S||p(T.prototype,"size",{get:function(){return this._c.size}})):(T=f.getConstructor(e,t,g,P),h(T.prototype,i),a.NEED=!0),u(T,t),E[t]=T,r(r.G+r.W+r.F,E),S||f.setStrong(T,t,g),T}},function(t,e,i){var s=i(17),r=i(48),a=i(23),o=i(50),n=i(151);t.exports=function(t,e){var i=1==t,h=2==t,d=3==t,l=4==t,c=6==t,u=5==t||c,p=e||n;return function(e,n,m){for(var _,f,g=a(e),S=r(g),y=s(n,m,3),T=o(S.length),P=0,v=i?p(e,T):h?p(e,0):void 0;T>P;P++)if((u||P in S)&&(f=y(_=S[P],P,g),t))if(i)v[P]=f;else if(f)switch(t){case 3:return!0;case 5:return _;case 6:return P;case 2:v.push(_)}else if(l)return!1;return c?-1:d||l?l:v}}},function(t,e,i){var s=i(152);t.exports=function(t,e){return new(s(t))(e)}},function(t,e,i){var s=i(11),r=i(82),a=i(7)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),s(e)&&null===(e=e[a])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){var s=i(5);s(s.P+s.R,"Map",{toJSON:i(154)("Map")})},function(t,e,i){var s=i(90),r=i(155);t.exports=function(t){return function(){if(s(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){var s=i(35);t.exports=function(t,e){var i=[];return s(t,!1,i.push,i,e),i}},function(t,e,i){i(157)("Map")},function(t,e,i){"use strict";var s=i(5);t.exports=function(t){s(s.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,i){i(159)("Map")},function(t,e,i){"use strict";var s=i(5),r=i(75),a=i(17),o=i(35);t.exports=function(t){s(s.S,t,{from:function(t){var e,i,s,n,h=arguments[1];return r(this),(e=void 0!==h)&&r(h),null==t?new this:(i=[],e?(s=0,n=a(h,arguments[2],2),o(t,!1,(function(t){i.push(n(t,s++))}))):o(t,!1,i.push,i),new this(i))}})}},function(t,e,i){t.exports={default:i(161),__esModule:!0}},function(t,e,i){i(52),i(45),t.exports=i(162)},function(t,e,i){var s=i(13),r=i(89);t.exports=i(3).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},function(t,e,i){var s={"./ApToken":100,"./ApToken.js":100,"./CurrentProxyInfo":62,"./CurrentProxyInfo.js":62,"./FuzzyQueryKey":39,"./FuzzyQueryKey.js":39,"./FuzzyQueryParam":65,"./FuzzyQueryParam.js":65,"./IpInfo":101,"./IpInfo.js":101,"./PAudienceGetProxyListReq":66,"./PAudienceGetProxyListReq.js":66,"./PAudienceGetProxyListRsp":67,"./PAudienceGetProxyListRsp.js":67,"./SlaveProxyInfo":38,"./SlaveProxyInfo.js":38,"./StreamAllocateInfo":68,"./StreamAllocateInfo.js":68,"./StreamCodecType":64,"./StreamCodecType.js":64,"./StreamGroupID":37,"./StreamGroupID.js":37,"./StreamType":63,"./StreamType.js":63,"./SubscribeResCode":102,"./SubscribeResCode.js":102,"./VoiceChatEx":103,"./VoiceChatEx.js":103,"./VpToken":104,"./VpToken.js":104};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=163},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(19)),o=h(i(165)),n=h(i(40));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this._tafLink=e,this._info=new o.default,this._lastTs=0,this._started=!1,this._sguid="",this._clientTime=0,this._requestId=0,this._onWsTimeSyncBind=this._onWsTimeSync.bind(this)}return(0,r.default)(t,[{key:"destroy",value:function(){this._started=!1,this._tafLink=null}},{key:"start",value:function(t){this._started||""===t||(this._started=!0,this._sguid=t,this.wsTimeSync())}},{key:"onTimer",value:function(t){this._started&&(0===this._lastTs?this._lastTs=t:t-this._lastTs>=6e4&&(this._lastTs=t,this.wsTimeSync()))}},{key:"wsTimeSync",value:function(){this._req||(this._req=new n.default.WSTimeSyncReq),this._requestId=this._tafLink.getRequestId(),this._clientTime=a.default.now(),this._req.sGuid=this._sguid,this._req.lClientTime=this._clientTime,this._tafLink.sendWup("launch","wsTimeSync",this._req,this._onWsTimeSyncBind,!0,this._requestId)}},{key:"_onWsTimeSync",value:function(t){this._info.ntpProcess(this._clientTime,Number(t.lServerTime))}},{key:"getSyncTime",value:function(){return this._info.convertToSrvTime(a.default.now())}},{key:"isFinishNtp",value:function(){return this._info.isFinishNtp()}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(19));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.osTime=0,this.syncLocalTime=0,this.rttList=[]}return(0,r.default)(t,[{key:"convertToSrvTime",value:function(t){if(0===this.osTime)return 0;var e=t-this.osTime;return this.syncLocalTime+e}},{key:"isFinishNtp",value:function(){return 0!==this.osTime}},{key:"ntpProcess",value:function(t,e){var i=a.default.now(),s=i-t,r=Math.round(e+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else{for(var o=[],n=0;n<this.rttList.length;++n)o.push(this.rttList[n]);o.sort((function(t,e){return t-e}));for(var h=0,d=0;d<4;++d)h+=o[d];var l=h>>2;(4*s>3*l&&4*s<5*l||s>6e4)&&(this.osTime=i,this.syncLocalTime=r),this.rttList.shift(),this.rttList.push(s),o=null}}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(21)),o=h(i(19)),n=h(i(16));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this.TafLink=e,this._rttCur=0,this._rttMax=0,this._rttSmooth=0,this._rttSamples=[],this._lastPingTs=0,this._lastSampleTs=0,this._pingRspBind=this._pingRsp.bind(this)}return(0,r.default)(t,[{key:"getStats",value:function(){var t={rttMax:this._rttMax,rttSmooth:this._rttSmooth,rttSamples:this._rttSamples.slice()};return this._rttMax=0,this._rttSamples=[],t}},{key:"onTimer",value:function(t){0===this._lastPingTs?this._lastPingTs=t:t-this._lastPingTs>=3e3&&(this._lastPingTs=t,this._pingReq(t)),0===this._lastSampleTs?this._lastSampleTs=t:t-this._lastSampleTs>=1e3&&(this._lastSampleTs=t,this._rttSamples.push(this._rttCur))}},{key:"_pingReq",value:function(t){if(this.TafLink.connected){var e=new a.default.PingSignalContext;e.mTracePoint.put("sendTime",t),this.TafLink.sendWup("launch","pingSignal",e,this._pingRspBind,!0,this.TafLink.getRequestId())}}},{key:"_pingRsp",value:function(t){var e=o.default.now(),i=t.mTracePoint.get("sendTime");if(i>0){var s=Math.round((e-i)/2);this._rttCur=s,0===this._rttSmooth?this._rttSmooth=s:this._rttSmooth=Math.round((7*this._rttSmooth+s)/8),this._rttMax<s&&(this._rttMax=s)}else n.default.logger.warn("[SignalRtt] pingRsp not a number: sendTime="+i)}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=S(i(168)),r=S(i(22)),a=S(i(0)),o=S(i(1)),n=S(i(24)),h=S(i(26)),d=S(i(21)),l=S(i(39)),c=S(i(4)),u=S(i(34)),p=S(i(66)),m=S(i(67)),_=i(86),f=S(i(105)),g=S(i(16));function S(t){return t&&t.__esModule?t:{default:t}}var y=function(t){function e(t){var i=arguments[2];(0,a.default)(this,e);var s=(0,n.default)(this,(e.__proto__||(0,r.default)(e)).call(this));return s.player=t,s.wupProtocolList=[],s.vpRequestId=0,s.vpGetted=!1,s.TafLink=i,s}return(0,h.default)(e,t),(0,o.default)(e,[{key:"getRequestId",value:function(){return this.TafLink.getRequestId()}},{key:"resetVpRequest",value:function(){this.vpRequestId=0}},{key:"setTafWup",value:function(t){g.default.logger.log("TafLinkSignal.setTafWup wup="+!t),this._tafwup=t,d.default.setTaf(this._tafwup),this.emit(e.TAF_WUP_READY)}},{key:"getVoiceProxy",value:function(t){var i=this;t&&t.requestId?this.vpRequestId=t.requestId:(this.vpRequestId=this.getRequestId(),t.requestId=this.vpRequestId),this.vpGetted=!1,g.default.logger.log("TafLinkSignal.getVoiceProxy "+(t&&(0,s.default)(t))+" wup="+!this._tafwup),this._tafwup?this._getVoiceProxyHttp(t):this.on(e.TAF_WUP_READY,(function(){i.vpGetted?g.default.logger.log("vp had been getted by socket"):i._getVoiceProxyHttp(t)}))}},{key:"_getVoiceProxyHttp",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.vpGetted=!0;var i=e.userid,r=e.presenterUid,a=e.streamName,o=e.sid,n=e.latencyModel,h=new l.default;h.sid=r,h.fuzzyParam.h264Only=!0,h.fuzzyParam.maxCodeRateH264=0,h.fuzzyParam.maxCodeRateH265=0;var u=new p.default;u.uid=i,u.version=1,u.sdkVersion=1,u.fuzzyQueryKeys=[h],u.streamNames=[a],u.appid=e.appid,u.clientAppid=0,u.clientType=14,u.sendTime=.001*Date.now()>>0,u.useCase=e.useCase||3,u.appUA="webh5&2504151055&websocket";var m=e.playerdata||{},_=(m.gameId||0)+"";u.extInfo.set("categoryId",_),e&&e.rtctrans&&u.extInfo.set("rtctrans",e.rtctrans),e&&void 0!==e.iBitRate&&u.extInfo.set("coderate",String(e.iBitRate)),u.latencyModel=n;var f=u.constructor.name,S=c.default[f],y=new d.default.GetInfoFromVGReq;y.lUid=i,y.sProtoName="yy",y.iUri=S||0,y.lSid=o||0,y.tId=this._getUserId();var T=this._tafwup.BinBuffer;y.sMsg=new T(u.marshall().buffer);var P="videogateway",v="getInfoFromVG",E=new this._tafwup.Wup;E.setServant(P),E.setFunc(v),E.writeStruct("tReq",y);var C=E.encode().getBuffer(),I=67==e.appid?"//testws.va.huya.com":"//cdn.wup.huya.com";g.default.logger.log("TafLinkSignal._getVoiceProxyHttp url="+I+" req="+(0,s.default)(u),u),this._tafwup.Util.ajax(I,C,(function(e){var i=new t._tafwup.Wup;i.decode(e);var s=new d.default.GetInfoFromVGRsp;i.readStruct("tRsp",s,d.default.GetInfoFromVGRsp),t._onGetProxyResp(s)}),(function(t){g.default.logger.error("Get vp error, status=",t)}))}},{key:"_getVoiceProxy",value:function(t){var e=t.playerdata,i=t.appid,s=t.streamName,r=(t.subSid,t.presenterUid),a=(t.serviceType,t.userid),o=t.latencyModel,n=(t.maxCodeRateH264,t.maxCodeRateH265,t.clientType,t.sid),h=t.requestId,u=t.rtctrans,m=t.iBitRate;this.vpGetted=!0;var _=new l.default;_.sid=r,_.fuzzyParam.h264Only=!0,_.fuzzyParam.maxCodeRateH264=0,_.fuzzyParam.maxCodeRateH265=0;var f=a||(Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295,S=new p.default;S.uid=f,S.version=1,S.sdkVersion=1,S.fuzzyQueryKeys=[_],S.streamNames=[s],S.appid=i,S.clientAppid=0,S.clientType=14,S.sendTime=.001*Date.now()>>0,S.useCase=3,S.appUA="webh5&2504151055&websocket";var y=((e=e||{}).gameId||0)+"";S.extInfo.set("categoryId",y),u&&S.extInfo.set("rtctrans",u),void 0!==m&&S.extInfo.set("coderate",String(m)),S.latencyModel=o,g.default.logger.log("TafLinkSignal._getVoiceProxy uid=%s, requestId=%s",f,h,S);var T=S.constructor.name,P=c.default[T],v=new d.default.GetInfoFromVGReq;v.lUid=f;var E=this.TafLink.getTaf().getTaf().BinBuffer;v.sMsg=new E(S.marshall().buffer),v.sProtoName="yy",v.iUri=P||0,v.lSid=n||0,v.tId=this.TafLink.getUserId(),this.TafLink.sendWup("videogateway","getInfoFromVG",v,this._onGetProxyResp.bind(this),!0,h)}},{key:"_onGetProxyResp",value:function(t){g.default.logger.log("TafLinkSignal.onGetProxyResp",t);var e=t.iRequestId;if(e&&e!==this.vpRequestId)g.default.logger.error("Request id is inequality iRequestId=%d, vpRequestId=%d",e,this.vpRequestId);else{var i=new DataView(t.sMsg.buffer),s=new u.default(i),r=new m.default;r.unmarshall(s);var a=[];r.allocatedStreams.forEach((function(t,e){a=a.concat(t)})),this.emit(c.default.PAudienceGetProxyListRsp,r)}}},{key:"_getUserId",value:function(t){var e=new d.default.UserId;return e.lUid=t,e.sGuid=f.default.getCookie("guid"),e.sToken="",e.sHuYaUA="webh5&0.0.0&websocket",e.sCookie=document.cookie,e}}]),e}(_.EventEmitter);y.TAF_WUP_READY="TAF_WUP_READY",e.default=y},function(t,e,i){t.exports={default:i(169),__esModule:!0}},function(t,e,i){var s=i(3),r=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(21)),o=h(i(105)),n=h(i(16));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this._tafLink=e,this._mediaUserId=null,this._bAnonymous=0,this._tryTimes=0,this._isLogin=!1,this._roomId=0}return(0,r.default)(t,[{key:"destroy",value:function(){this._tafLink=null,this._mediaUserId=null}},{key:"loginMedia",value:function(t,e,i,s){if(this._roomId=e,!this._mediaUserId){var r=new a.default.MediaUserId;r.lUid=i,r.sGuid=o.default.getCookie("guid"),r.sToken=t,r.sUA="media_web&1000&",r.iAppid=s,r.sStrUid="",this._mediaUserId=r}this._login()}},{key:"_login",value:function(){this._mediaUserId.bAnonymous=this._bAnonymous;var t=new a.default.LoginVerifyReq;t.tId=this._mediaUserId,this._tafLink.sendWup("mediaui","loginVerify",t,this._onLogin.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onLogin",value:function(t){n.default.logger.log("MediaLink._onLogin iResCode="+t.iResCode),0===t.iResCode?(this._isLogin=!0,this._mediaUserId.sCookie=t.sCookie,this._join()):1===t.iResCode&&(this._tryTimes++,this._tryTimes<5&&(this._bAnonymous=1,this._login()))}},{key:"_join",value:function(){var t=new a.default.JoinMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],this._tafLink.sendWup("mediaui","joinGroup",t,this._onJoin.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onJoin",value:function(t){n.default.logger.log("MediaLink._onJoin iCode="+t.iCode)}},{key:"quitMedia",value:function(){var t=new a.default.QuitMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],this._tafLink.sendWup("mediaui","quitGroup",t,this._onQuit.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onQuit",value:function(t){n.default.logger.log("MediaLink._onQuit iCode="+t.iCode)}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(22)),r=l(i(0)),a=l(i(1)),o=l(i(24)),n=l(i(26)),h=l(i(69)),d=l(i(4));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(){return(0,r.default)(this,e),(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this))}return(0,n.default)(e,t),(0,a.default)(e,[{key:"onSlice",value:function(t){var e=new DataView(t.payload.buffer),i=this.unmarshall(t.uri,e);i.seq=t.seq,this.trigger(d.default.PP2pSliceData,{parent:t,child:i})}},{key:"getClass",value:function(t){return i(92)("./"+t).default}}]),e}(h.default);e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(22)),r=h(i(0)),a=h(i(1)),o=h(i(24)),n=h(i(26));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){return(0,r.default)(this,e),(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this))}return(0,n.default)(e,t),(0,a.default)(e,[{key:"getClass",value:function(t){return i(173)("./"+t).default}}]),e}(h(i(69)).default);e.default=d},function(t,e,i){var s={"./AnchorDtsSei":70,"./AnchorDtsSei.js":70,"./AnchorSeiInfo":107,"./AnchorSeiInfo.js":107,"./HuyaDelaySeiData":108,"./HuyaDelaySeiData.js":108,"./ServerDtsSei":71,"./ServerDtsSei.js":71,"./ServerNodeInfo":72,"./ServerNodeInfo.js":72};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=173},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=(s=i(175))&&s.__esModule?s:{default:s},a={};self||(self=window),function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(edg)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},o={};if(s.browser){o[s.browser]=!0;var n=s.majorVersion.split(".");o.version={major:parseInt(s.majorVersion,10),string:s.version,majorVersion:s.majorVersion},n.length>1&&(o.version.minor=parseInt(n[1],10)),n.length>2&&(o.version.build=parseInt(n[2],10))}for(var h in s.platform&&(o[s.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),(o.rv||o.iemobile)&&(o.rv&&delete o.rv,s.browser="msie",o.msie=!0),o.edge&&(delete o.edge,s.browser="msedge",o.chrome=!0),o.edg&&(delete o.edg,s.browser="msedge",o.chrome=!0),o.opr&&(s.browser="opera",o.opera=!0),o.safari&&o.android&&(s.browser="android",o.android=!0),o.name=s.browser,o.platform=s.platform,a)a.hasOwnProperty(h)&&delete a[h];(0,r.default)(a,o)}(),a.version||(a.version={major:0,minor:0,build:0,string:"0.0.0"}),e.default=a},function(t,e,i){t.exports={default:i(176),__esModule:!0}},function(t,e,i){i(177),t.exports=i(3).Object.assign},function(t,e,i){var s=i(5);s(s.S+s.F,"Object",{assign:i(178)})},function(t,e,i){"use strict";var s=i(6),r=i(31),a=i(56),o=i(33),n=i(23),h=i(48),d=Object.assign;t.exports=!d||i(15)((function(){var t={},e={},i=Symbol(),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach((function(t){e[t]=t})),7!=d({},t)[i]||Object.keys(d({},e)).join("")!=s}))?function(t,e){for(var i=n(t),d=arguments.length,l=1,c=a.f,u=o.f;d>l;)for(var p,m=h(arguments[l++]),_=c?r(m).concat(c(m)):r(m),f=_.length,g=0;f>g;)p=_[g++],s&&!u.call(m,p)||(i[p]=m[p]);return i}:d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(10)),r=l(i(0)),a=l(i(1)),o=l(i(40)),n=l(i(16)),h=l(i(19)),d=l(i(57));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,i,a,o,n){(0,r.default)(this,t),this.StatCfg=a,this.VodPcdnState=o,this.Timer=n,this._statVod=e,this._oldStat=i,this._open=!0,this._fragsMap=new s.default,this._subsUrlReqTs=0,this.isLoading=!1,this.isAborted=!1,this._onGetVodPcdnProxyBind=this._onGetVodPcdnProxy.bind(this),this._onGetVodPcdnProxyTimeoutBind=this._onGetVodPcdnProxyTimeout.bind(this)}return(0,a.default)(t,[{key:"destroy",value:function(){this.Timer.remove(this._onGetVodPcdnProxyTimeoutBind,this),this.isAborted=!0,this.StatCfg=null,this.Timer=null,this.VodPcdnState=null,this._statVod=null,this._oldStat=null,this._fragsMap&&this._fragsMap.clear(),this._fragsMap=null}},{key:"_getVodPcdnProxy",value:function(t,e,i){var s=i.uid,r=i.appid,a=i.sGuid,l=i.TafLink;if(this._open&&!this.isLoading){this.isLoading=!0,this.isAborted=!1,this._subsUrlReqTs=h.default.now();var c=new o.default.ClientGetVodPcdnProxyReq;c.appid=r,c.lReqTs=Date.now(),c.lUid=s,c.sGuid=a,c.iCliType=o.default.EM_CLINET_TYPE.E_CLIENT_WEB,c.lBucketPara=0,c.sOrigUrl=t,this._fragsMap.clear();for(var u=e.length,p=0;p<u;p++){var m=e[p],_=m.url.replace(/http.*?\/\//,"");this._fragsMap.set(m.sn,m);var f=new o.default.VodUrlRange;f.sUrl=_,m.byteRangeEndOffset&&(f.sRange="bytes="+m.byteRangeStartOffset+"-"+(m.byteRangeEndOffset-1)),f.index=m.sn,c.vKeys.value.push(f)}Number(d.default._print_pcdn_req)<=1&&n.default.logger.log("PcdnVodProxy.getVodPcdnProxy",c),l.sendWup("hypcdnvodgw","onClientGetVodPcdnProxyReq",c,this._onGetVodPcdnProxyBind),this.Timer.has(this._onGetVodPcdnProxyTimeoutBind,this)||this.Timer.once(this._onGetVodPcdnProxyTimeoutBind,this,5e3)}}},{key:"_onGetVodPcdnProxy",value:function(t){if(Number(d.default._print_pcdn_req)<=1&&n.default.logger.log("PcdnVodProxy._onGetVodPcdnProxy rsp:",t),!this.isAborted)if(this.Timer.remove(this._onGetVodPcdnProxyTimeoutBind,this),this.isLoading=!1,this._subsUrlReqTs>0&&(this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_SUBS_URL_TIME,h.default.now()-this._subsUrlReqTs),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_SUBS_URL_TIME_CNT,1),this._subsUrlReqTs=0),t)if(this._oldStat.setComDim(this.StatCfg.DIM_COM.PCDN_ORIGIN,t.pcdnName),this._statVod.setComDim(this.StatCfg.DIM_COM.PCDN_ORIGIN,t.pcdnName),this._statVod.setComDim(this.StatCfg.DIM_COM.CLI_ISP,t.cliIsp),this._statVod.setComDim(this.StatCfg.DIM_COM.CLI_PROV,t.cliProv),this._statVod.setCoreDim(this.StatCfg.DIM_CORE.PCDN_SVR_ISP,t.sPcdnIsp),this._statVod.setCoreDim(this.StatCfg.DIM_CORE.PCDN_SVR_AREA,t.sPcdnArea),t.iErrCode===o.default.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP.E_SUCCESS){this._statVod.setComDim(this.StatCfg.PCDN_DATA.USE_PCDN,1);for(var e=t.vPcdnUrls.value.length,i=0;i<e;i++){var s=t.vPcdnUrls.value[i],r=this._fragsMap.get(s.reqKey.index);if(r){switch(!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),s.iStatusPcdn){case 100:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_SUCCESS,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_REALTIME,s),this._rspVodPcdnProxyUrl(s);break;case 101:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_NOT_REACHED,1),this._updateFragPcdnState(this.VodPcdnState.REALTIME_NOT_REACHED,s);break;case 102:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OVER_RUN,1),this._updateFragPcdnState(this.VodPcdnState.REALTIME_OVER_RUN,s);break;case 200:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_SUC_FREETIME,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_FREETIME,s),this._rspVodPcdnProxyUrl(s);break;case 201:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OVER_RUN_FREETIME,1),this._updateFragPcdnState(this.VodPcdnState.FREETIME_OVER_RUN,s);break;case 301:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_NOT_COVERD,1),this._updateFragPcdnState(this.VodPcdnState.FREETIME_NOT_COVERD,s);break;case 302:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERROR_REQ,1),this._updateFragPcdnState(this.VodPcdnState.ERROR_REQ,s);break;default:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OTHER,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_REQ_OTHER,s)}r.statPcdn=!0}}}else t.iErrCode===o.default.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP.E_PCDN_OFF?(this._open=!1,this._statVod.setComDim(this.StatCfg.PCDN_DATA.USE_PCDN,0),this._updateFragPcdnState(this.VodPcdnState.PCDN_NOT_OPEN)):(this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR));else this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR)}},{key:"_onGetVodPcdnProxyTimeout",value:function(){n.default.logger.warn("PcdnVodProxy._onGetVodPcdnProxyTimeout pcdn proxy time out"),this.isLoading=!1,this.isAborted=!0,this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR),this.Timer.remove(this._onGetVodPcdnProxyTimeoutBind,this)}},{key:"_rspVodPcdnProxyUrl",value:function(t){var e=this._fragsMap.get(t.reqKey.index);e&&(e.pcdnUrls=t.vUrls.value.slice(),e.tryCnt=e.pcdnUrls.length,e.pcdnFreetime=200===t.iStatusPcdn)}},{key:"_updateFragPcdnState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t)if(e){var i=this._fragsMap.get(e.reqKey.index);i&&(i.pcdnStatus=t)}else this._fragsMap.forEach((function(e,i){return e.pcdnStatus=t}))}},{key:"isPcdnOpen",get:function(){return this._open}}]),t}();e.default=c}]).default},function(t,e,i){"use strict";i.r(e),i.d(e,"WebCodecsErrType",(function(){return s})),i.d(e,"ReceiveMessageType",(function(){return r})),i.d(e,"ToMainMessageType",(function(){return a})),i.d(e,"StoreWorkerType",(function(){return o})),i.d(e,"MainSharedBufferType",(function(){return n}));const s={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6},r={START:1,POSTFRAME:2,RESIZE:3,CLOSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27,SET_ENHANCE:28,SET_SEGMENTTION:29,RECV_FAST_OVER:30,AV1_INIT_SEG:31,SEEK_TIME:32,SET_PLAYBACKRATE:33,SET_VOD_AV1:34},a={WebGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,VIDEORENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23,VIDEO_ENHANCE_ERROR:24,VIDEO_ENHANCE_SUCCESS:25,ON_WCS_VIDEO_SEEK:26},o={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14,VIDEO_DECODED_DELAY_SMOOTH:21,VIDEO_ENHANCE_NUMS:22,VIDEO_ENAHNCE_COST:23,VIDEO_ENHANCE_LESS30_NUMS:24,VIDEO_ENHANCE_LESS150_NUMS:25,VIDEO_ENHANCE_LESS200_NUMS:26,VIDEO_ENHANCE_LARGE200_NUMS:27,VIDEO_ENHANCE_TOTAL:28,AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES:31,VIDEO_FIRST_FRAME_DECODEC_COST:32,AUDIO_FIRST_FRAME_DECODEC_COST:33},n={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20,LAST_VIDEO_RCV_TS:29,BROWSER_PAUSE_STATUS:30}},function(t,e,i){"use strict";const s=navigator.userAgent;e.a=new class{constructor(){this.matches=null,this.versionFuncs=null,this.device="",this.language="",this.browser="",this.version={major:0,full:""},this.kernel="",this.kernelVersion=0,this.os="",this.osVersion="",this.genBrowserInfo(),this.amendOSVersionCallback=null}getMatches(){const t=s;this.matches={Trident:t.indexOf("Trident")>-1||t.indexOf("NET CLR")>-1,Presto:t.indexOf("Presto")>-1,WebKit:t.indexOf("AppleWebKit")>-1,Gecko:t.indexOf("Gecko/")>-1,KHTML:t.indexOf("KHTML/")>-1,Safari:t.indexOf("Safari")>-1,Chrome:t.indexOf("Chrome")>-1||t.indexOf("CriOS")>-1,IE:t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,Edge:t.indexOf("Edge")>-1||t.indexOf("Edg/")>-1,Firefox:t.indexOf("Firefox")>-1||t.indexOf("FxiOS")>-1,"Firefox Focus":t.indexOf("Focus")>-1,Chromium:t.indexOf("Chromium")>-1,Opera:t.indexOf("Opera")>-1||t.indexOf("OPR")>-1,Vivaldi:t.indexOf("Vivaldi")>-1,Yandex:t.indexOf("YaBrowser")>-1,Arora:t.indexOf("Arora")>-1,Lunascape:t.indexOf("Lunascape")>-1,QupZilla:t.indexOf("QupZilla")>-1,"Coc Coc":t.indexOf("coc_coc_browser")>-1,Kindle:t.indexOf("Kindle")>-1||t.indexOf("Silk/")>-1,Iceweasel:t.indexOf("Iceweasel")>-1,Konqueror:t.indexOf("Konqueror")>-1,Iceape:t.indexOf("Iceape")>-1,SeaMonkey:t.indexOf("SeaMonkey")>-1,Epiphany:t.indexOf("Epiphany")>-1,360:t.indexOf("QihooBrowser")>-1||t.indexOf("QHBrowser")>-1,"360EE":t.indexOf("360EE")>-1,"360SE":t.indexOf("360SE")>-1,UC:t.indexOf("UCBrowser")>-1||t.indexOf(" UBrowser")>-1||t.indexOf("UCWEB")>-1,QQBrowser:t.indexOf("QQBrowser")>-1,QQ:t.indexOf("QQ/")>-1,Baidu:t.indexOf("Baidu")>-1||t.indexOf("BIDUBrowser")>-1||t.indexOf("baidubrowser")>-1||t.indexOf("baiduboxapp")>-1||t.indexOf("BaiduHD")>-1,Maxthon:t.indexOf("Maxthon")>-1,Sogou:t.indexOf("MetaSr")>-1||t.indexOf("Sogou")>-1,Liebao:t.indexOf("LBBROWSER")>-1||t.indexOf("LieBaoFast")>-1,"2345Explorer":t.indexOf("2345Explorer")>-1||t.indexOf("Mb2345Browser")>-1||t.indexOf("2345chrome")>-1,"115Browser":t.indexOf("115Browser")>-1,TheWorld:t.indexOf("TheWorld")>-1,XiaoMi:t.indexOf("MiuiBrowser")>-1,Quark:t.indexOf("Quark")>-1,Qiyu:t.indexOf("Qiyu")>-1,Wechat:t.indexOf("MicroMessenger")>-1,WechatWork:t.indexOf("wxwork/")>-1,Taobao:t.indexOf("AliApp(TB")>-1,Alipay:t.indexOf("AliApp(AP")>-1,Weibo:t.indexOf("Weibo")>-1,Douban:t.indexOf("com.douban.frodo")>-1,Suning:t.indexOf("SNEBUY-APP")>-1,iQiYi:t.indexOf("IqiyiApp")>-1,DingTalk:t.indexOf("DingTalk")>-1,Huawei:t.indexOf("HuaweiBrowser")>-1||t.indexOf("HUAWEI/")>-1||t.indexOf("HONOR")>-1,Vivo:t.indexOf("VivoBrowser")>-1,Windows:t.indexOf("Windows")>-1,Linux:t.indexOf("Linux")>-1||t.indexOf("X11")>-1,"Mac OS":t.indexOf("Macintosh")>-1,Android:t.indexOf("Android")>-1||t.indexOf("Adr")>-1,HarmonyOS:t.indexOf("HarmonyOS")>-1,Ubuntu:t.indexOf("Ubuntu")>-1,FreeBSD:t.indexOf("FreeBSD")>-1,Debian:t.indexOf("Debian")>-1,"Windows Phone":t.indexOf("IEMobile")>-1||t.indexOf("Windows Phone")>-1,BlackBerry:t.indexOf("BlackBerry")>-1||t.indexOf("RIM")>-1,MeeGo:t.indexOf("MeeGo")>-1,Symbian:t.indexOf("Symbian")>-1,iOS:t.indexOf("like Mac OS X")>-1,"Chrome OS":t.indexOf("CrOS")>-1,WebOS:t.indexOf("hpwOS")>-1,Mobile:t.indexOf("Mobi")>-1||t.indexOf("iPh")>-1||t.indexOf("480")>-1,Tablet:t.indexOf("Tablet")>-1||t.indexOf("Pad")>-1||t.indexOf("Nexus 7")>-1},this.matches.Mobile?this.matches.Mobile=!(t.indexOf("iPad")>-1):this.is360()&&(this.mime("type","application/gameplugin")||navigator&&void 0!==navigator.connection&&void 0===navigator.connection.saveData?this.matches["360SE"]=!0:this.matches["360EE"]=!0),this.matches.Baidu&&this.matches.Opera?this.matches.Baidu=!1:this.matches.iOS&&(this.matches.Safari=!0),window.chrome&&(window.chrome.adblock2345||window.chrome.common2345)&&(this.matches["2345Explorer"]=!0)}genBrowserInfo(){this.getMatches();const t={kernel:["WebKit","Trident","Gecko","Presto","KHTML"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Arora","Lunascape","QupZilla","Coc Coc","Kindle","Iceweasel","Konqueror","Iceape","SeaMonkey","Epiphany","XiaoMi","Vivo","360","360SE","360EE","UC","QQBrowser","QQ","Huawei","Baidu","Maxthon","Sogou","Liebao","2345Explorer","115Browser","TheWorld","Quark","Qiyu","Wechat","WechatWork","Taobao","Alipay","Weibo","Douban","Suning","iQiYi","DingTalk"],os:["Windows","Linux","Mac OS","Android","HarmonyOS","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet"]};var e;this.device="PC",this.language=((e=(navigator.browserLanguage||navigator.language).split("-"))[1]&&(e[1]=e[1].toUpperCase()),e.join("_"));for(let e in t)for(let i=0;i<t[e].length;i++){const s=t[e][i];this.matches[s]&&(this[e]=s)}this.getOSVersion(),this.getBrowserVersion(),this.amendSpecialCase(),this.amendOSVersion()}getOSVersion(){const t=s,e={Windows:function(){const e=t.replace(/^Mozilla\/\d.0 \(Windows NT ([\d.]+)[;)].*$/,"$1");return{10:"10",6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[e]||e},Android:function(){return t.replace(/^.*Android ([\d.]+);.*$/,"$1")},HarmonyOS:function(){return{10:"2"}[t.replace(/^Mozilla.*Android ([\d.]+)[;)].*$/,"$1")]||""},iOS:function(){return t.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return t.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return t.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return t.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return t.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};this.osVersion="",e[this.os]&&(this.osVersion=e[this.os](),this.osVersion==t&&(this.osVersion=""))}amendOSVersion(){"Windows"===this.os&&navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&navigator.userAgentData.getHighEntropyValues(["platformVersion"]).then(t=>{t.platformVersion&&parseInt(t.platformVersion.split(".")[0])>=13&&(this.osVersion="11",this.amendOSVersionCallback&&this.amendOSVersionCallback())})}getBrowserVersion(){const t=s;if(this.versionFuncs={Safari:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return t.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return t.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return t.replace(/^.*Edge\/([\d.]+).*$/,"$1").replace(/^.*Edg\/([\d.]+).*$/,"$1")},Firefox:function(){return t.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return t.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return t.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return t.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return t.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return t.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Arora:function(){return t.replace(/^.*Arora\/([\d.]+).*$/,"$1")},Lunascape:function(){return t.replace(/^.*Lunascape[\/\s]([\d.]+).*$/,"$1")},QupZilla:function(){return t.replace(/^.*QupZilla[\/\s]([\d.]+).*$/,"$1")},"Coc Coc":function(){return t.replace(/^.*coc_coc_browser\/([\d.]+).*$/,"$1")},Kindle:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1")},Iceweasel:function(){return t.replace(/^.*Iceweasel\/([\d.]+).*$/,"$1")},Konqueror:function(){return t.replace(/^.*Konqueror\/([\d.]+).*$/,"$1")},Iceape:function(){return t.replace(/^.*Iceape\/([\d.]+).*$/,"$1")},SeaMonkey:function(){return t.replace(/^.*SeaMonkey\/([\d.]+).*$/,"$1")},Epiphany:function(){return t.replace(/^.*Epiphany\/([\d.]+).*$/,"$1")},360:function(){return t.replace(/^.*QihooBrowser\/([\d.]+).*$/,"$1")},"360SE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"10.0",55:"9.1",45:"8.1",42:"8.0",31:"7.0",21:"6.3"}[t.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"360EE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"9.5",55:"9.0",50:"8.7",30:"7.5"}[t.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},Maxthon:function(){return t.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return t.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return t.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return t.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1").replace(/^.*baiduboxapp\/([\d.]+).*$/,"$1")},UC:function(){return t.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return t.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},Liebao:function(){let e="";t.indexOf("LieBaoFast")>-1&&(e=t.replace(/^.*LieBaoFast\/([\d.]+).*$/,"$1"));const i=t.replace(/^.*Chrome\/([\d]+).*$/,"$1");return e||{57:"6.5",49:"6.0",46:"5.9",42:"5.3",39:"5.2",34:"5.0",29:"4.5",21:"4.0"}[i]||""},"2345Explorer":function(){return{69:"10.0",55:"9.9"}[navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||t.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1").replace(/^.*Mb2345Browser\/([\d.]+).*$/,"$1")},"115Browser":function(){return t.replace(/^.*115Browser\/([\d.]+).*$/,"$1")},TheWorld:function(){return t.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return t.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Vivo:function(){return t.replace(/^.*VivoBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return t.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return t.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return t.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},WechatWork:function(){return t.replace(/^.*wxwork\/([\d.]+).*$/,"$1")},Taobao:function(){return t.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return t.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return t.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return t.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return t.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return t.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")},DingTalk:function(){return t.replace(/^.*DingTalk\/([\d.]+).*$/,"$1")},Huawei:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1").replace(/^.*HuaweiBrowser\/([\d.]+).*$/,"$1")}},this.versionFuncs[this.browser]){const e=this.versionFuncs[this.browser]();e!==t&&(this.version.major=parseInt(e),this.version.full=e)}}amendSpecialCase(){const t=s;if("Chrome"==this.browser&&t.match(/\S+Browser/)){this.browser=t.match(/\S+Browser/)[0];const e=t.replace(/^.*Browser\/([\d.]+).*$/,"$1");this.version.major=parseInt(e),this.version.full=e}if("Firefox"!=this.browser||!window.clientInformation&&window.u2f||(this.kernel=this.browser,this.kernelVersion=this.version.major,this.browser+=" Nightly"),"Edge"==this.browser)this.version.major>75?(this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome())):(this.kernel="EdgeHTML",this.kernelVersion=0);else if(this.matches.Chrome&&"WebKit"===this.kernel&&parseInt(this.versionFuncs.Chrome())>27)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Opera"==this.browser&&this.version.major>12)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Yandex"==this.browser)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if(this.matches.Safari&&"WebKit"===this.kernel){let e=t.replace(/^.*Version\/([\d.]+).*$/,"$1");e===t&&(e=t.replace(/^.*AppleWebKit\/([\d.]+).*$/,"$1")),this.kernelVersion=parseInt(e)||0}}is360(){const t=s;let e=!1;if(window.chrome){const i=Number(t.replace(/^.*Chrome\/([\d]+).*$/,"$1"));this.mime("type","application/360softmgrplugin")||this.mime("type","application/mozilla-npqihooquicklogin")||i>36&&window.showModalDialog?e=!0:i>45&&(e=this.mime("type","application/vnd.chromium.remoting-viewer"),!e&&i>=69&&(e=this.mime("type","application/hwepass2001.installepass2001")||this.mime("type","application/asx")))}return e}mime(t,e){var i=navigator.mimeTypes;for(var s in i)if(i[s][t]==e)return!0;return!1}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const s={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6,AUDIORENDERERROR:7,NOT_SUPPORT_MEDIASRTREAMTRACK:8,DISABLE_HARDWARE_ACCELERATION:9,SOFT_TURN_TO_MSE:10,WIN_PERF_INSUFFICIENT:11,RETRY_MAX_TIMES:12,DECODE_COST:13,DECODE_DTS:14,BROWSER_NOT_SUPPORTED:15,IS_PUREAUDIO:16,ANGLE_NULL:17,DECODE_ERROR_COOL:18,CHROME_H265_RENDER_INFO_EMPTY:19,IS_NOT_SUPPORT_CONFIGURE:20,IS_NOT_SUPPORT_OS:21,AUDIO_DATA_NAN:22,AUDIO_FORMAT_ERROR:23,AUDIO_DATA_MUTE:24,IS_NOT_SUPPORT_CATEGORY:25,BROWSER_VERSION_NOT_SUPPORTED_WCS:26,BROWSER_VERSION_NOT_SUPPORTED_WCS_H265:27,BROWSER_VERSION_NOT_SUPPORTED_WCS_H264:28,VOD_AV1_CLOSE_CFg:29,NOT_SUPPORT_AUDIO_SAMPLERATE:30,SCREEN_COLOR:31,BROWSER_NAME_NOT_SUPPORTED_WCS_H265:32}},function(t,e,i){"use strict";e.a={NONE:0,LIVE:1,REPLAY:2,VOD:3}},function(t,e,i){"use strict";var s=i(23),r=i(2);e.a={AVC1:"avc1.42E01E,mp4a.40.2",HVC1:"hvc1.1.6.L93,mp4a.40.2",AV01:"av01.0.08M.08,mp4a.40.2",isMseSupportedH264:function(){return this._isSupported(this.AVC1)},isMseSupportedHevc:function(){return this._isSupported(this.HVC1)},isMseSupportedAV01:function(){return this._isSupported(this.AV01)},_isSupported:function(t){let e=s.a.getMediaSource(r.a.mmsOpen);return e&&e.isTypeSupported("video/mp4; codecs=".concat(t))}}},function(t,e,i){"use strict";e.a={printTodecodeVideo:!1,printToDecodeAudio:!1,printDecodedVideo:!1,printDecodedAudio:!1,printTorenderVideo:!1,printTorenderAudio:!1,printAppendVideo:!1,printAppendAudio:!1,printVideoDecodeFast:!1,printRenderSkipFrame:!1,setCfg:function(t){for(let e in t)this[e]=t[e]}}},function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function n(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+t}i.r(e);var h=[];function d(){for(var t,e=function(){var t=new Date,e=t.getFullYear(),i=n(t.getMonth()+1,2),s=n(t.getDate(),2),r=n(t.getHours(),2),a=n(t.getMinutes(),2),o=n(t.getSeconds(),2);return"["+"".concat(e,"-").concat(i,"-").concat(s," ").concat(r,":").concat(a,":").concat(o)+"."+n(t.getMilliseconds(),3)+"][w265]"}(),i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];s[0]=e+s[0],self.logCallback?(t=self.logCallback).call.apply(t,[null].concat(s)):h.push(s)}var l=function(){function t(e,i){s(this,t),this.width=e,this.height=i,this.stridey=this.width,this.strideu=this.stridey/2,this.stridev=this.stridey/2}return a(t,[{key:"calc",value:function(t){for(var e=new Uint8Array(this.stridey*this.height).fill(128,0,this.stridey*this.height),i=new Uint8Array(this.strideu*this.height).fill(128,0,this.strideu*this.height),s=new Uint8Array(this.stridev*this.height).fill(128,0,this.stridev*this.height),r=new Uint8Array(this.width*this.height*4),a=1e3*window.performance.now(),o=0;o<t;o++)this.convertYUV420(e,i,s,this.width,this.height,this.stridey,this.strideu,this.stridev,r);return 1e3*window.performance.now()-a}},{key:"convertYUV420",value:function(t,e,i,s,r,a,o,n,h){for(var d,l,c,u,p,m=0,_=0,f=s>>1,g=f*r,S=0,y=0,T=0,P=0;P<g;P++)p=P<<1,d=1.164*(t[S+(u=m<<1)]-16),l=e[y+m]-128,c=i[T+m]-128,h[0+(p<<2)]=d+1.596*c,h[1+(p<<2)]=d-.813*c-.391*l,h[2+(p<<2)]=d+2.018*l,h[3+(p<<2)]=255,d=1.164*(t[S+u+1]-16),h[0+(p+1<<2)]=d+1.596*c,h[1+(p+1<<2)]=d-.813*c-.391*l,h[2+(p+1<<2)]=d+2.018*l,h[3+(p+1<<2)]=255,++m===f&&(m=0,S+=a,y=(++_>>1)*o,T=(_>>1)*n)}}]),t}(),c=function(){function t(){s(this,t)}return a(t,null,[{key:"isSupportWasm",value:function(){return"object"==typeof WebAssembly}},{key:"isSupportWasmThread",value:function(){if("undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)return d("hevcd","SharedArrayBuffer undefined or Atomics undefined"),!1;var t=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer;return self.SharedArrayBuffer&&self.Atomics&&t}}]),t}(),u=function(){function t(){s(this,t),this.cla="hevcd",this.configs=null,this.costUs=0,this.reason=0,this.cores=navigator.hardwareConcurrency,this.is64bit=this.is64bitSoftware(),this.enableCost=!0}return a(t,[{key:"parseConfigs",value:function(t){this.configs=t,d(this.cla,"parse",JSON.stringify(t),"cfg",this.configs.enableWebH265)}},{key:"isSupportH265",value:function(t,e){if(null==this.configs)return d(this.cla,"isSupportH265 configs==null"),!1;this.reason=0;var i=this.isConfigEnable()&&this.isCPUCoresSatisfy(e)&&this.isWasm()&&this.isBitrateInRange(e)&&this.isCostInRange(e);return d(this.cla,"isSupportH265",i,"kbps=",e,"costUs",this.costUs.toFixed(0),"cores",this.cores,"64b",this.is64bit,"reason",this.reason,"version",t,"cfg",JSON.stringify(this.configs)),d("ua:",navigator.userAgent),{isSupport:i,costUs:this.costUs.toFixed(0),reason:this.reason}}},{key:"isWasm",value:function(){return!!c.isSupportWasm()||(this.reason=7,!1)}},{key:"isConfigEnable",value:function(){return!(!this.hasOwnProperty("enableWebH265")||1!=this.configs.enableWebH265&&(this.reason=1,1))}},{key:"isCPUCoresSatisfy",value:function(t){if(this.hasOwnProperty("core")){var e=this.configs.core[2e3];if(this.configs.core.hasOwnProperty(t)&&(e=this.configs.core[t]),this.cores>e)return!0}else if(this.cores>4)return!0;return this.reason=2,!1}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isBitrateInRange",value:function(t){return c.isSupportWasmThread()?!(!this.hasOwnProperty("multiThreadBitKbps")||((t>=4e3||0==t)&&!this.checkX86(t)?(this.reason=4,1):(!Array.isArray(this.configs.multiThreadBitKbps)||!this.configs.multiThreadBitKbps.includes(t))&&(this.reason=3,1))):(this.reason=6,!1)}},{key:"checkX86",value:function(t){if(this.is64bit)return!0;if(!this.hasOwnProperty("x86"))return!1;var e=!1;return this.configs.x86.hasOwnProperty(t)&&(e=1==this.configs.x86[t]),e}},{key:"isCostInRange",value:function(t){if(!this.enableCost)return!0;if(!this.hasOwnProperty("baseCostUs"))return!1;var e=this.configs.baseCostUs[2e3];return this.configs.baseCostUs.hasOwnProperty(t)&&(e=this.configs.baseCostUs[t]),this.costUs=this.getCost(),this.costUs<=e||(this.reason=5,!1)}},{key:"getCost",value:function(){var t=this;if(!this.hasOwnProperty("loopCount"))return d(this.cla,"getCost configs==null or has no key=loopCount"),0;var e=0;try{localStorage.hasOwnProperty("w265LastCost")&&(e=Number(localStorage.w265LastCost))}catch(t){e=99999}return this.sid&&clearTimeout(this.sid),this.sid=setTimeout((function(){var e=new l(120,120),i=Math.floor(e.calc(t.configs.loopCount));try{localStorage.w265LastCost=i}catch(t){}}),5e3),e}},{key:"hasOwnProperty",value:function(t){return!!this.configs.hasOwnProperty(t)||(this.reason=1,!1)}}]),t}(),p=function(){function t(){s(this,t),this.configMgr=new u}return a(t,[{key:"parseConfigs",value:function(t){this.configMgr.parseConfigs(t)}},{key:"isSupportH265",value:function(t){return this.configMgr.isSupportH265(this.version(),t)}},{key:"version",value:function(){return"1.5.3"}},{key:"setLogCallback",value:function(t){var e;e=t,self.logCallback=e,d("Logger setLogCallback"),h.length>0&&(h.forEach((function(t){var e;(e=self.logCallback).call.apply(e,[null].concat(function(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t)))})),h.length=0)}},{key:"isStripe",value:function(){return-1!==navigator.userAgent.indexOf("Windows")}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();e.default=p}]).default},function(t,e,i){"use strict";i.r(e);var s=i(20),r=i(11),a=i(2),o=i(5);class n extends s.EventEmitter{constructor(){super(),this._taf=null,this._tafLink=new r.TafLinkImpl(a.a,o.a),this.WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",this.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",this.WEBSOCKET_ERROR="WEBSOCKET_ERROR",this.TAFLINK_INITED="TAFLINK_INITED"}getRequestId(){return this._tafLink.getRequestId()}getTaf(){return this._tafLink.getTaf()}setTafHandler(t){this._tafLink.setTafHandler(t)}get inited(){return!!this._tafLink.getTaf()}get connected(){return this._tafLink.connected}getUserId(){return this._tafLink.getUserId()}sendWup(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._tafLink.sendWup(t,e,i,s,r,a,o)}getInfoFromVG(t,e,i,s){this._tafLink.getInfoFromVG(t,e,i,s)}sendYY(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._tafLink.sendYY(t,e,i,s,r)}on(t,e){return this._tafLink.on(t,e)}off(t,e){return this._tafLink.off(t,e)}addListener(t,e){return this._tafLink.addListener(t,e)}removeListener(t,e){return this._tafLink.removeListener(t,e)}}let h=new n;e.default=h},function(t,e,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function n(){n.init.call(this)}t.exports=n,t.exports.once=function(t,e){return new Promise((function(i,s){function r(i){t.removeListener(e,a),s(i)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}g(t,e,a,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&g(t,"error",e,{once:!0})}(t,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var h=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function c(t,e,i,s){var r,a,o,n;if(d(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=s?[i,o]:[o,i]:s?o.unshift(i):o.push(i),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,n=h,console&&console.warn&&console.warn(n)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=u.bind(s);return r.listener=i,s.wrapFn=r,r}function m(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):f(r,r.length)}function _(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}function g(t,e,i,s){if("function"==typeof t.on)s.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(a){s.once&&t.removeEventListener(e,r),i(a)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var n=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw n.context=o,n}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)a(h,this,e);else{var d=h.length,l=f(h,d);for(i=0;i<d;++i)a(l[i],this,e)}return!0},n.prototype.addListener=function(t,e){return c(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return c(this,t,e,!0)},n.prototype.once=function(t,e){return d(e),this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,s,r,a,o;if(d(e),void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,o||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},n.prototype.listeners=function(t){return m(this,t,!0)},n.prototype.rawListeners=function(t){return m(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},n.prototype.listenerCount=_,n.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,e,i){"use strict";function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return s}))},function(t,e,i){function s(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var s=i(i.s=ENTRY_MODULE);return s.default||s}function r(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t,e,s){var a={};a[s]=[];var o=e.toString(),n=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return a;for(var h,d=n[1],l=new RegExp("(\\\\n|\\W)"+r(d)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");h=l.exec(o);)"dll-reference"!==h[3]&&a[s].push(h[3]);for(l=new RegExp("\\("+r(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");h=l.exec(o);)t[h[2]]||(a[s].push(h[1]),t[h[2]]=i(h[1]).m),a[h[2]]=a[h[2]]||[],a[h[2]].push(h[4]);for(var c,u=Object.keys(a),p=0;p<u.length;p++)for(var m=0;m<a[u[p]].length;m++)c=a[u[p]][m],isNaN(1*c)||(a[u[p]][m]=1*a[u[p]][m]);return a}function o(t){return Object.keys(t).reduce((function(e,i){return e||t[i].length>0}),!1)}t.exports=function(t,e){e=e||{};var r={main:i.m},n=e.all?{main:Object.keys(r.main)}:function(t,e){for(var i={main:[e]},s={main:[]},r={main:{}};o(i);)for(var n=Object.keys(i),h=0;h<n.length;h++){var d=n[h],l=i[d].pop();if(r[d]=r[d]||{},!r[d][l]&&t[d][l]){r[d][l]=!0,s[d]=s[d]||[],s[d].push(l);for(var c=a(t,t[d][l],d),u=Object.keys(c),p=0;p<u.length;p++)i[u[p]]=i[u[p]]||[],i[u[p]]=i[u[p]].concat(c[u[p]])}}return s}(r,t),h="";Object.keys(n).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map((function(e){return JSON.stringify(e)+": "+r[t][e].toString()})).join(",")+"});\n"})),h=h+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var d=new window.Blob([h],{type:"text/javascript"});if(e.bare)return d;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),c=new window.Worker(l);return c.objectURL=l,c}},function(t,e,i){"use strict";e.a=class{static getMediaSource(t){return window.ManagedMediaSource&&t?window.ManagedMediaSource:window.MediaSource?window.MediaSource:null}static isManagedMediaSource(t){return t===window.ManagedMediaSource}}},function(t,e,i){"use strict";var s={buildAbsoluteURL:function(t,e){if(e=e.trim(),/^[a-z]+:/i.test(e))return e;var i=null,r=null,a=/^([^#]*)(.*)$/.exec(e);a&&(r=a[2],e=a[1]);var o=/^([^\?]*)(.*)$/.exec(e);o&&(i=o[2],e=o[1]);var n=/^([^#]*)(.*)$/.exec(t);n&&(t=n[1]);var h=/^([^\?]*)(.*)$/.exec(t);h&&(t=h[1]);var d=/^((([a-z]+):)?\/\/[a-z0-9\.-]+(:[0-9]+)?\/)(.*)$/i.exec(t),l=d[3],c=d[1],u=d[5],p=null;return p=/^\/\//.test(e)?l+"://"+s.buildAbsolutePath("",e.substring(2)):/^\//.test(e)?c+s.buildAbsolutePath("",e.substring(1)):c+s.buildAbsolutePath(u,e),i&&(p+=i),r&&(p+=r),p},buildAbsolutePath:function(t,e){for(var i,s,r=e,a="",o=t.replace(/[^\/]*$/,r.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),n=0;(s=o.indexOf("/../",n))>-1;n=s+i)i=/^\/(?:\.\.\/)*/.exec(o.slice(s))[0].length,a=(a+o.substring(n,s)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");let h=/\.\.\//g;if(h.test(e)){let i=t.split("/"),s=e.match(h).length;a=i.splice(0,i.length-1-s);let r=o.substr(n);return r.startsWith("/")?a.join("/")+r:a.join("/")+"/"+r}return a+o.substr(n)},getTimeFromUrl:function(t,e){var i=e?/\d+_(\d+)_\d+.ts?/:/(\d+)_\d+_\d+.ts?/,s=t.match(i);return s?e?s[1]:Math.round(s[1]/1e3):-1},getVodUrl:function(t,e,i,s){return"http://106.38.255.95:9123/xcrs/"+t+"_"+e+"_"+i+".m3u8?btime="+s}};t.exports=s},function(t,e){t.exports=function(t){console.log("[ Timer worker init ]");var e=null;function i(){clearInterval(e),e=null}t.addEventListener("message",(function(s){switch(s.data){case"start":i(),e=setInterval((function(){t.postMessage({type:1})}),10);break;case"stop":i()}})),t.addEventListener("messageerror",(function(t){console.error("[TimerWorker.messageerror]",t)}));let s=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame,r=0,a=0,o=0;s((function e(){requestAnimationFrame(e),function(){let e=function(){let t=0;return t=performance&&performance.now?performance.now():Date.now(),t}();if(r++,0===a)a=e;else{let i=e-a;if(i>=1e3){a=e;let s=Math.round(r/(i/1e3));r=0,o=Math.max(s,o),t.postMessage({type:2,data:o})}}}()}))}},function(t,e,i){t.exports=i(28)('!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(){}}i.INIT="init",i.INITED="inited",i.STOP="stop",i.PAUSE="pause",i.RESUME="resume",i.PLAY="play",i.AUDIO_FRAME="audio_frame",i.UPDATE_CURRENT_TIME="update_current_time",i.TIME_STAMP="timestamp",i.VOLUME="volume",i.AUDIO_DATA_NAN="AUDIO_DATA_NAN",i.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",i.LOG_CFG="LOG_CFG",i.UPDATE_PLAYBACKRATE="UPDATE_PLAYBACKRATE",i.SEEK="SEEK",i.ON_VIDEO_SEEK="ON_VIDEO_SEEK";var a=i;const r=12,h=13,o=31;var u=class{constructor(){this.m_sampleRate=44100,this.MAX_WSOLA_DELAY_MS=80,this.MIN_32bit=-2147483648,this.m_DelaySamples=this.m_sampleRate*this.MAX_WSOLA_DELAY_MS/1e3,this.m_channels=2,this.m_leftSampleNum=0,this.m_speedWsola=1,this.m_tempoInstr=0,this.m_outBuffer=[],this.m_inBuffer=[],this.dataCallback=null,this.lastFrameTimeStamp=0}updateSpeed(t){t=(t=t<.2?.2:t)>2?2:t,this.m_speedWsola=t,1==this.m_speedWsola?this.m_tempoInstr=0:this.m_speedWsola>=1?this.m_speedWsola>=1.25?(this.m_speedWsola=this.m_speedWsola>2?2:this.m_speedWsola,this.m_tempoInstr=2):this.m_tempoInstr=1:this.m_speedWsola<.5?(this.m_speedWsola=this.m_speedWsola<.2?.2:this.m_speedWsola,this.m_tempoInstr=-2):this.m_tempoInstr=-1}init(t,e,s,i){this.dataCallback=i,this.m_sampleRate=t,this.m_DelaySamples=this.m_sampleRate*this.MAX_WSOLA_DELAY_MS/1e3,this.m_channels=e,this.updateSpeed(s)}clearInputBuffer(){this.m_leftSampleNum=0,this.lastFrameTimeStamp=0,this.m_inBuffer=[],this.m_outBuffer=[]}tempo_processData(t,e,s){this.lastFrameTimeStamp=s;let i=this.m_sampleRate/100,a=0,r=0,h=0,o=0,u=0,m=0,n=0,l=0,p=0,f=0,d=0,_=1,c=0,A=0,N=0,S=0;for(let e=0;e<t.length;e++)this.m_inBuffer.push(t[e]);if(this.m_leftSampleNum+=e,this.m_leftSampleNum<this.m_DelaySamples)return 0;switch(this.m_tempoInstr){case 2:case 1:u=2*i,a=4*i,r=u,h=Math.floor(i*(4*this.m_speedWsola-2)),o=i+1>>1;break;case-1:u=4*i,a=8*i,r=u,h=Math.floor(i*(8*this.m_speedWsola-4)),o=i+1>>1;break;case-2:{e>this.m_leftSampleNum&&(e=this.m_leftSampleNum),this.m_leftSampleNum-=e,this.m_inBuffer.splice(0,e*this.m_channels);let t=[],s=e*this.m_channels/this.m_speedWsola;for(let e=0;e<s;e++)t.push(0);let i=this.m_leftSampleNum/e*10,a=this.lastFrameTimeStamp-i;return this.dataCallback(t,a),e*this.m_channels}case 0:{this.m_outBuffer=[];for(let t=0;t<e*this.m_channels;t++)this.m_outBuffer.push(this.m_inBuffer[t]);e>this.m_leftSampleNum&&(e=this.m_leftSampleNum),this.m_leftSampleNum-=e,this.m_inBuffer.splice(0,e*this.m_channels);let t=[];for(let s=0;s<e*this.m_channels;s++)t.push(this.m_outBuffer.shift());let s=this.m_leftSampleNum/e*10,i=this.lastFrameTimeStamp-s;return this.dataCallback(t,i),e*this.m_channels}}A=1/u;let D=(new Date).getTime();for(;this.m_leftSampleNum>=this.m_DelaySamples;){if((new Date).getTime()-D>2e3)return;for(l=0;l<a*this.m_channels;l++)this.m_outBuffer[l]=this.m_inBuffer[l];if(n=this.MIN_32bit,2==this.m_channels){for(l=0;l<2*o;l++){m=0;let t=(a-u)*this.m_channels;for(let e=0;e<u;e++)m+=Math.floor(this.m_outBuffer[t+2*e]*this.m_inBuffer[2*(h+l-o)+2*e]),m+=Math.floor(this.m_outBuffer[t+2*e+1]*this.m_inBuffer[2*(h+l-o)+2*e+1]);n<m&&(n=m,f=l)}for(d=f-o,_=1,c=0,l=0;l<u;l++)this.m_outBuffer[2*(l+r)]=_*this.m_outBuffer[2*(l+r)]+c*this.m_inBuffer[2*(l+h+d)],this.m_outBuffer[2*(l+r)+1]=_*this.m_outBuffer[2*(l+r)+1]+c*this.m_inBuffer[2*(l+h+d)+1],_-=A,c+=A}else{for(l=0;l<2*o;l++){for(m=0,p=0;p<u;p++)m+=Math.floor(psOutBuffer[a-u+p]*psInBuffer[h+l-o+p]);n<m&&(n=m,f=l)}for(d=f-o,_=1,c=0,l=0;l<u;l++)this.m_outBuffer[l+r]=_*this.m_outBuffer[l+r]+c*this.m_inBuffer[l+h+d],_-=A,c+=A}N+=a*this.m_channels,S=h+d+u,S>this.m_leftSampleNum&&(S=this.m_leftSampleNum),this.m_leftSampleNum-=S,this.m_inBuffer.splice(0,2*S)}let T=[];for(let t=0;t<N;t++)T.push(this.m_outBuffer.shift());let g=this.m_leftSampleNum/e*10,y=this.lastFrameTimeStamp-g;this.dataCallback(T,y)}};class m extends AudioWorkletProcessor{constructor(t){super(t),this.port.onmessage=this.onMessage.bind(this),this.audioList=[],this.channelDataLength=128,this.outputChannelNums=2,this.traceNums=0,this.currentTime=0,this.inited=!1,this.renderNums=0,this._id=0,this.postMessage(a.INITED),this.isAudioDataNaNCnt=0,this.isAudioDataZeroCnt=0,this.printProcess=!1,this.printAudioData=!1,this.overFlowTs=0,this.volume=1,this.simulateTempo=null,this.audioSampleRate=44100,this.playbackRate=1,this.playMode=0,this.isSeek=!1,this.recvNums=0,this.paused=!1}postMessage(t,e){this.port.postMessage({type:t,data:e})}onMessage(t){switch(t.data.type){case a.INIT:this.outputChannelNums=t.data.data.outputChannelCount,this.inited=!0,this._id=t.data.data.id,this.playMode=t.data.data.playMode,this.mainSharedArrayBuffer=t.data.data.mainSharedArrayBuffer,this.playbackRate=t.data.data.playbackRate,this.initSimulateTempo();break;case a.PAUSE:this.paused=!0;break;case a.STOP:this.audioList.length=0;break;case a.PLAY:case a.RESUME:this.paused=!1;break;case a.AUDIO_FRAME:if(this.recvNums++,this.isSeek)return;0==this.playMode?this.audioFrameTransToFloat32Array_new(t.data.data):this.audioFrameTransToFloat32Array_playbackrate(t.data.data);break;case a.VOLUME:this.volume=t.data.data;break;case a.LOG_CFG:this.printProcess=t.data.data.printProcess,this.printAudioData=t.data.data.printAudioData,this.printRenderSkipAudio=t.data.data.printRenderSkipAudio;break;case a.UPDATE_PLAYBACKRATE:this.playbackRate=t.data.data,this.simulateTempo.updateSpeed(this.playbackRate);break;case a.SEEK:this.printProcess&&console.log("AudioWorkletNodeRenderer web seek"),this.isSeek=!0,this.audioList.length=0,this.simulateTempo&&this.simulateTempo.clearInputBuffer();break;case a.ON_VIDEO_SEEK:this.printProcess&&console.log("AudioWorkletNodeRenderer web onVideoSeek"),this.isSeek=!1}}initSimulateTempo(){this.simulateTempo=new u,this.simulateTempo.init(this.audioSampleRate,this.outputChannelNums,this.playbackRate,this.simulateTempoDataCallback.bind(this))}setAudioCurrentDts(t){this.currentTime!=t&&(this.printProcess&&console.log("BypassProcessor.setAudioCurrentDts now",t,"diff",t-this.currentTime),this.currentTime=t,this.currentTime&&(this.renderNums+=1,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,r,this.currentTime),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,h,this.renderNums),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,o,this.recvNums-this.renderNums)),this.postMessage("timestamp",{timeStamp:t,renderNums:this.renderNums}))}handleOuputs(t,e){if(this.audioList.length<1||this.paused)return!0;const s=t[0];this.channelDataLength=s[0].length;let i=this.audioList.shift(),a=i.buffer,r=this.renderNums<5?0:this.volume;i.isEmptyAudioFrame&&(r=0);for(var h=0;h<a.byteLength;h++)for(var o=0;o<s.length;o++)s[o][h]=a[h*s.length+o]*r,this.traceNums++;return this.setAudioCurrentDts(i.timestamp),!0}handleOuputs_playbackrate(t,e){if(this.audioList.length<1||this.paused)return!0;const s=t[0];this.channelDataLength=s[0].length;let i=this.audioList[0],a=i.buffer,r=i.offset,h=this.renderNums<5?0:this.volume;for(var o=0;o<this.channelDataLength;o++)for(var u=0;u<s.length;u++)if(s[u][o]=a[r]*h,r++,r==a.length){if(this.audioList.shift(),this.audioList.length<1)return!0;r=0,i=this.audioList[0],a=i.buffer}return i.offset=r,this.setAudioCurrentDts(i.timestamp),!0}checkDrop(){let t=this.audioList.length;if(t>2){let e=this.audioList[0];if(this.audioList[t-1].timestamp-e.timestamp>80){let s=Date.now();if(0===this.overFlowTs)this.overFlowTs=s;else if(s-this.overFlowTs>4e3&&this.renderNums%10==0){let s=0,i=0,a=0;for(let r=0;r<t;r++){let t=this.audioList[r];if(0===s&&e.timestamp<t.timestamp)i=r,s=t.timestamp;else if(s>0&&t.timestamp>s){a=r;break}}let r=this.audioList.splice(i,a-i);if(this.printRenderSkipAudio){let t=[];r.forEach(e=>{t.push(e.timestamp)}),console.log(`BypassProcessor.checkDrop pts=${s} dropIndex=[${i},${a}] ${t.toString()}`)}}}else this.overFlowTs=0}}audioFrameTransToFloat32Array_new(t){if(!this.inited)return;t.frameBuffer;let e=!0,s=[];for(let e=0;e<t.frameBuffers.length;e++){let i=new Float32Array(t.frameBuffers[e],0,1024);s.push(i)}let i=[],r=s[0].length;for(var h=0;h<r;h++)for(let r=0;r<s.length;r++){if(Number.isNaN(s[r][h])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[r][h]&&(e=!1),i.push(s[r][h]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}this.printAudioData&&console.log(`BypassProcessor.audioFrameTransToFloat32Array_new timeStamp=${t.timeStamp} audioList.length=${this.audioList.length}`),e&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}simulateTempoDataCallback(t,e){let s=new Float32Array(t.length);s.set(t),this.audioList.push({timestamp:e,buffer:s,offset:0})}audioFrameTransToFloat32Array_playbackrate(t){if(!this.inited)return;t.frameBuffer;let e=!0,s=[];for(let e=0;e<t.frameBuffers.length;e++){let i=new Float32Array(t.frameBuffers[e],0,1024);s.push(i)}let i=[],r=s[0].length;for(var h=0;h<r;h++)for(let t=0;t<s.length;t++){if(Number.isNaN(s[t][h])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}0!=s[t][h]&&(e=!1),i.push(s[t][h])}this.simulateTempo.tempo_processData(i,i.length/this.outputChannelNums,t.timeStamp),this.printAudioData&&console.log(`BypassProcessor.audioFrameTransToFloat32Array_new timeStamp=${t.timeStamp} audioList.length=${this.audioList.length}`),e&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}audioFrameTransToFloat32Array(t){if(!this.inited)return;let e=t.frameBuffer,s=new Float32Array(e),i=[],r=!0;for(let e=0;e<s.length;e++){if(Number.isNaN(s[e])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[e]&&(r=!1),i.push(s[e]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}r&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}process(t,e){return 0==this.playMode?this.handleOuputs(e):this.handleOuputs_playbackrate(e)}}registerProcessor("bypass-processor",m)}]);')},function(t,e,i){t.exports=i(30)},function(t,e,i){"use strict";var s=window.URL||window.webkitURL;t.exports=function(t){try{var e;try{(e=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),e=e.getBlob("application/javascript; charset=utf-8")}catch(i){e=new Blob([t],{type:"application/javascript; charset=utf-8"})}return s.createObjectURL(e)}catch(e){return"data:application/javascript,"+encodeURIComponent(t)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return r}));var s=i(17);function r(t){const e=i(31).default,r=i(7).default,{ToMainMessageType:a,ReceiveMessageType:o}=i(12);r.postMessage(a.WOREKR_READY);const n=new e;function h(){r.postMessage(a.VIDEORENDERERROR)}requestAnimationFrame((function t(){n.rafHandler(r.getNow()),requestAnimationFrame(t)})),t.addEventListener("message",(function(e){let i=e.data,a=i.data;switch(i.type){case o.START:n.startVideoRender(a,h),t.mainSharedArrayBuffer=a.mainSharedArrayBuffer;break;case o.POSTFRAME:break;case o.RESIZE:n.updateRect(a.sizes.width,a.sizes.height);break;case o.CLOSE:t.audioSamples=[],t.isBrowserHidden=!1,t.userPaused=!1,n.destroy();break;case o.VISIBILITYCHANGE:t.isBrowserHidden="hidden"==a.state,n.setBrowserHidden(t.isBrowserHidden);break;case o.FAST_OVER:n.fastOver();break;case o.VIDEOSAMPLES:n.appendVideoFrame(a.videoSamples);break;case o.AUDIOSAMPLES:n.appendAudioFrame(a.audioSamples);break;case o.AVCCONFIG:n.updateAVCConfig(a);break;case o.AVCPPS:case o.AVCSPS:case o.AVCVPS:break;case o.AACCONFIG:n.updateAudioConfig(a.codec,a.sampleRate,a.numberOfChannels,a.timestamp);break;case o.UPDATE_VIDEOFPS:n.updateVideoFPS(a.fps,a.noReferFps);break;case o.SET_PLAY_MINBUFFER:n.setPlayMinBuffer(a.bufferLen);break;case o.SET_JITTER:n.setJitter(a);break;case o.SET_USE_SOFTACCELERATION:n.setUseSoftAcceleration();break;case o.UPDATE_SOFTACCELERATION:n.updateSoftAcceleration();break;case o.LOCAL_CONFIG:r.log("ReceiveMessageType.LOCAL_CONFIG",a),n.setLocalConfig(a);break;case o.PAUSE_VIDEO_DECODE:r.log("ReceiveMessageType.PAUSE_VIDEO_DECODE",a),n.setPauseVideoDecode(a);break;case o.PAUSE_AUDIO_DECODE:r.log("ReceiveMessageType.PAUSE_AUDIO_DECODE",a),n.setPauseAudioDecode(a);break;case o.ENABLE_DISCARD_VIDEO:r.log("ReceiveMessageType.ENABLE_DISCARD_VIDEO",a.enableDiscard),n.setEnableDiscard(a);break;case o.SET_AUDIO_WRITER:r.log("ReceiveMessageType.SET_AUDIO_WRITER"),n.startAudioRender(a.ageneratorWriter);break;case o.UPDATE_CURBITRATE:r.log("ReceiveMessageType.UPDATE_CURBITRATE",a.curBitrate),n.updateCurBitrate(a.curBitrate);break;case o.INIT_CONFIG:r.log("ReceiveMessageType.INIT_CONFIG",JSON.stringify(a));let e=JSON.parse(a.config);n.initWebcodecCfg(e);break;case o.RECV_FPS:n.setRealFps(a.recvFps);break;case o.LOG_CFG:r.log("ReceiveMessageType.LOG_CFG ".concat(JSON.stringify(a))),s.a.setCfg(a);break;case o.SET_ENHANCE:r.log("ReceiveMessageType.LOG_CFG ".concat(JSON.stringify(a))),n.setEnhance(a);break;case o.SET_SEGMENTTION:r.log("ReceiveMessageType.LOG_CFG setSegmenttion ".concat(JSON.stringify(a))),n.setSegmenttion(a);break;case o.RECV_FAST_OVER:r.log("ReceiveMessageType.LOG_CFG onRevFastOver"),n.onRevFastOver();break;case o.AV1_INIT_SEG:n.initAv1Seg(a);break;case o.SEEK_TIME:n.seek(a);break;case o.SET_PLAYBACKRATE:n.setPlaybackRate(a);break;case o.SET_VOD_AV1:n.setVodAv1()}}))}},function(t,i,s){"use strict";s.r(i);var r=s(19).default,a=class{constructor(){this.filterDom=null,this.containerId=null}destroy(){this.filterDom&&(this.filterDom.remove(),this.filterDom=null)}setBackDropFilter(t,e,i){if(i&&(this.containerId=i),t){this.filterDom||(this.filterDom=document.createElement("div"),this.filterDom.style.position="absolute",this.filterDom.style.width="100%",this.filterDom.style.height="100%",this.filterDom.style.top=0,this.filterDom.style.left=0);const t=30;let i=Math.floor(t*e/100);document.getElementById(this.containerId).appendChild(this.filterDom),this.filterDom.style.backdropFilter="blur(".concat(i,"px)"),this.filterDom.style.WebkitBackdropFilter="blur(".concat(i,"px)")}else this.filterDom&&this.containerId&&document.getElementById(this.containerId).removeChild(this.filterDom),this.filterDom=null}},o=s(2),n=s(0),h=s(8),d=s(1);class l{constructor(){this._type=0,this.backdropFilter=new a,this.decoderDecodeP2pErrCnt=0,this.decoderDecodeFlvErrCnt=0}destroy(){this.backdropFilter&&this.backdropFilter.destroy(),this.backdropFilter=null}setMuted(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.player&&this.player.setMuted&&this.player.setMuted(t)}setBackDropFilter(t,e,i){this.backdropFilter.setBackDropFilter(t,e,i)}decoderDecodeError(){0!=o.a.pcdn302FlvBakCfg[1]&&(this.type==l.P2P?(this.decoderDecodeP2pErrCnt++,n.a.log("BasePlayer.decoderDecodeError, type=".concat(this.type,", cnt=").concat(this.decoderDecodeP2pErrCnt))):this.type==l.FLV&&(this.decoderDecodeFlvErrCnt++,n.a.log("BasePlayer.decoderDecodeError, type=".concat(this.type,", cnt=").concat(this.decoderDecodeFlvErrCnt))))}reportLoadP2PLib(t){let e=[this.stat.createAct(d.a.ACT.LOAD_P2PLIB_ERROR,{value:[t?100:0],str:[h.a.platform]})];this.sendMetrics(e)}get type(){return this._type}}var c=l;let u={SOURCE_READY:"SOURCE_READY",PLAY_STATUS:"PLAY_STATUS",PLAY_CARTON:"PLAY_CARTON",PLAY_TIME_STATUS:"PLAY_TIME_STATUS",VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PLAY_CON_SUC:"VIDEO_PLAY_CON_SUC",VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_BAD_QUALITY:"VIDEO_BAD_QUALITY",METADATA:"METADATA",RECV_VIDEO_FRAME:"RECV_VIDEO_FRAME",VOLUME_CHANGE:"VOLUME_CHANGE",VIDEO_STOP:"VIDEO_STOP",VIDEO_SEEK:"VIDEO_SEEK",BROWSER_PAUSE:"BROWSER_PAUSE",BROWSER_AUTOPLAY_FAIL_IN:"BROWSER_AUTOPLAY_FAIL_IN",BROWSER_AUTOPLAY_FAIL:"BROWSER_AUTOPLAY_FAIL",AUDIO_PLAY:"AUDIO_PLAY",AUDIO_SOUND:"AUDIO_SOUND",ANCHOR_STOP:"ANCHOR_STOP",VIDEO_LINK_CLOSE:"VIDEO_LINK_CLOSE",NO_VIDEO:"NO_VIDEO",HLS_URL_UNAVAILABLE:"HLS_URL_UNAVAILABLE",HLS_URL_LOAD_TIMEOUT:"HLS_URL_LOAD_TIMEOUT",HLS_MAINFEST_LOAD_TIMEOUT:"HLS_MAINFEST_LOAD_TIMEOUT",FLV_URL_UNAVAILABLE:"FLV_URL_UNAVAILABLE",FLV_URL_UNAVAILABLE_IN:"FLV_URL_UNAVAILABLE_IN",FLV_CHANGE_LINE:"FLV_CHANGE_LINE",FLV_URL_LOAD_TIMEOUT:"FLV_URL_LOAD_TIMEOUT",H5_PLAYER_ERROR:"H5_PLAYER_ERROR",H5_PLAYER_ERROR_IN:"H5_PLAYER_ERROR_IN",H5_PLAY_FAIL:"H5_PLAY_FAIL",H5_NO_STREAM:"H5_NO_STREAM",PAUSE_5S_RETRY:"PAUSE_5S_RETRY",NO_DATA_RECEIVED:"NO_DATA_RECEIVED",NO_DATA_RECEIVED_IN:"NO_DATA_RECEIVED_IN",P2P_REPORT:"P2P_REPORT",AUTO_LOG:"AUTO_LOG",DATA_METRIC:"DATA_METRIC",DATA_METRIC2:"DATA_METRIC2",P2P_TIMEOUT:"P2P_TIMEOUT",FLV_TO_P2P:"FLV_TO_P2P",FLV_TRY_TO_P2P:"FLV_TRY_TO_P2P",FLAC_AUDIO_START:"FLAC_AUDIO_START",FLAC_AUDIO_ERROR:"FLAC_AUDIO_ERROR",FLAC_AUDIO_NEED_RETRY:"FLAC_AUDIO_NEED_RETRY",SIGNAL_PLAY:"SIGNAL_PLAY",SIGNAL_HEART:"SIGNAL_HEART",SIGNAL_DATA:"SIGNAL_DATA",SIGNAL_ERROR:"SIGNAL_ERROR",H264_SEI_PLAY:"H264_SEI_PLAY",TRANS_END:"TRANS_END",NEED_UPDATE_M3U8:"NEED_UPDATE_M3U8",PLAYBACK_UPDATE:"PLAYBACK_UPDATE",PLAYBACK_M3U8_UPDATED:"PLAYBACK_M3U8_UPDATED",PLAYBACK_DIF_CDN:"PLAYBACK_DIF_CDN",UPDATE_INTERSITY:"UPDATE_INTERSITY",PLAY_DOWNLINK_INFO:"PLAY_DOWNLINK_INFO",PLAY_FRAME_BUFFER:"PLAY_FRAME_BUFFER",WEBRTC_VIDEO_ERROR:"WEBRTC_VIDEO_ERROR",SWITCH_DONE:"SWITCH_DONE",AUTO_BITRATE_CHANGED:"AUTO_BITRATE_CHANGED",AUTO_FORCE_RSP:"AUTO_FORCE_RSP",VISIBILITY_CHANGE:"VISIBILITY_CHANGE",REPLAY_VIDEO:"REPLAY_VIDEO",P2P_PLAYING_EVENT:"P2P_PLAYING_EVENT",TURN_TO_H264:"TURN_TO_H264",H265_VIDEO_RETRY:"H265_VIDEO_RETRY",H265_PLAY:"H265_PLAY",PAUSE_5SEC_ERROR:"PAUSE_5SEC_ERROR",TRY_TO_AV1:"TRY_TO_AV1",M3U8_PLAY_ENDED:"M3U8_PLAY_ENDED",SEI_INFO:"SEI_INFO",SEI_DATACHANNEL_INFO:"SEI_DATACHANNEL_INFO",VIDEO_RESOLUTION_CHANGE:"VIDEO_RESOLUTION_CHANGE",TURN_TO_MSE:"TURN_TO_MSE",TURN_TO_WEBCODECS_SOFT:"TURN_TO_WEBCODECS_SOFT",WEBCODECS_RETRY:"WEBCODECS_RETRY",TURN_TO_H265_WASM:"TURN_TO_H265_WASM",SHIELD_AUDIO_SWITCH_STATUS:"SHIELD_AUDIO_SWITCH_STATUS",RESET_PLAYER:"RESET_PLAYER",PLAY_TIMEOUT:"PLAY_TIMEOUT",SEEK_TIMEOUT:"SEEK_TIMEOUT",ON_VIDEO_ENHANCE_ERROR:"ON_VIDEO_ENHANCE_ERROR",ON_VIDEO_ENHANCE_SUCCESS:"ON_VIDEO_ENHANCE_SUCCESS",ON_VIDEO_ENHANCE_UNSUPPORT:"ON_VIDEO_ENHANCE_UNSUPPORT",VIDEO_AVCCFG_CHANGE:"VIDEO_AVCCFG_CHANGE",VIDEO_ENDED:"VIDEO_ENDED",VIDEO_LOOP_ENDED:"VIDEO_LOOP_ENDED",VIDEO_MP4_ERROR:"VIDEO_MP4_ERROR",VIDEO_TAG_ENDED:"VIDEO_TAG_ENDED",VIDEO_TAG_SEEKED:"VIDEO_TAG_SEEKED",VIDEO_TAG_PLAYING:"VIDEO_TAG_PLAYING",VIDEO_TAG_PROGRESS:"VIDEO_TAG_PROGRESS",VIDEO_TAG_CANPLAY:"VIDEO_TAG_CANPLAY",VIDEO_TAG_PAUSE:"VIDEO_TAG_PAUSE",VIDEO_TAG_LOADSTART:"VIDEO_TAG_LOADSTART",VIDEO_TAG_PLAY:"VIDEO_TAG_PLAY",VIDEO_NATIVE_PLAY:"VIDEO_NATIVE_PLAY"},p={VIDEO_INIT:"VIDEO_INIT",VIDEO_LOADING:"VIDEO_LOADING",VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_PAUSED:"VIDEO_PAUSED",VIDEO_STOP:"VIDEO_STOP",VIDEO_CACHING:"VIDEO_CACHING",BROWSER_PAUSE:"BROWSER_PAUSE",BROWSER_AUTOPLAY_FAIL:"BROWSER_AUTOPLAY_FAIL",SYS_PAUSE:"SYS_PAUSE",AUDIO_START:"AUDIO_START",AUDIO_STOP:"AUDIO_STOP",AUDIO_PLAYING:"AUDIO_PLAYING"};var m=u,_=s(4),f=s(3),g={AUTO_VIEW_REPORT:"_autoViewReport",LOAD_VIDEO_TS_V2_FAIL:"_load_video_ts_v2_fail",VIDEO_BAD_QUALITY:"_video_bad_quality",RETRY_STREAM:"_retry_stream",LOCAL_RETRY:"_localRetry",LOAD_VOD_FAIL:"_load_vod_fail",VIDEO_BAD_QUALITY_VOD:"_video_bad_quality_vod",RETRY_STREAM_VOD:"_retry_stream_vod",AUTO_VIEW_LOG:"_autoViewLog",getLocalRetry:function(t){1==f.a[this.LOCAL_RETRY]&&t.push(1)}};const S=3,y=4;var T=new class{constructor(){this._hlsPlayer=null,this._m3u8Status=0,this._m3u8Loader=null,this._firstTs=null,this._firstFragStatus=0,this._mp4Status=0}destroy(t){this._hlsPlayer===t&&(this._hlsPlayer=null)}reset(){this._hlsPlayer=null,this._m3u8Status=0,this._m3u8Loader=null,this._firstTs=null,this._firstFragStatus=0,this._mp4Status=0}setHlsPlayer(t){this._hlsPlayer=t}setM3u8Loader(t){this._m3u8Loader=t}setM3u8Status(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;n.a.log("VodNoPictureHelper.setM3u8Status status: ",t),this._m3u8Status=t}getM3u8Status(){if(0!==this._m3u8Status||!this._m3u8Loader)return this._m3u8Status;const t=this._m3u8Loader.getLoaderHandler();return t?(t.status>=200&&t.status<300&&4===t.readyState?this._m3u8Status=1:t.status>=200&&t.status<300&&t.readyState<4?this._m3u8Status=-4:t.status>=300?this._m3u8Status=-1:0===t.status&&4===t.readyState?this._m3u8Status=-2:this._m3u8Status=-3,this._m3u8Status):this._m3u8Status}getM3u8Reason(){let t=0;switch(this.getM3u8Status()){case-1:t=101;break;case-2:t=102;break;case-4:t=104;break;case-3:t=103}return t}setFirstTs(t){this._firstTs=t}setFirstFragStatus(t){n.a.log("VodNoPictureHelper.setFirstFragStatus status: ",t),this._firstFragStatus=t}getFirstFragStatus(){return this._firstFragStatus}getTsReason(){let t=0;switch(this._firstFragStatus){case 1:t=106;break;case-1:t=105;break;case-2:t=106;break;case 2:t=107;break;case-3:t=108;break;case S:case y:this._hlsPlayer&&(t=this._hlsPlayer.getBufferLen()<=200?109:110);break;case-4:t=111}return t}getHlsNoPictureReason(){let t=0;return this._firstTs?t=this.getTsReason():(t=this.getM3u8Reason(),0===t&&(t=this.getTsReason())),0===t&&(t=112),n.a.log("VodNoPictureHelper.getHlsNoPictureReason reason: ",t),t}setMP4Status(t){this._mp4Status=t}getMP4NoPictureReason(){let t=0;switch(this._mp4Status){case 1:t=113;break;case-1:t=114}return 0===t&&(t=115),n.a.log("VodNoPictureHelper.getMP4NoPictureReason reason: ",t),t}},P=new class{constructor(){this._tsdb=null,this._sessionId=0,this._line=0,this._sDisplayName="",this._bitrate=0,this._fails=this.readLocal(g.LOAD_VIDEO_TS_V2_FAIL),this._qualitys=this.readLocal(g.VIDEO_BAD_QUALITY),this._retrys=this.readLocal(g.RETRY_STREAM),this._vodFails=this.readLocal(g.LOAD_VOD_FAIL),this._vodQualitys=this.readLocal(g.VIDEO_BAD_QUALITY_VOD),this._vodRetrys=this.readLocal(g.RETRY_STREAM_VOD)}readLocal(t){return f.a.hasOwnProperty(t)?JSON.parse(f.a.getItem(t)):{}}addBadQuality(t){this.isOpen()&&(this._addHis(t,this._qualitys),f.a.setItem(g.VIDEO_BAD_QUALITY,JSON.stringify(this._qualitys)))}addRetryStream(t){this.isOpen()&&(this._addHis(t,this._retrys),f.a.setItem(g.RETRY_STREAM,JSON.stringify(this._retrys)))}_addHis(t,e){let i=this._getKey(t);this._addHisByKey(i,e)}_addHisByKey(t,e){e.hasOwnProperty(t)?e[t]++:e[t]=1}delFail(t){if(this.isOpen()){let e=this._getKey(t);delete this._fails[e],f.a.setItem(g.LOAD_VIDEO_TS_V2_FAIL,JSON.stringify(this._fails)),delete this._retrys[e],f.a.setItem(g.RETRY_STREAM,JSON.stringify(this._retrys)),n.a.log("AutoTestHelper.delFail: ".concat(e))}}addFail(t,e){let{loadTime:i,connectTime:s,recvDataTime:r}=e;if(!this.isOpen())return;let a=t.getComDim(d.a.DIM_COM.P2P),o=t.getComDim(d.a.DIM_COM.CDN_CIP),h=t.getComDim(d.a.DIM_COM.CDN_SIP),l=this._getKey(t);n.a.log("AutoTestHelper.addFail: ".concat(l,", loadTime=").concat(i," connectTime=").concat(s," recvDataTime=").concat(r," cdn_cip=").concat(o," cdn_sip=").concat(h));let c="";0===s?c=a===d.a.LIVE_TYPE.HLS?"m3u8下载失败":"拉流连接不上":(c=0===r?a===d.a.LIVE_TYPE.HLS?"ts下载失败":"拉流连接成功没收到数据":a===d.a.LIVE_TYPE.HLS?"m3u8下载耗时=".concat(s,"ms、ts下载耗时=").concat(r):"拉流连接耗时=".concat(s,"ms、收数据耗时=").concat(r,"ms"),h&&(c+=",".concat(h))),this._fails.hasOwnProperty(l)?this._fails[l].push(c):this._fails[l]=[c],f.a.setItem(g.LOAD_VIDEO_TS_V2_FAIL,JSON.stringify(this._fails))}_getKey(t){const e=t.getComDim(d.a.DIM_COM.P2P),i=t.getComDim(d.a.DIM_COM.H265);return"".concat(this._line,"_").concat(this._sDisplayName,"_").concat(this._bitrate,"_").concat(e,"_").concat(i)}addVodFail(t){if(!this.isOpen())return;let e=-1!==t.indexOf(".mp4")?T.getMP4NoPictureReason():T.getHlsNoPictureReason(),i=this._getVodKey(t);n.a.log("AutoTestHelper.addVodFail: ".concat(i,", ").concat(e));let s=this._vodFails[i];s||(s=[],this._vodFails[i]=s),s.push(e),f.a.setItem(g.LOAD_VOD_FAIL,JSON.stringify(this._vodFails))}delVodFail(t){if(!this.isOpen())return;let e=this._getVodKey(t);n.a.log("AutoTestHelper.delVodFail: ".concat(e)),delete this._vodFails[e],f.a.removeItem(g.LOAD_VOD_FAIL)}addBadQualityVod(t){if(!this.isOpen())return;let e=this._getVodKey(t);n.a.log("AutoTestHelper.addBadQualityVod: ".concat(e)),this._addHisByKey(e,this._vodQualitys),f.a.setItem(g.VIDEO_BAD_QUALITY_VOD,JSON.stringify(this._vodQualitys))}addRetryStreamVod(t){if(!this.isOpen())return;let e=this._getVodKey(t);n.a.log("AutoTestHelper.addRetryStreamVod: ".concat(e)),this._addHisByKey(e,this._vodRetrys),f.a.setItem(g.RETRY_STREAM_VOD,JSON.stringify(this._vodRetrys))}_getVodKey(t){return t.split("//")[1].split("?")[0]}isOpen(){return"1"===f.a.getItem(g.AUTO_VIEW_REPORT)}bindEvent(t,e,i,s,r){this._sessionId=e,this._line=i,this._sDisplayName=s,this._bitrate=r,this.isOpen()&&(this._tsdb=t,window._autoTestComplete=t=>{this._tsdb.sendAutoTestResult(t)},window._autoTestAct=(t,e,i)=>{this._tsdb.sendAutoTestAct(t,e,i)})}},v=s(10);let E=!1,C=!1;class I{constructor(t){let{eventEmiter:e,stat:i,statVod:s}=t;this.eventEmiter=e,this.stat=i,this.statVod=s,this.isSendLoadTime=!1,this.isSendHlsLoadTime=!1,this.isSendH265=!1,this.hasP2P=0,this.restartReason=-1,this.restartTimes=0,this.turnToFlvReason=-1,this.turnToFlvTimes=0,this.httpError=!1,this.busiSource="",this.isSendM3u8LoadTime=!1,this.isSendVodLoadTime=!1,this.isSendVodM3u8LoadTime=!1,this.isClosedSendVodLoadTime=!1}destroy(){this.eventEmiter=null,this.stat=null,this.statVod=null}closeSendVodLoadTime(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isClosedSendVodLoadTime=t}sendCdnTime(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7?arguments[7]:void 0;if(e){let e=Math.max(0,t.connectVideoTime-t.startTime),c=t.firstVideoPkgTime-t.connectVideoTime,u=t.firstIFrameTime1-t.connectVideoTime,p=t.firstIFrameTime2-t.firstIFrameTime1,m=t.firstRenderTime-t.firstIFrameTime2,_=t.onPlayTime-t.firstRenderTime,f=t.recvDataTime-t.startTime,S=(t.onPlayTime,t.startTime,t.firstP2POnDataTime-t.startTime);S=S<0?0:S;let y=0;t.firstP2PIframeTime>0&&(y=t.firstP2PIframeTime-t.startTime,y=y<0?0:y);let T=0;r&&(T+=1),s&&(T+=2),this.stat.setComDim(d.a.DIM_COM.ACT_LOAD_TYPE,T);let P=[t.hyPlayerLoadTs,f,e,s,r,i,a,h,0,S,y];g.getLocalRetry(P);let v=[this.stat.createAct(d.a.ACT.CONNECT_VIDEO_TS,{value:[e]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_PKG_TS,{value:[c]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[u]}),this.stat.createAct(d.a.ACT.VIDEO_IFRAME_TS,{value:[p]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[m]}),this.stat.createAct(d.a.ACT.VIDEO_PLAYED_TS,{value:[_]}),this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:P,str:[l]})];if(n.a.log("TsdbUtils.sendCdnTime, loadTime=".concat(t.hyPlayerLoadTs,", connectTime=").concat(e,", recvDataTime=").concat(f)),this.sendMetrics([this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS_V2,{value:P,str:[l,this.isSendLoadTime?0:1]})]),t.hyPlayerLoadTs>=o.a.autoReportTime&&this.autoReport(),this.isSendLoadTime)return;this.isSendLoadTime=!0,this.sendMetrics(v)}else{let e=t.getVPTime-t.startTime,i=Math.max(0,t.connectVideoTime-t.getVPTime),s=t.loginTime-t.connectVideoTime,r=t.firstVideoPkgTime-t.loginTime,a=t.firstIFrameTime-t.firstVideoPkgTime,o=t.firstRenderTime-t.firstIFrameTime,n=t.onPlayTime-t.firstRenderTime,h=t.onPlayTime-t.startTime,l=[this.stat.createAct(d.a.ACT.VIDEO_GET_VP_TS,{value:[e]}),this.stat.createAct(d.a.ACT.CONNECT_VIDEO_TS,{value:[i]}),this.stat.createAct(d.a.ACT.VIDEO_LOGIN_TS,{value:[s]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_PKG_TS,{value:[r]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[a]}),this.stat.createAct(d.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[o]}),this.stat.createAct(d.a.ACT.VIDEO_PLAYED_TS,{value:[n]}),this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:[h]})];this.sendMetrics(l)}}sendFlvTime(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,_=arguments.length>12?arguments[12]:void 0,f=0;h&&(f+=1),a&&(f+=2),this.stat.setComDim(d.a.DIM_COM.ACT_LOAD_TYPE,f);let S=[t,i,e,a,h,l,p,m,0,c,u];g.getLocalRetry(S);let y=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:S,str:[_]}),this.stat.createAct(d.a.ACT.CONNECT_VIDEO_TS,{value:[e]}),this.stat.createAct(d.a.ACT.RECV_VIDEO_TS,{value:[i,s]})];t>1e4||e>1e4||(n.a.log("TsdbUtils.sendCdnTime, loadTime=".concat(t,", connectTime=").concat(e,", recvDataTime=").concat(i)),this.sendMetrics([this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS_V2,{value:S,str:[_,this.isSendLoadTime?0:1]})]),t>=o.a.autoReportTime&&this.autoReport(),this.isSendLoadTime&&!r||(this.isSendLoadTime=!0,this.sendMetrics(y)))}sendWebRtcTime(t,e,i,s,r){this.isSendLoadTime=!0,this.stat.setActDim("p2p","3");let a=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:[t,0,0,0,0,e,i,s,r]})];this.sendMetrics(a)}sendHlsTime(t,e,i,s,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9?arguments[9]:void 0,c=0;n&&(c+=1),o&&(c+=2),this.stat.setComDim(d.a.DIM_COM.ACT_LOAD_TYPE,c);let u=[e,t,0,o,n,r,h,0,0,0,0];if(g.getLocalRetry(u),this.sendMetrics([this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS_V2,{value:u,str:[this.busiSource]})]),this.isSendHlsLoadTime)return;if(this.isSendHlsLoadTime=!0,e>1e4||i>1e4||r>1e4)return;let p=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:u,str:[this.busiSource]}),this.stat.createAct(d.a.ACT.VIDEO_LOAD_SEG,{value:l}),this.stat.createAct(d.a.ACT.FIRST_FRAG_LOAD_TS,{value:[s,t]}),this.stat.createAct(d.a.ACT.FIRST_FRAG_LOADED_TS,{value:[r,t,h]}),this.stat.createAct(d.a.ACT.FIRST_FRAG_SIZE,{value:[a,t]})];i>0&&!this.isSendM3u8LoadTime&&(p.push(this.stat.createAct(d.a.ACT.LOAD_M3U8_TS,{value:[i,t]})),this.isSendM3u8LoadTime=!0),this.sendMetrics(p)}sendM3u8LoadedTime(t,e){if(this.isSendM3u8LoadTime)return;if(e>1e4)return;this.isSendM3u8LoadTime=!0;let i=[this.stat.createAct(d.a.ACT.LOAD_M3U8_TS,{value:[e,t]})];this.sendMetrics(i)}sendVodHlsTime(t){let{loadType:e,loadTime:i,loadM3u8Time:s,firstFragLoadTs:r,firstFragLoadedTs:a,firstFragSize:o,businessCost:n=0,UICost:h=0,firstFragParsedTs:l=0,playTs:c,startTs:u,m3u8Status:p,firstTsStatus:m,costTimes:_}=t;if(this.isClosedSendVodLoadTime)return;if(this.isSendVodLoadTime)return;if(this.isSendVodLoadTime=!0,i>1e4&&99999!=i)return;const f=[i,e,p,m,s,a,l,n,h,u,c];let g=[this.statVod.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:f,str:["",E?0:1]}),this.statVod.createAct(d.a.ACT.VIDEO_LOAD_SEG,{value:_})];i<1e4&&(g=g.concat([this.statVod.createAct(d.a.ACT.FIRST_FRAG_LOAD_TS,{value:[r,e]}),this.statVod.createAct(d.a.ACT.FIRST_FRAG_LOADED_TS,{value:[a,e,l]}),this.statVod.createAct(d.a.ACT.FIRST_FRAG_SIZE,{value:[o,e]})])),s>0&&!this.isSendVodM3u8LoadTime&&(g.push(this.statVod.createAct(d.a.ACT.LOAD_M3U8_TS,{value:[s,e]})),this.isSendVodM3u8LoadTime=!0),this.sendMetrics(g),E=!0}sendVodM3u8LoadedTime(t,e){if(this.isSendVodM3u8LoadTime)return;if(e>1e4)return;this.isSendVodM3u8LoadTime=!0;let i=[this.statVod.createAct(d.a.ACT.LOAD_M3U8_TS,{value:[e,t]})];this.sendMetrics(i)}sendNoPictureTime(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const a=_.a.now();let o=[t,i=i>0?i:0,e=e>0?e:0];const h=a-this.stat.create_time;n.a.log("TsdbUtils.sendNoPictureTime, loadTime=".concat(t,", connectTime=").concat(e,", recvDataTime=").concat(i,", type=").concat(s,", now=").concat(a,", create_time=").concat(this.stat.create_time,", timeDelta=").concat(h));let l=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:o,str:[r,s]})];this.sendMetrics(l)}sendNoPictureTimeAll(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;const o=_.a.now();let h=[t,i=i>0?i:99999,e=e>0?e:99999,0,0,0,0,0,0,0,0];g.getLocalRetry(h);const l=o-this.stat.create_time;n.a.log("TsdbUtils.sendNoPictureTimeAll, loadTime=".concat(t,", connectTime=").concat(e,", recvDataTime=").concat(i,", type=").concat(s,", now=").concat(o,", create_time=").concat(this.stat.create_time,", timeDelta=").concat(l)),this.stat.setActDim(d.a.DIM_LINK_STA.name,a);let c=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS_V2,{value:h,str:[r,s,a]})];f.a[g.AUTO_VIEW_LOG]=1,P.addFail(this.stat,{loadTime:t,connectTime:e,recvDataTime:i}),this.autoReport(),this.sendMetrics(c)}autoReport(){(1===Number(f.a.getItem(g.AUTO_VIEW_REPORT))||o.a.isAutoReport(v.a.uid))&&this.eventEmiter.trigger(m.P2P_REPORT)}sendAutoTestResult(t){n.a.log("TsdbUtils.sendAutoTestResult, result=".concat(t));let e=[this.stat.createAct(d.a.ACT.AUTO_TEST_RESULT,{str:[t]})];this.sendMetrics(e)}sendAutoTestAct(t,e,i){n.a.log("TsdbUtils.sendAutoTestAct, actType=".concat(t,", values=").concat(e,", strs=").concat(i));let s=[this.stat.createAct(t,{value:e,str:i})];this.sendMetrics(s)}setBusiSource(t){this.busiSource=t}sendMP4Time(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).loadTime;if(t>1e4)return;const e=[this.stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:[t],str:[this.busiSource]})];this.sendMetrics(e)}sendVodMP4Time(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=t.loadTime,i=t.errorLoadTime,s=t.errorMessage,r=[this.statVod.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:[e,0,0,i],str:[this.busiSource,C?0:1,s||""]})];this.sendMetrics(r),C=!0}sendMetrics(t){this.stat.checkFilter(t),t.length>0&&this.eventEmiter.trigger(m.DATA_METRIC2,t)}sendOldMetrics(t){this.eventEmiter.trigger(m.DATA_METRIC,t)}}I.METRIC={VIDEO_FLOW_LINE:"video.flow.line",VIDEO_FLOW_P2P:"video.flow.p2p",VIDEO_BAD_QUALITY_RATIO:"video.video_bad_quality_ratio",WEB_HLS_PLAY_VIDEO_RATIO:"web.hls.play_video_ratio",WEB_HLS_PLAY_SUC_RATIO:"web.hls.play_suc_ratio",WEB_P2P_PLAY_RATIO:"web.p2p.play_ratio",WEB_P2P_PUNCH:"web.p2p.punch",WEB_P2P_BW_P2P_VALID:"web.p2p.bw_p2p_valid",WEB_P2P_BW_P2P_REPEAT:"web.p2p.bw_p2p_repeat",WEB_P2P_BW_P2P_TOTAL:"web.p2p.bw_p2p_total",WEB_P2P_BW_CDN_VALID:"web.p2p.bw_cdn_valid",WEB_P2P_BW_CDN_REPEAT:"web.p2p.bw_cdn_repeat",WEB_P2P_BW_CDN_TOTAL:"web.p2p.bw_cdn_total",WEB_P2P_BW_RANGE_VALID:"web.p2p.bw_range_valid",WEB_P2P_BW_RANGE_TOTAL:"web.p2p.bw_range_total",WEB_P2P_PLAY_FAIL:"web.p2p.play_fail",WEB_P2P_LOAD_RATIO:"web.p2p.load_ratio",WEB_P2P_CDN_RESTART:"web.p2p.cdn_restart",WEB_P2P_TCP_NO_SLICE:"web.p2p.tcp_no_slice",WEB_P2P_TCP_OPEN_TIME:"web.p2p.tcp_open_time",WEB_P2P_HTTP_CODE:"web.p2p.http_code_",WEB_P2P_TCP_TIMEOUT:"web.p2p.tcp_timeout",WEB_H265:"web.h265",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_VIDEO_LOGIN_SUC:"sdk.video.login_suc",SDK_P2P_COOLING:"sdk.p2p.cooling",SDK_P2P_SERVER_OPEN:"sdk.p2p.server_open",SDK_P2P_USER_PROPERTY:"sdk.p2p.user_property",VIDEO_VIDEO_BAD_QUALITY_5M_RATIO:"video.video_bad_quality_5m_ratio",VIDEO_VIDEO_LOAD_ERROR:"video_load_error",RECV_DANMU_CARTON:"recv_danmu_carton",SDK_P2P_DETAILS:"sdk.p2p.details",SDK_P2P_FORCE_REASON:"sdk.p2p.force_reason",SDK_P2P_DEFAULT_REASON:"sdk.p2p.default_reason",SDK_P2P_VALID_RET:"sdk.p2p.valid_ret",SDK_P2P_GET_NODE:"sdk.p2p.get_node",WEB_USER:"web.user"},I.INTERVAL={SDK_VIDEO_QUALITY:"sdk.video.quality",SDK_VIDEO_QUALITY_5M:"sdk.video.quality_5m",SDK_CALC_FLOW:"sdk.calc.flow",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_P2P_FLOW:"sdk.p2p.flow",SDK_P2P_PUNCH:"sdk.p2p.punch",SDK_P2P_SUB:"sdk.p2p.sub",SDK_P2P_RESEND:"sdk.p2p.resend",SDK_P2P_DELAY:"sdk.p2p.resend",SDK_P2P_OTHER:"sdk.p2p.other"},I.TRIGGER={SDK_HLS_PLAY:"sdk.hls.play",SDK_HLS_LOAD:"sdk.hls.load",SDK_MSE_ERROR:"sdk.mse.error",SDK_P2P_LOAD:"sdk.p2p.load",SDK_P2P_LOAD_SAMPLE:"sdk.p2p.load_sample",SDK_P2P_RESTART:"sdk.p2p.restart",SDK_WEB_H265:"sdk.web.h265"};var A=I,D=s(13),R=s(6),O=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}reset(){this.sum=0,this.list=[],this.idx=0,this.cur=0}addCur(t){this.cur+=t}calculate(){this.add(this.cur);let t=this.cur;return this.cur=0,t}add(t){this.sum+=t,this.list.length<this.maxSize?this.list.push(t):(this.sum-=this.list[this.idx],this.list[this.idx]=t),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}average(){return 0===this.list.length?R.b.UintMax:Math.round(this.sum/this.list.length)}getSamples(){return this.list}max(){if(0===this.list.length)return R.b.UintMax;let t=0;for(let e of this.list)e>t&&(t=e);return t}min(){let t=R.b.UintMax;for(let e of this.list)e<t&&(t=e);return t}},L=class{constructor(){this.speed=new O(20),this.rtt=new O(20),this.p2p=0}destroy(){this.speed&&this.speed.reset(),this.speed=null,this.rtt&&this.rtt.reset(),this.rtt=null}addSpeed(t){let e=parseInt(t.replace("KB",""));this.speed.add(e)}addRtt(t){this.rtt.add(t)}setP2p(t){this.p2p=t}getP2p(){return this.p2p}getResult(){return{speed:this.speed.getSamples(),rtt:this.rtt.getSamples(),p2p:this.p2p}}};const M=1,w={FLV:1,P2P:2,HLS:3,HUYA:4,STREAM:5,OBS:6,VR:7,HUYAWEBRTC:8,PLAYBACK:9,P2PFLV:10,MP4:11},F="h264",b="h265",V="av1";var N=s(5),B=s(22),k=s.n(B),U=!1,x=[],H=-1,W=null,G=!1,Y=!1;function q(t,e){for(var i=0,s=x.length;i<s;i++){var r=x[i];if(r.callback==t&&r.thisObj==e)return r}return null}function K(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!t)return n.a.error("Timer.add Invalide interval value or callback function."),!1;var a=q(t,e);return a||(a={callback:t,thisObj:e,bindCallback:e?t.bind(e):t,param:s},x.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,z(),!0}function j(t){t&&(t.callback=null,t.thisObj=null,t.bindCallback=null,t.param=null)}function z(){W&&1==Number(o.a.isForceUseWorker)?(G=!0,Y=!1,W.postMessage("start")):(G=!1,Y=!0,-1===H&&(H=setInterval(J,10)))}function J(){!G&&Y&&Q()}function Q(){if(0==x.length)return G=!1,Y=!1,void(W?W.postMessage("stop"):(clearInterval(H),H=-1));U=!0;for(var t=_.a.now(),e=x.length-1;e>=0;e--){var i=x[e];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(t,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&x.splice(e,1)}}else j(i),x.splice(e,1)}U=!1}var X={initWorker:function(){!W&&window.Worker&&(n.a.log("[ TimerWorker init ]"),(W=k()(25)).addEventListener("message",t=>{1==t.data.type&&G&&Q()}),W.addEventListener("error",t=>{n.a.error("TimerWorker.error:",t.lineno+","+t.colno,t.message),W.terminate(),W=null,n.a.warn("[ TimerWorker terminate ]"),z()}))},has:function(t,e){return!!q(t,e)},add:K,remove:function(t,e){for(var i=0,s=x.length;i<s;i++){var r=x[i];if(r.callback==t&&r.thisObj==e)return U?r.delayDel=!0:(j(r),x.splice(i,1)),!0}return!1},once:function(t,e,i,s){K(t,e,i+10,s,1)},getSize:()=>x.length},$={isMacChrome72:function(){return"mac"===h.a.platform&&"chrome"===h.a.name&&72===Number(h.a.version.major)},isNeedAud:function(){return h.a.chrome&&h.a.version.major>=73},isNotImgplus:function(){if(1==f.a._testNotImgplus)return!0;let t=navigator&&navigator.userAgent||"";t=t.toLocaleLowerCase();let e=!1;return o.a.notImgplusUas&&(e=o.a.notImgplusUas.some(e=>-1!==t.indexOf(e))),e},isBrowserSupport:function(){let t=D.a.kernel.toLowerCase(),e=D.a.kernelVersion;if("chrome"===t&&53!=e)return!0;let i=(D.a.browser+"").toLowerCase();for(let t=0;t<o.a.p2pOpenBrowsers.length;t++){let e=o.a.p2pOpenBrowsers[t];if(-1!==i.indexOf(e))return!0}return!1},isP2PCooling:function(){return 1===Number(o.a.needCooling)&&1===Number(f.a.__p2p_cooling_play)},isSupportP2P:function(){return this.isBrowserSupport()&&!this.isP2PCooling()},isWebrtcSupport:function(){try{var t=navigator.userAgent,e={Trident:t.indexOf("Trident")>0||t.indexOf("NET CLR")>0,Presto:t.indexOf("Presto")>0,WebKit:t.indexOf("AppleWebKit")>0,Gecko:t.indexOf("Gecko/")>0,UC:t.indexOf("UC")>0||t.indexOf(" UBrowser")>0,BaiDu:t.indexOf("Baidu")>0||t.indexOf("BIDUBrowser")>0,Maxthon:t.indexOf("Maxthon")>0,LBBROWSER:t.indexOf("LBBROWSER")>0,SouGou:t.indexOf("MetaSr")>0||t.indexOf("Sogou")>0,IE:t.indexOf("MSIE")>0||t.indexOf("Trident")>0,Firefox:t.indexOf("Firefox")>0,Opera:t.indexOf("Opera")>0||t.indexOf("OPR")>0,Safari:t.indexOf("Safari")>0,Chrome:t.indexOf("Chrome")>0||t.indexOf("CriOS")>0,Wechat:t.indexOf("MicroMessenger")>0,Windows:t.indexOf("Windows")>0,Linux:t.indexOf("Linux")>0,Mac:t.indexOf("Macintosh")>0,Android:t.indexOf("Android")>0||t.indexOf("Adr")>0,WP:t.indexOf("IEMobile")>0,BlackBerry:t.indexOf("BlackBerry")>0||t.indexOf("RIM")>0||t.indexOf("BB")>0,MeeGo:t.indexOf("MeeGo")>0,Symbian:t.indexOf("Symbian")>0,iOS:t.indexOf("like Mac OS X")>0,iPhone:t.indexOf("iPh")>0,iPad:t.indexOf("iPad")>0,Mobile:t.indexOf("Mobi")>0||t.indexOf("iPh")>0||t.indexOf("480")>0,Tablet:t.indexOf("Tablet")>0||t.indexOf("iPad")>0||t.indexOf("Nexus 7")>0,TheWorld:t.indexOf("TheWorld")>0};return e.Chrome&&(e.Chrome=!(e.Opera||e.BaiDu||e.Maxthon||e.SouGou||e.UC||e.LBBROWSER||e.TheWorld)),e.Chrome}catch(t){return!1}}},Z=class{constructor(t){let{presenterUid:e,lineType:i}=t;this.heartMode=R.b.getCfgValue(o.a.heartMode,e,i,1),this.heartQpsOpen=R.b.isOpen(o.a.heartQpsPids,e,i,!1),this.heartQps=R.b.getCfgValue(o.a.heartQps,e,i,0),this.batch_id=0,this.heartList=[]}destroy(){this.heartList=null}sendQps(t,e,i){let s=Math.floor(Date.now()/1e3);0===this.batch_id&&(this.batch_id=s);let r=[];e.forEach(t=>{if(t.vDimension[d.a.DIM_CORE.REPROT_TIME]=s,2===this.heartMode&&this.heartQpsOpen)t.vDimension[d.a.DIM_CORE.BATCH_ID]=this.batch_id,t.vDimension[d.a.DIM_CORE.REPORT_TYPE]=1;else if(3===this.heartMode){let e={sMetricName:t.sMetricName,vDimension:{},vField:{},vExLog:{}};Object.assign(e.vDimension,t.vDimension),Object.assign(e.vField,t.vField),Object.assign(e.vExLog,t.vExLog),e.vDimension[d.a.DIM_CORE.BATCH_ID]=this.batch_id,e.vDimension[d.a.DIM_CORE.REPORT_TYPE]=1,r.push(e)}}),1===this.heartMode?t.sendMetrics(e):2===this.heartMode?this.heartQpsOpen?this.storeAndSend(t,e,i):t.sendMetrics(e):3===this.heartMode&&(t.sendMetrics(e,i),this.storeAndSend(t,r,i))}storeAndSend(t,e,i){if(this.heartList.push(e),this.heartList.length>=this.heartQps||i){let e=[];for(let t=0;t<this.heartList.length;t++)e=e.concat(this.heartList[t]);this.heartList=[],this.batch_id=0,t.sendMetrics(e)}}},tt=s(11),et=new class{constructor(){this._signalRtt=new tt.SignalRttImpl(r)}getStats(){return this._signalRtt.getStats()}start(t,e){if(!this._start){this._start=!0;let i=R.b.isOpen(o.a.signalRttPids,t,-1,!1);!i&&o.a.isSignalRttOpen(e)&&(i=!0),i?(n.a.log("SignalRtt.start","pid",t,"uid",e,"open"),X.add(this._onTimer,this,100)):n.a.log("SignalRtt.start","pid",t,"uid",e,"not open")}}_onTimer(t){this._signalRtt.onTimer(t)}},it=class{constructor(t){this.handlerPlayer=t,this.stat=t.stat,this.tsdb=t.tsdb,this.statVod=t.statVod,this._statQps=null}destroy(){this.handlerPlayer=null,this.stat=null,this.tsdb=null,this.statVod=null,this._statQps&&this._statQps.destroy(),this._statQps=null}get statQps(){return this._statQps||(this._statQps=new Z({presenterUid:this.handlerPlayer.info.presenterUid,lineType:this.handlerPlayer.info.lineType})),this._statQps}recordMpsStat(t){if(this.stat.setCore(d.a.CORE.MPS_SUBS,t),window.mpsApi){let t=window.mpsApi.getHeartStats();t&&(this.stat.setComDim(d.a.DIM_COM.MPS_STATUS,t.mps_status),this.stat.setComDim(d.a.DIM_COM.NAT,t.nat),this.stat.setComDim(d.a.DIM_COM.NAT_SYNC,t.nat_sync),this.stat.setComDim(d.a.DIM_COM.IP_STACK_TYPE,t.ipStackType),this.stat.setCore(d.a.CORE.MPS_SRC,t.mps_src),this.stat.setCore(d.a.CORE.MPS_UP,t.mps_up),this.stat.setCore(d.a.CORE.MPS_SRC_BW,t.mps_src_bw),this.stat.setCore(d.a.CORE.MPS_UP_BW,t.mps_up_bw))}}recordBaseStat(){let t=null;if(this.handlerPlayer.mse&&this.handlerPlayer.mse.getWebCodecsStats&&(t=this.handlerPlayer.mse.getWebCodecsStats()),this.handlerPlayer&&this.handlerPlayer.mse){const{pfps:t,pfpsMax:e,pfpsMin:i}=this.handlerPlayer.mse.renderFps.getPageRecordFps();this.stat.setCore(d.a.DIM_CORE.PFPS,t),this.stat.setCore(d.a.DIM_CORE.PFPSMAX,e),this.stat.setCore(d.a.DIM_CORE.PFPSMIN,i),this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.roomRecordStat&&this.handlerPlayer._hyPlayer.roomRecordStat.setPageFps({pfps:t,pfpsMax:e,pfpsMin:i}),n.a.log("BaseQAStat.recordBaseStat pfps=".concat(t,", pfpsMax=").concat(e,", pfpsMin=").concat(i))}if(this.handlerPlayer&&this.handlerPlayer.mse&&this.handlerPlayer.mse.getRealFps){let t=this.handlerPlayer.mse.getRealFps();t>30&&t<=33&&(t=30),t>24&&t<27&&(t=24),this.stat.setCoreDim(d.a.DIM_COM.FRAMERATE,t)}if(this.handlerPlayer&&!this.handlerPlayer.isLive&&this.handlerPlayer.getFps){let t=this.handlerPlayer.getFps();t>30&&t<=33&&(t=30),t>24&&t<27&&(t=24),this.stat.setCoreDim(d.a.DIM_COM.FRAMERATE,t),this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.FRAMERATE,t)}t&&this.recordWebCodecsStat(t),this.recordEnhanceStat(t),this.recordSignalRtt()}recordWebCodecsStat(t){for(let e in t)"decodedList"==e?this.recordFrameInfo(t[e],d.a.DIM_COM.V_DECODE_FRAME):"renderList"==e?this.recordFrameInfo(t[e],d.a.DIM_COM.V_PLAY_FRAME):"videoToDecodeList"==e?this.recordFrameInfo(t[e],d.a.DIM_COM.V_TO_DECODE_FRAMES):"delayList"==e?this.recordFrameInfo(t[e],d.a.DIM_COM.V_TO_PLAY_FRAME):"deltaList"==e&&this.recordFrameInfo(t[e],d.a.DIM_COM.AV_DELTA)}recordFrameInfo(t,e){this.stat.setComp(e,"size",t.length),t.map((t,i)=>{this.stat.setComp(e,"k"+(i+1),t),this.stat.setCompFormat(e,":",",")}),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&(this.statVod.setComp(e,"size",t.length),t.map((t,i)=>{this.statVod.setComp(e,"k"+(i+1),t),this.statVod.setCompFormat(e,":",",")}))}recordSignalRtt(){let t=et.getStats();this.recordFrameInfo(t.rttSamples,d.a.DIM_COM.SIGNAL_RTT),this.stat.setCore(d.a.DIM_COM.SIGNAL_RTT_MAX,t.rttMax)}recordHeart(){this.stat.setComDim(d.a.DIM_COM.USER_UUID,v.a.uuid),this.recordAudioEmpty()}recordAudioEmpty(){const t=this.handlerPlayer.getEmptyAudioRecord(),e=d.a.DIM_COM.A_RENDER_SILENCE_TIME,i=t.length;t.reverse(),this.stat.setComp(e,"size",i),t.map((t,s)=>{this.stat.setComp(e,"k"+4*(i-s),t),this.stat.setCompFormat(e,":",",")});const s=this.handlerPlayer.getVoiceStats();this.stat.setCore(d.a.CORE.A_VOL,this.handlerPlayer.getVolume()),this.stat.setCore(d.a.CORE.A_E_DUR,s.noVoiceDur),this.stat.setCore(d.a.CORE.A_E_CNT,s.noVoiceCnt),this.stat.setCoreDim(d.a.DIM_COM.A_CFG,this.handlerPlayer.hasAudioCfg()?1:0)}sendRecordMetrics(){this.recordMosaicData(),this.recordMuffleData()}recordMosaicData(){if(this.handlerPlayer._hyPlayer.getMosaicStat){const{data:t}=this.handlerPlayer._hyPlayer.getMosaicStat();if(null==t)return;let e=t.statDatas.length,i=0,s=0,r=0,a=[],o={};t.statDatas.map((t,n)=>{e-n<=3&&a.push(t.pixelateKey),0==t.suc?i++:1==t.suc?s++:2==t.suc&&r++,o.dts_type=t.dtsType}),o.success_cnt=i,o.fail_cnt=s,o.partial_success_cnt=r,o.req_keys=a.join(","),o.buss="video_pixelate",o=JSON.stringify(o),n.a.log("BaseQaStat.recordMosaicData",o),e>0&&this.stat.setCoreDim(d.a.DIM_COM.MOSAIC_DATA,o),this.stat.setCore(d.a.CORE.MOSAIC_COUNT,t.mosaicCnt),this.stat.setCore(d.a.CORE.MOSAIC_DURATION,t.mosaicDuration)}if(this.handlerPlayer._hyPlayer.getMosaicGrassMode){let t=this.handlerPlayer._hyPlayer.getMosaicGrassMode();this.stat.setCore(d.a.CORE.USED_XP2P,t)}}recordMuffleData(){if(this.handlerPlayer&&this.handlerPlayer.mse&&this.handlerPlayer.mse.getMuffleStat){const{muffleCnt:t,muffleDuration:e}=this.handlerPlayer.mse.getMuffleStat();this.stat.setCore(d.a.CORE.MUTE_COUNT,t),this.stat.setCore(d.a.CORE.MUTE_DURATION,e)}}recordEnhanceStat(t){let e={v_frames:0,v_enhance_delay:-1};const i=this.handlerPlayer.getEnhanceStats(),{width:s,height:r}=this.handlerPlayer.getDpi();i&&(e.v_enhance=i.vEnhanceType,e.v_support=i.vSupport,e.v_gameId=i.vGameId,e.v_errorCode=i.vErrorCode,e.v_width=s,e.v_height=r);const a=this.handlerPlayer.getRefreshRate();if(e.v_refreshRate=a,t){let i=[],s=[],r=0,a=0,o=0,n=0,h=0;for(let e in t){const d=t[e];"videoEnhanceList"==e?i=d:"videoEnhanceCostList"==e?s=d:"ehLess30Nums"==e?r=d:"ehLess150Nums"==e?a=d:"ehLess200Nums"==e?o=d:"ehLarge200Nums"==e?n=d:"ehTotal"==e&&(h=d)}if(this.stat.setCore(d.a.DIM_CORE.ENHACNE_LESS_30,r),this.stat.setCore(d.a.DIM_CORE.ENHACNE_LESS_150,a),this.stat.setCore(d.a.DIM_CORE.ENHACNE_LESS_200,o),this.stat.setCore(d.a.DIM_CORE.ENHACNE_LARGE_200,n),this.stat.setCore(d.a.DIM_CORE.ENHANCE_TOTAL,h),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&(this.statVod.setCore(d.a.VOD_DIM_CORE.ENHACNE_LESS_30,r),this.statVod.setCore(d.a.VOD_DIM_CORE.ENHACNE_LESS_150,a),this.statVod.setCore(d.a.VOD_DIM_CORE.ENHACNE_LESS_200,o),this.statVod.setCore(d.a.VOD_DIM_CORE.ENHACNE_LARGE_200,n),this.statVod.setCore(d.a.VOD_DIM_CORE.ENHANCE_TOTAL,h)),i.length>0){const t=i.reduce((t,e)=>t+e);e.v_frames=~~(t/i.length)}if(s.length>0){const t=s.reduce((t,e)=>t+e);e.v_enhance_delay=~~(t/s.length)}}this.stat.setCoreDim(d.a.DIM_COM.FEATURE_STATUS,JSON.stringify(e)),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&this.statVod.setCoreDim(d.a.VOD_DIM_COM.FEATURE_STATUS,JSON.stringify(e))}reportVideoBadQuality(t,e,i,s,r,a){n.a.log("QAStat.reportVideoBadQuality, isPaused=".concat(t,", pauseCnt=").concat(e,", pauseWorkerCnt=").concat(s,", isFramePaused=").concat(a));const h=this.handlerPlayer.getPause500Cnt();if(this.handlerPlayer.h265Proxy&&this.handlerPlayer.h265Proxy.rendering)this.reportH265(t,e,i,h,s,r);else{let i=document.visibilityState;const n=t||e>0?100:0,l=this.handlerPlayer.mse&&this.handlerPlayer.mse.getVideoCBLargeCnt(),c=this.handlerPlayer.mse&&this.handlerPlayer.mse.getVideoFrameCallBackNums();1==o.a.isFilterMsePause&&this.handlerPlayer.isMse&&"visible"==i&&c>0?(t||e>0)&&l>0?this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,100):(this.stat.setCore(d.a.CORE.VIDEO_BLOCK_COUNT,0),this.stat.setCore(d.a.CORE.VIDEO_BLOCK_DURATION,0)):this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,n),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,t?100:0),this.handlerPlayer.mse&&this.handlerPlayer.mse.getMseRenderList&&this.recordFrameInfo(this.handlerPlayer.mse.getMseRenderList(),d.a.DIM_COM.V_PLAY_FRAME),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,h>0||r||s>0?100:0),this.handlerPlayer&&(this.handlerPlayer.isWebCodec?this.stat.setCoreDim(d.a.DIM_COM.MP_EXPERIMENT,a?100:0):this.stat.setCoreDim(d.a.DIM_COM.MP_EXPERIMENT,t||e>0?100:0)),100===n&&this.tsdb.autoReport()}}reportH265(t,e,i,s,r,a){const{h265PauseCnt:o,videoPauseCnt:h,videoPauseTime:l,isVideoPaused:c,hiddenTime:u,statProps:p,pause500CntH265:m,isFramePaused:_}=this.handlerPlayer.h265Proxy.getStats(i);n.a.log("QAStat.reportH265, videoPauseCnt=".concat(h,", pause500CntH265=").concat(m,", isFramePaused=").concat(_));let f=o>0?100:0,g=t||e>0?100:0,S=c||h>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&u>=2e4?(this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,s>0||a||r>0?100:0),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,g)):(this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,m>0&&S?100:0),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,S),this.stat.setCore(d.a.CORE.VIDEO_BLOCK_COUNT,h),this.stat.setCore(d.a.CORE.VIDEO_BLOCK_DURATION,l)),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,f),this.stat.setComDim(d.a.DIM_COM.MP_EXPERIMENT,_?100:0);for(let t in p)"toDecode"==t?this.recordFrameInfo(p[t],d.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==t?this.recordFrameInfo(p[t],d.a.DIM_COM.V_DECODE_FRAME):"render"==t?this.recordFrameInfo(p[t],d.a.DIM_COM.V_PLAY_FRAME):"rawList"==t||("frameList"==t?this.recordFrameInfo(p[t],d.a.DIM_COM.V_TO_PLAY_FRAME):this.stat.setComp(d.a.DIM_H265_SAM.name,t,p[t].join("|")));100===g&&this.tsdb.autoReport()}rcordCaptureJitter(t){if(t)for(let e in t){let i=t[e];for(let t in i)this.stat.setCore(t,i[t])}}},st=class extends it{constructor(t){super(t),this.img=null,this.isPaused=!1,this.isFirstReport=!0,this.lastAudioFrames=0}sendFlow(t){this.record(t)}getUserProperty(){let t=this.tsdb,e=0;return e=o.a[100]?o.a[101]?$.isBrowserSupport()?$.isP2PCooling()?N.a.userProperty.P2P_COOLING:1==t.turnToFlvTimes&&0==t.restartTimes?t.turnToFlvReason==N.a.turnToFlvReason.FULL_CONNECT_TIMEOUT?N.a.userProperty.FIRST_FULL_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.FULL_NO_DATA?N.a.userProperty.FIRST_FULL_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.FULL_PLAY_FAIL?N.a.userProperty.FIRST_FULL_PLAY_FAIL:t.turnToFlvReason==N.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?N.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.SUB_NO_DATA?N.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.P2P_ARGS_ERROR?N.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==N.a.turnToFlvReason.P2P_COOLING?N.a.userProperty.P2P_COOLING:t.turnToFlvReason==N.a.turnToFlvReason.IS_NOT_FIRST_FETCH?N.a.userProperty.IS_NOT_FIRST_FETCH:t.turnToFlvReason==N.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?N.a.userProperty.VIDEO_BUFFER_EMPTY:N.a.userProperty.UNKNOW:t.turnToFlvReason==N.a.turnToFlvReason.FULL_CONNECT_TIMEOUT||t.turnToFlvReason==N.a.turnToFlvReason.FULL_NO_DATA||t.turnToFlvReason==N.a.turnToFlvReason.FULL_PLAY_FAIL?t.restartReason==N.a.restartReason.RANGE_SEQ_MAX?N.a.userProperty.RESTART_RANGE_MAX:t.restartReason==N.a.restartReason.RANGE_SEQ_LARGE?N.a.userProperty.RESTART_RANGE_LARGE:t.restartReason==N.a.restartReason.CONNECT?N.a.userProperty.RESTART_CONNECT:t.restartReason==N.a.restartReason.MULTI_CDN?N.a.userProperty.RESTART_MUTI_CDN:t.restartReason==N.a.restartReason.PLAYER_NO_DATA?N.a.userProperty.RESTART_PLAYER_NO_DATA:t.restartReason==N.a.restartReason.PLAYER_ERROR?N.a.userProperty.RESTART_PLAYER_ERROR:t.restartReason==N.a.restartReason.FLV_TO_P2P?N.a.userProperty.FLV_TO_P2P:t.restartReason==N.a.restartReason.LOST_SEQ?N.a.userProperty.LOST_SEQ:N.a.userProperty.UNKNOW:t.turnToFlvReason==N.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?N.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.SUB_NO_DATA?N.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.P2P_ARGS_ERROR?N.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==N.a.turnToFlvReason.P2P_COOLING?N.a.userProperty.P2P_COOLING:t.turnToFlvReason==N.a.turnToFlvReason.IS_NOT_FIRST_FETCH?N.a.userProperty.IS_NOT_FIRST_FETCH:t.turnToFlvReason==N.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?N.a.userProperty.VIDEO_BUFFER_EMPTY:N.a.userProperty.UNKNOW:N.a.userProperty.BROWSER_UN_SUPPORT:N.a.userProperty.CLIENT_CLOSE:N.a.userProperty.SERVER_CLOSE,e}record(t){super.sendRecordMetrics();let{pauseCnt:e,pauseTime:i,isPaused:s,isPausedWorker:r,flowSize:a,httpErrorCode:h,pauseReason:l,volumeEnergy:c,isEnd:u,pauseWorkerCnt:p,isFramePaused:m}=t;this.handlerPlayer.qaStaRecord&&this.handlerPlayer.qaStaRecord(),this.volumeEnergy=c,s&&(this.isPaused=!0);let _=this.getUserProperty(),f=this.handlerPlayer.getAudioFrames();this.stat.setCore(d.a.CORE.AUDIO_CNT,f-this.lastAudioFrames),this.lastAudioFrames=f,u&&(this.lastAudioFrames=0),this.stat.setCoreDim(d.a.DIM_COM.STREAM_INDEX,h),this.stat.setCoreDim(d.a.DIM_CORE.USER_PROPERTY,_),this.stat.setCoreDim(d.a.DIM_CORE.SIGNAL_USER_PROPERTY,0),this.stat.setComDim(d.a.DIM_COM.VIDEO_MIN_BUF,this.handlerPlayer.mse&&this.handlerPlayer.mse.JITTER_BUFLEN);let g=this.handlerPlayer.mse&&this.handlerPlayer.mse.parser.timeStampStat,S=[];g&&g.reset();let y=this.handlerPlayer.info;this.handlerPlayer.mse&&(this.handlerPlayer.mse.pauseStat.record(this.stat),this.rcordCaptureJitter(this.handlerPlayer.mse.getCaptureStats(!0))),this.reportVideoBadQuality(s,e,u,p,r,m),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_REASON,l),this.stat.setCore(d.a.CORE.BUFFER_LENGTH,this.handlerPlayer.getBufferLen()+this.handlerPlayer.getFrameBufferLen());let T=this.handlerPlayer.getBufferLen();if(this.handlerPlayer.isShieldStart&&(T+=this.handlerPlayer.getFrameBufferLen()),this.stat.setCore(d.a.CORE.PLAY_DELAY,T),this.stat.setCore(d.a.CORE.FRAME_BUFFER_DELAY,this.handlerPlayer.getFrameBufferLen()),this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.visibility&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat(),this.recordSample(),this.recordAuto(),this.handlerPlayer.recSysStat.recordHeart(this.stat),this.handlerPlayer.mse&&this.handlerPlayer.mse.buffered.record(this.stat),this.handlerPlayer.mse&&this.handlerPlayer.mse.avSyncStat.record(this.stat),this.handlerPlayer&&this.handlerPlayer.autoMonitor.recordHeartType(),this.handlerPlayer.mse&&this.handlerPlayer.mse.metadata){const{recvVideoFps:t,recvAudioFps:e}=this.handlerPlayer.mse.metadata;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_RATE,e),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_RATE,t)}if(this.handlerPlayer.mse&&this.handlerPlayer.mse.bufStat){const{emptyTime:t,emptyCnt:e}=this.handlerPlayer.mse.bufStat.getStats();this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_COUNT,e),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_TIME,t)}this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.costUs>0&&this.stat.setComp(d.a.DIM_H265_SAM.name,"costUs",this.handlerPlayer._hyPlayer.costUs),this.recordBaseStat(),this.recordMpsStat(0);const P=this.handlerPlayer.loader.speed;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.SPEED,P);const E=this.handlerPlayer.mse&&this.handlerPlayer.mse.curVideoDts,C=this.handlerPlayer.mse&&this.handlerPlayer.mse.curAudioDts;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_DTS,E),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_DTS,C),this.stat.setCompFormat(d.a.DIM_LINK_SAM.name,":",","),this.handlerPlayer.recordRecvFps(this.stat),this.recordC2CDelay(),this.handlerPlayer.mse&&this.handlerPlayer.mse.metadata&&this.handlerPlayer.mse.metadata.codecname&&this.stat.setComDim(d.a.DIM_COM.SPHD_TYPE,this.handlerPlayer.mse.metadata.codecname),this.isFirstReport?this.isFirstReport=!1:0===o.a.statLv[15]&&S.push({sMetricName:A.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0,pausecnt:e},vDimension:{p2p:0,originalBitrate:0===y.originalBitrate?1:0,p2pCooling:v.a.p2pCooling?1:0,topSid:y.sid,reason:l,quality:s||e>0?100:0},vExLog:{cdnip:this.handlerPlayer.cdnip}}),this.stat.setComDim(d.a.DIM_COM.CDNIP,this.handlerPlayer.cdnip),o.a.renderStat[0]&&this.reportAVRenderInfo(this.handlerPlayer.mse);const{pcdn302CoreStats:I,pcdn302DimStats:D}=this.handlerPlayer.getPcdn302Stats();for(let t in I){let e=I[t];e>0&&this.stat.setCore(t,e)}for(let t in D){let e=D[t];e>0&&this.stat.setComDim(t,e)}this.recordAiData(),this.recordMuteData(),super.recordHeart();let R=[];for(let t of this.stat.coreMap.keys())t.indexOf("_bw")>-1&&R.push("".concat(t,":").concat(this.stat.coreMap.get(t)));n.a.log("QAStat.coreDim pcdn,",R.join()),this.stat.fill(S,u),this.statQps.sendQps(this.tsdb,S,u),this.isPaused=!1}recordSample(t){this.handlerPlayer.sampleController.recordStat(this.stat,t);let e=this.handlerPlayer.mse;e&&(this.handlerPlayer.mse.parser.avSample.recordStat(this.stat),e.parser&&e.parser.avcChangeStat&&e.parser.avcChangeStat.record(this.stat,o.a.getAvHeaderChangeStat(this.handlerPlayer.info.presenterUid)))}recordAuto(){let t=this.handlerPlayer.p2pFlvPlayer.ctrlBitrate;t&&(this.stat.setCoreDim(d.a.DIM_CORE.AUTO_U_REASON,t._switchUpReason),this.stat.setCoreDim(d.a.DIM_CORE.AUTO_D_REASON,t._switchDownReason))}recordAiData(){const{aiP2PCnt:t,aiFlvCnt:e,aiP2PTimeoutCnt:i,aiFlvTimeoutCnt:s,aiP2PErrorCnt:r,aiFlvErrorCnt:a,aiP2PSwitchCnt:o,aiFlvSwitchCnt:n,aiP2PNotSwitchCnt:h,aiFlvNotSwitchCnt:l,aiFlvErrorSwitchCnt:c,aiFlvErrorNotSwitchCnt:u,aiStartP2PCnt:p,aiStartFlvCnt:m}=this.handlerPlayer.getAiStat();this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_CNT,t),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_CNT,e),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_TIMEOUT_CNT,i),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_TIMEOUT_CNT,s),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_ERROR_CNT,r),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_CNT,a),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_SWITCH_CNT,o),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_SWITCH_CNT,n),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_NOT_SWITCH_CNT,h),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_NOT_SWITCH_CNT,l),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_SWITCH_CNT,c),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_NOT_SWITCH_CNT,u),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_START_P2P_CNT,p),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_START_FLV_CNT,m),this.stat.setCompFormat(d.a.AI_CONTROL_DATA.name,":",",")}recordMuteData(){if(this.handlerPlayer.eventEmitter&&this.handlerPlayer.eventEmitter.getMuteStat&&this.handlerPlayer.eventEmitter.getMuteStat){const{muteData:t}=this.handlerPlayer.eventEmitter.getMuteStat();let e=[];t.map(t=>{let i=[];i.push(t.value),i.push(t.type),i.push(t.currentDts),i.push(t.reqKey),i.push(t.begin),i.push(t.end),e.push(i.join(":"))}),this.stat.setCoreDim(d.a.DIM_COM.MUTE_DATA,e.join(","))}}recordC2CDelay(){let t=this.handlerPlayer.mse&&this.handlerPlayer.mse.getDelayStat();if(t){for(let e in t.fields)this.stat.setCore(e,t.fields[e]);for(let e in t.dims)this.stat.setCoreDim(e,t.dims[e])}}reportAVRenderInfo(t){const e=t.videoPlayConsuming.getRecvToRenderConsuming(),i=t.videoPlayConsuming.getRecvToPushConsuming(),s=t.videoPlayConsuming.getPushToRenderedConSuming(),r=Math.round(e.max),a=Math.round(e.avg),o=Math.round(i.max),h=Math.round(i.avg),l=Math.round(s.max),c=Math.round(s.avg);r>0&&a>0&&(this.stat.setCore(d.a.DIM_CORE.VTDMAX,r),this.stat.setCore(d.a.DIM_CORE.VTDAVG,a),this.stat.setCore(d.a.DIM_CORE.VRTADEMAX,o),this.stat.setCore(d.a.DIM_CORE.VRTADE,h),this.stat.setCore(d.a.DIM_CORE.VATRDEMAX,l),this.stat.setCore(d.a.DIM_CORE.VATRDE,c));const u=t.audioPlayConsuming.getRecvToRenderConsuming(),p=t.audioPlayConsuming.getRecvToPushConsuming(),m=t.audioPlayConsuming.getPushToRenderedConSuming(),_=Math.round(u.max),f=Math.round(u.avg),g=Math.round(p.max),S=Math.round(p.avg),y=Math.round(m.max),T=Math.round(m.avg);_>0&&f>0&&(this.stat.setCore(d.a.DIM_CORE.ATDMAX,_),this.stat.setCore(d.a.DIM_CORE.ATDAVG,f),this.stat.setCore(d.a.DIM_CORE.ARTADEMAX,g),this.stat.setCore(d.a.DIM_CORE.ARTADE,S),this.stat.setCore(d.a.DIM_CORE.AATRDEMAX,y),this.stat.setCore(d.a.DIM_CORE.AATRDE,T)),t.videoPlayConsuming.clearConsuming(),t.audioPlayConsuming.clearConsuming();const P=t.renderFps.getRecordFps(),v=t.renderFps.statRenderQuality(),E=t.parser.dropFrameDts.getRecrod(),C=t.parser.fps.getRecord(),I=t.parser.fps.getFps();this.stat.setCore(d.a.DIM_CORE.VRDFPS,P),this.stat.setCore(d.a.DIM_CORE.VRCFPS,I),this.stat.setCore(d.a.DIM_CORE.VDF,E),this.stat.setCore(d.a.DIM_CORE.VRBQ,v),n.a.log("QAStat.reportAVRenderInfo P2P: video_total_delay_max=",r,"video_total_delay_avg=",a,"video_recv_to_append_delay_max=",o,"video_recv_to_append_delay=",h,"video_append_to_render_delay_max=",l,"video_append_to_render_delay=",c,"audio_total_delay_max=",_,"audio_total_delay_avg=",f,"audio_recv_to_append_delay_max=",g,"audio_recv_to_append_delay=",S,"audio_append_to_render_delay_max=",y,"audio_append_to_render_delay=",T,"video_render_fps=",P,"video_receive_fps=",I,"page_fps=","video_drop_frames=",E,"video_recv_frames=",C)}},rt=class{constructor(t,e){this.eventEmitter=t,this.mse=e,this.tickCnt=0}reset(){this.tickCnt=0}onCheckTimer(t,e){this.tickCnt++,4!==this.tickCnt&&this.tickCnt%10!=0||this.trigger()}trigger(){let t={};Object.assign(t,this.mse.metadata),this.eventEmitter.trigger(m.METADATA,t)}},at=s(20),ot=s.n(at);window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;class nt extends at.EventEmitter{constructor(){super(),this.audioContext=null,this.playing=!1,this.audio=null,this.analyser=null,this.source=null,this.timer=0}reset(){this.playing=!1}createAudioContext(t){if(t)try{this.audio!=t&&(this.audio=t,this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(t),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination)),this.playing=!0,this.loop(2e3)}catch(t){n.a.log("createAudioContext err:"+t)}}loop(t){if(this.playing&&this.analyser&&this.analyser.fftSize){this.audio&&!this.audio.error&&this.playing&&(clearTimeout(this.timer),this.timer=setTimeout(this.loop.bind(this),t,t));var e=this.analyser.fftSize,i=new Uint8Array(e);this.analyser.getByteFrequencyData(i),i.some(t=>t)?this.emit(nt.AUDIO_FREQUENCY,{value:1}):this.emit(nt.AUDIO_FREQUENCY,{value:0})}}}var ht=nt;nt.AUDIO_FREQUENCY="AUDIO_FREQUENCY";var dt=s(16);let lt=null;var ct=function(){if(null==lt)try{let t=document.createElement("canvas").getContext("experimental-webgl"),e=t.getExtension("WEBGL_debug_renderer_info");lt=t.getParameter(e.UNMASKED_RENDERER_WEBGL),f.a._renderInfo=lt}catch(t){lt="",n.a.log("RenderInfo.getRenderInfo",t.message)}return lt},ut={setCdnDomain:function(t,e,i){i=i||"";let s="cdndomain",r=(e=e||"").match(/\/\/(.+?)\//i);r&&r.length>1&&(s=r[1]),t.setComDim(d.a.DIM_COM.CDNDOMAIN,s),t.setComDim(d.a.DIM_COM.STREAM,i||"stream")},setVodCdnDomain:function(t,e){let i="cdndomain",s=(e=e||"").match(/\/\/(.+?)\//i);s&&s.length>1&&(i=s[1]),t.setComDim(d.a.DIM_COM.CDNDOMAIN,i)},recordComDim:function(t,e){t.setComDim(d.a.DIM_COM.SDK_VER,2508270844),t.setComDim(d.a.DIM_COM.UA,navigator&&navigator.userAgent),this.recordSystemInfo(t),this.recordStartInfo(t,e)},recordStartInfo:function(t,e){t.setComDim(d.a.DIM_COM.AD_BLOCK,1===Number(e.adBlock)?1:0)},recordSystemInfo:function(t){dt.a.isMseSupportedHevc()?(t.setComDim(d.a.DIM_COM.DECODE_SUPPORT,"mse_hevc"),t.setComDim(d.a.DIM_COM.DECODE_CAPABILITY,"mse_hevc")):R.b.isWebCodecsSupported()?(t.setComDim(d.a.DIM_COM.DECODE_SUPPORT,"webcodecs"),t.setComDim(d.a.DIM_COM.DECODE_CAPABILITY,"webcodecs")):dt.a.isMseSupportedH264()&&(t.setComDim(d.a.DIM_COM.DECODE_SUPPORT,"mse"),t.setComDim(d.a.DIM_COM.DECODE_CAPABILITY,"mse")),t.setComDim(d.a.DIM_COM.SUPPORT_AV1,dt.a.isMseSupportedAV01()?1:2),t.setComDim("backup_field1",R.b.isManagerMediaSourceSupported()?1:0),t.setComDim(d.a.DIM_COM.BROWSER_NAME,D.a.browser),t.setComDim(d.a.DIM_COM.BROWSER_VERSION,D.a.version.major),t.setComDim(d.a.DIM_COM.BROWSER_KERNEL,h.a.name),t.setComDim(d.a.DIM_COM.BROWSER_KERNEL_VERSION,h.a.version.major),t.setComDim(d.a.DIM_COM.OS_NAME,D.a.os),t.setComDim(d.a.DIM_COM.OS_VERSION,D.a.osVersion),t.setComDim(d.a.DIM_COM.HARDWARE_CONCURRENCY,Number(navigator.hardwareConcurrency)||0),t.setComDim(d.a.DIM_COM.I_GPU,navigator.gpu?1:0),lt&&t.setComDim(d.a.DIM_COM.RENDER_INFO,ct())}},pt=class{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;this.linkHandler=t,this.ws=null,this.connected=!1,this.isYY=e,this.url=null,this.avgSpeed=new O(i)}destroy(){this.linkHandler=null,this.reset(),X.remove(this.onCheckTimer,this)}connect(t){this.reset(),X.add(this.onCheckTimer,this,1e3),this.url=t,this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this.onmessage.bind(this)}reset(){this.ws&&(this.connected=!1,this.ws.onopen=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null),this.url=null,this.avgSpeed.reset()}send(t){this.ws&&this.connected&&this.ws.send(t)}onopen(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}onerror(t){n.a.log("ProtoLink.onerror event="+t),this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onerror(t),this.linkHandler=null)}onclose(){this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}onmessage(t){this.avgSpeed.addCur(t.data.byteLength),t.data instanceof ArrayBuffer?this.processArrayBuffer(t.data):this.processText(t.data)}processText(t){n.a.log("ProtoLink.processText data="+t)}processArrayBuffer(t){if(!this.isYY)return void(this.linkHandler&&this.linkHandler.onData(t));let e=new DataView(t),i=0,s=0,r=0;for(;i+10<t.byteLength;){if(s=e.getUint32(i,!0),i+s>t.byteLength||s<10)return void n.a.error("ProtoLink.processArrayBuffer length error pktLen="+s+" bufferLen="+t.byteLength);r=e.getUint32(i+4,!0);let a=new DataView(t,i,s);this.linkHandler&&this.linkHandler.onData(r,a),i+=s}}onCheckTimer(t,e){this.connected&&this.avgSpeed.calculate()}get speed(){return this.avgSpeed.average()}},mt=class{static isSupported(){try{let t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===t.responseType}catch(t){return n.a.warn("MozChunkedLoader",t.message),!1}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.linkHandler=t,this.connected=!1,this.url=null,this.xhr=null,this.avgSpeed=new O(e)}destroy(){this.reset(),this.linkHandler=null,X.remove(this.onCheckTimer,this)}reset(){this.abort(),this.url=null,this.xhr=null,this.connected=!1,this.avgSpeed.reset()}abort(){this.xhr&&(n.a.log("ProtoLinkXhrFF abort"),this.xhr.abort())}connect(t){this.reset(),this.url=t;let e=this.xhr=new XMLHttpRequest;e.responseType="moz-chunked-arraybuffer",e.open("GET",this.url,!0),e.onerror=this.onerror.bind(this),e.onprogress=this.onprogress.bind(this),e.onloadend=this.loadend.bind(this),e.onload=this.onclose.bind(this),e.send(),X.add(this.onCheckTimer,this,1e3)}onprogress(t){this.connected||this.onopen();let e=t.target.response;this.linkHandler.onData(e),this.avgSpeed.addCur(e.byteLength)}onreadystatechange(t){}onopen(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}onerror(t){n.a.log("ProtoLinkXhrFF.onerror "+t);let e=t.currentTarget.status;this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(t,e),this.linkHandler=null)}loadend(t){404===t.currentTarget.status&&this.onerror(t)}onclose(){n.a.log("ProtoLinkXhrFF.onclose"),this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}onCheckTimer(t,e){this.connected&&this.avgSpeed.calculate()}get speed(){return this.avgSpeed.average()}},_t=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.linkHandler=t,this.connected=!1,this.url=null,this.requestAbort=!1,this.controller=null,this.reader=null,this.avgSpeed=new O(e),this.destroyed=!1,this.hasData=!1,this.isClosed=!1,this.waitForData=!1}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed=t,this.isClosed=!0,X.remove(this.onCheckTimer,this),this.waitForData&&!this.hasData||(this.abort(),this.reset()),t&&(this.linkHandler=null)}destroyForce(){n.a.log("ProtoLinkFetch.destroyForce",this.url),this.abort(),this.reset()}reset(){this.connected=!1,this.avgSpeed.reset()}pump(t){t.read().then(e=>{if(e.done)n.a.log("ProtoLinkFetch result done"),this.onclose();else{this.hasData=!0;let i=e.value.buffer;this.avgSpeed.addCur(i.byteLength),this.destroyed?this.abort():(this.waitForData&&this.isClosed&&this.abort(),this.linkHandler&&this.linkHandler.onData(i),this.pump(t))}}).catch(t=>{n.a.error("ProtoLinkFetch.pump",t),this.onerror(t)})}checkAbort(t){return!!this.requestAbort&&(t.cancel(),!0)}connect(t){X.add(this.onCheckTimer,this,1e3),this.url=t;let e=null,i=null,s={};window.AbortController&&(e=new AbortController,i=e.signal,this.controller=e,s.signal=i),fetch(t,s).then(t=>{1==Number(f.a._printFetchUrl)&&n.a.log("FetchUrl",t.url);let e=t.body.getReader();this.reader=e,this.destroyed?this.abort():(this.linkHandler&&this.linkHandler.onstatus&&this.linkHandler.onstatus(t.status),t.ok&&t.status>=200&&t.status<300?(this.onheader(t),t.redirected&&this.on302(t),this.onopen(),this.pump.call(this,e)):(n.a.log("ProtoLinkFetch http code invalid status:"+t.status),this.onerror(t.statusText,t.status)))}).catch(t=>{n.a.log("ProtoLinkFetch exception"),this.onerror(t.message)})}abort(){try{this.reader&&this.reader.cancel&&(n.a.log("ProtoLinkFetch.abort reader"),this.reader.cancel(),this.reader=null)}catch(t){n.a.log("ProtoLinkFetch.abort exception",t)}this.controller&&this.controller.abort&&(n.a.log("ProtoLinkFetch.abort controller"),this.controller.abort(),this.controller=null)}on302(t){n.a.log("ProtoLinkFetch.on302 url=".concat(t.url)),this.linkHandler.on302&&this.linkHandler.on302(t.url)}onheader(t){let e={},i=[];for(let[s,r]of t.headers)e[s]=r,i.push(s+":"+r);n.a.log("ProtoLinkFetch.onheader",i.join(" | ")),this.linkHandler.onheader&&this.linkHandler.onheader(e)}onopen(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}onerror(t,e){n.a.log("ProtoLinkFetch.onerror "+t),this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(t,e),this.linkHandler=null)}onclose(){this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}onCheckTimer(t,e){this.connected&&this.avgSpeed.calculate()}get speed(){return this.avgSpeed.average()}},ft=1,gt=2;class St{constructor(t,e){this.stat=t,e.linkHandler=this,this.link=e,e.waitForData&&X.once(this.onTimeout,this,1e4)}onTimeout(){this.link.destroyForce()}onData(t){this.stat.addCore(d.a.CORE.CDN_TOTAL_BW,t.byteLength),this.stat.addCore(d.a.CORE.OBS_FPS,t.byteLength)}onstatus(t){}on302(t){}onheader(t){}onopen(){}onerror(){}onclose(){}}var yt=class{constructor(t){this.stat=t,this.hisLinks=[]}destroy(){this.stat=null,this.hisLinks=null}addHis(t){n.a.log("VideoLinkHis.addHis link=".concat(t.url));let e=new St(this.stat,t);this.hisLinks.push(e)}},Tt=9,Pt=70,vt=76,Et=86,Ct=1,It=4,At=class{constructor(t){this.data=t,this.size=t.byteLength,this.tagType=0,this.dataSize=0,this.timestamp=0,this.packetType=-1,this.error=!1}destroy(){this.data=null}isVideo(){return 9===this.tagType}isAudio(){return 8===this.tagType}parse(){this.size<11+It?(this.error=!0,n.a.warn("FlvTagParser.parse has no whole tag size=".concat(this.size))):this._parse()}_parse(){let t=this.data;return this.tagType=t[0],this.dataSize=(t[1]<<16)+(t[2]<<8)+t[3],this.size-11-It<this.dataSize?(this.error=!0,void n.a.warn("FlvTagParser.parse has no enough data dataSize=".concat(this.dataSize," size=").concat(this.size))):0===this.dataSize?(this.error=!0,void n.a.warn("FlvTagParser.parse tag empty tagType=".concat(this.tagType))):(this.timestamp=(t[4]<<16)+(t[5]<<8)+t[6]+parseInt(t[7].toString(16)+"000000",16),void((this.isVideo()||this.isAudio())&&(this.packetType=t[12])))}},Dt=class{constructor(t){this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let t=this.data.byteLength-this.bytesAvailable,e=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");e.set(this.data.subarray(t,t+i)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(t){let e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&n.a.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let t=this.skipLZ();return this.readBits(t+1)-1}readEG(){let t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}skipScalingList(t){let e,i,s=8,r=8;for(e=0;e<t;e++)0!==r&&(i=this.readEG(),r=(s+i+256)%256),s=0===r?s:r}readSPS(){let t,e,i,s,r,a,o,n,h,d=0,l=0,c=0,u=0;if(this.readUByte(),t=this.readUByte(),e=this.readBits(5),this.skipBits(3),i=this.readUByte(),this.skipUEG(),100===t||110===t||122===t||144===t||244===t||44===t||83===t||86===t||118===t||128===t||138===t){let t=this.readUEG();if(3===t&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(n=3!==t?8:12,h=0;h<n;h++)this.readBoolean()&&(h<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();let p=this.readUEG();if(0===p)this.readUEG();else if(1===p)for(this.skipBits(1),this.skipEG(),this.skipEG(),s=this.readUEG(),h=0;h<s;h++)this.skipEG();return this.skipUEG(),this.skipBits(1),r=this.readUEG(),a=this.readUEG(),o=this.readBits(1),0===o&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(d=this.readUEG(),l=this.readUEG(),c=this.readUEG(),u=this.readUEG()),this.readBoolean()&&(this.readBoolean()&&255===this.readUByte()&&(this.readBits(16),this.readBits(16)),this.readBoolean()&&this.skipBits(1),this.readBoolean()&&(this.readBits(3),this.skipBits(1),this.readBoolean()&&(this.readUByte(),this.readUByte(),this.readUByte())),this.readBoolean()&&(this.readUEG(),this.readUEG())),{fps:0,width:16*(r+1)-2*d-2*l,height:(2-o)*(a+1)*16-(c+u)*(o?2:4)}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}};let Rt=function(){let t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();class Ot{constructor(){}static parseObject(t,e,i){let s=Ot.parseString(t,e),r=Ot.parseScript(t,e+s.size);return{data:{name:s.data,value:r.data},size:r.size}}static parseVariable(t,e,i){return Ot.parseObject(t,e,i)}static parseDate(t,e,i){if(i<10)throw new Error("Data size invalid when parse Date");let s=new DataView(t,e),r=s.getFloat64(0,!Rt);return r+=60*s.getInt16(8,!Rt)*1e3,{data:new Date(r),size:10}}static parseString(t,e){let i=new DataView(t,e),s=i.getUint16(0,!Rt),r="";if(s>0)for(let t=0;t<s;t++)r+=String.fromCharCode(i.getUint8(t+2));return{data:r,size:2+s}}static parseMetadata(t){let e=Ot.parseScript(t,0);return Ot.parseScript(t,e.size,t.length-e.size)}static parseScript(t,e,i){let s=e,r=new Uint8Array(t).buffer,a=new DataView(r,0,i),o=null,n=a.getUint8(s);switch(s+=1,n){case 0:o=a.getFloat64(s,!Rt),s+=8;break;case 1:o=!!a.getUint8(s),s+=1;break;case 2:{let t=Ot.parseString(r,s);o=t.data,s+=t.size;break}case 3:for(o={};s<i-3;){let t=Ot.parseObject(r,s,i-e);if(o[t.data.name]=t.data.value,s=t.size,0===a.getUint8(s)&&0===a.getUint8(s+1)&&9===a.getUint8(s+2)){s+=3;break}}break;case 8:for(o={},s+=4;s<i-8;){let t=Ot.parseVariable(r,s);o[t.data.name]=t.data.value,s=t.size}s<=i-3&&9==(16777215&a.getUint32(s-1,!Rt))&&(s+=3);break;case 10:{o=[];let t=a.getUint32(s,!Rt);s+=4;for(let e=0;e<t;e++){let t=Ot.parseScript(r,s);o.push(t.data),s=t.size}break}case 11:{let t=Ot.parseDate(r,s+1,i-1);o=t.data,s+=t.size;break}case 12:{let t=Ot.parseString(r,s+1);o=t.data,s+=t.size;break}default:s=i,console.log("AMF","Unsupported AMF value type "+n)}return{data:o,size:s}}static getStr(t,e,i){let s="";for(let r=0;r<i;r++)s+=String.fromCharCode(t[e++]);return s}}var Lt=Ot;class Mt{constructor(){this.fpsIndex=0,this.fpsArr=[],this.fpsMap=new Map,this.started=!1,this.realFps=0,this.recvFps=new O(20),this.jumpRecvFps=new O(2),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap=new Map,this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,this.preNoReferFrameNums=0,this.noReferSize=0,this.fpsList=[]}destroy(){X.remove(this.onFrameTimer,this),this.fpsArr=null,this.fpsMap&&this.fpsMap.clear(),this.fpsMap=null,this.recvFps&&this.recvFps.reset(),this.recvFps=null,this.jumpRecvFps&&this.jumpRecvFps.reset(),this.jumpRecvFps=null,this.perSecondArr=null,this.perSecondMap&&this.perSecondMap.clear(),this.perSecondMap=null,this.fpsList=null}getRecord(){let t=this.recvFrames-this.lastRecvFrames;return this.lastRecvFrames=this.recvFrames,t}reset(){this.fpsArr=[],this.fpsMap.clear(),this.started=!1,this.realFps=0,this.recvFps.reset(),this.jumpRecvFps.reset(),this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,X.remove(this.onFrameTimer,this),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap.clear(),this.fpsList.length=0}onFrameTimer(t,e){this.recvFps.calculate(),this.jumpRecvFps.calculate()}addDts(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.recvFrames++,this.recvFps.addCur(1),this.jumpRecvFps.addCur(1),this.started||(this.started=!0,X.add(this.onFrameTimer,this,1e3));let s=parseInt(t/1e3);if(this.fpsMap.has(s))this.fpsMap.set(s,this.fpsMap.get(s)+1);else{this.fpsIndex>=10&&(this.fpsIndex=0),this.calcRealFps();let t=this.fpsArr[this.fpsIndex];this.fpsList.length>=5&&this.fpsList.shift(),this.fpsMap.has(t)&&this.fpsList.push(this.fpsMap.get(t)),this.fpsMap.delete(t),this.fpsArr[this.fpsIndex]=s,this.fpsMap.set(s,1),this.fpsIndex++}e&&this.addDataSize(s,e),i===Te.IFRAME?(this.preRecvFrames>0&&(this.gopSize=this.recvFrames-this.preRecvFrames),this.preNoReferFrameNums>0&&(this.noReferSize=this.noReferFrameNums-this.preNoReferFrameNums),this.preRecvFrames=this.recvFrames,this.preNoReferFrameNums=this.noReferFrameNums):i===Te.NO_REFERENCE_FRAME&&this.noReferFrameNums++}calcNoRefFps(){if(0===this.noRefFps){let t=this.fpsArr[1];this.noRefFps=this.noRefFpsMap.get(t)}}calcRealFps(){if(this.fpsIndex>1){let t=this.fpsArr[this.fpsIndex-1];this.realFps=this.fpsMap.get(t)}}getRecvFps(){let t=this.recvFps.average();return t===R.b.UintMax?0:t}getJumRecvFps(){let t=this.jumpRecvFps.average();return t===R.b.UintMax?0:t}getFps(){if(this.fpsArr.length>1){let t=this.fpsArr[1],e=this.fpsMap.get(t),i=0,s=e;return Mt.FIXED_FPS.forEach(t=>{let r=t>e?t-e:e-t;r<3&&(0===i||r<i)&&(i=r,s=t)}),s}return 0}getCalculate(){this.recvFps.calculate()}getNoReferFps(){return this.noReferSize>0&&this.gopSize>0&&this.getFps()>0?parseInt(this.noReferSize/this.gopSize*this.getFps()):0}addDataSize(t,e){if(this.perSecondMap.has(t))this.perSecondMap.set(t,this.perSecondMap.get(t)+e);else{this.perSecondIndex>=10&&(this.perSecondIndex=0);const i=this.perSecondArr[this.perSecondIndex];this.perSecondMap.delete(i),this.perSecondArr[this.perSecondIndex]=t,this.perSecondMap.set(t,e),this.perSecondIndex++}}getRealBitrate(){let t=0;const e=this.perSecondArr.length;if(e>1){const i=this.perSecondArr[e-2];t=this.perSecondMap.get(i)}return parseInt(8*t/1e3)}getGopSize(){return this.gopSize}getHeartReceiveFps(){return this.fpsList.length>=5?this.fpsList.reduce((t,e)=>t+e)/this.fpsList.length:0}}Mt.FIXED_FPS=[0,15,20,24,30,40,48,60];var wt=Mt,Ft=new class{constructor(){this._ntp=new tt.NtpImpl(r)}start(){this._ntp.start(v.a.sGuid),X.add(this._onTimer,this,1e3)}wsTimeSync(){this._ntp.wsTimeSync()}_onTimer(t,e){this._ntp.onTimer(t)}getSyncTime(){return this._ntp.getSyncTime()}isFinishNtp(){return this._ntp.isFinishNtp()}},bt=class{constructor(t){this._split=t,this._str=""}isEmpty(){return""===this._str}addStr(t){this._str.length>0&&(this._str+=this._split),this._str+=t}getStr(){return this._str}};const Vt=[72,85,89,65,58],Nt=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],Bt={HUMEN:"00000001",DELAY:"00000200",VOLUME:"00000400",VOLUME1:"00000401",IFRAME:"00000600",DATACHANNEL:"00000230",HY_SDK_SEI_MULTI_RENDER:"00010001"};class kt{constructor(t){this._mse=t,this._protoHandler=new tt.SeiProtoHandler,this._proto=null,this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._curAnchorDelay=0,this._offset=0,this.initDts=0,this.initSeiDts=0}destroy(){this._mse=null,this._proto=null,this._protoHandler&&this._protoHandler.clear(),this._protoHandler=null}getStat(){if(0===this._delayCnt)return null;let t={fields:{},dims:{}};if(this._delayCnt>0&&(t.fields[d.a.CORE.DELAY_ANCHOR]=Math.floor(this._c2cDelaySum/this._delayCnt),t.fields[d.a.CORE.DELAY_SERVER]=Math.floor(this._svrDelaySum/this._delayCnt),t.fields[d.a.CORE.DELAY_NET]=Math.floor(this._netDelaySum/this._delayCnt),this._proto)){t.dims[d.a.CORE.UPLOADER_TYPE]=this._proto.anchorSei.uploadType+"",t.dims[d.a.CORE.ENCODER_SOURCE]=this._proto.anchorSei.encoderSource+"";let e=new bt(","),i=new bt(","),s=new bt(",");this._proto.serverSei.serverInfos.forEach(t=>{t.enable>0&&(e.addStr(t.getProxyIdStr()+"-"+t.proxyType),t.serverDelay>0&&t.serverDelay<1e4&&i.addStr(t.proxyType+":"+t.serverDelay),t.lastPeriodDelay>0&&t.lastPeriodDelay<1e4&&s.addStr(t.proxyType+":"+t.lastPeriodDelay))}),e.isEmpty()||(t.dims[d.a.CORE.DELAY_NODE_INFO]=e.getStr()),i.isEmpty()||(t.dims[d.a.CORE.SVR_DELAY_INFOS]=i.getStr()),s.isEmpty()||(t.dims[d.a.CORE.SVR_LAST_P_DELAY]=s.getStr())}return this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._proto=null,t}_record(t,e){this._proto=e;let i=Ft.getSyncTime(),s=t-e.serverSei.dtsGapSum-e.anchorSei.frameDts,r=i-e.anchorSei.sendFrameTime-s;if(this.initSeiDts!=e.anchorSei.frameDts&&(this._mse.offsetDts=t-e.anchorSei.frameDts),this.initSeiDts=e.anchorSei.frameDts,0<r&&r<3e4){const t=i-e.anchorSei.caputureTime-s;this._netDelaySum+=r,this._c2cDelaySum+=t,this._svrDelaySum+=r-e.serverSei.delaySum,this._delayCnt++,this._curAnchorDelay=t||this._curAnchorDelay,this._curAnchorDelay>3e5&&(this._curAnchorDelay=0),this._mse.setSeiDelay(this._curAnchorDelay)}}parseSei(t,e,i,s){if(t+=this.initDts,this._offset=0,i==kt.H265_CODEC_TYPE?(e=this._nalUintExtractRbsp(e),this._offset+=2):i==kt.AV1_CODEC_TYPE||(this._offset+=1),this._getValue(e),this._getValue(e),this._getH265Len(e),this._isHuya(e)){let i=e.subarray(this._offset),r=this._getType(i);if(s[r]=1,this._mse.saveSeiInfo(t,i,r),r===Bt.DELAY)this._parseDelay(t,i);else if(r===Bt.HUMEN)this._mse.saveH264SeiData(t,i);else if(r===Bt.VOLUME){let e=this._getStr(i);this._mse.scriptVolumeInfos.addMixAudio(e,t)}else if(r===Bt.VOLUME1){let e=this._getStrVolume1(i);this._mse.scriptVolumeInfos.addMixAudio(e,t)}else if(r===Bt.DATACHANNEL)this._parseDataChannel(t,i);else if(r===Bt.HY_SDK_SEI_MULTI_RENDER){let e=this._parseMutiRender(t,i);this._mse.updateMultiRenderInfo&&this._mse.updateMultiRenderInfo(e)}}}_nalUintExtractRbsp(t){let e=new Uint8Array(t.length),i=t.length,s=0,r=0;for(;s+2<i;)t[s]||t[s+1]||3!==t[s+2]?e[r++]=t[s++]:(e[r++]=t[s++],e[r++]=t[s++],s++);for(;s<i;)e[r++]=t[s++];return e.subarray(0,r)}_getStr(t){let e=t.length,i=new Uint8Array(t.length);for(let s=0;s<e;s++)i[s]=t[s];e=this._getLength(t)+8+16+2;let s=new DataView(i.buffer);return this._readVolume(s,e,26)}_readVolume(t,e,i){let s=[];for(;i+9<=e;){let e=4294967296*t.getUint32(i,!1)+t.getUint32(i+4,!1),r=t.getUint8(i+8);s.push(e+"_"+r),i+=9}return s.join(",")}_getStrVolume1(t){let e=this._getStrChar(t),i=this._getStrCode(e),s=new DataView(i.buffer);return this._readVolume(s,i.length,0)}_getStrChar(t){let e=this._getLength(t)+8+16+2,i="";for(let s=26;s<e;s++)i+=String.fromCharCode(t[s]);return atob(i)}_getStrCode(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}_getLength(t){let e="";for(let i=9;i<26;i++)e+=String.fromCharCode(t[i]);return parseInt(e)}_getValue(t){let e=0,i=t.length;for(;this._offset<i;){if(e+=t[this._offset],255!==t[this._offset]){this._offset++;break}this._offset++}return e}_parseMutiRender(t,e){let i=e.length,s="";for(let t=26;t<i-1;t++)s+=String.fromCharCode(e[t]);let r=atob(s),a=new Uint8Array(26);for(let t=0;t<r.length;t++)a[t]=r.charCodeAt(t);return a}_parseDataChannel(t,e){let i=Number(this._getDataChannelPortStr(e)),s=this._getDataChannelStr(e);this._mse.saveSeiDataChannel(t,i,s,e),n.a.log("getDataChannelStr",s,"portStr",i)}_getDataChannelPortStr(t){let e="";for(let i=0;i<10;i++)e+=String.fromCharCode(t[i+26]);return e}_getDataChannelStr(t){let e="",i=this._getPayloadLen(t);for(let s=0;s<i;s++)e+=String.fromCharCode(t[s+62]);return e=decodeURIComponent(escape(e)),e}_parseDelay(t,e){if(!Ft.isFinishNtp())return;let i=this._decodeData(e),s=i.length,r=new DataView(i.buffer),a=0;for(;a+10<s;){let e=r.getUint32(a,!0),o=r.getUint32(a+4,!0);if(0===e||e>s)break;if(o===tt.ProtoUri.HuyaDelaySeiData){let s=new DataView(i.buffer,a,e),r=this._protoHandler.unmarshall(o,s);this._record(t,r)}a+=e}}_decodeData(t){let e=this._decodeBase64(t),i=e.length,s=new Uint8Array(i);for(let t=0;t<i;t++)s[t]=e.charCodeAt(t);return s}_decodeBase64(t){let e="",i=this._getPayloadLen(t);for(let s=0;s<i;s++)e+=String.fromCharCode(t[s+26]);return e=atob(e),e}_getPayloadLen(t){let e="";for(let i=0;i<16;i++)e+=String.fromCharCode(t[i+9]);return parseInt(e)}_getType(t){let e="";for(let i=0;i<8;i++)e+=String.fromCharCode(t[i]);return e}_getH265Len(t){let e=0;for(let i=0;i<16&&t[this._offset]===Nt[i];i++)this._offset++,e++;return e}_isHuya(t){for(let e=0;e<5;e++){if(t[this._offset]!==Vt[e])return!1;this._offset++}return!0}}kt.H264_CODEC_TYPE=0,kt.H265_CODEC_TYPE=1,kt.AV1_CODEC_TYPE=2,kt.SEI_TYPES=Bt;var Ut=kt;class xt extends tt.ListenerImpl{}var Ht=xt,Wt=class{constructor(t){this._bytes=t,this._bitIndex=0,this._bitLen=8*t.byteLength}getBits(t){var e=Math.floor(this._bitIndex/8),i=8-this._bitIndex%8,s=this._bytes[e]&(1<<i)-1;if(t<=i)return this._bitIndex+=t,s>>>i-t;var r=t-i;return this._bitIndex+=i,(s<<r|this.getBits(r))>>>0}skipBits(t){this._bitIndex+=t}getBytes(t){if(this._bitIndex%8!=0)throw new Error("can't get bytes from mid-byte: bit index="+this._bitIndex);var e=Math.floor(this._bitIndex/8);return this._bitIndex+=8*t,this._bytes.subarray(e,e+t)}get bytePosition(){return Math.floor(this._bitIndex/8)}get bitposition(){return this._bitIndex}};class Gt{constructor(){}static leb128(t){let e=0;for(let i=0;i<8;i++){let s=t.getBits(8);if(e|=(127&s)<<7*i,!(128&s))break}return e}static parseOBUHeader(t){let e={},i=t.bits;return e.obu_forbidden_bit=i.getBits(1),e.obu_type=i.getBits(4),e.obu_extension_flag=i.getBits(1),e.obu_has_size_field=i.getBits(1),e.obu_reserved_1bit=i.getBits(1),1==e.obu_extension_flag&&(e.temporal_id=i.getBits(3),e.spatial_id=i.getBits(2),e.extension_header_reserved_3bits=i.getBits(3)),e}static uvlc(t){for(var e=0;!t.getBits(1);)++e;return e>=32?0:t.getBits(e)+(1<<e)-1}static color_config(t){var e={};return e.high_bitdepth=t.getBits(1),2==e.seq_profile&&e.high_bitdepth?(e.twelve_bit=t.getBits(1),e.BitDepth=e.twelve_bit?12:10):e.BitDepth=e.high_bitdepth?10:8,1==e.seq_profile?e.mono_chrome=0:e.mono_chrome=t.getBits(1),e.color_description_present_flag=t.getBits(1),e.color_description_present_flag?(e.color_primaries=t.getBits(8),e.transfer_characteristics=t.getBits(8),e.matrix_coefficients=t.getBits(8)):(e.color_primaries=Gt.CP_UNSPECIFIED,e.transfer_characteristics=Gt.TC_UNSPECIFIED,e.matrix_coefficients=Gt.MC_UNSPECIFIED),e.mono_chrome?(e.color_range=t.getBits(1),e.subsampling_x=1,e.subsampling_y=1,e.chroma_sample_position=Gt.CSP_UNKNOWN,e.separate_uv_delta_q=0,e):(e.color_primaries==Gt.CP_BT_709&&e.transfer_characteristics==Gt.TC_SRGB&&e.matrix_coefficients==Gt.MC_IDENTITY?(e.color_range=1,e.subsampling_x=0,e.subsampling_y=0):(e.color_range=t.getBits(1),0==e.seq_profile?(e.subsampling_x=1,e.subsampling_y=1):1==e.seq_profile?(e.subsampling_x=0,e.subsampling_y=0):12==e.BitDepth?(e.subsampling_x=t.getBits(1),e.subsampling_x?e.subsampling_y=t.getBits(1):e.subsampling_y=0):(e.subsampling_x=1,e.subsampling_y=0),e.subsampling_x&&e.subsampling_y&&(e.chroma_sample_position=t.getBits(2))),e.separate_uv_delta_q=t.getBits(1),e)}static metadata_obu(t,e){let i={},s=t.bits;if(i.metadata_type=Gt.leb128(s),i.metadata_type==Gt.METADATA_TYPE_ITUT_T35){i.itu_t_t35_country_code=s.getBits(8),255==i.itu_t_t35_country_code&&(i.itu_t_t35_country_code_extension_byte=s.getBits(8));var r=(8*e-s.bitposition)/8;i.itu_t_t35_payload_bytes=s.getBytes(r)}else if(i.metadata_type==Gt.METADATA_TYPE_HDR_CLL)i.max_cll=s.getBits(16),i.max_fall=s.getBits(16);else if(i.metadata_type==Gt.METADATA_TYPE_HDR_MDCV){i.primary_chromaticity_x=[],i.primary_chromaticity_y=[];for(let t=0;t<3;t++)i.primary_chromaticity_x[t]=s.getBits(16),i.primary_chromaticity_y[t]=s.getBits(16);i.white_point_chromaticity_x=s.getBits(16),i.white_point_chromaticity_y=s.getBits(16),i.luminance_max=s.getBits(32),i.luminance_min=s.getBits(32)}else if(i.metadata_type==Gt.METADATA_TYPE_SCALABILITY){if(i.scalability_mode_idc=s.getBits(8),i.scalability_mode_idc==Gt.SCALABILITY_SS){if(i.spatial_layers_cnt_minus_1=s.getBits(2),i.spatial_layer_dimensions_present_flag=s.getBits(1),i.spatial_layer_description_present_flag=s.getBits(1),i.temporal_group_description_present_flag=s.getBits(1),i.scalability_structure_reserved_3bits=s.getBits(3),i.spatial_layer_dimensions_present_flag)for(let t=0;t<=i.spatial_layers_cnt_minus_1;t++)i.spatial_layer_max_width[t]=s.getBits(16),i.spatial_layer_max_height[t]=s.getBits(16);if(i.spatial_layer_description_present_flag)for(let t=0;t<=i.spatial_layers_cnt_minus_1;t++)i.spatial_layer_ref_id[t]=s.getBits(8);if(i.temporal_group_description_present_flag){i.temporal_group_size=s.getBits(8);for(let t=0;t<i.temporal_group_size;t++){i.temporal_group_temporal_id[t]=s.getBits(3),i.temporal_group_temporal_switching_up_point_flag[t]=s.getBits(1),i.temporal_group_spatial_switching_up_point_flag[t]=s.getBits(1),i.temporal_group_ref_cnt[t]=s.getBits(3);for(let e=0;e<temporal_group_ref_cnt[t];e++)i.temporal_group_ref_pic_diff[t][e]=s.getBits(8)}}}}else i.metadata_type==Gt.METADATA_TYPE_TIMECODE&&(i.counting_type=s.getBits(5),i.full_timestamp_flag=s.getBits(1),i.discontinuity_flag=s.getBits(1),i.cnt_dropped_flag=s.getBits(1),i.n_frames=s.getBits(9),i.full_timestamp_flag?(i.seconds_value=s.getBits(6),i.minutes_value=s.getBits(6),i.hours_value=s.getBits(5)):(i.seconds_flag=s.getBits(1),i.seconds_flag&&(i.seconds_value=s.getBits(6),i.minutes_flag=s.getBits(1),i.minutes_flag&&(i.minutes_value=s.getBits(6),i.hours_flag=s.getBits(1),i.hours_flag&&(i.hours_value=s.getBits(5))))),i.time_offset_length=s.getBits(5),i.time_offset_length>0&&(i.time_offset_value=s.getBits(i.time_offset_length)));return i}static sequence_header_obu(t){let e={},i=t.bits;if(e.seq_profile=i.getBits(3),e.still_picture=i.getBits(1),e.reduced_still_picture_header=i.getBits(1),e.reduced_still_picture_header)e.timing_info_present_flag=0,e.decoder_model_info_present_flag=0,e.initial_display_delay_present_flag=0,e.operating_points_cnt_minus_1=0,e["operating_point_idc[0]"]=0,e["seq_level_idx[0]"]=i.getBits(5),e["seq_tier[0]"]=0,e["decoder_model_present_for_this_op[0]"]=0,e["initial_display_delay_present_for_this_op[0]"]=0;else{e.timing_info_present_flag=i.getBits(1),e.timing_info_present_flag?(e.num_units_in_display_tick=i.getBits(32),e.time_scale=i.getBits(32),e.equal_picture_interval=i.getBits(1),e.equal_picture_interval&&(e.num_ticks_per_picture_minus_1=Gt.uvlc(i)),e.decoder_model_info_present_flag=i.getBits(1),e.decoder_model_info_present_flag&&(e.buffer_delay_length_minus_1=i.getBits(5)),e.num_units_in_decoding_tick=i.getBits(32),e.buffer_removal_time_length_minus_1=i.getBits(5),e.frame_presentation_time_length_minus_1=i.getBits(5),e.initial_display_delay_present_flag=i.getBits(1),e.operating_points_cnt_minus_1=i.getBits(5)):(e.decoder_model_info_present_flag=0,e.initial_display_delay_present_flag=i.getBits(1),e.operating_points_cnt_minus_1=i.getBits(5));for(var s=0;s<=e.operating_points_cnt_minus_1;s++){if(e["operating_point_idc["+s+"]"]=i.getBits(12),e["seq_level_idx["+s+"]"]=i.getBits(5),e["seq_level_idx["+s+"]"]>7?e["seq_tier["+s+"]"]=i.getBits(1):e["seq_tier["+s+"]"]=0,e.decoder_model_info_present_flag){if(e["decoder_model_present_for_this_op["+s+"]"]=i.getBits(1),e["decoder_model_present_for_this_op["+s+"]"]){var r=e.buffer_delay_length_minus_1+1;e["decoder_buffer_delay["+s+"]"]=i.getBits(r),e["encoder_buffer_delay["+s+"]"]=i.getBits(r),e["low_delay_mode_flag["+s+"]"]=i.getBits(1)}}else e["decoder_model_present_for_this_op["+s+"]"]=0;e.initial_display_delay_present_flag&&(e["initial_display_delay_present_for_this_op["+s+"]"]=i.getBits(1)),e["initial_display_delay_present_for_this_op["+s+"]"]&&(e["initial_display_delay_minus_1["+s+"]"]=i.getBits(4))}}return e.frame_width_bits_minus_1=i.getBits(4),e.frame_height_bits_minus_1=i.getBits(4),e.max_frame_width_minus_1=i.getBits(e.frame_width_bits_minus_1+1),e.max_frame_height_minus_1=i.getBits(e.frame_height_bits_minus_1+1),e.reduced_still_picture_header?e.frame_id_numbers_present_flag=0:e.frame_id_numbers_present_flag=i.getBits(1),e.frame_id_numbers_present_flag&&(e.delta_frame_id_length_minus_2=i.getBits(4),e.additional_frame_id_length_minus_1=i.getBits(3)),e.use_128x128_superblock=i.getBits(1),e.enable_filter_intra=i.getBits(1),e.enable_intra_edge_filter=i.getBits(1),e.reduced_still_picture_header?(e.enable_interintra_compound=0,e.enable_masked_compound=0,e.enable_warped_motion=0,e.enable_dual_filter=0,e.enable_order_hint=0,e.enable_jnt_comp=0,e.enable_ref_frame_mvs=0,e.seq_force_screen_content_tools=Gt.SELECT_SCREEN_CONTENT_TOOLS,e.seq_force_integer_mv=1,e["#OrderHintBits"]=0):(e.enable_interintra_compound=i.getBits(1),e.enable_masked_compound=i.getBits(1),e.enable_warped_motion=i.getBits(1),e.enable_dual_filter=i.getBits(1),e.enable_order_hint=i.getBits(1),e.enable_order_hint&&(e.enable_jnt_comp=i.getBits(1),e.enable_ref_frame_mvs=i.getBits(1)),e.seq_choose_screen_content_tools=i.getBits(1),e.seq_choose_screen_content_tools?e.seq_force_screen_content_tools=Gt.SELECT_SCREEN_CONTENT_TOOLS:e.seq_force_screen_content_tools=i.getBits(1),e.seq_force_screen_content_tools>0&&(e.seq_choose_integer_mv=i.getBits(1),e.seq_choose_integer_mv?e.seq_force_integer_mv=1:e.seq_force_integer_mv=i.getBits(1)),e.enable_order_hint?(e.order_hint_bits_minus_1=i.getBits(3),e["#OrderHintBits"]=e.order_hint_bits_minus_1+1):e["#OrderHintBits"]=0,e.enable_superres=i.getBits(1),e.enable_cdef=i.getBits(1),e.enable_restoration=i.getBits(1),Object.assign(e,Gt.color_config(i)),e.film_grain_params_present=i.getBits(1)),e}static parseOBU(t,e,i,s){let r={bits:new Wt(t)},a=0;for(;t.length-a>1;){let o;o=Gt.parseOBUHeader(r),1==o.obu_extension_flag&&a++;let n=0,h=t.length-a;if(n=o.obu_has_size_field?Gt.leb128(r.bits):h-1-o.obu_extension_flag,o.obu_type==Gt.OBU_SEQUENCE_HEADER&&i)i(Gt.sequence_header_obu(r));else if(o.obu_type==Gt.OBU_METADATA&&s){let t=Gt.metadata_obu(r,r.bits.bytePosition+n);t.itu_t_t35_payload_bytes&&s(e,t)}else r.bits.skipBits(8*n);a=r.bits.bytePosition}}static zeroPad(t,e,i){t||(t=0),void 0===i&&(i=10);for(var s=t.toString(i);s.length<e;)s="0"+s;return s}}Gt.OBU_SEQUENCE_HEADER=1,Gt.OBU_TEMPORAL_DELIMITER=2,Gt.OBU_FRAME_HEADER=3,Gt.OBU_TILE_GROUP=4,Gt.OBU_METADATA=5,Gt.OBU_FRAME=6,Gt.OBU_REDUNDANT_FRAME_HEADER=7,Gt.OBU_TILE_LIST=8,Gt.OBU_PADDING=15,Gt.SELECT_SCREEN_CONTENT_TOOLS=2,Gt.CP_BT_709=1,Gt.CP_UNSPECIFIED=2,Gt.TC_SRGB=13,Gt.TC_UNSPECIFIED=2,Gt.MC_IDENTITY=0,Gt.MC_UNSPECIFIED=2,Gt.CSP_UNKNOWN=0,Gt.METADATA_TYPE_HDR_CLL=1,Gt.METADATA_TYPE_HDR_MDCV=2,Gt.METADATA_TYPE_SCALABILITY=3,Gt.METADATA_TYPE_ITUT_T35=4,Gt.METADATA_TYPE_TIMECODE=5,Gt.SCALABILITY_SS=14;var Yt=Gt,qt=class{constructor(t){this.hasSample=!1,this.samples=new O(t)}destroy(){this.samples&&this.samples.reset(),this.samples=null}getSamples(){return this.samples.getSamples()}addCur(t,e){this.hasSample=!0}getResult(){let t=[],e=this.samples.getSamples(),i=e.length;if(i>0){t.push("size:"+i);for(let s=0;s<i;s++)t.push("".concat(i-s,":").concat(e[s]))}return t.join(",")}reset(){let t=this.samples.cur;this.samples.reset(),this.samples.addCur(t)}},Kt=class extends qt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100),this.lastTs=0}addCur(t,e){super.addCur(t,e);let i=parseInt(e/1e3);this.lastTs>0&&this.lastTs!==i&&this.samples.calculate(),this.lastTs=i,this.samples.addCur(t)}},jt=class{constructor(){this.aSample=new Kt(20),this.vSample=new Kt(20),this.aAutoSample=new Kt(20),this.vAutoSample=new Kt(20)}destroy(){this.aSample&&this.aSample.destroy(),this.vSample&&this.vSample.destroy(),this.aAutoSample&&this.aAutoSample.destroy(),this.vAutoSample&&this.vAutoSample.destroy(),this.aSample=null,this.vSample=null,this.aAutoSample=null,this.vAutoSample=null}addAudioSample(t,e){this.aSample.addCur(t,e),this.aAutoSample.addCur(t,e)}addVideoSample(t,e){this.vSample.addCur(t,e),this.vAutoSample.addCur(t,e)}getResult(){let t=[],e=this.aSample.getSamples(),i=this.vSample.getSamples(),s=Math.min(i.length,e.length);if(s>0){t.push("size:".concat(s));for(let r=0;r<s;r++)t.push("".concat(s-r,":").concat(i[r]+e[r]))}return t.join(",")}reset(){this.aSample.reset(),this.vSample.reset()}getAutoSamples(){let t={aSamples:this.aAutoSample.getSamples(),vSamples:this.vAutoSample.getSamples()};return this.aAutoSample.reset(),this.vAutoSample.reset(),t}recordStat(t){let e=this.getResult();""!==e&&(this.reset(),t.setCoreDim(d.a.CORE.REAL_KBPS_SAMPLE,e))}},zt=class{constructor(t){this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.discardGap=0,this.minFps=1e3,this.corePlayer=t,this.info=null,this.isRandom=!1}destroy(){this.corePlayer=null,this.info=null}setConfig(t){this.dropTime=t.dropTime||0;let e=t.minFps||1e3;this.minFps=Math.max(e,parseInt(2*this.realFps/3))}setInfo(t){this.info=t;let e=!0;this.info&&(e=R.b.getSdkAbRandom(this.info,o.a.dropFrameAb)),this.isRandom=e}reset(){this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.isRandom=!1}start(){n.a.log("DropFrameController.start"),this.started=!0}stop(){this.started=!1}setRealFps(t){t>0&&0===this.realFps&&(this.realFps=t,this.minFps=Math.max(this.minFps,parseInt(2*t/3)),this.maxDropCnt=Math.max(0,t-this.minFps),n.a.log("DropFrameController.setRealFps fps=".concat(t," minFps=").concat(this.minFps," maxDrop=").concat(this.maxDropCnt)))}isCanDrop(t,e,i){if(!this.isRandom)return;if(this.corePlayer.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS)return;if(this.corePlayer.bitrate<o.a.perfBitrate)return;if(this.corePlayer.h265Proxy&&this.corePlayer.h265Proxy.isReady)return;if(this.corePlayer.getBufferLen()<=2e3)return;let s=this.corePlayer.renderList;if(s.length<10)return;let r=0;s.forEach(t=>{r+=t});let a=Math.floor(r/s.length),n=~~(1e3/this.realFps*2);return a<=~~(.5*this.realFps)?this.discardGap=n:a<=~~(.6*this.realFps)?this.discardGap=~~(1.3*n):a<=~~(.7*this.realFps)?this.discardGap=~~(1.6*n):a<=~~(.8*this.realFps)?this.discardGap=2*n:a<=~~(.9*this.realFps)&&(this.discardGap=3*n),!e&&0==(96&i)&&(0===this.lastDropDts||t-this.lastDropDts>=this.discardGap)&&(this.lastDropDts=t,!0)}};class Jt{constructor(){this.totalTime=0,this.frameNum=0}}var Qt=class{constructor(){this.started=!1,this.lastCheckTs=0,this.seg=new Jt,this.segList=[],this.segSize=10}destroy(){this.seg=null,this.segList=null,X.remove(this.onCheckFrameRate,this)}getSize(){return this.segList.length}addFrame(){let t=_.a.now();this.started||(this.started=!0,this.lastCheckTs=t,X.add(this.onCheckFrameRate,this,200)),this.seg.frameNum++,this.onCheckFrameRate(t)}reset(){this.started=!1,this.lastCheckTs=0,this.seg=new Jt,this.segList=[],X.remove(this.onCheckFrameRate,this)}onCheckFrameRate(t){if(this.lastCheckTs>0&&this.seg){let e=t-this.lastCheckTs;e>=1e3&&(this.seg.totalTime=e,this.segList.push(this.seg),this.segList.length>this.segSize&&this.segList.shift(),this.seg=new Jt,this.lastCheckTs=t)}}isDownEnough(t){return t>0&&this.segList.length>0&&this.getAvg()>.9*t}getAvg(){return this.getLastRate(this.segList.length)}getLastRate(t){let e=0,i=0,s=this.segList.length;t=Math.min(t,s);for(let r=s-1;r>=0;r--){let s=this.segList[r];if(e+=s.frameNum,i+=s.totalTime,--t<=0)break}return i>0?e/i*1e3:0}},Xt=class{constructor(){this.m_idx=0,this.m_data=null,this.m_len=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}destroy(){this.m_data=null}init(t,e){this.m_data=t,this.m_len=e,this.m_idx=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}getByte(){if(this.m_idx>=this.m_len)return 0;let t=this.m_data[this.m_idx++];return 0==t?(this.m_zeros++,this.m_idx<this.m_len&&2==this.m_zeros&&3==this.m_data[this.m_idx]&&(this.m_idx++,this.m_zeros=0)):this.m_zeros=0,t}getBit(){return 0==this.m_bits&&(this.m_byte=this.getByte(),this.m_bits=8),this.m_bits--,this.m_byte>>this.m_bits&1}getWord(t){let e=0;for(;t>0;)e<<=1,e|=this.getBit(),t--;return e}getUe(){let t=0;for(;this.m_idx<this.m_len&&0==this.getBit();)t++;let e=(1<<t)-1;return 31==t?0:(t>0&&(e+=this.getWord(t)),e)}getSe(){let t=this.getUe(),e=t+1>>1;return 1&t||(e=-e),e}parseSequenceParameterSet(t,e,i){if(e<20)return!1;this.init(t,e),this.getWord(16);let s=this.getWord(4);i.sps_video_parameter_set_id=s;let r=this.getWord(3);i.sps_max_sub_layers_minus1=r,s=this.getWord(1),i.temporal_id_nesting_flag=s,this.hevc_parse_profile_tier_level(i,r);let a=this.getUe();i.sps_seq_parameter_set_id=a;let o=this.getUe();i.chroma_format_idc=o;let h=0;3==o&&(h=s=this.getWord(1)),i.separate_colour_plane_flag=h;let d=this.getUe(),l=this.getUe();n.a.log("HevcSpsParser.parseSequenceParameterSet', ue_width=".concat(d,", ue_height=").concat(l));let c=0,u=0,p=0,m=0;this.getWord(1)&&(c=this.getUe(),u=this.getUe(),p=this.getUe(),m=this.getUe());let _=1!=o&&2!=o||0!=h?1:2,f=1==o&&0==h?2:1;return d-=_*u+_*c,l-=f*m+f*p,i.width=d,i.height=l,this.getUe()==this.getUe()}hevc_parse_profile_tier_level(t,e){if(this.hevc_parse_profile_tier_level_common(t,1,1,1),0==e)return;let i=[],s=[];i[6]={},s[6]={};for(let t=0;t<e;t++)i[t]=this.getWord(1),s[t]=this.getWord(1);if(e>0)for(let t=e;t<8;t++)this.getWord(2);t.sub_layer=[];for(let r=0;r<e;r++)t.sub_layer[r]={},this.hevc_parse_profile_tier_level_common(t.sub_layer[r],i[r],s[r],0)}hevc_parse_profile_tier_level_common(t,e,i,s){e&&(t.profile_space=this.getWord(2),t.tier_flag=this.getWord(1),t.profile_idc=this.getWord(5),t.profile_compatibility_flags=this.getWord(32),t.progressive_source_flag=this.getWord(1),t.interlaced_source_flag=this.getWord(1),t.non_packed_constraint_flag=this.getWord(1),t.frame_only_constraint_flag=this.getWord(1),t.reserved_zero_44bits=this.getWord(44)),i&&(t.level_idc=this.getWord(8))}};const $t=1,Zt=2,te=1,ee=3,ie=4;var se=class{constructor(t,e){this.corePlayer=t,this.parser=e,this.dropLevel=0,this.open=!1,this.started=!1,this.dropFrames=0,this.lastDropFrames=0,this.lastDropTs=0,this.realFps=0,this.discardGap=0,this.lastDropDts=0,this.dropRenderLevel=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0,this.dropRenderLevel=!1,this.isRenderDrop=!1}destroy(){this.corePlayer=null,this.parser=null}setRealFps(t){t>0&&0===this.realFps&&(this.realFps=t,n.a.log("DropFrameByDts.setRealFps fps=".concat(t)))}getRecrod(){const t=_.a.now()-this.lastDropTs,e=Math.round(t/1e3),i=this.dropFrames-this.lastDropFrames,s=Math.round(i/e);return this.lastDropFrames=this.dropFrames,this.lastDropTs=_.a.now(),s<0?0:s}start(){let t=(D.a.browser+"").toLowerCase();"safari"===t?n.a.log("DropFrameDts.start fail browser=".concat(t)):(n.a.log("DropFrameDts.start"),this.started=!0,this.lastDropTs=_.a.now())}stop(){this.started=!1}reset(){this.dropLevel=0,this.dropFrames=0,this.lastDropFrames=0,this.realFps=0,this.lastDropDts=0,this.dropRenderLevel=0,this.discardGap=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0}isCanDrop(t,e,i){if(1==o.a.isCloseMseDrop)return;if(1!=o.a.isLimitNaluType)return;if(!this.open||!this.started||this.corePlayer.webcodecType!==N.a.PLAYER_CORE_TYPE.MSE||this.corePlayer.isPureAudio)return!1;if(1==f.a._closeDrop)return!1;let s=this.corePlayer.renderList;if(s.length>=5&&this.getDisCardCfg(s),e)0!==this.dropLevel&&n.a.log("DropFrameByDts.dropFrames level=".concat(this.dropLevel," dromNum=").concat(this.dropFrames)),this.dropLevel=0;else{let e=this.corePlayer.getBufferLen(),s=0;if(s=o.a.dtsJumpOpen?t-this.corePlayer.getCorrentCurrentDts():t-this.corePlayer.getCurrentRealTime(),this.dropLevel<2&&s>=o.a.dropFrameDts[1]&&e<.5*o.a.dropFrameDts[1]?(this.dropLevel=2,n.a.log("DropFrameByDts.dropFrame level=2 buffer=".concat(e," gap=").concat(s))):this.dropLevel<1&&s>=o.a.dropFrameDts[0]&&e<.7*o.a.dropFrameDts[0]&&(this.dropLevel=1,n.a.log("DropFrameByDts.dropFrame level=1 buffer=".concat(e," gap=").concat(s))),2===this.dropLevel)return this.dropFrames++,this.lastDropDts=t,!0;if(1===this.dropLevel&&0==(96&i))return this.dropFrames++,this.lastDropDts=t,!0;if(e<=1e3)return 2==f.a._printMseDropInfo&&n.a.log("DropFrameByDts buffer <= 1000"),!1;if(!this.corePlayer.isSupportRequestVideoFrameCallback())return!1;if(this.isRenderDrop&&0==(96&i)&&t-this.lastDropDts>=this.discardGap)return this.lastDropDts=t,this.dropFrames++,this.dropLevel=3,!0}return!1}getDisCardCfg(t){const e=_.a.now();if(0!=this.lastCheckDisCardTs&&e-this.lastCheckDisCardTs<1e3)return;this.checkDiscardTimes++,this.lastCheckDisCardTs=e;let i=0,s=0,r=!1,a=0,o=0,h=0;if(0==this.realFps)return;let d=this.parser.fps.getHeartReceiveFps();t.forEach(t=>{i+=t}),a=Math.floor(i/t.length),0!=d&&(h=Math.floor(a/d*100)/100),o=this.realFps,Number(f.a._forceDropFrame)>0&&(o=Number(f.a._forceDropFrame));let l=Math.floor(a/o*100)/100;const c=~~(1e3/o*2),u=3*c,p=2*c,m=~~(1.6*c),g=~~(1.3*c),S=c,y=~~(.9*o),T=~~(.8*o),P=~~(.7*o),v=~~(.6*o),E=~~(.5*o);h>=.9&&1!=f.a._forceMseDropReal?(h>=.95&&this.checkDiscardTimes%10==0?1==this.dropRenderLevel?(r=!1,s=0):2==this.dropRenderLevel?(this.discardGap=u,s=1,r=!0):3==this.dropRenderLevel?(this.discardGap=p,s=2,r=!0):4==this.dropRenderLevel?(this.discardGap=m,s=3,r=!0):5==this.dropRenderLevel&&(this.discardGap=g,s=4,r=!0):(s=0,r=!1),1==f.a._printMseDropInfo&&n.a.log("DropFrameByDts.getDisCardCfg.realRate back,lastDropLevel=".concat(this.dropRenderLevel,",isRenderDropLevel=").concat(s,",isRenderDrop=").concat(r,",realRenderRate=").concat(h,",fpsRenderRate=").concat(l,",renderSec=").concat(a,",heartReceiveFps=").concat(d))):(a<=y&&a>T?(this.discardGap=u,s=1,r=!0):a<=T&&a>P?(this.discardGap=p,s=2,r=!0):a<=P&&a>v?(this.discardGap=m,s=3,r=!0):a<=v&&a>E?(this.discardGap=g,s=4,r=!0):a<=E?(this.discardGap=S,s=5,r=!0):(s=this.dropRenderLevel,r=this.isRenderDrop),1==f.a._printMseDropInfo&&n.a.log("DropFrameByDts.getDisCardCfg.realFps,lastDropLevel=".concat(this.dropRenderLevel,",isRenderDropLevel=").concat(s,",isRenderDrop=").concat(r,",realRenderRate=").concat(h,",fpsRenderRate=").concat(l,",renderSec=").concat(a,",heartReceiveFps=").concat(d))),this.dropRenderLevel=s,this.isRenderDrop=r}destroy(){this.corePlayer=null,this.parser=null,this.isRenderDrop=!1}};class re{constructor(t){this.next=null,this.prev=null,this.data=t}}var ae=class{constructor(){this.size=0,this.head=null,this.freeChainSize=0,this.freeChain=null,this.travelNode=null}resetTravel(){this.travelNode=this.head}travel(){if(null===this.travelNode&&(this.travelNode=this.head,null===this.travelNode))return null;let t=this.travelNode.data;return this.travelNode=this.travelNode.next,this.travelNode===this.head||null===this.travelNode?null:t}reset(){this.resetTravel();let t=null,e=null;for(t=this.head;null!=t;)e=t,t=t.next,e.data=null,e.prev=null,e.next=null,t===this.head&&(t=null);for(this.head=null,t=this.freeChain;null!=t;)e=t,t=t.next,e.data=null,e.prev=null,e.next=null;this.freeChain=null,this.size=0,this.freeChainSize=0}put(t){let e=this.getFree(t);if(this.size++,null===this.head)e.prev=e,e.next=e,this.head=e;else if(e.data.key<this.head.data.key)e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let t=this.head.prev;for(;e.data.key<t.data.key;)t=t.prev;if(e.data.key===t.data.key)return this.size--,this.putFree(e),!1;e.prev=t,e.next=t.next,e.prev.next=e,e.next.prev=e}return!0}put2(t){let e=this.getFree(t);if(this.size++,null===this.head)e.prev=e,e.next=e,this.head=e;else if(e.data.key<this.head.data.key)e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let t=this.head;for(;e.data.key>t.data.key&&(t=t.next,t!==this.head););if(e.data.key===t.data.key)return this.size--,this.putFree(e),!1;e.prev=t.prev,e.next=t,t.prev.next=e,t.prev=e}return!0}get(){if(null===this.head)return null;let t=this.head,e=t.data;return this.size--,0===this.size?this.head=null:(t.prev.next=t.next,t.next.prev=t.prev,this.head=this.head.next),this.putFree(t),e}peek(){return null===this.head?null:this.head.data}peekLast(){return null===this.head?null:this.head.prev.data}getOrNewNode(t){let e=null;if(null===this.head)this.size++,e=this.getFree(null),e.prev=e,e.next=e,this.head=e;else if(t<this.head.data.key)this.size++,e=this.getFree(null),e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let i=this.head.prev;for(;t<i.data.key;)i=i.prev;i.data.key===t?e=i:(this.size++,e=this.getFree(null),e.prev=i,e.next=i.next,e.prev.next=e,e.next.prev=e)}return e}putFree(t){t.data=null,t.next=this.freeChain,t.prev=null,this.freeChain=t,this.freeChainSize++}getFree(t){if(null===this.freeChain)return new re(t);let e=this.freeChain;return e.data=t,this.freeChain=e.next,this.freeChainSize--,e}getLast(){if(null==this.head)return null;let t=this.head.prev,e=t.data;return this.size--,0===this.size?this.head=null:(t.prev.next=t.next,t.next.prev=t.prev),this.putFree(t),e}static addData(t,e,i){t.put(e),t.size>i&&t.get()}},oe=class{constructor(){this.beforeChangeVideo=new ae,this.beforeChangeAudio=new ae,this.afterChangeVideo=new ae,this.afterChangeAudio=new ae,this.avcChangeCnt=0,this.avcChange=!1,this.duration=o.a.avHeaderChangeStatCfg[1]||3e3,this.avcChangeInfo=""}destroy(){this.beforeChangeVideo&&this.beforeChangeAudio.reset(),this.beforeChangeVideo=null,this.beforeChangeAudio&&this.beforeChangeAudio.reset(),this.beforeChangeAudio=null,this.afterChangeVideo&&this.afterChangeVideo.reset(),this.afterChangeVideo=null,this.afterChangeAudio&&this.afterChangeAudio.reset(),this.afterChangeAudio=null,this.avcChangeInfo=null}setAvcChange(){this.avcChangeCnt++,this.avcChangeCnt>1&&(this.avcChange=!0,this.afterChangeVideo.reset(),this.afterChangeAudio.reset())}addVideo(t){this.addChain(this.avcChange?this.afterChangeVideo:this.beforeChangeVideo,t)}addAudio(t){this.addChain(this.avcChange?this.afterChangeAudio:this.beforeChangeAudio,t)}addChain(t,e){t.put(e);let i=t.peek();i&&e.key-i.key>this.duration&&(this.avcChange?this.recordAvcChangeInfo():t.get())}recordAvcChangeInfo(){this.avcChange=!1;let t=this.getInfo(this.beforeChangeVideo),e=this.getInfo(this.afterChangeVideo),i=this.getInfo(this.beforeChangeAudio),s=this.getInfo(this.afterChangeAudio);this.avcChangeInfo="vDts=[".concat(t.dtsArr.join("-"),"--").concat(e.dtsArr.join("-"),"]"),this.avcChangeInfo+="  vCts=[".concat(t.ctsArr.join("-"),"--").concat(e.ctsArr.join("-"),"]"),this.avcChangeInfo+="  aDts=[".concat(i.dtsArr.join("-"),"--").concat(s.dtsArr.join("-"),"]")}getInfo(t){let e=t.get(),i=[],s=[];if(e)for(i.push(e.key),e.hasOwnProperty("cts")&&s.push(e.cts);t.size>0;){let r=t.get();i.push(r.key-e.key),r.hasOwnProperty("cts")&&s.push(r.cts),e=r,0===t.size&&i.push(r.key)}return{dtsArr:i,ctsArr:s}}record(t,e){""!==this.avcChangeInfo&&e&&t.setComp(d.a.DIM_H265_SAM.name,"avcChange",this.avcChangeInfo),this.avcChangeInfo=""}},ne=class{constructor(t){this.type=t,this.totalDuration=0,this.referDts=0,this.firstDts=0,this.lastDts=0,this.durations=[],this.open=!1}destroy(){this.durations=null}reset(){n.a.log("DtsTimeline.reset type=".concat(this.type)),this.totalDuration=0,this.referDts=0,this.firstDts=0,this.lastDts=0,this.durations=[]}isFirstDts(t){return t===this.firstDts}alignTimeline(t){this.firstDts=t.firstDts,this.referDts=t.firstDts,this.lastDts=t.firstDts}correctDts(t,e){if(!this.open)return t;let i=0;if(0===this.firstDts)this.firstDts=t,this.referDts=t,this.lastDts=t,i=t;else{let s=this.lastDts;this.lastDts=t;let r=t-s;if(r<0&&(r=-r),r>o.a.dtsJumpThreshold){let i=s-this.referDts,r=this.totalDuration+i;this.durations.push({startTime:this.totalDuration,firstDts:this.referDts,endTime:r}),this.totalDuration=r,0===e&&(e="audio"===this.type?44:30);let a=1e3/e;this.referDts=Math.floor(t-a),n.a.log("DtsTimeline.setDts:dtsJump type=".concat(this.type," lastDts=").concat(s,", curDts=").concat(t))}i=this.firstDts+this.totalDuration+(t-this.referDts),1==f.a._printCorrectDts&&n.a.log("DtsTimeline.setDts:type=".concat(this.type," dts=").concat(t,", correctDts=").concat(i))}return i}getRealDtsByCurrentTime(t){for(let e=this.durations.length-1;e>=0;e--){let{startTime:i,endTime:s,firstDts:r}=this.durations[e];if(t>=i&&t<s)return 0!==e&&(this.durations=this.durations.slice(e)),r+(t-i)}return this.referDts+t-this.totalDuration}getCorrentDtsByCurrentTime(t){return this.firstDts+t}getRealDtsByPts(t){let e=t-this.firstDts-this.totalDuration;return this.referDts+e}};var he=class{constructor(){this._lastVideoDts=0,this._lastAudioDts=0,this._mode=0}reset(){this._lastVideoDts=0,this._lastAudioDts=0,this._mode=0}isSync(){return 0===this._mode}isVideoDtsDiffLarge(t){return this._lastVideoDts=t,this._isJump()}isAudioDtsDiffLarge(t){return this._lastAudioDts=t,this._isJump()}_isJump(){if(!o.a.dtsJumpOpen)return!1;if(this._lastVideoDts>0&&this._lastAudioDts>0){let t=0;if(t=this._lastVideoDts>this._lastAudioDts?this._lastVideoDts-this._lastAudioDts:this._lastAudioDts-this._lastVideoDts,t>o.a.dtsJumpThreshold)return this._mode=1,!0}return!1}};class de{constructor(t,e){this._jitterLimit=t,this._type=e,this._lastFrameId=0,this._lastDts=0,this._jitters=0,this._jitterMax=0,this._compositionTimeMax=0}reset(){this._lastFrameId=0,this._lastDts=0,this._jitters=0,this._jitterMax=0}addCapture(t,e){if(0===this._lastFrameId)this._lastFrameId=t,this._lastDts=e;else{if(t-this._lastFrameId==1){let t=e-this._lastDts;t>this._jitterLimit&&this._jitters++,t>this._jitterMax&&(this._jitterMax=t)}this._lastFrameId=t,this._lastDts=e}}addCompositionTime(t){t>this._compositionTimeMax&&(this._compositionTimeMax=t)}getStats(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},i=this._type===de.Types.VIDEO?d.a.CORE.V_CAPTURE_JITTERS:d.a.CORE.A_CAPTURE_JITTERS,s=this._type===de.Types.VIDEO?d.a.CORE.V_CAPTURE_JITTER_MAX:d.a.CORE.A_CAPTURE_JITTER_MAX;return e[i]=this._jitters,e[s]=this._jitterMax,this._type===de.Types.VIDEO&&(e[d.a.CORE.V_CTS_MAX]=this._compositionTimeMax),t&&(this._jitters=0,this._jitterMax=0,this._compositionTimeMax=0),e}}de.Types={AUDIO:"audio",VIDEO:"video"};var le=de;const ce=0;let ue=!!Number(f.a._dropAudio),pe=!!Number(f.a._dropVideo);Number(f.a._dropGap);const me="Hvcc",_e="AnnexB",fe="Avcc";class ge{constructor(){this.lastDts=0,this.lastPts=0,this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0],this.playVideoFrameCnt=0,this.playAudioFrameCnt=0}reset(){this.lastDts=this.lastPts=this.lastCts=0,this.playVideoFrameCnt=this.playAudioFrameCnt=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}setTimeStamp(t,e,i){this.addStat(this.dtsStat,this.lastDts,t),this.addStat(this.ptsStat,this.lastPts,e),this.addStat(this.ctsStat,this.lastCts,i),this.lastDts=t,this.lastPts=e,this.lastCts=i}addStat(t,e,i){if(e>0&&i>e){let s=i-e;s>=1e3?t[4]++:s>=800?t[3]++:s>=600?t[2]++:s>=400?t[1]++:s>=200&&t[0]++}}}let Se=[43,138,8,0];class ye extends Ht{constructor(t,e,i){super(),this.audioFrameId=0,this.videoFrameId=0,this.corePlayer=t,this.remuxer=e,this.metadata={},this.flvCacher=new Pe,this.fps=new wt,this.downFrameRate=new Qt,this.audioFps=new wt,this.sei=new Ut(t),this.avSample=new jt,this.hevcSpsParser=new Xt,this.vCaptureJitterStat=new le(200,le.Types.VIDEO),this.aCaptureJitterStat=new le(200,le.Types.AUDIO),this.timeStampStat=new ge,this.emptyFrames=0,this.avcChangeStat=new oe,this.dropFrameCtrl=new zt(t),this.dropFrameDts=new se(t,this),this.videoChain=new ae,this.audioChain=new ae,this.ctsMax=0,this.ctsVideoChain=new ae,this.DEFAULT_GOP=200,this.bufLen=400,this.firstBufLen=400,this.remuxLen=this.firstBufLen,this.maxWaitTime=2e3,this.repairSameDts=!1,this.lastDtsDis=0,this.pushGop=!1,this.parseFlvHead=!1,this.lengthSizeMinusOne=0,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.recvAudioConfig=!1,this.audioConfig=Se.slice(),this.audioSampleRate=22050,this.aacTimeLen=1024e3/this.audioSampleRate,this.validAacTime=500*this.aacTimeLen,this.audioChannelCount=1,this.audioObjectType=5,this.audioIncreaseTSMap=new Map,this.firstDemuxAudioTS=-1,this.streamFormat=_e,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.videoConfig={},this.hasCtsZero=!1,this.paused=!1,this.hasEmptyFrames=!1,this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,this.beginParseTs=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastAudioOriginDts=0,this.lastVideoTs=0,this.lastVideoOriginDts=0,this.lastParseDts=0,this.waitNextIFrame=!1,this.maxaudioptsList=[0,0,0,0,0,0,0,0,0,0],this.last10anduiptsList=[0,0,0,0,0,0,0,0,0,0],this.firstAudioTs=-1,this.showH265Tip=!1,this.appendHighQualityEmptyAudio=!0,this.deleteH264Aud=!1,this.incompleteFlvheaderLen=0,this.videoFrames=0,this.audioFrames=0,this.headCache=null,this.useWebCodes=!0,this.decodeNums=0,this.OBUParser=new Yt,this.seiTypes={},this.av1Bytes=0,this.lastDropDts=0,this.PPS=[],this.SPS=[],this.VPS=[],this.videoCodec="",this.videoWidth=1280,this.videoHeight=720,this.reset(),this.onAV1SequenceHeaderBind=this.onAV1SequenceHeader.bind(this),this.onAV1MetaDataBind=this.onAV1MetaData.bind(this),this.parseType=i,this.startAudioTs=0,this.startVideoTs=0,this.audioDropTs=0,this.audioDropFrames=[],this.firstAudioDts=0,this.firstAudioFrameId=0,this.parseVideoTagCnt=0,this.parseVideoSucCnt=0,this.isFirstPrintVideoTs=!1,this.isFirstPrintAudioTs=!1,this.isSwap=!1,this.fromType=ft,this.startDtsType=ce,this.swapStartDts=0,this.timelineVideo=new ne("video"),this.timelineAudio=new ne("audio"),this.dtsChecker=new he}destroy(){this.corePlayer=null,this.remuxer=null,this.metadata=null,this.flvCacher&&this.flvCacher.destroy(),this.flvCacher=null,this.fps&&this.fps.destroy(),this.fps=null,this.downFrameRate&&this.downFrameRate.destroy(),this.downFrameRate=null,this.audioFps&&this.audioFps.destroy(),this.audioFps=null,this.sei&&this.sei.destroy(),this.sei=null,this.avSample&&this.avSample.destroy(),this.avSample=null,this.hevcSpsParser&&this.hevcSpsParser.destroy(),this.hevcSpsParser=null,this.vCaptureJitterStat=null,this.aCaptureJitterStat=null,this.timeStampStat=null,this.avcChangeStat&&this.avcChangeStat.destroy(),this.avcChangeStat=null,this.dropFrameCtrl&&this.dropFrameCtrl.destroy(),this.dropFrameCtrl=null,this.dropFrameDts&&this.dropFrameDts.destroy(),this.dropFrameDts=null,this.videoChain&&this.videoChain.reset(),this.videoChain=null,this.audioChain&&this.audioChain.reset(),this.audioChain=null,this.ctsVideoChain&&this.ctsVideoChain.reset(),this.ctsVideoChain=null,this.audioConfig=null,this.audioIncreaseTSMap&&this.audioIncreaseTSMap.clear(),this.audioIncreaseTSMap=null,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.videoConfig=null,this.maxaudioptsList=null,this.last10anduiptsList=null,this.headCache=null,this.OBUParser=null,this.seiTypes=null,this.PPS=null,this.SPS=null,this.VPS=null,this.videoCodec=null,this.audioDropFrames=null,this.timelineVideo&&this.timelineVideo.destroy(),this.timelineVideo=null,this.timelineAudio&&this.timelineAudio.destroy(),this.timelineAudio=null,this.dtsChecker=null}setCorrentDtsOpen(t){n.a.log("FlvParser.setCorrentDtsOpen: ".concat(t)),this.timelineVideo.open=t,this.timelineAudio.open=t}getAudioFrameId(){return this.audioFrameId++,this.audioFrameId}getVideoFrameId(){return this.videoFrameId++,this.videoFrameId}printVideoInfo(){let t=this.videoChain;if(t.size>0){let e=t.get(),i=[e.key],s=[e.cts];for(;t.size>0;){let r=t.get();i.push(r.key-e.key),s.push(r.cts),e=r}n.a.log("FlvParser video dtsList：".concat(i.join(","))),n.a.log("FlvParser video ctsList：".concat(s.join(",")))}}printAudioInfo(){let t=this.audioChain;if(t.size>0){let e=t.get(),i=[e.key];for(;t.size>0;){let s=t.get();i.push(s.key-e.key),e=s}n.a.log("FlvParser audio dtsList：".concat(i.join(",")))}}getCodecType(){return 12===this.codec?b:13===this.codec?V:F}printPlayFrameInfo(){n.a.log("FlvParser.playFrameInfo",this.timeStampStat.playVideoFrameCnt,this.timeStampStat.playAudioFrameCnt)}static probe(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}getAudioFrames(){return this.audioFrames}getVideoFrames(){return this.videoFrames}getFps(){return this.fps.getFps()}getRealFps(){return this.fps.realFps}getRealFpsAudio(){return this.audioFps.realFps}isDownEnough(){return this.downFrameRate.isDownEnough(this.fps.realFps)}getAudioFps(){return this.audioFps&&this.audioFps.getFps()}setDecoctorTimeAbnormal(){let t=f.a.decodeabnormal;if(t&&t.split("_").length>1){let e=parseInt(t.split("_")[1]),i=(new Date).getTime()-e;i&&i>864e5?(this.appendHighQualityEmptyAudio=!0,f.a.decodeabnormal=""):this.appendHighQualityEmptyAudio=!1}}reset(t){n.a.log("FlvParser.reset"),this.audioFrameId=0,this.videoFrameId=0,this.printFirstVideoTs=!1,this.printFirstAudioTs=!1,this.pfvTs=!1,this.pfaTs=!1,this.fps.reset(),this.audioFps.reset(),this.flvCacher.reset(),this.timeStampStat.reset(),this.dropFrameCtrl.reset(),this.dropFrameDts.reset(),this.videoChain.reset(),this.audioChain.reset(),this.downFrameRate.reset(),this.lastParseDts=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastAudioOriginDts=0,this.lastVideoTs=0,this.lastVideoOriginDts=0,this.lastDropDts=0,this.showH265Tip=!1,this.bufLen=400,this.remuxLen=this.firstBufLen,this.hasCtsZero=!1,this.audioIncreaseTSMap.clear(),this.firstDemuxAudioTS=-1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.incompleteFlvheaderLen=0,this.parseFlvHead=!1,this.switchingUrl=!1,this.droppingSample=null,this.disError302=null,this.decodeIFRTime=0,this.waitRemuxTime=0,this.isFirstRemux=!1,this.av1Bytes=0,this.onAV1SequenceHeaderBind=null,this.onAV1MetaDataBind=null,this.startAudioTs=0,this.startVideoTs=0,this.PPS.length=0,this.SPS.length=0,this.VPS.length=0,this.videoCodec="",this.videoWidth=1280,this.videoHeight=720}getPlayStat(){let t={videoFrameCnt:this.playVideoFrameCnt,videoLength:this.playVideoLength,audioFrameCnt:this.playAudioFrameCnt,audioLength:this.playAudioLength,emptyAudioFrameCnt:this.playEmptyAudioFrameCnt};return this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,t}setPaused(t){this.paused=t}setPushGop(t){this.pushGop=t,n.a.log("FlvParser.setPushGop "+t)}setDeleteH264Aud(t){this.deleteH264Aud=t,n.a.log("FlvParser.deleteH264Aud "+t)}setDroppingSample(t){this.droppingSample=t}setDisError(t){this.disError302=t}parseFlv(t,e){let i=0;if(this.headCache){let e=new Uint8Array(t.length+this.headCache.length);e.set(this.headCache,0),e.set(t,this.headCache.length),t=e}let s,r=t.length;if(!1===this.parseFlvHead){let e=ye.FLV_HEADER_LEN+ye.PREV_TAG_SIZE_LEN;if(r<e)return n.a.warn("FlvParser.parseFlv flv has no header len="+r),void(this.headCache=t.slice());if(this.headCache=null,i+=e,!ye.probe(t))return;this.parseFlvHead=!0,this.beginParseTs=Date.now()}for(0===i?this.flvCacher.append(t):this.flvCacher.append(t.slice(i));null!==(s=this.flvCacher.popFrame());)this.parseTag(s,e)}parseTag(t,e,i){let s=t.length;if(s<ye.TAG_HEADER_LEN+ye.PREV_TAG_SIZE_LEN)return void n.a.warn("FlvParser.parseTag flv has no whole tag len="+s+" data="+t);let r=0,a=t[r++],o=(t[r++]<<16)+(t[r++]<<8)+t[r++];if(s-(ye.TAG_HEADER_LEN+ye.PREV_TAG_SIZE_LEN)<o)return void n.a.warn("FlvParser.parseTag flv has no enough data dataLen="+o+" len="+s);if(0===o)return void n.a.warn("FlvParser.parseTag flvtag empty type="+a);let h=(t[r++]<<16)+(t[r++]<<8)+t[r++]+parseInt(t[r++].toString(16)+"000000",16);if(r+=3,a===ye.VIDEO_TYPE){if(this.parseType===Zt)return;1==f.a._jumpV1?h+=1e6:2==f.a._jumpV1&&(h-=1e6),this.avSample.addVideoSample(s,h),pe||(this.parseVideo(t,11,o,h,i),this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_FRAME,1))}else if(a===ye.AUDIO_TYPE){if(f.a._dropAudioNum>0&&(this.dropAudioNum=Number(f.a._dropAudioNum),f.a._dropAudioNum=0),this.dropAudioNum>0)return void this.dropAudioNum--;if(1==f.a._noAudio)return;1==f.a._jumpA1?h+=1e6:2==f.a._jumpA1&&(h-=1e6),this.avSample.addAudioSample(s,h),ue||this.corePlayer.isPureVideo||(this.parseAudio(t,11,o,h,i),this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.AUDIO_FRAME,1))}else a===ye.SCRIPT_TYPE?this.parseScriptTag(t,11,o,h):(n.a.warn("%cFlvParser.parseTag discard type="+a+" len="+o,"color:white;background:black"),this.corePlayer.onVideoParseInvalid&&this.corePlayer.onVideoParseInvalid())}parseScriptTag(t,e,i,s){if(e+ye.SCRIPT_AMF1_HEAD_LEN>i)return void n.a.log("script too small");t[e++];let r=(t[e++]<<8)+t[e++],a=Lt.getStr(t,e,r);e+=r,this.corePlayer&&("onMetaData"===a?(this.metadata=Lt.parseScript(t,e,t.length).data,Object.assign(this.corePlayer.metadata,this.metadata)):-1!==a.indexOf("onMixAudio")&&this.corePlayer.scriptVolumeInfos.addMixAudio(a.replace("onMixAudio:",""),s))}parseVideo(t,e,i,s,r){let a=s;if(this.isFirstPrintTs||(n.a.log("FlvParser.firstVideoTs=".concat(s)),this.isFirstPrintTs=!0),this.repairSameDts&&s===this.lastVideoTs&&this.lastDtsDis>0){let t=this.fps.realFps;s+=t>0?parseInt(1e3/t):this.lastDtsDis}if(this.lastVideoTs>0&&this.lastVideoTs<s&&(this.lastDtsDis=s-this.lastVideoTs),i<5)return void n.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+i);let h=t[e]>>4;this.codec=15&t[e++];let l=t[e++];if(5!==i)if(0===l)this.parseVideoConfig(t,e,i,s);else if(1===l){if(a<this.lastVideoOriginDts)return n.a.warn("FlvParser.parseVideo originDts=".concat(a," < lastVideoOriginDts=").concat(this.lastVideoOriginDts,", drop video frame")),void(this.waitNextIFrame=!0);if(r||(r=this.getVideoFrameId()),this.vCaptureJitterStat.addCapture(r,a),s=this.timelineVideo.correctDts(s,this.fps.realFps),this.dtsChecker.isVideoDtsDiffLarge(s)&&this.timelineVideo.isFirstDts(s)&&(this.corePlayer.resetAudioDts(),this.corePlayer.ctrlBuffer.avBuffer.dtsChecker.reset(),this.timelineAudio.reset()),this.waitNextIFrame&&h!==ye.IFRAME)return void n.a.log("FlvParser.parseVideo waitNextIFrame=".concat(this.waitNextIFrame," frameType=").concat(h,", drop video frame"));if(this.waitNextIFrame=!1,this.parseVideoTagCnt++,h==ye.IFRAME)this.corePlayer&&this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_IFRAME,1),this.hasKeyFrame||(this.decodeIFRTime=_.a.now()),this.hasKeyFrame=!0;else if(!this.hasKeyFrame)return void n.a.log("-------- drop video tag has no IFrame",s);if(0===o.a.pcdnFlvSyncMob&&!this.isFirstPrintVideoTs&&this.fromType==gt){const t=s-this.swapStartDts;if(n.a.log("FlvParser.PCDN, firstVideoTs=".concat(s," dis=").concat(t)),this.isFirstPrintVideoTs=!0,this.getPcdnDisError(t))return}if(Number(f.a._printVideoTs)&&n.a.debug("%cFlvParser video ts","color:green"," oriDts=".concat(a," dif=").concat(a-this.lastVideoOriginDts," fixDts=").concat(s," dif=").concat(s-this.lastVideoTs," fixDts-oriDts=").concat(s-a," frameType=").concat(h)),f.a.gap&&(s+=Number(f.a.gap)),this.lastVideoTs>0&&(s-this.lastVideoTs>200||s-this.lastVideoTs<-200)){const t=s-this.lastVideoTs;n.a.warn("FlvParser video dts jump lastDts=".concat(this.lastVideoTs," curDts=").concat(s," gap=").concat(t)),(t>=o.a.videoMaxGap||t<=-o.a.videoMaxGap)&&this.resetPlayer()}if(1==Number(f.a._printAudioTsSec)){let t=_.a.now();t-this.startVideoTs>1e3&&(n.a.debug("%cFlvParser shield video sec ts","color:blue",s),this.startVideoTs=t)}this.lastVideoTs=s,this.lastVideoOriginDts=a,this.parseVideoNalu(t,e,i,s,h)}else 2===l?n.a.info("%cFlvParser.parseVideo avc_end dataLen="+i,"color:white;background:black"):n.a.warn("%cFlvParser.parseVideo error avc packet type="+l,"color:white;background:black");else n.a.log("FlvParser.parseVideo avc_empty frameType="+h+" avcPacketType="+l)}resetPlayer(){this.corePlayer.resetPlayer()}onAV1SequenceHeader(t){let e="av01."+t.seq_profile+"."+Yt.zeroPad(t["seq_level_idx[0]"],2)+(t["seq_tier[0]"]?"H":"M")+"."+Yt.zeroPad(t.BitDepth,2)+"."+t.mono_chrome+"."+t.subsampling_x+t.subsampling_y+(1===t.subsampling_x&&1===t.subsampling_y?t.chroma_sample_position:0);t.color_description_present_flag&&(e+="."+Yt.zeroPad(t.colorPrimaries,2)+"."+Yt.zeroPad(t.transferCharacteristics,2)+"."+Yt.zeroPad(t.matrixCoefficients,2)+"."+t.color_range);let i={isHevc:!1,isAV01:!0,width:t.max_frame_width_minus_1+1,height:t.max_frame_height_minus_1+1,codec:e};this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.remuxer&&this.remuxer.switchLevel(!1,!1),this.corePlayer.updateVideoConfig(i,!1)}onAV1MetaData(t,e){e.itu_t_t35_payload_bytes&&this.sei.parseSei(t,e.itu_t_t35_payload_bytes,Ut.AV1_CODEC_TYPE,this.seiTypes)}parseVideoConfig(t,e,i,s){let r,a,h=[],l=[],c=[],u=[],p=[],m=[],_=!1,f=null,g=(e+=3)+i-5;if(this.isAv01()){this.av1Bytes=t.subarray(e,e+i-5);let s=t.subarray(e+=4,e+i);Yt.parseOBU(s,0,this.onAV1SequenceHeaderBind)}else{if(this.isHevc()){this.showH265Tip||(this.showH265Tip=!0,n.a.warn("This is a H265 video.")),this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.H265,1);let s=this.hevcFindNextStartCode(t,e);if(s.found){this.streamFormat=_e,this.corePlayer.setStreamFormat(this.streamFormat),n.a.log("FlvParser.parseVideoConfig AnnexB");let i=(126&t[e+=s.startCodeSize])>>1,r=e;for(;e<g;){if(s=this.hevcFindNextStartCode(t,e),s.found||e+1===g){switch(i){case ye.NAL_VPS:let s=null;s=e+1===g?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.vpsUnit&&this.vpsUnit.data.toString(16)!==s.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig vps changed"),_=!0),this.vpsUnit=s,c.push(s.data),m[m.length]={length:s.data.length,nalu:s.data};break;case ye.NAL_SPS:let a=null;a=e+1===g?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.spsUnit&&this.spsUnit.data.toString(16)!==a.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig sps changed"),_=!0),this.spsUnit=a,h.push(a.data),u[u.length]={length:a.data.length,nalu:a.data};break;case ye.NAL_PPS:let o=null;o=e+1===g?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.ppsUnit&&this.ppsUnit.data.toString(16)!==o.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig pps changed"),_=!0),this.ppsUnit=o,l.push(o.data),p[p.length]={length:o.data.length,nalu:o.data}}if(e+s.startCodeSize<g){i=(126&t[e+=s.startCodeSize])>>1,r=e;continue}}e++}}else{if(!o.a.enableHvcc)return n.a.warn("hevcFindNextStartCode failed! dataLen",i),void this.corePlayer.on265StartCodeError();{this.streamFormat=me,this.corePlayer.setStreamFormat(this.streamFormat),n.a.log("FlvParser.parseVideoConfig Hvcc"),e+=21,this.lengthSizeMinusOne=3&t[e++];const i=t[e++];n.a.log("FlvParser.parseVideoConfig Hvcc nNaluArrayCount=".concat(i));for(let s=0;s<i;s++){let i=99&t[e++];if(i===ye.NAL_VPS){let i=(t[e++]<<8)+t[e++],s=0;for(let r=0;r<i;++r){s=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+s),type:ye.NAL_VPS};this.vpsUnit&&this.vpsUnit.data.toString(16)!==i.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig vps changed"),_=!0),this.vpsUnit=i,e+=s,c.push(i.data),m[m.length]={length:i.data.length,nalu:i.data}}}else if(i===ye.NAL_SPS){let i=(t[e++]<<8)+t[e++];for(let s=0;s<i;++s){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:ye.NAL_SPS};this.spsUnit&&this.spsUnit.data.toString(16)!==i.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig sps changed"),_=!0),this.spsUnit=i,e+=r,h.push(i.data),u[u.length]={length:i.data.length,nalu:i.data}}}else if(i===ye.NAL_PPS){let i=(t[e++]<<8)+t[e++];for(let s=0;s<i;++s){a=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+a),type:ye.NAL_PPS};this.ppsUnit&&this.ppsUnit.data.toString(16)!==i.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig pps changed"),_=!0),this.ppsUnit=i,e+=a,l.push(i.data),p[p.length]={length:i.data.length,nalu:i.data}}}}}}f=this.parseSps(this.spsUnit,c,h,l),this.hasCtsZero=!0,this.corePlayer.setAvcCfg(f.width,f.height)}else{e+=4,this.lengthSizeMinusOne=3&t[e++],this.streamFormat=fe,n.a.log("FlvParser.parseVideoConfig Avcc"),this.corePlayer.setStreamFormat(this.streamFormat);let i=31&t[e++];for(let s=0;s<i;++s){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:7};this.spsUnit&&this.spsUnit.data.toString(16)!==i.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig sps changed",this.spsUnit.data.toString(16),i.data.toString(16)),_=!0),this.spsUnit=i,e+=r,h.push(i.data),u[s]={length:r,nalu:i.data}}let s=t[e++];for(let i=0;i<s;++i){a=(t[e++]<<8)+t[e++];let s={data:t.subarray(e,e+a),type:8};this.ppsUnit&&this.ppsUnit.data.toString(16)!==s.data.toString(16)&&(n.a.log("FlvParser.parseVideoConfig pps changed",this.ppsUnit.data.toString(16),s.data.toString(16)),_=!0),this.ppsUnit=s,e+=a,l.push(s.data),p[i]={length:a,nalu:s.data}}f=this.parseSps(this.spsUnit,c,h,l),this.corePlayer.setAvcCfg(f.width,f.height)}this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.corePlayer.updateAVCConfig&&this.corePlayer.updateAVCConfig({pps:p,sps:u,vps:m,codec:f.codec,width:f.width,height:f.height,timestamp:s}),this.PPS=p,this.SPS=u,this.VPS=m,this.videoCodec=f.codec,this.videoWidth=f.width,this.videoHeight=f.height,this.avcChangeStat.setAvcChange(),this.corePlayer.updateVideoConfig(f,_),this.remuxer&&this.remuxer.switchLevel(_,!1),n.a.log("FlvParser.parseVideoConfig avccfg dataLen="+i+" spsLen="+r+" ppsLen="+a+" w/h="+f.width+"/"+f.height+" codec="+f.codec,"sps=".concat(JSON.stringify(u)),"pps=".concat(JSON.stringify(p)),"vps=".concat(JSON.stringify(m)))}}parseSps(t,e,i,s){let r=null,a="",o=0,h=0;if(this.isHevc()){this.spsConfig={},this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,this.spsConfig);let d=this.spsConfig.profile_space,l=this.spsConfig.profile_idc,c=this.spsConfig.profile_compatibility_flags;c=c>>1&1431655765|(1431655765&c)<<1,c=c>>2&858993459|(858993459&c)<<2,c=c>>4&252645135|(252645135&c)<<4,c=c>>8&16711935|(16711935&c)<<8,c=c>>16|c<<16;let u=this.spsConfig.tier_flag,p=this.spsConfig.level_idc;a="hvc1."+["","A","B","C"][d%4]+l.toString()+"."+c.toString(16).toLowerCase()+"."+["L","H"][u%2]+p.toString(),o=this.spsConfig.width||this.corePlayer.width,h=this.spsConfig.height||this.corePlayer.height,n.a.log("FlvParser.parseVideoConfig.hevcSpsConfig",this.spsConfig,a),r={isHevc:!0,isAV01:!1,vps:e,sps:i,pps:s,codec:a,width:o,height:h}}else{try{r=new Dt(t.data).readSPS(),o=r.width,h=r.height}catch(t){n.a.log("FlvParser.parseSPS error, msg=".concat(t.message)),o=this.metadata.width||1280,h=this.metadata.height||720}let e=t.data.subarray(1,4),d="avc1.";for(let t=0;t<3;t++){let i=e[t].toString(16);i.length<2&&(i="0"+i),d+=i}a=d,r={isHevc:!1,isAV01:!1,sps:i,pps:s,width:o,height:h,codec:a}}return r}calcCtsMax(t,e){if(e>0){this.ctsVideoChain.put({key:t,cts:e});let i=0,s=this.ctsVideoChain.head.data.key;if(this.ctsVideoChain.head.prev.data.key-s>=5e3&&(i=this.ctsVideoChain.head.data.cts,this.ctsVideoChain.get()),this.ctsMax<e)this.ctsMax=e;else if(this.ctsMax===i){let t=this.ctsVideoChain.head,e=0;for(;e<t.data.cts&&(e=t.data.cts),t.next!==this.ctsVideoChain.head;)t=t.next;this.ctsMax=e}}}parseVideoNalu(t,e,i,s,r){let a,h,l=[],c=0,u=[],p=[],m=[],g=null,S=!1,y=r===ye.IFRAME,T=(t[e++]<<16)+(t[e++]<<8)+t[e++];0===T?this.hasCtsZero||(this.hasCtsZero=!0):T>=8388608?T-=16777216:T>2500&&T<3500?T=0:T>600&&n.a.warn("FlvParser.parseVideoNalu large cts="+T+" dts="+s),this.vCaptureJitterStat.addCompositionTime(T),ae.addData(this.videoChain,{key:s,cts:T},Number(o.a.avHeaderChangeCfg[2])),this.avcChangeStat.addVideo({key:s,cts:T}),this.calcCtsMax(s,T);let P=e+i-5,v=!1;if(this.seiTypes={},this.isAv01()){let o=t.subarray(e,e+i-5);l.push({data:o,type:1===r?5:1}),Yt.parseOBU(o,s,null,this.onAV1MetaDataBind),c+=o.length,a=1}else if(this.isHevc()){if(this.streamFormat==_e){let r=this.hevcFindNextStartCode(t,e);if(!r.found)return n.a.error("hevcFindNextStartCode failed! dataLen",i),void this.corePlayer.on265StartCodeError();{let i=(126&t[e+=r.startCodeSize])>>1,a=e;for(;e<P;)r=this.hevcFindNextStartCode(t,e),(r.found||e+1===P)&&(i<10&&(v=!((98&i)>>1)),h=e+1===P?{data:t.subarray(a,e+1),type:i}:{data:t.subarray(a,e),type:i},i===ye.HEVC_NAL_SEI?this.sei.parseSei(s,h.data,Ut.H265_CODEC_TYPE,this.seiTypes):i===ye.HEVC_NAL_AUD||(i===ye.NAL_VPS?(m.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(h.data,s)):i===ye.NAL_SPS?(g=h,p.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(h.data,s)):i===ye.NAL_PPS?(u.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(h.data,s)):(h.discardAllow=i<10&&!(1&i),h.isUnit=!0,l.push(h),c+=h.data.length)),e+r.startCodeSize<P)?(i=(126&t[e+=r.startCodeSize])>>1,a=e):e++}}else if(this.streamFormat==me){let r=i-5;for(;r;){a=0;for(let i=0;i<=this.lengthSizeMinusOne;++i)a+=t[e++]<<8*(this.lengthSizeMinusOne-i);if(r-=this.lengthSizeMinusOne+1,0===a)continue;if(a<0||a>i-5)break;if(a>r){e+=r;break}let o=(126&t[e])>>1;r-=a,h={data:t.subarray(e,e+a),type:o},h.naluType=o,o===ye.HEVC_NAL_SEI?this.sei.parseSei(s,h.data,Ut.H265_CODEC_TYPE,this.seiTypes):o===ye.HEVC_NAL_AUD||(o===ye.NAL_VPS?(m.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(h.data,s)):o===ye.NAL_SPS?(g=h,p.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(h.data,s)):o===ye.NAL_PPS?(u.push({length:h.data.length,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(h.data,s)):(h.discardAllow=o<10&&!(1&o),h.isUnit=!0,l.push(h),c+=h.data.length)),e+=a}}}else{let n=i-5;for(;n;){a=0;let d=t[e+4];for(let i=0;i<=this.lengthSizeMinusOne;++i)a+=t[e++]<<8*(this.lengthSizeMinusOne-i);if(n-=this.lengthSizeMinusOne+1,0===a)continue;if(a<0||a>i-5)break;if(a>n){e+=n;break}n-=a,h={data:t.subarray(e,e+a),type:1===r?5:1};const m=31&h.data[0];if(h.naluType=m,this.isH264Sei(h.data))this.sei.parseSei(s,h.data,Ut.H264_CODEC_TYPE,this.seiTypes),1==f.a._pushSei&&(l.push(h),c+=h.data.length);else if(this.isH264NALUPPS(h.data))u.push({length:a,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(h.data,s);else if(this.isH264NALUPSPS(h.data))g=h,p.push({length:a,nalu:h.data}),l.push(h),c+=h.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(h.data,s);else if(this.corePlayer.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS){if(m>=1&&m<=5){let t=!1;1!=r&&0==(96&d)&&(t=!0,S=!0),h.discardAllow=t,h.isUnit=!0,l.push(h),c+=h.data.length}}else 1==o.a.isLimitNaluType?m>=1&&m<=5&&!this.dropFrameDts.isCanDrop(s,y,d)&&(l.push(h),c+=h.data.length):this.isH264Aud(h.data)&&this.deleteH264Aud||(this.isH264Aud(h.data)?(l.push(h),c+=h.data.length):this.dropFrameDts.isCanDrop(s,y,d)||(l.push(h),c+=h.data.length));e+=a}}if(y&&!this.isAv01()&&(this.vpsUnit&&0==m.length&&(l.push(this.vpsUnit),c+=this.vpsUnit.data.length),this.spsUnit&&0==p.length&&(l.push(this.spsUnit),c+=this.spsUnit.data.length),this.ppsUnit&&0==u.length&&(l.push(this.ppsUnit),c+=this.ppsUnit.data.length)),c>0){let t=!1,e=[],a=[],o=[];if(y){a=p.length>0?p:this.SPS,e=m.length>0?m:this.VPS,o=u.length>0?u:this.PPS;let i=!1,r=!1,h=!1;if(this._isCfgChange(this.SPS,p)&&(t=!0,i=!0),this._isCfgChange(this.PPS,u)&&(t=!0,r=!0),this._isCfgChange(this.VPS,m)&&(t=!0,h=!0),t&&this.corePlayer.setIFrameAvcChageStat(),t){i&&this.SPS.length>0&&p.length>0&&n.a.log("FlvParser.parseVideoNalu IFrame header != avcHeader,avcspsLen=".concat(this.SPS.length,",spsLen=").concat(p.length,",sps=").concat(p[0].nalu.toString()," && ").concat(this.SPS[0].nalu.toString())),r&&this.PPS.length>0&&u.length>0&&n.a.log("FlvParser.parseVideoNalu IFrame header != avcHeader,avcPPSLen=".concat(this.PPS.length,",ppsLen=").concat(u.length,",pps=").concat(u[0].nalu.toString()," && ").concat(this.PPS[0].nalu.toString())),h&&this.VPS.length>0&&m.length>0&&n.a.log("FlvParser.parseVideoNalu IFrame header != avcHeader,acvVPSLen=".concat(this.VPS.length,",vpsLen=").concat(m.length,",vps=").concat(m[0].nalu.toString()," && ").concat(this.VPS[0].nalu.toString()));const l=this.parseSps(g,e,a,o);this.corePlayer.setAvcCfg(l.width,l.height),this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.corePlayer.updateAVCConfig&&this.corePlayer.updateAVCConfig({pps:o,sps:a,vps:e,codec:l.codec,width:l.width,height:l.height,timestamp:s}),this.PPS=o,this.SPS=a,this.VPS=e,this.videoCodec=l.codec,this.videoWidth=l.width,this.videoHeight=l.height,this.remuxer&&this.remuxer.switchLevel(t,!1)}}let P={type:this.isAv01()?"av01":"avc",units:l,len:c,ts:s,cts:T,dts:90*s,pts:90*(s+T),key:r===ye.IFRAME,origin_iframe:1===this.seiTypes[Ut.SEI_TYPES.IFRAME],isBFrameType:v,av1Bytes:this.av1Bytes};if(1==f.a._printVideoFrameType&&n.a.log("FlvParser.parseVideo FrameType=".concat(r," iFrameType=").concat(ye.IFRAME,", dts=").concat(s)),y&&(1==f.a._printIframeDetail&&n.a.log("FlvParser.parseVideo iFrame,avcChange=".concat(t,",dts=").concat(s,",vpslen=").concat(m.length,",vLen=").concat(e.length,",spsLen=").concat(p.length,",sLen=").concat(a.length,",ppsLen=").concat(u.length,",pLen=").concat(o.length)),P.spsUnit=a,P.ppsUnit=o,P.vpsUnit=e,P.videoCodec=this.videoCodec,P.videoWidth=this.videoWidth,P.videoHeight=this.videoHeight),this.corePlayer.isLive&&this.corePlayer.videoPlayConsuming&&this.corePlayer.videoPlayConsuming.addRecvFrameData(s,s+T,_.a.now()),this.droppingSample&&this.droppingSample(P))return;if(this.printFirstVideoTs||(this.printFirstVideoTs=!0,n.a.log("FlvParser.parseVideo dts=".concat(s," pts=").concat(P.pts/90," isIFrame=").concat(y))),this.pfvTs||(this.pfvTs=!0,n.a.log("FlvParser.parseVideo11 dts=".concat(s," pts=").concat(P.pts/90," isIFrame=").concat(y))),this.corePlayer.webcodecType!=N.a.PLAYER_CORE_TYPE.WEBCODECS||this.isH264Aud(h.data))this.fps.addDts(s,i);else{let t=y?ye.IFRAME:S?ye.NO_REFERENCE_FRAME:0;this.fps.addDts(s,i,t)}this.downFrameRate.addFrame(),this.dropFrameCtrl.setRealFps(this.fps.realFps),this.dropFrameDts.setRealFps(this.fps.realFps),this.corePlayer.setRealFps(this.fps.realFps),this.corePlayer.curVideoDts=s,this.lastParseDts=s,this.videoFrames++,this.timeStampStat.setTimeStamp(s,s+T,T),this.parseVideoSucCnt++,this.corePlayer.pushAvcSample(P),this.playVideoFrameCnt++,this.timeStampStat.playVideoFrameCnt++,this.playVideoLength+=i}}_isCfgChange(t,e){let i=!1;return t.length>0&&e.length>0&&(t.length!==e.length?i=!0:e.forEach((e,s)=>{i||e.nalu.toString()===t[s].nalu.toString(16)||(i=!0)})),i}addVideoSPS(){}addVideoPPS(){}addVideoVPS(){}parseAudio(t,e,i,s,r){let a=s;ae.addData(this.audioChain,{key:s},Number(o.a.avHeaderChangeCfg[2])),this.avcChangeStat.addAudio({key:s});let h=t[e++]>>>4,l=s;10!=h&&n.a.warn("FlvParser.parseAudio Unsupported audio codec, soundFormat="+h),this.calcAudioFrameRate(s),null!=this.audioIncreaseTSMap.get(s)&&(s=this.audioIncreaseTSMap.get(s));let c=t[e++];if(0===c)if(i>=4){let i=t[e]>>3;this.audioObjectType=i;let r=((7&t[e])<<1)+((128&t[e+1])>>7);if(r>=ye.AdtsSampleingRates.length)return void n.a.warn("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+r);this.audioChannelCount=(120&t[e+1])>>3;let a=this.getAdtsConfig(i,r,this.audioChannelCount),o=!1;this.recvAudioConfig&&this.audioConfig.toString(16)===a.toString(16)||(o=!0),this.audioConfig=a,this.recvAudioConfig=!0,this.corePlayer.updateAudioConfig({audioConfig:a,codec:"mp4a.40.5",audioSampleRate:this.audioSampleRate,aacTimeLen:this.aacTimeLen,audioObjectType:this.audioObjectType,audioChannelCount:this.audioChannelCount,timeStamp:s},!1,this.parseType),o&&(this.firstAudioTs=-1,this.firstDemuxAudioTS=-1,this.lastAudioTs=0,this.firstAudioDts=0,this.firstAudioFrameId=0,this.corePlayer.resetAudioDts()),this.corePlayer.setExceptionStat(d.a.DIM_LINK_STA.AUDIO_CONFIG,1)}else n.a.warn("FlvParser.parseAudio adts error dataLen="+i+" ts="+s);else if(1===c){if(a<this.lastAudioOriginDts)return void n.a.warn("FlvParser.parseAudio aacPacketType=1, originDts(".concat(a,") < lastAudioOriginDts(").concat(this.lastAudioOriginDts));if(this.audioFrames++,0===o.a.pcdnFlvSyncMob&&!this.isFirstPrintAudioTs&&this.fromType==gt){const t=s-this.swapStartDts;if(n.a.log("FlvParser.PCDN, firstAudioTs=".concat(s," dis=").concat(t)),this.isFirstPrintAudioTs=!0,this.getPcdnDisError(t))return}if(o.a.dtsJumpOpen&&(s=this.timelineAudio.correctDts(s,this.audioFps.realFps),this.dtsChecker.isAudioDtsDiffLarge(s)&&this.timelineAudio.isFirstDts(s)&&(this.timelineAudio.alignTimeline(this.timelineVideo),s=this.timelineAudio.correctDts(s,this.audioFps.realFps))),!this.recvAudioConfig)return;r||(r=this.getAudioFrameId()),this.aCaptureJitterStat.addCapture(r,a);let h=0;if(o.a.audioDtsOpen)if(0===this.firstAudioDts)this.lastAudioTs=s,this.firstAudioDts=s,this.firstAudioFrameId=r,this.corePlayer.resetAudioDts();else{h=Math.floor(this.firstAudioDts+(r-this.firstAudioFrameId)*this.aacTimeLen);let t=h-s;t<0&&(t=-t),t<100?s=h:t>300&&(n.a.log("FlvParser.parseAudio timeStamp diff(".concat(t,")>300 resetFirstAudioDts, frameId=").concat(r," dts=").concat(h," timeStamp=").concat(s," firstAudioDts=").concat(this.firstAudioDts," firstFrameId=").concat(this.firstAudioFrameId)),this.lastAudioTs=s,this.firstAudioDts=s,this.firstAudioFrameId=r)}if(this.last10anduiptsList.shift(),this.last10anduiptsList.push(s),-1==this.firstAudioTs&&(this.firstAudioTs=s),-1==this.firstDemuxAudioTS)this.firstDemuxAudioTS=s;else if(s==this.firstDemuxAudioTS)return void n.a.warn("parseaudio audio too much audio in firstTs ts="+s);for(let t=0;t<10;t++)this.maxaudioptsList[t]=this.last10anduiptsList[t];if(this.lastAudioTs>0&&this.lastAudioTs==s){let t=s+(0|this.aacTimeLen);this.audioIncreaseTSMap.set(l,t),s=t}if(Number(f.a._printAudioTs)&&this.parseType==$t&&n.a.debug("%cFlvParser audio ts","color:red","oriDts=".concat(a," dif=").concat(a-this.lastAudioOriginDts," fixDts=").concat(s," dif=").concat(s-this.lastAudioTs," fixDts-oriDts=").concat(s-a)),1==Number(f.a._printAudioTs2)&&this.parseType==Zt&&n.a.debug("%cFlvParser shield audio ts","color:green","oriDts=".concat(a," dif=").concat(a-this.lastAudioOriginDts," fixDts=").concat(s," dif=").concat(s-this.lastAudioTs," fixDts-oriDts=").concat(s-a)),1==Number(f.a._printAudioTsSec)&&this.parseType==Zt){let t=_.a.now();t-this.startAudioTs>1e3&&(n.a.debug("%cFlvParser shield audio sec ts","color:green",s),this.startAudioTs=t)}if(this.lastAudioTs=s,this.lastAudioOriginDts=a,this.hasAudioTag=!0,!this.validAacSample(s))return;let d=i-2,c={type:"aac",unit:t.subarray(e,e+d),dts:90*s,pts:90*s,ts:s,sampleDuration:this.aacTimeLen};if(this.corePlayer.isLive&&this.corePlayer.audioPlayConsuming&&this.corePlayer.audioPlayConsuming.addRecvFrameData(s,s,_.a.now()),this.droppingSample&&this.droppingSample(c))return;this.printFirstAudioTs||(this.printFirstAudioTs=!0,n.a.log("FlvParser.parseAudio"+this.parseType,s)),this.pfaTs||(this.pfaTs=!0,n.a.log("FlvParser.parseAudio11"+this.parseType,s)),this.audioFps.addDts(s),this.corePlayer.curAudioDts=s,this.lastParseDts=s,this.corePlayer.pushAacSample(c,this.parseType)}else n.a.warn("FlvParser.parseAudio error aac packet type="+c)}validAacSample(t){let e=[];e=this.parseType==Zt?this.corePlayer.ctrlBuffer.avBuffer.aShieldBuffer.samples:this.corePlayer.ctrlBuffer.avBuffer.aBuffer.samples;let i=e.length;if(i>0){let s=e[i-1];return 1===i&&s.ts>t&&s.ts-t>this.validAacTime?(e.shift(),!0):t-s.ts<this.validAacTime}return!0}getAdtsConfig(t,e,i){let s=0,r=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?e>=6?(t=5,r=new Array(4),s=e-3):(t=2,r=new Array(2),s=e):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,r=new Array(2),s=e):(t=5,r=new Array(4),s=e):(t=5,r=new Array(4),s=e,e>=6?s=e-3:1===i&&(t=2,r=new Array(2),s=e)),this.audioSampleRate=ye.AdtsSampleingRates[e],this.aacTimeLen=1024e3/this.audioSampleRate,n.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),r[0]=t<<3,r[0]|=(14&e)>>1,r[1]=(1&e)<<7,r[1]|=i<<3,5===t&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),n.a.log("FlvParser.getAdtsConfig type="+t+" index="+e+" channel="+i+" exIndex="+s+" config="+r),r}parseOBUHeader(t){let e={};return e.obu_forbidden_bit=t>>7,e.obu_type=(120&t)>>3,e.obu_extension_flag=(4&t)>>2,e.obu_has_size_field=(2&t)>>1,e.obu_reserved_1bit=1&t,e}isHevc(){return 12==this.codec}isAv01(){return 13==this.codec}hevcFindNextStartCode(t,e){return 0===t[e]&&0===t[e+1]?1===t[e+2]?{found:!0,startCodeSize:3}:0===t[e+2]&&1===t[e+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}isHevcNal(t,e){return 0===t[e]&&0===t[e+1]&&0===t[e+2]&&1===t[e+3]}isH264Sei(t){return 6==(31&t[0])}isH264Aud(t){return 9==(31&t[0])}isH264NALUPPS(t){return(31&t[0])==ye.NALU_TYPE_PPS}isH264NALUPSPS(t){return(31&t[0])==ye.NALU_TYPE_SPS}getCalculateVideoFramePlayDelay(){return 0}calcAudioFrameRate(t){this.audioFrameRateTs||(this.audioFrameRateTs=t,this.audioFrameCnt=0),t-this.audioFrameRateTs<1e3?this.audioFrameCnt++:(Number(f.a._printAudioFrameRate)&&n.a.log("@@@@@@@@ audioFrameRate="+this.audioFrameCnt),this.audioFrameRateTs=t,this.audioFrameCnt=0)}beforeSwap(t,e,i){this.startDtsType=e,this.isSwap=!0,this.fromType=t,this.isFirstPrintVideoTs=!1,this.isFirstPrintAudioTs=!1,this.swapStartDts=i}getPcdnDisError(t){return(t<-100||t>100)&&(this.disError302(),!0)}}ye.EVENTS={META_DATA:"meta_data",SWITCH_URL_DONE:"switch_url_done"},ye.REMUX_TYPE_AUDIO=0,ye.REMUX_TYPE_VIDEO=1,ye.FLV_HEADER_LEN=9,ye.TAG_HEADER_LEN=11,ye.PREV_TAG_SIZE_LEN=4,ye.AUDIO_TYPE=8,ye.VIDEO_TYPE=9,ye.SCRIPT_TYPE=18,ye.SCRIPT_AMF1_HEAD_LEN=13,ye.SCRIPT_AMF2_HEAD_LEN=5,ye.IFRAME=1,ye.NO_REFERENCE_FRAME=99,ye.NAL_VPS=32,ye.NAL_SPS=33,ye.NAL_PPS=34,ye.HEVC_NAL_AUD=35,ye.HEVC_NAL_SEI=39,ye.NAL_RASL_N=8,ye.NAL_RASL_R=9,ye.NALU_TYPE_SLICE=1,ye.NALU_TYPE_DPA=2,ye.NALU_TYPE_DPB=3,ye.NALU_TYPE_DPC=4,ye.NALU_TYPE_IDR=5,ye.NALU_TYPE_SEI=6,ye.NALU_TYPE_SPS=7,ye.NALU_TYPE_PPS=8,ye.NALU_TYPE_AUD=9,ye.NALU_TYPE_EOSEQ=10,ye.NALU_TYPE_EOSTREAM=11,ye.NALU_TYPE_FILL=12,ye.H265_SEI_HEAD=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],ye.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var Te=ye,Pe=class{constructor(){this.size=0,this.buffers=[]}destroy(){this.buffers=null}reset(){n.a.log("FlvCacher.reset",this.size),this.size=0,this.buffers=[]}append(t){0!==t.length&&(this.buffers.push(t),this.size+=t.length)}getByte(t){let e=0;for(let i=0;i<this.buffers.length;++i){let s=this.buffers[i];if(e+s.length>t)return s[t-e];e+=s.length}return n.a.warn("FlvCacher.getByte has no offset="+t),0}popFrame(){if(0===this.size)return null;if(0===this.buffers.length)return n.a.error("FlvCacher.popFront error no buffers, size:"+this.size+" not eq 0"),this.reset(),null;if(this.size<=Te.TAG_HEADER_LEN+Te.PREV_TAG_SIZE_LEN)return null;let t=(this.getByte(1)<<16)+(this.getByte(2)<<8)+this.getByte(3),e=Te.TAG_HEADER_LEN+t+Te.PREV_TAG_SIZE_LEN;if(this.size<e)return null;if(1===this.buffers.length){if(this.buffers[0].length===e)return this.size-=e,this.buffers.shift();{let t=this.buffers[0].slice(0,e);return this.buffers[0]=this.buffers[0].slice(e),this.size-=e,t}}let i,s=new Uint8Array(e),r=0,a=0;for(;r<e;){let t=e-r;if(this.buffers[0].length>t){i=this.buffers[0].slice(0,t),s.set(i,a),a+=t,r+=t,this.buffers[0]=this.buffers[0].slice(t),this.size-=t;break}i=this.buffers.shift(),s.set(i,a),a+=i.length,r+=i.length,this.size-=i.length}return s}},ve=class{constructor(t){this.tag=t}destroy(){this.tag=null}parse(){}},Ee=class extends ve{constructor(t){super(t),this.frameType=0,this.codec=0,this.avcPacketType=0,this.compositionTime=0}parse(){let t=11;this.frameType=this.data[t]>>4,this.codec=15&this.data[t],this.avcPacketType=this.data[12],this.compositionTime=(this.data[13]<<16)+(this.data[14]<<8)+this.data[15]}},Ce=class extends ve{constructor(t){super(t)}},Ie=class{constructor(t){this.tag=t}destroy(){this.tag=null}parse(){}},Ae=class extends Ie{constructor(t){super(t),this.videoBody=null}destroy(){super.destroy(),this.videoBody&&this.videoBody.destroy(),this.videoBody=null}parse(){let t=this.tag.tagHeader;0===t.avcPacketType?this.videoBody=this._parseAVCSeqHeader(t.codec):1===t.avcPacketType&&(this.videoBody=this._parseAVCNalu(t.codec))}_parseAVCSeqHeader(t){return null}_parseAVCNalu(t){return null}},De=class extends Ie{constructor(t){super(t)}},Re=class extends Ie{constructor(t){super(t)}},Oe=class extends At{constructor(t){super(t),this.tagHeader=null,this.tagData=null}destroy(){super.destroy(),this.tagHeader&&this.tagHeader.destroy(),this.tagHeader=null,this.tagData&&this.tagData.destroy(),this.tagData=null}_parse(){super._parse(),this.error||(this.tagHeader=this._parseTagHeader(),this.tagData=this._parseTagData())}_parseTagHeader(){let t=null;return 9===this.tagType?t=new Ee(this):8===this.tagType&&(t=new Ce(this)),t&&t.parse(),t}_parseTagData(){let t=null;return 9===this.tagType?t=new Ae(this):8===this.tagType?t=new De(this):18===this.tagType&&(t=new Re(this)),t&&t.parse(),t}};class Le extends Ht{static probe(t){return t[0]===Pt&&t[1]===vt&&t[2]===Et&&t[3]===Ct}constructor(t){super(),this._type=t,this.flvHeader=null,this.flvCacher=new Pe,this.parseHeader=!1}destroy(){this.clear(),this.flvCacher&&this.flvCacher.destroy(),this.flvCacher=null}parseFlv(t){if(t=new Uint8Array(t),this.flvHeader){let e=new Uint8Array(t.length+this.flvHeader.length);e.set(this.flvHeader,0),e.set(t,this.flvHeader.length),t=e}let e,i=0,s=t.length;if(!this.parseHeader){let e=Tt+It;if(s<e)return n.a.log("FlvStreamBase.parseFlv has no enough header data len=".concat(s)),void(this.flvHeader=t.slice());if(this.flvHeader=null,i+=e,!Le.probe(t))return void n.a.warn('FlvStreamBase.parseFlv header is not "FLV1"');this.parseHeader=!0}for(i>0?this.flvCacher.append(t.slice(i)):this.flvCacher.append(t);null!==(e=this.flvCacher.popFrame());){let t=this._type===Le.Types.SIMPLE?new At(e):new Oe(e);t.parse(),this.trigger(Le.Events.ON_TAG,t)}}reset(){this.flvHeader=null,this.flvCacher.reset(),this.parseHeader=!1}}Le.Events={ON_TAG:"ON_TAG"},Le.Types={SIMPLE:"SIMPLE",FULL:"FULL"};var Me=Le;const we=0,Fe=1,be=2,Ve=3,Ne=4;class Be extends Ht{constructor(t){super(),this._type=t,this._stream=new Me(Me.Types.SIMPLE),this._stream.on(Me.Events.ON_TAG,this._onFlvTag,this),this._startDts=0,this._state=we,this._videoConfigTag=null,this._audioConfigTag=null,this._firstVideoDts=0,this._firstAudioDts=0,this._outputVideoDts=0,this._outputAudioDts=0,this._outputVideo=!1,this._outputAudio=!1,this.lastVideoDts=0,this.lastAudioDts=0}destroy(){this.clear(),this._stream&&this._stream.destroy(),this._stream=null,this._videoConfigTag&&this._videoConfigTag.destroy(),this._videoConfigTag=null,this._audioConfigTag&&this._audioConfigTag.destroy(),this._audioConfigTag=null}reset(){this._videoConfigTag=null,this._audioConfigTag=null,this._firstVideoDts=0,this._firstAudioDts=0,this._outputVideoDts=0,this._outputAudioDts=0,this._outputVideo=!1,this._outputAudio=!1,this._stream.reset()}startLoad(t){n.a.log("FlvStreamProxy.startLoad type=".concat(this._type," %cstartDts=").concat(t),"color:red"),this._startDts=t,this._state=Fe}parseFlv(t){this._stream.parseFlv(t)}getOutputDts(){return{videoDts:this.lastVideoDts,audioDts:this.lastAudioDts}}setOutputDts(t){let{videoDts:e,audioDts:i}=t;n.a.log("FlvStreamProxy.setOutputDts type=".concat(this._type," %cvideoDts=").concat(e," %caudioDts=").concat(i),"color:green","color:red"),this._outputVideoDts=e,this._outputVideo=!1,this._outputAudioDts=i,this._outputAudio=!1}_onFlvTag(t){this._saveTimestamp(t),-1===this._startDts?this.trigger(Be.Events.FLV_TAG,t):(0===t.packetType?(n.a.log("FlvStreamProxy._onFlvTag type=".concat(this._type," %cconfigTag dts=").concat(t.timestamp),"color:blue"),this._saveConfigTag(t)):this._checkState(t),this._checkOutput(t))}_saveConfigTag(t){t.isVideo()?this._outputVideoDts>0&&!this._outputVideo&&(this._videoConfigTag=t):t.isAudio()&&this._outputAudioDts>0&&!this._outputAudio&&(this._audioConfigTag=t)}_outputVideoConfig(){this.videoConfigTag&&(this.trigger(Be.Events.FLV_TAG,this.videoConfigTag),this.videoConfigTag=null)}_outputAudioConfig(){this.audioConfigTag&&(this.trigger(Be.Events.FLV_TAG,this.audioConfigTag),this.audioConfigTag=null)}_outputTag(t){this.trigger(Be.Events.FLV_TAG,t)}_saveTimestamp(t){1===t.packetType&&(t.isVideo()?(0===this._firstVideoDts&&(this._firstVideoDts=t.timestamp,n.a.log("FlvStreamProxy._saveTimestamp type=".concat(this._type," %cfirstVideoDts=").concat(this._firstVideoDts," startDts=").concat(this._startDts),"color:green")),this.lastVideoDts=t.timestamp):t.isAudio()&&(0===this._firstAudioDts&&(this._firstAudioDts=t.timestamp,n.a.log("FlvStreamProxy._saveTimestamp type=".concat(this._type," %cfirstAudioDts=").concat(this._firstAudioDts," startDts=").concat(this._startDts),"color:red")),this.lastAudioDts=t.timestamp))}_checkState(t){this._state===Fe&&t.isVideo()&&t.timestamp>=this._startDts&&(n.a.log("FlvStreamProxy._checkState type=".concat(this._type," state change to CATCH_START_DTS, %cstartDts=").concat(this._startDts," videoDts=").concat(t.timestamp),"color:green"),this._state=be,this.trigger(Be.Events.CATCH_START_DTS)),this._state===be&&(t.isVideo()?!this._outputVideo&&t.timestamp>this._outputVideoDts&&(n.a.log("FlvStreamProxy._checkState type=".concat(this._type," outputVideo=true, %ccurVideoDts=").concat(t.timestamp," outputVideoDts=").concat(this._outputVideoDts),"color:green"),this._outputVideo=!0,t.timestamp-this._outputVideoDts>100&&("cdn"!==this._type&&(this._state=Ne),n.a.warn("FlvStreamProxy._checkState type=".concat(this._type," dis=").concat(t.timestamp-this._outputVideoDts,",  state change to ").concat(this._state,", %ccurVideoDts=").concat(t.timestamp," outputVideoDts=").concat(this._outputVideoDts),"color:green"))):t.isAudio()&&!this._outputAudio&&t.timestamp>this._outputAudioDts&&(n.a.log("FlvStreamProxy._checkState type=".concat(this._type," outputAudio=true, %ccurAudioDts=").concat(t.timestamp," outputAudioDts=").concat(this._outputAudioDts),"color:red"),this._outputAudio=!0),this._state===Ne?this.trigger(Be.Events.DIS_ERROR):this._outputVideo&&this._outputAudio&&(n.a.log("FlvStreamProxy._checkState type=".concat(this._type," state change to CATCH_OUTPUT_DTS, %ccurVideoDts=").concat(this.lastVideoDts," outputVideoDts=").concat(this._outputVideoDts," %ccurAudioDts=").concat(this.lastAudioDts," outputAudioDts=").concat(this._outputAudioDts),"color:green","color:red"),this._state=Ve))}_checkOutput(t){this._state!==Ne&&(this._state===Ve?(this._outputVideoConfig(),this._outputAudioConfig(),this._outputTag(t)):t.isVideo()&&this._outputVideo?(this._outputVideoConfig(),this._outputTag(t)):t.isAudio()&&this._outputAudio?(this._outputAudioConfig(),this._outputTag(t)):this.trigger(Be.Events.INVALID_TAG,t))}}Be.Events={FLV_TAG:"FLV_TAG",CATCH_START_DTS:"CATCH_START_DTS",DIS_ERROR:"DIS_ERROR",INVALID_TAG:"INVALID_TAG"};var ke=Be;class Ue{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.loaderCtrl=t,this.flvPlayer=e,e.hyPlayer&&(this.hyPlayer=e.hyPlayer,this.stat=e.hyPlayer.stat),this._newLink(),this.needRetry=i,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.getProxyPeriod=Ue.DEFAULT_GET_PROXY_PERIOD,this.headers=null,this.flvStream=new ke("cdn"),this.hisLinks=new yt(e.stat)}destroy(){this.link&&this.link.destroy(),this.link=null,this.flvStream&&this.flvStream.destroy(),this.flvStream=null,this.hisLinks&&this.hisLinks.destroy(),this.hisLinks=null}_newLink(){h.a.firefox&&mt.isSupported()?this.link=new mt(this):$.isMacChrome72()?this.link=new pt(this):this.link=new _t(this)}abort(){this.link.destroy()}reset(){this.lastGetProxyTime=0,this.status=0,this.url=null,this.started&&(n.a.log("FlvLoader.reset"),this.link.url&&this.hisLinks.addHis(this.link),this.flvStream.reset(),this.flvStream.off(ke.Events.FLV_TAG,this._onFlvTag,this),this.link.destroy(!1),this._newLink())}connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t?(this.link instanceof pt&&(t=t.replace("http","ws")),this.reset(),this.lastGetProxyTime=_.a.now()-2e3,n.a.log("FlvLoader.connect url="+t,this.lastGetProxyTime),this.flvStream.startLoad(e),this.flvStream.on(ke.Events.FLV_TAG,this._onFlvTag,this),this.flvStream.on(ke.Events.INVALID_TAG,this._onInvalidTag,this),this.headers=null,this.url=t,this.link.connect(this.url),this.started=!0):n.a.warn("FlvLoader.connect url is null")}close(){n.a.log("FlvLoader.close"),this.reset(),this.started=!1}onstatus(t){this.status=t}onheader(t){this.headers=t,n.a.log("FlvLoader.onheader",t),this.flvPlayer&&this.flvPlayer.onHeader&&this.flvPlayer.onHeader(t)}onopen(){n.a.log("FlvLoader.onopen"),this.getProxyPeriod=Ue.DEFAULT_GET_PROXY_PERIOD,this.flvPlayer.onConnected()}onclose(){f.a.hasOwnProperty("_toPcdn")||(n.a.log("FlvLoader.onclose"),this.started&&(this.flvPlayer.onClosed(),this.lastGetProxyTime=0,this.needRetry&&this.getProxy()))}onerror(t,e){this.lastGetProxyTime=0,n.a.log("FlvLoader.onerror",e,this.needRetry),this.flvPlayer.onLoadError&&this.flvPlayer.onLoadError(t,e)}onData(t){this.flvPlayer.onData(t,ft),1===o.a.pcdnFlvSyncMob&&this.flvStream.parseFlv(t)}_onFlvTag(t){this.flvPlayer.onFlvTag(t)}_onInvalidTag(t){this.flvPlayer.onInvalidTag(t,ft)}onCheckTimer(t,e){if(this.started&&(this.onCheckConnect(t),e%10==0)){let t=this.link.speed;t!=R.b.UintMax&&(t=R.b.formatByteSize(t),n.a.log("FlvLoader speed ".concat(t,"/s")))}}on302(t){this.flvPlayer.on302&&this.flvPlayer.on302(t)}get speed(){let t=this.link.speed;return t==R.b.UintMax&&(t=0),t}get connected(){return this.link&&this.link.connected}onCheckConnect(t){this.connected||(this.needRetry?this.getProxy():t-this.lastGetProxyTime>15e3&&0!=this.lastGetProxyTime&&this.flvPlayer&&this.flvPlayer.onLoadTimeout&&(this.flvPlayer.onLoadTimeout(),this.lastGetProxyTime=0))}getProxy(){let t=_.a.now();t-this.lastGetProxyTime<this.getProxyPeriod||(n.a.log("FlvLoader.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+t+" period="+this.getProxyPeriod),this.reset(),this.lastGetProxyTime=t,this.getProxyPeriod=Math.min(2*this.getProxyPeriod,128e3),this.flvPlayer.requestUrl())}}Ue.DEFAULT_GET_PROXY_PERIOD=4e3;var xe=Ue;function He(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function We(t,e,i,s,r,a){return He((o=He(He(e,t),He(s,a)))<<(n=r)|o>>>32-n,i);var o,n}function Ge(t,e,i,s,r,a,o){return We(e&i|~e&s,t,e,r,a,o)}function Ye(t,e,i,s,r,a,o){return We(e&s|i&~s,t,e,r,a,o)}function qe(t,e,i,s,r,a,o){return We(e^i^s,t,e,r,a,o)}function Ke(t,e,i,s,r,a,o){return We(i^(e|~s),t,e,r,a,o)}function je(t,e){var i,s,r,a,o;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var n=1732584193,h=-271733879,d=-1732584194,l=271733878;for(i=0;i<t.length;i+=16)s=n,r=h,a=d,o=l,n=Ge(n,h,d,l,t[i],7,-680876936),l=Ge(l,n,h,d,t[i+1],12,-389564586),d=Ge(d,l,n,h,t[i+2],17,606105819),h=Ge(h,d,l,n,t[i+3],22,-1044525330),n=Ge(n,h,d,l,t[i+4],7,-176418897),l=Ge(l,n,h,d,t[i+5],12,1200080426),d=Ge(d,l,n,h,t[i+6],17,-1473231341),h=Ge(h,d,l,n,t[i+7],22,-45705983),n=Ge(n,h,d,l,t[i+8],7,1770035416),l=Ge(l,n,h,d,t[i+9],12,-1958414417),d=Ge(d,l,n,h,t[i+10],17,-42063),h=Ge(h,d,l,n,t[i+11],22,-1990404162),n=Ge(n,h,d,l,t[i+12],7,1804603682),l=Ge(l,n,h,d,t[i+13],12,-40341101),d=Ge(d,l,n,h,t[i+14],17,-1502002290),n=Ye(n,h=Ge(h,d,l,n,t[i+15],22,1236535329),d,l,t[i+1],5,-165796510),l=Ye(l,n,h,d,t[i+6],9,-1069501632),d=Ye(d,l,n,h,t[i+11],14,643717713),h=Ye(h,d,l,n,t[i],20,-373897302),n=Ye(n,h,d,l,t[i+5],5,-701558691),l=Ye(l,n,h,d,t[i+10],9,38016083),d=Ye(d,l,n,h,t[i+15],14,-660478335),h=Ye(h,d,l,n,t[i+4],20,-405537848),n=Ye(n,h,d,l,t[i+9],5,568446438),l=Ye(l,n,h,d,t[i+14],9,-1019803690),d=Ye(d,l,n,h,t[i+3],14,-187363961),h=Ye(h,d,l,n,t[i+8],20,1163531501),n=Ye(n,h,d,l,t[i+13],5,-1444681467),l=Ye(l,n,h,d,t[i+2],9,-51403784),d=Ye(d,l,n,h,t[i+7],14,1735328473),n=qe(n,h=Ye(h,d,l,n,t[i+12],20,-1926607734),d,l,t[i+5],4,-378558),l=qe(l,n,h,d,t[i+8],11,-2022574463),d=qe(d,l,n,h,t[i+11],16,1839030562),h=qe(h,d,l,n,t[i+14],23,-35309556),n=qe(n,h,d,l,t[i+1],4,-1530992060),l=qe(l,n,h,d,t[i+4],11,1272893353),d=qe(d,l,n,h,t[i+7],16,-155497632),h=qe(h,d,l,n,t[i+10],23,-1094730640),n=qe(n,h,d,l,t[i+13],4,681279174),l=qe(l,n,h,d,t[i],11,-358537222),d=qe(d,l,n,h,t[i+3],16,-722521979),h=qe(h,d,l,n,t[i+6],23,76029189),n=qe(n,h,d,l,t[i+9],4,-640364487),l=qe(l,n,h,d,t[i+12],11,-421815835),d=qe(d,l,n,h,t[i+15],16,530742520),n=Ke(n,h=qe(h,d,l,n,t[i+2],23,-995338651),d,l,t[i],6,-198630844),l=Ke(l,n,h,d,t[i+7],10,1126891415),d=Ke(d,l,n,h,t[i+14],15,-1416354905),h=Ke(h,d,l,n,t[i+5],21,-57434055),n=Ke(n,h,d,l,t[i+12],6,1700485571),l=Ke(l,n,h,d,t[i+3],10,-1894986606),d=Ke(d,l,n,h,t[i+10],15,-1051523),h=Ke(h,d,l,n,t[i+1],21,-2054922799),n=Ke(n,h,d,l,t[i+8],6,1873313359),l=Ke(l,n,h,d,t[i+15],10,-30611744),d=Ke(d,l,n,h,t[i+6],15,-1560198380),h=Ke(h,d,l,n,t[i+13],21,1309151649),n=Ke(n,h,d,l,t[i+4],6,-145523070),l=Ke(l,n,h,d,t[i+11],10,-1120210379),d=Ke(d,l,n,h,t[i+2],15,718787259),h=Ke(h,d,l,n,t[i+9],21,-343485551),n=He(n,s),h=He(h,r),d=He(d,a),l=He(l,o);return[n,h,d,l]}function ze(t){var e,i="",s=32*t.length;for(e=0;e<s;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function Je(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var s=8*t.length;for(e=0;e<s;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function Qe(t){var e,i,s="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),s+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return s}function Xe(t){return unescape(encodeURIComponent(t))}function $e(t){return function(t){return ze(je(Je(t),8*t.length))}(Xe(t))}function Ze(t,e){return function(t,e){var i,s,r=Je(t),a=[],o=[];for(a[15]=o[15]=void 0,r.length>16&&(r=je(r,8*t.length)),i=0;i<16;i+=1)a[i]=909522486^r[i],o[i]=1549556828^r[i];return s=je(a.concat(Je(e)),512+8*e.length),ze(je(o.concat(s),640))}(Xe(t),Xe(e))}var ti=function(t,e,i){return e?i?Ze(e,t):Qe(Ze(e,t)):i?$e(t):Qe($e(t))};const ei=Object(R.a)("X2Zt"),ii=Object(R.a)("Zm0="),si=Object(R.a)("X3dzVGltZQ=="),ri=Object(R.a)("d3NUaW1l"),ai=Object(R.a)("X2ludmFsaWRUaW1l"),oi=Object(R.a)("X25leHRSZWZyZXNoVGltZQ=="),ni=Object(R.a)("X2N0eXBl"),hi=Object(R.a)("Y3R5cGU="),di=Object(R.a)("d3NTZWNyZXQ="),li=Object(R.a)("X3BhcmFtcw=="),ci=Object(R.a)("X3NGbHZBbnRpY29kZQ=="),ui=Object(R.a)("X3NGbHZVcmw="),pi=Object(R.a)("X3NTdHJlYW1OYW1l"),mi=Object(R.a)("X3JlcQ=="),_i=Object(R.a)("c2VxaWQ="),fi=Object(R.a)("X3NlcWlk"),gi=Object(R.a)("X3BjZG4="),Si=Object(R.a)("JDA="),yi=Object(R.a)("JDE="),Ti=Object(R.a)("JDI="),Pi=Object(R.a)("JDM="),vi=Object(R.a)("aW5pdA=="),Ei=Object(R.a)("aXNJbnZhbGlk"),Ci=Object(R.a)("Z2V0QW50aWNvZGU="),Ii=Object(R.a)("cGFyc2VBbnRpY29kZQ=="),Ai=Object(R.a)("aGFzQW50aWNvZGU="),Di=Object(R.a)("b25DaGVja1RpbWVy"),Ri=Object(R.a)("X29uUmVmcmVzaA=="),Oi=Object(R.a)("X29uUmVmcmVzaEJpbmQ="),Li=Object(R.a)("dmFsaWQ="),Mi=Object(R.a)("Z2V0VG9rZW4="),wi=Object(R.a)("X2dldFRva2Vu"),Fi=Object(R.a)("bGl2ZXVp"),bi=Object(R.a)("Z2V0Q2RuVG9rZW5JbmZvRXg="),Vi=(Object(R.a)("MTAw"),Object(R.a)("dmVyPTE=")),Ni=Object(R.a)("Jg=="),Bi=Object(R.a)("PQ=="),ki=Object(R.a)("UkVGUkVTSA=="),Ui=Object(R.a)("cmVmcmVzaA=="),xi=(Object(R.a)("ZGVjb2RlVVJJ"),Object(R.a)("dW5lc2NhcGU="),Object(R.a)("Z2V0U2VxaWQ=")),Hi=(Object(R.a)("bWVkaWF1aXNlYQ=="),Object(R.a)("Z2V0QW50aUNvZGVGb3JTdHJlYW0="),Object(R.a)("X25pbW9UaWQ="));class Wi extends Ht{constructor(){super(),this[si]="",this[ei]="",this[ni]="",this[li]=[],this[ci]="",this[ui]="",this[pi]="",this[fi]="",this[ai]=Number.MAX_SAFE_INTEGER,this[oi]=Number.MAX_SAFE_INTEGER,this[Hi]=null,this[Oi]=this[Ri].bind(this)}[Ai](){return""!==this[ci]}[vi](t,e,i,s){this[ui]=t,this[pi]=e,this[Ii](i),this[Hi]=s}[Ii](t){this[ei]="",this[si]="",this[ni]="",this[li]=[],this[ci]=t,t.split(Ni).forEach(t=>{let[e,i]=t.split(Bi);if(e===ii)i=decodeURI(i),i=unescape(i),i=atob(i),this[ei]=i;else if(e===ri){this[si]=i;let t=1e3*parseInt(i,16)+3e5;this[ai]=_.a.now()+(t-Date.now()),this[oi]=this[ai]-3e4}else e==hi?this[ni]=i:e!==di&&this[li].push(t)})}[Ei](t){return t>this[ai]}[Ci](t){if(""===this[ei])return this[ci];let e=this[ni];!e&&P.isOpen()&&(e="huya_webh5");const i=o.a.platform,s=N.a.PLATFORM_TYPE[i]||N.a.PLATFORM_TYPE.web;this[fi]=Number(v.a.uid)+Date.now();const r=ti("".concat(this[fi],"|").concat(e,"|").concat(s)),a=i===N.a.PLATFORM_TYPE_NAME.wap?v.a.uid:v.a.convertUid;let n=this[ei].replace(Si,a).replace(yi,this[pi]).replace(Ti,r).replace(Pi,this[si]);t&&(n+=gi);let h="".concat(di).concat(Bi).concat(ti(n)).concat(Ni).concat(ri).concat(Bi).concat(this[si]).concat(Ni).concat(_i).concat(Bi).concat(this[fi]).concat(Ni).concat(hi).concat(Bi).concat(e).concat(Ni).concat(Vi);return this[li].length>0&&(h+=Ni+this[li].join(Ni)),h}[xi](){return this[fi]}[Di](t,e){t>=this[oi]&&this[Mi]().then(this[Oi])}[Ri](){this.trigger(Wi.Events[ki])}[Li](){return new Promise(t=>{this[Ei](_.a.now())?this[Mi]().then(t):t()})}[Mi](){return new Promise(t=>{r.connected?this[wi](t):r.on(r.TAFLINK_INITED,()=>{this[wi](t)})})}[wi](t){this[mi]||(this[mi]=new tt.HUYA.GetCdnTokenExReq),this[mi].sFlvUrl=this._sFlvUrl,this[mi].sStreamName=this._sStreamName,this[mi].tId=r.getUserId(),this[mi].iAppId=v.a.appid,n.a.log("".concat(Wi.name,".").concat(Mi,".req="),this._req),this[oi]=Number.MAX_SAFE_INTEGER;let e=Fi,i=bi;r.sendWup(e,i,this._req,e=>{let i="";i=e.sFlvToken,n.a.log("".concat(Wi.name,".").concat(Mi," sAntiCode=").concat(i,", rsp="),e),this[Ii](i),t()},!0,r.getRequestId())}}Wi.Events={[ki]:Ui};var Gi=Wi;let Yi="loaded",qi="error",Ki="timeout",ji=new Map;class zi extends Ht{constructor(t){super(),this._libName=t,this._id=t.replace(".js","_script"),this._script=document.getElementById(this._id),this._loaded=!!this._script,this._onLoadBind=this._onLoad.bind(this),this._onErrorBind=this._onError.bind(this)}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(this._loaded)this.trigger(Yi,2);else{let i=this._script;i||(i=document.createElement("script"),i.id=this._id,i.async=!0,i.onload=i.onreadystatechange=this._onLoadBind,i.onerror=this._onErrorBind,i.src=t.endsWith("/")?t+this._libName:t+"/"+this._libName,document.getElementsByTagName("head")[0].appendChild(i),this._script=i,X.once(this._onTimeout,this,e))}}_onLoad(){let t=this._script,e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,this._loaded=!0,X.remove(this._onTimeout,this),this.trigger(Yi,1))}_onTimeout(){this._clear(),this.trigger(Ki)}_onError(){this._clear(),this.trigger(qi)}_clear(){let t=this._script;t&&(t.onload=t.onreadystatechange=t.onerror=null,t.src="",t.parentNode&&t.parentNode.removeChild(t),this._script=null)}}var Ji=function(t,e,i){let{onLoaded:s=null,onError:r=null,onTimeout:a=null,thisObj:o=null,timeout:n=6e4}=i,h=ji.get(e);return h||(h=new zi(e),ji.set(e,h)),s&&h.on(Yi,s,o),r&&h.on(qi,r,o),a&&h.on(Ki,a,o),h.load(t,n),h},Qi=function(t,e){let{onLoaded:i=null,onError:s=null,onTimeout:r=null,thisObj:a=null}=e,o=ji.get(t);o&&(i&&o.off(Yi,i,a),s&&o.off(qi,s,a),r&&o.off(Ki,r,a))};const Xi={ppio:"ppio",xy:"xy"},$i={ppio:"EcdnLive.js",xy:"XYLive.js"},Zi="LOAD_FAIL",ts="GATHER_SUC",es="GATHER_FAIL",is="DATA",ss="LOAD_STOP",rs="LOAD_FINISH",as="SDK_DESTROYED";let os={};class ns extends Ht{constructor(){super(),this._pcdnName="",this._loader=null,this._lastDataTs=0,this._started=!1,this._speed=new O(10),this._callbacks={onLoaded:this._onLoadLibSUc,onError:this._onLoadLibErr,thisObj:this},this._binds={},this._binds[Zi]=this._onLoadFail.bind(this),this._binds[ts]=this._onGatherSuc.bind(this),this._binds[es]=this._onGatherFail.bind(this),this._binds[is]=this._onData.bind(this),this._binds[ss]=this._onLoadStop.bind(this),this._binds[rs]=this._onLoadFinish.bind(this),this._binds[as]=this._sdkDestroy.bind(this)}static hasPcdn(t){return!!Xi[t]}setPcdnName(t){this._pcdnName=t}isLibReady(){return os[this._pcdnName]}loadLib(t){this.isLibReady()?this.trigger(ns.BaseEvents.LIB_READY,{type:ns.BaseEvents.LIB_READY,isFirst:!1}):Ji(t,$i[this._pcdnName],this._callbacks)}_onLoadLibSUc(){Qi($i[this._pcdnName],this._callbacks),this._hasInterface()?(os[this._pcdnName]=1,this.trigger(ns.BaseEvents.LIB_READY,{type:ns.BaseEvents.LIB_READY,isFirst:!0})):this.trigger(ns.BaseEvents.LIB_ERR,{type:ns.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," has no constructor!")})}_hasInterface(){return this._pcdnName===Xi.ppio?!!window.EcdnLive:this._pcdnName===Xi.xy&&!!window.xyvp&&!!window.xyvp.Loader}_createLoader(){this._pcdnName===Xi.ppio?this._loader=new window.EcdnLive({appId:"huya",debug:!1,logLevel:""}):this._pcdnName===Xi.xy&&(this._loader=new window.xyvp.Loader),this._doPcdnEvents(!0)}_destroyLoader(){this._loader&&(this._doPcdnEvents(!1),this._loader.stopLoad(),this._loader.stopPeerGather(),this._loader.destroy(),this._loader=null)}_doPcdnEvents(t){if(this._loader)for(let e in this._binds)t?this._loader.on(e,this._binds[e]):this._loader.off(e,this._binds[e])}_onLoadLibErr(){this.trigger(ns.BaseEvents.LIB_ERR,{type:ns.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," load_fail")})}_onLoadFail(){this.trigger(ns.LoadEvents.LOAD_FAIL,{type:ns.LoadEvents.LOAD_FAIL})}_onData(t){0===this._lastDataTs&&(this.trigger(ns.LoadEvents.LOAD_SUC,{type:ns.LoadEvents.LOAD_SUC}),X.remove(this.onConnectTimeout,this));let e="xy"===this._pcdnName?t:t.data;this._lastDataTs=_.a.now(),this._speed.addCur(e.byteLength),this.trigger(ns.LoadEvents.DATA,{type:ns.LoadEvents.DATA,data:e})}_onGatherSuc(){this.trigger(ns.BaseEvents.GATHER_SUC,{type:ns.BaseEvents.GATHER_SUC})}_onGatherFail(){this.trigger(ns.BaseEvents.GATHER_FAIL,{type:ns.BaseEvents.GATHER_FAIL})}_onLoadStop(){this.trigger(ns.LoadEvents.LOAD_STOP,{type:ns.LoadEvents.LOAD_STOP})}_onLoadFinish(){this.trigger(ns.LoadEvents.LOAD_FINISH,{type:ns.LoadEvents.LOAD_FINISH})}_sdkDestroy(){this.trigger(ns.LoadEvents.SDK_DESTROYED,{type:ns.LoadEvents.SDK_DESTROYED})}getName(){return this._pcdnName}get speed(){let t=this._speed.average();return t===R.b.UintMax&&(t=0),t}get connected(){return this._lastDataTs>0}create(){this._destroyLoader(),this._createLoader()}startPeerGather(t){this._callPcdn("startPeerGather",[t])}stopPeerGather(){this._callPcdn("stopPeerGather")}refreshUrl(t){this._callPcdn("refreshUrl",[t])}startLoad(t,e){n.a.log("PcdnLoader.startLoad url="+t,JSON.stringify(e)),this._started=!0,this._lastDataTs=0,X.once(this.onConnectTimeout,this,1e3),this._callPcdn("startLoad",[t,e])}onConnectTimeout(){this.trigger(ns.LoadEvents.CONNECT_TIMEOUT,{type:ns.LoadEvents.CONNECT_TIMEOUT})}stopLoad(t){this._started&&(this._lastDataTs=0,this._started=!1,this._speed.reset(),X.remove(this.onConnectTimeout,this),this._callPcdn("stopLoad",{reason:t}))}destroy(){this.clear(),this._lastDataTs=0,this._started=!1,X.remove(this.onConnectTimeout,this),this._doPcdnEvents(!1),this._callPcdn("destroy")}close(){this.clear(),this._doPcdnEvents(!1),this.stopLoad(),this.stopPeerGather(),this._callPcdn("destroy"),this._loader=null}_callPcdn(t,e){this._loader&&this._loader[t]?(n.a.log("PcdnLoader.".concat(t," ").concat(this._pcdnName," ").concat(e?JSON.stringify(e):"")),this._loader[t].apply(this._loader,e)):n.a.log("PcdnLoader.".concat(t," ").concat(this._pcdnName," hasLoader=").concat(!!this._loader," hasInterface=").concat(!!this._loader&&!!this._loader[t]))}onCheckTimer(t,e){this._speed.calculate()}onCheckFastTimer(t,e){this._lastDataTs>0&&t-this._lastDataTs>=2e3&&(this._lastDataTs=t,this.trigger(ns.LoadEvents.DATA_TIMEOUT,{type:ns.LoadEvents.DATA_TIMEOUT}))}}ns.BaseEvents={LIB_READY:"LIB_READY",LIB_ERR:"LIB_ERR",GATHER_SUC:"GATHER_SUC",GATHER_FAIL:"GATHER_FAIL"},ns.LoadEvents={CONNECT_TIMEOUT:"CONNECT_TIMEOUT",LOAD_SUC:"LOAD_SUC",DATA:"DATA",DATA_TIMEOUT:"DATA_TIMEOUT",LOAD_FAIL:"LOAD_FAIL",LOAD_STOP:"LOAD_STOP",LOAD_FINISH:"LOAD_FINISH",SDK_DESTROYED:"SDK_DESTROYED"};var hs=ns,ds=s(21);function ls(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function cs(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ls(Object(i),!0).forEach((function(e){Object(ds.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ls(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class us{constructor(t){this.handler=t,this._newLink(),this.status=0,this.url=null,this.started=!1,this.headers=null,this.isClose=!1}_newLink(){h.a.firefox&&mt.isSupported()?this.link=new mt(this):$.isMacChrome72()?this.link=new pt(this):this.link=new _t(this)}abort(){this.link.destroy()}reset(){this.status=0,this.url=null,this.started&&(n.a.log("ProtoLinkLoader.reset"),this.link.destroy(),this._newLink())}connect(t){t?(this.reset(),n.a.log("ProtoLinkLoader.connect url="+t),this.headers=null,this.isClose=!1,this.url=t,this.link.connect(this.url),this.started=!0):n.a.warn("ProtoLinkLoader.connect url is null")}close(){this.isClose=!0,n.a.log("ProtoLinkLoader pcdn 302.close"),this.reset(),this.started=!1}onstatus(t){this.status=t}onheader(t){this.headers=t,n.a.log("ProtoLinkLoader.onheader",t),this.handler&&this.handler.onheader&&this.handler.onheader(t)}onopen(){n.a.log("ProtoLinkLoader.onopen"),this.handler&&this.handler.onopen&&this.handler.onopen()}onclose(){this.started&&this.handler&&this.handler.onclose&&(n.a.log("ProtoLinkLoader.onclose"),this.handler.onclose())}onerror(t,e){n.a.log("ProtoLinkLoader.onerror",e),this.handler&&this.handler.onerror&&this.handler.onerror(t,e)}onData(t){this.handler&&this.handler.onData&&this.handler.onData(t)}on302(t){this.handler&&this.handler.on302&&this.handler.on302(t)}get connected(){return this.link&&this.link.connected}}us.DEFAULT_GET_PROXY_PERIOD=4e3;var ps=us,ms={CLOSED:1,TAF_REQ:2,TAF_RSP:3,PCDN_NAME:4,LIB_LOAD:5,LIB_FAIL:6,GATHER_START:7,GATHER_FAIL:8,GATHER_SUC:9,LOAD_START:10,LOAD_TIMEOUT:11,LOAD_DATA_TIMEOUT:12,LOAD_STOP:13,LOAD_FAIL:14,LOAD_SUC:15,LOAD_FINISH:16,SDK_DESTROYED:17,KICK_ERROR:18,WAIT_CDN_LOAD:19,DTS_ERROR:20},_s=new class{constructor(){if(this.ignoreDomains=[],f.a.hasOwnProperty("_p_i_domains")){let t=f.a.getItem("_p_i_domains");this.ignoreDomains=t.split(",,")}}addIgnoreDomain(t){const e=this._getDomain(t);n.a.log("PcdnDomainStore.addIgnoreDomain domain=".concat(e)),-1===this.ignoreDomains.indexOf(e)&&(this.ignoreDomains.push(e),this.ignoreDomains.length>10&&this.ignoreDomains.shift(),f.a.setItem("_p_i_domains",this.ignoreDomains.join(",,")))}isIgnoreDomain(t){if(0===o.a.pcdnFlvIgnore)return!1;const e=this._getDomain(t);return-1!==this.ignoreDomains.indexOf(e)}_getDomain(t){let e=t.split("//"),i="";1===e.length?i=e[0]:e.length>1&&(i=e[1]);let s=i.split("/");return s.length>0?s[0]:""}};const fs={ppio:"ppio",xy:"xy",qn:"qn"};class gs extends Ht{constructor(t,e){super(),this.handler=t,this._flvPlayer=e,this._pcdnName="",this._loader=null,this._lastDataTs=0,this._firstDataTs=0,this._lastCheckRecvTs=0,this._started=!1,this._loader=new ps(this),this._speed=new O(10),this.flvVUrl=[],this.usePcdn=!1,this.resetStats(),this.isStart=!1,this.pcdnErrorCnt=0,this.flvStream=new ke("pcdn")}destroy(){this.clear(),this.close()}static hasPcdn(t){return!!fs[t]}startLoader(){this.pcdnErrorCnt=0,this.isStart=!0,this.reqPcdn()}reqPcdn(){if(this.usePcdn||!this.isStart)return;if(1==o.a.pcdn302FlvBakCfg[0]&&this.pcdnErrorCnt>3)return;this.flvVUrl.length=0,this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.TAF_REQ),this.handler.setFlvPcdnState(ms.TAF_REQ);let t=new tt.HUYA.ClientGetPcdnFlvHttpFullstreamInfoReq;t.lReqTs=Date.now(),t.lUid=v.a.uid,t.sGuid=v.a.sGuid,t.lAnchorUid=this._flvPlayer.info.presenterUid,t.iCdnLine=this._flvPlayer.info.lineType,t.iCliType=tt.HUYA.EM_CLINET_TYPE.E_CLIENT_WEB,t.sStreamName=this._flvPlayer.info.sStreamName,t.iRatio=this._flvPlayer.info.iBitRate,t.sCodec="264",this._flvPlayer.isH265?t.sCodec="265":this._flvPlayer.isAv1&&(t.sCodec="av1"),t.lBucketPara=Number(f.a.randomPcdnPercent)||0,t.iBusiType=tt.HUYA.EM_BUSI_TYPE.E_BusiType_Live,t.curPcdnName="",t.supportV6=0,t.sUserAgent="",n.a.log("PcdnLoader302.reqPcdn req, pcdnErrorCnt=".concat(this.pcdnErrorCnt),t),this.pcdn302CoreStats.get_subs_url_cnt++,r.sendWup("hypcdngw","onClientGetPcdnFlvHttpFullstreamInfo",t,t=>{n.a.log("PcdnLoader302.reqPcdn res",t),this._rspPcdn302(t)},!0,r.getRequestId()),X.once(this.timeoutGetPcdn,this,3e3)}timeoutGetPcdn(){n.a.log("PcdnLoader302.reqPcdn timeoutGetPcdn"),this.pcdn302CoreStats.get_pcdn_url_timeout_cnt++}_rspPcdn302(t){if(X.remove(this.timeoutGetPcdn,this),!t||0!=t.iErrCode)return void this.pcdn302CoreStats.get_subs_url_error_cnt++;this.pcdn302CoreStats.get_pcdn_url_total_cnt++,this._pcdnName=t.sPcdnName,this.handler._loadPcdn302Rsp(t);const e=t.mAllPullStreamUrl.value.https;100==e.iStatusPcdn?(this.flvVUrl=e.vUrl.value,this.flvVUrl.length>0&&_s.isIgnoreDomain(this.flvVUrl[0])?(this.flvVUrl.length=0,this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.PCDN_NAME),this.handler.setFlvPcdnState(ms.PCDN_NAME)):this._onGatherSuc(),this.pcdn302CoreStats.get_pcdn_url_success++):(this._onGatherFail(e.iStatusPcdn),101==e.iStatusPcdn?this.pcdn302CoreStats.get_pcdn_err_not_reached++:102==e.iStatusPcdn?this.pcdn302CoreStats.get_pcdn_err_over_run++:103==e.iStatusPcdn?this.pcdn302CoreStats.get_pcdn_err_not_coverd++:this.pcdn302CoreStats.get_pcdn_err_other++)}_onGatherSuc(){this.trigger(gs.BaseEvents.GATHER_SUC,{type:gs.BaseEvents.GATHER_SUC})}_onGatherFail(t){this.trigger(gs.BaseEvents.GATHER_FAIL,{type:gs.BaseEvents.GATHER_FAIL,data:t})}getName(){return this._pcdnName}get speed(){let t=this._speed.average();return t===R.b.UintMax&&(t=0),t}get connected(){return this._lastDataTs>0}refreshUrl(t){this.url=t}startLoad(t){if(this.pcdn302CoreStats.get_stream_cnt++,n.a.log("PcdnLoader302.startLoad",JSON.stringify(t)),this._started=!0,this._lastDataTs=0,this._firstDataTs=0,this.flvVUrl.length>0){this.flvStream.on(ke.Events.FLV_TAG,this._onFlvTag,this),this.flvStream.on(ke.Events.CATCH_START_DTS,this._onCatchStartDts,this),this.flvStream.on(ke.Events.DIS_ERROR,this._onDisError,this),this.flvStream.on(ke.Events.INVALID_TAG,this._onInvalidTag,this),this.flvStream.startLoad(t.startDts);let e=this.handler.getPcdn302Params(this.flvVUrl[0]);e+="&dts=".concat(t.startDts),this._loader.connect(e),X.once(this.onConnectTimeout,this,1e3)}else this.trigger(gs.LoadEvents.CONNECT_TIMEOUT,{type:gs.LoadEvents.CONNECT_TIMEOUT})}onConnectTimeout(){o.a.platform===N.a.PLATFORM_TYPE_NAME.wap&&this.pcdnErrorCnt++,this.pcdn302CoreStats.get_stream_error_cnt++,this.pcdn302CoreStats.switch_time_out_cnt++,this.trigger(gs.LoadEvents.CONNECT_TIMEOUT,{type:gs.LoadEvents.CONNECT_TIMEOUT})}onDataTimeout(){this.pcdn302CoreStats.get_stream_error_cnt++,this.pcdn302CoreStats.switch_no_data_cnt++}stopLoad(t){this._started&&(this._lastDataTs=0,this._firstDataTs=0,this._started=!1,this._speed.reset(),X.remove(this.onConnectTimeout,this),this._loader.close()),this.flvStream.reset(),this.flvStream.off(ke.Events.FLV_TAG,this._onFlvTag,this),this.flvStream.off(ke.Events.CATCH_START_DTS,this._onCatchStartDts,this),this.flvStream.off(ke.Events.DIS_ERROR,this._onDisError,this)}close(){this.stopLoad(),this.flvVUrl.length}onCheckTimer(t,e){this._started&&this._speed.calculate()}onCheckFastTimer(t,e){this._started&&(this._lastDataTs>0&&t-this._lastDataTs>=2e3&&(this._lastDataTs=t,this.trigger(gs.LoadEvents.DATA_TIMEOUT,{type:gs.LoadEvents.DATA_TIMEOUT})),t-this._firstDataTs>5e3&&this.onPlayError())}onPlayError(){let t=_.a.now();if(!(t-this._lastCheckRecvTs<1e3)&&(this._lastCheckRecvTs=t,this._flvPlayer&&this._flvPlayer.mse&&this._flvPlayer.mse.parser)){const t=this._flvPlayer.mse.parser;if(t.downFrameRate.getSize()>5){const e=t.getRealFps(),i=t.downFrameRate.getLastRate(5);e>0&&i>0&&i<.8*e&&(n.a.log("PcdnLoader302.onCheckFastTimer dataslow recvFps=".concat(i," realFps=").concat(e)),this.flvVUrl.length>0&&_s.addIgnoreDomain(this.flvVUrl[0]),this.trigger(gs.LoadEvents.DATA_TIMEOUT,{type:gs.LoadEvents.DATA_TIMEOUT}))}}}onData(t){const e=_.a.now();0===this._lastDataTs&&(this._firstDataTs=e,this.trigger(gs.LoadEvents.LOAD_SUC,{type:gs.LoadEvents.LOAD_SUC}),X.remove(this.onConnectTimeout,this)),this._lastDataTs=e,this._speed.addCur(t.byteLength),this.trigger(gs.LoadEvents.DATA,{type:gs.LoadEvents.DATA,data:t}),1===o.a.pcdnFlvSyncMob&&this.flvStream.parseFlv(t)}_onFlvTag(t){this.trigger(gs.LoadEvents.FLV_TAG,{type:gs.LoadEvents.FLV_TAG,tag:t})}_onInvalidTag(t){this.trigger(gs.LoadEvents.INVALID_TAG,{type:gs.LoadEvents.INVALID_TAG,tag:t})}_onCatchStartDts(){this.trigger(gs.LoadEvents.SWAP_SUC,{type:gs.LoadEvents.SWAP_SUC})}_onDisError(){this.trigger(gs.LoadEvents.DIS_ERROR,{type:gs.LoadEvents.DIS_ERROR})}onclose(){if(this._loader.isClose)return;const t=_.a.now();0!=this._firstDataTs&&t-this._firstDataTs>=5e3?this.pcdn302CoreStats.switch_cmerr_cnt++:(this.pcdn302CoreStats.get_stream_error_cnt++,this.pcdn302CoreStats.switch_cdn_err_cnt++,this.pcdnErrorCnt++),this.trigger(gs.LoadEvents.LOAD_FAIL,{type:gs.LoadEvents.LOAD_FAIL})}onerror(t,e){if(this._loader.isClose)return;"number"==typeof e&&(this.httpCode=e);const i=_.a.now();0!=this._firstDataTs&&i-this._firstDataTs>5e3?this.pcdn302CoreStats.switch_cmerr_cnt++:(this.pcdn302CoreStats.get_stream_error_cnt++,this.pcdn302CoreStats.switch_cdn_err_cnt++,this.pcdnErrorCnt++),this.trigger(gs.LoadEvents.LOAD_FAIL,{type:gs.LoadEvents.LOAD_FAIL})}dtsError302(){this.pcdn302CoreStats.switch_cdn_dts_err_cnt++}getPcdn302Stats(){const t=cs({},this.pcdn302CoreStats),e=cs({},this.pcdn302DimStats);return this.resetStats(),{pcdn302CoreStats:t,pcdn302DimStats:e}}resetStats(){this.httpCode=0,this.pcdn302CoreStats={get_subs_url_cnt:0,get_subs_url_error_cnt:0,get_pcdn_url_timeout_cnt:0,get_pcdn_url_total_cnt:0,get_pcdn_url_success:0,get_pcdn_err_not_reached:0,get_pcdn_err_over_run:0,get_pcdn_err_not_coverd:0,get_pcdn_err_other:0,get_stream_cnt:0,get_stream_error_cnt:0,switch_time_out_cnt:0,switch_no_data_cnt:0,switch_cdn_err_cnt:0,switch_cdn_dts_err_cnt:0,pcdn_kick_out_cnt:0,switch_cmerr_cnt:0}}}gs.BaseEvents={LIB_READY:"LIB_READY",GATHER_SUC:"GATHER_SUC",GATHER_FAIL:"GATHER_FAIL"},gs.LoadEvents={CONNECT_TIMEOUT:"CONNECT_TIMEOUT",LOAD_SUC:"LOAD_SUC",DATA:"DATA",SWAP_SUC:"SWAP_SUC",DIS_ERROR:"DIS_ERROR",FLV_TAG:"FLV_TAG",INVALID_TAG:"INVALID_TAG",DATA_TIMEOUT:"DATA_TIMEOUT",LOAD_FAIL:"LOAD_FAIL",KICK_ERROR:"KICK_ERROR"};var Ss=gs;var ys=class{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._flvPlayer=t,this._flvLoader=new xe(this,t,e),this._pcdnLoader=new hs,this._pcdn302Loader=new Ss(this,t),this._sPcdnName="",this._requesting=!1,this._loader=null,this._swapTs=0,this._gatherSuc=!1,this._failCnt=0,this._cdnCnt=0,this._pullNum=0,this.url="",this._checkSampleBind=this._checkSample.bind(this),this._disError302Bind=this._disError302.bind(this),this._reqPcdn302Ts=0,this._startDtsType=0,this.startDts=0,this.isOnPlayVideo=!1}getPullNum(){if(0===this._pullNum)return 0;let t=this._pullNum;return this._pullNum++,t}get connected(){return this._loader&&this._loader.connected}get speed(){return this._loader&&this._loader.speed}destroy(){this._doPcdn302EventHandler(Ss.LoadEvents,!1),this._doPcdn302EventHandler(Ss.BaseEvents,!1),this._flvLoader&&this._flvLoader.destroy(),this._flvLoader=null,this._pcdnLoader&&this._pcdnLoader.destroy(),this._pcdnLoader=null,this._pcdn302Loader&&this._pcdn302Loader.destroy(),this._pcdn302Loader=null}close(){n.a.log("LoaderCtrl.close"),this._flvPlayer.anticode.off(Gi.Events.REFRESH,this._onAnticodeRefresh,this),this._flvLoader.close(),this._pcdnLoader.close(),this._pcdn302Loader.close(),this._requesting=!1,this._loader=null,this._failCnt=0,this._gatherSuc=!1,this._swapTs=0,this._sPcdnName="",this._reqPcdn302Ts=0}checkPcdnMode(t){this._reqPcdn(t),this.isOnPlayVideo&&this._flvPlayer.info.use302Pcdn&&!this._isClosePcdn()&&(this._reqPcdn302Ts=_.a.now(),this._pcdn302Loader.startLoader())}onPlayError(){this._pcdn302Loader&&this._pcdn302Loader.onPlayError()}onPlayVideo(){this._flvPlayer.info.use302Pcdn&&!this._isClosePcdn()?(this._reqPcdn302Ts=_.a.now(),this._pcdn302Loader.startLoader()):this.isOnPlayVideo=!0}connect(t){this.close(),this.url=t,this._connect(t,"firstCdn"),this._flvPlayer.info.use302Pcdn||this._reqPcdn()}_connect(t,e){this._cdnCnt++,t=this._getUrlParams(t,!1,e),n.a.log("LoaderCtrl._connect",t),this._flvPlayer.anticode.off(Gi.Events.REFRESH,this._onAnticodeRefresh,this),this._stopPcdn(e);let i=t;const s=this._flvPlayer.mse.getIframePts();s>0&&(-1!==i.indexOf("?")?i+="&startPts=".concat(s):i+="?startPts=".concat(s)),this._flvLoader.connect(i,s>0?s:-1),this._loader=this._flvLoader,this.url=this._flvLoader.url?this._flvLoader.url:t,this._flvPlayer.stat.setComDim(d.a.DIM_COM.STREAM_URL,this.url)}_stopPcdn(t){this._doPcdnEventHandler(hs.LoadEvents,!1),this._pcdnLoader.stopLoad(t),this._pcdn302Loader.stopLoad(t)}_isClosePcdn(){let t=this._flvPlayer.info;return!((!t||!t.isPureAudio)&&(o.a.isNotUsePcdn(t.presenterUid,t.uid)||o.a.isCloseFlvPcdnUser(t.uid)?(n.a.log("LoaderCtrl._isClosePcdn config close uid!"),0):o.a.isCloseFlvPcdnPid(t.presenterUid)?(n.a.log("LoaderCtrl._isClosePcdn config close pid!"),0):o.a.isCloseFlvPcdnBroVer()?(n.a.log("LoaderCtrl._isClosePcdn config close broVer!"),0):0===o.a.pcdnMseFlv&&this._flvPlayer.isMse?(n.a.log("LoaderCtrl._isClosePcdn config close pcdnMseFlv!"),0):1==f.a._closePcdn?(n.a.log("LoaderCtrl._isClosePcdn host close"),0):!t.isAuto||Number(o.a.closePcdn500)!==t.curBitrate||(n.a.log("LoaderCtrl._isClosePcdn closePcdn500"),0)))}_reqPcdn(t){if(!this._isClosePcdn())if(f.a._pcdnName&&(this._flvPlayer.info.usePcdn=1),1!==this._flvPlayer.info.usePcdn&&1!=this._flvPlayer.info.use302Pcdn&&(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.CLOSED),this.setFlvPcdnState(ms.CLOSED)),1===this._flvPlayer.info.use302Pcdn)this.setFlvPcdnState(ms.WAIT_CDN_LOAD),this._doPcdn302EventHandler(Ss.BaseEvents,!0),this._doPcdn302EventHandler(Ss.LoadEvents,!0),this._pcdn302Loader._pcdnName=this._flvPlayer._getPcdn302Name(t);else if(1===this._flvPlayer.info.usePcdn&&!this._requesting&&""===this._sPcdnName){this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.TAF_REQ),this.setFlvPcdnState(ms.TAF_REQ),this._requesting=!0;let t=new tt.HUYA.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq;t.lReqTs=Date.now(),t.lUid=v.a.uid,t.sGuid=v.a.sGuid,t.lAnchorUid=this._flvPlayer.info.presenterUid,t.iCdnLine=this._flvPlayer.info.lineType,t.iCliType=tt.HUYA.EM_CLINET_TYPE.E_CLIENT_WEB,t.lBucketPara=Number(f.a.randomPcdnPercent)||0,t.iBusiType=tt.HUYA.EM_BUSI_TYPE.E_BusiType_Live,t.vCliSupportPcdns.value=["ppio","xy"],t.sStreamName=this._flvPlayer.info.sStreamName,this._flvPlayer.isH265?t.sCodec="265":this._flvPlayer.isAv1?t.sCodec="av1":t.sCodec="264",n.a.log("LoaderCtrl.reqPcdn req",t),r.sendWup("hypcdngw","onClientGetPcdnFlvOutsideSdkFullstreamInfo",t,t=>{n.a.log("HYPlayer.reqPcdn res",t),!t||0!=t.iErrCode&&7!=t.iErrCode||this._rspPcdn(t)},!0,r.getRequestId())}}_rspPcdn(t){this._requesting=!1,f.a._pcdnName&&(t.sPcdnName=f.a._pcdnName),this._sPcdnName!==t.sPcdnName&&(this._sPcdnName=t.sPcdnName,this._flvPlayer.stat.setComDim(d.a.DIM_COM.PCDN_ORIGIN,t.sPcdnName),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.TAF_RSP),this.setFlvPcdnState(ms.TAF_RSP),this._loadPcdn())}onCheckTimer(t,e){if(this._loader&&this._loader.onCheckTimer(t,e),this._checkSwapToPcdn(t),this._flvPlayer&&this._flvPlayer.info&&this._flvPlayer.info.use302Pcdn){const t=_.a.now();0!=this._reqPcdn302Ts&&t-this._reqPcdn302Ts>=1e3*o.a.pcdn302FlvCfg[1]&&(this._pcdn302Loader.reqPcdn(),this._reqPcdn302Ts=t)}}_checkSwapToPcdn(t){if(this._flvPlayer&&this._flvPlayer.info&&1===this._flvPlayer.info.use302Pcdn){if(t>this._swapTs&&this._gatherSuc&&this._flvPlayer.getBufferLen()>o.a.flvToPcdnBuf&&this._loader!==this._pcdn302Loader)return this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_START),this.setFlvPcdnState(ms.LOAD_START),0===o.a.pcdnFlvSyncMob&&this._flvLoader.close(),this._swapToPcdn(),!0}else if(t>this._swapTs&&this._gatherSuc&&this._flvPlayer.getBufferLen()>o.a.flvToPcdnBuf&&this._loader!==this._pcdnLoader)return this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_START),this.setFlvPcdnState(ms.LOAD_START),this._swapToPcdn(),!0;return!1}onCheckFastTimer(t,e){this._loader&&this._loader.onCheckFastTimer&&this._loader.onCheckFastTimer(t,e),this._loader!==this._flvLoader&&this._flvPlayer.getBufferLen()<=o.a.flvToCdnBuf&&this._swapToCdn(11)}_loadPcdn(){hs.hasPcdn(this._sPcdnName)?(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LIB_LOAD),this.setFlvPcdnState(ms.LIB_LOAD),this._doPcdnEventHandler(hs.BaseEvents,!0),this._pcdnLoader.setPcdnName(this._sPcdnName),this._pcdnLoader.loadLib(this._flvPlayer.info.h5Root)):(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.PCDN_NAME),this.setFlvPcdnState(ms.PCDN_NAME))}_loadPcdn302Rsp(t){this._sPcdnName=t.sPcdnName,this._flvPlayer.stat.setComDim(d.a.DIM_COM.PCDN_ORIGIN,t.sPcdnName),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.TAF_RSP),this.setFlvPcdnState(ms.TAF_RSP)}_doPcdnEventHandler(t,e){for(let i in t){let s=t[i];e?this._pcdnLoader.on(s,this._onPcdnEventHandler,this):this._pcdnLoader.off(s,this._onPcdnEventHandler,this)}}_doPcdn302EventHandler(t,e){n.a.log("LoaderCtrl._doPcdn302EventHandler",e);for(let i in t){let s=t[i];e?this._pcdn302Loader.on(s,this._onPcdn302EventHandler,this):this._pcdn302Loader.off(s,this._onPcdn302EventHandler,this)}}_onPcdnEventHandler(t){if(!(this._flvPlayer&&this._flvPlayer.info&&this._flvPlayer.info.use302Pcdn))switch(t.type!==hs.LoadEvents.DATA&&n.a.log("LoaderCtrl._onPcdnEventHandler",t.type,t.msg),t.type){case hs.BaseEvents.LIB_READY:t.isFirst&&this._reportPcdnLibAct([0],[this._pcdnLoader.getName()]),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.GATHER_START),this.setFlvPcdnState(ms.GATHER_START),this._pcdnLoader.create(),this._pcdnLoader.startPeerGather(this._getUrl(!0));break;case hs.BaseEvents.LIB_ERR:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LIB_FAIL),this._reportPcdnLibAct([100],[this._pcdnLoader.getName()]),this.setFlvPcdnState(ms.LIB_FAIL);break;case hs.LoadEvents.CONNECT_TIMEOUT:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_TIMEOUT),this.setFlvPcdnState(ms.LOAD_TIMEOUT),this._swapToCdn(t.type);break;case hs.LoadEvents.DATA_TIMEOUT:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_DATA_TIMEOUT),this.setFlvPcdnState(ms.LOAD_DATA_TIMEOUT),this._swapToCdn(t.type);break;case hs.LoadEvents.LOAD_SUC:this._failCnt=0,this._flvLoader.close(),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_SUC),this.setFlvPcdnState(ms.LOAD_SUC),this._beforeSwap(gt);break;case hs.LoadEvents.LOAD_FAIL:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_FAIL),this.setFlvPcdnState(ms.LOAD_FAIL),this._swapToCdn(t.type);break;case hs.BaseEvents.GATHER_SUC:this._gatherSuc=!0,n.a.log("LoaderCtrl gather_suc",this._loader!==this._pcdnLoader),this._checkSwapToPcdn(_.a.now())||this._loader===this._pcdnLoader||(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.GATHER_SUC),this.setFlvPcdnState(ms.GATHER_SUC));break;case hs.BaseEvents.GATHER_FAIL:this._gatherSuc=!1,this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.GATHER_FAIL),this.setFlvPcdnState(ms.GATHER_FAIL),this._swapToCdn(t.type);break;case hs.LoadEvents.DATA:this._flvPlayer.onData(t.data,gt);break;case hs.LoadEvents.LOAD_STOP:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_STOP),this.setFlvPcdnState(ms.LOAD_STOP),this._swapToCdn(t.type);break;case hs.LoadEvents.LOAD_FINISH:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_FINISH),this.setFlvPcdnState(ms.LOAD_FINISH),this._swapToCdn(t.type);break;case hs.LoadEvents.SDK_DESTROYED:this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.SDK_DESTROYED),this.setFlvPcdnState(ms.SDK_DESTROYED),this._swapToCdn(t.type)}}_onPcdn302EventHandler(t){if(!this._flvPlayer||!this._flvPlayer.info||this._flvPlayer.info.use302Pcdn)switch(t.type){case Ss.BaseEvents.GATHER_SUC:this._gatherSuc=!0,n.a.log("LoaderCtrl._onPcdn302EventHandler, GATHER_SUC",this._loader!==this._pcdn302Loader),this._checkSwapToPcdn(_.a.now())||this._loader===this._pcdn302Loader||(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.GATHER_SUC),this.setFlvPcdnState(ms.GATHER_SUC));break;case Ss.BaseEvents.GATHER_FAIL:n.a.log("LoaderCtrl._onPcdn302EventHandler, GATHER_FAIL",t.data),this._gatherSuc=!1,this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.GATHER_FAIL),this.setFlvPcdnState(ms.GATHER_FAIL);break;case Ss.LoadEvents.LOAD_SUC:n.a.log("LoaderCtrl._onPcdn302EventHandler, LOAD_SUC"),this._failCnt=0,this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_SUC),this.setFlvPcdnState(ms.LOAD_SUC),this._beforeSwap(gt);break;case Ss.LoadEvents.DATA:this._flvPlayer.onData(t.data,gt);break;case Ss.LoadEvents.SWAP_SUC:this._pcdn302Loader.flvStream.setOutputDts(this._flvLoader.flvStream.getOutputDts()),this._flvLoader.close();break;case Ss.LoadEvents.DIS_ERROR:this._disError302();break;case Ss.LoadEvents.FLV_TAG:this._flvPlayer.onFlvTag(t.tag);break;case Ss.LoadEvents.INVALID_TAG:this._flvPlayer.onInvalidTag(t.tag,gt);break;case Ss.LoadEvents.CONNECT_TIMEOUT:n.a.log("LoaderCtrl._onPcdn302EventHandler, CONNECT_TIMEOUT"),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.CONNECT_TIMEOUT),this.setFlvPcdnState(ms.CONNECT_TIMEOUT),this._swapToCdn(t.type);break;case Ss.LoadEvents.DATA_TIMEOUT:const e=this._flvPlayer.getBufferLen();n.a.log("LoaderCtrl._onPcdn302EventHandler, DATA_TIMEOUT, bufLen=".concat(e)),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_DATA_TIMEOUT),this._pcdn302Loader.onDataTimeout(),this.setFlvPcdnState(ms.LOAD_DATA_TIMEOUT),this._swapToCdn(t.type);break;case hs.LoadEvents.LOAD_FAIL:n.a.log("LoaderCtrl._onPcdn302EventHandler, LOAD_FAIL"),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.LOAD_FAIL),this.setFlvPcdnState(ms.LOAD_FAIL),this._swapToCdn(t.type);break;case Ss.LoadEvents.KICK_ERROR:n.a.log("LoaderCtrl._onPcdn302EventHandler, KICK_ERROR"),this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.KICK_ERROR),this.setFlvPcdnState(ms.KICK_ERROR),this._swapToCdn(t.type)}}_reportPcdnLibAct(t,e){this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(d.a.ACT.LOAD_PCDNLIB_ERROR,{value:t,str:e})])}_onAnticodeRefresh(){n.a.log("LoaderCtrl._onAnticodeRefresh"),this._flvPlayer.initInfo(this._flvPlayer.info,!0),1===this._flvPlayer.info.usePcdn&&this._pcdnLoader.refreshUrl(this._flvPlayer.info.url)}_checkSample(t){let e=this._flvPlayer.mse.parser;return e.lastParseDts>0&&t.ts<=e.lastParseDts||(e.setDroppingSample(null),!1)}_swapToPcdn(){this._pullNum=1,this._flvPlayer.anticode.on(Gi.Events.REFRESH,this._onAnticodeRefresh,this),this._flvPlayer&&this._flvPlayer.info&&1===this._flvPlayer.info.usePcdn&&this._doPcdnEventHandler(hs.LoadEvents,!0);const t=this._flvPlayer.getBufferLen();let e=this._flvPlayer.mse,i=e.parser||{},s=0,r=0,a=0;0===o.a.pcdnFlvSyncMob?(s=e.curVideoDts,r=e.curAudioDts,a=i.lastParseDts):(s=this._flvLoader.flvStream.lastVideoDts,r=this._flvLoader.flvStream.lastAudioDts,a=s),n.a.log("LoaderCtrl.swapToPcdn vDts=".concat(s," aDts=").concat(r," startDts=").concat(a,", bufLen=").concat(t)),this._flvPlayer&&this._flvPlayer.info&&this._flvPlayer.info.use302Pcdn?(s===a?this._startDtsType=0:r===a&&(this._startDtsType=1),this._pcdn302Loader.usePcdn=!0,this.startDts=a,this._pcdn302Loader.startLoad({startDts:a}),this._loader=this._pcdn302Loader,this._flvPlayer.stat.setComDim(d.a.DIM_COM.IS_MOSAIC,1)):(this._pcdnLoader.startLoad(this._getUrl(!0),{startDts:a}),this._loader=this._pcdnLoader),this._flvPlayer.stat.addCore(d.a.CORE.GET_STREAM_CNT,1),this._flvPlayer.swapToPcdn()}_swapToCdn(t){this._pullNum=1;let e=this._loader!==this._flvLoader;const i=this._flvPlayer.getBufferLen();if(n.a.log("LoaderCtrl.swapToCdn reason=".concat(t," swap=").concat(e,", bufLen=").concat(i)),e){if(this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(d.a.ACT.PCDN_TO_CDN,{str:[t]})]),this._failCnt++,this._flvPlayer&&this._flvPlayer.info&&this._flvPlayer.info.use302Pcdn){if(1==f.a._testPaid)return;this._swapTs=_.a.now()+1e4*Math.min(o.a.pcdn302FlvCfg[0]||6,this._failCnt)}else this._swapTs=_.a.now()+1e4*Math.min(6,this._failCnt);this._flvPlayer.stat.addCore(d.a.CORE.SWITCH_CDN_CNT,1),this._beforeSwap(ft),this._flvPlayer.initInfo(this._flvPlayer.info,!1),this._connect(this._flvPlayer.info.url,t),1===o.a.pcdnFlvSyncMob&&this._flvLoader.flvStream.setOutputDts(this.getCdnOutputDts()),this._flvPlayer&&this._flvPlayer.info&&1==this._flvPlayer.info.use302Pcdn&&(this._gatherSuc=!1),this._pcdn302Loader.usePcdn=!1,this._flvPlayer.swapToCdn()}}getCdnOutputDts(){let t=this._pcdn302Loader.flvStream.getOutputDts(),e=this._flvLoader.flvStream.getOutputDts();return{videoDts:Math.max(t.videoDts,e.videoDts),audioDts:Math.max(t.audioDts,e.audioDts)}}_getUrl(t){return this._flvPlayer.initInfo(this._flvPlayer.info,t),this._getUrlParams(this._flvPlayer.info.url,t)}_getSdkPcdnReason(t){if(this._flvPlayer.info.use302Pcdn){if(t===Ss.LoadEvents.CONNECT_TIMEOUT)return 2;if(t===Ss.LoadEvents.DATA_TIMEOUT)return 3;if(t===Ss.LoadEvents.LOAD_FAIL)return 4;if(t===Ss.LoadEvents.KICK_ERROR)return 10}else{if(t===hs.LoadEvents.CONNECT_TIMEOUT)return 2;if(t===hs.LoadEvents.DATA_TIMEOUT)return 3;if(t===hs.LoadEvents.LOAD_FAIL)return 4;if(t===hs.LoadEvents.LOAD_STOP)return 4;if(t===hs.LoadEvents.LOAD_FINISH)return 4;if(t===hs.LoadEvents.SDK_DESTROYED)return 4;if(t===hs.BaseEvents.GATHER_FAIL)return 5}return 1}_getUrlParams(t,e,i){let s="";s+=e?"pulltype=pcdn&":"sdkPcdn=".concat(this._cdnCnt,"_").concat(this._getSdkPcdnReason(i),"&");const r=o.a.platform,a=N.a.PLATFORM_TYPE[r]||N.a.PLATFORM_TYPE.web,n=r===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);return s+="".concat(n,"&t=").concat(a),s=R.b.urlInfoParams(s,this._flvPlayer.info),-1===t.indexOf("?")?t+="?":t+="&",t+s}getPcdn302Params(t){let e="";const i=o.a.platform,s=N.a.PLATFORM_TYPE[i]||N.a.PLATFORM_TYPE.web,r=i===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);return e+="".concat(r,"&t=").concat(s),e=R.b.urlInfoParams(e,this._flvPlayer.info),-1===t.indexOf("?")?t+="?":t+="&",t+e}_beforeSwap(t){if(0===o.a.pcdnFlvSyncMob){let e=this._flvPlayer.mse.parser;e.parseFlvHead=!1,e.flvCacher.reset(),this._flvPlayer.info.use302Pcdn&&e.beforeSwap&&e.beforeSwap(t,this._startDtsType,this.startDts),e.printFirstVideoTs=!1,e.printFirstAudioTs=!1,e.pfvTs=!1,e.pfaTs=!1,e.setDroppingSample(this._checkSampleBind)}}setFlvPcdnState(t){n.a.log("LoaderCtrl.setFlvPcdnState, type=".concat(t)),this._flvPlayer.flvPcdnState=t}getPcdn302Stats(){return this._pcdn302Loader.getPcdn302Stats()}_disError302(){1!=f.a._testPaid&&this._flvPlayer.info.use302Pcdn&&(this._flvPlayer.stat.setComDim(d.a.DIM_COM.FLV_PCDN_STATE,ms.DTS_ERROR),this.setFlvPcdnState(ms.DTS_ERROR),this._swapToCdn(ms.DTS_ERROR),this._pcdn302Loader.dtsError302(),n.a.log("LoaderCtrl._disError302"))}};let Ts=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,Ps=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;var vs=!1,Es=[],Cs=0,Is=null;let As=0,Ds=0,Rs=0,Os=0;function Ls(){As=Ts(Ls),function(){let t=_.a.now();if(Ds++,0===Rs)Rs=t;else{let e=t-Rs;if(e>=1e3){Rs=t;let i=Math.round(Ds/(e/1e3));Ds=0,Os=Math.max(i,Os)}}}()}function Ms(t,e){for(var i=0,s=Es.length;i<s;i++){var r=Es[i];if(r.callback==t&&r.thisObj==e)return r}return null}function ws(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!t)return n.a.error("Timer.add Invalide interval value or callback function."),!1;var a=Ms(t,e);return a||(a={callback:t,thisObj:e,bindCallback:e?t.bind(e):t,param:s},Es.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,Fs(),!0}function Fs(){Is?Is.postMessage("start"):!Cs&&Es.length>0&&(Cs=setInterval(bs,10))}function bs(){if(0!=Es.length){vs=!0;for(var t=_.a.now(),e=Es.length-1;e>=0;e--){var i=Es[e];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(t,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&Es.splice(e,1)}}else Es.splice(e,1)}vs=!1}else Is?Is.postMessage("stop"):(clearInterval(Cs),Cs=0)}var Vs={initWorker:function(){if(!Is){if(!(Is=k()(25)))return Ps(As),void(As=Ts(Ls));Is.addEventListener("message",t=>{1==t.data.type?bs():2==t.data.type&&(Os=t.data.data)}),Is.addEventListener("error",t=>{n.a.error("TimerWorker.error:",t.lineno+","+t.colno,t.message),Is.terminate(),Is=null,n.a.warn("[ TimerWorker terminate ]"),Fs()})}},has:function(t,e){return!!Ms(t,e)},add:ws,remove:function(t,e){for(var i=0,s=Es.length;i<s;i++){var r=Es[i];if(r.callback==t&&r.thisObj==e)return vs?r.delayDel=!0:Es.splice(i,1),!0}return!1},once:function(t,e,i,s){ws(t,e,i+10,s,1)},getSize:()=>Es.length,getPageFpsMax:()=>Os},Ns={UP:1,DOWN:2,BACK:3},Bs={firstVideo:1,ptsIFrame:2,evalFail:3},ks={NONE:0,NEXT_TIME:1,SAMPLE_SIZE:2,SAMPLE_LAST:3,SAMPLE_PERCENT:4,MAX_BITRATE:5,TARGET_BAD:6,TARGET_MAX:7,EVAL_BW:9,EVAL_FAIL:10,CLOSE_P2P:11},Us={NONE:0,NEXT_TIME:1,BUFFER:2,TARGET_SVR:3,TARGET_HOST:4,CLOSE_P2P:5},xs="timer",Hs="record",Ws="resume",Gs="push",Ys="heart",qs="resume",Ks="stop",js=1,zs=3;class Js{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.player=t,t.hyPlayer&&(this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat),this._newLink(),this.needRetry=e,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.headers=null,this.reconnectCnt=0}destroy(){this.link&&this.link.destroy(),this.link=null,this.player=null,this.hyPlayer=null,this.stat=null}_newLink(){h.a.firefox&&mt.isSupported()?this.link=new mt(this):$.isMacChrome72()?this.link=new pt(this):this.link=new _t(this)}abort(){this.link.destroy()}reset(){this.lastGetProxyTime=0,this.status=0,this.url=null,this.started&&(n.a.log("ShieldAudioLoaderCtrl.reset"),this.link.destroy(),this._newLink())}stop(){this.reconnectCnt=0}connect(t){t?(this.link instanceof pt&&(t=t.replace("http","ws")),this.reset(),this.lastGetProxyTime=_.a.now(),n.a.log("ShieldAudioLoaderCtrl.connect url="+t,this.lastGetProxyTime),this.headers=null,this.url=t,this.link.connect(this.url),this.started=!0):n.a.warn("ShieldAudioLoaderCtrl.connect url is null")}close(){n.a.log("ShieldAudioLoaderCtrl.close"),this.reset(),this.started=!1}onstatus(t){this.status=t}onheader(t){this.headers=t,n.a.log("ShieldAudioLoaderCtrl.onheader",t),this.player&&this.player.onHeader&&this.player.onHeader(t)}onopen(){n.a.log("ShieldAudioLoaderCtrl.onopen"),this.player.onConnected()}onclose(){n.a.log("ShieldAudioLoaderCtrl.onclose"),this.player.onClosed(),this.lastGetProxyTime=0}onerror(t,e){n.a.log("ShieldAudioLoaderCtrl.onerror",e),this.lastGetProxyTime=0,this.getProxy(),this.player.onLoadError&&this.player.onLoadError(t)}onData(t){this.player.onData(t)}onCheckTimer(t,e){if(this.started&&e%10==0){let t=this.link.speed;t!=R.b.UintMax&&(t=R.b.formatByteSize(t),n.a.log("ShieldAudioLoaderCtrl speed ".concat(t,"/s")))}}get speed(){let t=this.link.speed;return t==R.b.UintMax&&(t=0),t}get connected(){return this.link&&this.link.connected}onCheckConnect(t){this.connected||t-this.lastGetProxyTime>=2e3&&0!=this.lastGetProxyTime&&this.player&&this.player.onLoadTimeout&&(this.getProxy(),this.player.onLoadTimeout(),this.lastGetProxyTime=0)}getProxy(){this.reconnectCnt>=3||(this.reconnectCnt++,this.reset(),this.player.restart())}}Js.DEFAULT_GET_PROXY_PERIOD=4e3;var Qs=Js;let Xs=0;let $s=0,Zs=[],tr=[],er=[],ir=[],sr=0,rr=-1e4;var ar=class{constructor(t,e){this._id=$s++,this.eventEmitter=t,this.stat=e.stat,this.tsdb=e.tsdb,this.statSwitch=e.statSwitch,this.sampleController=e.sampleController,this.h265Proxy=e.h265Proxy,this.autoMonitor=e.autoMonitor,this.recSysStat=e.recSysStat,this.voiceChecker=e.voiceChecker,this.info=null,this.isH265Playing=!1,this.playerType=-1,this.started=!1,this.heart20Ts=0,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseCnt60Sec=0,this.pauseStartTs=0,this.pauseStartWorkerTs=0,this.pauseMobStartTs=0,this.pauseMobCnt=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseReason=0,this.pauseCheckLock=!1,this.videoStatus=p.VIDEO_STOP,this.isSwitchPause=!1,this._useAV1=!1,this.isAV1MediaSupported=dt.a.isMseSupportedAV01(),this.resetAiProps(),this.fastSample=new class{constructor(t){this.samples=new O(t),this.maxSize=t,this.lastTs=0,this.isOver=!1,this.callback=null}destroy(){X.remove(this.onCheckTime,this),this.callback=null,this.samples&&this.samples.reset(),this.samples=null}getResult(){let t=this.samples.getSamples(),e=t.length,i=[];for(let s=0;s<e;s++)i.push("".concat(s+1,":").concat(t[s]));return i.join(",")}start(t){this.isOver=!1,this.callback=t,X.add(this.onCheckTime,this,20)}stop(){this.callback=null,this.samples.reset(),this.lastTs=0,X.remove(this.onCheckTime,this)}setOver(){if(!this.isOver){this.isOver=!0;let t=this.getResult();n.a.log("FastSample.over result=".concat(t)),this.callback&&this.callback(t),this.stop()}}add(t){if(!this.isOver){this.samples.addCur(t);let e=_.a.now();0===this.lastTs?this.lastTs=e:this._checkSample(e)}}onCheckTime(t){this._checkSample(t)}_checkSample(t){this.lastTs>0&&t-this.lastTs>500&&(this.lastTs=t,this.samples.calculate(),this.samples.getSamples().length===this.maxSize&&this.setOver())}}(20),this.onFastSampleOverBind=this.onFastSampleOver.bind(this),this.p2pFlvPlayer=e.p2pFlvPlayer,this.videoFpsList=[],this.audioFpsList=[],this.startFps=!1,this._hyPlayer=e.hyPlayerIns,this.playerCoreType=e.playerCoreType,this.shieldAudioPlayer=new class{constructor(t,e){this._id=Xs++,n.a.log("ShieldAudioPlayer(".concat(this._id,").constructor")),this.player=t,this.loader=new Qs(this,!0),this.connectTime=0,this.started=!1,this.startTs=0,this.startUrlBind=this.startUrl.bind(this),this.cdncip="",this.cdnsip="",this.alt_svc="",this.x_hy_quic="",this.sShieldStreamName="",this.isOpen=!1,this.recvTime=0,this.playInfo=null,this.anticode=new Gi,this.refreshAnticodeBind=this.refreshAnticode.bind(this),this.anticode.on(Gi.Events.REFRESH,this.refreshAnticodeBind)}destroy(){this.loader&&this.loader.destroy(),this.loader=null,this.player=null,this.anticode&&this.anticode.off(Gi.Events.REFRESH,this.refreshAnticodeBind),this.anticode=null}get connected(){return this.loader.connected}reset(){this.started&&(n.a.log("ShieldAudioPlayer(".concat(this._id,").reset")),this.loader.close(),this.started=!1,this.startTs=0,this.connectTime=0,this.url="",this.sShieldStreamName="",this.recvTime=0)}initInfo(t){let e="";t.sFlvUrl&&t.sShieldStream.sStreamName&&(1==Number(f.a._forceShieldStream)&&(t.sShieldStream.sStreamName=t.sStreamName),t.sShieldStream.sStreamName&&(e="".concat(t.sFlvUrl,"/").concat(t.sShieldStream.sStreamName,".flv")));let i=[],s=this.anticode.getAnticode(!1);n.a.log("ShieldAudioPlayer.initInfo.anticode",s),this.anticode.hasAnticode()&&i.push(s),-1===e.indexOf("va.huya.com")&&-1===e.indexOf("cdnweb.huya.com")&&-1===e.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(e+=(-1!==e.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.url=e}start(t){this.stop(),this.playInfo=t,this.startShieldAudio(t)}startShieldAudio(t){this.startTs=_.a.now(),this.checkParams(t,this.startUrlBind)}onCheckTimer(t,e){if(this.anticode.onCheckTimer(t,e),this.started)return _.a.now()-this.startTs>=5e3&&!this.isOpen&&this.player.onSwitchShieldAudioFail(2),this.connected&&this.recvTime>0&&t-this.recvTime>5e3?(n.a.warn("ShieldAudioPlayer(".concat(this._id,").onCheckTimer no data received ")+(t-this.recvTime)),void this.player.onSwitchShieldAudioAbnormal()):void this.loader.onCheckTimer(t,e)}refreshAnticode(){n.a.log("shieldAudioPlayer.refreshAnticode"),this.initInfo(this.playInfo)}checkParams(t,e){t.sFlvUrl&&t.sShieldStream.sStreamName?(t.sFlvUrl=t.sFlvUrl.replace("http://","https://"),t.sShieldStream.sFlvAntiCode?(this.anticode.init(t.sFlvUrl,t.sShieldStream.sStreamName,t.sShieldStream.sFlvAntiCode,t.nimoTid),this.anticode.valid().then(()=>{e&&e(t)})):e&&e(t)):n.a.warn("ShieldAudioPlayer(".concat(this._id,").start has no params(sFlvUrl,sStreamName,url)"))}startUrl(t){if(this.started=!0,t.sShieldStream&&t.sShieldStream.sStreamName){this.sShieldStreamName=t.sShieldStream.sStreamName,this.initInfo(t);let e=this._getUrlParams(this.url);this.loader.connect(e)}else n.a.warn("ShieldAudioPlayer.startUrl error",JSON.stringify(t.sShieldStream))}_getUrlParams(t){let e="";const i=o.a.platform,s=N.a.PLATFORM_TYPE[i]||N.a.PLATFORM_TYPE.web,r=i===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);return e+="".concat(r,"&t=").concat(s),e=R.b.urlInfoParams(e,this.playInfo),-1===t.indexOf("?")?t+="?":t+="&",t+e}stop(){this.started&&this.loader.close(),this.isOpen=!1,this.reset(),this.loader.stop(),this.anticode.off(Gi.Events.REFRESH,this.refreshAnticodeBind)}onConnected(){this.connectTime=_.a.now(),this.isOpen=!0;let t=this.connectTime-this.startTs;this.player&&this.player.onShieldAudioConnected(t),n.a.log("%c[TIME] ShieldPlayer(".concat(this._id,").onConnected connectTime=")+t,"color:#A23400;background:#FFF5C2")}onClosed(){n.a.log("ShieldAudioPlayer(".concat(this._id,").onClosed"))}onLoadError(t){n.a.log("ShieldAudioPlayer(".concat(this._id,").onLoadError"))}onLoadTimeout(){n.a.log("ShieldAudioPlayer(".concat(this._id,").onLoadTimeout"))}onData(t,e){let i=_.a.now();var s=new Uint8Array(t);this.player.stat.addCore(d.a.CORE.CDN_TOTAL_BW,s.byteLength),this.player.mse.appendShieldAudioFlv(s),this.recvTime=i}restart(){this.startShieldAudio(this.player.info)}onHeader(t){t.hasOwnProperty("cdncip")&&(this.cdncip=t.cdncip),t.hasOwnProperty("cdnsip")&&(this.cdnsip=t.cdnsip),t.hasOwnProperty("alt-svc")&&(this.alt_svc=t["alt-svc"]),t.hasOwnProperty("x-hy-quic")&&(this.x_hy_quic=t["x-hy-quic"])}}(this),this.shieldAudioConnectTime=99999,this.isShieldStart=!1,this.is_tie_stream=!1,this.pause500Cnt=0,this.pcdnIaas="",this.isFramePaused=!1,this.isRenderFpsPause=!1,this.pcdnIaasParam="",this.isPcdnIaas=!1,this.fpsSecOverNum=0,this.isRevFastOver=!1,this.phase=1,this.reqId=0}destroy(){this.clearTimer(),this.fastSample.destroy(),this.shieldAudioPlayer.destroy()}sendAnticodeHeart(){const t=[];this.stat.fillAnticode(t),this.tsdb.sendMetrics(t)}on302(t){const e=R.b.getQueryString("p_iaas",t);let i=R.b.getQueryString("p_iaas_param",t);this.pcdnIaasParam=i||"",this.pcdnIaas=e||"",this.info.pcdnIaas=e,this.info.pcdnIaasParam=i,n.a.log("IPlayer.on302,url=",t,e),this.isPcdnIaas=""!=this.pcdnIaas,this.stat&&(this.stat.setComDim(d.a.DIM_COM.IS_REDIRECT,1),e&&this.stat.setComDim(d.a.DIM_COM.PCDN_IAAS,e),e&&this.stat.setComDim(d.a.DIM_COM.STREAM_302_URL,t))}onConnected(){this.p2pFlvPlayer.onConnected()}onPlayVideo(t,e,i,s,r,a,l){let c=this.getMse();this.info&&this.info.isAuto&&0===Number(o.a.autoCfg.close)&&(this.p2pFlvPlayer.ctrlBitrate.start(this.getMse(),{sessionId:this.info._sessionId,startBitrate:this.info._startBitrate,bitrateList:this.info.bitrateList,curBitrate:this.info.curBitrate}),this.p2pFlvPlayer._triggerAutoChanged()),c&&c.setParams(this.info.presenterUid,this.info.curBitrate,this.info),this.stat.setComDim(d.a.DIM_COM.DPI,e+"*"+i),this.h265Proxy.needPreload&&this.h265Proxy.loadDecoder(this.info.h5Root,null);let u=ct().toLowerCase();this.stat.setComDim(d.a.DIM_COM.RENDER_INFO,u),-1==u.toLocaleLowerCase().indexOf("swiftshader device")&&""!=u||c&&c.setDisableHardAcc&&c.setDisableHardAcc();let p=-1!=u.toLocaleLowerCase().indexOf("angle (null"),m=""==u.toLocaleLowerCase();p?(f.a.isAngelNull=1,c&&c.angelNullError&&c.angelNullError()):f.a.isAngelNull=0,m?c&&c.chromeH265RenderEmptyError&&c.chromeH265RenderEmptyError():f.a.isChromeH265RenderInfoEmpty=0,1==o.a.hardHevcConfig[2]&&this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.h265Proxy.isH265MseCodec&&h.a.version.major>=117&&-1!=u.indexOf("amd")&&-1!=u.indexOf("radeon")&&(n.a.log("IPlayer.onPlayVideo.amd.hevError"),this.p2pFlvPlayer.onMseHevcError())}_startContinueBuffer(){let t=this.getMse();t&&t.buffered&&t.buffered.start()}onPlayPause(t,e){this.pauseStartTs=t,this.pauseCheckLock=!1,this.isSwitchPause=!0,this.autoMonitor.setPause(t,this.getBufferLen()),e&&this.updateStatus(p.VIDEO_CACHING)}onPlayResume(t,e){this._checkPaused(t,qs),e&&this.updateStatus(p.VIDEO_PLAYING)}onPlayPauseWorker(t,e){this.pauseStartWorkerTs=t}onPlayResumeWorker(t,e){this._checkPausedWorker(t,qs)}_checkPaused(t,e){if(e!==Ys&&e!==Ks||this.voiceChecker.onAudioEnergy(!0),this.pauseStartTs>0){let i=t-this.pauseStartTs;if(i>=200){n.a.warn("IPlayer(".concat(this._id,")._checkPaused type=").concat(e," pauseTime=").concat(i));let s=this.getMse(),r=0;s&&(s.buffered._calc(t,Ws),r=s.getContinueBuffer()),"hidden"!==this.stat.getComDim(d.a.DIM_COM.VISIBILITY_STATE)&&this.stat.addCore(d.a.DIM_CORE.V_BAD_FRONT,1),this.autoMonitor.addBadQuality(t,i,e,r),this.pauseCnt++,this.pauseTime+=i,this.pauseCnt5++,this.pauseTime5+=i,this.p2pFlvPlayer.ctrlBitrate.addBadQuality(t,i,this.getBufferLen()),this.pauseCnt60Sec++;let a=this._getBadReason(t);n.a.warn("IPlayer(".concat(this._id,")._checkPaused curReason=").concat(a," lastReason=").concat(this.pauseReason)),(0===this.pauseReason||a<this.pauseReason)&&(this.pauseReason=a),this.checkPerformanceBadQuality(),P.addBadQuality(this.stat)}else this.autoMonitor.resetPausedTs();this.pauseStartTs=e===Ys?t:0}e===Ys&&this._autoReportSea()}_checkMobPaused(t,e){this.pauseMobStartTs>0&&(this.pauseMobStartTs=e===Ys?t:0)}_checkPausedWorker(t,e){if(this.pauseStartWorkerTs>0){let i=t-this.pauseStartWorkerTs;i>=200&&(n.a.warn("IPlayer(".concat(this._id,")._checkPausedWorker type=").concat(e," pauseTime=").concat(i)),this.pauseWorkerCnt++,this.pauseWorkerTime+=i),this.pauseStartWorkerTs=e===Ys?t:0}}_checkAvcChangeReport(t,e){if(e){let e=this.getMse();if(e){let i=e.parser;i&&i.avcChangeTime+o.a.avHeaderChangeCfg[3]<t&&(this.printAVInfos(),100*Math.random()<o.a.avHeaderChangeCfg[1]&&this._hyPlayer.trigger(u.P2P_REPORT))}}}_getBadReason(t){return 0}_autoReportSea(){}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(u.PLAY_STATUS,{status:t}))}onErrorEvent(t){3===t.type&&this.p2pFlvPlayer.ctrlBitrate._badStat.setNoIFrame()}getMse(){return null}printAVInfos(){let t=this.getMse();t&&t.printAVInfos&&t.printAVInfos()}onHeader(t){t.hasOwnProperty("cdncip")&&this.stat.setComDim(d.a.DIM_COM.CDN_CIP,t.cdncip),t.hasOwnProperty("cdnsip")&&(this.cdnsip=t.cdnsip,this.stat.setComDim(d.a.DIM_COM.CDN_SIP,t.cdnsip)),t.hasOwnProperty("alt-svc")&&this.stat.setComDim(d.a.DIM_COM.ALT_SVC,t["alt-svc"]),t.hasOwnProperty("x-hy-quic")&&this.stat.setComDim(d.a.DIM_COM.QUIC,t["x-hy-quic"])}getBufferLen(){return 0}getSegmentsBufferLen(){return 0}getWaitBufferLen(){return 0}getWaitFrameTime(t){return 0}triggerVideoBadQuality(){this.eventEmitter.trigger(u.VIDEO_BAD_QUALITY)}trigger(t,e){this.eventEmitter.trigger(t,e)}onFastSampleOver(t){let e=[this.stat.createAct(d.a.ACT.FAST_SAMPLE,{str:[t]})];this.tsdb.sendMetrics(e);let i=this.getMse();i&&i.onFastOver()}startFastSample(){this.fastSample.start(this.onFastSampleOverBind)}addBytes(t){this.sampleController.addTotalSample(t),this.fastSample.add(t)}init(t){}start(t){this.pcdnIaas="",this.pcdnIaasParam="",this.isPcdnIaas=!1,-1e4!=rr&&t.iBitRate!=rr&&(sr=0),this.getWebCodecType(),this.is_tie_stream=!1,this.stat.setComDim(d.a.DIM_COM.IS_TIE_STREAM,0),this.stat.setComDim(d.a.DIM_COM.IS_REDIRECT,0),t.pullStreamFrom==js&&(Zs.length=0),this.stop(),X.add(this.getVideoBadQuality,this,2e4),this.sampleController.start(),this.startFps=!1,Vs.add(this.onIPlayerCheckTimer,this,1e3),rr=t.iBitRate,this.setEnableDiscard(t),this.startShildAudioPlayer(t)}startPlayer(){this.isNotSupportWebcodecsConfigure()}clearTimer(){X.remove(this.timeoutRecSysRsp,this),X.remove(this.getVideoBadQuality,this),X.remove(this.pauseGetRecSysRspOnce,this),Vs.remove(this.onIPlayerCheckTimer,this)}stop(){this.fpsSecOverNum=0,this.isRevFastOver=!1,this.shieldAudioPlayer.stop(),this.isH265Playing=!1,this.heart20Ts=0,this.pauseCnt60Sec=0,this.isSwitchPause=!1,this.fastSample.stop(),this.sampleController.stop(),this.clearTimer(),this.startFps=!1,this.videoFpsList.length=0,this.audioFpsList.length=0,this.shieldAudioConnectTime=99999,this.isShieldStart=!1,this.pause500Cnt=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseStartWorkerTs=0,this.pcdnIaas="",this.phase=1,this.reqId=0}getVideoBadQuality(){if(0===Number(o.a.isAiP2PToFlv)||!this.mse)return;const{aiDuration:t,aiCnt:e}=this.mse.pauseStat.getAiStat();if(Zs.length<3&&(t>=o.a.aiP2PFlvConfig[0]||e>=o.a.aiP2PFlvConfig[1]?Zs.push(1):Zs.push(0)),Zs.length>=3){let t=0;Zs.map(e=>{1==e&&t++});let e=_.a.now();if(t>=2){if(this.playerType===w.P2P){let t=this._hyPlayer.getVideoP2PBuffertEmptyTime;0!=t&&e-t<=o.a.aiBufferEmptyRequestInterval?n.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoP2PBuffertEmptyTime"),e-t):(this.pauseGetRecSysRsp(this.playerType),this._hyPlayer.getVideoP2PBuffertEmptyTime=e)}else if(this.playerType===w.Flv){let t=this._hyPlayer.getVideoFlvBuffertEmptyTime;if(0!=t&&e-t<=o.a.aiBufferEmptyRequestInterval)return void n.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoFlvBuffertEmptyTime"),e-t);this._hyPlayer&&this._hyPlayer.lastP2PInfo&&(this.pauseGetRecSysRsp(this.playerType),this._hyPlayer.getVideoFlvBuffertEmptyTime=e)}Zs.length=0}else Zs.shift()}}pauseGetRecSysRsp(t){let e={info:this.info,type:"flv",metadata:null};t===w.P2P?(e.type="p2p",e.metadata=this.player?this.player.msePlayer.metadata:null,e.reason=N.a.turnToFlvReason.VIDEO_BUFFER_EMPTY):t===w.Flv&&(e.type="flv",e.metadata=this.mse.metadata);let i=10*~~(3e3*Math.random()/10);X.once(this.pauseGetRecSysRspOnce,this,i,e)}pauseGetRecSysRspOnce(t,e,i){this.getRecSysRsp(i)}startP2PUrl(t){}stopStream(t){}checkPcdnMode(t,e){if(!this.info)return;this.info.usePcdn=this._getUsePcdn(t,e),f.a.usePcdn&&(this.info.usePcdn=1),this.stat.setComDim(d.a.DIM_COM.FORCE_SUB_TYPE,this.info.usePcdn||this.info.use302Pcdn),this.playerType===w.P2P?1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream])?this.stat.setComDim(d.a.DIM_COM.USE_PCDN,1):this.stat.setComDim(d.a.DIM_COM.USE_PCDN,0):this.playerType===w.FLV&&(1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream])?this.stat.setComDim(d.a.DIM_COM.USE_PCDN,4):1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream])?this.stat.setComDim(d.a.DIM_COM.USE_PCDN,3):this.stat.setComDim(d.a.DIM_COM.USE_PCDN,0));let i=this._getPcdnName(e);""!=i&&null!=i&&this.stat.setComDim(d.a.DIM_COM.PCDN_ORIGIN,i)}_checkUsePcdn(){return this.info.isAuto&&Number(o.a.closePcdn500)===this.info.curBitrate?0:this.info.usePcdn}setUseAV1(t){this._useAV1=t}isUseAV1(t){this._useAV1=o.a.useAV1;let e=!0;return this._hyPlayer.noLoadAv1Count&&(e=this._hyPlayer.noLoadAv1Count<3),this.isAV1MediaSupported&&this._useAV1&&e&&R.b.getAv1Random(t,o.a.av1PercentConfig)&&1==Number(o.a.abUseAv1)}_getUsePcdn(t){return 0}_getPcdnName(){return""}setEnableLowLatency(t){}setPlaybackrateAccess(t){}setVolume(t){this.mse&&this.mse.setVolume(t)}getCurrentTime(){return 0}getFrameData(){return null}resetAiProps(){this.aiP2PCnt=0,this.aiFlvCnt=0,this.aiP2PTimeoutCnt=0,this.aiFlvTimeoutCnt=0,this.aiP2PErrorCnt=0,this.aiFlvErrorCnt=0,this.aiP2PSwitchCnt=0,this.aiFlvSwitchCnt=0,this.aiP2PNotSwitchCnt=0,this.aiFlvNotSwitchCnt=0,this.aiFlvErrorNotSwitchCnt=0,this.aiFlvErrorSwitchCnt=0}recordAiP2PFlv(t){"p2p"==t?this.aiP2PCnt++:"flv"==t&&this.aiFlvCnt++}initAiReq(t,e,i,s,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const h=new tt.HUYA.RecSysReq;h.tId.iAppid=v.a.appid,h.tId.lUid=v.a.uid,h.tId.sGuid=v.a.sGuid,h.tId.sUA="webh5",h.sAnchorUid=t.presenterUid,h.sRoomId=v.a.roomId,h.iScene=6,h.bDebug=0,h.mAppendInfo.value={streamType:e,expVideoFps:i&&null!=i.fps?i.fps:0,expAudioFps:i&&null!=i.audioFps?i.audioFps:0,codeRate:t.curBitrate,isOriginal:0==t.originalBitrate?1:0,line:a,codeType:this.isH265?"265":"264",sStreamName:t.sStreamName,playType:s,isServer:0,iIsP2PSupport:t.iIsP2PSupport};let d=Object.assign({},h);return n.a.log("IPlayer(".concat(this._id,").getRecSysRsp.req, reason=").concat(o.reason),h,JSON.stringify(d)),h}getRecSysRsp(t,e){let{info:i,type:s,reason:a,metadata:h,isNotAi:d}=t,l=_.a.now();if(0===Number(o.a.isAiP2PToFlv)||d)return this.recordAiP2PFlv(s),void this.recSysRspHandler(!1,null,t);let c=this._hyPlayer.getAIRequestTime;if(0!=c&&l-c<=o.a.aiRequestInterval)return n.a.log("IPlayer(".concat(this._id,").getRecSysRsp.getAIRequestTime"),l-c),void this.recSysRspHandler(!1,null,t);if(2===this.phase)return;this.phase=2,this._hyPlayer.getAIRequestTime=l,this.recordAiP2PFlv(s),X.remove(this.timeoutRecSysRsp);let u=this.initAiReq(i,s,h,0,"264",i.lineType,t);this.reqId=r.getRequestId(),r.sendWup("mediaui","getMediaRec",u,e=>{if(this.reqId!==e.iRequestId)return;if(this._hyPlayer.isBusiStop)return;this.phase=3;let i=Object.assign({},e);if(n.a.log("IPlayer(".concat(this._id,").getRecSysRsp res"),e,JSON.stringify(i)),0===e.iStatus)e&&e.tRecSysInfo&&1==e.tRecSysInfo.lAction?"p2p"==s?this.aiP2PSwitchCnt++:"flv"==s&&(this.aiFlvSwitchCnt++,t.isFlvError&&this.aiFlvErrorSwitchCnt++):"p2p"==s?this.aiP2PNotSwitchCnt++:"flv"==s&&(this.aiFlvNotSwitchCnt++,t.isFlvError&&this.aiFlvErrorNotSwitchCnt++),this.recSysRspHandler(!0,e,t);else{if(t.isNotFirstFetch)return;"p2p"==s?this.aiP2PErrorCnt++:"flv"==s&&(this.aiFlvErrorCnt++,t.isFlvError&&this.aiFlvErrorSwitchCnt++),this.recSysRspHandler(!1,null,t)}},!0,this.reqId,!0),this.aiP2PFlvProps=t,X.once(this.timeoutRecSysRsp,this,1e3)}getAiStat(){let t={};this._hyPlayer&&this._hyPlayer.getAiStartStat&&(t=this._hyPlayer.getAiStartStat()),this.aiP2PSwitchCnt+=t.aiStartFlvCnt;let e={aiP2PCnt:this.aiP2PCnt,aiFlvCnt:this.aiFlvCnt,aiP2PTimeoutCnt:this.aiP2PTimeoutCnt,aiFlvTimeoutCnt:this.aiFlvTimeoutCnt,aiP2PErrorCnt:this.aiP2PErrorCnt,aiFlvErrorCnt:this.aiFlvErrorCnt,aiP2PSwitchCnt:this.aiP2PSwitchCnt,aiFlvSwitchCnt:this.aiFlvSwitchCnt,aiP2PNotSwitchCnt:this.aiP2PNotSwitchCnt,aiFlvNotSwitchCnt:this.aiFlvNotSwitchCnt,aiStartP2PCnt:t.aiStartP2PCnt||0,aiStartFlvCnt:t.aiStartFlvCnt||0,aiFlvErrorSwitchCnt:this.aiFlvErrorSwitchCnt,aiFlvErrorNotSwitchCnt:this.aiFlvErrorNotSwitchCnt};return this.resetAiProps(),e}timeoutRecSysRsp(){if(2===this.phase){this.phase=3,this.reqId=0,n.a.log("IPlayer(".concat(this._id,").timeoutRecSysRsp"));let t=this.aiP2PFlvProps,e=t.type;if(t.isNotFirstFetch)return;"p2p"==e?this.aiP2PTimeoutCnt++:"flv"==e&&(this.aiFlvTimeoutCnt++,t.isFlvError&&this.aiFlvErrorSwitchCnt++),this.recSysRspHandler(!1,null,t)}}onPause5Sec(){this.eventEmitter&&(n.a.log("IPlayer(".concat(this._id,").onPause5Sec")),this.eventEmitter.trigger(u.PAUSE_5SEC_ERROR))}onIPlayerCheckTimer(t,e){if(!this.mse)return;this.checkPerfBlock(),this.startFps||(this.startFps=!0,this.mse.parser.fps.getCalculate());const i=this.mse.getBufferLen();let s=this.mse.parser.fps.getRecvFps();const r=this.mse.getRealFps();if(0!=r){const t=this.mse.parser.fps.getJumRecvFps()/r;1==f.a._printFpsRecvRatio&&n.a.log("IPlayer.onCheck mse webcodecs, ratio=".concat(t,", vBufLen=").concat(i)),0!=t&&(t<1.1?(this.fpsSecOverNum++,this.fpsSecOverNum>=2&&!this.isRevFastOver&&(this.isRevFastOver=!0,this.mse.onRevFastOver())):this.fpsSecOverNum=0)}if(this.mse&&this.mse.parser2){let t=this.mse.parser2.audioFps.getRecvFps();this.audioFpsList.push(t)}this.videoFpsList.push(s);let a=this.mse.parser.avSample.getAutoSamples();a.aSamples.map(t=>{er.length>=60&&er.shift(),er.push(t)}),a.vSamples.map(t=>{ir.length>=60&&ir.shift(),ir.push(t)});const{aiAutoCnt:o,aiAutoDuration:h,aiAutoBlockBadDurationList:d,aiAutoBlockBadContinueBufferList:l}=this.mse.pauseStat.getAiAutoStat();tr.length>=60&&tr.shift(),tr.push({aiAutoCnt:o,aiAutoDuration:h,recvFps:s,aiAutoBuffer:i,aiAutoBlockBadDurationList:d,aiAutoBlockBadContinueBufferList:l})}getAVSampleResult(t,e){let i=[],s="",r=Math.min(e.length,t.length);if(r>0){i.push("size:".concat(r));for(let s=0;s<r;s++)i.push("".concat(r-s,":").concat(e[s]+t[s]))}return s=i.join(","),s}getAutoProps(){let t=0,e=0,i=[],s=[],r=tr.length,a=[],o=[],h=[],d=[];if(r>0){i.push("size:".concat(r)),s.push("size:".concat(r));for(let n=0;n<r;n++){let h=tr[n];t+=h.aiAutoCnt,e+=h.aiAutoDuration,i.push("k".concat(r-n,":").concat(h.recvFps)),s.push("k".concat(r-n,":").concat(h.aiAutoBuffer)),a=a.concat(h.aiAutoBlockBadDurationList),o=o.concat(h.aiAutoBlockBadContinueBufferList)}}let l=this.getAVSampleResult(er,ir),c=a.length;if(c>0){h.push("size:".concat(c)),d.push("size:".concat(c));for(let t=0;t<c;t++)h.push("k".concat(c-t,":").concat(a[t])),d.push("k".concat(c-t,":").concat(o[t]))}let u={aiAutoCnt:t,aiAutoDuration:e,recvFps:i.join(","),realKbpsSample:l,videoBuffers:s.join(","),blockDurationSample:h.join(","),continueBufferSample:d.join(",")};return n.a.log("Iplayer.getAutoProps, props=",u),u}recordRecvFps(t){let e=this.videoFpsList,i=e.length,s=[];if(i>0){s.push("size:".concat(i));for(let t=i;t>0;t--)s.push("k".concat(t,":").concat(e[t-1]))}if(t.setCoreDim(d.a.DIM_COM.V_RECV_FRAMES,s.join(",")),s.length=0,this.videoFpsList.length=0,this.mse&&this.mse.parser2){let t=this.audioFpsList,e=t.length,i=[];if(e>0){i.push("size:".concat(e));for(let s=e;s>0;s--)i.push("k".concat(s,":").concat(t[s-1]))}i.length=0,this.audioFpsList.length=0}}getMuted(){return this.mse?this.mse.getMuted():-1}setMuted(t){this.mse&&this.mse.setMuted(t)}getEmptyAudioRecord(){return this.mse.getEmptyAudioRecord()}getVoiceStats(){return this.voiceChecker.getStats()}getEmptyAudioDurationHeart(){return this.mse.getEmptyAudioDurationHeart()}hasAudioCfg(){return this.mse.hasAudioCfg()}getVolume(){return this.eventEmitter.getVolume?100*this.eventEmitter.getVolume():0}onCheckTimer(t,e){this.shieldAudioPlayer.onCheckTimer(t,e)}startShildAudioPlayer(t){if(t.isStartShield){if(this.is_tie_stream=!0,this.isShieldStart=!0,this.eventEmitter.trigger(u.SHIELD_AUDIO_SWITCH_STATUS,{status:0,commentorIdList:t.commentorIdList}),0==o.a.shieldAudioCfg[0])return void this.eventEmitter.trigger(u.SHIELD_AUDIO_SWITCH_STATUS,{status:2,commentorIdList:t.commentorIdList});this.shieldAudioPlayer.start(t,t.sShieldStreamName),this.mse&&this.mse.switchShieldAudio(!0)}}stopShieldAudioPlayer(){o.a.setAiP2PToFlv(0),this.isShieldStart=!1,this.stat.setComDim(d.a.DIM_COM.IS_TIE_STREAM,0),this.is_tie_stream=!1,n.a.log("IPlayer.stopShieldAudioPlayer"),this.shieldAudioPlayer.stop(),this.mse.stopShieldAudio()}onSwitchShieldAudioSuc(t){this.stat.setComDim(d.a.DIM_COM.IS_TIE_STREAM,1),this.reportShildAudioRes(!0,0,t),n.a.log("IPlayer.onSwitchShieldAudioSuc"),this.eventEmitter.trigger(u.SHIELD_AUDIO_SWITCH_STATUS,{status:1,commentorIdList:this.info.commentorIdList})}onSwitchShieldAudioFail(t,e){this.eventEmitter.trigger(u.SHIELD_AUDIO_SWITCH_STATUS,{status:2,commentorIdList:this.info.commentorIdList}),n.a.log("IPlayer.onSwitchShieldAudioFail"),this.reportShildAudioRes(!1,t,e),this.stopShieldAudioPlayer()}onSwitchShieldAudioAbnormal(){n.a.log("IPlayer.onSwitchShieldAudioAbnormal"),this.eventEmitter.trigger(u.SHIELD_AUDIO_SWITCH_STATUS,{status:3,commentorIdList:this.info.commentorIdList}),this.reportShildAudioRes(!1,5,0),this.stopShieldAudioPlayer()}reportShildAudioRes(t,e,i){let s=this.info&&this.info.commentorIdList?this.info.commentorIdList.join(","):"",r={value:[t?1:2,this.shieldAudioConnectTime,e,i],str:[this.shieldAudioPlayer.loader.url,this.shieldAudioPlayer.cdncip,this.shieldAudioPlayer.cdnsip,s]},a=[this.stat.createAct(d.a.ACT.SWITCH_AUDIO_RES,r)];this.tsdb.sendMetrics(a)}getWebCodecType(){this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.onActWebCodecs([21],[0])}onActWebCodecs(t,e){let i=[this.stat.createAct(d.a.ACT.H265_STATUS,{value:t,str:e})];n.a.log("IPlayer.onActWebCodecs",i),this.tsdb.sendMetrics(i)}checkPerformanceBadQuality(){let t=this.mse.getBufferLen(),e=this.mse.getContinueBuffer(),i=o.a.perfWin7kaCfg[0];t>=e&&e>=i&&sr++}turnToWebcodecsSoft(){R.b.isWebCodecsSupported()&&(n.a.log("IPlayer.turnToWebcodecsSoft"),this.eventEmitter.trigger(u.TURN_TO_WEBCODECS_SOFT))}setUseSoftAcceleration(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.stat.setComDim(d.a.DIM_COM.DECODE_HARDWARE_ACCELERATION,t?1:0)}setEnableDiscard(t){let e=Number(t.curBitrate)>Number(o.a.webCodecCfg[2]);this.mse&&this.mse.setEnableDiscard&&this.mse.setEnableDiscard(e)}onShieldAudioConnected(t){this.shieldAudioConnectTime=t}qaStaRecord(){n.a.log("IPlayer.qaStatRecord,pause500Cnt=".concat(this.pause500Cnt)),this.shieldStatRecord()}shieldStatRecord(){}checkPerfBlock(){if(!this.mse)return;const t=this.mse.getVideoContinueBuffer(),e=Math.max(this.mse.getBufferLen(),0);1==Number(f.a._printPerfSec)&&n.a.log("IPlayer.performanceCalc",t,e,o.a.perfBlockCfg[2]),t-e>=o.a.perfBlockCfg[2]&&this.mse.setPerfCntPlus()}check500Pause(){1!=o.a.closePause500&&this.pause500Cnt++}getPause500Cnt(){const t=this.pause500Cnt;return this.pause500Cnt=0,t}isNotSupportWebcodecsConfigure(){const t=this.isH265?"h265":"h264",e=this.mse;if("h265"==t||"h264"==t){const i="h265"==t?"hvc1.1.6.L93":"avc1.42E01E";"undefined"!=typeof VideoDecoder&&VideoDecoder.isConfigSupported({codec:i}).then(i=>{n.a.log("IPlayer.isConfigSupported",i,t),i.supported?"h265"==t?f.a.isCloseWebcodecsH265=0:"h264"==t&&(f.a.isCloseWebcodecsH264=0):("h265"==t?f.a.isCloseWebcodecsH265=1:"h264"==t&&(f.a.isCloseWebcodecsH264=1),e&&e.isNotSupportWebcodecsConfig&&e.isNotSupportWebcodecsConfig())}).catch(t=>{n.a.log("IPlayer.isConfigSupported.catch",t.message)})}}onPlayMobPause(t,e){this.pauseMobStartTs=t,this.pauseMobCnt++,n.a.log("IPlayer.onPlayMobPause,pauseMobStartTs=",this.pauseMobStartTs)}onPlayMobResume(t,e){n.a.log("IPlayer.onPlayMobResume"),this._checkMobPaused(t,qs)}setFramePause(){const t=_.a.now();this.isFramePaused||(this.onPlayMobPause(t),this.isFramePaused=!0)}setFrameRusume(){if(this.isFramePaused){const t=_.a.now();this.onPlayMobResume(t),this.isFramePaused=!1}}renderFpsPause(t){this.isRenderFpsPause=t}getEnhanceStats(){return this.eventEmitter&&this.eventEmitter.getEnhanceStats&&this.eventEmitter.getEnhanceStats()}getRefreshRate(){return this._hyPlayer&&this._hyPlayer.getEnhanceStats&&this._hyPlayer.getRefreshRate()}getDpi(){let t=0,e=0;return this.mse&&this.mse.getMseAvcCfgWidth&&(t=this.mse.getMseAvcCfgWidth()),this.mse&&this.mse.getMseAvcCfgHeight&&(e=this.mse.getMseAvcCfgHeight()),{width:t,height:e}}getFetchCodecType(){let t="264";return this.isAv1?t="av1":this.isH265&&(t="265"),t}get hasPicture(){return!1}get isPlaying(){return!1}get isWebCodec(){return this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS}get isMse(){return this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE}},or=class extends ar{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t,e),n.a.log("FlvPlayer(".concat(this._id,").constructor"));let{isPureAudio:s,isPureVideo:r}=e;this.startTs=0,this.startTime=0,this.lineType=0,this.loader=new ys(this,!0),this.recvTime=0,this.firstPkgTime=0,this.connectTime=0,this.loadFlvStatus=0,this.isPureAudio=s,this.isPureVideo=r,this.videoElement=i,this.flvLoadTimeSended=!1,this.enableLowLatency=!1,this._flvUnavailibleTimeout=0,this.anticode=e.anticode,this.mse=e.mse,this.pauseStartTs=0,this.metadataTick=new rt(t,this.mse),this.pauseReason=0,this.loadTime=0,this.connectTime=0,this.recvDataTime=0,this.loadStartTs=0,this.cdnip="",this.cdnsip="",this.sendPauseTimeout=0,this.videoStatus=p.VIDEO_STOP,void 0!==st&&(this.qaStat=new st(this)),this.playedStat=null,this.flowSize=0,this.flvDataSize=0,this.backToP2P=new class{constructor(t){this.flvPlayer=t,this.eventEmitter=t.eventEmitter,this.jumpToP2PCd=1e3*(Math.floor(120*Math.random())+180),this.nextJumpToP2PTs=0,this.waitPlayEnd=!1,this.lastP2PInfo=null}reset(){this.waitPlayEnd=!1}initJumpTs(t){0==this.nextJumpToP2PTs&&(this.nextJumpToP2PTs=t+this.jumpToP2PCd)}onCheckTimer(t,e){if(this.waitPlayEnd)return;if(!$.isSupportP2P())return;if(t<this.nextJumpToP2PTs)return;let i=this.flvPlayer;if(!this.lastP2PInfo)return;if(o.a.isCloseP2P(this.lastP2PInfo.uid)||o.a.isCloseAllFuncs(this.lastP2PInfo.uid))return;if(this.lastP2PInfo.lineType!=i.lineType)return;let s=this.lastP2PInfo.sStreamName;s&&i.url&&-1!=i.url.indexOf(s)&&(i.getBufferLen()<i.mse.JITTER_BUFLEN||(this.waitPlayEnd=!0))}onCheckFastTimer(t,e){this.flvPlayer.getBufferLen(),this.waitPlayEnd&&(this.waitPlayEnd=!1,this.jumpToP2PCd<18e5&&(this.jumpToP2PCd+=12e4),this.nextJumpToP2PTs=t+this.jumpToP2PCd,this.flvPlayer.getRecSysRsp({info:this.flvPlayer.info,type:"flv",metadata:this.flvPlayer.mse.metadata,isBackToP2P:!0}))}recSysRspHandler(t,e,i){if(!this.lastP2PInfo)return;let s=this.flvPlayer;t&&e&&e.tRecSysInfo&&0==e.tRecSysInfo.lAction||(n.a.warn("BackToP2P.onCheckFastTimer jumpToP2PCd=".concat(this.jumpToP2PCd/6e4,"min, BackToP2P.tryPlayP2P")),s.loader&&s.loader.close(),this.eventEmitter.trigger(u.FLV_TRY_TO_P2P),this.lastP2PInfo=null)}}(this),this.volumeCount=0,this.sendMetricTimer=0,this.sendMetricTimes=0,this.businessStartCost=0,this.startTimeStamp=0,this.noNeedSendVideoLoadTime=!1,this.exceptionStat=e.exceptionStat,this.startUrlBind=this.startUrl.bind(this),this.playerType=w.FLV,this.flvPcdnState=ms.CLOSED,this.isH265=!1,this.isAv1=!1,this.isUsePcnd302=!1,this.httpErrorCode=0,this.isUsingPcdn=!1}destroy(){super.destroy(),X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),this.loader&&this.loader.destroy(),this.loader=null}getFrameData(){return{pts:this.mse.getCurrentRealTime()}}reset(){this.started&&(n.a.log("FlvPlayer(".concat(this._id,").reset")),this.loader.close(),this.pauseStartTs=0,this.qaStat.isFirstReport=!0,this.metadataTick.reset(),this.metadataTick.mse=this.mse,this.startTs=0,this.recvTime=0,this.startTime=0,this.enableLowLatency=!1,this.pauseCheckLock=!1,this.loadTime=0,this.connectTime=0,this.recvDataTime=0,this.flowSize=0,this.flvDataSize=0,this.recvDataEnough=!1,this.recvFlvData=!1,this.cdnip="",this.cdnsip="",this.backToP2P.reset(),this.stopPlayer(),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.videoStatus=p.VIDEO_STOP,this.flvPcdnState=ms.CLOSED,this.isUsingPcdn=!1)}get connected(){return this.loader.connected}get hasPicture(){let t=this.p2pFlvPlayer.isPlaying;return this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS?t=t&&this.p2pFlvPlayer.webcodecsPlaying:this.h265Proxy.rendering&&(t=t&&this.p2pFlvPlayer.isWasmH265Playing),t}getCostTimes(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0]}getRecvInfo(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0,this.mse.getVideoFrames(),this.mse.getAudioFrames(),this.flowSize]}checkPcdnMode(t,e){this.info.use302Pcdn=this._get302UsePcdn(t),super.checkPcdnMode(t,e),this.loader.checkPcdnMode(e)}_getUsePcdn(t){return 1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream])?1:0}_get302UsePcdn(t){const e=1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream])?1:0;return this.isUsePcnd302=e,e}_getPcdnName(t){let e="";return t&&(e=this.isUsePcnd302?t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream]:t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]),e}_getPcdn302Name(t){let e="";return t&&(e=t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream]),e}start(t){n.a.log("FlvPlayer(".concat(this._id,").start"),JSON.stringify(t)),this.firstPkgTime=0,super.start(t),this.reset(),this.started=!0,this.isUsingPcdn=!1,this.checkParams(t,this.startUrlBind)}checkParams(t,e){this.info=t,t.sFlvUrl&&t.sStreamName?(t.sFlvUrl=t.sFlvUrl.replace("http://","https://"),t.sFlvAntiCode?(this.anticode.init(t.sFlvUrl,t.sStreamName,t.sFlvAntiCode,t.nimoTid),this.anticode.valid().then(()=>{e&&e(t)})):e&&e(t)):t.url?e&&e(t):n.a.warn("FlvPlayer(".concat(this._id,").start has no params(sFlvUrl,sStreamName,url)"))}startUrl(t){if(this.isUsePcnd302=!1,this.initDomain(t),!this.started)return;this.initInfo(t);let e=_.a.now();if(this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(t.startTimeStamp)||0,t.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=Math.floor(t.startTimeStamp>1?(new Date).getTime()-t.startTimeStamp:0),this.noNeedSendVideoLoadTime=!1),t.uistartTs&&t.uistartTs>0&&(this.UIStartCost=Math.floor((new Date).getTime()-t.uistartTs)),this.startTs=e,n.a.log("FlvPlayer(".concat(this._id,").startNow"),Date.now(),e),this.startTime=e,this.backToP2P.initJumpTs(e),this.loadFlvStatus=0,this.mse.setPushGop(o.a.pushGop),$.isNeedAud()?this.mse.setDeleteH264Aud(-1===o.a.deleteH264Aud.indexOf(t.presenterUid)?0:1):this.mse.setDeleteH264Aud(0),t.latencyLevel){let e=o.a.latency[t.latencyLevel];e||(e=[3e3,2e3,4e3,2e3]),this.mse.latencySeek=e[3],this.mse.setJitter(e[0],e[1],e[2])}else this.enableLowLatency?o.a.setLowLatency(this.mse):o.a.setJitterCfg(this.mse,t.presenterUid,t.curBitrate,"flv");let i=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.isH265=i;let s=this.isUseAV1(t);this.isAv1=s,this.stat.setComDim(d.a.DIM_COM.ORIGINAL_BITRATE,0===t.originalBitrate?1:0),this.stat.setComDim(d.a.DIM_COM.H265,i?1:0),this.stat.setComDim(d.a.DIM_COM.V_DECODEC,s?2:i?1:0),this.stat.setComDim(d.a.DIM_COM.P2P,d.a.LIVE_TYPE.FLV),this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,1),this.eventEmitter&&this.eventEmitter.roomRecordStat&&this.eventEmitter.roomRecordStat.startStream(t.presenterUid,t.lineType,t.curBitrate,i?"h265":"h264","flv"),s?(t.url+="&codec=av1",-1==t.url.indexOf("ratio")&&(t.url+="&ratio=0")):i&&this._hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(d.a.ACT.H265_STATUS,{value:[0],str:[0]})]),this.statSwitch.check(t,!1),delete t.pullStreamFrom,this.startFastSample(),this._startContinueBuffer(),this.httpErrorCode=0,this.loader.connect(t.url,null==this.videoElement),ut.setCdnDomain(this.stat,this.info.url,this.info.sStreamName),this.startPlayer()}startPlayer(){this.started=!0,X.add(this.onCheckTimer,this,1e3),X.add(this.onCheckFastTimer,this,100),null!=this.videoElement&&this.startMetricTimer(2e4),super.startPlayer()}stopPlayer(){X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),this.stopMetricTimer(),this.started=!1}_switchStart(t,e){this.initInfo(this.info),-1!==this.info.url.indexOf("?")?this.info.url+="&startPts=".concat(e):this.info.url+="?startPts=".concat(e),this.mse.parser.reset(),this.loader.close(),1==f.a._testBack?f.a._testBack=0:(this.startTs=_.a.now(),this.loader.connect(this.info.url)),this.updateFlvConfig()}initInfo(t,e){this.info=t,t.sFlvUrl&&t.sStreamName&&(t.url="".concat(t.sFlvUrl,"/").concat(t.sStreamName,".flv"));let i=[];this.anticode.hasAnticode()&&(i.push(this.anticode.getAnticode(e)),n.a.log("FlvPlayer.initInfo, anticode=".concat(this.anticode.getAnticode(e)))),-1!==o.a.useChangeRate.indexOf(Number(t.presenterUid))?i.push("ratio=".concat(t.curBitrate)):t.iBitRate>0?i.push("ratio=".concat(t.iBitRate)):f.a._ratio&&i.push("&ratio=".concat(f.a._ratio)),t.httpDomainOnly||-1===t.url.indexOf("va.huya.com")&&-1===t.url.indexOf("cdnweb.huya.com")&&-1===t.url.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(t.url+=(-1!==t.url.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.isUseAV1(t)?t.url+="&codec=av1":(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec)&&this.h265Proxy.checkUrl(t),t.url+="&dMod=".concat(R.b.getDMod(t._dMod,t._sMod)),this.url=t.url,this.lineType=t.lineType}recSysRspHandler(t,e,i){i&&i.isBackToP2P?this.backToP2P.recSysRspHandler(t,e,i):!t||e&&e.tRecSysInfo&&1==e.tRecSysInfo.lAction?(n.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler FLV_TRY_TO_P2P")),this.eventEmitter.trigger(u.FLV_TRY_TO_P2P)):(n.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler jumpToP2PCd=").concat(this.jumpToP2PCd/6e4,"min fail")),this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{code:1,msg:"jumpToP2PCd fail"}))}setVideoPlayTimeSended(){this.flvLoadTimeSended=!0}getPlayVideo(){return this.mse.getPlayVideo()}setJitter(t,e,i){this.mse&&this.mse.setJitter(t,e,i)}stop(){this.started&&(n.a.log("FlvPlayer(".concat(this._id,").stopFlv")),this._reportFlvFlow(),this.reset(),this.started=!1),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.recvDataEnough=!1,this.recvFlvData=!1,super.stop(),this.loader.close(),clearTimeout(this._flvUnavailibleTimeout)}recvDataFull(){this.recvDataTime=_.a.now(),this.eventEmitter.trigger(u.RECV_VIDEO_FRAME),n.a.log("FlvPlayer(".concat(this._id,").recvDataFull"))}initDomain(t){if(t.inited)return;t.inited=!0;let e=t.domainList;if(e&&e.length){let i=t.sFlvUrl.match(/\/\/(.+?)\//i);t._domain=i?i[1]:"",n.a.log("FlvPlayer(".concat(this._id,").initDomain:\n\t")+e.join("\n\t"));let s=e.shift();this.cdnip=s,this.stat.setComDim(d.a.DIM_COM.CDNIP,s),t.sFlvUrl=t.sFlvUrl.replace(/\/\/(.+?)\//,"//"+s+"/"+t._domain+"/")}}retryVideo(){this.eventEmitter.trigger(u.REPLAY_VIDEO)}setEnableLowLatency(t){this.enableLowLatency=t,t&&o.a.setLowLatency(this.mse)}updateFlvConfig(){this.enableLowLatency?o.a.setLowLatency(this.mse):o.a.setJitterCfg(this.mse,this.info.presenterUid,this.info.curBitrate,"flv"),this.mse&&(this.mse.setNeedEmptyAudioFrame(o.a.flvEmptyAudioFrame>0),n.a.log("FlvPlayer(".concat(this._id,").updateFlvConfig flvEmptyAudioFrame=")+this.getConfig("flvEmptyAudioFrame")))}requestUrl(){let t=this.info,e=t.domainList;if(e&&t._domain){let i=new RegExp("//(.*?)"+t._domain+"/"),s=e.shift();return s?(this.cdnip=s,this.stat.setExtDim(d.a.DIM_EXT.CDN_IP,s),n.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(s)),t.sFlvUrl=t.sFlvUrl.replace(i,"//"+s+"/"+t._domain+"/")):(this.cdnip="",this.stat.delDim(d.a.DIM_EXT.CDN_IP),n.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(t._domain)),t.sFlvUrl=t.sFlvUrl.replace(i,"//"+t._domain+"/"),delete t.domainList),this._reportFlvFlow(),void this.startUrl(t)}this._hyPlayer.isPaidRoom&&this._hyPlayer.payCount403>=o.a.payRoomCfg[1]||(n.a.log("FlvPlayer.requestUrl"),this.triggerUnAvailible())}setConfig(t,e){o.a.setConfig(t,e)}getConfig(t){return o.a[t]}getBufferLen(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}getSegmentsBufferLen(){return this.mse&&this.mse.getSegmentsBufferLen?this.mse.getSegmentsBufferLen():0}getFrameBufferLen(){return this.mse&&this.mse.getFrameBufferLen?this.mse.getFrameBufferLen():0}getCurrentTime(){return this.mse.getCurrentRealTime()}getCurrentDts(){return this.mse.getCurrentDts()}getCurrentSeiOffsetDts(){return this.mse.getCurrentSeiOffsetDts()}getDurationTime(){const t=(this.mse.video||{}).video;let e=0;return t&&(e=Math.floor(t.duration||0)),e}getVolumeEnergy(){let t=this.volumeCount>5?1:0;return this.volumeCount=0,t}getAnticodeHandler(){return this.anticode}play(){this.mse.play()}pause(){this.loader.close(),this.mse&&this.mse.pause(),X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),this.stopMetricTimer()}setPlaybackrateAccess(t){this.mse&&this.mse.setPlaybackrateAccess(t)}setAutoJitter(t){this.mse.autoJitter=t}setLoadFlvStatus(t){t>this.loadFlvStatus&&(this.loadFlvStatus=t)}sendLoadVideoErrorStatus(){this._hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(A.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadFlvStatus]})])}getCdnSip(){return this.cdnsip}turnToH264(t){this.stop(),this.eventEmitter.trigger(u.TURN_TO_H264,{reason:t})}turntoH265Wasm(){this.stop(),this.eventEmitter.trigger(u.TURN_TO_H265_WASM)}h265Retry(){this.stop(),this.eventEmitter.trigger(u.H265_VIDEO_RETRY)}turnToMse(){this.stop()}onConnected(){super.onConnected(),this.connectTime=_.a.now(),n.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onConnected connectTime=")+(this.connectTime-this.startTs),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_CONNECTED),this.exceptionStat.setStat(d.a.DIM_LINK_STA.CONNECT_SUC,1)}onClosed(){this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.HTTP_CLOSE,{})]),this.eventEmitter.trigger(u.VIDEO_LINK_CLOSE,{video:this.mse.getPlayVideo()})}onError(){this.eventEmitter.trigger(u.ANCHOR_STOP,{video:this.mse.getPlayVideo()})}onData(t,e){0==this.firstPkgTime&&(this.firstPkgTime=_.a.now()),this.exceptionStat.setStat(d.a.DIM_LINK_STA.HAS_DATA,1);var i=new Uint8Array(t);this.flowSize+=i.byteLength,this.addBytes(i.byteLength),this.recvDataEnough||(this.flvDataSize+=i.byteLength,this.flvDataSize>1e6&&(this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_DATA_INVALID),this.recvDataEnough=!0)),e===ft?(this.stat.addCore(d.a.CORE.CDN_TOTAL_BW,i.byteLength),this.statCPDetalBw(i.byteLength)):this.stat.addCore(d.a.CORE.PCDN_TOTAL_BW,i.byteLength),0===o.a.pcdnFlvSyncMob&&this.mse.appendFlv(i);let s=_.a.now();0==this.recvTime&&(n.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onData firstPkgTime=")+(s-this.connectTime),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_RECV_DATA)),this.recvTime=s}onFlvTag(t){this.mse.appendFlvTag(t.data)}onInvalidTag(t,e){e===ft?this.stat.addCore(d.a.CORE.CDN_REPEAT_BW,t.data.length):this.stat.addCore(d.a.PCDN_DATA.PCDN_REPEAT_BW,t.data.length)}getMse(){return this.mse}onPlayVideo(t,e,i,s,r,a,o,h,l){super.onPlayVideo(t,e,i,s,r,a,o),P.delFail(this.stat),this.updateStatus(p.VIDEO_PLAYING),this.stat.setComDim(d.a.DIM_COM.DPI,e+"*"+i);let c=_.a.now();n.a.log("FlvPlayer(".concat(this._id,").onStartVideo loadeddata=").concat(c)),this.loadTime=c-this.startTs,this.newLoadTime=c-this._hyPlayer.startTs,this.waitRemuxTime=0,this.mse&&this.mse.parser&&0!=this.mse.parser.waitRemuxTime&&(this.waitRemuxTime=this.mse.parser.waitRemuxTime);let m=this.connectTime-this.startTs,f=this.recvDataTime-this.startTs,g=this.mse.pushVideoStartRenderTime-this.startTs,S=this.UIStartCost>0?this.loadTime+this.UIStartCost:0,y=0;this.startTimeStamp>1?y=this.loadTime+this.businessStartCost:1===this.startTimeStamp&&(y=this.loadTime);let T=this.firstPkgTime-this.startTs,v=0;0!=this.mse.parser.decodeIFRTime&&(v=this.mse.parser.decodeIFRTime-this.startTs),n.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo loadTime=")+this.loadTime+"  businessStartCost="+this.businessStartCost+"  UIStartCost="+this.UIStartCost,"color:#A23400;background:#FFF5C2"),n.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo newLoadTime=")+this.newLoadTime,"color:#A23400;background:#FFF5C2"),this.tsdb.sendFlvTime(this.newLoadTime,m,f,g,null!=this.videoElement,y,S,this.waitRemuxTime,T,v,this.mse.videoFirstFrameDecodeCost,this.mse.audioFirstFrameDecodeCost,this.mse.triggerPlayType);let E={video:t,width:e,height:i,loadTime:this.loadTime,connectTime:m,recvDataTime:f,pushVideoTime:g,canvas:r,videoCodec:o,delayRemove:this.info._delayRemove,canvas1:h,canvas2:l};this.info._delayRemove=!1,this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_STARTPLAY),this.eventEmitter.trigger(u.VIDEO_PLAY,E),this._hyPlayer.onPlayVideo&&this._hyPlayer._type==w.VR&&this._hyPlayer.onPlayVideo(t),this.loader.onPlayVideo()}onAudioFrequency(t){t.value&&this.volumeCount++}onVideoStop(t,e){n.a.log("FlvPlayer(".concat(this._id,").onVideoStop hasVideo=")+e),e&&this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.VIDEO_STOP,{video:t,hasVideo:e})}onSendSeiData(t,e,i){this.eventEmitter.trigger(u.H264_SEI_PLAY,{data:t,ts:e,now:(new Date).getTime(),vt:i})}onSendScriptVolumeInfo(t,e){Number(f.a._printAudioIntensity)&&n.a.log("FlvPlayer(".concat(this._id,").onSendScriptVolumeInfo uid:")+t+"  intensity:"+e),this.eventEmitter.trigger(u.UPDATE_INTERSITY,{uid:t,intensity:e})}onLoadError(t,e){if(n.a.log("FlvPlayer.onLoadError"),this.httpErrorCode=e,403===Number(e)&&this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.HTTP_CODE_+e,{value:[this.type]})]),this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_CONNECT_ERROR),this._hyPlayer.isPaidRoom&&"403"==e&&null!=this._hyPlayer.payCount403&&(this._hyPlayer.payCount403++,n.a.log("FlvPlayer.onLoadError ".concat(this._hyPlayer.payCount403)),this._hyPlayer.payCount403>=o.a.payRoomCfg[1])){if(1==f.a._testPaid)return;return this.loader&&this.loader._flvLoader&&(this.loader._flvLoader.close(),this.loader._flvLoader.needRetry=!1),n.a.log("FlvLoader.stop ".concat(this._hyPlayer.payCount403),this.loader._flvLoader.needRetry),this._hyPlayer.stop(),!0}this.stop(),this._hyPlayer.netFlvErrorCnt+=1,this.triggerUnAvailible({msg:t}),this.triggerChangeLine()}onLoadPcdnError(t,e){n.a.log("FlvPlayer.onLoadPcdnError"),this._hyPlayer.isPaidRoom&&"403"==e&&null!=this._hyPlayer.payCount403&&(this._hyPlayer.payCount403++,n.a.log("FlvPlayer.onLoadPcdnError ".concat(this._hyPlayer.payCount403)),this._hyPlayer.payCount403>=o.a.payRoomCfg[1]&&(n.a.log("FlvLoader.onLoadPcdnError ".concat(this._hyPlayer.payCount403)),this._hyPlayer.stop()))}onVideoParseInvalid(){this.setLoadFlvStatus(N.a.LoadVideoTimeoutReason.FLV_DATA_INVALID)}onLoadTimeout(){this.eventEmitter.trigger(u.FLV_URL_LOAD_TIMEOUT),this._hyPlayer.netFlvErrorCnt+=1,this.triggerChangeLine()}onPlayerError(t){this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN)}onErrorEvent(t){super.onErrorEvent(t),t&&3===t.type&&this.loader.onPlayError();let e=[];e.push(this.stat.createAct(d.a.ACT.P2P_PLAY_FAIL,{value:[t.type,this.getBufferLen()]})),this.tsdb.sendMetrics(e),this._hyPlayer&&this._hyPlayer.lastP2PInfo?this.getRecSysRsp({info:this.info,type:"flv",metadata:this.mse.metadata,isFlvError:!0}):this._hyPlayer.trigger(u.H5_PLAYER_ERROR_IN,{code:t.type,msg:"播放错误"})}onPlayPause(t,e){this.startSendPauseTimer(),super.onPlayPause(t,e)}onPlayResume(t,e){this.stopSendPauseTimer(),super.onPlayResume(t,e)}_getBadReason(t){return this.mse.getIsDownEnough()?this.mse.lastJumpBufferTs>0&&t-this.mse.lastJumpBufferTs<5e3?N.a.BAD_REASONS.BUFFER_JUMP:this.getBufferLen()>2e3?N.a.BAD_REASONS.PERFORMANCE:N.a.BAD_REASONS.UNKNOW:N.a.BAD_REASONS.DOWN_LINK}sendPauseEvent(){this.eventEmitter.trigger(u.PLAY_CARTON)}startMetricTimer(t){clearTimeout(this.sendMetricTimer),this.sendMetricTimer=setTimeout(this.heartBeat20sMetric.bind(this),t)}stopMetricTimer(){this.sendMetricTimes=0,clearTimeout(this.sendMetricTimer)}setAudioUtil(t){this.audiouitil=t,this.audiouitil.removeAllListeners([ht.AUDIO_FREQUENCY]),this.mse&&this.mse.video&&this.mse.video.video&&(this.audiouitil.createAudioContext(this.mse.video.video),this.audiouitil.on(ht.AUDIO_FREQUENCY,this.onAudioFrequency.bind(this)))}startSendPauseTimer(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}stopSendPauseTimer(){clearTimeout(this.sendPauseTimeout)}getAudioFrames(){return this.mse.getAudioFrames()}heartBeat20sMetric(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=_.a.now();if(n.a.log("FlvPlayer(".concat(this._id,").heartBeat20sMetric ")),this.sendMetricTimes++,this._checkPaused(i,e?Ks:Ys),this._checkPausedWorker(i,e?Ks:Ys),this._checkMobPaused(i,e?Ks:Ys),this._checkAvcChangeReport(i,e?Ks:Ys),this.qaStat){0==this.pauseTime&&(this.pauseReason=0);let t=this.pauseStartTs>0;this.qaStat.record({isEnd:e,pauseCnt:this.pauseCnt,pauseTime:this.pauseTime,isPaused:t,flowSize:this.flowSize,httpErrorCode:this.httpErrorCode,pauseReason:this.pauseReason,volumeEnergy:this.getVolumeEnergy(),isPausedWorker:this.pauseStartWorkerTs>0,pauseWorkerCnt:this.pauseWorkerCnt,pauseWorkerTime:this.pauseWorkerTime,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPause})}this.pauseStartTs>0&&this.autoMonitor.setPause(this.pauseStartTs,this.getBufferLen()),this.pauseCnt=0,this.pauseTime=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseReason=0,this.flowSize=0,this.isRenderFpsPause=!1,this.pauseMobCnt=0,this.sendMetricTimes%15==0&&(this.tsdb.sendMetrics([{sMetricName:A.METRIC.VIDEO_VIDEO_BAD_QUALITY_5M_RATIO,vField:{value:this.pauseCnt5>0?100:0}}]),this.pauseCnt5=0,this.pauseTime5=0),t>0&&this.startMetricTimer(t)}onCheckTimer(t,e){if(super.onCheckTimer(t,e),this.started){if(this.connected&&this.recvTime>0&&t-this.recvTime>8e3){let e=this.getBufferLen();return n.a.warn("FlvPlayer(".concat(this._id,").onCheckTimer no data received ")+(t-this.recvTime)+" buffLen="+e),void this.eventEmitter.trigger(u.NO_DATA_RECEIVED_IN)}if(this.anticode.onCheckTimer(t),this.loader.onCheckTimer(t,e),this.mse&&this.mse.onCheckTimer(t,e),this.metadataTick.onCheckTimer(t,e),this.connected){null==this.videoElement&&(0===this.heart20Ts?this.heart20Ts=t:t-this.heart20Ts>=2e4&&(this.heartBeat20sMetric(0,!1),this.heart20Ts=t));try{this.mse.video&&this.eventEmitter.trigger(u.PLAY_DOWNLINK_INFO,{buffer:this.getBufferLen()/1e3,downLinkSpeed:0|this.loader.speed,videoBufferEnd:this.mse.video.video.buffered.end(this.mse.video.video.buffered.length-1)})}catch(t){n.a.log("FlvPlayer(".concat(this._id,").onCheckTimer cannot get down link info"))}this.backToP2P.onCheckTimer(t,e),this.eventEmitter.trigger(u.PLAY_FRAME_BUFFER,{frameStorage:this.mse.getFrameReadyed(),jitterBuffer:this.mse.getBufferLen(),playdelay:this.mse.getFramePlayDelays()})}}}onCheckFastTimer(t,e){this.started&&(this.mse.onCheckFastTimer(t,e),this.backToP2P.onCheckFastTimer(t,e),this.loader.onCheckFastTimer(t,e))}_reportFlvFlow(){this.qaStat&&this.heartBeat20sMetric(0,!0)}pauseCheck(t){if(!this.started)return;let e=0,i=this.info.curBitrate/8-10,s=this.loader.speed/1024|0;e=s>0&&s<i?N.a.pauseReason.FLV_NET_SLOW:N.a.pauseReason.FLV_NO_BUFF,this.recvTime>0&&t-this.recvTime>2e3&&(e=N.a.pauseReason.FLV_NO_DATA);let r=this.getBufferLen();r>1e3&&(e=N.a.pauseReason.FLV_UNKNOW_PAUSE),e>this.pauseReason&&(this.pauseReason=e),n.a.warn("FlvPlayer(".concat(this._id,").pauseCheck curReason=").concat(e," reportReason=").concat(this.pauseReason," buffLen=").concat(r))}statCPDetalBw(t){const e=this.flvPcdnState;e==ms.CLOSED?this.stat.addCore(d.a.DIM_CORE.UNOPEND_CPFLV_BW,t):e==ms.TAF_REQ?this.stat.addCore(d.a.DIM_CORE.NORETURN_CPFLV_BW,t):e==ms.TAF_RSP||e==ms.PCDN_NAME?this.stat.addCore(d.a.DIM_CORE.UNSUPPORT_CPFLV_BW,t):e==ms.LIB_LOAD||e==ms.LIB_FAIL?this.stat.addCore(d.a.DIM_CORE.LOAD_LIB_CPFLV_BW,t):e==ms.GATHER_START?this.stat.addCore(d.a.DIM_CORE.GATHER_CPFLV_BW,t):e==ms.GATHER_FAIL?this.stat.addCore(d.a.DIM_CORE.GATHER_FAIL_CPFLV_BW,t):e==ms.GATHER_SUC||e==ms.LOAD_START||e==ms.LOAD_SUC?this.stat.addCore(d.a.DIM_CORE.LOAD_SUC_CPFLV_BW,t):e==ms.LOAD_TIMEOUT||e==ms.LOAD_DATA_TIMEOUT||e==ms.LOAD_STOP||e==ms.LOAD_FAIL||e==ms.LOAD_FINISH||e==ms.SDK_DESTROYED?this.stat.addCore(d.a.DIM_CORE.ERROR_CPFLV_BW,t):e==ms.KICK_ERROR?this.stat.addCore(d.a.DIM_CORE.KICK_CPFLV_BW,t):e==ms.WAIT_CDN_LOAD?this.stat.addCore(d.a.DIM_CORE.WAIT_CDN_LOAD_CPFLV_BW,t):e==ms.DTS_ERROR?this.stat.addCore(d.a.DIM_CORE.DTS_ERROR_CPFLV_BW,t):this.stat.addCore(d.a.DIM_CORE.OTHER_CPFLV_BW,t)}getPcdn302Stats(){return this.loader.getPcdn302Stats()}sendNoPicture(){this._sendVideoNoPicture(),this._sendVideoNoPictureAll()}_sendVideoNoPicture(){}_sendVideoNoPictureAll(){let t=this.connectTime-this.startTs,e=this.recvDataTime-this.startTs;if(this.videoLoadTimeSent=!0,!this.hasPicture){const i=99999;let s=0;this.isMse&&(s=this.mse.isMediaSourceOpen?1:2);const r=R.b.getBrowserHidden();this.isMse&&r&&2==s?n.a.log("FLvPlayer._sendVideoLoadTimeAll browserHidden=".concat(r,", isMediaSourceOpen=").concat(s)):this.tsdb.sendNoPictureTimeAll(i,t,e,"flv","",this.exceptionStat.getStat())}}triggerChangeLine(){this._hyPlayer&&(n.a.log("FlvPlayer.triggerChangeLine",this._hyPlayer.netFlvErrorCnt),this._hyPlayer.netFlvErrorCnt>3&&this.eventEmitter.trigger(u.FLV_CHANGE_LINE))}swapToPcdn(){this.isUsingPcdn=!0}swapToCdn(){this.isUsingPcdn=!1}triggerUnAvailible(t){if(this._hyPlayer&&this._hyPlayer.flvUnAvailibleRetry&&this._hyPlayer.hasOwnProperty("flvUnavailableCnt")&&(this._hyPlayer.flvUnavailableCnt++,n.a.log("FlvPlayer.triggerUnAvailible, cnt=".concat(this._hyPlayer.flvUnavailableCnt)),1==o.a.isFlvUrlRetry&&this._hyPlayer.flvUnavailableCnt>2))return void(this._hyPlayer.flvUnAvailibleRetry&&this._hyPlayer.flvUnAvailibleRetry());this.startTs>0&&_.a.now()-this.startTs<5e3&&this._sendVideoNoPictureAll(),n.a.log("FlvPlayer.triggerUnAvailible after 2s");let e=this._hyPlayer.netFlvErrorCnt||1;clearTimeout(this._flvUnavailibleTimeout),this._flvUnavailibleTimeout=setTimeout(this._triggerUnAvailible.bind(this),Math.min(1e3*e,1e4),t)}_triggerUnAvailible(t){n.a.log("FlvPlayer._triggerUnAvailible"),t?this.eventEmitter.trigger(u.FLV_URL_UNAVAILABLE_IN,t):this.eventEmitter.trigger(u.FLV_URL_UNAVAILABLE_IN)}},nr=class{constructor(){this.osTime=0,this.syncLocalTime=0,this.rttList=[]}convertToSrvTime(t){if(0===this.osTime)return 0;{let e=t-this.osTime;return this.syncLocalTime+e}}isFinishNtp(){return 0!==this.osTime}ntpProcess(t,e){let i=_.a.now(),s=i-t,r=Math.round(e+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else{let t=[];for(let e=0;e<this.rttList.length;++e)t.push(this.rttList[e]);t.sort((function(t,e){return t-e}));var a=0;for(let e=0;e<4;++e)a+=t[e];let e=a>>2;(4*s>3*e&&4*s<5*e||s>6e4)&&(this.osTime=i,this.syncLocalTime=r),this.rttList.shift(),this.rttList.push(s),t=null}}};function hr(t,e){for(let i=0;i<t.length;i++){let s=t[i];s.length<e&&(s+=" ".repeat(e-s.length),t[i]=s)}return t.join("\n")}var dr=class{constructor(t){this.loaderHandler=t,this._destroy=!1,this.reset()}reset(){this.u8arr=new Uint8Array(0)}destroy(){n.a.log("SliceHandler.destroy"),this.u8arr=null,this._destroy=!0,this.loaderHandler=null}onData(t){let e=this.u8arr,i=new Uint8Array(t);0===e.length?this.u8arr=i:(this.u8arr=new Uint8Array(e.length+i.length),this.u8arr.set(e,0),this.u8arr.set(i,e.length));let s=this.onProto(this.u8arr);s>0&&!this._destroy&&(this.u8arr=this.u8arr.slice(s))}onProto(t){let e,i,s,r,a,o,n=new DataView(t.buffer),h=0,d=0;for(;h+10<t.byteLength&&!this._destroy;){if(d=n.getUint16(h+8,!0),d<10)return this.loaderHandler.onProtoError(d),h;if(h+d>t.byteLength)return h;s=n.getUint32(h,!0),r=n.getUint32(h+4,!0),a=4294967296*r+s,o=n.getUint32(h+14,!0),i=t.slice(h+10,h+d),e=new tt.PP2pSliceData,e.seq=a,e.uri=o,e.payload=i,this.loaderHandler&&this.loaderHandler.onSlice(tt.ProtoUri.PP2pSliceData,e),h+=d}return h}};class lr{constructor(t){this.loaderMgr=t,this.p2pPlayer=t.p2pPlayer,this.tsdbUtil=t.p2pPlayer.tsdb,this.stat=t.p2pPlayer.stat,this.type=lr.TYPE_FULL,this.sliceHandler=new dr(this),this.url=null,this.lineType=-1,this.started=!1,this.status=0,this.connecting=!1,this.connectTotalTs=0,this.flowRetryTimes=0,this.lastSeq=0,this.connectTs=0,this.connectedTs=0,this.firstPkgTs=0,this.reportUrl=null,this.sliceTs=0,this.sliceStamp=0,this.tcpStamp=0,this.logMark="FullStream",this.logMarkCss="color:#01814A;background:#FFF5C2;font-weight:bold;",this._testNodata=1==f.a._testNodata,this._testRenderTimeout=1==f.a._testRenderTimeout,this.ConnectTotalTime=Number(o.a.connectTotalTime),this.ConnectTimeout=Number(o.a.connectTimeout),this.FlowTimeout=Number(o.a.flowTimeout),this.FlowRetryTimes=Number(o.a.flowRetryTimes),this.RenderTimeout=Number(o.a.renderTimeout),this.NoDataTimeout=Number(o.a.noDataTimeout),this.hisLinks=new yt(this.stat)}destroy(){this.clearTimer(),this.loaderMgr=null,this.p2pPlayer=null,this.tsdbUtil=null,this.stat=null,this.url=null,this.link&&this.link.destroy(),this.link=null,this.sliceHandler&&this.sliceHandler.destroy(),this.sliceHandler=null,this.hisLinks&&this.hisLinks.destroy(),this.hisLinks=null}onSlice(t,e){let i=e.seq;0===this.lastSeq&&n.a.log("VideoLoader.onFirstSeq",this.getLoaderInfo(),"seq",i),this.lastSeq>0&&Math.abs(i-this.lastSeq)>1&&n.a.warn("VideoLoader seq discontinuous, lastSeq="+this.lastSeq+" curSeq="+i+" jump="+(i-this.lastSeq)),this.lastSeq=i,e.from=this.type,this.p2pPlayer.sliceProtoHandler.onSlice(e)}onProtoError(t){n.a.warn("SliceHandler.onProto length error pktLen="+t+", smaller than 10 bytes.",this.getLoaderInfo())}getLoaderInfo(){let t="bufLen="+this.p2pPlayer.bufferLen;return"type=".concat(this.type," line=").concat(this.lineType," ").concat(t)}resetReport(){this.sliceStamp=0,this.tcpStamp=0}clearTimer(){X.remove(this.onCheckTimer,this),X.remove(this.onConnectTimeout,this),X.remove(this.onFirstDataTimeout,this),X.remove(this.onRenderTimeout,this)}reset(){this.sliceHandler&&(this.sliceHandler.destroy(),this.sliceHandler=null),this.sliceHandler=new dr(this),this.status=0,this.lastSeq=0,this.connecting=!1,this.connectTs=0,this.connectedTs=0,this.firstPkgTs=0,this.sliceTs=0,this.resetReport(),this.clearTimer(),this.link&&(this.link.url&&this.hisLinks.addHis(this.link),this.link.destroy(!1)),this.url&&this.url.startsWith("http")?h.a.firefox&&mt.isSupported()?this.link=new mt(this):this.link=new _t(this):this.link=new pt(this,!1)}connect(t,e){this.url=t,this.lineType=e,this.reset();let i=_.a.now();this.connectTs=i,this.tcpStamp=i;let s=t,r=this.p2pPlayer.G;if(!r.isStartFromUrl){const t=o.a.platform,e=N.a.PLATFORM_TYPE[t]||N.a.PLATFORM_TYPE.web,i=t===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);s+="&timeStamp="+_.a.getDateTimeStr().replace(" ","_"),s+="&".concat(i,"&t=").concat(e),s=R.b.urlInfoParams(s,this.p2pPlayer.info),r.myIp&&(s+="&myIp="+r.myIp)}n.a.log("%c".concat(this.logMark),this.logMarkCss,"".concat(s," ").concat(this.getLoaderInfo())),this.connecting=!0,this.link.connect(s),this.stat.setComDim(d.a.DIM_COM.STREAM_URL,s),this.started=!0,X.add(this.onCheckTimer,this,1e3),this.p2pPlayer.beforeTurnToFlv(N.a.turnToFlvReason.FULL_CONNECT_TIMEOUT),X.once(this.onConnectTimeout,this,this.ConnectTimeout)}reconnect(){if(null==this.url||-1===this.lineType)return void n.a.warn("VideoLoader.reconnect url=".concat(this.url," line=").concat(this.lineType));let t=this.loaderMgr.antiCode;t&&-1===this.url.indexOf(t)&&(this.url=this.url.replace(/(wsSecret=.+?&wsTime=.+?)(\&|$)/,t+"$2"));let e=this.p2pPlayer.info;if(e){let t=new RegExp("//(.*?)"+e._domain+"/"),i=this.p2pPlayer.changeDomain();this.url=i?this.url.replace(t,"//"+i+"/"+e._domain+"/"):this.url.replace(t,"//"+e._domain+"/")}n.a.log("VideoLoader.reconnect"),this.close(),this.connect(this.url,this.lineType)}close(){this.reset(),this.started=!1}on302(t){this.loaderMgr.on302(t)}onheader(t){this.p2pPlayer.onHeader(t)}onopen(){let t=_.a.now();this.connectedTs=t;let e=this.connectedTs-this.connectTs;n.a.log("VideoLoader.onopen ".concat(this.getLoaderInfo()," cost time=").concat(e));let i=this.p2pPlayer.G;0===i.connectVideoTime&&(i.connectVideoTime=t,n.a.log("%c[TIME] connectVideoTime="+(i.connectVideoTime-i.startTime)+" totalTime="+(t-i.startTime),"color:#A23400;background:#FFF5C2")),this.connecting=!1,this._reportTcp(),this.p2pPlayer.exceptionStat.setStat(d.a.DIM_LINK_STA.CONNECT_SUC,1),this.p2pPlayer.beforeTurnToFlv(N.a.turnToFlvReason.FULL_NO_DATA),X.remove(this.onConnectTimeout,this),X.once(this.onFirstDataTimeout,this,this.FlowTimeout),this.loaderMgr.onConnected()}_onclose(){this.connecting=!1,this.resetReport(),this.sliceTs>0?this.getProxy("onclose"):this.connectedTs>0?this.onFirstDataTimeout():X.once(this.onConnectTimeout,this,1e3),this.p2pPlayer.exceptionStat.setStat(d.a.DIM_LINK_STA.CONNECT_SUC,0)}onclose(){n.a.log("VideoLoader.onclose ".concat(this.getLoaderInfo())),this._onclose()}onerror(t,e){n.a.log("VideoLoader.onerror ".concat(this.getLoaderInfo())),404!==e&&403!==e||(this.tsdbUtil.httpError=!0,this.tsdbUtil.sendMetrics([this.stat.createAct(d.a.ACT.HTTP_CODE_+e,{value:[this.type]})])),this._onclose(),403===e&&this.p2pPlayer&&this.p2pPlayer.subError403&&this.p2pPlayer.subError403()}onstatus(t){this.status=t}onConnectTimeout(){this.connectedTs>0||(this._reportStat(1),this.connectTotalTs+=_.a.now()-this.connectTs,n.a.warn("VideoLoader.onConnectTimeout connectTotalTs=".concat(this.connectTotalTs,"/").concat(this.ConnectTotalTime," ").concat(this.getLoaderInfo())),this.connectTotalTs<this.ConnectTotalTime&&this.reconnect(),this.p2pPlayer.loaderErrorTimes++)}onFirstDataTimeout(){if(this.sliceTs>0)return;let t=_.a.now();n.a.warn("VideoLoader.onFirstDataTimeout",t-this.connectedTs),this.flowRetryTimes++<this.FlowRetryTimes&&this.reconnect(),this.p2pPlayer.loaderErrorTimes++}onRenderTimeout(){this.sliceTs>0&&this.p2pPlayer.onRenderTimeout()}get connected(){return this.link&&this.link.connected}get speed(){let t=this.link.speed;return t==R.b.UintMax&&(t=0),t}_reportStat(t){this.stat.addComp(d.a.P2P_TCP_TYPE.name,d.a.K+this.type,1),this.stat.addComp(d.a.P2P_TCP_STATE.name,d.a.K+t,1)}_reportNoSlice(t){if(0!==this.sliceStamp&&t-this.sliceStamp>2500&&this.url){this.p2pPlayer.exceptionStat.setStat(d.a.DIM_LINK_STA.NO_SLICE_DATA,1);let t=this.p2pPlayer.G;this.tsdbUtil.sendMetrics([this.stat.createAct(d.a.ACT.TCP_NO_SLICE,{value:[this.type],str:[t.wanIp]})]),this.sliceStamp=0}}_reportNoHeader(){this.url&&this.reportUrl!==this.url&&(this.reportUrl=this.url)}_reportTcp(){let t=this.p2pPlayer.G,e=_.a.now()-this.tcpStamp;this.tcpStamp>0&&e>1e3&&this.url&&e<1e4&&this.tsdbUtil.sendMetrics([this.stat.createAct(d.a.ACT.TCP_OPEN_TIME,{value:[this.type,e],str:[t.wanIp]})]),this.tcpStamp=0}onData(t){if(this._testNodata||!this.p2pPlayer)return;this.p2pPlayer.G.globalSpeedCalc.addCur(t.byteLength),this.p2pPlayer.addBytes(t.byteLength);let e=_.a.now();if(this.sliceTs=e,this.sliceStamp=e,0===this.firstPkgTs){this.firstPkgTs=e;let i=this.firstPkgTs-this.connectedTs,s=R.b.formatByteSize(t.byteLength);if(n.a.log("VideoLoader.onData ".concat(this.getLoaderInfo()," firstPkgTs=").concat(i," size=").concat(s)),this.p2pPlayer.beforeTurnToFlv(N.a.turnToFlvReason.FULL_PLAY_FAIL),X.remove(this.onFirstDataTimeout,this),this.p2pPlayer.isShieldStart){const t=o.a.shieldAudioCfg[2]+1e3;n.a.log("VideoLoader.onData.bufferAV shieldStart,timeout=".concat(t)),X.once(this.onRenderTimeout,this,o.a.shieldAudioCfg[2]+1e3)}else X.once(this.onRenderTimeout,this,this.RenderTimeout);this.connectTotalTs=0,this.flowRetryTimes=0}this._testRenderTimeout||(this.link instanceof pt?this.sliceHandler.onProto(new Uint8Array(t)):this.sliceHandler.onData(t),this.p2pPlayer.exceptionStat.setStat(d.a.DIM_LINK_STA.HAS_DATA,1))}onCheckTimer(t,e){this.started&&(this._reportNoSlice(t),this.sliceTs>0&&t-this.sliceTs>=this.NoDataTimeout&&this.getProxy("noDataTime="+(t-this.sliceTs)))}getProxy(t){n.a.log("VideoLoader.getProxy ".concat(t," ").concat(this.getLoaderInfo())),this._reportNoHeader(),this.reset(),this.p2pPlayer.loaderErrorTimes++,this.p2pPlayer.onRestart(N.a.restartReason.CONNECT)}}lr.TYPE_FULL=1,lr.TYPE_SUB=2,lr.TYPE_RANGE=3,lr.TYPE_PATCH=4;var cr=lr,ur=class{static getFlvHeader(){let t=new Uint8Array(13),e=0;return t[e++]=70,t[e++]=76,t[e++]=86,t[e++]=1,t[e++]=5,t[e++]=0,t[e++]=0,t[e++]=0,t[e++]=9,t[e++]=0,t[e++]=0,t[e++]=0,t[e++]=0,t}static packAudioFlvTag(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=e.length+2,r=new Uint8Array(11+s+4),a=0;return r[a++]=8,r[a++]=s>>16&255,r[a++]=s>>8&255,r[a++]=255&s,r[a++]=t>>16&255,r[a++]=t>>8&255,r[a++]=255&t,r[a++]=t>>24&255,r[a++]=0,r[a++]=0,r[a++]=0,-1!=i&&(r[a++]=175,r[a++]=i),r.set(e,a),a+=e.length,s+=11,r[a++]=s>>24&255,r[a++]=s>>16&255,r[a++]=s>>8&255,r[a++]=255&s,r}static packAvcFlvTag(t,e,i){let s=e.length+5,r=new Uint8Array(11+s+4),a=0;r[a++]=9,r[a++]=s>>16&255,r[a++]=s>>8&255,r[a++]=255&s,r[a++]=t>>16&255,r[a++]=t>>8&255,r[a++]=255&t,r[a++]=t>>24&255,r[a++]=0,r[a++]=0,r[a++]=0,r[a++]=i||23,r[a++]=0,r[a++]=0,r[a++]=0,r[a++]=0,r.set(e,a),a+=e.length;let o=11+s;return r[a++]=o>>24&255,r[a++]=o>>16&255,r[a++]=o>>8&255,r[a++]=255&o,r}static adtsToConfig(t){let e=new Uint8Array(2),i=1+((192&t[2])>>6),s=(60&t[2])>>2,r=(1&t[2])<<2|(192&t[3])>>6;return e[0]=i<<3|(14&s)>>1,e[1]=(1&s)<<7|r<<3,e}static setFrameTimestamp(t,e){e[4]=t>>16&255,e[5]=t>>8&255,e[6]=255&t,e[7]=t>>24&255}static getAvc(t){let e=t.streamData[0];return e+=t.streamData[1]<<8,e+=t.streamData[2]<<16,e+=t.streamData[3]<<24>>>0,t.streamData.slice(4,4+e)}static trimIFrame(t,e){t.streamData=t.streamData.slice(4+e)}},pr=class{constructor(t){this.videoPlayer=t,this.firstFrameDts=0,this.isCanPlay=!1,this.lastPlaySeq=0,this.lastPlayDts=0,this.lastPlayFrameId=0,this.lastDtsJumpTs=0,this.lastFrameIdJumpTs=0,this.frameDuration=0,this.chain=new ae,this.recvChain=new ae,this.fullChain=new ae,this.lateChain=new ae,this.type=""}printChainInfos(){n.a.log("Recver.printChainInfos ".concat(this.type," lastPlayFrameId=").concat(this.lastPlayFrameId," lastPlayDts=").concat(this.lastPlayDts)),this.printChainInfo(this.chain,"chain"),this.printChainInfo(this.recvChain,"recvChain"),this.printChainInfo(this.fullChain,"fullChain"),this.printChainInfo(this.lateChain,"lateChain")}printChainInfo(t,e){if(t.size>0){let i=[],s=[];t.resetTravel();let r=0,a=0,o=t.travel();for(;o;)i.push(o.key-r),r=o.key,o.dts&&(s.push(o.dts-a),a=o.dts),o=t.travel();n.a.log("".concat(this.type," ").concat(e," frameIdList=").concat(i.join(","))),s.length>0&&n.a.log("".concat(this.type," ").concat(e," dtsArr=").concat(s.join(",")))}}getLastData(){return{firstFrameDts:this.firstFrameDts,lastPlaySeq:this.lastPlaySeq,lastPlayDts:this.lastPlayDts,lastPlayFrameId:this.lastPlayFrameId}}setLastData(t){this.firstFrameDts=t.firstFrameDts,this.lastPlaySeq=t.lastPlaySeq,this.lastPlayDts=t.lastPlayDts,this.lastPlayFrameId=t.lastPlayFrameId}getSize(){return this.chain.size}getWaitFrames(){return this.chain.size<=0?0:this.chain.peekLast().key-this.lastPlayFrameId}getReason(){let t=this.chain.peek();return t&&this.lastPlayFrameId>0?t.isFull?t.key-this.lastPlayFrameId>1?1:2:3:0}getFrameGap(){let t=this.chain.peek();return t&&this.lastPlayFrameId>0?t.key-this.lastPlayFrameId:0}checkPlay(t,e){0===this.firstFrameDts&&(this.firstFrameDts=t,this.lastPlayDts=t-1),this.isCanPlay||(this.isCanPlay=t-this.firstFrameDts>=e)}trimBeforeDts(t){let e=this.chain.peek();for(;e&&e.dts<t;)this.chain.get(),e=this.chain.peek();return e&&n.a.log("Recver.trimBeforeDts "+this.type+", firstFrame="+e.key+" firstDts="+e.dts),e}trimBeforeFrameId(t){let e=this.chain.peek();for(;e&&e.key<t;)this.chain.get(),e=this.chain.peek();e&&n.a.log("Recver.trimBeforeFrameId "+this.type+", firstFrame="+e.key+" firstDts="+e.dts)}checkDropFrames(t){}startDropFrames(t){return 0}_getFrameAble(t,e){if(0===this.lastPlayFrameId)return!0;if(e.key-this.lastPlayFrameId==1)return!0;let i=this.videoPlayer.getBufferLen();if(1===o.a.frameAblePloy){if(t-this.lastPushTs>i&&t-e.createTs>o.a.frameTimeout)return!0}else{let s=this.videoPlayer.getJitterBufferLen(),r=t-this.lastPushTs;if(0!=s){if(r>s)return"video"==e.type&&n.a.log("Recver._getFrameAble.push jitBuf, pushDelta=".concat(r,", bufLen=").concat(i)),!0}else if(r>i)return"video"==e.type&&n.a.log("Recver._getFrameAble.push bufLen, pushDelta=".concat(r,", bufLen=").concat(i)),!0;if(t-e.createTs>o.a.frameTimeout)return"video"==e.type&&n.a.log("Recver._getFrameAble.create, createDelta=".concat(t-e.createTs,", bufLen=").concat(i)),!0}return i<1e3&&t-e.recvTs>o.a.frameTimeout}getFrame(t){let e=this.chain.peek();if(e&&e.isFull&&this._getFrameAble(t,e)){let i=!1;return this.lastPlayFrameId>0&&e.key-this.lastPlayFrameId>1&&(this.lastFrameIdJumpTs=t,i=!0,n.a.warn("Recver.getFrame isAudio=".concat(e.isAudio," frameId disconnect, lastId=").concat(this.lastPlayFrameId," curId=").concat(e.key," gap=").concat(e.key-this.lastPlayFrameId," cache=").concat(this.chain.size," disLastPushTs=").concat(t-this.lastPushTs))),this.lastPlayFrameId=e.key,this.lastPlayDts>0&&(e.dts-this.lastPlayDts>1e3||this.lastPlayDts-e.dts>1e3)&&(this.lastDtsJumpTs=t),!i&&this.lastPlayDts>0&&(this.frameDuration=e.dts-this.lastPlayDts),this.lastPlayDts=e.dts,this.lastPushTs=t,this.chain.get(),e}return null}getMaxSeq(t){let e=this.chain.head,i=0;for(;e;){let s=e.data;if(!(t-s.createTs>1100))break;if(i=s.getMaxSeq(),e.next===this.chain.head)break;e=e.next}return i}hasNextFrame(t){let e=this.chain.peek();return!(!e||!e.isFull)&&(0===this.lastPlayFrameId||e.key-this.lastPlayFrameId==1||e.isTimeout(t))}hasFrame(){return this.chain.size>0}peekFrame(){return this.chain.peek()}peekLastFrame(){return this.chain.peekLast()}playFrame(t,e){this.lastPlayDts>0&&(t.dts-this.lastPlayDts>1e3||this.lastPlayDts-t.dts>1e3)&&(this.lastDtsJumpTs=e);let i=!1;this.lastPlayFrameId>0&&t.key-this.lastPlayFrameId>1&&(i=!0,n.a.warn("Recver.getFrame isAudio=".concat(t.isAudio," frameId disconnect, lastId=").concat(this.lastPlayFrameId," curId=").concat(t.key," gap=").concat(t.key-this.lastPlayFrameId," cache=").concat(this.chain.size," disLastPushTs=").concat(e-this.lastPushTs))),!i&&this.lastPlayDts>0&&(this.frameDuration=t.dts-this.lastPlayDts),this.lastPlayFrameId=t.key,this.lastPlayDts=t.dts,this.lastPlaySeq=t.getMaxSeq(),this.lastPushTs=e,this.chain.get()}isFrameIdContinued(t){return 0===this.lastPlayFrameId||t.key-this.lastPlayFrameId==1}isDtsContinued(t){return this.lastPlayDts-t.dts<200}getBuffers(t){let e=0,i=0,s=0,r=0;if(this.chain.size>1){let t=this.chain.head.next;for(;t.next!==this.chain.head;){let a=t.data;a.isFull&&(0===e&&(e=a.dts),i=a.dts,0!==r&&a.key-r!=1||(s=i,r=a.key)),t=t.next}}return 0===s&&i>0&&(s=i),{recvBuffer:i-e,continueBuffer:s-e,fpsBuffer:t>0?this.chain.size/t*1e3:0}}printNextFrameInfo(){}getNeedRangeSeqs(t,e,i){}reset(){this.lastPlayFrameId=0,this.lastPlayDts=0,this.chain.reset(),this.isCanPlay=!1,this.firstFrameDts=0,this.lastPushTs=0}getDtsByLostSeq(t){if(t<this.lastPlaySeq)return this.lastPlayDts;let e=0;for(this.chain.resetTravel();;){let i=this.chain.travel();if(!i)break;if(t<i.getMinSeq()){e=i.key-1;break}if(t<i.getMaxSeq()){e=i.key;break}}return e>0?this.lastPlayDts+this.frameDuration*(e-this.lastPlayFrameId+1):-1}};class mr{constructor(){this.type=null,this.createTs=0,this.recvTs=0,this.key=null,this.size=0,this.pktNum=0,this.packets=[],this.dts=0,this.streamData=null,this.aacConfig=null,this.firstPktSeq=0,this.lastPktSeq=0}setData(t,e,i){}addData(t){}reset(){this.key=null,this.pktNum=null,this.size=0,this.packets=[],this.streamData=null,this.firstPktSeq=0,this.lastPktSeq=0,this.dts=R.b.UintMax,this.recvTs=null}get isAudio(){return this.type===mr.Types.Audio}get isVideo(){return this.type===mr.Types.Video}get isFull(){return this.packets.length===this.pktNum}get isEmpty(){return 0===this.packets.length}isTimeout(t){return this.createTs>0&&t-this.createTs>o.a.frameTimeout}getPos(){return 0}getDts(){let t=this.getPos(),e=((255&this.streamData[t+7])<<24>>>0)+((255&this.streamData[t+4])<<16)+((255&this.streamData[t+5])<<8)+(255&this.streamData[t+6]),i=e;return this.type===mr.Types.Video?1==f.a._jumpV?i+=1e6:2==f.a._jumpV&&(i-=1e6):1==f.a._jumpA?i+=1e6:2==f.a._jumpA&&(i-=1e6),i!==e&&(this.streamData[t+7]=i>>>24&255,this.streamData[t+4]=i>>>16&255,this.streamData[t+5]=i>>>8&255,this.streamData[t+6]=255&i),i}getMaxSeq(){return this.packets[this.packets.length-1].seq}getMinSeq(){return this.packets[0].seq}getSeqs(){let t=[];return this.packets.forEach((function(e){t.push(e.seq)})),t}getLostSeqs(){let t=[],e=this.packets.length;if(e<this.pktNum){let i=this.packets[0].seq,s=this.packets[e-1].seq,r=i;for(let i=1;i<e;i++){let e=this.packets[i].seq;for(;r<e;)t.push(r),r++}let a=this.pktNum-e;for(;a-- >0;)t.unshift(--i),t.push(++s)}return t}}mr.Types={Video:"video",Audio:"audio"};var _r=mr,fr=class extends _r{constructor(){super()}addData(t){if(0===this.packets.length)this.createTs=_.a.now(),this.key=t.frameId,this.frameType=3&t.seqNum,this.pktNum=t.frameNum,this.packets.push(t),this.size+=t.streamData.length;else{if(1==f.a._autoDropVideo&&this.isVideo?(f.a._autoDropVideo=0,this._autoDrop=!0):1==f.a._autoDropAudio&&this.isAudio&&(f.a._autoDropAudio=0,this._autoDrop=!0),this._autoDrop)return!1;if(this.isFull)return!0;let e=!0;for(let i=this.packets.length-1;i>=0;i--){if(this.packets[i].seqNum===t.seqNum)return!0;if(this.packets[i].seqNum<t.seqNum){this.packets.splice(i+1,0,t),this.size+=t.streamData.length,e=!1;break}}e&&(this.packets.splice(0,0,t),this.size+=t.streamData.length)}if(this.isFull){this.streamData=new Uint8Array(this.size);let e=0,i=this.packets.length;for(let t=0;t<i;t++)this.streamData.set(this.packets[t].streamData,e),e+=this.packets[t].streamData.length;if(this.firstPktSeq=this.packets[0].seq,this.lastPktSeq=this.packets[i-1].seq,this.dts=this.getDts(),this.recvTs=_.a.now(),Number(f.a._printVideoFrame)){let e=this.dts-n.a.lastDts,i=e>100?"background:#FF9797":"",s=e>100?"-_-":"";n.a.debug("%cVideo frameType="+this.frameType+" seq="+t.seq+" frameId="+this.key+" dts="+this.dts+" %c^dts="+e,"color:#F00",i,s),n.a.lastDts=this.dts}}return!0}},gr=class extends fr{constructor(){super(),this.type=_r.Types.Video}get isKeyFrame(){return 0===this.frameType}get isPFrame(){return 1===this.frameType}get isBFrame(){return 2===this.frameType}getPos(){let t=0;return this.isKeyFrame&&(t=this.streamData[0],t+=this.streamData[1]<<8,t+=this.streamData[2]<<16,t+=this.streamData[3]<<24>>>0,t+=4),t}},Sr=class extends pr{constructor(t){super(t),this.type="VideoRecver",this.codecname="",this.avcConfig=null,this.lastRecvTs=0,this.lateSeqs=0,this.dropFrames=0,this.playedFrames=0,this.dtsJumpPauseTimes=0,this.skipFramePauseTimes=0,this.forceSkipFrameNums=0,this.waitNextIFrame=!1,this.frameSeqLostTs=0,this.frameDropTs=0,this.firstIFrameId=0,this.recvSeqCnt=0,this.fullSeqCnt=0,this.lateSeqCnt=0,this.lateFrames=new Map}resetSeqCnt(){this.recvSeqCnt=0,this.fullSeqCnt=0,this.lateSeqCnt=0,this.lateFrames.clear()}getLastData(){let t=super.getLastData();return t.avcConfig=this.avcConfig,t}setLastData(t){super.setLastData(t),this.avcConfig=t.avcConfig}recvData(t){if(this.recvSeqCnt++,t.frameId<=this.lastPlayFrameId)return this.lateSeqCnt++,this.lateFrames.set(t.frameId,1),ae.addData(this.lateChain,{key:t.frameId},Number(o.a.avHeaderChangeCfg[2])),3;if(t.frameId<this.firstIFrameId)return n.a.log("VideoRecver.recvData RECV_LATE_FRAMEID frameId=".concat(t.frameId," firstIFrameId=").concat(this.firstIFrameId)),6;this.lastRecvTs=_.a.now(),t.config.has(12)&&(this.codecname=t.config.get(12));let e=this.chain.getOrNewNode(t.frameId);if(!e)return 4;let i=e.data;i||(i=new gr,e.data=i,ae.addData(this.recvChain,{key:t.frameId},Number(o.a.avHeaderChangeCfg[2]))),i.addData(t),i.isKeyFrame&&0===this.firstIFrameId&&(this.firstIFrameId=i.key,this.trimBeforeFrameId(this.firstIFrameId));let s=_.a.now(),r=this.videoPlayer.p2pPlayer.G;0===r.firstVideoPkgTime&&(r.firstVideoPkgTime=s,n.a.log("%c[TIME] firstVideoPkgTime="+(s-r.connectVideoTime)+" totalTime="+(s-r.startTime)+" seq="+t.seq+" frameType="+i.frameType,"color:#A23400;background:#FFF5C2"," frameId="+i.key)),0===r.firstIFrameTime1&&0===i.frameType&&(r.firstIFrameTime1=s,n.a.log("%c[TIME] firstIFrameTime1="+(s-r.connectVideoTime)+" totalTime="+(s-r.startTime)+" seq="+t.seq+" sliceNum="+i.pktNum,"color:#A23400;background:#FFF5C2"," frameId="+i.key));let a=i.isFull;return this.videoPlayer.firstTsStatus<2&&a&&i.isKeyFrame&&(this.videoPlayer.setFirstDTs(2,i.dts),r.firstIFrameTime2=s,n.a.log("%c[TIME] firstIFrameTime2="+(s-r.firstIFrameTime1)+" totalTime="+(s-r.startTime)+" seq="+t.seq+" sliceNum="+i.pktNum,"color:#A23400;background:#FFF5C2"," frameId="+i.key)),a?(this.videoPlayer.dtsChecker.isVideoDtsDiffLarge(i.dts),ae.addData(this.fullChain,{key:t.frameId,dts:i.dts},Number(o.a.avHeaderChangeCfg[2])),this.fullSeqCnt+=i.pktNum,this.checkPlay(i.dts,230),2):0}needUrgendResend(t){let e=this.chain.peek();return e&&t-e.createTs>o.a.urgentResendTime}getWaitFrameTime(t){let e=this.chain.peek();return e?t-e.createTs:0}checkDropFrames(t){let e=this.chain.peek();e&&t-e.createTs<o.a.forceSkipFrameTime||this.startDropFrames(t)}getFramesDisNextIFrame(){this.chain.resetTravel();let t=0,e=!1;for(;;){let i=this.chain.travel();if(!i)break;if(i.isKeyFrame){e=!0;break}t++}return e?t:-1}startDropFrames(t){let e=this.lastPlayFrameId,i=0,s=this.chain.get();n.a.log("VideoRecver.startDropFrames",s);let r=this.chain.peek(),a="VideoRecver.startDropFrames",o=[],h=this.videoPlayer.p2pPlayer.p2pMgr.getLastContinueSeq(),d=0;for(s&&(d=s.getMaxSeq(),h-d>200&&(this.frameSeqLostTs=t),i++,o.push(s.key),a+=" resendTimes:"+s.urgentResendTimes+" frameId:"+s.key+" pktNum:"+s.pktNum+" hasNum:"+s.packets.length+" seqs:"+(s.pktNum>0?"".concat(s.packets[0].seq,"-").concat(s.packets[s.packets.length-1].seq):""),a+=" lastContinueSeq=".concat(h));r;){if(r.isKeyFrame){this.setNextIFrame(r);break}this.waitNextIFrame=!0,o.push(r.key),r.isFull&&(this.lastPlayDts=r.dts,this.lastPlaySeq=r.firstPktSeq),d=r.getMaxSeq(),this.chain.get(),r=this.chain.peek(),i++}return d>0&&d>h&&this.videoPlayer.p2pPlayer.p2pMgr.setLastContinueSeq(d),i>0&&(this.frameDropTs=t,this.forceSkipFrameNums+=i,a+=" dropNum:"+i+" cache:"+this.chain.size+" lastPlayFrameID:"+e,n.a.log(a,o)),i}checkNextIframe(){if(!this.waitNextIFrame)return;let t=this.chain.peek();for(;t;){if(t.isKeyFrame){this.setNextIFrame(t);break}this.lastPlayFrameId=t.key,t.isFull&&(this.lastPlayDts=t.dts,this.lastPlaySeq=t.firstPktSeq),this.chain.get(),t=this.chain.peek()}}setNextIFrame(t){n.a.log("VideoRecver.setNextIFrame",this.lastPlayFrameId,this.lastPlayDts,t.key,t.dts),this.lastPlayFrameId=t.key-1,t.isFull&&(this.lastPlayDts=t.dts,this.lastPlaySeq=t.firstPktSeq),this.waitNextIFrame=!1}getNeedRangeSeqs(t,e){if(this.lastPlayFrameId>0&&this.chain.size>0){let i=this.chain.head;for(;;){let s=i.data;if(s.isFull&&s.dts>=t)break;if(s.isFull||0!==s.urgentResendTimes||(s.urgentResendTimes=1,s.getLostSeqs().forEach(t=>{this.videoPlayer.hasSeq(t)||e.add(t)})),e.size>640)break;if(i=i.next,i===this.chain.head)break}}}getFrame(t){let e=super.getFrame(t);return e&&(this.lastPlaySeq=e.firstPktSeq),e}getFullSeqMax(){let t=0;for(this.chain.resetTravel();;){let e=this.chain.travel();if(!e||!e.isFull)break;t=e.lastPktSeq}return t}printInfo(t){let e=this.chain.head,i=0,s=0,r=0,a=0;e&&(i=e.data.key,s=e.data.getMaxSeq());let o=0,h=0,d=0;for(;e;){let t=e.data;if(o++,h+=t.pktNum,d+=t.size,e.next===this.chain.head){r=t.key,a=t.getMaxSeq();break}e=e.next}n.a.log("VideoInfo ".concat(t," frameCnt=").concat(o," pktCnt=").concat(h," hasCnt=").concat(d," firstId=").concat(i," firstSeq=").concat(s," endId=").concat(r," endSeq=").concat(a))}printNextFrameInfo(){this.chain.resetTravel();let t=0,e=this.lastPlayDts,i=this.lastPlayFrameId,s=!1;for(;;){let r=this.chain.travel();if(!r)break;if(s||(s=!0,n.a.log("VideoRecver.printNextFrameInfo nextFrameId=".concat(r.key," firstDts=").concat(r.isFull&&r.getDts()," firstPktNum=").concat(r.pktNum," firstPackets=").concat(r.packets.length," firstLostSeqs=").concat(r.getLostSeqs().toString()))),!r.isFull){n.a.log("VideoRecver.printNextFrameInfo totalCnt=".concat(this.chain.size," fullCnt=").concat(t," fullDts=").concat(e," fullFrameId=").concat(i," frameDuration=").concat(this.frameDuration),r.key,r.pktNum,r.packets.length,r.getLostSeqs().toString());break}e=r.getDts(),i=r.key,t++}}reset(){super.reset(),this.waitNextIFrame=!1,this.codecname="",this.avcConfig=null,this.lastRecvTs=0,this.resetSeqCnt()}},yr={MUSIC_MID:1,MUSIC_MID_TIME_LEN:2048e3/44100,MUSIC_MID_128:35,MUSIC_MID_128_TIME_LEN:1024e3/44100,MUSIC_MID_160:36,MUSIC_MID_160_TIME_LEN:1024e3/44100,MUSIC_MID_192:37,MUSIC_MID_192_TIME_LEN:1024e3/44100,MUSIC_MID_48K_MONO:100,MUSIC_MID_48K_STEREO:101,MUSIC_MID_48K_TIME_LEN:1024e3/48e3,VOICE_HIGHER:2,VOICE_HIGHER_TIME_LEN:20,VOICE_HIGHER_FRAME_LEN:882,VOICE_HIGHER_QUALITY1:22,VOICE_HIGHER_QUALITY1_TIME_LEN:20,VOICE_HIGHER_QUALITY1_FRAME_LEN:882,getAudioTimeLen:function(t){switch(t){case this.MUSIC_MID:return this.MUSIC_MID_TIME_LEN;case this.MUSIC_MID_128:return this.MUSIC_MID_128_TIME_LEN;case this.MUSIC_MID_160:return this.MUSIC_MID_160_TIME_LEN;case this.MUSIC_MID_192:return this.MUSIC_MID_192_TIME_LEN;case this.MUSIC_MID_48K_MONO:case this.MUSIC_MID_48K_STEREO:return this.MUSIC_MID_48K_TIME_LEN;case this.VOICE_HIGHER:return this.VOICE_HIGHER_TIME_LEN;default:return this.MUSIC_MID_TIME_LEN}}},Tr=class extends _r{constructor(){super()}setData(t,e,i){this.key=t,this.streamData=e,this.packets.push(i),this.dts=this.getDts(),this.recvTs=this.createTs=_.a.now(),this.firstPktSeq=this.lastPktSeq=i.seq}get isFull(){return!0}},Pr=class extends Tr{constructor(){super(),this.type=_r.Types.Audio}},vr=class extends fr{constructor(){super(),this.type=_r.Types.Audio}getAacConfig(){return this.isFull?this.packets[0].audioHeader:null}},Er=class extends pr{constructor(t){super(t),this.type="AudioRecver",this.isAudioFrameTimeLenInited=!1,this.audioFrameTimeLen=yr.MUSIC_MID_TIME_LEN,this.isAacCfgChange=!1,this.offset=0,this.lastRecvFrameDts=0,this.lastResendSeq=0,this.lastResendFrameId=0,this.audioCnt=0,this.bigAudioCnt=0,this.aacConfig=null}getLastData(){let t=super.getLastData();return t.aacConfig=this.aacConfig,t}setLastData(t){super.setLastData(t),this.aacConfig=t.aacConfig}resetAudioNum(){this.audioCnt=0,this.bigAudioCnt=0}reset(){super.reset(),this.isAudioFrameTimeLenInited=!1,this.audioFrameTimeLen=yr.MUSIC_MID_TIME_LEN,this.lastRecvFrameDts=0,this.lastPlaySeq=0,this.aacConfig=null,this.lastResendSeq=0,this.lastResendFrameId=0,this.resetAudioNum()}recvData(t){if(t.seq<=this.lastPlaySeq)return 3;let e=_.a.now(),i=this.videoPlayer.p2pPlayer.G;return 0===i.firstAudioPkgTime&&(i.firstAudioPkgTime=e,n.a.log("%c[TIME] firstAudioPkgTime="+(e-i.connectVideoTime)+" totalTime="+(e-i.startTime),"color:#A23400;background:#FFF5C2")),this.isAudioFrameTimeLenInited||(this.isAudioFrameTimeLenInited=!0,this.audioFrameTimeLen=yr.getAudioTimeLen(t.codecType),n.a.log("AudioRecver.recvData codecType="+t.codecType+" aacTimeLen="+this.audioFrameTimeLen)),this.offset=0,this.readAacConfig(t),this.readAacTag(t),2}recvDataV2(t){if(1==o.a.closeBigAudio)return;if(t.frameId<=this.lastPlayFrameId)return ae.addData(this.lateChain,{key:t.frameId},Number(o.a.avHeaderChangeCfg[2])),3;let e=this.chain.getOrNewNode(t.frameId);if(!e)return 4;let i=e.data;if(i||(i=new vr,e.data=i,ae.addData(this.recvChain,{key:t.frameId},Number(o.a.avHeaderChangeCfg[2])),this.bigAudioCnt++),i.addData(t),i.isFull){ae.addData(this.fullChain,{key:t.frameId,dts:i.dts},Number(o.a.avHeaderChangeCfg[2]));let e=i.getAacConfig();return this._printAudioFrame(i),this._updateAacConfig(e),this.isAacCfgChange&&(i.aacConfig=e),this.videoPlayer.dtsChecker.isAudioDtsDiffLarge(i.dts),this.checkPlay(i.dts,500),2}return 0}readAacConfig(t){let e=t.streamData,i=(e[1]<<16)+(e[2]<<8)+e[3];this.offset=11+i+4;let s=e.slice(0,this.offset);this._updateAacConfig(s)}_updateAacConfig(t){this.isAacCfgChange=!1,null===this.aacConfig?(this.aacConfig=t,this.videoPlayer.initAacConfig(t),n.a.log("AudioRecver.decodeAacConfig aacConfig="+t.slice(-8,-4).toString())):this.aacConfig.toString()!==t.toString()&&(n.a.warn("AudioRecver.decodeAacConfig aacConfig change, "+this.aacConfig.slice(-8,-4).toString()+" -> "+t.slice(-8,-4).toString()),this.isAacCfgChange=!0,this.aacConfig=t)}readAacTag(t){let e,i,s,r=t.streamData,a=this.videoPlayer.isFirstAudio(),n=new DataView(r.buffer),h=r.length,d=this.offset;for(;d<h;){if(e=n.getUint32(d,!0),i=n.getUint32(d+4,!0),i<=this.lastPlayFrameId){d+=e;continue}s=r.slice(d+8,d+e),d+=e;let h=new Pr;h.setData(i,s,t),ae.addData(this.fullChain,{key:i,dts:h.dts},Number(o.a.avHeaderChangeCfg[2])),this.isAacCfgChange&&(h.aacConfig=this.aacConfig),this.audioCnt++,this.chain.put(h),a&&(a=!1,this.videoPlayer.setFirstDTs(0,h.dts)),this.videoPlayer.dtsChecker.isAudioDtsDiffLarge(h.dts),this.checkPlay(h.dts,500),this._printAudioFrame(h),this.lastRecvFrameDts=h.dts}}_printAudioFrame(t){if(1===Number(f.a._printAudioFrame)){let e=t.dts-this.lastRecvFrameDts,i=e>100?"background:#FF9797":"",s=e>100?"-.-":"";n.a.debug("%cAudio firstSeq="+t.firstPktSeq+(t.firstPktSeq!==t.lastPktSeq?" lastSeq="+t.lastPktSeq:"")+" frameId="+t.key+" dts="+t.dts+" %c^dts="+e,"color:#090",i,s)}}checkDropFrames(t){let e=this.chain.peek();if(e&&!e.isFull){let e=this.videoPlayer.getCurrentDts();(this.lastPlayDts<e||this.lastPlayDts-e<800)&&this.startDropFrames(t)}}startDropFrames(t){let e=[],i=0,s=0,r=this.chain.peek();for(;r&&!r.isFull;)0===i&&(i=r.getMinSeq()),e.push(r.key),this.lastPlaySeq=s=r.getMaxSeq(),this.lastPlayFrameId=r.key,this.chain.get(),r=this.chain.peek();if(e.length>0){let{recvBuffer:t,continueBuffer:i}=this.getBuffers(this.videoPlayer.msePlayer.getRealFpsAudio());n.a.log("AudioRecver.startDropFrames videoBuffer=".concat(this.videoPlayer.getBufferLen()," recvBuffer=").concat(t," continuedBuffer=").concat(i," frames=").concat(e.join(",")," curDts=").concat(this.videoPlayer.getCurrentDts()," lastPushDts=").concat(this.lastPlayDts," hasFrames=").concat(this.chain.size))}return e.length}hasNextFrame(t){let e=super.hasNextFrame(t);return e||this.videoPlayer.fastOver||1!=o.a.closeBigAudio||(e=!0),e}_getFrameAble(t,e){let i=super._getFrameAble(t,e);return i||this.videoPlayer.fastOver||1!=o.a.closeBigAudio||(i=!0),i}getFrame(t){let e=super.getFrame(t);return e&&(this.lastPlaySeq=e.firstPktSeq),e}getNeedRangeSeqs(t,e,i){if(this.lastPlayFrameId>0&&this.chain.size>0){let t=Math.max(this.lastResendFrameId,this.lastPlayFrameId),s=this.chain.head;for(;;){let r=s.data;if(r.key-1>t&&(this.getLostSeqs(r,e,i),t=r.key),e.size>=640)break;if(s=s.next,s===this.chain.head)break}this.lastResendFrameId=t}}getLostSeqs(t,e,i){let s=Math.max(this.lastResendSeq,this.lastPlaySeq),r=t.getMaxSeq();for(let t=s;t<r&&(t>this.lastResendSeq&&(i(t)||e.add(t),this.lastResendSeq=t),!(e.size>=640));t++);}printNextFrameInfo(){let t=this.chain.peek(),e="AudioRecver.printNextFrameInfo totalCnt=".concat(this.chain.size," lastPushDts=").concat(this.lastPlayDts," lastFrameId=").concat(this.lastPlayFrameId," lastSeq=").concat(this.lastPlaySeq);t&&(e+=" nextDts=".concat(t.isFull&&t.getDts()," frameId=").concat(t.key," ").concat(t.getSeqs().toString())),n.a.log(e)}},Cr=new class extends Ht{constructor(){super(),this.libName="pcore.js",this.loaded=!1,this.p2pLib=null,this.ON_LOAD="on_load",this.callbacks={onLoaded:this.onLoaded,onError:this.onLoadedError,thisObj:this}}isSupport(){return window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.PeerConnection||window.webkitPeerConnection||window.mozPeerConnection}hasLib(){return null!==window.P2PLib}loadLib(t,e,i){this.hyPlyer=e,t?(i||(i=this.libName,o.a.platform==N.a.PLATFORM_TYPE_NAME.wap&&(i="p2plib-202401091836.js")),this.loaded?this.trigger(this.ON_LOAD):Ji(t,i,this.callbacks)):n.a.warn("P2PLibProxy.loadLib root none")}onLoaded(){Qi(this.libName,this.callbacks),window.P2PLib?(this.loaded=!0,this.p2pLib=new P2PLib({ntp:Ft,userInfo:v.a,roomInfo:null,config:o.a,TafLink:r,Timer:Vs,TimeUtil:_.a,logger:n.a,HUYA:tt.HUYA,Taf:tt.TafBase}),this.trigger(this.ON_LOAD),this.hyPlyer.reportLoadP2PLib(!1)):this.loadP2PLibError()}onLoadedError(){this.loadP2PLibError()}loadP2PLibError(){this.hyPlyer.reportLoadP2PLib(!0)}playStream(t){return this.p2pLib?this.p2pLib.playStream(t):null}removeStream(t){t&&this.p2pLib.removeStream(t)}clearPunch(){this.p2pLib&&this.p2pLib.clearPunch()}clearVideo(){this.p2pLib&&this.p2pLib.clearVideo()}inflate(t,e){if(this.p2pLib)return this.p2pLib.inflate(t,e)}hasPcdnSubs(){return!!this.p2pLib&&this.p2pLib.hasPcdnSubs()}},Ir=class extends it{constructor(t){super(t),this.data={act:"webhuyah5qa",uid:0,sid:0,subsid:0,linetype:-1,sendcnt:0,paucount:0,paulength:0,bflength:0,vr:0,httphead:"",rel:"jsscene",ref:location.href,isp2p:1},this.img=null,this.isPaused=!1,this.hasEmptyFrames=!1,this.isFirstReport=!0}send(){}record(t){this.handlerPlayer.qaStaRecord&&this.handlerPlayer.qaStaRecord(),t.isPaused&&(this.isPaused=!0),this.sendNewMetrics(t)}sendFlow(t){this.record(t)}sendNewMetrics(t){super.sendRecordMetrics();let{pauseCnt:e,pauseTime:i,isPaused:s,isPausedWorker:r,pauseReason:a,forceSkipFrameNums:h,isEnd:l,pauseWorkerCnt:c,isFramePaused:u}=t,p=this.handlerPlayer.G,m=this.handlerPlayer.p2pStat.getMetrics(),f=this.handlerPlayer.mse;this.handlerPlayer.player&&(f.pauseStat.record(this.stat),f.buffered.record(this.stat),this.rcordCaptureJitter(f.getCaptureStats(!0))),this.stat.setCoreDim(d.a.DIM_CORE.USER_PROPERTY,N.a.userProperty.P2P),this.recordPlayStat(),this.reportVideoBadQuality(s,e,l,c,r,u),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_REASON,a),this.stat.setCoreDim(d.a.DIM_CORE.SIGNAL_USER_PROPERTY,0),this.stat.setComDim(d.a.DIM_COM.VIDEO_MIN_BUF,f.JITTER_BUFLEN),this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.visibility&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat(),this.handlerPlayer.recSysStat.recordHeart(this.stat),this.handlerPlayer.autoMonitor.recordHeartType(),f.avSyncStat.record(this.stat),this.recordC2CDelay(),this.recordAuto(),this.isFirstReport?this.isFirstReport=!1:0===o.a.statLv[15]&&m.push({sMetricName:A.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0,pausecnt:e,forceskipframe:h},vDimension:{success:this.tsdb.hasP2P,originalBitrate:0===this.handlerPlayer.info.originalBitrate?1:0,p2pCooling:v.a.p2pCooling?1:0,topSid:p.sid,reason:a,quality:s||e>0?100:0},vExLog:{cdnip:this.handlerPlayer.getCdnip()}}),this.isPaused=!1,this.hasEmptyFrames=!1;let g={f_params:this.handlerPlayer.pcdnIaasParam,switchInfo:[]};if(this.handlerPlayer.p2pMgr.stream){let t=this.handlerPlayer.p2pMgr.stream,e=t.stat;if(e.record&&e.record(),this.recordMpsStat(t&&t.getMpsSubs?t.getMpsSubs():0),e.subStreamStat){let t=e.subStreamStat.substream_type,i=e.subStreamStat.substream_state;if(t&&i&&t.length===i.length){let e=t.length,s="";for(let r=0;r<e;r++)r>0&&(s+=","),s+=t[r]+":"+i[r];this.stat.setCoreDim(d.a.DIM_COM.SUB_PCDN_STATE,s)}}for(let t in e.bw){let i=e.bw[t];i>0&&this.stat.addCore(t,i)}const i=e.bw.cdn_total_bw,s=e.bw.fast_bw,r=e.bw.patch_bw,a=e.bw.unopend_cp_bw,h=e.bw.noreq_cp_bw,l=e.bw.noreturn_cp_bw,c=e.bw.error_cp_bw,u=e.bw.kicked_cp_bw,p=e.bw.range_total_bw,m=a+h+l+c+u+p+s+r,_=e.bw.taf_gather_bw,f=e.bw.taf_cover_bw,S=e.bw.taf_load_bw,y=e.bw.taf_unknown_bw,T=_+f+S+y;n.a.log("QAStat.recordCdnBw, cdnBw=".concat(i,", tafGBw=").concat(_,", tafCBw=").concat(f,", tafLBw=").concat(S,", tafUBw=").concat(y,", uocBw=").concat(a,", ncbBw=").concat(h,", nrcpBw=").concat(l,", tafPTotalBw=").concat(T," ecBw=").concat(c,", kcBw=").concat(u,", rangeBw=").concat(p,", fastBw=").concat(s,", patchBw=").concat(r,", totalBw=").concat(m)),this._recordSetCore(e.pResend_info),1===o.a.rtPeerPRN&&this._recordSetCore(e.peer_range_nonode),this._recordSetCore(e.pcdn_data),e.mps_data&&this._recordSetCore(e.mps_data),this._recordSetCore(e.cdn_pull_data),this._recordPcdnWebrtc(e);for(let t in e.pcdn_rsp){let i=e.pcdn_rsp[t];switch(typeof i){case"string":""!==i&&this.stat.setCoreDim(t,i);break;case"object":let e=this._getPcdnRspValue(i);""!==e&&this.stat.setCoreDim(t,e)}}if(e.sub_change_state){let t=this.getSubChangeState(e.sub_change_state);t.length>0&&this.stat.setCoreDim(d.a.DIM_COM.SUB_CHANGE_STATE,t)}for(let t in e.core)t===d.a.DIM_COM.STREAM_URL&&ut.setCdnDomain(this.stat,e.core[t],this.handlerPlayer.info.sStreamName),this.stat.setComDim(t,e.core[t]);if(e.cdn_sip&&""!=e.cdn_sip&&this.stat.setComDim(d.a.DIM_COM.CDN_SIP,e.cdn_sip),e.psub_proxy_info){let t=[];for(let i in e.psub_proxy_info){let s="";if(e.psub_proxy_info.hasOwnProperty(i)){const r=e.psub_proxy_info[i];s="".concat(i,":").concat(r.total_cnt,":").concat(r.suc_cnt),t.push(s)}}const i=t.join(",");n.a.log("QAStat.PcdnProxyList.psubProxyInfo: ".concat(i)),this.stat.setComDim(d.a.DIM_COM.PSUB_PROXY_INFO,i)}if(e.sub_state_info&&""!=e.sub_state_info&&(n.a.log("QAStat.PcdnProxyList.subStateInfo: ".concat(e.sub_state_info)),this.stat.setComDim(d.a.DIM_COM.SUB_STATA_INFO,e.sub_state_info)),e.qps_info&&(e.qps_info.full_cdn_cnt>0&&this.stat.addCore(d.a.CORE.FULL_CDN_CNT,e.qps_info.full_cdn_cnt),e.qps_info.sub_cdn_cnt>0&&this.stat.addCore(d.a.CORE.SUB_CDN_CNT,e.qps_info.sub_cdn_cnt),e.qps_info.patch_cdn_cnt>0&&this.stat.addCore(d.a.CORE.PATCH_CDN_CNT,e.qps_info.patch_cdn_cnt)),e.cdnpRtts){let t=0;e.cdnpRtts.forEach(e=>{e>t&&(t=e)}),this.recordFrameInfo(e.cdnpRtts,d.a.DIM_COM.CDNP_RTT),this.stat.setCore(d.a.DIM_COM.CDNP_RTT_MAX,t)}for(let t in e.pcdn_data_state)this.stat.setComDim(t,e.pcdn_data_state[t]);e.notReachedPcdnSubs&&e.notReachedPcdnSubs.length>0&&this.stat.setCoreDim("experiment",e.notReachedPcdnSubs.join(",")),e.hasOwnProperty("range_sip_suc_cnt")&&(e.range_sip_suc_cnt>0&&this.stat.setCore(d.a.CORE.RANGE_SIP_SUC_CNT,e.range_sip_suc_cnt),e.range_sip_dif_cnt>0&&this.stat.setCore(d.a.CORE.RANGE_SIP_DIF_CNT,e.range_sip_dif_cnt),e.range_req_cnt>0&&this.stat.setCore(d.a.CORE.RANGE_REQ_CNT,e.range_req_cnt),e.range_rsp_cnt>0&&this.stat.setCore(d.a.CORE.RANGE_RSP_CNT,e.range_rsp_cnt),e.range_info.connectCnt>0&&this.stat.setCore(d.a.CORE.RANGE_CONNECT_TIME,parseInt(e.range_info.connectTime/e.range_info.connectCnt)),e.range_info.rspCnt>0&&this.stat.setCore(d.a.CORE.RANGE_RSP_TIME,parseInt(e.range_info.rspTime/e.range_info.rspCnt))),this.recordSample(!1);let P=t.getPunchedCnt();window.mpsApi&&window.mpsApi.saveSdkMaxPunchedCnt&&window.mpsApi.saveSdkMaxPunchedCnt(P),this.stat.setCore(d.a.CORE.BUFFER_LENGTH,this.handlerPlayer.bufferLen+this.handlerPlayer.frameBufferLen),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES,P),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES_SDKV2,t.getPunchedCntSdk?t.getPunchedCntSdk():0),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES_WEBV2,t.getPunchedCntWeb?t.getPunchedCntWeb():0),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES_MEDIA,t.getPunchedCntMedia?t.getPunchedCntMedia():0),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES_SIGNAL,t.getPunchedCntSignal?t.getPunchedCntSignal():0),this.stat.setCore(d.a.CORE.FORWARD_REJECT_CNT,e.forward_reject_cnt),this.stat.setCoreDim(d.a.CORE.PUNCHED_UUIDS,t.getPunchedUids?t.getPunchedUids():""),this.setComp(e,d.a.UPDOWN_INFO.name),this.setComp(e,d.a.SUB_INFO.name),this.setComp(e,d.a.PUNCH_INFO.name),this.setComp(e,d.a.PUNCH_BACK_RET.name),this.setComp(e,d.a.RESEND_INFO.name),this.setComp(e,d.a.SUB_RETURN.sub_name),this.setComp(e,d.a.SUB_RETURN.switch_name),this.setComp(e,d.a.SUB_RETURN.last_name),this.setComp(e,d.a.FORCESUB_REASON.name),this.setComp(e,d.a.NONODE_RETURN.name),this.setComp(e,d.a.P2P_TCP_TYPE.name),this.setComp(e,d.a.P2P_TCP_STATE.name),this.setComp(e,d.a.PCDN_BW_DATA.name);const v=(this.handlerPlayer.p2pMgr.stream.stat.updown_info||{}).downlink_bw||0;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.SPEED,v);let E=[];for(let t in e.iaas_total_info){let i="";if(e.iaas_total_info.hasOwnProperty(t)){let r=e.iaas_total_info[t];if(t==this.handlerPlayer.pcdnIaas&&(r+=s),i+="".concat(t,":").concat(r),e.iaas_repeat_info.hasOwnProperty(t)?i+=":".concat(e.iaas_repeat_info[t]):i+=":0",e.iaas_valid_info.hasOwnProperty(t)){let r=e.iaas_valid_info[t];t==this.handlerPlayer.pcdnIaas&&(r+=s),i+=":".concat(r)}else i+=":0"}E.push(i)}0==E.length&&this.handlerPlayer.isPcdnIaas&&E.push("".concat(this.handlerPlayer.pcdnIaas,":").concat(s,":0:").concat(s));const C=E.join(",");(E.length>0||this.handlerPlayer.isPcdnIaas)&&n.a.log("QAStat.iaasBwInfo: fullIaasBw:".concat(s)),this.stat.setComDim(d.a.DIM_COM.IAAS_BW_INFO,C),g.switchInfo=e.p_iaas_info,this.stat.setComDim(d.a.DIM_COM.P_IAAS_INFO,JSON.stringify(g)),e.reset()}else{this.stat.addCore(d.a.CORE.CDN_TOTAL_BW,this.handlerPlayer.p2pMgr.fast_bw),this.stat.addCore(d.a.CORE.FAST_BW,this.handlerPlayer.p2pMgr.fast_bw);const t=this.handlerPlayer.p2pMgr.fast_bw;this.handlerPlayer.isPcdnIaas&&(n.a.log("QAStat.iaasBwInfo: fullIaasBw:".concat(t)),this.stat.setComDim(d.a.DIM_COM.IAAS_BW_INFO,"".concat(this.handlerPlayer.pcdnIaas,":").concat(t,":0:").concat(t))),this.stat.setComDim(d.a.DIM_COM.P_IAAS_INFO,JSON.stringify(g)),this.handlerPlayer.p2pMgr.fast_bw=0}let S=this.handlerPlayer.player;const{recvVideoFps:y,recvAudioFps:T}=f.metadata;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_RATE,T),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_RATE,y);const{emptyTime:P,emptyCnt:E}=f.bufStat.getStats();if(this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_COUNT,E),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_TIME,P),this.recordBaseStat(),this.handlerPlayer.eventEmitter&&this.handlerPlayer.eventEmitter.costUs>0&&this.stat.setComp(d.a.DIM_H265_SAM.name,"costUs",this.handlerPlayer.eventEmitter.costUs),S){S.videoRecver&&(S.videoRecver.chain&&this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_WAIT_PUSH,S.videoRecver.chain.size),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_WAIT_GAP,S.videoRecver.getFrameGap()),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_WAIT_PUSH,S.videoRecver.getSize())),S.audioRecver&&(this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_WAIT_GAP,S.audioRecver.getFrameGap()),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_WAIT_PUSH,S.audioRecver.getSize())),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_AUDIO_GAP,S.getDtsGap());let t=S.getReasons(_.a.now());this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_WAIT_REASON,t.audioReason),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_WAIT_REASON,t.videoReason)}const C=f.curVideoDts,I=f.curAudioDts;this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_DTS,C),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_DTS,I),this.handlerPlayer.recordRecvFps(this.stat),f.metadata&&f.metadata.codecname&&this.stat.setComDim(d.a.DIM_COM.SPHD_TYPE,f.metadata.codecname),o.a.renderStat[0]&&this.reportAVRenderInfo(f),this.stat.setCompFormat(d.a.DIM_LINK_SAM.name,":",","),this.stat.setComDim(d.a.DIM_COM.CDNIP,this.handlerPlayer.getCdnip()),this.stat.setCore(d.a.DIM_CORE.F_BUF,this.handlerPlayer.p2pMgr.fastBuffer),this.recordAiData(),this.recordMuteData(),super.recordHeart(),this.stat.fill(m,l),this.statQps.sendQps(this.tsdb,m,l)}_recordPcdnWebrtc(t){this._recordSetCore(t.wr_info);for(let e in t.wr_cost){let i=t.wr_cost[e];if(i>0){let s=t.wr_cost_cnt["".concat(e,"_cnt")];s>0&&this.stat.setCore(e,Math.floor(i/s))}}}_recordSetCore(t){for(let e in t){let i=t[e];i>0&&this.stat.setCore(e,i)}}recordPlayStat(){let t=null;if(this.handlerPlayer.player&&(t=this.handlerPlayer.player.getStat()),t){this.handlerPlayer.p2pStat.record.dropFrames=t.dropFrames,this.handlerPlayer.p2pStat.record.playedFrames=t.playedFrames,this.handlerPlayer.p2pStat.record.dtsJumpPauseTimes=t.dtsJumpPauseTimes,this.handlerPlayer.p2pStat.record.skipFramePauseTimes=t.skipFramePauseTimes;let e=t.dropFrames;this.handlerPlayer.p2pStat.record.fullFrameRatio=0==e?100:0,this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.LATE_SEQS,t.lateSeqs),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.LOSS_FRAMES,t.dropFrames),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.PLAY_FRAMES,t.playedFrames),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.DTS_JUMPPAUSE_CNT,t.dtsJumpPauseTimes),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.SKIP_PAUSE_CNT,t.skipFramePauseTimes),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.FULL_RATIO,0==e?100:0),this.stat.setComp(d.a.FRAME_INFO.name,d.a.FRAME_INFO.EMPTY_FRAMES,t.emptyFrames),this.stat.setCore(d.a.VIDEO_LINK.PVSSC,t.recvSeqCnt),this.stat.setCore(d.a.VIDEO_LINK.PVFSC,t.fullSeqCnt),this.stat.setCore(d.a.VIDEO_LINK.PVLSC,t.lateSeqCnt),this.stat.setCore(d.a.VIDEO_LINK.PVLFC,t.lateFrames),this.stat.setCore(d.a.VIDEO_LINK.PVPFC,t.pushFrames),this.stat.setCore(d.a.VIDEO_LINK.PVPTC,t.parseVideoTagCnt),this.stat.setCore(d.a.VIDEO_LINK.PVPAFC,t.parseVideoSucCnt),this.stat.setCore(d.a.VIDEO_LINK.PVRFC,t.remuxVideoCnt),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_DROP_FRAMES,t.forceSkipFrameNums)}}_getPcdnRspValue(t){let e=[];for(let i in t)e.push("".concat(i,":").concat(t[i]));return e.join(",")}recordSample(t){this.handlerPlayer.sampleController.recordStat(this.stat,t),this.handlerPlayer.mse.parser.avSample.recordStat(this.stat);let e=this.handlerPlayer.mse;e.parser&&e.parser.avcChangeStat&&e.parser.avcChangeStat.record(this.stat,o.a.getAvHeaderChangeStat(this.handlerPlayer.info.presenterUid))}recordAiData(){const{aiP2PCnt:t,aiFlvCnt:e,aiP2PTimeoutCnt:i,aiFlvTimeoutCnt:s,aiP2PErrorCnt:r,aiFlvErrorCnt:a,aiP2PSwitchCnt:o,aiFlvSwitchCnt:n,aiP2PNotSwitchCnt:h,aiFlvNotSwitchCnt:l,aiFlvErrorSwitchCnt:c,aiFlvErrorNotSwitchCnt:u,aiStartP2PCnt:p,aiStartFlvCnt:m}=this.handlerPlayer.getAiStat();this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_CNT,t),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_CNT,e),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_TIMEOUT_CNT,i),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_TIMEOUT_CNT,s),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_ERROR_CNT,r),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_CNT,a),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_SWITCH_CNT,o),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_SWITCH_CNT,n),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_P2P_NOT_SWITCH_CNT,h),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_NOT_SWITCH_CNT,l),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_SWITCH_CNT,c),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_FLV_ERROR_NOT_SWITCH_CNT,u),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_START_P2P_CNT,p),this.stat.setComp(d.a.AI_CONTROL_DATA.name,d.a.AI_CONTROL_DATA.AI_START_FLV_CNT,m),this.stat.setCompFormat(d.a.AI_CONTROL_DATA.name,":",",")}recordMuteData(){if(this.handlerPlayer._hyPlayer.getMuteStat){const{muteData:t}=this.handlerPlayer._hyPlayer.getMuteStat();let e=[];t.map(t=>{let i=[];i.push(t.value),i.push(t.type),i.push(t.currentDts),i.push(t.reqKey),i.push(t.begin),i.push(t.end),e.push(i.join(":"))}),this.stat.setCoreDim(d.a.DIM_COM.MUTE_DATA,e.join(","))}}recordC2CDelay(){let t=this.handlerPlayer.mse.getDelayStat();if(t){for(let e in t.fields)this.stat.setCore(e,t.fields[e]);for(let e in t.dims)this.stat.setCoreDim(e,t.dims[e])}}recordAuto(){let t=this.handlerPlayer.p2pFlvPlayer.ctrlBitrate;t&&(this.stat.setCoreDim(d.a.DIM_CORE.AUTO_U_REASON,t._switchUpReason),this.stat.setCoreDim(d.a.DIM_CORE.AUTO_D_REASON,t._switchDownReason))}recordH265Frame(t,e){this.stat.setComp(e,"size",t.length),t.map((t,i)=>{this.stat.setComp(e,"k"+(i+1),t),this.stat.setCompFormat(e,":",",")})}reportAVRenderInfo(t){const e=t.videoPlayConsuming.getRecvToRenderConsuming(),i=t.videoPlayConsuming.getRecvToPushConsuming(),s=t.videoPlayConsuming.getPushToRenderedConSuming(),r=Math.round(e.max),a=Math.round(e.avg),o=Math.round(i.max),h=Math.round(i.avg),l=Math.round(s.max),c=Math.round(s.avg);r>0&&a>0&&(this.stat.setCore(d.a.DIM_CORE.VTDMAX,r),this.stat.setCore(d.a.DIM_CORE.VTDAVG,a),this.stat.setCore(d.a.DIM_CORE.VRTADEMAX,o),this.stat.setCore(d.a.DIM_CORE.VRTADE,h),this.stat.setCore(d.a.DIM_CORE.VATRDEMAX,l),this.stat.setCore(d.a.DIM_CORE.VATRDE,c));const u=t.audioPlayConsuming.getRecvToRenderConsuming(),p=t.audioPlayConsuming.getRecvToPushConsuming(),m=t.audioPlayConsuming.getPushToRenderedConSuming(),_=Math.round(u.max),f=Math.round(u.avg),g=Math.round(p.max),S=Math.round(p.avg),y=Math.round(m.max),T=Math.round(m.avg);_>0&&f>0&&(this.stat.setCore(d.a.DIM_CORE.ATDMAX,_),this.stat.setCore(d.a.DIM_CORE.ATDAVG,f),this.stat.setCore(d.a.DIM_CORE.ARTADEMAX,g),this.stat.setCore(d.a.DIM_CORE.ARTADE,S),this.stat.setCore(d.a.DIM_CORE.AATRDEMAX,y),this.stat.setCore(d.a.DIM_CORE.AATRDE,T)),t.videoPlayConsuming.clearConsuming(),t.audioPlayConsuming.clearConsuming();const P=t.renderFps.getRecordFps(),v=t.renderFps.statRenderQuality(),E=t.parser.dropFrameDts.getRecrod(),C=t.parser.fps.getRecord(),I=t.parser.fps.getFps();this.stat.setCore(d.a.DIM_CORE.VRDFPS,P),this.stat.setCore(d.a.DIM_CORE.VRCFPS,I),this.stat.setCore(d.a.DIM_CORE.VDF,E),this.stat.setCore(d.a.DIM_CORE.VRBQ,v),n.a.log("QAStat.reportAVRenderInfo P2P: video_total_delay_max=",r,"video_total_delay_avg=",a,"video_recv_to_append_delay_max=",o,"video_recv_to_append_delay=",h,"video_append_to_render_delay_max=",l,"video_append_to_render_delay=",c,"audio_total_delay_max=",_,"audio_total_delay_avg=",f,"audio_recv_to_append_delay_max=",g,"audio_recv_to_append_delay=",S,"audio_append_to_render_delay_max=",y,"audio_append_to_render_delay=",T,"video_render_fps=",P,"video_receive_fps=",I,"video_drop_frames=",E,"video_recv_frames=",C)}getSubChangeState(t){let e=[];for(let i in t){let s=t[i],r=[];for(let t in s)r.push("".concat(t,":").concat(s[t]));e.push(i+";"+r.join("|"))}return e.join(",")}setComp(t,e){let i=t[e];for(let t in i){let s=i[t];"number"==typeof s?s>0&&this.stat.setComp(e,t,s):this.stat.setComp(e,t,s)}}};class Ar{constructor(t){this.p2pPlayer=t,this.tsdbUtil=t.tsdb,this.stat=t.stat,this.p2pState=-1,this.hasFlow=!1,this.metric=new Map,this.total=new Map,this.metric20=new Map,this.subNodes=new Map,this.playBufLength=0,this.record={resendTimes:0,resendTimeoutCnt:0,resendErrorTimes:0,resendSliceCnt:0,resendRespondCnt:0,resendLateCnt:0,resendMissCnt:0,repeatResendCnt:0,repeatResendSucc:0,repeatResendFail:0,dropFrames:0,playedFrames:0,dtsJumpPauseTimes:0,skipFramePauseTimes:0,fullFrameRatio:0}}addSubNodes(t){this.subNodes.set(t,0)}add(t,e){this.hasFlow=!0,this.addValue(this.metric,t,e),this.addValue(this.total,t,e),this.addValue(this.metric20,t,e)}reset(){this.hasFlow=!1,this.total.clear(),this.metric.clear(),this.subNodes.clear()}reportFlow(){if(this.hasFlow){this.hasFlow=!1;let t=[];this.fillFlow(t),this.metric.clear(),this.stat.setCoreDim(d.a.DIM_CORE.USER_PROPERTY,N.a.userProperty.P2P),this.stat.fill(t,!0),this.tsdbUtil.sendMetrics(t)}}getMetrics(){let t=[];return this.fillLogin(t),1==!Number(f.a._noP2p)&&(this.fillPunch(t),this.fillPlayRatio(t),this.fillFlow(t),this.fillDetails(t),this.stat.setCore(d.a.CORE.HAS_PUNCH_NODES,0)),this.metric.clear(),t}onCheckTimer(t,e){e%20==0&&this.p2pPlayer.p2pMgr.stream&&this.p2pPlayer.p2pMgr.stream.printInfo()}getOldMetrics(){return[]}fillPlayRatio(t){}fillLogin(t){}fillPunch(t){}fillDetails(t){}fillFlow(t){}addValue(t,e,i){let s=0;t.has(e)&&(s=t.get(e)),t.set(e,s+i)}recordPlayBuf(){this.playBufLength=this.getMetricValue(Ar.keys.SERVER_TOTAL_STREAM_FLOW)}printLoadFail(t){if(1==Number(f.a._printP2PInfo)){let e=this.getMetricValue(Ar.keys.SERVER_TOTAL_STREAM_FLOW);t?n.a.warn("出视频失败，当前收到数据，bufferLength",e):n.a.warn("出视频成功，当前收到数据，bufferLength",e,"出视频时BufferLength",this.playBufLength)}}getValueFromMap(t,e){return t.has(e)?t.get(e):0}getMetricValue(t){return this.metric.has(t)?this.metric.get(t):0}}let Dr=5e3;function Rr(){return Dr++}Ar.keys={P2P_TOTAL_STREAM_FLOW:1,P2P_VALID_STREAM_FLOW:2,SERVER_TOTAL_STREAM_FLOW:3,SERVER_VALID_STREAM_FLOW:4,RESEND_SEQ_NUM:7,REAL_UPLINK_STREAM_SUM:8,SUBSCRIBE_TIMEOUT_TIMES:10,SUBSCRIBE_FAILED_TIMES:11,SUBSCRIBE_SUCCESS_TIMES:12,SUBSCRIBE_TOTAL_TIMES:14,INVALID_PACKET_NUM:13,TOTAL_PEER_NODES:22,ACTIVE_PUNCH_NODES:23,PASSIVE_PUNCH_NODES:24,TRY_PUNCH_NUM:29,PUNCH_FAIL_NUM:30,PUNCH_SUC_NUM:31,FORWARD_REJECT_NUM:32,GET_NODES_VALID:Rr(),GET_NODES_TOTAL:Rr(),SUB_NODES:Rr(),CDN_SLICE_SEND_COUNT:85,CDN_SLICE_RECV_COUNT:86,PUNCH_FAIL_HAS_ICE:500,PUNCH_FAIL_NO_ICE:501,RANGE_TOTAL_STREAM_FLOW:502,RANGE_VALID_STREAM_FLOW:503,SLICE_REPEAT_CDN:504,SLICE_REPEAT_P2P:505,PATCH_FLOW:Rr(),SUB_TIMEOUT_TIMES:Rr(),SUB_SUC_TIMES:Rr(),SUB_FAIL_TIMES:Rr(),SUB_TOTAL_TIMES:Rr(),SUB_TRY_TIMES:Rr(),SUB_KICK_TIMES:Rr(),COMPETE_TIMEOUT_TIMES:Rr(),COMPETE_SUC_TIMES:Rr(),COMPETE_FAIL_TIMES:Rr(),COMPETE_TOTAL_TIMES:Rr(),DIF_PEER_NUM:Rr(),FORCE_NO_PEER:Rr(),FORCE_SUB_END:Rr(),FORCE_SUB_TIMEOUT:Rr(),FORCE_SUB_FAIL:Rr(),FORCE_DEPTH_LARGE:Rr(),FORCE_SUB_FAIL_SWITCH:Rr(),FLOW_COMPETE:Rr(),FLOW_FORCE:Rr(),FLOW_FIXED:Rr(),FLOW_SINGLLING:Rr(),FLOW_DEFAULT:Rr(),FLOW_FAST:Rr(),FLOW_SINGLLING_DOWN:Rr(),FORCE_TIMES:Rr(),REMOVE_SUB_TIMES:Rr(),SUB_RES_TOTAL:Rr(),SUB_FAIL_SUC:Rr(),SUB_FAIL_STREAM_LIMIT:Rr(),SUB_FAIL_SLICE_LATE:Rr(),SUB_FAIL_SLICE_FAST:Rr(),SUB_FAIL_SLICE_LARGE:Rr(),SUB_FAIL_EMPTY_PEER_INFO:Rr(),SUB_FAIL_STREAM_LATE:Rr(),SUB_FAIL_SUBSCRIBE_UPLINK_NOT_ENOUGHE:Rr(),SUB_FAIL_SUBSCRIBE_CYCLE:Rr(),SUB_FAIL_OTHER:Rr(),SUB_FAIL_KICK_OUT:Rr(),SUB_FAIL_SELF_WORST:Rr(),SWITCH_LAST_PUB:Rr(),SWITCH_STREAM_LIMIT:Rr(),SWITCH_SLICE_LARGE:Rr(),SWITCH_SLICE_LATE:Rr(),SWITCH_SLICE_FAST:Rr(),SWITCH_EMPTY_PEER_INFO:Rr(),SWITCH_STREAM_LATE:Rr(),SWITCH_SUBSCRIBE_UPLINK_NOT_ENOUGH:Rr(),SWITCH_SUBSCRIBE_CYCLE:Rr(),SWITCH_KICK_OUT:Rr(),SWITCH_SELF_WORST:Rr(),SWITCH_SUC:Rr(),SWITCH_OTHER:Rr(),LAST_STREAM_LIMIT:Rr(),LAST_SLICE_LARGE:Rr(),LAST_SLICE_LATE:Rr(),LAST_SLICE_FAST:Rr(),LAST_STREAM_LATE:Rr(),LAST_UPLINK:Rr(),LAST_CYCLE:Rr(),LAST_KICK:Rr(),LAST_SELF_WORST:Rr(),LAST_SUC:Rr(),LAST_OTHER:Rr(),DEFAULT_REASON:Rr(),LEAVE_PING_DIF:Rr(),LEAVE_RESET:Rr(),PUNCH_BACK_TIMES:Rr(),PUNCH_BACK_SUC:Rr(),PUNCH_BACK_TRY:Rr(),PUNCH_BACK_RET_SUC:Rr(),PUNCH_BACK_RET_DIF_STREAM:Rr(),PUNCH_BACK_RET_CLOSING:Rr(),PUNCH_BACK_RET_COOLING:Rr(),PUNCH_BACK_RET_REQUEST:Rr(),PUNCH_BACK_REJECT:Rr(),RESEND_FETCH_ERROR:Rr(),VALID_RET_PRESENTER:Rr(),VALID_RET_UPLINK:Rr(),VALID_RET_PULL:Rr(),VALID_RET_SUBED:Rr(),VALID_RET_COOLING:Rr(),VALID_RET_DELAY:Rr(),VALID_RET_RTT:Rr(),VALID_RET_BW:Rr(),VALID_RET_LATE:Rr(),VALID_RET_FAST:Rr(),VALID_RET_NONE:Rr(),CLIENT_TYPE:160,RATE:120};var Or=Ar;var Lr=class extends ar{constructor(t,e){super(t,e),n.a.log("P2PPlayer(".concat(this._id,") version ").concat(v.a.version)),this.videoElement=e.videoElement,this.flvHeader=ur.getFlvHeader(),this.G=new class{constructor(){this.version=1019,this.BASE_SUBS=10,this.presenterUid=0,this.uid=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66;let t=Number(f.a.appid);t&&(this.appid=t,n.a.warn("--- test appid "+t+" ---",this)),this.sid=0,this.subSid=0,this.lineType=-1,this.bitrate=0,this.curBitrate=0,this.originalBitrate=0,this.userAbility=null,this.isStartFromUrl=!1,this.streamId=null,this.streamSeqSN=0,this.quickAccessBeginIndex=0,this.quickAccessEndIndex=0,this.exip=0,this.sslUrl="",this.myIp="",this.quickTime=0,this.urlTokenTime=0,this.urlToken="",this.wsTime="",this.videoNtp=new nr,this.stampcSvr=0,this.stampcNow=0,this.wanIp="",this.wanPort=0,this.cdnpConnected=0,this.proxyIp="",this.cdnpIp=0,this.stunPorts=[],this.enableFeatures=0,this.cdnpip=0,this.firstLogin=!0,this.loaderMgr=null,this.p2pMgr=null,this.globalSpeedCalc=new O(20),this.initTafTime=0,this.reqVpTime=0,this.getVPTime=0,this.startTime=0,this.connectVideoTime=0,this.firstVideoPkgTime=0,this.firstIFrameTime1=0,this.firstIFrameTime2=0,this.firstRenderTime=0,this.recvDataTime=0,this.onPlayTime=0,this.loadedDataTs=0,this.hyPlayerLoadTs=0,this.firstP2POnDataTime=0,this.firstP2PIframeTime=0}initUid(t){this.uuid=t,this.convertUid=R.b.rotUid(this.uid,this.presenterUid),n.a.log("Global.initUid uid=".concat(this.uid," uuid=").concat(this.uuid," convertUid=").concat(this.convertUid))}getServTime(t){if(0==this.stampcSvr)return 0;let e=t||_.a.now();return this.stampcSvr+(e-this.stampcNow)}initUseTime(t){n.a.log("initUseTime",t),this.startTime=t,this.getLivingInfoTime=0,this.connectVideoTime=0,this.firstVideoPkgTime=0,this.firstAudioPkgTime=0,this.firstIFrameTime1=0,this.firstIFrameTime2=0,this.firstRenderTime=0,this.recvDataTime=0,this.onPlayTime=0,this.loadedDataTs=0,this.hyPlayerLoadTs=0,this.firstP2POnDataTime=0,this.firstP2PIframeTime=0}printUseTime(){let t=["\n%c"+".".repeat(28)," getLivingInfoTime    = "+Math.max(0,this.getLivingInfoTime-this.startTime)," connectVideoTime     = "+(this.connectVideoTime-this.startTime)];this.firstVideoPkgTime>0?t.push(" firstVideoPkgTime    = "+(this.firstVideoPkgTime-this.connectVideoTime)," firstIFrameTime1     = "+(this.firstIFrameTime1-this.connectVideoTime)," firstIFrameTime2     = "+(this.firstIFrameTime2-this.firstIFrameTime1)," firstRenderTime      = "+(this.firstRenderTime-this.firstIFrameTime2)):t.push(" firstAudioPkgTime    = "+(this.firstAudioPkgTime-this.connectVideoTime)," firstRenderTime      = "+(this.firstRenderTime-this.firstAudioPkgTime)),t.push(" onPlayTime           = "+(this.onPlayTime-this.firstRenderTime)," totalTime            = "+(this.onPlayTime-this.startTime),".".repeat(28));let e=hr(t,28);n.a.log(e,"color:#007500;background:#FFF5C2")}printVpTime(){if(this.printVpTime.done)return;this.printVpTime.done=!0;let t=hr(["\n%c"+".".repeat(28)," initTafTime      = "+(this.initTafTime-0)," getVPTime        = "+(this.getVPTime-this.reqVpTime)," connectVpTime    = "+(this.connectVpTime-this.getVPTime)," loginTime        = "+(this.loginTime-this.connectVpTime)," totalTime        = "+(this.loginTime-this.reqVpTime),".".repeat(28)],28);n.a.log(t,"color:#007500;background:#FFF5C2")}},this.fastTimerInterval=10,this.restartTimes=0,this.resetProperty(),this.p2pStat=new Or(this),this.qaStat=new Ir(this),this.wakeChecker=new class{constructor(t,e,i){this.eventEmiter=t,this.stat=e,this.tsdb=i,this.lastTickTime=0,this.catonCheckStart=!0,this.lastCheckerTimeStamp=0,this.visibilityChanged=!1,this.lostVisibility=!1,this.hidden="",this.visibilityChange="",this.handleVisibilityChangeBind=this.handleVisibilityChange.bind(this),this.addVisibilityChange()}destroy(){document.removeEventListener(this.visibilityChange,this.handleVisibilityChangeBind,!1),this.eventEmiter=null,this.stat=null,this.tadb=null}reset(){this.lastTickTime=0,this.onRemoveWakeTimeoutChecker()}addVisibilityChange(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),document.addEventListener(this.visibilityChange,this.handleVisibilityChangeBind,!1)}handleVisibilityChange(){document[this.hidden]?this.lostVisibility=!0:this.lostVisibility=!1,this.visibilityChange=!0}onCheckFastTimer(t,e){if(0!=this.lastCheckerTimeStamp&&this.catonCheckStart){let e=t-this.lastCheckerTimeStamp;this.onWakeTimeoutTimeout(e)}this.lastCheckerTimeStamp=t}startWakeTimeoutChecker(){this.catonCheckStart=!0}onWakeTimeoutTimeout(t){if(this.lostVisibility||this.visibilityChange)return void(this.visibilityChange=!1);if(t<3e3||t>15e3)return;v.a.p2pCooling=!0,f.a.p2p_cooling_date=(new Date).getTime();let e=[this.stat.createAct(d.a.ACT.P2P_COOLING,{str:[h.a.name,h.a.version.major]})];this.tsdb.sendMetrics(e),n.a.log("WakeChecker onWakeTimeoutTimeout large than 3000 cost = "+t),100*Math.random()>99&&this.eventEmiter.trigger(Event.P2P_REPORT)}onWakeTimeoutError(t){this.onRemoveWakeTimeoutChecker(),n.a.log("MAIN: ","ERROR",t),n.a.log("filename:"+t.filename+"-message:"+t.message+"-lineno:"+t.lineno)}onRemoveWakeTimeoutChecker(){this.catonCheckStart=!1,this.lastCheckerTimeStamp=0}}(t,e.stat,e.tsdb),this.url=null,this.player=null,this.sliceProtoHandler=new tt.SliceProtoHandler,this.streamDomain=new class{constructor(){this.sP2pUrl="",this.domainList=[],this.cdnip="",this.domain="",this.cdnDomain=""}initDomain(t,e){this.sP2pUrl=t,this.domainList=e;let i=this.sP2pUrl.match(/\/\/(.+?)\//i);if(this.cdnDomain=i?i[1]:"",this.domainList&&this.domainList.length){n.a.log("P2PPlayer.initDomain:\n\t"+this.domainList.join("\n\t")),this.domain=this.cdnDomain;let t=this.domainList.shift();t!==this.domain&&(this.cdnip=t,this.sP2pUrl=this.sP2pUrl.replace(/\/\/(.+?)\//,"//"+t+"/"+this.domain+"/"))}return this.sP2pUrl}changeDomain(){if(this.domainList&&""!==this.domain){let t=this.domainList.shift();if(t===this.domain)return this.changeDomain();let e=new RegExp("//(.*?)"+this.domain+"/");return t?(this.cdnip=t,n.a.warn("P2PPlayer change domain to ".concat(t)),this.sP2pUrl=this.sP2pUrl.replace(e,"//"+t+"/"+this.domain+"/")):(n.a.warn("P2PPlayer change domain to ".concat(this.domain)),this.cdnip="",this.sP2pUrl=this.sP2pUrl.replace(e,"//"+this.domain+"/"),this.domainList=null),t}return null}},this.p2pMgr=new class{constructor(t){this.p2pPlayer=t,this.handler=new class{constructor(t){this.p2pPlayer=t}destroy(){this.p2pPlayer=null}addBytes(t){this.p2pPlayer.addBytes(t)}onNoVideo(){var t,e;null===(t=this.p2pPlayer)||void 0===t||null===(e=t.eventEmitter)||void 0===e||e.trigger(u.NO_VIDEO)}onRestart(t){var e;null===(e=this.p2pPlayer)||void 0===e||e.onRestart(t)}turnToFlv(t){var e;null===(e=this.p2pPlayer)||void 0===e||e.turnToFlv(t)}subError403(){var t;null===(t=this.p2pPlayer)||void 0===t||t.subError403()}setPcdnName(t,e){var i;null===(i=this.p2pPlayer)||void 0===i||i.setPcdnName(t,e)}onSliceData(t){var e;null===(e=this.p2pPlayer)||void 0===e||e.onSliceData(t)}onGetToken(t){this.p2pPlayer.info.sFlvAntiCode=t,this.p2pPlayer.loaderMgr.antiCode=t}autoReport(){var t,e;null===(t=this.p2pPlayer)||void 0===t||null===(e=t.eventEmitter)||void 0===e||e.trigger(u.P2P_REPORT)}getBufferLen(){var t;return null===(t=this.p2pPlayer)||void 0===t?void 0:t.bufferLen}getCts(){var t;return Math.min(null===(t=this.p2pPlayer)||void 0===t?void 0:t.ctsMax,500)}getDtsByLostSeq(t){var e;return null===(e=this.p2pPlayer)||void 0===e?void 0:e.getDtsByLostSeq(t)}getCurrentDts(){var t;return null===(t=this.p2pPlayer)||void 0===t?void 0:t.getCurrentDts()}printNextFrameInfo(){var t;null===(t=this.p2pPlayer)||void 0===t||t.printNextFrameInfo()}setPcdnIaas(t){var e,i;null===(e=this.p2pPlayer)||void 0===e||null===(i=e.setPcdnIaas)||void 0===i||i.call(e,t)}}(t),this.stream=null,this.started=!1,this.fast_bw=0,this.lastPlaySeq=0,this.lastRenderSeq=0,this.fastNum=0,this.fastBuffer=0}onFastSliceData(t){this.stream?(this.fast_bw>0&&(this.stream.stat.bw.cdn_total_bw+=this.fast_bw,this.stream.stat.bw.cdn_valid_bw+=this.fast_bw,this.stream.stat.bw.fast_bw+=this.fast_bw,this.fast_bw=0),this.stream.onFastSliceData(t),this.fastNum<100&&(this.fastNum++,100===this.fastNum&&this.checkStart())):this.fast_bw+=t.parent.payload.length+10}hasSeq(t){return!(!this.stream||!this.stream.hasSeq)&&this.stream.hasSeq(t)}isSubsReady(){return!this.stream||!this.stream.isSubsReady||this.stream.isSubsReady()}getLastFullSubTs(){return this.stream&&this.stream.getLastFullSubTs?this.stream.getLastFullSubTs():0}setLastContinueSeq(t){this.stream&&this.stream.setLastContinueSeq&&this.stream.setLastContinueSeq(t)}getLastContinueSeq(){return this.stream&&this.stream.getLastContinueSeq?this.stream.getLastContinueSeq():0}getMaxRecvSeq(){return this.stream&&this.stream.getMaxRecvSeq?this.stream.getMaxRecvSeq():0}printRangeInfo(){this.stream&&this.stream.resender.printResendInfo&&(this.stream.resender.printResendInfo(),this.stream.loaderMgr.printInfo())}resendAudio(t){this.stream&&this.stream.resender.resendAudio&&this.stream.resender.resendAudio(t)}hasPub(){return!this.stream||!this.stream.hasPub||this.stream.hasPub}urgentResend(t){this.stream&&this.stream.urgentResend(t)}setLastPushedFrame(t,e,i,s,r){this.stream&&this.stream.setLastPushedFrame(t,e,i,s,r)}setLastPlaySeq(t){this.lastPlaySeq=t,this.stream&&this.stream.setLastPlaySeq(t)}setLastRenderSeq(t){this.stream&&this.stream.setLastRenderSeq&&this.stream.setLastRenderSeq(t)}setDecodeDelay(t){this.stream&&this.stream.setDecodeDelay&&this.stream.setDecodeDelay(t)}loadLib(){1!=f.a._closeSub&&(n.a.log("P2pMgr.loadLib"),Cr.on(Cr.ON_LOAD,this.onLoadLib,this),Cr.loadLib(this.p2pPlayer.info.h5Root,this.p2pPlayer._hyPlayer,this.p2pPlayer.info.p2pLibName))}onLoadLib(){n.a.log("P2pMgr.onLoadLib"),Cr.off(Cr.ON_LOAD,this.onLoadLib,this),this.stream||(this.stream=Cr.playStream(this.p2pPlayer.info),this.stream&&(this.stream.setLastPlaySeq(this.lastPlaySeq),this.stream.streamHandler=this.handler,this.stream.tsdbUtil=this.p2pPlayer.tsdb,this.stream.tsdbStat=this.p2pPlayer.stat,this.checkUsePcdn()))}checkUsePcdn(){const t=this.p2pPlayer.info;t&&(o.a.isCloseP2PPcdnUser(t.uid)?n.a.log("P2pMgr.checkUsePcdn close by uid"):o.a.isCloseP2PPcdnPid(t.presenterUid)?n.a.log("P2pMgr.checkUsePcdn close by pid"):this.stream&&this.p2pPlayer.info.hasOwnProperty("usePcdn")&&(this.stream.usePcdn=this.p2pPlayer._checkUsePcdn()))}updateConfig(){this.stream&&this.stream.updateConfig&&this.stream.updateConfig()}checkStart(){this.stream&&this.started&&this.fastNum>=100&&!this._isCloseSub()&&(this.fastBuffer=this.p2pPlayer.getBufferLen(),this.p2pPlayer.onStartP2P(),this.p2pPlayer&&this.p2pPlayer.mse&&(this.p2pPlayer.info.JITTER_BUFLEN=this.p2pPlayer.mse.JITTER_BUFLEN),this.stream.start(this.p2pPlayer.info),this.stream.startSubStream())}_isCloseSub(){if(1==o.a.closeSub)return!0;if(o.a.closeSubRooms)for(let t=0;t<o.a.closeSubRooms.length;t++)if(o.a.closeSubRooms[t]==this.p2pPlayer.info.roomId)return!0;return!1}start(){this.started=!0,this.checkStart()}stop(){n.a.log("P2PMgr.stop"),this.started=!1,this.fast_bw=0,this.lastPlaySeq=0,this.lastRenderSeq=0,this.fastNum=0,this.fastBuffer=0,this.stopStream()}stopStream(){this.stream&&(Cr.removeStream(this.stream),this.stream.streamHandler=null,this.stream=null)}onRestart(){this.fast_bw=0,this.fastNum=0,this.started=!1,this.stream&&this.stream.onRestart()}destroy(){this.stop(),this.p2pPlayer=null,this.handler&&this.handler.destroy(),this.handler=null}switchStart(){this.stop()}hasPcdnSubs(){return!!this.stream&&Cr.hasPcdnSubs()}}(this),this.loaderMgr=new class{constructor(t){this.p2pPlayer=t,this.resetProperty(),this.fullLoader=new cr(this)}destroy(){this.p2pUrl=null,this.antiCode=null,this.streamName=null,this.p2pPlayer=null,this.fullLoader&&this.fullLoader.destroy(),this.fullLoader=null}init(t,e){this.p2pUrl=t,this.antiCode=e;let i=this.p2pPlayer.G;if(!i.isStartFromUrl){"/"===this.p2pUrl.substr(-1)&&(this.p2pUrl=this.p2pUrl.substr(0,this.p2pUrl.length-1)),this.p2pUrl=this.p2pUrl.replace(/^(http|ws)s?\:/i,""),this.streamName=i.streamId.text()+"_"+v.a.appid;let t=!0;if(-1===self.location.protocol.indexOf("https")){let e=o.a.p2pWssLines;"string"==typeof e&&(e=e.toLowerCase(),t="all"==e||-1!=e.split(",").indexOf(i.lineType.toString()))}else t=!0;void 0===f.a._testSSL?this.openWss=t:this.openWss=Number(f.a._testSSL)>0}}stop(){n.a.log("LoaderMgr.stop"),this.stopFullStream(),this.resetProperty()}resetProperty(){this.p2pUrl=null,this.antiCode="",this.streamName="",this.openWss=!0}getUrl(t){let e=t===cr.TYPE_RANGE||t===cr.TYPE_FULL&&!$.isMacChrome72()?"http":"ws";this.openWss&&(e+="s");let i="",s=this.p2pPlayer.G;return this.p2pUrl.match(/al\.p2p\.huya\.com/)&&t!=cr.TYPE_RANGE&&t!=cr.TYPE_FULL&&(i="/websocket"),this.url="".concat(e,":").concat(this.p2pUrl).concat(i,"/").concat(this.streamName,".slice?").concat(this.antiCode,"&ex1=").concat(s.exip,"&dMod=").concat(R.b.getDMod(this.p2pPlayer.info._dMod,this.p2pPlayer.info._sMod),"&baseIndex="),this.url}loadFullStream(t,e,i){let s=this.p2pPlayer.G;isNaN(t)&&(n.a.warn("LoaderMgr.loadSubStream baseIndex isNaN ["+t+"] change to 0."),t=0);let r=this.getUrl(cr.TYPE_FULL)+t;i?r+="&startPts=".concat(i):0===t&&s.quickTime>0&&(r+="&quickTime=".concat(s.quickTime)),this.url=r,this.fullLoader.connect(r,s.lineType)}stopFullStream(){this.fullLoader.close()}onConnected(){this.p2pPlayer.onConnected()}on302(t){this.p2pPlayer.on302(t)}}(this),this.userClose=new class{constructor(t){this.p2pPlayer=t,this.onBeforeUnloadBind=this.onBeforeUnload.bind(this),window.addEventListener("beforeunload",this.onBeforeUnloadBind)}destroy(){window.removeEventListener("beforeunload",this.onBeforeUnloadBind),this.p2pPlayer=null}onBeforeUnload(t){this.p2pPlayer.stop(1)}}(this),this.firstRecvFullStreamFrameTs=0,this.lastRecvFullStreamFrameTs=0,this.fullStreamLoading=!1,this.startFullStreamTs=0,this.stopFullStreamTs=0,this.isH265=!1,this.turnToFlvParams=null,this.lastSliceTs=0,this.exceptionStat=e.exceptionStat,this.playerType=w.P2P,this.askAITimeout=null,this.mse=e.mse,this.anticode=e.anticode,this.p2pDomain="",this.p2p302Domain="",this.isFastOver=!1}getCdnip(){return this.p2pMgr.stream?this.p2pMgr.stream.stat.core.cdnip:this.streamDomain.cdnip}addHandler(){this.sliceProtoHandler.on(tt.ProtoUri.PP2pSliceData,this.onFastSliceData,this)}delHandler(){this.sliceProtoHandler.off(tt.ProtoUri.PP2pSliceData,this.onFastSliceData,this)}addTimer(){X.add(this.onCheckTimer,this,1e3),X.add(this.onCheckFastTimer,this,this.fastTimerInterval)}delTimer(){X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this)}delTimerOnce(){Vs.remove(this.playTimeout,this),Vs.remove(this.onFastTimeOver,this),Vs.remove(this.onP2PPlayTimeout,this),Vs.remove(this.reportP2PSwitchFlvReport,this)}resetProperty(){this.loadStream=!1,this.started=!1,this.startTs=0,this.loadTime=0,this.pauseStartTs=0,this.hasEmptyFrames=!1,this.videoStatus=p.VIDEO_STOP,this.firstSlicePrinted=!1,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseCheckLock=!1,this.loaderErrorTimes=0}stop(){if(n.a.log("P2PPlayer(".concat(this._id,").stop")),this.turnToFlvParams=null,this.started){const t=_.a.now();this._sendHeartbeat(t,!0),this._checkMobPaused(t,Ks),this.stopPlayer(),this.resetProperty()}this.isEverSuccessPlayed=!1;let t=this.G;t.firstP2POnDataTime=0,t.firstP2PIframeTime=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.isRenderFpsPause=!1,this.pauseMobCnt=0,this.p2pDomain="",this.p2p302Domain="",super.stop(),this.isFastOver=!1}destroy(){this.delHandler(),this.delTimer(),this.delTimerOnce(),this.disposePlayer(),this.wakeChecker&&this.wakeChecker.destroy(),this.wakeChecker=null,this.userClose&&this.userClose.destroy(),this.userClose=null,this.p2pMgr&&this.p2pMgr.destroy(),this.p2pMgr=null,this.loaderMgr&&this.loaderMgr.destroy(),this.loaderMgr=null,this.askAITimeout=null,super.destroy()}disposePlayer(){this.player&&(this.player.dispose(),this.player=null)}resetRestart(){this.loaderMgr&&this.loaderMgr.reset&&this.loaderMgr.reset(),this.disposePlayer(),this.loadStream=!1,this.startTs=0,this.loadTime=0,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseStartTs=0,this.firstRecvFullStreamFrameTs=0,this.lastRecvFullStreamFrameTs=0,this.startFullStreamTs=0,this.stopFullStreamTs=0,this.fullStreamLoading=!1,this.pauseCheckLock=!1,this.hasEmptyFrames=!1,this.firstSlicePrinted=!1,this.videoStatus=p.VIDEO_STOP,this.loaderErrorTimes=0,this.qaStat.isFirstReport=!0}removeTimer(){X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),Vs.remove(this.playTimeout,this),Vs.remove(this.onFastTimeOver,this)}resetGlobal(){let t=this.G;t.streamSeqSN=0,t.quickAccessBeginIndex=0,t.quickAccessEndIndex=0,t.quickTime=0,t.exip=0,t.sslUrl="",t.myIp="",t.wanIp="",t.wanPort=0,t.cdnpConnected=0}reset(t){n.a.group("P2PPlayer(".concat(this._id,").reset")),this.resetRestart(),this.wakeChecker.reset(),this.removeTimer(),this.resetGlobal(),this.p2pMgr.stop(t),this.p2pStat.reset(),n.a.groupEnd()}get streamName(){return this.info?this.info.sStreamName:""}get hasPicture(){let t=this.p2pFlvPlayer.isPlaying;return this.h265Proxy.rendering?t=t&&this.p2pFlvPlayer.isWasmH265Playing:this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&(t=t&&this.p2pFlvPlayer.webcodecsPlaying),t}get bufferLen(){return this.player?this.player.getBufferLen():0}get frameBufferLen(){return this.mse&&this.mse.getFrameBufferLen?this.mse.getFrameBufferLen():0}get ctsMax(){var t;return(null===(t=this.mse)||void 0===t?void 0:t.getCtsMax())||300}getDtsByLostSeq(t){var e;return null===(e=this.player)||void 0===e?void 0:e.getDtsByLostSeq(t)}printNextFrameInfo(){var t;null===(t=this.player)||void 0===t||t.printNextFrameInfo()}start(t){super.start(t),f.a._sP2PUrl&&(t.sP2pUrl=f.a._sP2PUrl),this.isH265=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,t.isH265=this.isH265,this.stat.filter.addStreamUrl(t.presenterUid,t.lineType),this.stat.setComDim(d.a.DIM_COM.P2P,d.a.LIVE_TYPE.P2P),this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,2);let e=JSON.stringify(t).replace(/\,/g,"\n").replace(/[\"\{\}]/g,"");if(!(t.sP2pUrl&&t.sStreamName&&t.sFlvUrl&&t.sFlvAntiCode&&void 0!==t.curBitrate&&void 0!==t.lineType))return n.a.warn("P2PPlayer(".concat(this._id,").start P2P参数不完整，跳转至FLV！\n")+e),void this.turnToFlv(N.a.turnToFlvReason.P2P_ARGS_ERROR,!0,!0);this.started=!0,this.mse.appendFlv(this.flvHeader),this.info=t,n.a.log("P2PPlayer(".concat(this._id,").start \n")+e),this.validAntiCode(t.sFlvAntiCode)?this.realStart(t):class{constructor(t){this.streamName=t,this.lastTokenTime=0,this.antiCode="",this.getTokenInterval=24e4,this.onGetTokenCb=null}start(){this.lastTokenTime=_.a.now(),X.add(this.onCheckTimer,this,1e4)}stop(){X.remove(this.onCheckTimer,this)}onCheckTimer(t,e){this.lastTokenTime>0&&t-this.lastTokenTime>=this.getTokenInterval&&this.getToken(t)}getToken(t){this.lastTokenTime=t;let e=new tt.HUYA.GetCdnTokenExReq;e.sStreamName=this.streamName,r.sendWup("liveui","getCdnTokenInfoEx",e,this.onGetToken.bind(this),!0,r.getRequestId())}onGetToken(t){this.antiCode=t.sFlvToken,this.onGetTokenCb&&this.onGetTokenCb();let e="GetCdnToken.onGetToken",i=t.sFlvToken.match(/wsTime=(.+?)($|\&)/);if(i){let t=1e3*parseInt(i[1],16),s=_.a.getDateTimeStr(t,!1);e+="\n【wsTime】"+i[1]+" => "+s}e+="\n"+t.sFlvToken,e+="\nstreamName"+this.streamName,n.a.log(e)}static getToken(t,e){return new Promise((e,i)=>{let s=r.getRequestId(),a=null;a=new tt.HUYA.GetCdnTokenExReq,a.sStreamName=t,r.sendWup("liveui","getCdnTokenInfoEx",a,r=>r.iRequestId===s?e(r):i(new Error("GetCdnToken.getToken"+t)),!0,s)})}}.getToken(t.sStreamName,t.nimoTid).then(e=>{let i="";i=e.sFlvToken,n.a.log("P2PPlayer(".concat(this._id,").start getToken sAntiCode=").concat(i,", rsp="),e),t.sFlvAntiCode=i,this.realStart(t)});let i=Math.floor(2e3*Math.random()+1e3);0!==Number(o.a.isAiP2PToFlv)&&(clearTimeout(this.askAITimeout),this._hyPlayer.sdkTurnToP2P||(this.askAITimeout=setTimeout(()=>{this.notSdkPlay()},i)),this._hyPlayer.sdkTurnToP2P=!1)}notSdkPlay(){this._hyPlayer.isBusiStop||0!==Number(o.a.isAiP2PToFlv)&&(this.getRecSysRsp({info:this.info,type:"p2p",metadata:this.mse?this.mse.metadata:null,reason:N.a.turnToFlvReason.IS_NOT_FIRST_FETCH,isNotFirstFetch:!0}),this.aiP2PFlvStatus=1,Vs.once(this.reportP2PSwitchFlvReport,this,2e3))}checkPcdnMode(t,e){super.checkPcdnMode(t,e),this.p2pMgr.checkUsePcdn()}_getUsePcdn(t,e){let i="";e&&(i=e[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream]);let s=1===Number(t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream])?1:0;return-1!=o.a.closePcdnOrigins.indexOf(i)&&(s=0,n.a.log("P2PPlayer._getUsePcdn not support pcdn_origin!")),s}_getPcdnName(t){let e="";return t&&(e=t[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream]),e}realStart(t){if(!this.started)return;this.businessStartCost=0,this.UIStartCost=0,this.startTimeStamp=Number(t.startTimeStamp)||0,t.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=Math.floor(t.startTimeStamp>1?(new Date).getTime()-t.startTimeStamp:0),this.noNeedSendVideoLoadTime=!1),t.uistartTs&&t.uistartTs>0&&(this.UIStartCost=Math.floor((new Date).getTime()-t.uistartTs));let e=this.isUseAV1(t);this.isAv1=e,this.startTs=_.a.now(),n.a.log("P2PPlayer(".concat(this._id,").startNow"),Date.now(),this.startTs),this.stat.setComDim(d.a.DIM_COM.ORIGINAL_BITRATE,0===t.originalBitrate?1:0),this.stat.setComDim(d.a.DIM_COM.H265,this.isH265?1:0),this.stat.setComDim(d.a.DIM_COM.V_DECODEC,e?2:this.isH265?1:0),this.eventEmitter&&this.eventEmitter.roomRecordStat&&this.eventEmitter.roomRecordStat.startStream(t.presenterUid,t.lineType,t.curBitrate,this.isH265?"h265":"h264","p2p"),t.isAv1=e,o.a.initOpens(t.presenterUid,t.lineType,t.uid),this.stat.setComDim(d.a.DIM_COM.MPS_CROSS,1===o.a.mpsCross?1:2);let i=this.G;i.isStartFromUrl=!1,Object.assign(i,t),this.isH265&&this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.H265_STATUS,{value:[0],str:[0]})]),this.startPlayer(t,e),this.quickAccessVideoOnly(!0)}startPlayer(t,e){n.a.log("P2PPlayer(".concat(this._id,").startPlayer")),this.updateStatus(p.VIDEO_STOP),this.isReportNoPicture=!0,this.lastSliceTs=0,this.p2pDomain="",this.p2p302Domain="",this.info=t,this.started=!0;let i=this.G;i.lineType=t.lineType,i.streamId=this.createStreamId(Number(t.iIsP2PSupport),this.isH265,e),this.streamDomain.initDomain(t.sP2pUrl,t.p2pDomainList?t.p2pDomainList.slice():[]),this.statDomain(),this.loaderMgr.init(this.streamDomain.sP2pUrl,t.sFlvAntiCode,this.isH265),this.player=this.createPlayer(),this.player.needFreeBuffer=t.curBitrate<=o.a.freeBufferBitrate,this.checkAud(),this.addHandler(),this.addTimer(),Vs.once(this.playTimeout,this,4e3),Vs.once(this.onP2PPlayTimeout,this,5500),this.statSwitch.check(t,!1),delete t.pullStreamFrom,this.wakeChecker.startWakeTimeoutChecker(),o.a.setJitterCfg(this.mse,t.presenterUid,t.curBitrate);let s=t.sP2pUrl.match(/\/\/(.+?)\//i);s.length>=2&&(this.p2pDomain=s[1].split(":")[0],n.a.log("P2PPlayer.startPlayer.p2pDomain",this.p2pDomain)),super.startPlayer()}stopPlayer(){this.delHandler(),this.delTimer(),this.delTimerOnce(),this.loaderMgr.stop(),this.p2pMgr.stop(),this.disposePlayer(),this.started=!1,clearTimeout(this.askAITimeout)}createPlayer(){return new class{constructor(t){this.p2pPlayer=t,this.sliceSpeed=(t.info.curBitrate||500)/1e3*125,this.firstDts=0,this.firstTsStatus=-1,this.fastOver=!1,this.startDts=0,this.startTs=0,this.startSeq=0,this.pushFrames=0,this.lastResendSeq=0,this.lastPlayVideoSeq=0,this.lastPushFrameTimerTs=0,this.frameMaxSeqs=[],this.playSeq=0,this.playedTime=0,this.playtimeDiff=100,this.dtsChecker=new he,this.videoRecver=new Sr(this),this.audioRecver=new Er(this),this.downFrameRate=new Qt,this.msePlayer=t.mse,this.createMse(),this.metadataTick=new rt(t.eventEmitter,this.msePlayer),this.pushVideoFrameBind=this.pushVideoFrame.bind(this),this.pushAudioFrameBind=this.pushAudioFrame.bind(this),this.hasSeqBind=this.hasSeq.bind(this),this.processer=new class{constructor(t){this.videoPlayer=t,this.videoRecver=t.videoRecver,this.audioRecver=t.audioRecver,this.urgentBuffer=o.a.urgentBuffer,this.waitDropVideoFrameId=0,this.waitDropVideoFrameTs=0,this.resendAudioTime=300,this.resendAudioBufTime=1500,this._initConfig()}_initConfig(){let t=this.videoPlayer.p2pPlayer.info;this.resendAudioTime=Number(R.b.getCfgValue(o.a.resendAudioCfg,t.presenterUid,t.linetype,500)),this.resendAudioBufTime=Number(R.b.getCfgValue(o.a.resendAudioBufCfg,t.presenterUid,t.linetype,1500)),n.a.log("RecvProcesser._initConfig resendAudioTime=".concat(this.resendAudioTime,", resendAudioBufTime=").concat(this.resendAudioBufTime))}onTimer(t){let e=this.videoPlayer.msePlayer.getRealFps();0===e&&(e=30);let i=this.videoRecver.getBuffers(e);this.rangeAudio(i,e);let s=this.videoPlayer.dtsChecker.isSync();this.checkAudio(t,s,i),this.checkVideo(t,s)}rangeAudio(t,e){let{continueBuffer:i}=t;if(i>=this.resendAudioTime&&this.videoPlayer.getBufferLen()<=this.resendAudioBufTime){let t=this.videoRecver.getFullSeqMax();this.videoPlayer.p2pPlayer.p2pMgr.resendAudio(t)}}checkVideo(t,e){let i=this.videoPlayer.msePlayer.getRealFps()||30;for(this.videoRecver.checkNextIframe(),this.videoPlayer.p2pPlayer.p2pMgr.getLastContinueSeq();;){let s=this.videoPlayer.getBufferLen();if(!this.videoRecver.hasFrame())break;let{recvBuffer:r,continueBuffer:a,fpsBuffer:o}=this.videoRecver.getBuffers(i);if(e){if(this.audioRecver.hasFrame()&&this.videoRecver.lastPlayDts>=this.audioRecver.lastPlayDts)break;if(this.audioRecver.lastPlayDts>0&&!this.audioRecver.hasFrame()&&this.videoRecver.lastPlayDts>=this.audioRecver.lastPlayDts&&a<2e3)break}let n=this.videoRecver.peekFrame();if(n.isFull){if(this.videoRecver.isFrameIdContinued(n)){this.pushVideoFrame(n,t);continue}if(this.checkVideoDrop(t,n,s,r,a,o,i))continue}else if(this.checkVideoDrop(t,n,s,r,a,o,i))continue;break}}pushVideoFrame(t,e){this.waitDropVideoFrameTs=0,this.waitDropVideoFrameId=0,this.videoRecver.playFrame(t,e),this.videoPlayer.pushVideoFrame(t)}checkVideoDrop(t,e,i,s,r,a,o){if(i<=this.urgentBuffer&&a>this.videoPlayer.msePlayer.JITTER_BUFLEN)if(0===this.waitDropVideoFrameId)this.waitDropVideoFrameId=e.key,this.waitDropVideoFrameTs=t;else{let e=this.videoRecver.getFramesDisNextIFrame();if(-1!==e){let a=1e3*e/o;if(t-this.waitDropVideoFrameTs>a)return this.waitDropVideoFrameTs=0,this.waitDropVideoFrameId=0,n.a.log("RecvProcesser.checkVideoDrop urgrent videoBuffer=".concat(i," recvBuffer=").concat(s," continueBuffer=").concat(r," lastFrameId=").concat(this.videoRecver.lastPlayFrameId," lastPushDts=").concat(this.videoRecver.lastPlayDts)),this.videoPlayer.p2pPlayer.p2pMgr.printRangeInfo(),this.videoRecver.startDropFrames(t),!0}}return!1}checkAudio(t,e,i){let s=this.videoPlayer.msePlayer.getRealFpsAudio(),r=this.videoRecver.getFullSeqMax(),a=this.videoPlayer.getBufferLen(),o=this.videoPlayer.p2pPlayer.p2pMgr.getLastContinueSeq(),h=this.videoPlayer.msePlayer.JITTER_BUFLEN/2;for(;this.audioRecver.hasFrame();){let d=this.audioRecver.peekFrame();if(d.isFull){if(this.audioRecver.isFrameIdContinued(d)||0===s){this.pushAudioFrame(d,t);continue}if(d.lastPktSeq<o-100){n.a.log("RecvProcesser.checkAudio lastContinuedSeq=".concat(o," dts=").concat(d.dts," lastDts=").concat(this.audioRecver.lastPlayDts,"  frame.lastPktSeq=").concat(d.lastPktSeq," frameId=").concat(d.key," lastFrameId=").concat(this.audioRecver.lastPlayFrameId)),this.pushAudioFrame(d,t);continue}if(e&&d.lastPktSeq<r&&a<this.urgentBuffer&&this.audioRecver.lastPlayDts-this.videoRecver.lastPlayDts<this.urgentBuffer&&i.continueBuffer>h){n.a.log("RecvProcesser.checkAudio videoBuffer=".concat(a," videoFullSeqMax=").concat(r," vLastFrameId=").concat(this.videoRecver.lastPlayFrameId," vLastSeq=").concat(this.videoRecver.lastPlaySeq," lastContinuedSeq=").concat(o," dts=").concat(d.dts," lastDts=").concat(this.audioRecver.lastPlayDts," frame.lastPktSeq=").concat(d.lastPktSeq," frameId=").concat(d.key," lastFrameId=").concat(this.audioRecver.lastPlayFrameId,"  ").concat(JSON.stringify(i)," vLastPushDts=").concat(this.videoRecver.lastPlayDts)),this.pushAudioFrame(d,t),this.videoPlayer.p2pPlayer.p2pMgr.printRangeInfo();continue}if(!e&&d.lastPktSeq<r&&a<this.urgentBuffer){n.a.log("RecvProcesser.checkAudio not sync videoBuffer=".concat(a," videoFullSeqMax=").concat(r," vLastFrameId=").concat(this.videoRecver.lastPlayFrameId," vLastSeq=").concat(this.videoRecver.lastPlaySeq," lastContinuedSeq=").concat(o," dts=").concat(d.dts," lastDts=").concat(this.audioRecver.lastPlayDts," frame.lastPktSeq=").concat(d.lastPktSeq," frameId=").concat(d.key," lastFrameId=").concat(this.audioRecver.lastPlayFrameId,"  ").concat(JSON.stringify(i)," vLastPushDts=").concat(this.videoRecver.lastPlayDts)),this.pushAudioFrame(d,t);continue}{let{recvBuffer:t,continueBuffer:e,fpsBuffer:r}=this.audioRecver.getBuffers(s);if(0===s||a<=this.urgentBuffer){a<=this.urgentBuffer&&n.a.log("RecvProcesser.checkAudio urgrent videoBuffer=".concat(a," recvBuffer=").concat(t," continueBuffer=").concat(e," fpsBuffer=").concat(r," lastFrameId=").concat(this.audioRecver.lastPlayFrameId," curFrameId=").concat(d.key," seq=").concat(d.lastPktSeq," lastContinuedSeq=").concat(o," lastPushDts=").concat(this.audioRecver.lastPlayDts," curPushDts=").concat(d.dts," videoSeqMax=").concat(this.videoRecver.getFullSeqMax()," ").concat(JSON.stringify(i)," vLastPushDts=").concat(this.videoRecver.lastPlayDts)),this.videoPlayer.p2pPlayer.p2pMgr.printRangeInfo();break}}}else if(this.checkAudioDrop(t,a,s))continue;break}}pushAudioFrame(t,e){this.audioRecver.playFrame(t,e),this.videoPlayer.pushAudioFrame(t)}checkAudioDrop(t,e,i){let{recvBuffer:s,continueBuffer:r,fpsBuffer:a}=this.audioRecver.getBuffers(i);return(e<=this.urgentBuffer&&a>2e3||a>6e3)&&(n.a.log("RecvProcesser.checkAudioDrop urgrent videoBuffer=".concat(e," recvBuffer=").concat(s," continueBuffer=").concat(r," fpsBuffer=").concat(a," lastFrameId=").concat(this.audioRecver.lastPlayFrameId," lastPushDts=").concat(this.audioRecver.lastPlayDts)),this.audioRecver.startDropFrames(t),!0)}}(this)}dispose(){n.a.log("VideoPlayer.dispose"),this.startDts=0,this.startTs=0,this.lastResendSeq=0,this.lastPushFrameTimerTs=0,this.videoRecver.reset(),this.audioRecver.reset(),X.remove(this.onPushFrameTimer,this)}createMse(){this.videoRecver.reset(),this.audioRecver.reset()}resetMse(){this.startDts=0,this.startTs=0,this.lastResendSeq=0,this.audioRecver.aacConfig=null,this.videoRecver.avcConfig=null,this.lastPushFrameTimerTs=0,X.remove(this.onPushFrameTimer,this),this.metadataTick.reset(),this.metadataTick.mse=this.msePlayer}onVideoStreamData(t){this.lastRecvSeq=t.seq,2===this.videoRecver.recvData(t)&&(this.downFrameRate.addFrame(),this._onFrameData())}onAudioStreamData(t){this.lastRecvSeq=t.seq,2===this.audioRecver.recvData(t)&&this._onFrameData()}onAudioStreamDataV2(t){this.lastRecvSeq=t.seq,2===this.audioRecver.recvDataV2(t)&&this._onFrameData()}_onFrameData(){if(this.fastOver)this.onPushFrameTimer(_.a.now());else{this.pushFastFrame();let t=this.getBufferLen();o.a.useFastTime&&t>=this.msePlayer.JITTER_BUFLEN&&this.p2pPlayer.onFastTimeOver("buffer enough")}}onPushFrameTimer(t,e){0===this.lastPushFrameTimerTs?this.lastPushFrameTimerTs=t:t-this.lastPushFrameTimerTs>=50&&(this.lastPushFrameTimerTs=t,this._onPushFrameTimer(t))}_onPushFrameTimer(t){1==o.a.recvProcesser?(this.processer.onTimer(t),this.msePlayer.buffered._calc(t,Gs),this.p2pPlayer.p2pMgr.setLastPushedFrame(this.videoRecver.lastPlayDts,this.videoRecver.lastPlayFrameId,this.getBufferLen())):(this.videoRecver.checkNextIframe(),this.pushFrame(this.startDts+(t-this.startTs),t),this.msePlayer.buffered._calc(t,Gs),this.p2pPlayer.p2pMgr.setLastPushedFrame(this.videoRecver.lastPlayDts,this.videoRecver.lastPlayFrameId,this.getBufferLen()),this.checkRangeSeqs(t))}onUpdateLastPlayedFrameId(t,e){this.setLastPlayVideoSeq(e)}hasSeq(t){return this.p2pPlayer.p2pMgr.hasSeq(t)}setLastPlayVideoSeq(t){this.lastPlayVideoSeq=t,this.p2pPlayer.p2pMgr.setLastPlaySeq(t)}checkRangeSeqs(t){let e=this.startDts+(t-this.startTs),i=e-this.videoRecver.lastPlayDts;if(i>6e3&&this.getBufferLen()<600&&this.videoRecver.checkDropFrames(t),this.audioRecver.checkDropFrames(),this.msePlayer.getBufferLen()<2e3&&this.p2pPlayer.p2pMgr.hasPub()&&this.videoRecver.needUrgendResend(t)&&2!=o.a.resendMode){let t=new Set;if(this.videoRecver.getNeedRangeSeqs(e,t,this.hasSeqBind),this.audioRecver.getNeedRangeSeqs(e,t,this.hasSeqBind),t.size<640){let e=Math.max(this.lastResendSeq,this.videoRecver.lastPlaySeq),s=this.videoRecver.lastPlaySeq+Math.ceil(this.sliceSpeed*i/1e3*.6);for(let i=e;i<s&&(i>this.lastResendSeq&&(this.hasSeq(i)||t.add(i),this.lastResendSeq=i),!(t.size>=640));i++);}let s=Array.from(t);s.length>0&&(1===Number(f.a._printRange)&&n.a.log("VideoPlayer.checkRangeSeqs time=".concat(i," bufferLen=").concat(this.msePlayer.getBufferLen()," seqCnt=").concat(s.length," firstSeq=").concat(s[0]," endSeq=").concat(s[s.length-1]," size=").concat(this.videoRecver.chain.size," lastRecvSeq=").concat(this.lastRecvSeq," lastPlayDts=").concat(this.videoRecver.lastPlayDts," lastPlayFrameId=").concat(this.videoRecver.lastPlayFrameId)),this.p2pPlayer.p2pMgr.urgentResend(s))}}pausedTooLong(){}pushFastFrame(){this.fastOver||0===this.firstTsStatus&&!this.audioRecver.isCanPlay||2===this.firstTsStatus&&!this.videoRecver.isCanPlay||(1==o.a.recvProcesser?this.processer.onTimer(_.a.now()):this.pushFrame(this.firstDts+36e5,_.a.now()))}pushFrame(t,e){for(;;)if(this.audioRecver.hasNextFrame(e)&&this.audioRecver.lastPlayDts<this.videoRecver.lastPlayDts){if(!this.checkPushFrame(e,this.audioRecver,this.pushAudioFrameBind))break}else if(!this.checkPushFrame(e,this.videoRecver,this.pushVideoFrameBind))break}getDtsGap(){return this.videoRecver.lastPlayDts-this.audioRecver.lastPlayDts}isDownEnough(){return this.downFrameRate.isDownEnough(this.msePlayer.getRealFps())}getReasons(t){let e=this.getReason(this.audioRecver),i=this.getReason(this.videoRecver);return 2===i&&this.audioRecver.hasNextFrame(t)&&this.audioRecver.lastPlayDts<this.videoRecver.lastPlayDts&&this.msePlayer.getBufferLen()>1e3&&(i=4),2===e&&this.audioRecver.lastPlayDts>this.videoRecver.lastPlayDts&&(e=3),{audioReason:e,videoReason:i}}getReason(t){let e=t.chain.peek();return e&&t.lastPlayFrameId>0?e.isFull?e.key-t.lastPlayFrameId>1?1:2:3:0}checkPushFrame(t,e,i){let s=e.getFrame(t);return!!s&&(i(s,t),!0)}pushVideoFrame(t,e){if(t){if(this.addFullFrame(t),t.isKeyFrame){let e=ur.getAvc(t);if(!this.videoRecver.avcConfig||this.videoRecver.avcConfig.toString()!==e.toString()){let i=e.length+4+11,s=31&t.streamData[i];this.videoRecver.avcConfig=e;let r=ur.packAvcFlvTag(t.dts,e,s);this.msePlayer&&this.msePlayer.appendFlv(r)}ur.trimIFrame(t,e.length)}this.videoRecver.avcConfig&&(this.pushFrames++,this.msePlayer&&(this.msePlayer.ctrlBuffer.setCurFrameId(t.key),this.msePlayer.appendFlvTag(t.streamData,t.key)),t.streamData=null,this.onUpdateLastPlayedFrameId(t.id,t.lastPktSeq-1)),t.played=!0}}addFullFrame(t){this.frameMaxSeqs.push({ts:t.dts,seq:t.getMaxSeq()})}getPlayingSeq(){let t=this.getCurrentRealTime()+this.playtimeDiff;for(let e=0;e<this.frameMaxSeqs.length&&!(t-this.playedTime<this.playtimeDiff);e++)if(t<this.frameMaxSeqs[e].ts)return this.playSeq=this.frameMaxSeqs[e].seq,this.frameMaxSeqs.splice(0,e),this.playedTime=t,this.playSeq;return this.playSeq}pushAudioFrame(t,e){t&&(this.dtsChecker.isSync()&&t.dts<this.firstDts-this.audioRecver.audioFrameTimeLen||(t.aacConfig&&(n.a.log("VideoPlayer.playAudio aacConfig change"),this.msePlayer&&this.msePlayer.appendFlv(t.aacConfig),t.aacConfig=null),this.msePlayer.appendFlvTag(t.streamData,t.key),t.streamData=null))}getLastData(){return{firstDts:this.firstDts,firstTsStatus:this.firstTsStatus,videoData:this.videoRecver.getLastData(),audioData:this.audioRecver.getLastData()}}setLastData(t){this.firstDts=t.firstDts,this.firstTsStatus=t.firstTsStatus,this.videoRecver.setLastData(t.videoData),this.audioRecver.setLastData(t.audioData)}initAacConfig(t){this.msePlayer&&this.msePlayer.appendFlv(t)}setFirstDTs(t,e){let i=this.firstTsStatus;i>=t||(n.a.log("VideoPlayer.setFirstTs status="+i+"->"+t+" firstTs="+e+" jitBufLen="+o.a.jitBufLen),this.firstDts=e,this.firstTsStatus=t,0===i&&2===t&&(n.a.info("VideoPlayer.setFirstDTs resetMse"),this.resetMse()),2===t?(this.videoRecver.trimBeforeDts(this.firstDts),this.audioRecver.trimBeforeDts(this.firstDts),this.msePlayer&&this.audioRecver.aacConfig&&this.msePlayer.appendFlv(this.audioRecver.aacConfig)):0===t&&this.audioRecver.trimBeforeDts(this.firstDts))}isFirstAudio(){return this.firstTsStatus<=0}onCheckFastTimer(t,e){this.msePlayer&&e%10==0&&this.msePlayer.onCheckFastTimer(t,e)}onCheckTimer(t,e){this.msePlayer&&this.msePlayer.onCheckTimer(t,e),this.metadataTick.onCheckTimer(t,e)}setFastOver(){n.a.log("VideoPlayer.setFastOver firstDts",this.firstDts,"videoDts",this.videoRecver.firstFrameDts,this.videoRecver.lastPlayDts,"autioDts",this.audioRecver.firstFrameDts,this.audioRecver.lastPlayDts),this.fastOver=!0,0===this.videoRecver.lastPlayFrameId||0===this.audioRecver.lastPlayFrameId?n.a.warn("VideoPlayer.setFastOver video||audio lastPlayFrameId=0"):(this.startDts=this.videoRecver.lastPlayDts,this.startTs=_.a.now(),this.startSeq=this.videoRecver.lastPlaySeq,X.add(this.onPushFrameTimer,this,20))}getCurrentTime(){return this.msePlayer?this.msePlayer.getCurrentTime():0}getCurrentDts(){return this.msePlayer?this.msePlayer.getCurrentDts():0}getCurrentSeiOffsetDts(){return this.msePlayer?this.msePlayer.getCurrentSeiOffsetDts():0}getCurrentRealTime(){return this.msePlayer.getCurrentRealTime()}getBufferLen(){return this.msePlayer&&this.msePlayer.getBufferLen?this.msePlayer.getBufferLen():0}getSegmentsBufferLen(){return this.msePlayer&&this.msePlayer.getSegmentsBufferLen?this.msePlayer.getSegmentsBufferLen():0}getFrameBufferLen(){return this.msePlayer?this.msePlayer.getFrameBufferLen():0}getWaitBufferLen(){let t=this.videoRecver.getWaitFrames();return t>0&&this.msePlayer.metadata&&this.msePlayer.metadata.fps>0?t/this.msePlayer.metadata.fps*1e3:0}getWaitFrameTime(t){return this.videoRecver.getWaitFrameTime(t)}setQuickVideoLen(t){}setPlaybackrateAccess(t){this.msePlayer&&this.msePlayer.setPlaybackrateAccess(t)}getStat(){let t={recvSeqCnt:this.videoRecver.recvSeqCnt,fullSeqCnt:this.videoRecver.fullSeqCnt,lateSeqCnt:this.videoRecver.lateSeqCnt,lateFrames:this.videoRecver.lateFrames.size,pushFrames:this.pushFrames,parseVideoTagCnt:this.msePlayer.parser.parseVideoTagCnt,parseVideoSucCnt:this.msePlayer.parser.parseVideoSucCnt,remuxVideoCnt:this.msePlayer.remuxVideoCnt,dropFrames:this.videoRecver.dropFrames,playedFrames:this.videoRecver.playedFrames,dtsJumpPauseTimes:this.videoRecver.dtsJumpPauseTimes,skipFramePauseTimes:this.videoRecver.skipFramePauseTimes,forceSkipFrameNums:this.videoRecver.forceSkipFrameNums,playDelayAvg:0,hasFrames:this.videoRecver.chain.size,emptyFrames:this.msePlayer.parser.emptyFrames||0};return this.videoRecver.resetSeqCnt(),this.pushFrames=0,this.msePlayer.parser.parseVideoTagCnt=0,this.msePlayer.parser.parseVideoSucCnt=0,this.msePlayer.remuxVideoCnt=0,this.videoRecver.dropFrames=0,this.videoRecver.playedFrames=0,this.videoRecver.dtsJumpPauseTimes=0,this.videoRecver.skipFramePauseTimes=0,this.videoRecver.forceSkipFrameNums=0,this.msePlayer.parser.emptyFrames=0,t}printAVInfos(){this.videoRecver.printChainInfos(),this.audioRecver.printChainInfos()}switchStart(){n.a.log("VideoPlayer.switchStart lastPlayFrameId(video=".concat(this.videoRecver.lastPlayFrameId," audio=").concat(this.audioRecver.lastPlayFrameId,") lastPlayDts=(video=").concat(this.videoRecver.lastPlayDts," audio=").concat(this.audioRecver.lastPlayDts,")")),this.videoRecver.reset(),this.audioRecver.reset()}getJitterBufferLen(){return this.msePlayer&&this.msePlayer.JITTER_BUFLEN?this.msePlayer.JITTER_BUFLEN:0}getDtsByLostSeq(t){return this.videoRecver.getDtsByLostSeq(t)}printNextFrameInfo(){this.audioRecver.printNextFrameInfo(),this.videoRecver.printNextFrameInfo()}}(this)}validAntiCode(t){let e=t.split("&"),i=e.length;for(let t=0;t<i;t++){let i=e[t].split("="),s=i[0],r=i[1];if("wsTime"===s)return new Date(1e3*parseInt(r,16)).getTime()+24e4>Date.now()}return!1}checkAud(){$.isNeedAud()?this.mse.setDeleteH264Aud(-1===o.a.deleteH264Aud.indexOf(this.G.presenterUid)?0:1):this.mse.setDeleteH264Aud(0)}changeDomain(){let t=this.streamDomain.changeDomain();return this.statDomain(),t}setEnableLowLatency(t){this.enableLowLatency=t,t&&this.mse&&o.a.setLowLatency(this.mse)}statDomain(){""===this.streamDomain.cdnip?this.stat.delDim(d.a.DIM_EXT.CDN_IP):this.stat.setExtDim(d.a.DIM_EXT.CDN_IP,this.streamDomain.cdnip)}recvDataFull(){this.G.recvDataTime=_.a.now(),this.eventEmitter.trigger(u.RECV_VIDEO_FRAME),n.a.log("P2PPlayer(".concat(this._id,").recvDataFull"))}getCurrentTime(){return this.player?this.player.getCurrentRealTime():0}getCurrentDts(){return this.player?this.player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this.player?this.player.getCurrentSeiOffsetDts():0}getFrameData(){return{pts:this.player?this.player.getCurrentRealTime():0}}getBufferLen(){return this.player?this.player.getBufferLen():0}getSegmentsBufferLen(){return this.player?this.player.getSegmentsBufferLen():0}getFrameBufferLen(){return this.player?this.player.getFrameBufferLen():0}getWaitBufferLen(){return this.player?this.player.getWaitBufferLen():0}getWaitFrameTime(t){return this.player?this.player.getWaitFrameTime(t):0}playTimeout(){let t=0,e=0;this.p2pFlvPlayer.isPlaying?(this.p2pStat.printLoadFail(!1),t=100):(this.p2pStat.printLoadFail(!0),this.p2pStat.p2pState=0,e=this.tsdb.httpError?1:2);let i=[];i.push(this.stat.createAct(d.a.ACT.P2P_LOAD_VIDEO,{value:[t,e]})),this.tsdb.sendMetrics(i)}onRenderTimeout(){this.started&&!this.p2pFlvPlayer.isPlaying&&(this.printAVInfos(),n.a.warn("P2PPlayer(".concat(this._id,").onRenderTimeout")),this.loaderErrorTimes++)}onP2PPlayTimeout(t,e){this.p2pFlvPlayer.isPlaying||(this.turnToFlvParams||(this.turnToFlvParams={reason:N.a.turnToFlvReason.PLAY_TIMEOUT,force:!1,isNotAi:!1}),n.a.log("P2PPlayer.onP2PPlayTimeout isPlaying=".concat(this.p2pFlvPlayer.isPlaying,", reason=").concat(this.turnToFlvParams.reason)),this.turnToFlv(this.turnToFlvParams.reason,this.turnToFlvParams.force,this.turnToFlvParams.isNotAi))}beforeTurnToFlv(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this.turnToFlvParams={reason:t,force:e,isNotAi:i}}turnToFlv(t){let e=arguments.length>2?arguments[2]:void 0;n.a.warn("P2PPlayer(".concat(this._id,").turnToFlv reason=").concat(t)),this.getRecSysRsp({info:this.info,type:"p2p",metadata:this.player?this.player.msePlayer.metadata:null,reason:t,isNotAi:e})}recSysRspHandler(t,e,i){if(!this.started)return;let{reason:s}=i;const r=this.p2p302Domain?this.p2p302Domain:this.p2pDomain;if(n.a.warn("P2PPlayer(".concat(this._id,").recSysRspHandler reason=").concat(s)),!t||e&&e.tRecSysInfo&&1==e.tRecSysInfo.lAction){if(e&&e.tRecSysInfo){let s=e.tRecSysInfo.sActValue;if(i.isNotFirstFetch&&""!=s)try{let t=JSON.parse(R.b.unescapeHTML(s)).sAiPidsP2PDes.split("|"),e=t[t.length-1];if(n.a.log("P2PPlayer(".concat(this._id,").recSysRspHandler isTurnToFlv"),e),0==e)return void(this.aiP2PFlvStatus=3);this.aiP2PFlvStatus=2}catch(t){n.a.warn("P2PPlayer(".concat(this._id,").recSysRspHandler isNotFirstFetch"),t)}}n.a.warn("P2PPlayer(".concat(this._id,").recSysRspHandler.turnToFlv reason=").concat(s)),this.tsdb.turnToFlvReason=s,this.tsdb.turnToFlvTimes++,-1===[N.a.turnToFlvReason.IS_NOT_FIRST_FETCH,N.a.turnToFlvReason.VIDEO_BUFFER_EMPTY,N.a.turnToFlvReason.NOT_SUPPORT_P2P,N.a.turnToFlvReason.P2P_ARGS_ERROR,N.a.turnToFlvReason.NO_DATA_TIMEOUT].indexOf(s)&&this.isReportNoPicture&&this.videoStatus!=p.VIDEO_PLAYING&&(this.sendNoPicture(s),this.isReportNoPicture=!1),this.eventEmitter.trigger(u.P2P_TIMEOUT,{reason:s,domain:r,pcdnIaas:this.pcdnIaas}),this.stop()}else{if(i&&i.isNotFirstFetch)return;n.a.warn("P2PPlayer(".concat(this._id,").recSysRspHandler fail reason=").concat(s)),this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN)}}reportP2PSwitchFlvReport(){let t=1;2===this.aiP2PFlvStatus?t=1:3===this.aiP2PFlvStatus?t=2:1===this.aiP2PFlvStatus&&(t=3),this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.AI_P2P_FLV_SWITCH,{value:[t],str:[1]})])}setPcdnName(t,e){null!=t&&this.stat.setComDim(d.a.DIM_COM.PCDN_ORIGIN,t)}quickAccessVideoOnly(t,e,i){let s=this.G,r=_.a.now();s.initUseTime(r),this.fullStreamLoading=!0,this.firstRecvFullStreamFrameTs=0,this.lastRecvFullStreamFrameTs=0,this.lastSliceTs=r,s.quickTime=o.a.p2pQuicktime,s.quickAccessBeginIndex=s.exip=0,t&&this.startFastSample(),this.loadFullStream("quickTime",e,i),this._startContinueBuffer(),ut.setCdnDomain(this.stat,this.loaderMgr.url,this.info.sStreamName)}startFastTimer(){this.isFastOver||(Vs.once(this.onFastTimeOver,this,Number(o.a.fastTime)),n.a.log("P2PPlayer(".concat(this._id,").startFastTimer fastTime=").concat(o.a.fastTime)))}onFastTimeOver(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"timer";this.isFastOver=!0,n.a.log("P2PPlayer(".concat(this._id,").onFastTimeOver reason=").concat(t," buffer=").concat(this.getBufferLen())),Vs.remove(this.onFastTimeOver,this),this.player&&this.player.setFastOver&&this.player.setFastOver(),this.p2pMgr.start()}updateP2PConfig(){this.enableLowLatency?o.a.setLowLatency(this.mse):o.a.setJitterCfg(this.mse,this.info.presenterUid,this.info.curBitrate),this.p2pMgr.updateConfig(),this.p2pMgr.checkStart()}onPausedTooLong(){this.player&&this.player.pausedTooLong&&this.player.pausedTooLong()}onStartP2P(){if(n.a.log("P2PPlayer(".concat(this._id,").onStartP2P buffer=").concat(this.getBufferLen())),this.fastSample.setOver(),this.loaderMgr.stopFullStream(),this.fullStreamLoading=!1,this.stopFullStreamTs=_.a.now(),this.startFullStreamTs&&this.firstRecvFullStreamFrameTs>0){let t=this.lastRecvFullStreamFrameTs-this.firstRecvFullStreamFrameTs-(this.stopFullStreamTs-this.startFullStreamTs);this.player&&this.player.setQuickVideoLen(t)}}startP2PUrl(t){this.info=t;let e=t.p2purl;n.a.log("P2PPlayer(".concat(this._id,").startP2PUrl ")+e),this.reset(0),this.addHandler(),this.addTimer(),this.info={};let i=this.G;i.isStartFromUrl=!0,this.url=e,this.started=!0,this.startTs=_.a.now(),i.initUseTime(this.startTs),i.getVPTime=this.startTs,i.connectVpTime=this.startTs,i.connectVideoTime=this.startTs,i.loginTime=this.startTs,this.player=this.createPlayer(),this.loaderMgr.fullLoader.connect(e)}onRestart(t){n.a.log("%cP2PPlayer(".concat(this._id,").onRestart"),"background:#FFBFFF",t),this.checkSendRestart(t);let e=this.G;if(t===N.a.restartReason.FLV_TO_P2P||e.isStartFromUrl)e.isStartFromUrl?this.startP2PUrl(this.url):this.start(this.info);else{if(this.restartTimes>=5)return void this.turnToFlv(N.a.turnToFlvReason.RESTART_TIMES);this.restartTimes++,this.fullStreamLoading=!1,this.firstRecvFullStreamFrameTs=0,this.lastRecvFullStreamFrameTs=0,this.startFullStreamTs=0,this.stopFullStreamTs=0,this.loaderMgr.stopFullStream();let t=null;this.player&&(t=this.player.getLastData()),this.disposePlayer(),this.loadStream=!1,this.p2pMgr.onRestart(),this.started=!0,this.player=this.createPlayer(),t&&this.player.setLastData(t),this.quickAccessVideoOnly(!1),this.startFastTimer()}}checkSendRestart(t){if(t){this.tsdb.restartReason=t,this.tsdb.restartTimes++;let e=!0;if(t===N.a.restartReason.LOST_SEQ_JUMP||t===N.a.restartReason.CONNECT){let t=_.a.now();this.restartStamp>0&&t-this.restartStamp<2e4&&(e=!1),this.restartStamp=t}if(e){let e=[];e.push(this.stat.createAct(d.a.ACT.P2P_RESTART,{value:[t]})),this.tsdb.sendMetrics(e)}}}setPlaybackrateAccess(t){this.player&&this.player.setPlaybackrateAccess(t)}setAutoJitter(t){this.mse.autoJitter=t}setJitter(t,e,i){this.mse&&this.mse.setJitter(t,e,i)}play(){this.mse.play()}pause(){this.mse.pause()}_getCodec(t,e){let i=e;return 0===e?3===t?i=0:2===t?i=2:1===t&&(i=4):e%100==0?3===t?i=e>8e3?1e3+(e/100>>0):400+(e/100>>0):2===t?i=e>8e3?4e3+(e/100>>0):500+(e/100>>0):1===t&&(i=9e3+(e/100>>0)):e%10==0&&(3===t?e>0&&(i=2e4+(e/10>>0)):2===t?e>0&&(i=3e4+(e/10>>0)):1===t&&(i=4e4+(e/10>>0))),i}createStreamId(t,e,i){t=t>1?t:0;let s=this.info.sStreamName,r=Number(this.info.iBitRate);-1!==o.a.useChangeRate.indexOf(Number(this.info.presenterUid))&&(r=this.info.curBitrate),r=i?this._getCodec(1,r):e?this._getCodec(2,r):this._getCodec(3,r);let a=new tt.CdnGroupID;return a.streamName=s,a.codecType=r,a.cdnBrand=t,a}loadFullStream(t,e,i){this.loadStream||(n.a.log("%cQuickAccess from "+t,"background:#FFBFFF"),this.loadStream=!0,this.startFullStreamTs=0,this.stat.addCore(d.a.CORE.FULL_CDN_CNT,1),this.loaderMgr.loadFullStream(this.G.quickAccessBeginIndex,e,i))}on302(t){super.on302(t);let e=t.match(/\/\/(.+?)\//i),i=o.a.p2p302Config;i&&Array.isArray(i)&&0===i[1]||(e&&e.length>1&&(this.info._domain302=e[1]),this.p2p302Domain=e[1].split(":")[0],n.a.log("P2PPlayer.on302, url=".concat(t,", info.domain302=").concat(this.info._domain302,", p2p302Domain=").concat(this.p2p302Domain)))}getDurationTime(){const t=((this.mse||{}).video||{}).video;let e=0;return t&&(e=Math.floor(t.duration||0)),e}turnToH264(t){this.stop(),this.eventEmitter.trigger(u.TURN_TO_H264,{reason:t})}turntoH265Wasm(){this.stop(),this.eventEmitter.trigger(u.TURN_TO_H265_WASM)}h265Retry(){this.stop(),this.eventEmitter.trigger(u.H265_VIDEO_RETRY)}turnToMse(){this.stop()}onFastSliceData(t){let e=this.G;0==e.firstP2POnDataTime&&(e.firstP2POnDataTime=_.a.now()),this.onSliceData(t),this.p2pMgr.onFastSliceData(t)}onSliceData(t){if(!this.started)return;let e=t.parent.uri===tt.ProtoUri.PP2pSliceVideoData,i=t.parent.uri===tt.ProtoUri.PP2pSliceAudioData,s=t.parent.uri===tt.ProtoUri.PP2pSliceAudioDataV2,r=t.parent.uri===tt.ProtoUri.PP2pSliceAudioDataV3;if(i||e||s||r){if(this.lastSliceTs=_.a.now(),!this.firstSlicePrinted){this.firstSlicePrinted=!0;let i="%cFirst Slice isVideo=".concat(e," seq=").concat(t.parent.seq);n.a.log(i,"background:#FFBFFF")}this.player&&(e?this.player.onVideoStreamData(t.child):i?this.player.onAudioStreamData(t.child):(s||r)&&this.player.onAudioStreamDataV2(t.child))}}onCheckTimer(t,e){if(super.onCheckTimer(t,e),e%10==0&&(this.restartTimes=0),this.player&&this.player.onCheckTimer(t,e),!this.player)return;this.p2pStat.onCheckTimer(t,e);let i=this.G;if(i.globalSpeedCalc.calculate(),e%(Number(f.a._speedPrintRate)||20)==0){let t=i.curBitrate/8,e=this.getGlobalSpeed();n.a.log("P2PPlayer(".concat(this._id,").onCheckTimer avgSpeed=").concat(e,"KB/s expectSpeed=").concat(t,"KB/s"))}this.lastSliceTs>0&&t-this.lastSliceTs>o.a.noSliceTimeout?this.turnToFlv(N.a.turnToFlvReason.NO_DATA_TIMEOUT):(0===this.heart20Ts?this.heart20Ts=t:t-this.heart20Ts>2e4&&this._sendHeartbeat(t,!1),e%300==0&&(this.tsdb.sendMetrics([{sMetricName:A.METRIC.VIDEO_VIDEO_BAD_QUALITY_5M_RATIO,vField:{value:this.pauseCnt5>0?100:0}}]),this.pauseCnt5=0,this.pauseTime5=0))}_sendHeartbeat(t,e){if(!this.player)return;this.heart20Ts=t,this._checkPaused(t,e?Ks:Ys),this._checkPausedWorker(t,e?Ks:Ys),this._checkMobPaused(t,e?Ks:Ys),this.loaderErrorTimes,this.loaderErrorTimes=0,this._checkAvcChangeReport(t,this.pauseStartTs>0);let i=this.getBufferLen();this.isShieldStart&&(i+=this.getFrameBufferLen()),this.stat.setCore(d.a.CORE.PLAY_DELAY,i),this.stat.setCore(d.a.CORE.FRAME_BUFFER_DELAY,this.getFrameBufferLen()),this.stat.setCore(d.a.CORE.AUDIO_CNT,this.player.audioRecver.audioCnt),this.stat.setCore(d.a.CORE.BIG_AUDIO_CNT,this.player.audioRecver.bigAudioCnt),this.player.audioRecver.resetAudioNum();let s=this.pauseStartTs>0;this.qaStat.record({pauseCnt:this.pauseCnt,pauseTime:this.pauseTime,isPaused:s,pauseReason:this.pauseReason,forceSkipFrameNums:0,isEnd:e,isPausedWorker:this.pauseStartWorkerTs>0,pauseWorkerCnt:this.pauseWorkerCnt,pauseWorkerTime:this.pauseWorkerTime,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPause}),this.qaStat.hasEmptyFrames=this.hasEmptyFrames,this.pauseStartTs>0&&this.autoMonitor.setPause(this.pauseStartTs,this.getBufferLen()),this.pauseCnt=0,this.pauseTime=0,this.pauseReason=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.isRenderFpsPause=!1,this.pauseMobCnt=0}_getBadReason(t){if(!this.player)return N.a.BAD_REASONS.UNKNOW;if(!this.p2pMgr.isSubsReady())return N.a.BAD_REASONS.SUB_LINK;let e=this.p2pMgr.getLastFullSubTs();if(e>0&&t-e>5e3&&!this.player.isDownEnough())return N.a.BAD_REASONS.DOWN_LINK;let i=this.p2pMgr.stream;if(i){let e=i.stat;if(e.range_miss_ts>0&&t-e.range_miss_ts<1e4)return N.a.BAD_REASONS.RANGE_MISS;if(e.range_recv_timeout_ts>0&&t-e.range_recv_timeout_ts<1e4)return N.a.BAD_REASONS.RANGE_RECV_TIMEOUT}return this.player.isDownEnough()?this.player.videoRecver.frameSeqLostTs>0&&t-this.player.videoRecver.frameSeqLostTs<1e4?N.a.BAD_REASONS.FRAME_SEQ_LOST:this.player.msePlayer.lastJumpBufferTs>0&&t-this.player.msePlayer.lastJumpBufferTs<1e4?N.a.BAD_REASONS.BUFFER_JUMP:this.player.videoRecver.lastDtsJumpTs>0&&t-this.player.videoRecver.lastDtsJumpTs<1e4?N.a.BAD_REASONS.TIMESTAMP_JUMP:this.player.videoRecver.lastFrameIdJumpTs>0&&t-this.player.videoRecver.lastFrameIdJumpTs<1e4?N.a.BAD_REASONS.FRAME_VIDEO_JUMP:this.player.audioRecver.lastFrameIdJumpTs>0&&t-this.player.audioRecver.lastFrameIdJumpTs<1e4?N.a.BAD_REASONS.FRAME_AUDIO_JUMP:this.player.videoRecver.frameDropTs>0&&t-this.player.videoRecver.frameDropTs<1e4?N.a.BAD_REASONS.FRAME_DROP:this.getBufferLen()>2e3?N.a.BAD_REASONS.PERFORMANCE:N.a.BAD_REASONS.UNKNOW:N.a.BAD_REASONS.DOWN_LINK}onCheckFastTimer(t,e){this.started&&(this.wakeChecker.onCheckFastTimer(t,e),this.player&&(this.player.onCheckFastTimer(t,e),this.p2pMgr.setLastRenderSeq(this.player.getPlayingSeq())),this.p2pMgr.setDecodeDelay(this.mse.getVideoDecodeDelaySmooth()),!this.pauseCheckLock&&this.pauseStartTs>0&&t-this.pauseStartTs>200&&(this.pauseCheckLock=!0))}_autoReportSea(){1==o.a.autoReportSea&&this.pauseCnt>0&&this.eventEmitter&&this.eventEmitter.trigger(u.P2P_REPORT,"bad"+this.pauseReason)}getGlobalSpeed(){let t=this.G.globalSpeedCalc.average();return t=Math.round(t/1024),t}isLowNet(){let t=this.G.curBitrate/8;return this.getGlobalSpeed()<t-20}getMse(){return this.mse}onPlayVideo(t,e,i,s,r,a,o,h,l){super.onPlayVideo(t,e,i,s,r,a,o),P.delFail(this.stat),this.updateStatus(p.VIDEO_PLAYING),this.stat.setComDim(d.a.DIM_COM.DPI,e+"*"+i),this.p2pStat.recordPlayBuf(),this.p2pMgr.loadLib(),this.startFastTimer();let c=this.G,m=_.a.now();0!==this.startTs&&(c.onPlayTime=a,n.a.log("%c[TIME] P2PPlayer(".concat(this._id,").onPlayVideo onPlayTime=")+(m-c.firstRenderTime)+" totalTime="+(m-c.startTime),"color:#A23400;background:#FFF5C2"));let f={video:t,width:e,height:i,hasVideo:s,connectTime:c.connectVideoTime-this.startTs,recvDataTime:c.recvDataTime-this.startTs,canvas:r,delayRemove:this.info._delayRemove,canvas1:h,canvas2:l};if(this.info._delayRemove=!1,f.videoCodec=o,this.eventEmitter.trigger(u.VIDEO_PLAY,f),this.waitRemuxTime=0,this.mse&&this.mse.parser&&0!=this.mse.parser.waitRemuxTime&&(this.waitRemuxTime=this.mse.parser.waitRemuxTime),0!==this.startTs){this.loadTime=m-this.startTs,c.loadedDataTs=m-this._hyPlayer.startTs,c.hyPlayerLoadTs=m-this._hyPlayer.startTs,this.mse&&(c.firstP2PIframeTime=this.mse.parser.decodeIFRTime),n.a.log("%cP2PPlayer(".concat(this._id,").onPlayVideo w/h=")+e+"/"+i+" loadTime="+this.loadTime,"color:#A23400;background:#FFF5C2"),n.a.log("%cP2PPlayer(".concat(this._id,").onPlayVideo G.loadedDataTs=")+c.loadedDataTs+" G.hyPlayerLoadTs="+c.hyPlayerLoadTs,"color:#A23400;background:#FFF5C2");let t=this.UIStartCost>0?this.loadTime+this.UIStartCost:0,s=0;this.startTimeStamp>1?s=this.loadTime+this.businessStartCost:1===this.startTimeStamp&&(s=this.loadTime),this.tsdb.sendCdnTime(c,!0,this.waitRemuxTime,s,t,this.mse.videoFirstFrameDecodeCost,this.mse.audioFirstFrameDecodeCost,this.mse.triggerPlayType),this.startTs=0,c.printUseTime()}else n.a.log("P2PPlayer(".concat(this._id,").onPlayVideo w/h=")+e+"/"+i);this.isEverSuccessPlayed=!0}onVideoStop(t,e){n.a.log("P2PPlayer(".concat(this._id,").onVideoStop hasVideo=")+e),e&&(this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.VIDEO_STOP,{video:t,haveVideo:!0}))}onSendSeiData(t){this.eventEmitter.trigger(u.H264_SEI_PLAY,{data:t})}onSendScriptVolumeInfo(t,e){this.eventEmitter.trigger(u.UPDATE_INTERSITY,{uid:t,intensity:e})}onPlayerError(t){n.a.log("P2PPlayer(".concat(this._id,").onPlayerError, needNotify="),t),setTimeout(()=>{this._hyPlayer.isBusiStop||t&&(this.tsdb.restartReason=N.a.restartReason.PLAYER_ERROR,this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN))},1e3)}onErrorEvent(t){if(super.onErrorEvent(t),3===t.type){let t=this.player&&this.player.getStat(),e=t.dropFrames,i=t.playedFrames;n.a.log("P2PPlayer(".concat(this._id,") onErrorEvent dropFrames"),e,"playedFrames",i)}let e=[];e.push(this.stat.createAct(d.a.ACT.P2P_PLAY_FAIL,{value:[t.type,this.bufferLen]})),this.tsdb.sendMetrics(e)}updateFrameTs(t){this.fullStreamLoading&&(0==this.firstRecvFullStreamFrameTs?(this.startFullStreamTs=_.a.now(),this.firstRecvFullStreamFrameTs=t):t>this.lastRecvFullStreamFrameTs&&(this.lastRecvFullStreamFrameTs=t))}printAVInfos(){this.player&&this.player.printAVInfos(),super.printAVInfos()}_switchStart(t,e){this.loadStream=!1,this.mse.parser.reset(),this.mse.setPushGop(o.a.pushGop),this.mse.appendFlv(this.flvHeader),this.p2pMgr&&this.p2pMgr.switchStart(),this.player&&this.player.switchStart(),n.a.groupEnd();let i=this.info;i.isH265=this.isH265=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,this.G.streamId=this.createStreamId(Number(i.iIsP2PSupport),this.isH265),this.loaderMgr.init(this.streamDomain.sP2pUrl,this.loaderMgr.antiCode),this.quickAccessVideoOnly(!1,t,e),o.a.setJitterCfg(this.mse,i.presenterUid,i.curBitrate)}_switchDone(t,e,i){this.p2pMgr.loadLib()}subError403(){if(this._hyPlayer.isPaidRoom&&null!=this._hyPlayer.payCount403&&(this._hyPlayer.payCount403++,n.a.log("P2PPlayer(".concat(this._id,".subError403, payCount403=").concat(this._hyPlayer.payCount403)),this._hyPlayer.payCount403>=o.a.payRoomCfg[1])){if(1==f.a._testPaid)return;this._hyPlayer.stop()}}setPcdnIaas(t){n.a.log("P2PPlayer.setPcdnIaas,pcdnIaas=",t),this.stat&&this.stat.setComDim(d.a.DIM_COM.PCDN_IAAS,t)}sendNoPicture(t){this._sendVideoNoPicture(t),this._sendVideoNoPictureAll(t)}_sendVideoNoPicture(t){}_sendVideoNoPictureAll(t){let e=this.G,i=e.connectVideoTime-this.startTs,s=e.recvDataTime-this.startTs;if(this.videoLoadTimeSent=!0,!this.hasPicture){const e=99999;let r=0;this.isMse&&(r=this.mse.isMediaSourceOpen?1:2);const a=R.b.getBrowserHidden();this.isMse&&a&&2==r?n.a.log("P2PPlayer._sendVideoNoPictureAll browserHidden=".concat(a,", isMediaSourceOpen=").concat(r)):this.tsdb.sendNoPictureTimeAll(e,i,s,"p2p",t,this.exceptionStat.getStat())}}get isUsingPcdn(){return!!this.p2pMgr&&this.p2pMgr.hasPcdnSubs()}};class Mr{static init(){var t;for(t in Mr.types={av01:[],av1C:[],avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Mr.types)Mr.types.hasOwnProperty(t)&&(Mr.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Mr.HDLR_TYPES={video:e,audio:i};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Mr.STTS=Mr.STSC=Mr.STCO=r,Mr.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Mr.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Mr.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Mr.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);Mr.FTYP=Mr.box(Mr.types.ftyp,a,n,a,o),Mr.DINF=Mr.box(Mr.types.dinf,Mr.box(Mr.types.dref,s))}static box(t){for(var e,i=Array.prototype.slice.call(arguments,1),s=8,r=i.length,a=r;r--;)s+=i[r].byteLength;for((e=new Uint8Array(s))[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=255&s,e.set(t,4),r=0,s=8;r<a;r++)e.set(i[r],s),s+=i[r].byteLength;return e}static hdlr(t){return Mr.box(Mr.types.hdlr,Mr.HDLR_TYPES[t])}static mdat(t){return Mr.box(Mr.types.mdat,t)}static mdhd(t,e){return Mr.box(Mr.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))}static mdia(t){return Mr.box(Mr.types.mdia,Mr.mdhd(t.timescale,t.duration),Mr.hdlr(t.type),Mr.minf(t))}static mfhd(t){return Mr.box(Mr.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return"audio"===t.type?Mr.box(Mr.types.minf,Mr.box(Mr.types.smhd,Mr.SMHD),Mr.DINF,Mr.stbl(t)):Mr.box(Mr.types.minf,Mr.box(Mr.types.vmhd,Mr.VMHD),Mr.DINF,Mr.stbl(t))}static moof(t,e,i){return Mr.box(Mr.types.moof,Mr.mfhd(t),Mr.traf(i,e))}static moov(t){for(var e=t.length,i=[];e--;)i[e]=Mr.trak(t[e]);return Mr.box.apply(null,[Mr.types.moov,Mr.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(Mr.mvex(t)))}static mvex(t){for(var e=t.length,i=[];e--;)i[e]=Mr.trex(t[e]);return Mr.box.apply(null,[Mr.types.mvex].concat(i))}static mvhd(t,e){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Mr.box(Mr.types.mvhd,i)}static sdtp(t){var e,i,s=t.samples||[],r=new Uint8Array(4+s.length);for(i=0;i<s.length;i++)e=s[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return Mr.box(Mr.types.sdtp,r)}static stbl(t){return Mr.box(Mr.types.stbl,Mr.stsd(t),Mr.box(Mr.types.stts,Mr.STTS),Mr.box(Mr.types.stsc,Mr.STSC),Mr.box(Mr.types.stsz,Mr.STSZ),Mr.box(Mr.types.stco,Mr.STCO))}static av01(t){let e=t.bytes,i=t.width,s=t.height;return Mr.box(Mr.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),Mr.box(Mr.types.av1C,e))}static avc1(t){var e,i,s,r=[],a=[];for(e=0;e<t.sps.length;e++)s=(i=t.sps[e]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));for(e=0;e<t.pps.length;e++)s=(i=t.pps[e]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(i));var o=Mr.box(Mr.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a))),n=t.width,h=t.height;return Mr.box(Mr.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),o,Mr.box(Mr.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}static hvc1(t){var e,i,s,r=[],a=[],o=[];for(r.push(160),r.push(t.vps.length>>>8&255),r.push(255&t.vps.length),e=0;e<t.vps.length;e++)s=(i=t.vps[e]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));for(a.push(161),a.push(t.sps.length>>>8&255),a.push(255&t.sps.length),e=0;e<t.sps.length;e++)s=(i=t.sps[e]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(i));let n=[],h=0;for(e=0;e<a.length;)i=a[e],2!==h||3!==i?(0===i?h++:h=0,n.push(i),++e):(++e,h=0);for(o.push(162),o.push(t.pps.length>>>8&255),o.push(255&t.pps.length),e=0;e<t.pps.length;e++)s=(i=t.pps[e]).byteLength,o.push(s>>>8&255),o.push(255&s),o=o.concat(Array.prototype.slice.call(i));const d=new Uint8Array([1,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18],n[19],240,0,252,253,248,248,0,0,15].concat([3]).concat(r).concat(a).concat(o));var l=Mr.box(Mr.types.hvcC,d),c=t.width,u=t.height;return Mr.box(Mr.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),l,Mr.box(Mr.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}static esds(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){var e=t.audiosamplerate;return Mr.box(Mr.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),Mr.box(Mr.types.esds,Mr.esds(t)))}static stsd(t){return"audio"===t.type?Mr.box(Mr.types.stsd,Mr.STSD,Mr.mp4a(t)):t.isHevc?Mr.box(Mr.types.stsd,Mr.STSD,Mr.hvc1(t)):t.isAV01?Mr.box(Mr.types.stsd,Mr.STSD,Mr.av01(t)):Mr.box(Mr.types.stsd,Mr.STSD,Mr.avc1(t))}static tkhd(t){var e=t.id,i=t.duration,s=t.width,r=t.height;return Mr.box(Mr.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,r>>8&255,255&r,0,0]))}static traf(t,e){var i=Mr.sdtp(t),s=t.id;return Mr.box(Mr.types.traf,Mr.box(Mr.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),Mr.box(Mr.types.tfdt,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),Mr.trun(t,i.length+16+16+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,Mr.box(Mr.types.trak,Mr.tkhd(t),Mr.mdia(t))}static trex(t){var e=t.id;return Mr.box(Mr.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){var i,s,r,a,o,n,h=t.samples||[],d=h.length,l=12+16*d,c=new Uint8Array(l);for(e+=8+l,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),i=0;i<d;i++)r=(s=h[i]).duration,a=s.size,o=s.flags,n=s.cts,c.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,n>>>24&255,n>>>16&255,n>>>8&255,255&n],12+16*i);return Mr.box(Mr.types.trun,c)}static initSegment(t){Mr.types||Mr.init();var e,i=Mr.moov(t);return(e=new Uint8Array(Mr.FTYP.byteLength+i.byteLength)).set(Mr.FTYP),e.set(i,Mr.FTYP.byteLength),e}}var wr=Mr,Fr=class{constructor(t){this.mse=t,this.audioISGenerated=!1,this.videoISGenerated=!1,this.PES2MP4SCALEFACTOR=1,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this._forceFirstIDR=!(!h.a.chrome||!(h.a.version.major<50||50===h.a.version.major&&h.a.version.build<2661))}get timescale(){return this.MP4_TIMESCALE}get isWebglRender(){return this.mse.h265Proxy&&this.mse.h265Proxy.renderInited}destroy(){this.reset()}reset(){this.insertDiscontinuity(),this.switchLevel()}resetInitDts(){this._initPTS=this._initDTS=void 0}insertDiscontinuity(){this.nextAacPts=this.nextAvcDts=void 0}getInitDts(){return void 0!==this._initDTS?this._initDTS/90:void 0}switchLevel(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n.a.log("mp4-remuxer.switchLevel"),t&&(this.videoISGenerated=!1),e&&(this.audioISGenerated=!1)}remux(t,e,i,s){Number(f.a._printMp4Remux)&&n.a.debug("\n### Audio",t,"\n### Video",e),this.audioISGenerated||this.generateAudioIS(t,i),this.videoISGenerated||this.isWebglRender||this.generateVideoIS(e,i),this.initTs(t,e,i),e.samples.length&&(this.isWebglRender?this.renderVideo(e,s):this.remuxVideo(e,s)),t.samples.length&&this.remuxAudio(t,s),this.mse.onFragParsed()}initTs(t,e,i){if(null!=this._initPTS)return;let s=t.samples,r=e.samples,a=s.length,o=r.length,h=this.PES_TIMESCALE;0===a&&0===o?n.a.warn("mp4-remuxer.initTs have no nbAudio&nbVideo"):0===o?(this._initPTS=s[0].pts-h*i,this._initDTS=s[0].dts-h*i):0===a?(this._initPTS=r[0].pts-h*i,this._initDTS=r[0].dts-h*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-h*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-h*i),n.a.log("mp4-remuxer initDTS/initPTS=[".concat(this._initDTS,", ").concat(this._initPTS,"]"))}generateAudioIS(t,e){if(t.config){let e={audioMoov:wr.initSegment([t]),audioCodec:t.codec,audioChannelCount:t.channelCount};this.mse.onInitSegment(e),this.audioISGenerated=!0}}generateVideoIS(t,e){if(t.isAV01||t.sps&&t.pps){let e={videoMoov:wr.initSegment([t]),videoCodec:t.codec,videoWidth:t.width,videoHeight:t.height};this.mse.onInitSegment(e),this.videoISGenerated=!0}}remuxVideo(t,e){let i,s,r,a,o,h,d,l,c,u,p,m,g,S,y,T=8,P=this.PES2MP4SCALEFACTOR,v=[],E=t.isAV01?0:4*t.naluCnt;for(d=new Uint8Array(t.len+E+8),i=new DataView(d.buffer),i.setUint32(0,d.byteLength),d.set(wr.types.mdat,4);t.samples.length;){for(r=t.samples.shift(),o=0;r.units.length;)h=r.units.shift(),s=h.data.byteLength,"av01"!=r.type&&(i.setUint32(T,s),T+=4,o+=4),d.set(h.data,T),T+=s,o+=s;if(m=r.pts-this._initDTS,g=r.dts-this._initDTS,(g<0||m<0)&&Number(f.a._printMp4RemuxVideo)&&n.a.log("mp4-remuxer.remuxVideo warn dts=".concat(g,", pts=").concat(m)),void 0!==p)S=this._PTSNormalize(m,p),y=this._PTSNormalize(g,p),a.duration=(y-p)/P,a.duration<0&&(Number(f.a._printMp4RemuxVideo)&&n.a.warn("mp4-remuxer.remuxVideo invalid sample duration at pts="+r.pts/90+" dts="+r.dts/90+" duration="+a.duration/90),a.duration=0,y=p);else{let t,i=this.nextAvcDts||g;S=this._PTSNormalize(m,i),y=this._PTSNormalize(g,i),t=Math.round((y-i)/90),(e||Math.abs(t)<600)&&t&&(t>1&&Number(f.a._printMp4RemuxVideo)?n.a.warn("mp4-remuxer.remuxVideo hole="+t+" filling it"):t<-1&&Number(f.a._printMp4RemuxVideo)&&n.a.warn("mp4-remuxer.remuxVideo overlapping="+-t+" detected"),y=i,S=Math.max(S-t,y)),c=Math.max(0,S),u=Math.max(0,y)}let l=r.key;a={size:o,duration:0,cts:(S-y)/P,flags:{isLeading:0,degradPrio:0,hasRedundancy:0,dependsOn:l?2:1,isDependedOn:l?1:0,isNonSync:l?0:1}},v.push(a),p=y,this.mse.isLive&&this.mse.videoPlayConsuming.addRemuxFrameData(r.ts,r.ts+r.cts,_.a.now())}this._forceFirstIDR&&(v[0].flags.dependsOn=2,v[0].flags.isNonSync=0),void 0!==t.endDts?(a.duration=(90*t.endDts-this._initDTS-y)/P,a.duration<0?(a.duration=0,this.nextAvcDts=y):this.nextAvcDts=90*t.endDts-this._initDTS):(v.length>=2&&(a.duration=v[v.length-2].duration),this.nextAvcDts=y+a.duration*P),t.len=0,t.naluCnt=0,t.samples=v,l=wr.moof(t.sn,u/P,t),t.samples=[];let C={type:"video",data:this._mergeBoxes(l,d)};this.mse.onFragParsing(C)}remuxAudio(t,e){let i,s,r,a,d,l,c,u,p,m,g,S,y,T=8,P=this.PES_TIMESCALE,v=this.PES2MP4SCALEFACTOR,E=[];for(d=new Uint8Array(t.len+8),i=new DataView(d.buffer),i.setUint32(0,d.byteLength),d.set(wr.types.mdat,4);t.samples.length;){if(s=t.samples.shift(),a=s.unit,d.set(a,T),T+=a.byteLength,m=s.pts-this._initDTS,g=s.dts-this._initDTS,void 0!==p)S=this._PTSNormalize(m,p),y=this._PTSNormalize(g,p),r.duration=(y-p)/v,o.a.popSize0Brows.map(t=>{const e=t[0],i=t[1];h.a.name==e&&h.a.version.major>=i&&s.sampleDuration&&(r.duration=90*Math.ceil(s.sampleDuration))}),r.duration<0&&(Number(f.a._printMp4RemuxAudio)&&n.a.warn("mp4-remuxer.remuxAudio invalid AAC sample duration at PTS="+s.pts+" duration="+r.duration),r.duration=0,S=y=p);else{let t,i=this.nextAacPts||m;S=this._PTSNormalize(m,i),y=this._PTSNormalize(g,i),t=Math.round(1e3*(S-i)/P),(e||Math.abs(t)<600)&&t&&(S=y=i),c=Math.max(0,S),u=Math.max(0,y)}r={size:a.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(r),p=y,this.mse.isLive&&this.mse.audioPlayConsuming.addRemuxFrameData(s.ts,s.ts,_.a.now())}E.length>=2&&(r.duration=E[E.length-2].duration),this.nextAacPts=S+r.duration*v,t.len=0,t.samples=E,l=wr.moof(t.sn,u/v,t),t.samples=[];let C={type:"audio",data:this._mergeBoxes(l,d)};this.mse.onFragParsing(C)}renderVideo(t,e){if(this.mse.isLive)for(let e=0;e<t.samples.length;e++){const i=t.samples[e];this.mse.videoPlayConsuming.addRemuxFrameData(i.ts,i.ts+i.cts,_.a.now())}this.mse.h265Proxy.pushVideoFrame(t,e)}_mergeBoxes(t,e){let i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i}_PTSNormalize(t,e){let i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}};class br{static getSilentFrame(t,e){if(2===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}static setWebcodeccEmptyFrame(t){br.webcodeccEmptyFrame=t.toLocaleString().split(",")}}br.emptyAacFrameAdts=[255,241,92,64,18,64,252,0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],br.emptyAacFrame=[0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],br.emptyAacFrame_44_1=[1,64,34,128,163,78,129,64,0,0,0,0,4,96,6,246,81,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94],br.webcodeccEmptyFrame=null;var Vr=br,Nr={CODE:1,PRIORITY:11},Br={CODE:13,PRIORITY:8},kr={CODE:14,PRIORITY:9},Ur={CODE:15,PRIORITY:10},xr={CODE:18,PRIORITY:5},Hr={CODE:19,PRIORITY:3},Wr={CODE:20,PRIORITY:4},Gr={CODE:21,PRIORITY:2},Yr={CODE:22,PRIORITY:1},qr={ptsJumpTest:!1,jumpConfigs:null,initPts:0,audioTimeOffset:0,videoTimeOffset:0};class Kr{constructor(t){this.tsParser=t,this._init()}_init(){this._preAudioDts=0,this._preVideoDts=0,this._audioDtsVec=[],this._videoDtsVec=[],this.aJumpDtsVec=[],this.vJumpDtsVec=[],this.audioFixTimes=0,this.videoFixTimes=0,this._aFrameDuration=0,this._vFrameDuration=0}reset(){this._init()}getFrameDuration(t){let e="video"===t?this._videoDtsVec:this._audioDtsVec;if(e.length<4)return e[0]||0;let i=0,s=[];e.forEach((t,e)=>{e>0&&s.push(Math.abs(t-i)),i=t}),s.sort((t,e)=>t-e),s.pop(),s.shift();const r=s.reduce((t,e)=>e+t);return Math.ceil(r/s.length)}setPreAudioDts(t){this._preAudioDts=t}setPreVideoDts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._preVideoDts=t}checkAudioDts(t){this._preAudioDts||(this._preAudioDts=t),Math.abs(t-this._preAudioDts)/90>Kr.ErrorDtsThreshold&&(1===Number(f.a._print_dts_fix)&&n.a.log("%cVodDtsJumpHelper.checkAudioDts audio dts jump dts=".concat(t,", preDts=").concat(this._preAudioDts),"color:#50c1d8"),this.aJumpDtsVec.push(this._preAudioDts)),this._preAudioDts=t,this._audioDtsVec.length<=11&&(this._audioDtsVec.push(t),this._aFrameDuration=this.getFrameDuration("audio")||0)}checkVideoDts(t){this._preVideoDts||(this._preVideoDts=t),Math.abs(t-this._preVideoDts)/90>Kr.ErrorDtsThreshold&&(1===Number(f.a._print_dts_fix)&&n.a.log("%cVodDtsJumpHelpercheckVideoDts video dts jump dts=".concat(t,", preDts=").concat(this._preVideoDts),"color:#50c1d8"),this.vJumpDtsVec.push(this._preVideoDts)),this._preVideoDts=t,this._videoDtsVec.length<=11&&(this._videoDtsVec.push(t),this._vFrameDuration=this.getFrameDuration("video")||0)}dtsJumpFix(t,e){let i=0,s=0;this.aJumpDtsVec.length>0&&this.vJumpDtsVec.length>0&&(i=this.aJumpDtsVec[0],s=this.vJumpDtsVec[0]);const r=t.samples;let a=0,o=0;for(let t=0;t<r.length;t++){const h=r[t];if("video"===e){if(o=this._vFrameDuration,a=this._preVideoDts,s&&a>s)break}else if(o=this._aFrameDuration,a=this._preAudioDts,i&&a>i)break;if(Math.abs(h.dts-a)/90>Kr.ErrorDtsThreshold){let t=parseInt(a+o);const i=h.dts-t;if(h.dts=h.dts-i,h.pts=h.pts-i,1===Number(f.a._print_dts_fix)){const s=t-a;n.a.log("VodDtsJumpHelper.dtsJumpFix fixed type=".concat(e," pts=").concat(h.pts," dts=").concat(h.dts," cts=").concat(h.pts-h.dts," gap=").concat(s," delta=").concat(i))}"video"===e?this.videoFixTimes++:this.audioFixTimes++}"video"===e?this._preVideoDts=h.dts:this._preAudioDts=h.dts}}dtsAmend(t,e){let i=Kr.FrameThreshold,s=this.aJumpDtsVec.length,r=this.vJumpDtsVec.length;if(s>0&&r>0){let a=this.aJumpDtsVec.shift(),o=this.vJumpDtsVec.shift(),h=a-this.audioDtsDelta,d=o-this.videoDtsDelta;for(;s>0&&r>0;){const l=(h-d)/90;if(l<-i)a=this.aJumpDtsVec.shift(),h=a-this.audioDtsDelta;else if(l>i)o=this.vJumpDtsVec.shift(),d=o-this.videoDtsDelta;else if(l>=-i&&l<=i){this.setPreAudioDts(a),this.setPreVideoDts(o),this.dtsJumpFix(t,"audio"),this.dtsJumpFix(e,"video"),1===Number(f.a._print_dts_fix)&&n.a.log("%cTsParse._dtsJumpFix fix pts jump","color:#8d3333;background:#FFF5C2");break}s=this.aJumpDtsVec.length,r=this.vJumpDtsVec.length}}else if(s>0){if(e.samples.length<=0)return!0;const t=this.aJumpDtsVec[0],s=e.samples[e.samples.length-1].dts;if(t>s)return 1===Number(f.a._print_dts_fix)&&n.a.log("TsParser._dtsJumpFix waiting avc jump dts"),!0;if(t<=s&&(s-t)/90<i)return!0}else if(r>0){if(t.samples.length<=0)return!0;const e=this.vJumpDtsVec[0],s=t.samples[t.samples.length-1].dts;if(e>s)return 1===Number(f.a._print_dts_fix)&&n.a.log("TsParser._dtsJumpFix waiting aac jump dts"),!0;if(e<=s&&(s-e)/90<i)return!0}return!1}get audioDtsDelta(){return this._aFrameDuration*this.audioFixTimes}get videoDtsDelta(){return this._vFrameDuration*this.videoFixTimes}get aFrameDuration(){return this._vFrameDuration}get vFrameDuration(){return this._aFrameDuration}get frameDuration(){return Math.max(this.aFrameDuration,this.vFrameDuration)}}Kr.ErrorDtsThreshold=1e3,Kr.FrameThreshold=200;var jr=Kr;const zr=98,Jr=99;class Qr{constructor(t,e){this.mse=t,this.remuxer=e,this.width=0,this.height=0,this.lastSN=0,this.lastLevel=0,this.PES_TIMESCALE=9e4,this.lastTsData=null,this.lastPos=0,this.hasRemux=!1,this.fragStartTs=0,this.ignoreSei=!1,this.closeFetch=!1,this.dropBeforeFirstIDR=!1,this.hasIDR=!1,this.vFps=new wt,this.aFps=new wt,this._initPts=Number.MAX_SAFE_INTEGER,this._initDts=Number.MAX_SAFE_INTEGER,this.nextAudioPts=0,this.isHevc=!1,this.codec=F,this.vodDtsJumpHelper=new jr(this),this.isNoAudio=!0,this.hevcSpsParser=new Xt,this.hevcCodec="",this.avcCodec="",this.lastTs=0,this.timeOffset=0,this.continuousTimeStamp=!1,this.videoStartPts=Number.MAX_SAFE_INTEGER,this.videoStartDts=Number.MAX_SAFE_INTEGER,this.audioStartPts=Number.MAX_SAFE_INTEGER,this.audioStartDts=Number.MAX_SAFE_INTEGER,this.openConvertIDR=!1,this.convertToIDR=!1}getCodecType(){return this.codec}getFps(){return this.vFps&&this.vFps.getFps()}getAudioFps(){return this.aFps&&this.aFps.getFps()}getStartTs(){return this.fragStartTs}destroy(){this.switchLevel(),this.duration=0}probe(t){return t.length>=564&&71===t[0]&&71===t[188]&&71===t[376]}resetAVData(){this._avcTrack&&(this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.samples=[])}pushAllData(){this._avcTrack&&this._avcTrack.sn>0&&this.remuxTs(this._aacTrack,this._avcTrack,this._avcTrack.sn)}parseAllData(){let t=!1;if(this._avcTrack){let e=this._avcTrack.pesData,i=this._aacTrack.pesData,s=this._id3Track.pesData,r=this.continuousTimeStamp?this.timeOffset:0;e&&(this._parseAVCPES(this._parsePES(e,r,0,0,1)),t=!0),i&&this._parseAACPES(this._parsePES(i,r,0,0,2)),s&&this._parseID3PES(this._parsePES(s,r,0,0,3)),this._avcTrack.pesData=void 0,this._aacTrack.pesData=void 0,this._id3Track.pesData=void 0}return t}switchLevel(){let t=this.createTrack;!this._avcTrack&&(this._avcTrack=t("video")),!this._aacTrack&&(this._aacTrack=t("audio")),!this._id3Track&&(this._id3Track=t("id3")),this.pmtParsed=!1,this._pmtId=-1,this.isHevc=!1,this.remuxer.switchLevel()}createTrack(t){return{type:t,id:-1,sn:0,samples:[],len:0,naluCnt:0}}insertDiscontinuity(t){n.a.log("TsParser.insertDiscontinuity timeOffset=".concat(t)),this.resetTsData(),this.switchLevel(),this.remuxer.insertDiscontinuity(),this.mse.insertDiscontinuity&&this.mse.insertDiscontinuity(t)}reset(){this.vFps.reset(),this.aFps.reset(),this.resetTsData(),this.hasRemux=!1,this.hasIDR=!1,this.lastTsData=null,this._avcTrack&&(this._avcTrack.sps=null,this._avcTrack.pps=null,this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.naluCnt=0,this._aacTrack.samples=[]),this.vodDtsJumpHelper.reset()}resetTsData(){let{_avcTrack:t,_aacTrack:e,_id3Track:i}=this;e&&(t.pesData=null,e.pesData=null,i.pesData=null,this.lastTsData=null),this.fragStartTs=0}appendTsData(t,e){let i;e&&this.resetTsData(),t instanceof Uint8Array||(t=new Uint8Array(t));let s=this.lastTsData,r=this.lastPos;if(s){let e=s.byteLength-r,a=e+t.byteLength;i=new Uint8Array(a),i.set(s.slice(r),0),i.set(t,e)}else i=t;return this.lastPos=0,this.lastTsData=i,i}syncOffset(t){let e=Math.min(188,t.length-564),i=0;for(;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1}parseTs(t){let{data:e,audioCodec:i,videoCodec:s,timeOffset:r,duration:a,discontinuity:o,_discontinuity:d,level:l,sn:c,seeking:u,hlsDT:p,tsDT:m}=t;this.contiguous=!1,o||d?(n.a.log("TsParser.parseTs discontinuity detected timeOffset=".concat(r)),this.continuousTimeStamp||this.insertDiscontinuity(r)):l!==this.lastLevel?(n.a.log("TsParser.parseTs level switch detected"),this.switchLevel(),this.lastLevel=l):c===this.lastSN+1&&(this.contiguous=!0),e=this.appendTsData(e,u,c);var _=e.length;this.audioCodec=i,this.videoCodec=s,r!==this.timeOffset&&(this.videoStartDts=Number.MAX_SAFE_INTEGER,this.videoStartPts=Number.MAX_SAFE_INTEGER,this.audioStartDts=Number.MAX_SAFE_INTEGER,this.audioStartPts=Number.MAX_SAFE_INTEGER),this.timeOffset=r,this.duration=a,this.lastSN=c,this.contiguous||(this.aacOverFlow=null),this._avcTrack||this.insertDiscontinuity(r);let f=this.syncOffset(e);if(f<0)return;this.lastPos=_-=(_+f)%188,_===e.length&&(this.lastTsData=null);let g=this._avcTrack,S=this._aacTrack,y=this._id3Track,T=this.pmtParsed,P=g.pesData,v=S.pesData,E=y.pesData,C=g.id,I=S.id,A=y.id;var D,R,O,L,M;try{for(var w=f;w<_;w+=188)if(71===e[w]){if(D=!!(64&e[w+1]),R=((31&e[w+1])<<8)+e[w+2],(48&e[w+3])>>4>1){if((O=w+5+e[w+4])===w+188)continue}else O=w+4;if(T)if(L=(M=w+188)-O,R===C){if(this.mse.isPureAudio)continue;D&&(P&&this._parseAVCPES(this._parsePES(P,r,p,m,1)),P={data:[],size:0}),P&&(P.data.push(e.subarray(O,M)),P.size+=L)}else if(R===I){if(this.mse.isPureVideo)continue;D&&(v&&(this._parseAACPES(this._parsePES(v,r,p,m,2)),!this.closeFetch&&!this.hasRemux&&g.samples.length>1&&this.remuxTs(S,g,c)),v={data:[],size:0}),v&&(v.data.push(e.subarray(O,M)),v.size+=L)}else R===A&&(D&&(E&&this._parseID3PES(this._parsePES(E,r,p,m,3)),E={data:[],size:0}),E&&(E.data.push(e.subarray(O,M)),E.size+=L));else D&&(O+=e[O]+1),0===R?this._parsePAT(e,O):R===this._pmtId&&(this._parsePMT(e,O),T=this.pmtParsed=!0,C=this._avcTrack.id,I=this._aacTrack.id,A=this._id3Track.id)}else n.a.error("TsParser.parseTs ERROR: TS packet did not start with 0x47"),this.mse&&this.mse.onParseError(zr)}catch(t){n.a.error("TsParser.parseTs error:",t)}if(P&&(g.pesData=P),v&&(S.pesData=v),E&&(y.pesData=E),S.samples.length>1||this.maxVideo()||this.mse.isPureAudio&&S.samples.length>0||this.mse.isPureVideo&&g.samples.length>0){if(0===S.samples.length&&"firefox"===h.a.name&&this.mse.reloadInError&&!this.mse.isLive)return void this.mse.reloadInError();g.width=this.width,g.height=this.height,this.remuxTs(S,g,c)}}maxVideo(){let t=this._avcTrack;if(t.samples.length>1){let e=t.samples[0];return(t.samples[t.samples.length-1].dts-e.dts)/90>2e3}return!1}remuxTs(t,e,i){e.codec=this.isHevc?this.hevcCodec:this.avcCodec,e.width=this.width,e.height=this.height,e.isHevc=this.isHevc,t.sn=e.sn=i,this.hasRemux=!0,t.samples&&t.samples.length>0&&(this.isNoAudio=!1,this.mse.setNoAuido(!1));try{if(!this.mse.isLive&&!this.mse.isPureVideo){if(o.a.vodDtsFixCfg[1]&&this.vodDtsJumpHelper.dtsAmend(t,e))return void n.a.log("Tsparser.remuxTs found pts jump, waiting fix");this.remuxAudio(t,e.samples.length>0)}this.mse.webcodecType==N.a.PLAYER_CORE_TYPE.MSE?this.remuxer.remux(t,e,this.timeOffset,this.contiguous):(this.mse.initTs&&this.mse.initTs(e,t,this.timeOffset),this.mse.appendAvcTrack(e),this.mse.appendAacSample(t)),this.mse.isLive||T.getFirstFragStatus()===S&&T.setFirstFragStatus(y)}catch(t){n.a.error("remux ts error: ",t.message,t),this.mse&&this.mse.onParseError(zr)}}remuxAudio(t,e){const i=9216e4/t.audiosamplerate;0==this.nextAudioPts&&(this.nextAudioPts=this._initPts);let s=this.nextAudioPts;const r=t.samples;for(let a=0,o=s;a<r.length;a++){const h=r[a].pts,d=h-o,l=Math.abs(1e3*d/t.timescale);if(d<=-i&&e)0===a&&(n.a.warn("Audio frame @ ".concat((h/t.timescale).toFixed(3),"s \n                        overlaps nextAudioPts by ").concat(Math.round(1e3*d/t.timescale)," ms.")),this.nextAudioPts=s=o=h);else if(d>i&&l<1e4&&e){let e=Math.round(d/i);o=h-e*i,o<0&&(e--,o+=i),0===a&&(this.nextAudioPts=s=o),n.a.warn("[mp4-remuxer]: Injecting ".concat(e," audio frame nextPts=").concat(o," @ ").concat((o/t.timescale).toFixed(3),"s \n                    due to ").concat(Math.round(1e3*d/t.timescale)," ms gap.")),console.log("aacTrack.config",t.config);for(let s=0;s<e;s++){const e=Math.max(o,0);let s=Vr.getSilentFrame(t.audioObjectType,t.channelCount),n={unit:s,pts:Math.round(e),dts:Math.round(e)};r.splice(a,0,n),t.len+=s.length,o+=i,a++}}o+=i,this.nextAudioPts=o}}_updateInitPts(t,e){this._initPts===Number.MAX_SAFE_INTEGER&&(this.continuousTimeStamp?(this._initPts=t-9e4*this.timeOffset,this._initDts=e-9e4*this.timeOffset):(this._initPts=t,this._initDts=e),qr.initPts||(qr.initPts=this._initPts),n.a.log("Tsparser.remuxTs initPts=".concat(this._initPts," Global initPts=").concat(qr.initPts)))}_parsePAT(t,e){var i=t[e+8]<<8|t[e+9];1==i&&(this._pmtId=(31&t[e+10])<<8|t[e+11]),n.a.log("TsParser._parsePAT program_number=".concat(i," pmtId=").concat(this._pmtId))}_parsePMT(t,e){var i=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<i;){var s=t[e],r=(31&t[e+1])<<8|t[e+2];switch(s){case 15:this._aacTrack.id=r;break;case 21:this._id3Track.id=r;break;case 27:this._avcTrack.id=r;break;case 36:this._avcTrack.id=r,this.isHevc=!0,this.codec=b;break;default:n.a.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}n.a.log("TsParser._parsePMT aacTrack.id=".concat(this._aacTrack.id," avcTrack.id=").concat(this._avcTrack.id))}_parsePES(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;var a=t.data[0];if(1!=(a[0]<<16)+(a[1]<<8)+a[2])return null;var o,n,h=(a[4]<<8)+a[5],d=a[7];192&d&&(o=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,n=64&d?536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2:o),this.continuousTimeStamp&&(1===r?(this.videoStartDts===Number.MAX_SAFE_INTEGER&&(this.videoStartPts=o,this.videoStartDts=n),this._initPts!==Number.MAX_SAFE_INTEGER&&(o=this._initPts+9e4*e+(o-this.videoStartPts),n=this._initDts+9e4*e+(n-this.videoStartDts))):2===r&&(this.audioStartDts===Number.MAX_SAFE_INTEGER&&(this.audioStartPts=o,this.audioStartDts=n),this._initPts!==Number.MAX_SAFE_INTEGER&&(o=this._initPts+9e4*e+(o-this.audioStartPts),n=this._initDts+9e4*e+(n-this.audioStartDts))));var l=a[8]+9;t.data[0]=t.data[0].subarray(l),t.size-=l;for(var c=0,u=new Uint8Array(t.size);t.data.length;)a=t.data.shift(),u.set(a,c),c+=a.byteLength;return s>i&&s-i-1e3*e>0&&(o-=90*(s-i-1e3*e),n-=90*(s-i-1e3*e)),{data:u,pts:o,dts:n,len:h}}_parseAVCPES(t){if(null==t)return n.a.error("TsParser._parseAVCPES pes is null."),void(this.mse&&this.mse.onParseError(zr));!this.mse.isLive&&qr.ptsJumpTest&&this._dtsJumpSimulate(t,"video"),0===this.fragStartTs&&(this.fragStartTs=t.pts/this.PES_TIMESCALE);var e,i=this._avcTrack,s=i.samples,r=this._parseAVCNALu(t.data),a=[],o=0;0===r.length&&s.length>0&&this._pushToPreUnit(t.data),t.data=null;var h=!1,l=!1,c=!1,u="";if(this.isHevc){for(let t of r){switch(t.type){case Qr.HEVC_NAL_VPS:l=!0,c=!0,i.vps||(i.vps=[t.data]);break;case Qr.HEVC_NAL_SPS:if(l=!0,c=!0,!i.sps){i.sps=[t.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration,this.spsConfig={},this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,this.spsConfig);let e=this.spsConfig.profile_space,s=this.spsConfig.profile_idc,r=this.spsConfig.profile_compatibility_flags;r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16|r<<16;let a=this.spsConfig.tier_flag,o=this.spsConfig.level_idc;this.hevcCodec="hvc1."+["","A","B","C"][e%4]+s.toString()+"."+r.toString(16).toLowerCase()+"."+["L","H"][a%2]+o.toString(),this.width==this.spsConfig.width&&this.height==this.spsConfig.height||this.mse.updateAVCConfig&&this.mse.updateAVCConfig({width:this.spsConfig.width,height:this.spsConfig.height}),this.width=i.width=this.spsConfig.width,this.height=i.height=this.spsConfig.height,this.mse.setAvcCfg(this.width,this.height)}break;case Qr.HEVC_NAL_PPS:l=!0,c=!0,i.pps||(i.pps=[t.data]);break;case 19:case 20:l=!0,c=!0,h=!0,i.idr=!0;break;case Qr.HEVC_NAL_AUD:l=!1,c=!0;break;case 39:case 40:l=!0,c=!0,(this.ignoreSei||1==f.a._noSei)&&(l=!1);break;case 0:case 1:case 12:l=!0,c=!0;break;default:l=!1,u+="unknown NAL "+t.type+" "}l&&(a.push(t),o+=t.data.byteLength)}if(u.length,i.idr&&(this.hasIDR=!0,this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_IFRAME,1)),i.codec&&this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.dropBeforeFirstIDR&&!this.hasIDR)return void n.a.warn("TsParser._parseAVCPES no idr found, drop video frame!ts=".concat(t.dts/90," dts=").concat(t.dts," pts=").concat(t.pts));if(a.length&&(!0===h||i.sps)){if(e={type:"hvc",units:a,dts:t.dts,pts:t.pts,key:h,ts:t.dts/90,cts:(t.pts-t.dts)/90,videoCodec:this.hevcCodec,videoWidth:this.width,videoHeight:this.height},h&&(e.ppsUnit=[{length:i.pps[0].length,nalu:i.pps[0]}],e.spsUnit=[{length:i.sps[0].length,nalu:i.sps[0]}],e.vpsUnit=[{length:i.vps[0].length,nalu:i.vps[0]}]),s.push(e),i.len+=o,i.naluCnt+=a.length,this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkVideoDts(e.dts),1==f.a._printVideoTs){const e=parseInt(t.dts-90*this.mse.curVideoDts),i=parseInt((t.pts-qr.initPts)/90);n.a.debug("%cTsParser.parseAvcPes ts=".concat(t.dts/90," dts=").concat(t.dts," pts=").concat(t.pts," cts=").concat(t.pts-t.dts," gap=").concat(e," timeoffset=").concat(i),"color:green")}this.mse&&(this.mse.curVideoDts=t.dts/90,this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_FRAME,1)),this.vFps.addDts(t.dts/90)}}else{for(let t of r){switch(t.type){case 1:if(!this.convertToIDR&&this.openConvertIDR){this.convertToIDR=!0,h=!0,i.idr=!0;let e=t.data[0];const s=129&t.data[0];t.data[0]=10|s,t.type=5,n.a.log("TsParser._parseAVCPES convert NDR to IDR, type=1 -> 5, data=".concat(e," -> ").concat(t.data[0]))}l=!0,c=!0;break;case 5:this.convertToIDR=!0,l=!0,c=!0,h=!0,i.idr=!0;break;case 6:l=!0,c=!0,(this.ignoreSei||1==f.a._noSei)&&(l=!1);break;case 7:if(l=!0,c=!0,!i.sps){i.sps=[t.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration;var p=new Dt(t.data).readSPS();this.width==p.width&&this.height==p.height||this.mse.updateAVCConfig&&this.mse.updateAVCConfig({width:p.width,height:p.height}),this.width=i.width=p.width,this.height=i.height=p.height,this.mse.setAvcCfg(this.width,this.height);for(var m=t.data.subarray(1,4),_="avc1.",g=0;g<3;g++){var S=m[g].toString(16);S.length<2&&(S="0"+S),_+=S}i.codec=_,this.avcCodec=_}break;case 8:l=!0,c=!0,i.pps||(i.pps=[t.data]);break;case 9:l=!0,c=!0,1!=f.a._noAud&&this.mse.getCodecType()!=N.a.PLAYER_CORE_TYPE.WEBCODECS||(l=!1);break;case 12:l=!0,c=!0;break;default:l=!1,u+="unknown NAL "+t.type+" "}l&&(a.push(t),o+=t.data.byteLength)}if(u.length,i.idr&&(this.hasIDR=!0,this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_IFRAME,1)),i.codec&&this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.dropBeforeFirstIDR&&!this.hasIDR)return void n.a.warn("TsParser._parseAVCPES no idr found, drop video frame!ts=".concat(t.dts/90," dts=").concat(t.dts," pts=").concat(t.pts));if(i.sps&&i.pps&&!i.idr)return;if(a.length&&c){const r=t.dts/90;if(e={type:"avc",units:a,dts:t.dts,pts:t.pts,key:h,ts:r,cts:(t.pts-t.dts)/90,videoCodec:this.avcCodec,videoWidth:this.width,videoHeight:this.height},this.lastTs=r,h&&(e.ppsUnit=[{length:i.pps[0].length,nalu:i.pps[0]}],e.spsUnit=[{length:i.sps[0].length,nalu:i.sps[0]}]),s.push(e),i.len+=o,i.naluCnt+=a.length,this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkVideoDts(e.dts),1==f.a._printVideoTs){const e=parseInt(t.dts-90*this.mse.curVideoDts),i=parseInt((t.pts-qr.initPts)/90);n.a.debug("%cTsParser.parseAvcPes ts=".concat(t.dts/90," dts=").concat(t.dts," pts=").concat(t.pts," cts=").concat(t.pts-t.dts," gap=").concat(e," timeoffset=").concat(i),"color:green")}this.mse&&(this.mse.curVideoDts=t.dts/90,this.mse.setExceptionStat(d.a.DIM_LINK_STA.VIDEO_FRAME,1)),this.vFps.addDts(t.dts/90)}}}_parseAVCNALu(t){for(var e,i,s,r,a,o,n=0,h=t.byteLength,d=0,l=[];n<h;)switch(e=t[n++],d){case 0:0===e&&(d=1);break;case 1:d=0===e?2:0;break;case 2:case 3:0===e?d=3:1===e?(r=this.isHevc?(126&t[n])>>1:31&t[n],a?(s={data:t.subarray(a,n-d-1),type:o},l.push(s)):(i=n-d-1)&&this._pushToPreUnit(t.subarray(0,i)),n<h?(a=n,o=r,d=0):d=-1):d=0}return a&&(s={data:t.subarray(a,h),type:o},l.push(s)),l}_pushToPreUnit(t){var e=this._avcTrack.samples.length;if(0!=e){var i=this._avcTrack.samples[e-1],s=i.units[i.units.length-1],r=new Uint8Array(s.data.byteLength+t.byteLength);r.set(s.data,0),r.set(t,s.data.byteLength),s.data=r,this._avcTrack.len+=t.byteLength}}_parseAACPES(t){if(null==t)return n.a.error("TsParser._parseAACPES pes is null."),void(this.mse&&this.mse.onParseError(zr));if(this.dropBeforeFirstIDR&&!this.hasIDR)return void n.a.warn("TsParser._parseAACPES no idr found, drop audio frame!ts=".concat(t.dts/90," dts=").concat(t.dts," pts=").concat(t.pts));var e,i,s,r,a,o,h,l,c=this._aacTrack,u=t.data,p=u.length,m=0;if(this.aacOverFlow){var _=new Uint8Array(this.aacOverFlow.byteLength+u.byteLength);_.set(this.aacOverFlow,0),_.set(u,this.aacOverFlow.byteLength),u=_,this.aacOverFlow=null}for(i=0;i<p-1&&(255!==u[i]||240!=(240&u[i+1]));i++);if(i&&(i<p-1?(h="AAC PES did not start with ADTS header, offset:".concat(i),l=!1):(h="no ADTS header found in AAC PES",l=!0),n.a.error("TsParser._parseAACPES ERROR:".concat(h)),l))return void(this.mse&&this.mse.onParseError(zr));const g=t=>{c.config=t.config,c.audiosamplerate=t.samplerate,c.channelCount=t.channelCount,c.audioObjectType=t.audioObjectType,c.codec=t.codec,c.timescale=this.remuxer.timescale,c.duration=this.remuxer.timescale*this.duration,this.mse&&this.mse.setExceptionStat(d.a.DIM_LINK_STA.AUDIO_CONFIG,1),n.a.log("TsParser._parseAACPES parsed codec:".concat(c.codec,",rate:").concat(t.samplerate,",nb channel:").concat(t.channelCount));const e=1024e3/t.samplerate;this.mse.updateAudioConfig({audioConfig:t,codec:"mp4a.40.5",audioSampleRate:t.samplerate,aacTimeLen:e,audioObjectType:t.adtsObjectType,audioChannelCount:t.channelCount},!1)};if(this.mse&&this.mse.isLive)c.audiosamplerate||g(this._ADTStoAudioConfig(u,i,this.audioCodec));else{const t=this._ADTStoAudioConfig(u,i,this.audioCodec);c.audiosamplerate?c.audiosamplerate!==t.samplerate&&this.mse&&this.mse.onParseError(Jr):g(t)}for(;i+5<p;){if(s=1&u[i+1]?7:9,r=(3&u[i+3])<<11,r|=u[i+4]<<3,r|=(224&u[i+5])>>>5,(r-=s)<0)return n.a.error("TsParser._parseAACPES adtsFrameSize:".concat(r,", adtsStartOffset:").concat(i,", len:").concat(p)),void(this.mse&&this.mse.onParseError(zr));if(0!=r){if(!((a=i+s)+r<=p))break;for(o=Math.round(t.pts+1024*m*this.PES_TIMESCALE/c.audiosamplerate),e={unit:u.subarray(a,a+r),pts:o,dts:o,ts:o/90},!this.mse.isLive&&qr.ptsJumpTest&&this._dtsJumpSimulate(e,"audio"),c.samples.push(e),c.len+=r,i+=s+r,m++;i<p-1&&(255!==u[i]||240!=(240&u[i+1]));i++);if(this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkAudioDts(e.dts),1==f.a._printAudioTs){const t=parseInt(e.dts-90*this.mse.curAudioDts),i=parseInt((e.dts-qr.initPts)/90);n.a.debug("%cTsParser.parseAacPes dts=".concat(e.dts," pts=").concat(e.dts," cts=").concat(e.dts-e.dts," gap=").concat(t," timeoffset=").concat(i),"color:red")}this.mse&&(this.mse.curAudioDts=e.dts/90,this.mse.setExceptionStat(d.a.DIM_LINK_STA.AUDIO_FRAME,1)),this.aFps.addDts(o/90)}else i+=s}i<p&&(this.aacOverFlow=u.subarray(i,p))}_ADTStoAudioConfig(t,e,i){var s=Qr.AdtsSampleingRates,r=1+((192&t[e+2])>>>6),a=r,o=(60&t[e+2])>>>2;if(o>s.length-1)return n.a.error("TsParser._ADTStoAudioConfig ERROR:invalid ADTS sampling index:".concat(o)),void(this.mse&&this.mse.onParseError(zr));var h,d,l=(1&t[e+2])<<2|(192&t[e+3])>>>6,c=navigator.userAgent.toLowerCase();return-1!==c.indexOf("firefox")?o>=6?(r=5,d=new Array(4),h=o-3):(r=2,d=new Array(2),h=o):-1!==c.indexOf("android")?-1!==c.indexOf("mqqbrowser")?(r=2,d=new Array(2),h=o):(r=5,d=new Array(4),h=o):(r=5,d=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&o>=6?h=o-3:(i&&-1!==i.indexOf("mp4a.40.2")&&(o>=6||1===l)&&(r=2,d=new Array(2)),h=o)),d[0]=r<<3,d[0]|=(14&o)>>1,d[1]|=(1&o)<<7,d[1]|=l<<3,5===r&&(d[1]|=(14&h)>>1,d[2]=(1&h)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:s[o],channelCount:l,audioObjectType:a,adtsObjectType:r,codec:"mp4a.40."+r}}_parseID3PES(t){this._id3Track.samples.push(t)}_dtsJumpSimulate(t,e){if(!qr.jumpConfig){try{const t=JSON.parse(f.a.jumpConfig);if(!t.jumpTime||!t.jumpPts)throw new Error("jumpConfig jumpTime is empty or jumpPts is empty");qr.jumpConfig=t}catch(t){return qr.ptsJumpTest=!1,f.a.removeItem("ptsJumpTest"),void n.a.error("jumpConfig error",t&&t.message)}n.a.log("%cjump time=".concat(qr.jumpConfig.jumpTime," jumpPts=").concat(qr.jumpConfig.jumpPts),"color:#A23400;background:#FFF5C2")}if(t){let i=Math.ceil((t.dts-qr.initPts)/9e4);if("video"===e?(i<qr.videoTimeOffset&&(i=qr.videoTimeOffset),qr.videoTimeOffset=i):(i<qr.audioTimeOffset&&(i=qr.audioTimeOffset),qr.audioTimeOffset=i),i<Number(qr.jumpConfig.jumpTime))return;const s=Number(qr.jumpConfig.jumpPts);t.dts+=s,t.pts+=s}}}Qr.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Qr.HEVC_NAL_VPS=32,Qr.HEVC_NAL_SPS=33,Qr.HEVC_NAL_PPS=34,Qr.HEVC_NAL_AUD=35;var Xr=Qr;class $r{constructor(t,e,i){this.video=t,this.callbacks=i,this.destroyed=!1,this.isSupportRVCB=!1,this.callBackId=0,this.started=!1,this.requestVideoFrameCallbackBind=this.requestVideoFrameCallback.bind(this),"safari"!==h.a.name&&t&&t.requestVideoFrameCallback&&!e&&(this.isSupportRVCB=!0)}start(){this.started||(this.started=!0,this.isSupportRVCB?this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind):(this._lastPlayTime=0,X.add(this._checkRender,this,100)))}requestVideoFrameCallback(){!this.destroyed&&this.started&&this.video&&(this.callbacks&&this.callbacks.renderCallback($r.Types.FRAME),this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind))}_checkRender(t){if(this.video){let t=this.video.currentTime;this._lastPlayTime!==t&&(this._lastPlayTime=t,this.callbacks&&this.callbacks.renderCallback($r.Types.TIMER))}}stop(){n.a.log("VideoChecker.stop"),this.started=!1,this.callBackId=0,X.remove(this._checkRender,this)}destroy(){n.a.log("VideoChecker.destroy"),this.isSupportRVCB&&this.video&&this.video.cancelVideoFrameCallback(this.callBackId),this.destroyed=!0,this.video=null,this.callBackId=0,this.callbacks=null,X.remove(this._checkRender,this)}}$r.Types={FRAME:"Frame",TIMER:"Timer"};var Zr=$r;class ta{constructor(t,e,i){this.video=t,this.audioSource=e,this.analyser=i}destroy(){this.audioSource.disconnect(),this.analyser.disconnect(),this.video=null,this.audioSource=null,this.analyser=null}}var ea=new class{constructor(){const t=window.AudioContext||window.webkitAudioContext;t&&(this.audioCtx=new t),this.audioItemMap=new Map}getState(){return this.audioCtx&&this.audioCtx.state}getAnalyser(t){if(0===o.a.audioCtx||!this.audioCtx)return null;let e=this.audioItemMap.get(t);if(!e){let i=this.audioCtx.createMediaElementSource(t),s=this.audioCtx.createAnalyser();i.connect(s),s.connect(this.audioCtx.destination),e=new ta(t,i,s),this.audioItemMap.set(t,e)}return e.analyser}delAnalyser(t){let e=this.audioItemMap.get(t);e&&(e.destroy(),this.audioItemMap.delete(t))}resume(){this.audioCtx&&"running"!==this.audioCtx.state&&this.audioCtx.resume().catch(t=>{n.a.log("AudioContextUtils.resume error=".concat(t.message))})}},ia=class{constructor(t){this._handler=t,this._cnt=0,this._duration=0,this._pauseTs=0,this._aiCnt=0,this._aiDuration=0,this._aiAutoCnt=0,this._aiAutoDuration=0,this._videoBlockBufferList=[],this._videoBlockContinueList=[],this._blockBadDurationList=[],this._blockBadContinueBufferList=[],this._autoReportProps=null}destroy(){this._handler=null,this._videoBlockBufferList=null,this._videoBlockContinueList=null,this._blockBadDurationList=null,this._blockBadContinueBufferList=null}reset(){this.resetStat(),this.resetAiStat(),this.resetAutoAiStat(),this._pauseTs=0,this._autoReportProps=null}getCnt(){return this._cnt}resetStat(){this._cnt=0,this._duration=0,this._videoBlockBufferList.length=0,this._videoBlockContinueList.length=0}pause(){0===this._pauseTs&&(this._pauseTs=_.a.now()),this.getAutoReportProps(),this._handler&&(this._videoBlockBufferList.push(this._handler.getBufferLen()),this._videoBlockContinueList.push(this._handler.getVideoContinueBuffer()))}resume(){this.calc(!0)}calc(t){if(this._pauseTs>0){let e=_.a.now(),i=e-this._pauseTs;i>=200&&(this._cnt++,this._aiCnt++,this._aiAutoCnt++,this._duration+=i,this._aiDuration+=i,this._aiAutoDuration+=i,this._blockBadDurationList.push(i),this._blockBadContinueBufferList.push(this._handler.getBufferLen())),i>=o.a.blockBadCfg[0]&&this.setBlockBad(i),t?this._pauseTs=0:(this._pauseTs=e,this.getAutoReportProps())}}resetAiStat(){this._aiCnt=0,this._aiDuration=0}resetAutoAiStat(){this._aiAutoCnt=0,this._aiAutoDuration=0,this._blockBadDurationList.length=0,this._blockBadContinueBufferList.length=0}getAiStat(){let t={aiCnt:this._aiCnt,aiDuration:this._aiDuration};return this.resetAiStat(),t}getAiAutoStat(){let t={aiAutoCnt:this._aiAutoCnt,aiAutoDuration:this._aiAutoDuration,aiAutoBlockBadDurationList:[...this._blockBadDurationList],aiAutoBlockBadContinueBufferList:[...this._blockBadContinueBufferList]};return this.resetAutoAiStat(),t}record(t){this.calc(!1),t.setCore(d.a.CORE.VIDEO_BLOCK_COUNT,this._cnt),t.setCore(d.a.CORE.VIDEO_BLOCK_DURATION,this._duration),this.performanceCalc(t),this.resetStat()}performanceCalc(t){let e=o.a.perfBlockCfg[0],i=0,s=0;this._videoBlockBufferList.map((t,r)=>{let a=this._videoBlockContinueList[r];t>e?(a>e&&s++,i++):a>o.a.perfBlockCfg[1]&&(i++,s++)}),n.a.log("PauseStat.performanceCalc, continueBufferCnt=".concat(s,",bufferCnt=").concat(i,",perfBlockCnt=").concat(this._handler.perfBlockCnt)),this._handler.perfBlockCnt>0&&(s+=this._handler.perfBlockCnt,i+=this._handler.perfBlockCnt),t.setCore(d.a.CORE.VIDEO_PERFPAUSE_CONTINUE_CNT,s),t.setCore(d.a.CORE.VIDEO_PERFPAUSE_CNT,i),this._handler.resetPerfBlockCnt()}recordSam(t){let e=t.length,i=[];if(e>0){i.push("size:".concat(e));for(let s=0;s<e;s++)i.push("k".concat(e-s,":").concat(t[s]))}return i.join(",")}getAutoReportProps(){this._handler.handler&&this._handler.handler.getAutoProps&&(this._autoReportProps=this._handler.handler.getAutoProps())}setBlockBad(t){let e=Math.floor(100*o.a.blockBadCfg[1]);if(Math.floor(100*Math.random())>e)return;let i=this._handler.handler._hyPlayer.stat,s=this._handler.handler._hyPlayer.tsdbUtil;const r=this._autoReportProps;if(!r)return;let a=[t],h=["",r.videoBuffers,"",r.blockDurationSample,r.continueBufferSample,r.realKbpsSample,"",r.recvFps],l=i.createAct(d.a.ACT.BLOCK_BAD,{value:a,str:h});n.a.log("PauseStat.setBlockBad getAutoProps metric=",l),s.sendMetrics([l])}};const sa=[95,112,101,114,102];var ra=class{constructor(){this.bitrate=4e3,this.blockCount=1,this.continueBuffer=2e3,this.map=new Map,this.key="",this._initKey(),this._initLocal()}destroy(){this.map&&this.map.clear(),this.map=null}_initKey(){for(let t=0;t<sa.length;t++)this.key+=String.fromCharCode(sa[t])}setConfig(t){this.bitrate=t.perfBitrate||4e3,this.blockCount=t.perfCnt||1,this.continueBuffer=t.perfBuf||2e3}_initLocal(){if(f.a.hasOwnProperty(this.key)){let t=f.a[this.key].split(","),e="",i=!0;for(let s=0;s<t.length;s++){let r=Number(t[s]);if(isNaN(r)){i=!1;break}e+=String.fromCharCode(Number(t[s]))}i&&e.length>0&&this._parseLocal(e)}}_parseLocal(t){let e=t.split("|");for(let t=0;t<e.length;t++){let i=e[t].split(":"),s=Number(i[0]),r=i[1].split(",");this.map.set(s,r)}}checkLocal(t,e){if(t=Number(t),this.map.has(t)){let i=this.map.get(t);return this._hasBitrate(i,e)}return!1}checkLive(t,e,i,s){if(t=Number(t),e>=this.bitrate&&i>this.blockCount&&s>this.continueBuffer){let i=this.map.get(t);if(i||(i=[],this.map.set(t,i)),!this._hasBitrate(i,e))return i.push(e),this._saveMap(),n.a.log("PausePerformance.checkLive pid=".concat(t," bitrate=").concat(e)),!0}return!1}_hasBitrate(t,e){for(let i=0;i<t.length;i++)if(Number(e)===Number(t[i]))return!0;return!1}_saveMap(){let t=[];for(let[e,i]of this.map.entries())t.push(e+":"+i.join(","));if(t.length>0){let e=t.join("|"),i=[];for(let t=0;t<e.length;t++)i.push(e.charCodeAt(t));f.a[this.key]=i.join(",")}}};class aa{constructor(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}reset(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}setStartFrameId(t){this._startFrameId=t,this._lastFrameId=this._frameId}getFrameId(t,e){return 0===t?(this._frameId++,e>0&&this._frameId++):(e>0&&this._lastFrameId++,this._frameId=this._lastFrameId+(t-this._startFrameId+1)),this._frameId}}var oa=class{constructor(){this._mse=null,this._list=[],this._dtsList=[],this._tsList=[],this._currentBuffered=null,this._continueBuffer=-1,this._lastFrameTs=0,this._startTs=0,this._started=!1,this._lastRemoveTs=0,this._deltaStart=Number(o.a.continueBufferDeltaStart)||6e3,this._deltaEnd=Number(o.a.continueBufferDeltaEnd)||3e3,this._localFrameId=new aa,this._printContinueBuffer=1==f.a._printContinueBuffer}destroy(){n.a.log("VideoBufferedList.destroy"),X.remove(this.onCheckFastTimer,this),this._list=null,this._dtsList=null,this._tsList=null,this._mse=null}get continueBuffer(){return this._continueBuffer}set continueBuffer(t){this._continueBuffer=t}setMse(t){this._mse=t}stop(){n.a.log("VideoBufferedList.stop"),this._startTs=0,this._list.length=0,this._dtsList.length=0,this._continueBuffer=-1,this._currentBuffered=null,this._localFrameId.reset(),X.remove(this.onCheckFastTimer,this)}printInfo(t){let e=[];this._list.forEach(t=>{e.push("[".concat(t.startDts,", ").concat(t.endDts,"]"))}),n.a.log("VideoBufferedList.print dts=".concat(t," buffered=").concat(e.join(" ")))}record(t){this._calc(_.a.now(),Hs),t.setCore(d.a.CORE.VIDEO_CONTINUE_BUFFER,this.getVideoContinueBuffer()),this._continueBuffer=-1}start(){0===this._startTs&&(n.a.log("VideoBufferList.start"),this._startTs=_.a.now(),X.add(this.onCheckFastTimer,this,50))}onCheckFastTimer(t){if(0===this._lastRemoveTs)this._lastRemoveTs=t;else if(this._lastRemoveTs>0&&t-this._lastRemoveTs>5e3){this._lastRemoveTs=t;let e=this._mse.getCurrentDts()-2e4;for(let t=this._dtsList.length-1;t>=0;t--)if(this._dtsList[t]<e){this._dtsList=this._dtsList.slice(t),this._tsList=this._tsList.slice(t);break}}let e=t-this._lastFrameTs;this._lastFrameTs>0&&e>100&&(this._calc(t,xs),this._lastFrameTs=t)}addSample(t,e,i,s){let r=_.a.now();this._tsList.push(r),this._dtsList.push(e),(0===this._lastFrameTs||i)&&this._localFrameId.setStartFrameId(t),this._lastFrameTs=r;let a=this._localFrameId.getFrameId(t,s);(!this._currentBuffered||this._currentBuffered.isDisconnectFrame(a))&&(this._currentBuffered=new class{constructor(){this.startDts=0,this.endDts=0,this.endFrameId=0}isDisconnectDts(t){return this.endDts>0&&t-this.endDts>200}isDisconnectFrame(t){return this.endFrameId>0&&t-this.endFrameId!=1}getContinueBuffer(t){return t>=this.startDts&&t<=this.endDts?this.endDts-t:0}addBuffer(t,e){0===this.startDts&&(this.startDts=e),this.endDts=e,this.endFrameId=t}},this._list.push(this._currentBuffered),this._list.length>10)&&e-this._list[0].endDts>3e5&&this._list.shift(),this._currentBuffered.addBuffer(a,e)}_calc(t,e){let i=t-this._deltaStart,s=t-this._deltaEnd;if((e===Hs||e===Ws)&&-1===this._continueBuffer)return this._continueBuffer=this._getContinueBuffer(this._mse.getCurrentDts()),void(this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" continueBuffer=".concat(this._continueBuffer," from=").concat(e," ")));if(0===this._startTs||i<this._startTs)return;let{startDts:r,endDts:a}=this._getDtsBound(i,s),o=Number.MAX_SAFE_INTEGER,n=this._dtsList.length;for(let t=0;t<n;t++){let e=this._dtsList[t];if(e>a)break;if(e>=r&&e<=a&&(o=Math.min(o,this._getContinueBuffer(e))),0===o)break}o===Number.MAX_SAFE_INTEGER&&(o=0),(-1===this._continueBuffer||this._continueBuffer>o)&&(this._continueBuffer=o,this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" now=".concat(t," startDts=").concat(r," endDts=").concat(a," continueBuffer=").concat(o," from=").concat(e)))}_getDtsBound(t,e){let i=this._tsList.length,s=Number.MAX_SAFE_INTEGER,r=0;for(let a=0;a<i;a++){let i=this._tsList[a];if(i>=t&&i<=e){let t=this._dtsList[a];t<s&&(s=t),t>r&&(r=t)}else if(i>e)break}return{startDts:s,endDts:r}}_getContinueBuffer(t){let e=0;for(let i=0;i<this._list.length&&(e=this._list[i].getContinueBuffer(t),0===e);i++);return e}getVideoContinueBuffer(){let t=0;if(this._mse&&this._mse.getCurrentDts){let e=this._mse.getCurrentDts();t=this._getContinueBuffer(e)}return t}};class na{constructor(){this.type=-1,this.sn=0,this.samples=[],this.playDts=-1,this.firstDts=-1e4,this.lastSampleDts=0,this.setPlayDtsCallback=null}getInfo(){return"size=".concat(this.samples.length,"=[").concat(this.samples.length>0?this.samples[0].ts:0,", ").concat(this.samples.length>0?this.samples[this.samples.length-1].ts:0,"]")}destroy(){this.samples=[]}clear(){this.samples.length>0&&n.a.log("BufferFrame.clear type=".concat(this.type," size=").concat(this.samples.length,"=[").concat(this.samples[0].ts,", ").concat(this.samples[this.samples.length-1].ts,"]")),this.samples=[],this.firstDts=-1e4,this.playDts=-1,this.lastSampleDts=0}addSample(t,e){if(this.lastSampleDts>0){let i=t.ts-this.lastSampleDts;(i>100||i<-100)&&n.a.warn("BufferFrame.addSample type=".concat(this.type," isShield=").concat(e," dis=").concat(i," lastDts=").concat(this.lastSampleDts," curDts=").concat(t.ts))}return this.lastSampleDts=t.ts,this.samples.push(t),this._setFirstDts(t.ts),t.ts-this.playDts}_setFirstDts(t){-1e4===this.firstDts&&(this.firstDts=t,this.playDts=t,this.setPlayDtsCallback&&this.setPlayDtsCallback())}_createTrack(t){return{type:t,id:t===na.TYPES.video?1:2,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0}}getTrack(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._createTrack(this.type),s=this._fillTrack(i,t,e);return s>0&&this.samples.splice(0,s),i.endDts>0&&(i.playDts=this.playDts,i.sn=this.sn,this.sn++),i}_fillTrack(t,e,i){return 0}_addTrack(t,e){t.samples.push(e),-1===t.startDts&&(t.startDts=e.ts),t.endDts=e.ts,e.av1Bytes&&(t.bytes=e.av1Bytes)}getBufferLen(){let t=this.samples.length;if(t>1){let e=this.samples[0];return this.samples[t-1].ts-e.ts}return 0}getSize(){return this.samples.length}removeExpireBuffer(t,e){this.samples=this.samples.filter(i=>{if(i.ts>=t-this.aacTimeLen)return i;1===Number(f.a._printAVTrack)&&e==Zt&&n.a.log("BufferFrame.removeExpireBuffer, sample.ts=".concat(i.ts,", videoDts=").concat(t))}),this.samples.length>0&&(this.playDts=this.samples[0].ts)}recoverBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length<=0||(this.playDts=t[0].ts,this.samples.splice(0,0,...t))}}na.TYPES={video:"video",audio:"audio"};var ha=na,da=class extends ha{constructor(){super(),this.type=ha.TYPES.video}_setFirstDts(t){-1e4===this.firstDts&&n.a.log("BufferFrameVideo._setFirstDts=".concat(t)),super._setFirstDts(t)}_fillTrack(t,e,i){let s=0,r=this.samples.length,a=this.playDts+e;for(let e=0;e<r;e++){let i=this.samples[e];if(i.ts>=a){t.endDts=i.ts;break}s++,this._addTrack(t,i)}return t.endDts>0&&(this.playDts=t.endDts),s}_addTrack(t,e){super._addTrack(t,e),t.naluCnt+=e.units.length,t.len+=e.len}},la=class extends ha{constructor(t,e){super(),this.shieldType=t,this.type=ha.TYPES.audio,this.needEmptyAudioFrame=!0,this.isPureAudio=!1,this.lastAacTs=0,this.webcodecType=e,this.webcodecsEmptyFrameInited=!1,this.audioObjectType=5,this.audioChannelCount=1,this.audioSampleRate=22050,this.aacTimeLen=1024e3/this.audioSampleRate,this.aacEmptyDuration=0,this.emptyDuration=0}resetAudioDts(){this.clear()}addSample(t,e){return this.webcodecType!=N.a.PLAYER_CORE_TYPE.WEBCODECS||this.webcodecsEmptyFrameInited||(this.webcodecsEmptyFrameInited=!0,Vr.setWebcodeccEmptyFrame(t.unit)),t.empty=0,super.addSample(t,e)}_setFirstDts(t){-1e4===this.firstDts&&n.a.log("BufferFrameAudio._setFirstDts=".concat(t)),this.playDts>0&&-1e4===this.firstDts&&t>this.playDts&&t-this.playDts<this.aacTimeLen&&(n.a.log("BufferFrameAudio._setFirstDts resetPlayDts ".concat(this.playDts," to ").concat(t)),this.playDts=t),super._setFirstDts(t)}alignPlayDts(t){if(0===this.playDts)n.a.log("BufferFrameAudio.alignPlayDts videoPlayDts=".concat(t)),this.playDts=t;else if(t>this.playDts){let e=this.playDts;this.playDts=t;let i=0;for(;this.samples.length>0&&this.samples[0].ts<t;)i++,this.samples.shift();n.a.log("BufferFrameAudio.alignPlayDts audioPlayDts=".concat(e," to ").concat(t,", clear samples=").concat(i))}}_fillTrack(t,e,i){if(-1===this.playDts)return 0;let s=e,r=this.playDts+this.aacTimeLen,a=r,h=0,d=0,l=0,c=0,u=this.samples.length,p=0,m={startDts:0,endDts:0};for(;r<s;){let e=this.samples[h];if(p=Math.round(r),o.a.dtsJumpOpen&&e){let t=p-e.ts;if(t<0&&(t=-t),t>o.a.dtsJumpThreshold){r=e.ts;break}}if(e&&e.ts<=p)0===m.startDts&&(m.startDts=e.ts),m.endDts=e.ts,h++,c++,this._addTrack(t,e),this._recordEmptyDuration(l),l=0;else if(!this.isPureAudio&&this.needEmptyAudioFrame){if(d++,1==o.a.isAudioEmptyLimit&&d>=200)break;let e={unit:null,pts:0,dts:0,ts:0,empty:1};if(this.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS&&null!=Vr.webcodeccEmptyFrame?e.unit=new Uint8Array(Vr.webcodeccEmptyFrame):22050===this.audioSampleRate&&2===this.audioObjectType?e.unit=new Uint8Array(Vr.emptyAacFrame):e.unit=Vr.getSilentFrame(this.audioObjectType,this.audioChannelCount),this._fixDts(e,p),this.aacEmptyDuration+=this.aacTimeLen,l+=this.aacTimeLen,1==f.a._noEmptyFrame)continue;this._addTrack(t,e)}if(!i&&u>1&&h>=u||r+this.aacTimeLen>=s)break;r+=this.aacTimeLen}return this._recordEmptyDuration(l),t.emptyFrames=d,this.playDts=r,d>0&&n.a.log("BufferFrameAudio add empty frames ".concat(d,", objectType=").concat(this.audioObjectType," channelCount=").concat(this.audioChannelCount," shieldType=").concat(this.shieldType," playDts=").concat(this.playDts," sampleTs=").concat(this.samples[h-1]?this.samples[h-1].ts:0," pick=[").concat(m.startDts,",").concat(m.endDts,"] play=[").concat(a,", ").concat(s,"]")),c}_recordEmptyDuration(t){t>=o.a.audioEmptyDur&&(this.emptyDuration+=t)}hasPushBuffer(t){return!(t-this.playDts>o.a.shieldAudioCfg[4])}_fixDts(t,e){t.pts=t.dts=90*e,t.ts=e}_addTrack(t,e){e.unit&&(super._addTrack(t,e),t.len+=e.unit.length)}getEmptyeDuration(){const t=this.aacEmptyDuration;return this.aacEmptyDuration=0,t}getEmptyDurationHeart(){const t=this.emptyDuration;return this.emptyDuration=0,Math.floor(t)}};class ca{constructor(t,e,i){this.popSize=t.bufferSize+t.popDuration,this.waitSize=t.waitSize||2e3,this.popDuration=t.popDuration,this.timescale=t.timescale,this.isPureAudio=t.isPureAudio,this.isPureVideo=t.isPureVideo,this.webcodecType=t.webcodecType,this.remuxCb=e,this.ctrlBuffer=i,this.popMode=0,this.dtsChecker=new he,this.avcChange=!1,this.inited=!0,this.hasOriginIFrame=!1,this.hasRemux=!1,this.gop=o.a.maxGop,this.lastKeyFrameDts=0,this.paused=!1,this.switchedShieldAudio=!1,this.isShieldAudio=!1,this.isAShieldFirstPop=!1,this.shieldAudioWaitSize=200,this.startShieldTs=0,this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.isShieldFastToAlign=0,this.firstPrintVideo=!1,this.firstPrintAudio=!1,this.isSwitchShieldFailed=!1,this.videoConfig={isHevc:!1,vps:null,sps:null,pps:null,codec:"",width:0,height:0},this.audioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.shieldAudioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.vBuffer=new da,this.vBuffer.setPlayDtsCallback=this.setVideoPlayDts.bind(this),this.aBuffer=new la($t,this.webcodecType),this.aShieldBuffer=new la(Zt,this.webcodecType),this.aBuffer.isPureAudio=this.isPureAudio,this.aShieldBuffer.isPureAudio=this.isPureAudio,this._switchShieldTimeoutBind=this._switchShieldTimout.bind(this)}resetAudioDts(){this.aBuffer.resetAudioDts()}_updateGop(t){!t.key||this.hasOriginIFrame&&!t.origin_iframe||(this.lastKeyFrameDts>0&&(this.gop=Math.min(o.a.maxGop,t.ts-this.lastKeyFrameDts),1==f.a._printGop&&n.a.log("BufferAV._updateGop webcodecs",this.gop)),this.lastKeyFrameDts=t.ts)}updateVideoConfig(t,e){n.a.log("BufferAV.updateVideoConfig, oldAvcChange=".concat(this.avcChange," curAvcChange=").concat(e)),this.videoConfig=t,this.avcChange||(this.avcChange=e),this.firstPrintVideo=!1,this.firstPrintAudio=!1}updateAudioConfig(t,e,i){e==$t?(n.a.log("BufferAV.updateAudioConfig.common, first=".concat(i),JSON.stringify(t)),this.audioConfig=t,this.aBuffer.audioSampleRate=t.audiosamplerate,this.aBuffer.aacTimeLen=t.aacTimeLen,this.aBuffer.audioObjectType=t.audioObjectType,this.aBuffer.audioChannelCount=t.audioChannelCount):(e=Zt)&&(n.a.log("BufferAV.updateAudioConfig.shield, first=".concat(i),JSON.stringify(t)),this.shieldAudioConfig=t,this.aShieldBuffer.audioSampleRate=t.audiosamplerate,this.aShieldBuffer.aacTimeLen=t.aacTimeLen,this.aShieldBuffer.audioObjectType=t.audioObjectType,this.aShieldBuffer.audioChannelCount=t.audioChannelCount)}destroy(){this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.remuxCb=null,this.hasRemux=!1,this.switchedShieldAudio=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.vBuffer.destroy(),this.aBuffer.destroy(),this.aShieldBuffer.destroy(),X.remove(this._switchShieldTimeoutBind,this)}clearShieldAudio(){this.aShieldBuffer.clear(),this.switchedShieldAudio=!1}addSample(t){this.inited=!1,t.type===ca.TYPES.avc||t.type===ca.TYPES.av01?(this.dtsChecker.isVideoDtsDiffLarge(t.ts),this._addSampleVideo(t)):t.type===ca.TYPES.aac&&(this.dtsChecker.isAudioDtsDiffLarge(t.ts),this._addSmapleAudio(t))}switchShieldAudio(t){n.a.log("BufferAV.switchShieldAudio, yes=".concat(t)),this.isShieldAudio=t,t?(this.isStartShieldAudio=!1,this.startShieldTs=0,this.isFirstShieldAvc=!1,this.isFirstDelteShieldAac=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.isSwitchShieldFailed=!1,X.once(this._switchShieldTimeoutBind,this,o.a.shieldAudioCfg[2])):(X.remove(this._switchShieldTimeoutBind,this),this.switchedShieldAudio&&this.clearShieldAudio())}_switchShieldTimout(){this._switchShieldAudioFailed(te);const t=this.aShieldBuffer.samples.length,e=this.vBuffer.samples.length;n.a.warn("BufferAv._switchShieldTimout, shieldBuffelen=".concat(t,", vBufferLen=").concat(e,", firstVideoTs=").concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs)),t>0&&n.a.warn("BufferAv._switchShieldTimout, aStart=".concat(this.aShieldBuffer.samples[0].ts,", aEnd=").concat(this.aShieldBuffer.samples[t-1].ts)),e>0&&n.a.warn("BufferAv._switchShieldTimout, vStart=".concat(this.vBuffer.samples[0].ts,", vEnd=").concat(this.vBuffer.samples[e-1].ts))}_getFirstShieldAVDelta(){let t=this.firstVideoTs,e=this.firstShieldAudioTs,i=0;return 0!=t&&0!=this.firstAudioTs&&(i=t-e),i}_switchShieldAudioFailed(t){n.a.warn("BufferAv._switchShieldAudioFailed switch shield audio failed, reason=".concat(t,", firstVideoTs=").concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs)),this.isSwitchShieldFailed=!0,this.switchedShieldAudio&&this.clearShieldAudio();const e=Math.abs(this._getFirstShieldAVDelta());this.ctrlBuffer.onSwitchShieldAudioFail(t,e)}_switchShieldAudioSuc(){if(this.isSwitchShieldFailed)return;n.a.log("BufferAv._switchShieldAudioSuc switch shield audio successfully, firstVideoTs=".concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs));const t=this._getFirstShieldAVDelta();this.ctrlBuffer.onSwitchShieldAudioSuc(t)}_shieldAuidoMute(t,e){this.ctrlBuffer.shieldAuidoMute(t,e)}_setShieldBuffer(t){if(!this.isFirstShieldAvc){n.a.log("BufferAv.popBuffer.firstShieldBuffer.length",this.aShieldBuffer.samples&&this.aShieldBuffer.samples.length),this.isFirstShieldAvc=!0;let e=this.aShieldBuffer.samples[0].ts,i=t,s=t-e;if(n.a.log("BufferAv.popBuffer.shield.firstDts avcFirstTs=".concat(i," aacFirstTs=").concat(e," delta=").concat(t-e)),s<0&&s>-o.a.shieldAudioCfg[3])return this._switchShieldAudioSuc(),this.switchedShieldAudio=!0,!0;if(s<-o.a.shieldAudioCfg[3])return n.a.log("BufferAv.popBuffer.shield audio to fast"),this._switchShieldAudioFailed(ee),!1}return!0}_addSampleVideo(t){0==this.firstVideoTs&&(this.firstVideoTs=t.ts),this.firstPrintVideo||(this.firstPrintVideo=!0,n.a.log("BufferAv.addSampleVideo firstPrint dts=".concat(t.ts," isKey=").concat(t.key))),t.key&&t.origin_iframe&&!this.hasOriginIFrame&&(n.a.log("BufferAv.addSampleVideo find origin_iframe! isIframe=".concat(t.key)),this.hasOriginIFrame=!0),!t.key&&t.origin_iframe&&n.a.warn("BufferAv.addSampleVideo find origin_iframe sei not in iframe"),this._updateGop(t);let e=this.vBuffer.addSample(t,!1);if(this.isShieldAudio){const t=this.vBuffer.samples.length;0!=this.firstAudioTs&&0!=this.firstVideoTs&&this.firstVideoTs-this.firstAudioTs>=o.a.shieldAudioCfg[4]&&this._switchShieldAudioFailed(ie),!this.isFirstDelteShieldAac&&t>0&&this.aShieldBuffer.removeExpireBuffer(this.vBuffer.samples[0].ts,Zt);let i=this.aShieldBuffer.getBufferLen();!this.paused&&e>=this.popSize&&i>=this.popSize&&(this.popBuffer(this.popDuration),this.isFirstDelteShieldAac=!0)}else!this.paused&&e>this.popSize&&(0===this.popMode?this.aBuffer.getBufferLen()>this.popSize?this.popBuffer(this.popDuration):e>this.waitSize&&(this.popBuffer(this.waitSize),t.ts-this.firstVideoTs>1e4&&0===this.aBuffer.firstDts&&(this.popMode=1)):1===this.popMode&&this.popBuffer(this.popDuration))}setVideoPlayDts(){this.aBuffer.alignPlayDts(this.vBuffer.playDts)}_addSmapleAudio(t){0==this.firstAudioTs&&(this.firstAudioTs=t.ts),this.firstPrintAudio||(this.firstPrintAudio=!0,n.a.log("BufferAv._addSmapleAudio firstPrint dts=".concat(t.ts)));let e=this.aBuffer.addSample(t,!1);this.isShieldAudio||!this.isShieldAudio&&!this.paused&&this.isPureAudio&&e>this.popSize&&this.popBuffer(this.popDuration)}addShieldAudioSample(t){0==this.firstShieldAudioTs&&(this.firstShieldAudioTs=t.ts);const e=this.aShieldBuffer.addSample(t,!0);this.isShieldAudio&&!this.paused&&this.isPureAudio&&e>this.popSize&&this.popBuffer(this.popDuration)}getShieldWait(){if(this.isShieldAudio){const t=this.aShieldBuffer.getSize();if(t<=0)return!1;let e=this.aShieldBuffer.samples[0].ts,i=this.aShieldBuffer.samples[t-1].ts;if(!this.isAShieldFirstPop){if(i-e<o.a.shieldAudioCfg[5])return n.a.log("BufferAv.popBuffer.waitShield",i-e),!1;n.a.log("BufferAv.popBuffer.waitShield success",i-e),this.isAShieldFirstPop=!0}}return!0}popBuffer(t){let e=0,i=0;if(this.isStartShieldAudio||(this.startShieldTs=_.a.now(),this.isStartShieldAudio=!0),!this.getShieldWait())return;0!=this.startShieldTs&&(e=_.a.now()-this.startShieldTs);let s=null,r=null,a=!1;r=this.vBuffer.getTrack(t),r.timescale=this.timescale,r.duration=Math.round((r.endDts-r.startDts)*(this.timescale/1e3));const h=0==r.sn;r&&(h||this.avcChange)&&(this.avcChange=!1,Object.assign(r,this.videoConfig),n.a.log("BufferAV.popBuffer avcChange cur=".concat(JSON.stringify(this.videoConfig))));let d=this.dtsChecker.isSync(),l=this.isPureAudio?this.aBuffer.playDts+t:r.endDts;if(d||(l=this.aBuffer.playDts+this.aBuffer.getBufferLen()),this.isShieldAudio){let t=this._setShieldBuffer(this.vBuffer.firstDts),e=this.firstVideoTs,i=this.firstShieldAudioTs,h=e-i;if(t)if(h<0&&h>-o.a.shieldAudioCfg[3]&&!this.isShieldFastToAlign)if(l<=i+this.popSize)s=this.aBuffer.getTrack(l),a=!1;else{const t=this.aShieldBuffer.samples[0].ts;this.aShieldBuffer.removeExpireBuffer(r.startDts,Zt),this.aShieldBuffer.samples.length>0&&n.a.log("BufferAv.popBuffer.shield to align, aRemoveShieldFirstTs=".concat(t,", vshieldAlignTs=").concat(r.startDts,",ashieldAlignTs=").concat(this.aShieldBuffer.samples[0].ts,", removeDelta=").concat(this.aShieldBuffer.samples[0].ts-t)),s=this.aShieldBuffer.getTrack(l),a=!0,this.aBuffer.removeExpireBuffer(l,$t),this.isShieldFastToAlign=!0}else this.isSwitchShieldFailed?(s=this.aBuffer.getTrack(l),a=!1):this.switchedShieldAudio?(a=!0,s=this.aShieldBuffer.getTrack(l),this.aBuffer.removeExpireBuffer(l,$t)):(this.switchedShieldAudio=!0,this.aShieldBuffer.removeExpireBuffer(r.startDts,Zt),this.aShieldBuffer.hasPushBuffer(l)?(s=this.aShieldBuffer.getTrack(l),a=!0,this.aBuffer.removeExpireBuffer(l,$t),this._switchShieldAudioSuc()):0==this.aShieldBuffer.playDts?n.a.log("BufferAv.popBuffer.shield audio curDts=".concat(this.aShieldBuffer.playDts,", dts = 0, switch failed")):(this._switchShieldAudioFailed(ie),n.a.warn("BufferAv.popBuffer.shield audio curDts=".concat(this.aShieldBuffer.playDts," far less than curDts=").concat(l,", delta = ").concat(l-this.aShieldBuffer.playDts,", switch failed")),s=this.aBuffer.getTrack(l)));else s=this.aBuffer.getTrack(l),a=!1;1===Number(f.a._printShield)&&n.a.log("BufferAv.popBuffer.shield: aac startDts=".concat(s.startDts," endDts=").concat(s.endDts," avc startDts=").concat(r.startDts," endDts=").concat(r.endDts),"gap:",r.endDts-s.endDts),X.remove(this._switchShieldTimeoutBind,this)}else a=!1,s=this.aBuffer.getTrack(l,t===Number.MAX_SAFE_INTEGER||t===this.waitSize),this.switchedShieldAudio&&this.clearShieldAudio();0!=this.startShieldTs&&(i=_.a.now()-this.startShieldTs,n.a.log("BufferAv.popBuffer.shield: waitTime1 = ".concat(e," waitTime2=").concat(i)),this.startShieldTs=0),a?(s.config=this.shieldAudioConfig.config,s.audiosamplerate=this.shieldAudioConfig.audiosamplerate,s.channelCount=this.shieldAudioConfig.channelCount,s.codec=this.shieldAudioConfig.codec):(s.config=this.audioConfig.config,s.audiosamplerate=this.audioConfig.audiosamplerate,s.channelCount=this.audioConfig.channelCount,s.codec=this.audioConfig.codec),s.isSync=d,s.timescale=this.timescale,s.duration=Math.round((s.endDts-s.startDts)*(this.timescale/1e3)),t===Number.MAX_SAFE_INTEGER&&n.a.log("BufferAV.popAllBuffer video=[".concat(r.startDts,", ").concat(r.endDts,"] audio=[").concat(s.startDts,", ").concat(s.endDts,"] audioNum=").concat(this.aBuffer.getSize()," audioEndDts=").concat(this.aBuffer.lastSampleDts)),1===Number(f.a._printAVTrack)&&n.a.log("BufferAV.popBuffer.shield vaStartDelta=".concat(r.startDts-s.startDts,",vaEndDelta=").concat(r.endDts-s.endDts,",avcDelta=").concat(r.endDts-r.startDts,",aacDelta=").concat(s.endDts-s.startDts,",avcStartDts= ").concat(r.startDts,",aacStartDts=").concat(s.startDts,",avcEndDts=").concat(r.endDts,",aacEndDts=").concat(s.endDts)),this.hasRemux=!0,this.remuxCb&&this.remuxCb(r,s)}clearBuffer(){this.vBuffer.clear(),this.aBuffer.clear(),this.aShieldBuffer.clear()}setNeedEmptyAudioFrame(t){this.aBuffer.needEmptyAudioFrame=t}getBufferLen(){return this.isPureAudio?this.aBuffer.getBufferLen():this.vBuffer.getBufferLen()}getSize(){return this.vBuffer.getSize()}}ca.TYPES={avc:"avc",av01:"av01",aac:"aac"};var ua=ca;let pa=0;var ma=class{constructor(t,e,i){this.config=t,this.remuxCb=e,this.mse=i,this.hasVideoConfig=!1,this.needEmptyAudioFrame=!0,this.timescale=9e4,this.hasFrame=!1,this.state=0,this.switchTs=new class{constructor(){this.list=[],this.switchIFrameDts=0,this.switchIFramePts=0,this.lastIFrameDts=0,this.lastIFRamePts=0}getDts(){return this.switchIFrameDts||this.lastIFrameDts}getPts(){return this.switchIFramePts||this.lastIFRamePts}setSwitchTs(t,e){this.switchIFrameDts=t,this.switchIFramePts=e}setLastTs(t,e){this.lastIFrameDts=t,this.lastIFRamePts=e}resetPtsSample(){this.list=[]}addPtsSample(t,e,i,s,r,a){this.list.push({dts:t,pts:e,dtsGap:i,ptsGap:s,hasOrigin:r,isOrigin:a})}getMetric(){let t=[0,0,0],e=[0,0];if(this.list.length>0){let i=this.list[0],s=this.list[this.list.length-1];t[0]=i.dtsGap,t[1]=i.ptsGap,t[2]=this.list.length,t[3]=0,t[4]=s.ptsGap,e[0]=s.hasOrigin?1:2,e[1]=s.isOrigin?1:2,e[2]=0}return{values:t,strs:e}}},this.avBuffer=this._createBuffer(),this.evalBw=null,this.callbacks=null,this._buffered=null,this.id=pa++,n.a.log("CtrlBuffer.constructor(".concat(this.id,")")),this._curFrameId=0,this.avcChangeTime=0}setCurFrameId(t){this._curFrameId=t}setBuffered(t){this._buffered=t}addBuffered(t,e,i){(t.type===ua.TYPES.avc||t.type===ua.TYPES.av01&&this._buffered)&&this._buffered.addSample(this._curFrameId,t.ts,e,i)}destroy(){this.remuxCb=null,this.callbacks=null,this._destroyBuffer()}_destroyBuffer(){this.avBuffer&&(this.avBuffer.destroy(),this.avBuffer=null)}_createBuffer(){this._destroyBuffer();let t=new ua(this.config,this.remuxCb,this);return t.timescale=this.timescale,t.setNeedEmptyAudioFrame(this.needEmptyAudioFrame),t}pause(){this.avBuffer.paused=!0}play(){this.avBuffer.paused=!1}isPaused(){return this.avBuffer.paused}isWaitForIFrame(){return 1===this.state}switchBitrate(t,e,i){n.a.log("CtrlBuffer(".concat(this.id,").switchBitrate isDown=").concat(t)),this._lastBitrate=e,this._curBitrate=i,this.state=1}switchBack(){n.a.log("CtrlBuffer(".concat(this.id,").switchBack switchIFramePts=").concat(this.switchTs.getDts()," lastIFramePts=").concat(this.switchTs.getPts())),this.state=2,this.avBuffer=this._createBuffer(),this.callbacks&&this.callbacks.start(this.switchTs.getDts(),this.switchTs.getPts())}switchShieldAudio(t){this.avBuffer&&this.avBuffer.switchShieldAudio&&this.avBuffer.switchShieldAudio(t)}setEval(t){this.evalBw=t}resetAudioDts(){this.avBuffer&&this.avBuffer.resetAudioDts()}addSample(t){if(!this.avBuffer)return;let e=t.key&&(!this.avBuffer.hasOriginIFrame||t.origin_iframe);if(e&&this.switchTs.setLastTs(t.ts,t.ts+t.cts),t.type!==ua.TYPES.avc&&t.type!==ua.TYPES.av01||this.evalBw&&this.evalBw.addSample(t),2===this.state&&(this.hasFrame||t.type!==ua.TYPES.avc&&t.type!==ua.TYPES.av01||(n.a.log("CtrlBuffer(".concat(this.id,").addSample first sample dts=").concat(t.ts," pts=").concat(t.ts+t.cts)),this.hasFrame=!0,this.callbacks&&this.callbacks.first())),t.type!==ua.TYPES.avc&&t.type!==ua.TYPES.av01||this.hasVideoConfig)if(2===this.state){if(t.key){let e=t.ts+t.cts,i=t.ts-this.switchTs.getDts(),s=e-this.switchTs.getPts();n.a.log("CtrlBuffer(".concat(this.id,").addSample find IFrame origin_iframe=").concat(t.origin_iframe," dts=").concat(t.ts," pts=").concat(e," switchDts=").concat(this.switchTs.switchIFrameDts," switchPts=").concat(this.switchTs.switchIFramePts," dtsGap=").concat(i," ptsGap=").concat(s," iFrameGap=").concat(this.avBuffer.gop)),this.switchTs.addPtsSample(t.ts,e,i,s,this.avBuffer.hasOriginIFrame,t.origin_iframe),e>=this.switchTs.switchIFramePts&&(n.a.log("CtrlBuffer(".concat(this.id,").addSample find new IFrame, switch done")),this.state=0,this.switchTs.setSwitchTs(0,0),this.avBuffer.addSample(t),this.addBuffered(t,!0,s),this.callbacks&&this.callbacks.done(i,t.ts,s))}}else 1===this.state?e?(this._popAllBuffer(),this.avBuffer.hasOriginIFrame=!1,this.hasVideoConfig=!1,this.hasFrame=!1,this.state=2,this.switchTs.setSwitchTs(t.ts,t.ts+t.cts),this.switchTs.resetPtsSample(),n.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame origin_iframe=").concat(t.origin_iframe," dts=").concat(this.switchTs.switchIFrameDts," pts=").concat(this.switchTs.switchIFramePts," iFrameGap=").concat(this.avBuffer.gop,", switch start!")),this.callbacks&&this.callbacks.start(this.switchTs.switchIFrameDts,this.switchTs.switchIFramePts)):(t.key&&n.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame fail, origin_iframe=").concat(t.origin_iframe," dts=").concat(t.ts," pts=").concat(t.ts+t.cts)),this.avBuffer.addSample(t),this.addBuffered(t,!1,0)):(1===Number(f.a._printIFramePts)&&t.key&&n.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame fail, origin_iframe=").concat(t.origin_iframe," dts=").concat(t.ts," pts=").concat(t.ts+t.cts)),this.avBuffer.addSample(t),this.addBuffered(t,!1,0))}addShieldAudioSample(t){this.avBuffer.addShieldAudioSample(t),this.addBuffered(t,!1,0)}_popAllBuffer(){this.avBuffer&&(this.avBuffer.getBufferLen()>0&&this.avBuffer.popBuffer(Number.MAX_SAFE_INTEGER),this.avBuffer.clearBuffer())}updateVideoConfig(t,e){e&&(this.avcChangeTime=_.a.now(),this._popAllBuffer()),this.hasVideoConfig=!0,this.avBuffer&&this.avBuffer.updateVideoConfig(t,e)}updateAudioConfig(t,e,i,s){e&&this._popAllBuffer(),this.avBuffer&&this.avBuffer.updateAudioConfig&&this.avBuffer.updateAudioConfig(t,i,s)}setNeedEmptyAudioFrame(t){this.needEmptyAudioFrame=t,this.avBuffer.setNeedEmptyAudioFrame(t)}isInAvcChangeTime(t){let e=_.a.now();return this.avcChangeTime+t<e}getBufferLen(){return this.avBuffer.getBufferLen()}getVideoBufferLen(){return this.mse.getBufferLen()}getLastIFrameDts(){return this.switchTs.lastIFrameDts}getSize(){return this.avBuffer.getSize()}onSwitchShieldAudioFail(t,e){this.mse&&this.mse.onSwitchShieldAudioFail(t,e)}onSwitchShieldAudioSuc(t){this.mse&&this.mse.onSwitchShieldAudioSuc(t)}shieldAuidoMute(t,e){this.mse&&this.mse.shieldAuidoMute(t,e)}getIframePts(){return this.switchTs.getPts()||0}},_a=class{constructor(){this.avDifTotal=0,this.avDifCnt=0,this.avDifMax=0,this.emptyFrames=0}checkSync(t,e){if(t&&0!=t.samples.length)if(this.emptyFrames+=e.emptyFrames,!e.hasOwnProperty("isSync")||e.isSync)if(t.endDts>0&&e.endDts>0){let i=t.endDts-e.endDts;this.avDifTotal+=i,this.avDifCnt++,this.avDifMax<i&&(this.avDifMax=i),i>200&&0===e.emptyFrames&&n.a.warn("AVSyncStat.checkSync avDif=".concat(i," video=[").concat(t.startDts,", ").concat(t.endDts,"] videoPlayDts=").concat(t.playDts," audio=[").concat(e.startDts,", ").concat(e.endDts,"] audioPlayDts=").concat(e.playDts))}else n.a.log("AVSyncStat.checkSync video=[".concat(t.startDts,", ").concat(t.endDts,"] videoPlayDts=").concat(t.playDts," audio=[").concat(e.startDts,", ").concat(e.endDts,"] audioPlayDts=").concat(e.playDts));else e.emptyFrames>0&&n.a.log("AVSyncStat.checkSync isSync=".concat(e.isSync," video=[").concat(t.startDts,", ").concat(t.endDts,"] videoPlayDts=").concat(t.playDts," audio=[").concat(e.startDts,", ").concat(e.endDts,"] audioPlayDts=").concat(e.playDts))}record(t){if(this.avDifCnt>0){let e=Math.round(this.avDifTotal/this.avDifCnt);t.setCore(d.a.DIM_CORE.AVSDA,e),t.setCore(d.a.DIM_CORE.AVSDM,this.avDifMax),t.setCore(d.a.DIM_CORE.AVEFS,this.emptyFrames)}this.avDifCnt=0,this.avDifTotal=0,this.avDifMax=0,this.emptyFrames=0}},fa=class{constructor(t){this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.stat=this.mse.handler.stat,this.lastTs=0,this.renderNum=0,this.fpsTotal=0,this.fpsNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}reset(){this.fpsNum=0,this.fpsTotal=0,this.renderNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0}getRecordFps(){let t=this.fpsTotal-this.recordTotal,e=this.fpsNum-this.recordNum;return e>0?(this.recordTotal=this.fpsTotal,this.recordNum=this.fpsNum,Math.round(t/e)):0}addRender(){let t=_.a.now();if(this.renderNum++,0===this.lastTs)this.lastTs=t;else{let e=t-this.lastTs;if(e>=1e3){this.lastTs=t;let i=Math.floor(this.renderNum/(e/1e3));this.fpsNum++,this.fpsTotal+=i,this.renderNum=0}}this._checkRenderQuality(t)}getPageRecordFps(){const t=this.pageFpsTotal-this.pageRecordTotal,e=this.pageFpsNum-this.pageRecordNum;let i=0,s=this.pageFpsMax,r=this.pageFpsMin;e>0&&(this.pageRecordTotal=this.pageFpsTotal,this.pageRecordNum=this.pageFpsNum,i=Math.round(t/e));let a={pfps:i,pfpsMax:s,pfpsMin:r};return this.pageFpsMax=0,this.pageFpsMin=0,a}addPageRender(){let t=_.a.now();if(this.pageRenderNum++,0===this.prePageRenderTs)this.prePageRenderTs=t;else{let e=t-this.prePageRenderTs;if(e>=1e3){this.prePageRenderTs=t;let i=Math.round(this.pageRenderNum/(e/1e3));if(this.pageFpsNum++,this.pageFpsTotal+=i,this.pageRenderNum=0,this.pageFpsMax=Math.max(i,this.pageFpsMax),0!=i)return 0==this.pageFpsMin?this.pageFpsMin=i:this.pageFpsMin=Math.min(i,this.pageFpsMin),i}}return 0}_checkRenderQuality(t){if(0===this.lastEachTs)this.lastEachTs=t;else{let e=t-this.lastEachTs;!this.isFirstRender&&e>200&&(this.renderBadQuality=100,this.stat&&(this.stat.addCore(d.a.DIM_CORE.VRBQC,1),this.stat.addCore(d.a.DIM_CORE.VRBQD,e)),n.a.warn("RenderFps._checkRenderQuality render bad quality time=",e)),this.isFirstRender=!1,this.lastEachTs=t}}statRenderQuality(){const t=this.renderBadQuality;return this.renderBadQuality=0,t}_onVisibilityChange(){(document.hidden||document.webkitHidden||document.mozHidden||document.msHidden)&&(this._checkRenderQuality(_.a.now()),this.lastTs=0,this.lastEachTs=0,this.renderNum=0)}},ga=class{constructor(t){this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}clearConsuming(){this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0}addRecvFrameData(t,e,i){o.a.renderStat[0]&&this.recvFrameDataList.push({ts:t,pts:e,time:i})}addRemuxFrameData(t,e,i){o.a.renderStat[0]&&this.remuxFrameDataList.push({ts:t,pts:e,time:i})}pushRemuxedVideoFrameData(t){if(o.a.renderStat[0]){for(let e=0;e<this.remuxFrameDataList.length;e++){let i=this.recvFrameDataList.find(t=>t.ts===this.remuxFrameDataList[e].ts);if(i){let e=t-i.time;this.frameRecvToPushConSumingTotalTime+=e,this.frameRecvToPushConSumingFrames++,this.frameRecvToPushConSumingMax=Math.max(e,this.frameRecvToPushConSumingMax)}this.pushedVideoDataList.push({ts:this.remuxFrameDataList[e].ts,pts:this.remuxFrameDataList[e].pts,time:t})}this.remuxFrameDataList=[]}}addRenderFrameData(t,e){if(o.a.renderStat[0]){for(let i=0;i<this.recvFrameDataList.length;i++)for(;this.recvFrameDataList.length>0&&this.recvFrameDataList[0].pts<t;){let t=e-this.recvFrameDataList[0].time;this.frameRecvToRenderMax=Math.max(t,this.frameRecvToRenderMax),this.frameRecvToRenderConSumingFrames++,this.frameRecvToRenderConSumingTotalTime+=t,this.recvFrameDataList.shift()}for(let i=0;i<this.pushedVideoDataList.length;i++)for(;this.pushedVideoDataList.length>0&&this.pushedVideoDataList[0].pts<t;){let t=e-this.pushedVideoDataList[0].time;this.framePushToRenderedConSumingMax=Math.max(t,this.framePushToRenderedConSumingMax),this.framePushToRenderedConSumingFrames++,this.framePushToRenderedConSumingTotalTime+=t,this.pushedVideoDataList.shift()}}}getRecvToPushConsuming(){return{max:this.frameRecvToPushConSumingMax,avg:this.frameRecvToPushConSumingFrames>0?this.frameRecvToPushConSumingTotalTime/this.frameRecvToPushConSumingFrames:0}}getPushToRenderedConSuming(){return{max:this.framePushToRenderedConSumingMax,avg:this.framePushToRenderedConSumingFrames>0?this.framePushToRenderedConSumingTotalTime/this.framePushToRenderedConSumingFrames:0}}getRecvToRenderConsuming(){return{max:this.frameRecvToRenderMax,avg:this.frameRecvToRenderConSumingFrames>0?this.frameRecvToRenderConSumingTotalTime/this.frameRecvToRenderConSumingFrames:0}}_onVisibilityChange(){this.clearConsuming()}destroy(){this.recvFrameDataList=null,this.remuxFrameDataList=null,this.pushedVideoDataList=null,this.eventEmitter&&this.eventEmitter.off(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind),this.eventEmitter=null,this.mse=null}},Sa=class{constructor(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup),this.fromByte=0,this.toByte=0}destroy(){this.abort(),this.loader=null}abort(){this.loader&&(this.stats.aborted=!0,this.loader.abort()),this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}load(t,e,i,s,r,a,o,n){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.url=t,this.responseType=e,this.onSuccess=i,this.onError=s,this.onTimeout=r,this.onProgress=h,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=o,this.retryDelay=n,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),a),this.loadInternal()}loadBuffer(t,e,i,s,r,a,o,n,h){this.onOpen=e,this.load(t,"arraybuffer",t=>{let{target:e}=t;i(e.response),s(e.response)},r,a,o,n,h)}loadInternal(){let t=this.loader=new XMLHttpRequest;t.onload=this.loadsuccess.bind(this),t.onerror=this.loaderror.bind(this),t.onprogress=this.loadprogress.bind(this),t.onloadend=this.loadend.bind(this),t.onloadstart=this.loadstart.bind(this),t.responseType=this.responseType,""!==this.responseType&&"text"!==this.responseType||!t.overrideMimeType||t.overrideMimeType("text/plain; charset=utf-8"),t.open("GET",this.url,!0),this.fromByte>0&&t.setRequestHeader("Range","bytes=".concat(this.fromByte,"-").concat(this.toByte>0?this.toByte:"")),this.stats.tstart=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(t),this.stats.tstart=performance.now(),t.send()}loadsuccess(t){404===t.currentTarget.status?this.onError(t):(window.clearTimeout(this.timeoutHandle),this.stats.tload=performance.now(),t.requestURL=this.url,this.onSuccess(t,this.stats))}loaderror(t){if(404===t.currentTarget.status||0===t.currentTarget.status)return window.clearTimeout(this.timeoutHandle),void this.onError(t);this.stats.retry<this.maxRetry?(n.a.warn("XhrLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),n.a.warn("XhrLoader.loaderror reach max retry url="+this.url),this.onError(t))}loadtimeout(){this.stats.retry<this.maxRetry?(n.a.warn("XhrLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),n.a.warn("XhrLoader.loadtimeout max retry url="+this.url),this.onTimeout(this.loader))}loadstart(){this.onOpen&&this.onOpen()}loadprogress(t){let e=this.stats;null===e.tfirst&&(e.tfirst=performance.now()),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}loadend(t){404===t.currentTarget.status&&this.loaderror(t)}getResponseHeader(t){return this.loader&&this.loader.getResponseHeader&&this.loader.getResponseHeader(t)}getLoaderHandler(){return this.loader}};class ya{constructor(){this.buffer=null,this.view=null,this.size=0,this.pos=0}destroy(){this.buffer=null,this.view=null,this.size=0,this.pos=0}appendBuffer(t){t=new Uint8Array(t);let e=new Uint8Array(this.size+t.length);this.buffer&&e.set(this.buffer,0),e.set(t,this.size),this.size=e.byteLength,this.buffer=e,this.view=new DataView(e.buffer)}peekString(t,e){let i=this.pos+t,s="";for(let t=0;t<e;t++)s+=String.fromCharCode(this.view.getUint8(i+t));return s}peekBuffer(t,e){return t=this.pos+t,new Uint8Array(this.view.buffer.slice(t,Math.min(t+e,this.size)))}peekAnyInt(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;if(this.pos+t<=this.size){switch(t){case 1:i=e?this.view.getInt8(this.pos):this.view.getUint8(this.pos);break;case 2:i=e?this.view.getInt16(this.pos):this.view.getUint16(this.pos);break;case 3:if(e)throw"peekAnyInt signed 24 bits values wrong";i=this.view.getUint8(this.pos)<<16,i|=this.view.getUint8(this.pos+1)<<8,i|=this.view.getUint8(this.pos+2);break;case 4:i=e?this.view.getInt32(this.pos):this.view.getUint32(this.pos);break;case 8:if(e)throw"peekAnyInt signed 64 bits values wrong";i=this.view.getUint32(this.pos)*ya.MAX_UINT+this.view.getUint32(this.pos+4);break;default:throw"peekAnyInt not implemented for size: "+t}return i}throw"Not enough bytes in buffer"}readUint8(){let t=this.peekAnyInt(1);return this.pos++,t}readUint16(){let t=this.peekAnyInt(2);return this.pos+=2,t}readUint24(){let t=this.peekAnyInt(3);return this.pos+=3,t}readUint32(){let t=this.peekAnyInt(4);return this.pos+=4,t}readInt32(){let t=this.peekAnyInt(4,!0);return this.pos+=4,t}readUint64(){let t=this.peekAnyInt(8);return this.pos+=8,t}readStr(t){let e=this.peekString(0,t);return this.pos+=t,e}skip(t){this.pos+=t}getPos(){return this.pos}isCanRead(t){return this.size-this.pos>=t}static writeUint64(t,e,i){let s=Math.floor(i/ya.MAX_UINT),r=4294967295&i;t.setUint32(e,s),t.setUint32(e+4,r)}}ya.MAX_UINT=Math.pow(2,32);var Ta=ya,Pa=class{constructor(){this.startOffset=0,this.size=0,this.type=""}destroy(){}read(t){this.startOffset=t.getPos(),this.size=t.readUint32(),this.type=t.readStr(4)}readContainer(t){let e=this.size+t.getPos()-8;for(;t.getPos()<e;){let e=t.peekString(4,4),i=Ya.createBox(e);i.read(t),this.onReadBox(i)}}onReadBox(t){}remux(){return null}fillHeader(t,e,i,s){e.setUint32(0,s),t.set(Ya.getCharCode(i),4)}getSize(){return 8}},va=class extends Pa{constructor(){super(),this.major_brand="",this.minor_version=0,this.compatible_brands=""}getSize(){return super.getSize()+4+4+this.compatible_brands.length}read(t){super.read(t),this.major_brand=t.readStr(4),this.minor_version=t.readUint32(),this.compatible_brands=t.readStr(this.size-16)}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Ya.STYP,t);let s=8;return this.fillStr(e,s,this.major_brand),s+=4,i.setUint32(s,this.minor_version),s+=4,this.fillStr(e,s,this.compatible_brands),e}fillStr(t,e,i){for(let s=0;s<i.length;s++)t[e+s]=i.charCodeAt(s)}},Ea=class extends Pa{constructor(){super(),this.version=0,this.flags=0}read(t){super.read(t),this.version=t.readUint8(),this.flags=t.readUint24()}fillHeader(t,e,i,s){super.fillHeader(t,e,i,s),t[8]=this.version,t[9]=this.flags>>16&255,t[10]=this.flags>>8&255,t[11]=255&this.flags}getSize(){return super.getSize()+4}},Ca=class extends Ea{constructor(){super(),this.reference_id=0,this.time_scale=0,this.earliest_presentation_time=0,this.first_offset=0,this.reserved=0,this.reference_count=0,this.reference_list=[],this.reference_data=[],this.earliest_presentation_time_offset=0}destroy(){this.reference_list=[],this.reference_data=[],super.destroy()}updateReference(t){if(this.reference_count>0){let e=t.trun.getRemuxSampleCnt(),i=this.reference_list[0];i.referenced_size=t.trun.getMdatSize(),i.subsegment_duration=e*t.tfhd.default_sample_duration}}updateEarliestPresentationTime(t){let e=t.trun.getRemuxSampleCnt();this.earliest_presentation_time_offset=e*t.tfhd.default_sample_duration}read(t){super.read(t),this.reference_id=t.readUint32(),this.time_scale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),this.reserved=t.readUint16(),this.reference_count=t.readUint16();for(let e=0;e<this.reference_count;e++){let e={},i=t.readUint32();this.reference_data.push(i),e.reference_type=i>>31&1,e.referenced_size=2147483647&i,e.subsegment_duration=t.readUint32(),this.reference_data.push(e.subsegment_duration),i=t.readUint32(),this.reference_data.push(i),e.starts_with_SAP=i>>31&1,e.SAP_type=i>>28&7,e.SAP_delta_time=268435455&i,this.reference_list.push(e)}}getSize(){let t=super.getSize();return t+=4,t+=4,t+=0===this.version?8:16,t+=2,t+=2,t+=12*this.reference_count,t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Ya.SIDX,t);let s=12;i.setUint32(s,this.reference_id),s+=4,i.setUint32(s,this.time_scale),s+=4,0===this.version?(i.setUint32(s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=4,i.setUint32(s,this.first_offset),s+=4):(Ta.writeUint64(i,s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=8,Ta.writeUint64(i,s,this.first_offset),s+=8),i.setUint16(s,this.reserved),s+=2,i.setUint16(s,this.reference_count),s+=2;for(let t=0;t<this.reference_data.length;t++)i.setUint32(s,this.reference_data[t]),s+=4;return e}},Ia=class extends Pa{constructor(){super(),this.mfhd=null,this.trafVideo=null,this.trafAudio=null}destroy(){this.mfhd.destroy(),this.trafVideo.destroy(),this.trafAudio.destroy(),this.mfhd=null,this.trafVideo=null,this.trafAudio=null,super.destroy()}read(t){super.read(t),this.readContainer(t),this.trafVideo&&this.trafAudio&&(this.trafVideo.trun.data_offset>this.trafAudio.trun.data_offset?(this.trafAudio.calcSampleMdatDataOffset(0),this.trafVideo.calcSampleMdatDataOffset(this.trafAudio.getSampleDataSize())):(this.trafVideo.calcSampleMdatDataOffset(0),this.trafAudio.calcSampleMdatDataOffset(this.trafVideo.getSampleDataSize())))}onReadBox(t){t.type===Ya.MFHD?this.mfhd=t:t.type===Ya.TRAF&&(t.isVideo()?this.trafVideo=t:this.trafAudio=t)}readMdat(t){this.trafVideo&&this.trafVideo.readMdat(t),this.trafAudio&&this.trafAudio.readMdat(t)}getSize(){let t=super.getSize()+this.mfhd.getSize();return this.trafVideo&&(t+=this.trafVideo.getSize()),this.trafAudio&&(t+=this.trafAudio.getSize()),t}remux(){let t=this.mfhd.remux(),e=null;this.trafVideo&&(e=this.trafVideo.remux());let i=null;this.trafAudio&&(i=this.trafAudio.remux());let s=this.getSize(),r=new Uint8Array(s),a=new DataView(r.buffer);this.fillHeader(r,a,Ya.MOOF,s);let o=8;return r.set(t,o),o+=t.length,e&&(r.set(e,o),o+=e.length),i&&(r.set(i,o),o+=i.length),r}updateMdatDataOffset(){let t=this.getSize();t+=8,this.trafVideo&&this.trafAudio?(this.trafVideo.trun.remux_data_offset=t,this.trafAudio.trun.remux_data_offset=t+this.trafVideo.trun.getMdatSize()):this.trafVideo?this.trafVideo.trun.remux_data_offset=t:this.trafAudio&&(this.trafAudio.trun.remux_data_offset=t)}updateBaseMediaDecodeTime(){this.trafVideo&&this.trafVideo.updateBaseMediaDecodeTime(),this.trafAudio&&this.trafAudio.updateBaseMediaDecodeTime()}},Aa=class extends Ea{constructor(){super(),this.sequence_number=0}read(t){super.read(t),this.sequence_number=t.readUint32()}getSize(){return super.getSize()+4}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Ya.MFHD,t),i.setUint32(12,this.sequence_number),e}},Da=class extends Pa{constructor(){super(),this.tfhd=null,this.tfdt=null,this.trun=null}destroy(){this.tfhd.destroy(),this.tfdt.destroy(),this.trun.destroy(),this.tfhd=null,this.tfdt=null,this.trun=null,super.destroy()}isVideo(){return 1===this.tfhd.track_id}getDuration(){return this.trun.sampleMdatIndex*this.tfhd.default_sample_duration}getSampleDataSize(){return this.trun?this.trun.getSampleDataSize(this.tfhd):0}calcSampleMdatDataOffset(t){this.trun.calcSampleMdatDataOffset(t,this.tfhd)}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.TFHD?this.tfhd=t:t.type===Ya.TFDT?this.tfdt=t:t.type===Ya.TRUN&&(this.trun=t)}getBound(){return{start:this.trun.remuxSampleStart,end:this.trun.remuxSampleEnd}}getSize(){return super.getSize()+this.tfhd.getSize()+this.tfdt.getSize()+this.trun.getSize()}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Ya.TRAF,t);let s=this.tfhd.remux(),r=this.tfdt.remux(),a=this.trun.remux(),o=8;return e.set(s,o),o+=s.length,e.set(r,o),o+=r.length,e.set(a,o),o+=a.length,e}updateBaseMediaDecodeTime(){let t=this.trun.getRemuxSampleCnt();this.tfdt.base_media_decode_time_offset=t*this.tfhd.default_sample_duration}};class Ra extends Ea{constructor(){super(),this.track_id=0,this.base_data_offset=0,this.sample_description_index=0,this.default_sample_duration=0,this.default_sample_size=0,this.default_sample_flags=0}read(t){super.read(t),this.track_id=t.readUint32(),this.flags&Ra.FLAG_BASE_DATA_OFFSET&&(this.base_data_offset=t.readUint64()),this.flags&Ra.FLAG_SAMPLE_DESC&&(this.sample_description_index=t.readUint32()),this.flags&Ra.FLAG_SAMPLE_DUR&&(this.default_sample_duration=t.readUint32()),this.flags&Ra.FLAG_SAMPLE_SIZE&&(this.default_sample_size=t.readUint32()),this.flags&Ra.FLAG_SAMPLE_FLAGS&&(this.default_sample_flags=t.readUint32())}getSize(){let t=super.getSize();return t+=4,this.flags&Ra.FLAG_BASE_DATA_OFFSET&&(t+=8),this.flags&Ra.FLAG_SAMPLE_DESC&&(t+=4),this.flags&Ra.FLAG_SAMPLE_DUR&&(t+=4),this.flags&Ra.FLAG_SAMPLE_SIZE&&(t+=4),this.flags&Ra.FLAG_SAMPLE_FLAGS&&(t+=4),t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Ya.TFHD,t),i.setUint32(12,this.track_id);let s=16;return this.flags&Ra.FLAG_BASE_DATA_OFFSET&&(Ta.writeUint64(i,s,this.base_data_offset),s+=8),this.flags&Ra.FLAG_SAMPLE_DESC&&(i.setUint32(s,this.sample_description_index),s+=4),this.flags&Ra.FLAG_SAMPLE_DUR&&(i.setUint32(s,this.default_sample_duration),s+=4),this.flags&Ra.FLAG_SAMPLE_SIZE&&(i.setUint32(s,this.default_sample_size),s+=4),this.flags&Ra.FLAG_SAMPLE_FLAGS&&(i.setUint32(s,this.default_sample_flags),s+=4),e}}Ra.FLAG_BASE_DATA_OFFSET=1,Ra.FLAG_SAMPLE_DESC=2,Ra.FLAG_SAMPLE_DUR=8,Ra.FLAG_SAMPLE_SIZE=16,Ra.FLAG_SAMPLE_FLAGS=32,Ra.FLAG_DUR_EMPTY=65536,Ra.FLAG_DEFAULT_BASE_IS_MOOF=131072;var Oa=Ra,La=class extends Ea{constructor(){super(),this.base_media_decode_time=0,this.base_media_decode_time_offset=0}read(t){super.read(t),1===this.version?this.base_media_decode_time=t.readUint64():this.base_media_decode_time=t.readUint32()}getSize(){let t=super.getSize();return t+=1===this.version?8:4,t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Ya.TFDT,t),1===this.version?Ta.writeUint64(i,12,this.base_media_decode_time+this.base_media_decode_time_offset):i.setUint32(12,this.base_media_decode_time+this.base_media_decode_time_offset),e}},Ma=class{constructor(){this.sample_duration=0,this.sample_size=0,this.sample_flags=0,this.sample_composition_time_offset=0,this.dataOffset=0,this.units=null}destroy(){this.units=null}};class wa extends Ea{constructor(){super(),this.sample_count=0,this.data_offset=0,this.first_sample_flags=0,this.samples=[],this.sampleMdatIndex=0,this.sampleMdatSize=0,this.remuxSampleStart=0,this.remuxSampleEnd=0,this.remux_data_offset=0}destroy(){this.samples.forEach(t=>{t.destroy()}),this.samples=[],super.destroy()}createEmptySamples(t){this.remuxSampleEnd=t;for(let e=0;e<t;e++){let t=this.samples[e];t.units=new Uint8Array(Vr.emptyAacFrame),t.sample_size=t.units.length}this.sampleMdatIndex=t}readMdat(t,e){for(;this.sampleMdatIndex<this.sample_count;){let i=this.samples[this.sampleMdatIndex];if(!t.readSample(i,e))break;this.sampleMdatIndex++}}read(t){super.read(t),this.sample_count=t.readUint32(),this.flags&wa.FLAGS_DATA_OFFSET&&(this.data_offset=t.readUint32()),this.flags&wa.FLAGS_FIRST_FLAG&&(this.first_sample_flags=t.readUint32());for(let e=0;e<this.sample_count;e++){let e=new Ma(this.flags);this.flags&wa.FLAGS_DURATION&&(e.sample_duration=t.readUint32()),this.flags&wa.FLAGS_SIZE&&(e.sample_size=t.readUint32()),this.flags&wa.FLAGS_FLAGS&&(e.sample_flags=t.readUint32()),this.flags&wa.FLAGS_CTS_OFFSET&&(0===this.version?e.sample_composition_time_offset=t.readUint32():e.sample_composition_time_offset=t.readInt32()),this.sampleMdatSize+=e.sample_size,this.samples.push(e)}}calcSampleMdatDataOffset(t,e){for(let i=0;i<this.sample_count;i++){let s=this.samples[i];s.dataOffset=t,0===s.sample_size?t+=e.default_sample_size:t+=s.sample_size}}getRemuxSampleCnt(){return this.remuxSampleEnd-this.remuxSampleStart}getSize(){let t=super.getSize();return t+=4,this.flags&wa.FLAGS_DATA_OFFSET&&(t+=4),this.flags&wa.FLAGS_FIRST_FLAG&&(t+=4),t+=(this.remuxSampleEnd-this.remuxSampleStart)*this.getSampleSize(),t}getSampleDataSize(t){let e=0;for(let i=0;i<this.sample_count;i++){let s=this.samples[i];0===s.sample_size?e+=t.default_sample_size:e+=s.sample_size}return e}getSampleSize(){let t=0;return this.flags&wa.FLAGS_DURATION&&(t+=4),this.flags&wa.FLAGS_SIZE&&(t+=4),this.flags&wa.FLAGS_FLAGS&&(t+=4),this.flags&wa.FLAGS_CTS_OFFSET&&(t+=4),t}getMdatSize(){let t=0;for(let e=this.remuxSampleStart;e<this.remuxSampleEnd;e++)t+=this.samples[e].units.length;return t}getMdat(){let t=this.getMdatSize(),e=0,i=new Uint8Array(t);for(let t=this.remuxSampleStart;t<this.remuxSampleEnd;t++){let s=this.samples[t];i.set(s.units,e),e+=s.units.length}return i}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Ya.TRUN,t),i.setUint32(12,this.remuxSampleEnd-this.remuxSampleStart);let s=16;this.flags&wa.FLAGS_DATA_OFFSET&&(i.setUint32(s,this.remux_data_offset),s+=4),this.flags&wa.FLAGS_FIRST_FLAG&&(i.setUint32(s,this.first_sample_flags),s+=4);for(let t=this.remuxSampleStart;t<this.remuxSampleEnd;t++){let e=this.samples[t];this.flags&wa.FLAGS_DURATION&&(i.setUint32(s,e.sample_duration),s+=4),this.flags&wa.FLAGS_SIZE&&(i.setUint32(s,e.sample_size),s+=4),this.flags&wa.FLAGS_FLAGS&&(i.setUint32(s,e.sample_flags),s+=4),this.flags&wa.FLAGS_CTS_OFFSET&&(0===this.version?i.setUint32(s,e.sample_composition_time_offset):i.setInt32(s,e.sample_composition_time_offset),s+=4)}return e}}wa.FLAGS_DATA_OFFSET=1,wa.FLAGS_FIRST_FLAG=4,wa.FLAGS_DURATION=256,wa.FLAGS_SIZE=512,wa.FLAGS_FLAGS=1024,wa.FLAGS_CTS_OFFSET=2048;var Fa=wa,ba=class extends Pa{constructor(t){super(),this.data_len=0,this.data_size=t-8,this.data=new Uint8Array(this.data_size)}isRecvFull(){return this.data_len>=this.data_size}destroy(){this.data=null,super.destroy()}read(t){super.read(t),t.skip(this.data_size)}appendData(t){let e=t.peekBuffer(8,this.data_size);this.data_len=e.length,this.data.set(e,0)}readSample(t,e){let i=t.sample_size;return 0===i&&(i=e.default_sample_size),this.data_len-t.dataOffset>=i&&(t.units=this.data.slice(t.dataOffset,t.dataOffset+i),!0)}remux(){let t=8+this.data_len,e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Ya.MDAT,t),e.set(this.data,8),e}},Va=class extends Pa{constructor(){super()}read(t){super.read(t),t.skip(this.size-8)}},Na=class extends Pa{constructor(){super(),this.mvhd=null,this.videoTrack=null,this.audioTrack=null,this.mvex=null,this.udta=null}destroy(){this.mvhd.destroy(),this.mvhd=null,super.destroy()}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.MVHD?this.mvhd=t:t.type===Ya.TRAK?t.isVideo()?this.videoTrack=t:this.audioTrack=t:t.type===Ya.MVEX?this.mvex=t:t.type===Ya.UDTA&&(this.udta=t)}readMdat(t){this.trafVideo&&this.trafVideo.readMdat(t),this.trafAudio&&this.trafAudio.readMdat(t)}getSize(){return super.getSize()+this.mvhd.getSize()+this.videoTrack.getSize()+this.audioTrack.getSize()+this.mvex.getSize()+this.udta.getSize()}},Ba=class extends Pa{constructor(){super(),this.tkhd=null,this.edts=null,this.mdia=null}destroy(){this.tkhd.destroy(),this.edts.destroy(),this.mdia.destroy(),this.tkhd=null,this.edts=null,this.mdia=null,super.destroy()}isVideo(){return 1===this.tkhd.track_id}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.TKHD?this.tkhd=t:t.type===Ya.EDTS?this.edts=t:t.type===Ya.MDIA&&(this.mdia=t)}getSize(){return super.getSize()+this.tkhd.getSize()+this.edts.getSize()+this.mdia.getSize()}},ka=class extends Ea{constructor(){super(),this.track_id=0}read(t){super.read(t),t.readUint32(),t.readUint32(),this.track_id=t.readUint32(),t.skip(this.size-12-12)}getSize(){let t=super.getSize();return t+=this.size,t}},Ua=class extends Pa{constructor(){super(),this.mdhd=null,this.hdlr=null,this.minf=null}destroy(){this.mdhd.destroy(),this.hdlr.destroy(),this.minf.destroy(),this.mdhd=null,this.hdlr=null,this.minf=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.MDHD?this.mdhd=t:t.HDLR===Ya.HDLR?this.hdlr=t:t.type===Ya.MINF&&(this.minf=t)}getSize(){return super.getSize()+this.mdhd.getSize()+this.hdlr.getSize()+this.minf.getSize()}},xa=class extends Pa{constructor(){super(),this.vmhd=null,this.dinf=null,this.stbl=null}destroy(){this.vmhd.destroy(),this.dinf.destroy(),this.stbl.destroy(),this.vmhd=null,this.dinf=null,this.stbl=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.VMHD?this.vmhd=t:t.type===Ya.DINF?this.dinf=t:t.type===Ya.STBL&&(this.stbl=t)}getSize(){return super.getSize()+this.vmhd.getSize()+this.dinf.getSize()+this.minf.getSize()}},Ha=class extends Pa{constructor(){super(),this.stsd=null,this.stts=null,this.stsc=null,this.stsz=null,this.stco=null}destroy(){this.stsd.destroy(),this.stts.destroy(),this.stsc.destroy(),this.stsz.destroy(),this.stco.destroy(),this.stsd=null,this.stts=null,this.stsc=null,this.stsz=null,this.stco=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Ya.STSD?this.stsd=t:t.type===Ya.STTS?this.stts=t:t.type===Ya.STSC?this.stsc=t:t.type===Ya.STSZ?this.stsz=t:t.type===Ya.STCO&&(this.stco=t)}getSize(){return super.getSize()+this.stsd.getSize()+this.stts.getSize()+this.stsc.getSize()+this.stsz.getSize()}},Wa=class extends Ea{constructor(){super(),this.headerBox=null,this.headerProps=null}destroy(){this.headerBox.destroy(),this.headerBox=null,super.destroy()}read(t){super.read(t),t.readUint32(),t.readUint32();const e=t.readStr(4);if("av01"==e){t.skip(6),t.skip(2),t.skip(2),t.skip(2),t.skip(12);const a=t.readUint16(),o=t.readUint16();t.readUint32(),t.readUint32(),t.skip(4),t.readUint16(),t.readStr(32),t.readUint16(),t.skip(2);const n=t.readUint32();t.readStr(4);let h=t.readUint8();h=t.readUint8();const d=h>>5&7,l=31&h;h=t.readUint8();const c=h>>7&1,u=h>>6&1,p=h>>5&1;if(h=t.readUint8(),0!=(h>>5&7))return void console.error("av1C reserved_1 parsing problem");let m=0,_=0;if(1==(h>>4&1))m=15&h;else if(_=15&h,0!==_)return;var i=n-12;const f=t.buffer.slice(t.pos-4,t.pos+i);var s,r=l;r<10&&(r="0"+r),2===d&&1===u?s=1===p?"12":"10":d<=2&&(s=1===u?"10":"08");const g=e+"."+d+"."+r+(c?"H":"M")+"."+s;this.headerProps={type:e,width:a,height:o,codec:g,configOBUs:f},t.skip(this.size-12-4-86-12)}else if("mp4a"==e){t.skip(6),t.skip(2),t.skip(8);const i=t.readUint16(),s=t.readUint16();t.skip(2),t.skip(2);const r=t.readUint32()/65536;t.skip(this.size-12-4-36),this.headerProps={type:e,channel_count:i,samplesize:s,samplerate:r}}}getSize(){return super.getSize()+this.size}};const Ga=new Map;var Ya={STYP:"styp",SIDX:"sidx",MOOF:"moof",MFHD:"mfhd",TRAF:"traf",TFHD:"tfhd",TFDT:"tfdt",TRUN:"trun",MDAT:"mdat",MOOV:"moov",MVHD:"mvhd",TRAK:"trak",TKHD:"tkhd",EDTS:"edts",MDIA:"mdia",MDHD:"mdhd",HDLR:"hdlr",MINF:"minf",VMHD:"vmhd",DINF:"dinf",STBL:"stbl",STSD:"stsd",STTS:"stts",STSC:"stsc",STSZ:"stsz",STCO:"stco",AV01:"av01",MVEX:"mvex",UDTA:"udta",createBox:function(t){return 0===Ga.size&&(Ga.set(this.STYP,va),Ga.set(this.SIDX,Ca),Ga.set(this.MOOF,Ia),Ga.set(this.MFHD,Aa),Ga.set(this.TRAF,Da),Ga.set(this.TFHD,Oa),Ga.set(this.TFDT,La),Ga.set(this.TRUN,Fa),Ga.set(this.MDAT,ba),Ga.set(this.MOOV,Na),Ga.set(this.TRAK,Ba),Ga.set(this.TKHD,ka),Ga.set(this.MDIA,Ua),Ga.set(this.MINF,xa),Ga.set(this.STBL,Ha),Ga.set(this.STSD,Wa)),new(Ga.get(t)||Va)},getCharCode:function(t){let e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}},qa=class{constructor(t){this.buffer=new Ta,this.styp=null,this.sidxVideo=null,this.sidxAudio=null,this.moof=null,this.mdat=null,this.moov=null,this.step=0,this.type=t}destroy(){this.buffer&&this.buffer.destroy(),this.styp&&this.styp.destroy(),this.sidxVideo&&this.sidxVideo.destroy(),this.sidxAudio&&this.sidxAudio.destroy(),this.moof&&this.moof.destroy(),this.mdat&&this.mdat.destroy()}getVideoFps(){if(!this.hasMedia()||!this.hasVideo())return 0;const t=this.moof.trafVideo.trun.sample_count,e=this.moof.trafVideo.tfhd.default_sample_duration,i=this.sidxVideo.time_scale;return Math.ceil(t/(t*e/i))}getBoundAV(){let t={video:{start:-1,end:-1},audio:{start:-1,end:-1}};return this.moof&&(this.moof.trafVideo&&(t.video=this.moof.trafVideo.getBound()),this.moof.trafAudio&&(t.audio=this.moof.trafAudio.getBound())),t}hasMedia(){return this.moof}hasVideo(){return this.sidxVideo}hasAudio(){return this.sidxAudio}isRecvFull(){return this.mdat&&this.mdat.isRecvFull()}setFullRemux(){this.moof&&(this.sidxVideo&&this.moof.trafVideo&&(this.moof.trafVideo.trun.remuxSampleStart=0,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count,this.sidxVideo.earliest_presentation_time_offset=0,this.moof.trafVideo.tfdt.base_media_decode_time_offset=0),this.sidxAudio&&this.moof.trafAudio&&(this.moof.trafAudio.trun.remuxSampleStart=0,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count,this.sidxAudio.earliest_presentation_time_offset=0,this.moof.trafAudio.tfdt.base_media_decode_time_offset=0))}setRemuxAll(){this.moof&&(this.moof.trafVideo&&(this.moof.trafVideo.trun.remuxSampleStart=this.moof.trafVideo.trun.remuxSampleEnd,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count),this.moof.trafAudio&&(this.moof.trafAudio.trun.remuxSampleStart=this.moof.trafAudio.trun.remuxSampleEnd,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count))}isCanSecOpen(t){if(this.moof&&this.sidxVideo&&this.moof.trafVideo){let e=1e3*this.moof.trafVideo.getDuration()/this.sidxVideo.time_scale;if(e>=t){if(this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sampleMdatIndex,this.sidxAudio&&this.moof.trafAudio){let t=Math.ceil(e*this.sidxAudio.time_scale/1e3/this.moof.trafAudio.tfhd.default_sample_duration);t=Math.min(t,this.moof.trafAudio.trun.sample_count),this.moof.trafAudio.trun.createEmptySamples(t)}return!0}}return!1}appendBuffer(t){this.buffer.appendBuffer(t),this.parse()}parse(){for(;this.buffer.isCanRead(8);){let t=this.buffer.peekAnyInt(4),e=this.buffer.peekString(4,4);if(e===Ya.MDAT){if(this.mdat||(this.mdat=new ba(t)),this.mdat.appendData(this.buffer),this.moof&&this.moof.readMdat(this.mdat),!this.buffer.isCanRead(t))break;this.mdat.read(this.buffer)}else{if(!this.buffer.isCanRead(t))break;{let t=Ya.createBox(e);t.read(this.buffer),e===Ya.STYP?this.styp=t:e===Ya.SIDX?1===t.reference_id?this.sidxVideo=t:this.sidxAudio=t:e===Ya.MOOF?this.moof=t:e===Ya.MOOV&&(this.moov=t)}}}}remux(){this.moof.updateMdatDataOffset();let t=this.styp.remux(),e=null,i=null;this.sidxVideo&&this.moof.trafVideo&&(this.sidxVideo.updateReference(this.moof.trafVideo),e=this.sidxVideo.remux()),this.sidxAudio&&this.moof.trafAudio&&(this.sidxAudio.updateReference(this.moof.trafAudio),i=this.sidxAudio.remux());let s=this.moof.remux(),r=null;this.moof.trafVideo&&(r=this.moof.trafVideo.trun.getMdat());let a=null;this.moof.trafAudio&&(a=this.moof.trafAudio.trun.getMdat());let o=8;r&&(o+=r.length),a&&(o+=a.length);let n=t.length+o+s.length;e&&(n+=e.length),i&&(n+=i.length);let h=new Uint8Array(n),d=0;return h.set(t,d),d+=t.length,i&&(h.set(i,d),d+=i.length),e&&(h.set(e,d),d+=e.length),h.set(s,d),d+=s.length,h[d]=o>>24&255,h[d+1]=o>>16&255,h[d+2]=o>>8&255,h[d+3]=255&o,d+=4,h.set(Ya.getCharCode(Ya.MDAT),d),d+=4,r&&(h.set(r,d),d+=r.length),a&&h.set(a,d),this.sidxVideo&&this.moof.trafVideo&&this.sidxVideo.updateEarliestPresentationTime(this.moof.trafVideo),this.sidxAudio&&this.moof.trafAudio&&this.sidxAudio.updateEarliestPresentationTime(this.moof.trafAudio),this.moof.updateBaseMediaDecodeTime(),h}};var Ka=class{constructor(t){this.mse=t,this.mediaSource=null,this.buffer=null,this.segments=[],this.initSegment=null,this.initUrl="",this.config=null,this.initPhase=0,this.initLoader=null,this.onUpdateendBind=this.onUpdateend.bind(this),this.onErrorBind=this.onError.bind(this),this.loadOpenBind=this.loadOpen.bind(this),this.loadChunkBind=this.loadChunk.bind(this),this.loadSuccessBind=this.loadSuccess.bind(this),this.loadErrorBind=this.loadError.bind(this),this.loadTimeoutBind=this.loadTimeout.bind(this),this.onInitOpenCb=null,this.onInitCallback=null,this.onFirstBufCb=null,this.mp4=null,this.firstPlay=!0,this.checkCurrentTime=!1,this.initMp4=null}reset(){n.a.log("Av1Player.reset"),this.buffer&&(this.buffer.removeEventListener("updateend",this.onUpdateendBind),this.buffer.removeEventListener("error",this.onErrorBind),this.buffer=null),this.initLoader&&this.initLoader.abort(),this.onInitOpenCb=null,this.onInitCallback=null,this.mediaSource=null,this.segments=[]}destroy(){n.a.log("Av1Player.destroy"),this.reset(),this.initSegment=null,this.initPhase=0,this.tryCnt=5,this.initUrl="",this.config=null,this.mse=null,this.onFirstBufCb=null}isPlaying(){return null!=this.buffer}isInitLoaded(){return 2===this.initPhase}initError(){3!==this.initPhase&&(this.initPhase=3,this.onError({message:"load init.mp4=404"}))}loadInit(t,e,i){let{initCb:s,openCb:r}=i;if(0===this.initPhase){n.a.log("M4sPlayer.loadInit"),this.initPhase=1,this.initUrl=t,this.config=e,this.onInitCallback=s,this.onInitOpenCb=r;let i=new Sa(e);this.initLoader=i,i.loadBuffer(t,this.loadOpenBind,this.loadChunkBind,this.loadSuccessBind,this.loadErrorBind,this.loadTimeoutBind,2e3,e.fragLoadingMaxRetry,e.fragLoadingRetryDelay)}}loadOpen(t){this.onInitOpenCb&&(this.onInitOpenCb(),this.onInitOpenCb=null)}loadChunk(t){}loadSuccess(t){this.initMp4=new qa(2),n.a.log("M4sPlayer.loadSuccess init"),this.initPhase=2,this.initSegment=t,this._initCodecs(),this._appendInit(),this.onInitCallback&&(this.onInitCallback(),this.onInitCallback=null),this.initMp4.appendBuffer(t),console.log("initMp4",this.initMp4);const e=this.initMp4.moov.videoTrack.mdia.minf.stbl.stsd.headerProps,i=this.initMp4.moov.audioTrack.mdia.minf.stbl.stsd.headerProps;this.mse.initSegmentSuc(e,i)}loadError(t){let{code:e,currentTarget:i,msg:s}=t;this.initError()}loadTimeout(t){this.initError()}onMediaSourceOpen(t){this.mediaSource=t,this._initCodecs(),this._appendInit()}createMp4(){this.mp4&&(this.mp4.destroy(),this.mp4=null),this.mp4=new qa(1)}appendSegment(t,e){let i=this.mp4;if(i.appendBuffer(t),this.mse.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS)i.isRecvFull()&&this.mse.remuxAv1(i,e);else{let e=!1;if(this.firstPlay?i.isCanSecOpen(200)&&(i.step=1,this.firstPlay=!1,e=!0):i.isRecvFull()&&(1==i.step&&(i.step=2),e=!0,i.setFullRemux()),e){const e=i.getBoundAV();n.a.log("M4sPlayer.appendSegment video=[".concat(e.video.start,", ").concat(e.video.end,"] audio=[").concat(e.audio.start,", ").concat(e.audio.end,"]")),t=i.remux(),this.segments.push({segment:t,step:i.step}),this._appendBuffer()}}}_appendInit(){this.initSegment&&this.buffer&&this.buffer.appendBuffer(this.initSegment)}_appendBuffer(){if(this.initSegment&&this.segments.length>0&&this.buffer&&!this.buffer.updating){this.onFirstBufCb&&this.onFirstBufCb();let t=this.segments.shift(),e=t.segment;this.checkCurrentTime=2===t.step,this.buffer.appendBuffer(e)}}_initCodecs(){!this.buffer&&this.mediaSource&&2===this.initPhase&&(n.a.log("M4sPlayer._initCodecs"),this.buffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(dt.a.AV01)),this.buffer.addEventListener("updateend",this.onUpdateendBind),this.buffer.addEventListener("error",this.onErrorBind))}onUpdateend(){this.mse.checkSeek(),this.checkCurrentTime&&(n.a.log("M4sPlayer.onUpdateend checkCurrentTime"),this.checkCurrentTime=!1,this.mse.checkCurrentTime()),this._appendBuffer()}onError(t){n.a.log("M4sPlayer.onError ".concat(t.message)),this.mse&&this.mse.onM4sError()}hasVideo(){return!!this.buffer}},ja=s(14),za=class{constructor(t){this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1,this.timer=0}destroy(){this.seiList=null,this.player=null,clearTimeout(this.timer)}add(t,e,i,s){let r=this.seiList.length;if(this.seiList.length>0)for(r=this.seiList.length-1;r>0&&!(t>this.seiList[r].timeStamp);r--);this.seiList.splice(r+1,0,{timeStamp:t,data:i,port:e}),this.timerStart||(this.timerStart=!0,clearTimeout(this.timer),this.timer=setTimeout(this.checkDispatchSei.bind(this),this.internal))}checkDispatchSei(){if(this.timerStart){let t=this.player.getCurrentRealTime(),e=-1;if(this.seiList.length>0)for(let i=0;i<this.seiList.length&&t>this.seiList[i].timeStamp;i++)e=i;if(e>=0){let i=this.seiList[e];this.player.onSeiDataChannel(this.seiList[e].port,this.seiList[e]),this.seiList.splice(0,e+1),n.a.log("ts=".concat(t,",port=").concat(i.port,",content=").concat(i.content,",data=").concat(i.data,", list=").concat(this.seiList))}this.seiList.length>0?this.timer=setTimeout(this.checkDispatchSei.bind(this),this.internal):this.timerStart=!1}}reset(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}};let Ja=[43,138,8,0],Qa=0;var Xa=class{constructor(t,e,i){this._num_=++Qa;let{videoType:s="flv",isLive:r=!0,isPureAudio:a=!1,isPureVideo:n=!1,isH265Mode:h,videoElement:d=null}=e;this.videoElement=d,this.isH265Mode=h,this.handler=t,this.videoType=s,this.isLive=r,this.isPureAudio=a,this.isPureVideo=n,this.parser=null,this.metadata={},this.bufStat=new class{constructor(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0,this.aiEmptyTime=0,this.aiEmptyCnt=0}reset(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0}getStats(){let t={emptyTime:this.emptyTime,emptyCnt:this.emptyCnt};return this.emptyTime=0,this.emptyCnt=0,t}getAiStats(){let t={aiEmptyTime:this.aiEmptyTime,aiEmptyCnt:this.aiEmptyCnt};return this.aiEmptyTime=0,this.aiEmptyCnt=0,t}checkBuffer(t,e){e<200&&0===this.emptyTs?this.emptyTs=t:e>500&&this.emptyTs>0&&(this.emptyTime+=t-this.emptyTs,this.aiEmptyTime+=t-this.emptyTs,this.emptyTs=0,this.emptyCnt++,this.aiEmptyCnt++)}},this.pauseStat=new ia(this),this.pausePerf=new ra,this.buffered=new oa,this.buffered.setMse(this),this.h264SeiInfos=new class{constructor(t){this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1,this.internalId=0,this.checkDispatchSeiBind=this.checkDispatchSei.bind(this)}destroy(){this.seiList=null,this.player=null,clearTimeout(this.internalId)}add(t,e){let i=this.seiList.length;if(this.seiList.length>0)for(i=this.seiList.length-1;i>0&&!(t>this.seiList[i].timeStamp);i--);this.seiList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,this.internalId=setTimeout(this.checkDispatchSeiBind,this.internal))}checkDispatchSei(){if(this.timerStart){let t=this.player.getCurrentRealTime(),e=0,i=null;for(;e<this.seiList.length-2;){if(t>=this.seiList[e].timeStamp&&this.seiList[e+1].timeStamp>t){i=this.seiList[e+1].data,this.player.onH264Sei(i,this.seiList[e+1].timeStamp),this.seiList.splice(0,e+1);break}e++}this.internalId=setTimeout(this.checkDispatchSeiBind,this.internal)}}reset(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}(this),this.seiDataChannelInfos=new za(this),this.scriptVolumeInfos=new class{constructor(t){this.volumeList=[],this.player=t,this.lastTs=-1,this.internal=100,this.timerStart=!1,this.dispatchMap=new Map,this.timer=0}destroy(){this.volumeList=null,this.player=null,clearTimeout(this.timer)}addMixAudio(t,e){if(t.length>0){let i=t.split(",");for(let t=0;t<i.length;t++)this.add(e,i[t])}}add(t,e){let i=this.volumeList.length;if(this.volumeList.length>0)for(i=this.volumeList.length-1;i>0&&!(t>this.volumeList[i].timeStamp);i--);this.volumeList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,this.timer=setTimeout(this.checkDispatchVolume.bind(this),this.internal))}checkDispatchVolume(){if(this.timerStart){let e=this.player.getCurrentRealTime(),i=0,s=null;for(this.dispatchMap.clear();this.volumeList[i]&&this.volumeList[i].timeStamp<e;){s=this.volumeList[i].data;var t=s.split("_");t.length>1&&this.dispatchMap.set(t[0],t[1]),i++}this.dispatchMap.forEach((t,e,i)=>{this.player.onScriptVolumeInfo(e,t)}),this.dispatchMap.clear(),this.volumeList.splice(0,i),this.volumeList.length>0?this.timer=setTimeout(this.checkDispatchVolume.bind(this),this.internal):this.timerStart=!1}}reset(){this.volumeList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}(this),this.onVideoResizeBind=this.onVideoResize.bind(this),this.pid=0,this.bitrate=0,this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.webcodecType=i,this.width=1280,this.height=720,this.widthCfg=1280,this.heightCfg=720,this.realtimeWidth=0,this.realtimeHeight=0,this.mediaElement=null,this.hasRemuxed=!1,this.m4sPlayer=new Ka(this),this.remuxer=new Fr(this),this.avSyncStat=new _a,this.ctrlBuffer=new ma({bufferSize:0,popDuration:Number(o.a.popDuration)||200,timescale:this.remuxer.timescale,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,webcodecType:this.webcodecType},this._remux.bind(this),this),this.renderFps=new fa(this),this.onPageRenderCbkId=0,this.onPageRenderCbkBind=this.onPageRenderCbk.bind(this),window.requestAnimationFrame&&o.a.renderStat[0]&&(this.onPageRenderCbkId=window.requestAnimationFrame(this.onPageRenderCbkBind)),this.videoPlayConsuming=new ga(this),this.audioPlayConsuming=new ga(this),this.audioConfig=Ja.slice(),this.updateAudioConfig({audioConfig:this.audioConfig,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},!0),this.perfBlockCnt=0,this.remuxVideoCnt=0,this.audioEmptyDuration=0,this.audioEmptyList4Sec=[],this.lastSecNow=_.a.now(),this.isNoAudio=!0,Vs.add(this.onCheckFastWorkerTimer,this,100),this.shildAudioStartTs=0,this.isShieldAudio=!1,this.isRevFastOver=!1,this.videoCallBackLargeCnt=0,this.isOnFragParsed=!1,this.onFragParsedTime=0,this.audioSampleNums=0,this.videoSampleNums=0,this.isOnEnded=!1,"visible"==document.visibilityState?this.initTime=_.a.now():this.initTime=0,this.checkScreenTs=0,this.singleColorCnt=0,this.isSingleErr=!1,this.isSingleTest=!1,this.canvas=null,this.context=null,this.isPlayVideo=!1,this.isMuffeled=!1,this.muffleTs=0,this.muffleDuration=0,this.muffleCnt=0,this.videoFirstFrameDecodeCost=0,this.autoMutedPlay=!1,this.userPaused=!1,this.browserStatus=null}setSeiDataChannelPortListers(t){this.seiDataChannl=t}setAutoMutedPlay(t){this.autoMutedPlay=t}onAudioAnalyserInit(t){this.handler&&this.handler.onAudioAnalyserInit&&this.handler.onAudioAnalyserInit(t)}onVisibilitychange(){n.a.log("BaseController.onVisibilitychange",document.visibilityState),"visible"==document.visibilityState?this.initTime=_.a.now():(this.initTime=0,this.singleColorCnt=0)}printAVInfos(){this.parser&&(this.parser.printVideoInfo&&this.parser.printVideoInfo(),this.parser.printAudioInfo&&this.parser.printAudioInfo())}resetHls(){this.parser.reset&&this.parser.reset(),this.remuxer.reset(),this.remuxer.resetInitDts&&this.remuxer.resetInitDts()}onFastOver(){}setParams(t,e){if(this.pid=t,this.bitrate=e,this._initPerf(),this.parser.dropFrameDts){let e=!1;(1===o.a.dropFrameUids[0]||-1!==o.a.dropFrameUids.indexOf(parseInt(t)))&&(e=!0),this.parser.dropFrameDts.open=e}this.parser.dropFrameDts.start()}_initPerf(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}getDelayStat(){return"ts"!==this.videoType?this.parser.sei.getStat():null}onRestart(){n.a.log("BaseController(".concat(this._num_,").onRestart")),this.reset()}onVideoParseInvalid(){this.handler&&this.handler.onVideoParseInvalid&&this.handler.onVideoParseInvalid()}onGop(t){this.handler.onGop&&this.handler.onGop(t),t>this.maxGop&&(this.maxGop=t,n.a.log("BaseController(".concat(this._num_,").onGop update maxGop=")+this.maxGop))}onCheckTimer(t,e){this.parser&&this.parser.fps&&(this.metadata.fps=this.parser.fps.getFps(),this.metadata.recvVideoFps=this.parser.fps.getRecvFps()),this.parser&&this.parser.audioFps&&(this.metadata.audioFps=this.parser.audioFps.getFps(),this.metadata.recvAudioFps=this.parser.audioFps.getRecvFps())}onCheckFastTimer(t,e){1===Number(o.a.isMute)&&this.muffledVoice(),this._getEmptyAudioDuration(t)}getCodecType(){return this.m4sPlayer.isInitLoaded()?V:this.getControllerCodecType()}reset(){this.m4sPlayer.reset()}onEnded(){this.isOnEnded=!0}onCheckFastWorkerTimer(){this.checkSolidColor()}destroy(){window.cancelAnimationFrame&&this.onPageRenderCbkId>0&&(window.cancelAnimationFrame(this.onPageRenderCbkId),this.onPageRenderCbkId=0),Vs.remove(this.onCheckFastWorkerTimer,this),this.buffered&&(this.buffered.destroy(),this.buffered=null),this.bufStat=null,this.pausePerf&&(this.pausePerf.destroy(),this.pausePerf=null),this.pauseStat&&(this.pauseStat.destroy(),this.pauseStat=null),this.metadata=null,this.remuxer&&(this.remuxer.destroy(),this.remuxer=null),this.ctrlBuffer&&(this.ctrlBuffer.destroy(),this.ctrlBuffer=null),this.m4sPlayer&&(this.m4sPlayer.destroy(),this.m4sPlayer=null),this.h264SeiInfos&&this.h264SeiInfos.destroy(),this.h264SeiInfos=null,this.seiDataChannelInfos&&this.seiDataChannelInfos.destroy(),this.seiDataChannelInfos=null,this.scriptVolumeInfos&&this.scriptVolumeInfos.destroy(),this.scriptVolumeInfos=null,this.avSyncStat=null,this.bufStat=null,this.hasRemuxed=!1,this.resetPerfBlockCnt(),this.renderFps&&(this.renderFps.reset(),this.renderFps=null),this.audioEmptyList4Sec=null,this.isNoAudio=!0,this.shildAudioStartTs=0,this.isShieldAudio=!1,this.videoPlayConsuming&&this.videoPlayConsuming.destroy(),this.videoPlayConsuming=null,this.audioPlayConsuming&&this.audioPlayConsuming.destroy(),this.audioPlayConsuming=null,this.initTime=0,this.checkScreenTs=0,this.singleColorCnt=0,this.isSingleErr=!1,this.isSingleTest=!1,this.canvas=null,this.context=null,this.isPlayVideo=!1,this.isMuffeled=!1,this.muffleTs=0,this.muffleDuration=0,this.muffleCnt=0,this.seiDataChannl=null}getControllerCodecType(){return this.parser.getCodecType()}setPushGop(t){this.parser.setPushGop(t)}saveH264SeiData(t,e){this.h264SeiInfos.add(t,e)}saveSeiDataChannel(t,e,i,s){this.seiDataChannelInfos.add(t,e,i,s)}saveSeiInfo(t,e,i){1===Number(f.a._printSeiInfo)&&n.a.log("BaseController.saveSeiInfo, timestamp=".concat(t,", type=").concat(i)),this.handler&&this.handler.eventEmitter.trigger(m.SEI_INFO,{timestamp:t,data:e})}setPlaybackrateAccess(t){this.playbackrateChangeAccess=t}getDelayInfo(){return n.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}setSeiDelay(t){if(this.seiAnchorDelay!==t||!this.mediaDelay){let e=this.getBufferLen();this.isShieldAudio&&(e+=this.getFrameBufferLen()),this.seiAnchorDelay=t,this.mediaDelay={total_delay:this.seiAnchorDelay+e,buffer_delay:e,status:0},0===this.seiAnchorDelay&&(this.mediaDelay.status=1)}}getRealFps(){return this.parser.getRealFps?this.parser.getRealFps():0}getIsDownEnough(){return!this.parser.isDownEnough||this.parser.isDownEnough()}getRealBitrate(){let t=0;return this.parser.fps&&(t=this.parser.fps.getRealBitrate()),t}setDeleteH264Aud(t){this.parser.setDeleteH264Aud(t)}setNeedEmptyAudioFrame(t){this.parser.setNeedEmptyAudioFrame(t)}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;this.JITTER_BUFLEN=t,this.JITTER_BUFMIN=e,this.JITTER_BUFMAX=i,n.a.info("".concat(this._getTag()," BaseController.setJitter bufMin=").concat(e," bufLen=").concat(t," bufMax=").concat(i))}setResolution(t,e){n.a.log("BaseController(".concat(this._num_,").setResolution w/h=")+t+"/"+e),this.width&&this.height&&(this.width!==t||this.height!==e)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_RESOLUTION_CHANGE),this.width=t,this.height=e}getWidth(){return this.width}getHeight(){return this.height}setExceptionStat(t,e){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(t,e)}cacheBlockReason(t,e){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(t,e)}getPlayStat(){return this.parser.getPlayStat()}getCaptureStats(t){return this.parser&&this.parser.vCaptureJitterStat?{video:this.parser.vCaptureJitterStat.getStats(t),audio:this.parser.aCaptureJitterStat.getStats(t)}:null}getPlayVideo(){return this.video?this.video.video:null}getFrameReadyed(){return this.parser&&this.parser.getFrameReadyed?this.parser.getFrameReadyed():0}getFramePlayDelays(){return this.parser.getCalculateVideoFramePlayDelay?this.parser.getCalculateVideoFramePlayDelay():0}getVideoDecodeDelaySmooth(){return 0}getCtsMax(){var t;return(null===(t=this.parser)||void 0===t?void 0:t.ctsMax)||300}getFrameBufferLen(){return this.parser.getFrameBufferLen?this.parser.getFrameBufferLen():0}getContinueBuffer(){return this.buffered.continueBuffer}getVideoContinueBuffer(){return this.buffered.getVideoContinueBuffer()}getParserBufLen(){return this.parser.getParserBufLen()}setSensitivePause(t){this.sensitivePause=t}getInitDts(){return void 0===this.remuxer.getInitDts()?0:this.remuxer.getInitDts()}getCurrentSeiOffsetDts(){return this.offsetDts||0}appendFlv(t){this.parser.parseFlv(t)}appendFlvTag(t,e){this.parser.parseTag(t,this.isPureAudio,e)}_getTag(){let t=this.handler.constructor.name;return this._num_+" "+t}recvDataFull(){this.handler&&this.handler.recvDataFull&&this.handler.recvDataFull()}getVideoFrames(){return this.parser&&this.parser.getVideoFrames?this.parser.getVideoFrames():0}getAudioFrames(){return this.parser&&this.parser.getAudioFrames?this.parser.getAudioFrames():0}getMuted(){return!1}getVideo(){return null}getVolume(){return 0}setVolume(t){this.webcodecType==N.a.PLAYER_CORE_TYPE.MSE?this.video.setVolume(t):this.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.startMuteRender(t)}muffledVoice(){if(!this.handler||!this.handler.getMuffleCacheData)return;const t=_.a.now();let e=this.handler.voiceEliminationData||[],i=!1,s={play:!1,percent:0},r=this.getCurrentDts(),a=this.getBufferLen(),h=0,d=0,l=null,c=[...e],u=this.handler.getMuffleCacheData();const p=u.length;if(0!=u.length){const t=u[0].begin,e=u[p-1].end,c=r-t,m=r-u[0].end,_=r-u[p-1].begin,g=r-e;1==Number(f.a._printMuteInfo)&&n.a.log("MSEPlayer.muffledVoice nowDts=".concat(r,",buffer=").concat(a,",cacheBegin=").concat(t,",cacheEnd=").concat(e,",firstBeginDetla=").concat(c,",firstEndDelta=").concat(m,",lastBeginDelta=").concat(_,",lastEndDelta=").concat(g,",cacheLen=").concat(p)),u.map((t,e)=>{h=t.begin,d=t.end,l=t.muteStyle,0==t.type&&(h+=this.offsetDts,d+=this.offsetDts),r>=h&&r<=d&&(i=!0,o.a.useMuteBiAudio&&l&&1==l.style&&(s={play:!0,percent:l.percent?l.percent:0}),1==Number(f.a._printMuteInfo)&&n.a.log("MSEPlayer.muffledVoicecache data",JSON.stringify(t)))})}c.map((t,e)=>{h=t.begin,d=t.end,0==t.type&&(h+=this.offsetDts,d+=this.offsetDts),r>d&&this.handler.voiceEliminationData.splice(e,1)}),this.setMuffledVolume(i),!this.isMuffeled&&i&&0==this.muffleTs?(this.muffleTs=t,s&&s.play&&this.handler.setMuffled(!0,s)):!i&&this.isMuffeled&&(this.muffleDuration+=t-this.muffleTs,this.muffleCnt++,this.muffleTs=0,this.handler.setMuffled(!1)),this.isMuffeled=i}setMuffledVolume(t){}disableHardAcc(){n.a.log("BaseController.disableHardAcc")}setDisableHardAcc(){n.a.log("BaseController.setDisableHardAcc")}pushAvcSample(t){this.isPureAudio||this.ctrlBuffer.addSample(t)}pushAacSample(t,e){e==Zt?this.ctrlBuffer.addShieldAudioSample(t):this.ctrlBuffer.addSample(t)}appendShieldAudioFlv(t){this.parser2.parseFlv(t,!0)}updateAudioConfig(t,e,i){let{audioConfig:s,codec:r,audioSampleRate:a,aacTimeLen:o,audioObjectType:h,audioChannelCount:l}=t;if(e)this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:o,audioObjectType:h,audioChannelCount:l},!1,$t,e);else{let t=!1,c=s;c.toString(16)!==this.audioConfig.toString(16)&&(this.audioConfig.toString(16)===Ja.toString(16)&&this.remuxer.videoISGenerated&&(t=!0),n.a.warn("MSEPlayer.parseAudio adts changed old='".concat(this.audioConfig,", new='").concat(c,", needReplay=").concat(t))),this.audioConfig=s,this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:o,audioObjectType:h,audioChannelCount:l},t,i,e),this.remuxer.switchLevel(!1,t),this.setExceptionStat(d.a.DIM_LINK_STA.AUDIO_CONFIG,1)}}updateVideoConfig(t,e){this.isPureAudio||this.ctrlBuffer.updateVideoConfig(t,e)}getLastIFrameDts(){return this.ctrlBuffer.getLastIFrameDts()}getFrameBufferLen(){return this.ctrlBuffer.getBufferLen()}getFrameReadyed(){return this.ctrlBuffer.getSize()}setNeedEmptyAudioFrame(t){this.ctrlBuffer.setNeedEmptyAudioFrame(t),n.a.log("FlvParser.setNeedEmptyAudioFrame "+t)}getParserBufLen(){return this.ctrlBuffer.getBufferLen()}_remux(t,e){this._setRemuxed(),this.remuxVideoCnt+=t.samples.length,this.avSyncStat.checkSync(t,e),this.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS?(this.appendAvcTrack(t),this.appendAacSample(e)):this.remuxer&&this.remuxer.remux(e,t,0,!1)}initSegmentSuc(t,e){this.webcodecType!=N.a.PLAYER_CORE_TYPE.MSE&&(n.a.log("BaseController.initSegmentSuc",t,e),this._initSegmentSuc(t),this.updateM4sAudioConfig({codec:"mp4a.40.5",audioSampleRate:e.samplerate,audioChannelCount:e.channel_count}),this.updateAVCConfig({width:t.width,height:t.height}))}_setRemuxed(){this.hasRemuxed||(this.hasRemuxed=!0,this.recvDataFull&&this.recvDataFull())}setPerfCntPlus(){this.perfBlockCnt++}resetPerfBlockCnt(){this.perfBlockCnt=0}getRealFpsAudio(){return this.parser.getRealFpsAudio?this.parser.getRealFpsAudio():0}onVideoResize(t){this.checkResolution()}getVideoWidth(){return 0}getVideoHeight(){return 0}checkResolution(){if(this.h265Proxy&&this.h265Proxy.isReady&&!this.h265Proxy.isH265MseCodec)return;let t=this.getVideoWidth(),e=this.getVideoHeight();n.a.log("MSEPlayer(".concat(this._num_,").checkResolution o_w/o_h=")+this.width+"/"+this.height,"n_w/nh",t,"/",e),this.width&&this.height&&(this.realtimeWidth!==t||this.realtimeHeight!==e)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_RESOLUTION_CHANGE,{width:t,height:e}),this.realtimeWidth=t,this.realtimeHeight=e,this.width=t,this.height=e}setAvcCfg(t,e){t==this.widthCfg&&e==this.heightCfg||(n.a.log("BaseController.setAvcCfg o_w/o_h="+this.widthCfg+"/"+this.heightCfg,"n_w/nh",t,"/",e),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_AVCCFG_CHANGE,{width:t,height:e})),this.widthCfg=t,this.heightCfg=e}getMseAvcCfgWidth(){return this.widthCfg}getMseAvcCfgHeight(){return this.heightCfg}onPageRenderCbk(){if(!this.renderFps)return;window.requestAnimationFrame&&(this.onPageRenderCbkId=window.requestAnimationFrame(this.onPageRenderCbkBind));let t=this.renderFps.addPageRender();t>0&&this.handler&&this.handler.updateCurrentPageRenderFps&&this.handler.updateCurrentPageRenderFps(t)}onScriptVolumeInfo(t,e){this.handler.onSendScriptVolumeInfo(t,e)}onSeiDataChannel(t,e){this.seiDataChannl&&this.seiDataChannl.checkDataChannelPortListener(t)&&(this.handler&&this.handler.eventEmitter.trigger(m.SEI_DATACHANNEL_INFO,e),n.a.log("onSeiDataChannel",t,e))}_getEmptyAudioDuration(t){const e=this.ctrlBuffer.avBuffer.aBuffer.getEmptyeDuration();this.audioEmptyDuration+=e,t-this.lastSecNow>=4e3&&(this.audioEmptyList4Sec.push(Math.floor(this.audioEmptyDuration>4e3?4e3:this.audioEmptyDuration)),this.audioEmptyDuration=0,this.lastSecNow=t)}getEmptyAudioDurationHeart(){return this.ctrlBuffer.avBuffer.aBuffer.getEmptyDurationHeart()}hasAudioCfg(){return this.parser&&this.parser.recvAudioConfig}getEmptyAudioRecord(){const t=[...this.audioEmptyList4Sec];return this.audioEmptyList4Sec.length=0,t}setRealFps(){}setNoAuido(t){this.isNoAudio=t}setStreamFormat(t){this.handler&&this.handler.setStreamFormat&&this.handler.setStreamFormat(t)}switchShieldAudio(t){this.ctrlBuffer.switchShieldAudio(t)}stopShieldAudio(){this.switchShieldAudio(!1),this.isShieldAudio=!1}onSwitchShieldAudioFail(t,e){this.isShieldAudio=!1,this.handler.onSwitchShieldAudioFail&&this.handler.onSwitchShieldAudioFail(t,e)}onSwitchShieldAudioSuc(t){this.isShieldAudio=!0,this.handler.onSwitchShieldAudioSuc&&this.handler.onSwitchShieldAudioSuc(t)}shieldAuidoMute(t,e){n.a.log("MSEPlayer.shieldAudioMute",t,e),this.shildAudioStartTs=e,this.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS?this.setMuted(!0):this.video&&this.video.video&&(this.video.video.muted=!0)}resetPlayer(){this.handler.resetPlayer()}resetAudioDts(){n.a.log("BaseContrller.resetAudioDts curDts=".concat(this.getCurrentDts())),this.ctrlBuffer.resetAudioDts()}getRenderElement(){}getIframePts(){return this.ctrlBuffer&&this.ctrlBuffer.getIframePts?this.ctrlBuffer.getIframePts():0}setIFrameAvcChageStat(){this.handler.setIFrameAvcChageStat()}onRevFastOver(){n.a.log("BaseController.onRevFastOver mse webcodecs jump buffer!"),this.isRevFastOver=!0}getVideoCBLargeCnt(){const t=this.videoCallBackLargeCnt;return this.videoCallBackLargeCnt=0,t}getVideoFrameCallBackNums(){return this.frameCallBackNums||0}isM4sInitLoaded(){return this.m4sPlayer.isInitLoaded()}loadM4sInit(t,e,i){this.m4sPlayer.loadInit(t,e,i)}setFragParsedTime(){this.isOnFragParsed||(this.onFragParsedTime=_.a.now(),n.a.log("MSEPlayer.onFragParsed",this.onFragParsedTime),this.isOnFragParsed=!0,this.firstFragParsed())}firstFragParsed(){}appendM4sSegment(t,e){this.setFragParsedTime(),this.m4sPlayer.appendSegment(t,e)}onM4sError(){this._onErrorEvent(100),this._onPlayerError(!0)}checkSolidColor(){if(!this.isLive)return;if(-1==o.a.testRenderCfg[3].indexOf(h.a.version.major))return;if(0==o.a.testRenderSwitchCfg[0])return;if(!this.isPlayVideo)return;if(this.isSingleErr)return;if(this.isSingleTest)return;if(this.webcodecType!=N.a.PLAYER_CORE_TYPE.WEBCODECS&&!this.getIsMseHevc())return;const t=_.a.now();if(0==this.initTime)return;if(t-this.initTime>=o.a.testRenderCfg[1])return void(this.isSingleTest=!0);if(0!=this.checkScreenTs&&t-this.checkScreenTs<o.a.testRenderCfg[2])return;this.checkScreenTs=t;const e=this.getRenderElement();this.checkForScreen(e)}checkForScreen(t){if(!t)return;let e=null,i=null;if(this.canvas)e=this.canvas,i=this.context;else{let t=!1;try{e=document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0})}catch(e){t=!0,n.a.error("BaseController.checkForWhiteScreen context 2d error",e)}if(t)return}if(!e&&!i)return;this.canvas=e,this.context=i,e.width=100,e.height=50,i.drawImage(t,0,0,e.width,e.height);let s=Math.floor(e.width/2),r=Math.floor(e.height/2),a=e.width-10,h=e.height-10;const d=[{x:s,y:0,w:10,h:10},{x:a,y:0,w:10,h:10},{x:0,y:r,w:10,h:10},{x:s,y:r,w:10,h:10},{x:a,y:r,w:10,h:10},{x:0,y:h,w:10,h:10},{x:s,y:h,w:10,h:10},{x:a,y:h,w:10,h:10}],l=i.getImageData(d[0].x,d[0].y,d[0].w,d[0].h).data,c=d.every((t,e)=>{const s=i.getImageData(t.x,t.y,t.w,t.h).data;return this.isImageDataSame(l,s)});c?this.singleColorCnt++:this.singleColorCnt=0;const u=l.length;let p=!0;for(let t=0;t<u;t+=4)if(0!=l[t+3]){p=!1;break}n.a.log("BaseController.checkForWhiteScreen,isSingleColor=".concat(c,",isTransparent=").concat(p),l.slice(0,24).toString()),(p||1!=o.a.testRenderSwitchCfg[1])&&this.singleColorCnt>=o.a.testRenderCfg[0]&&this.singleColorErrHand(l)}isImageDataSame(t,e){const i=t.length;for(let s=0;s<i;s+=4)if(t[s]!=e[s]||t[s+1]!=e[s+1]||t[s+2]!=e[s+2])return!1;return!0}singleColorErrHand(t){const e=t.slice(0,24).toString();n.a.log("BaseController.singleColorErrHand",e),this.isSingleErr=!0,this.webcodecType==N.a.PLAYER_CORE_TYPE.WEBCODECS?(this.handler&&this.handler.wcsRenderErr&&this.handler.wcsRenderErr(e),f.a._nextWcsRenderErrTime=Date.now()+2592e5,this.onWebcodecsError(ja.a.SCREEN_COLOR)):this.getIsMseHevc()&&(this.handler&&this.handler.mseHevcRenderErr&&this.handler.mseHevcRenderErr(e),f.a._nextMseHevcRenderErrTime=Date.now()+2592e5,this.handler.onMseHevcError(5))}getMuffleStat(){const t={muffleCnt:this.muffleCnt,muffleDuration:this.muffleDuration};return n.a.log("BaseController.getMuffleStat,muffleCnt=".concat(this.muffleCnt,",muffleDuration=").concat(this.muffleDuration)),this.muffleCnt=0,this.muffleDuration=0,t}updateMultiRenderInfo(t){this.handler.updateMultiRenderInfo(t)}onPauseByBrowser(){this.userPaused=!0;let t=this.getVideo();if(t&&this.browserStatus!==p.BROWSER_AUTOPLAY_FAIL){if(this.handler){let e=p.BROWSER_PAUSE,i=m.BROWSER_PAUSE;this.browserStatus===p.BROWSER_PAUSE&&(e=p.BROWSER_AUTOPLAY_FAIL,i=m.BROWSER_AUTOPLAY_FAIL_IN),this.browserStatus=e,this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(e),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(i,{video:t})}this.browserStatus===p.BROWSER_PAUSE&&this.checkAutoMutedPlay()}}checkAutoMutedPlay(){}},$a=s(23);let Za=0;var to=class extends Xa{constructor(t,e){super(t,e,N.a.PLAYER_CORE_TYPE.MSE);let{videoType:i="flv",videoElement:s=null,h265Proxy:r,ignoreSei:a=!1,closeFetch:h=!1,dropBeforeFirstIDR:d=!1,continuousTimeStamp:l=!1}=e;this.MediaSource=$a.a.getMediaSource(o.a.mmsOpen),this.pushVideoStartRenderTime=0,this.h265Proxy=r,this.requestAnimationId=-1,this.isMMS=$a.a.isManagedMediaSource(this.MediaSource),this._num_=++Za,n.a.log("MSEPlayer(".concat(this._num_,").constructor")),"ts"===i?(this.parser=new Xr(this,this.remuxer),this.parser.ignoreSei=a,this.parser.closeFetch=h,this.parser.dropBeforeFirstIDR=d,this.parser.continuousTimeStamp=l):(this.parser=new Te(this,this.remuxer,$t),this.parser.setCorrentDtsOpen(!0),this.parser.repairSameDts=1==o.a.repairSameDts,this.ctrlBuffer.setBuffered(this.buffered),this.parser.dropFrameCtrl.setConfig({dropTime:o.a.dropTime,minFps:o.a.minFps}),this.parser2=new Te(this,this.remuxer,Zt)),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.latencySeek=0,this._triggerPlay=!1,this.hasData=!1,this.playing=!1,this.lastPlayTime=0,this.lastCheckPlayTime=0,this.maxGop=0,this.playStartTime=0,this.delayReset=!1,this.isPlayerError=!1,this.isErrorEvent=!1,this.startPlayBackRate=.9,this.pausedByBrowser=!1,this.tryPlayAgainTimout=0,this.onUpdateErrorBind=this.onUpdateError.bind(this),this.onAudioUpdateEndBind=this.onAudioUpdateEnd.bind(this),this.onVideoUpdateEndBind=this.onVideoUpdateEnd.bind(this),this.onMediaSourceOpenBind=this.onMediaSourceOpen.bind(this),this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoLoadedBind=this.onVideoLoaded.bind(this),this.onLoadedMetadataBind=this.onLoadedMetadata.bind(this),this.checkVideoPlayingBind=this.checkVideoPlaying.bind(this),this.onVideoPlayingBind=this.onVideoPlaying.bind(this),this.onVideoTimeUpdateBind=this.onVideoTimeupdate.bind(this),this.onVideoVolumeChangeBind=this.onVideoVolumeChange.bind(this),this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video=this.createVideo(),this.msePause=new class{constructor(t,e){this._mse=t,this._callbacks=e,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}destroy(){this._mse=null,this._callbacks=null}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}check(){let t=_.a.now(),e=this._mse.video.video;0!=this._lastCheckTime&&1==Number(f.a._printPauseCheck)&&n.a.log("MSEPause.check",t-this._lastCheckTime,e.currentTime),!this._mse.isLive&&e.currentTime<=1||(this._mse.isLive||!this._mse.handler||this._mse.handler.started)&&(0!==this._playedTime&&(e.currentTime===this._playedTime?this._paused?this._fixedCurrentTime(t,e):this._setPaused(t,e):this._paused&&this._setResume(t,e)),this._playedTime=e.currentTime,this._lastCheckTime=t)}_setPaused(t,e){this._paused=!0,this._pausedTs=t,this._lastPausedTs=t,this._log("_setPaused",e),this._callbacks.pause(t)}_setResume(t,e){let i=t-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",e),this._callbacks.resume(t,i)}_fixedCurrentTime(t,e){t-this._lastPausedTs>500&&(this._fixedByBuffered(e)||this._fixedByDts(e))&&(this._lastPausedTs=t)}_fixedByBuffered(t){if("flv"===this._mse.videoType){let e=t.buffered.length;if(e>0){let i=t.buffered.start(e-1),s=t.buffered.end(e-1);if(i>t.currentTime&&s-i>1)return this._log("_fixedByBuffered",t),t.currentTime=i,!0}}else if("ts"===this._mse.videoType&&!this._mse.isLive){const e=((this._mse.handler||{}).playlist||{}).currFrag;let i=2;e&&(i=e.duration);let s=t.buffered.length;for(let e=0;e<s;e++){let s=t.buffered.start(e),r=t.buffered.end(e);if(e>=1&&t.buffered.end(e-1)-t.currentTime<=1&&s>t.currentTime&&s<=t.currentTime+i&&r-s>1)return n.a.log("%cMSEPause.fixedByBuffered currentTime=".concat(t.currentTime," fixed time=").concat(s),"color:#A23400;background:#FFF5C2"),t.currentTime=s,!0}}return!1}_fixedByDts(t){return!!(this._mse.getBufferLen()>2e3&&this._mse.isLive)&&(this._log("_fixedByDts",t),t.currentTime+=1,!0)}_log(t,e,i){this._mse.video.printBuffered();let s=this._mse.getBufferLen();"ts"===this._mse.videoType&&!this._mse.isLive&&this._mse.handler&&(s=this._mse.handler.getBufferLen()),n.a.log("MSEPause(".concat(this._mse._num_,").").concat(t," readyState=").concat(e.readyState," currentTime=").concat(e.currentTime," buf=").concat(s," dts=").concat(this._mse.getCurrentDts()," ").concat(i||""))}}(this,{pause:this._msePaused.bind(this),resume:this._mseResume.bind(this)}),this.msePauseWorker=new class{constructor(t,e){this._mse=t,this._callbacks=e,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}destroy(){this._mse=null,this._callbacks=null}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}check(){let t=_.a.now(),e=this._mse.video.video;if(!(0!=this._lastCheckTime&&t-this._lastCheckTime<50)&&(this._mse.isLive||!(e.currentTime<=1))&&(this._mse.isLive||!this._mse.handler||this._mse.handler.started)){if(0!==this._playedTime){e.currentTime===this._playedTime?this._paused||this._setPaused(t,e):this._paused&&this._setResume(t,e);const i=t-this._lastCheck500Time,s=Math.round(1e3*e.currentTime-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=o.a.pause500Cfg[0]&&(n.a.log("MSEPauseWorker.check.500ms check500Delta=".concat(i,", check500CurrentTimeDelta=").concat(s,", pauseDelta=").concat(i-s)),this._mse.check500Pause()),this._lastCheck500CurrntTime=1e3*e.currentTime,this._lastCheck500Time=t)}this._playedTime=e.currentTime,this._lastCheckTime=t}}_setPaused(t,e){this._paused=!0,this._pausedTs=t,this._lastPausedTs=t,this._log("_setPaused",e),this._callbacks.pause(t)}_setResume(t,e){let i=t-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",e),this._callbacks.resume(t,i)}_log(t,e,i){this._mse.video.printBuffered(),n.a.log("MSEPauseWorker(".concat(this._mse._num_,").").concat(t," readyState=").concat(e.readyState," currentTime=").concat(e.currentTime," buf=").concat(this._mse.getBufferLen()," dts=").concat(this._mse.getCurrentDts()," ").concat(i||""))}}(this,{pause:this._msePausedWorker.bind(this),resume:this._mseResumeWorker.bind(this)}),this.audioSourceBuffer=null,this.videoSourceBuffer=null,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.autoJitter=!0,this.autoBitrateJitter=!1,this.playbackrateChangeAccess=!0,this.enableLowLatency=!1,this.sensitivePause=!0,this.waitSwapToPcdn=!1,this.printJitter=!!Number(f.a._printJitter);let c=navigator.userAgent.toLowerCase();this.isAndroid=-1!==c.indexOf("Android"),-1==n.a.getLevel()&&window.chrome&&(window.chrome.mse=this),this.videoDataAppended=!1,this.avcchangeCheckTimer=0,this.offsetDts=0,this.curVideoDts=0,this.curAudioDts=0,this.isH265Play=!1,this.playRateIncrease=0,this.playRateDecrease=0,this.startPlayTime=0,this.isStartBuffer=!0,this.bufferCd=1e3*o.a.jumpBufferCfg[0],this.startCd=o.a.jumpBufferCfg[3],this.startCdMax=1e3*o.a.jumpBufferCfg[5],this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=1e4,this.maxJumpWaitNow=0,this.lastJumpBufferTs=0,this.mediaDelay=null,this.seiAnchorDelay=-1,this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.isPlaybackRateNormal=!0,this.discontinuityTimeOffset=0,this.frameCallBackNums=0,this.lastFrameCallBackNums=0,this.mseRenderList=[],r&&r.initRender&&r.initRender(this),this.renderList=[],this.renderHiddenTs=0,this.renderListFirst=!0,this.onInitSegmentCb=null,this.videoCallBackTs=0,this.onVisibilityChangedBind=this.onVisibilitychange.bind(this),this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.on(u.VISIBILITY_CHANGE,this.onVisibilityChangedBind),this.isMseRCErrorCnt=0,this._status=null}getVideoWidth(){return this.video.getVideoWidth()}getVideoHeight(){return this.video.getVideoHeight()}onVisibilitychange(){super.onVisibilitychange(),"hidden"==document.visibilityState&&(this.videoCallBackTs=0,this.isMseRCErrorCnt=0)}setParams(t,e){if(this.pid=t,this.bitrate=e,this._initPerf(),this.parser.dropFrameDts){let e=!1;(1===o.a.dropFrameUids[0]||-1!==o.a.dropFrameUids.indexOf(parseInt(t)))&&(e=!0),this.parser.dropFrameDts.open=e}this.parser.dropFrameDts.start()}_initPerf(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}getDelayStat(){return"ts"!==this.videoType?this.parser.sei.getStat():null}getVideoDecodeDelaySmooth(){return 100}getDelayInfo(){return n.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}getRealFps(){return this.parser.getRealFps?this.parser.getRealFps():0}getIsDownEnough(){return!this.parser.isDownEnough||this.parser.isDownEnough()}getRealBitrate(){let t=0;return this.parser.fps&&(t=this.parser.fps.getRealBitrate()),t}destroy(){if(super.destroy(),n.a.log("MSEPlayer(".concat(this._num_,").destroy")),this.onMediaSourceOpenCallback=null,this.h265Proxy&&this.h265Proxy.stop(),this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.off(u.VISIBILITY_CHANGE,this.onVisibilityChangedBind),this.parser.destroy(),this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.onInitSegmentCb=null,this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0]);this.mediaSource=this.onMediaSourceOpenBind=null}this.onAudioUpdateEndBind=this.onVideoUpdateEndBind=this.onUpdateErrorBind=null,this.video&&(this.video.destroy(),this.video=null),this.videoElement=null,this.pushVideoStartRenderTime=0,this.playbackrateChangeAccess=!0,-1!==this.requestAnimationId&&(cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=-1),this.onFragParsedTime=0,X.remove(this.triggerPlayVideo,this)}clearSourceBuffer(){const t=this.video.video;let e=0;if(t){const i=t.buffered.length;e=i>0?t.buffered.end(i-1):e}this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&e>0&&this.audioSourceBuffer.remove(0,e),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&e>0&&this.videoSourceBuffer.remove(0,e)}reset(){if(super.reset(),n.a.log("MSEPlayer(".concat(this._num_,").reset")),this.handler.onVideoStop(this.video.video,!!this.videoSourceBuffer),this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.msePause.paused&&this.handler.onPlayResume(_.a.now()),this.pauseStat.reset(),this.bufStat.reset(),this.msePause.reset(),this.msePauseWorker.reset(),this.maxGop=0,this.isPlaybackRateNormal=!0,clearTimeout(this.tryPlayAgainTimout),this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.playbackrateChangeAccess=!0,this.videoDataAppended=!1,this.onFragParsedTime=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.maxJumpWaitNow=0,this.frameCallBackNums=0,this.lastFrameCallBackNums=0,this.mseRenderList.length=0}resetVideo(){if(this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.videoCodec=null,this.audioCodec=null,this.lastPlayTime=0}createVideo(){this._triggerPlay=!1;let t=this.videoElement;t||(t=document.createElement("video"),t.id="mse".concat(this._num_),t.autoplay="safari"!==h.a.name,t.setAttribute("playsinline",!0),t.setAttribute("webkit-playsinline",!0),t.muted=!1);let e=URL.createObjectURL(this.mediaSource);return $a.a.isManagedMediaSource(this.MediaSource)?(t.disableRemotePlayback=!0,this.addSource(t,e),this.mediaSource.addEventListener("startstreaming",this._onStartStreaming.bind(this)),this.mediaSource.addEventListener("endstreaming",this._onEndStreaming.bind(this)),t.load()):t.src=e,new class{constructor(t,e,i){this.mse=t,this.video=e,this.isOutSide=i,this.playing=!1,this.seekTime=0,this.isMuffled=!1,this.cacheVolume=1,this.seekSuc=!1,this.seeking=!1,this.triggerPlayed=!1,e.addEventListener("pause",t.onVideoPauseBind),e.addEventListener("error",t.onVideoErrorBind),e.addEventListener("play",t.onVideoPlayBind),e.addEventListener("playing",t.onVideoPlayingBind),e.addEventListener("loadeddata",t.onVideoLoadedBind),e.addEventListener("resize",t.onVideoResizeBind),e.addEventListener("timeupdate",t.onVideoTimeUpdateBind),e.addEventListener("volumechange",t.onVideoVolumeChangeBind),this.videoChecker=new Zr(e,t.isPureAudio,{renderCallback:this._renderCallback.bind(this)}),this.videoChecker.start(),this._initAudioAnalyser(e)}_initAudioAnalyser(t){let e=ea.getAnalyser(t);e&&this.mse.onAudioAnalyserInit(e)}isSupportRequestVideoFrameCallback(){return this.video&&this.video.requestVideoFrameCallback}_renderCallback(){this.mse&&this.mse.requestVideoFrameCallback&&this.mse.requestVideoFrameCallback(),this.mse&&this.mse.handler._hyPlayer&&this.mse.handler._hyPlayer.roomRecordStat&&this.mse.handler._hyPlayer.roomRecordStat.renderCallback()}seek(t){this.seekTime=t,this.seeking=!0}realSeek(){if(this.seeking&&this.video&&this.video.buffered.length>0){let t=!1,e=this.video.buffered,i=this.seekTime;for(let s=0;s<e.length;s++){let r=e.start(s),a=e.end(s);r>=i&&r-i<1?(i=r,t=!0,n.a.log("MseVideo._checkSeek out off buffer, reseek=".concat(i))):i>r&&i<a&&(t=!0,n.a.log("MseVideo._checkSeek in buffer, reseek=".concat(i)))}t&&(this.printBuffered(),this.seeking=!1,this.video.currentTime=i,n.a.log("MSEVideo.seek currentTime=".concat(this.video.currentTime," seekTime=").concat(i)))}}checkCurrentTime(){this.video&&(this.video.currentTime=this.video.currentTime)}_checkPlay(){n.a.log("MSEVideo.checkPlay seekTime=".concat(this.seekTime," playing=").concat(this.playing," currentTime=").concat(this.video&&this.video.currentTime)),this.video&&0===this.video.currentTime&&!this.playing?(this.seekTime>0?(this.seekTime++,this.video.currentTime=this.seekTime):this.video.currentTime+=1,this._play()):X.remove(this._checkPlay,this)}play(){"safari"!==h.a.name||this.mse.isLive?(this._play(),X.add(this._checkPlay,this,1e3)):(X.add(this._checkPlay,this,1e3),this.triggerPlayed&&this._play())}triggerPlay(){this.triggerPlayed=!0,this.play()}_play(){if(this.video){let t=this.video.play();t?t.then(()=>{X.remove(this._checkPlay,this),n.a.log("MSEVideo._play suc currentTime=".concat(this.video&&this.video.currentTime," volume=").concat(this.video.volume," audioCtxState=").concat(ea.getState())),this._renderCallback(),o.a.platform===N.a.PLATFORM_TYPE_NAME.wap&&!this.playing&&this.mse&&this.mse.triggerH5PlayVideo(),this.playing=!0,this.video.volume>0&&this.audioContextResume()}).catch(t=>{this.playing=!1;const e=t.toString();n.a.warn("MSEVideo.play error: ".concat(e)),this.mse&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0||this.video.paused)&&(this.mse&&this.mse.onPauseByBrowser(),o.a.platform===N.a.PLATFORM_TYPE_NAME.wap&&X.remove(this._checkPlay,this))}):this.playing=!1}else X.remove(this._checkPlay,this)}pause(){X.remove(this._checkPlay,this),this.video.pause()}getBufferLen(){let t=0;if(this.video){let e=this.video.buffered;e.length>0&&(t=0===this.video.currentTime?1e3*(e.end(e.length-1)-e.start(e.length-1))>>0:1e3*(e.end(e.length-1)-this.video.currentTime)>>0)}return t}printBuffered(){n.a.log(R.b.getBufferedLog(this.video))}getCurrentTime(){return this.seeking&&this.seekTime>0?1e3*this.seekTime:1e3*this.video.currentTime}setVolume(t){this.isMuffled?this.video.volume=0:(this.video.volume=t,t>0&&this.audioContextResume()),this.cacheVolume=t}audioContextResume(){ea.resume()}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.video.volume=0:this.setVolume(this.cacheVolume)}getVolume(){return this.video.volume}setMuted(t){this.video&&(this.video.muted=t,n.a.log("MSEVideo.setMuted ".concat(t," hasVideo=").concat(!!this.videoSourceBuffer," hasAudio=").concat(!!this.audioSourceBuffer)))}getMuted(){return!!this.video&&this.video.muted}getVideoWidth(){return this.video?this.video.videoWidth:0}getVideoHeight(){return this.video?this.video.videoHeight:0}destroy(){if(this.isOutSide||ea.delAnalyser(this.video),this.video.removeEventListener("error",this.mse.onVideoErrorBind),this.video.removeEventListener("pause",this.mse.onVideoPauseBind),this.video.removeEventListener("play",this.mse.onVideoPlayBind),this.video.removeEventListener("playing",this.mse.onVideoPlayingBind),this.video.removeEventListener("loadeddata",this.mse.onVideoLoadedBind),this.video.removeEventListener("resize",this.mse.onVideoResizeBind),this.video.removeEventListener("timeupdate",this.mse.onVideoTimeUpdateBind),this.video.removeEventListener("volumechange",this.mse.onVideoVolumeChangeBind),this.pause(),this.video.src="","function"==typeof this.video.load)try{this.video.load()}catch(t){}this.videoChecker&&this.videoChecker.destroy(),this.videoChecker=null,this.video=null,this.mse=null}}(this,t,!!this.videoElement)}_onStartStreaming(){n.a.log("event _onStartStreaming")}_onEndStreaming(){n.a.log("event _onEndStreaming")}addSource(t,e){const i=document.createElement("source");i.type="video/mp4",i.src=e,t.appendChild(i)}insertDiscontinuity(t){if(this.discontinuityAudio=!0,this.discontinuityVideo=!0,this.discontinuityTimeOffset=t,this.discontinuityTimeOffset>0){let e=Gr;this.cacheBlockReason(e,t)}}getBufferLen(){return this.video?this.video.getBufferLen():0}getSegmentsBufferLen(){return 200*this.videoSegments.length}getCurrentDts(){if(o.a.dtsJumpOpen){if(this.isPureAudio&&this.parser.timelineAudio)return this.parser.timelineAudio.getRealDtsByCurrentTime(this.getCurrentTime());if(this.parser.timelineVideo)return this.parser.timelineVideo.getRealDtsByCurrentTime(this.getCurrentTime())}return this.getCurrentTime()+this.getInitDts()}getCorrentCurrentDts(){return this.isPureAudio&&this.parser.timelineAudio?this.parser.timelineAudio.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.parser.timelineVideo?this.parser.timelineVideo.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.getCurrentTime()+this.getInitDts()}getCurrentTime(){return this.video?this.video.getCurrentTime():0}getCurrentRealTime(){return this.getCurrentDts()}get isMediaSourceOpen(){return this.mediaSource&&"open"===this.mediaSource.readyState}appendFlv(t){this.addPlayEvent(),this.parser.parseFlv(t,this.isPureAudio)}addPlayEvent(){this.hasData||(this.hasData=!0,this.videoElement&&(this.videoElement.addEventListener("loadeddata",this.onVideoLoadedBind),"safari"!==h.a.name||this.isLive||this.videoElement.addEventListener("loadedmetadata",this.onLoadedMetadataBind),this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)))}appendTs(t){this.addPlayEvent(),this.parser.parseTs(t)}checkBuffer(){if(this.video.video.paused||this.video.seeking)return;let t=_.a.now(),e=this.video.video.buffered,i=e.length,s=this.getBufferLen();if(this.bufStat.checkBuffer(t,s),0===this.video.video.currentTime&&0!==this.lastPlayTime)return n.a.warn("MSEPlayer.checkBuffer onPlayerError(true) lastPlayTime="+this.lastPlayTime+" bufLen="+s),this._onPlayerError(!0),this._onErrorEvent(9),void(this.lastPlayTime=0);if(this.lastPlayTime=this.video.video.currentTime,t>this.playStartTime+3e3&&s>4e3&&0==this.video.currentTime&&(i>0&&e.start(0)<=4&&(n.a.log("MSEPlayer.checkBuffer buffer full but can not play"),this.video.currentTime=Math.round(e.start(0)+1)),this.video.play()),0!==this.playStartTime&&t>this.playStartTime+5e3&&(s>5e3||0===s))if(0==this.video.video.currentTime&&s>2e3)n.a.log("MSEPlayer(".concat(this._num_,") ####### currentTime=0 ++ bufLen=").concat(s," paused=").concat(this.video.video.paused)),this.video.play();else if(this.playStartTime=0,0===this.video.video.currentTime&&!this.isAndroid)return n.a.warn("MSEPlayer(".concat(this._num_,").checkBuffer onPlayerError(true) playTime=")+this.video.video.currentTime+" bufLen="+s),this._onErrorEvent(6),void this._onPlayerError(!0);null==this.videoElement&&i&&this.video.video.currentTime-e.start(0)>20&&(this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&this.audioSourceBuffer.remove(0,this.video.video.currentTime-10),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&this.videoSourceBuffer.remove(0,this.video.video.currentTime-10))}_onPlayerError(t){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(t))}_onErrorEvent(t){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:t}))}onParseError(t){this._onErrorEvent(t)}onAvcCfgChange(){return n.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange")),this.getBufferLen()<500?(n.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange reset player")),this.remuxer.reset(),this.parser.setPaused(!1),!1):(this.delayReset=!0,!0)}getMaxGop(){return this.maxGop}setEnableLowLatency(t){this.enableLowLatency=t}getVideo(){return this.video&&this.video.video}getVolume(){return this.video?this.video.getVolume():-1}setMuted(t){this.video&&(this.video.setMuted(t),n.a.log("MSEPlayer.setMuted ".concat(t," hasVideo=").concat(this._hasVideo()," hasAudio=").concat(this._hasAudio())))}getMuted(){return!!this.video&&this.video.getMuted()}setExceptionStat(t,e){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(t,e)}cacheBlockReason(t,e){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(t,e)}turnToH264(t){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(t)}on265StartCodeError(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}h265Retry(){this.h265Proxy&&this.h265Proxy.stop(),this.handler.h265Retry()}onInitSegment(t){this.onInitSegmentCb&&this.onInitSegmentCb(),t.audioCodec&&(this.audioCodec=t.audioCodec),t.videoCodec&&(this.videoCodec=t.videoCodec,this.getVideoCapabilities(t),this.handler&&this.handler.onInitSegment&&this.handler.onInitSegment()),this.isMediaSourceOpen&&this.initSourceBuffer(),t.audioMoov&&this.audioSegments.push(t.audioMoov),t.videoMoov&&this.videoSegments.push(t.videoMoov),this.playStartTime=0}onFragParsing(t){"audio"===t.type?this.audioSegments.push(t.data):"video"===t.type&&this.videoSegments.push(t.data)}onFragParsed(){this.userPaused||(this.audioSourceBuffer&&this.appendBuffer("audio"),this.videoSourceBuffer&&this.appendBuffer("video"),null==this.videoElement&&this.isLive&&(this.setFragParsedTime(),this.handler.isMutilVideo&&this.handler.isMutilVideo()||this.triggerPlay()))}firstFragParsed(){super.firstFragParsed(),this.video.play()}checkVideoPlaying(){0==this.pushVideoStartRenderTime&&this.video&&this.video.video&&this.video.video.videoWidth>0&&this.video.video.videoHeight>0?this.pushVideoStartRenderTime=_.a.now():this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)}onLoadedMetadata(t){n.a.log("MSEPlayer.onLoadedMetadata"),this.onVideoLoaded()}onVideoLoaded(){n.a.log("check MSEPlayer.onVideoLoaded",h.a.name,this.video.video.videoWidth,this.video.video.videoHeight),this.triggerPlay()}reloadInError(){this.handler.reloadInError&&this.handler.reloadInError()}initSourceBuffer(){if(f.a._localVideoCodec&&""!=f.a._localVideoCodec&&(this.videoCodec=f.a._localVideoCodec),this.audioCodec&&!this.audioSourceBuffer){n.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer audio codec=")+this.audioCodec);try{this.audioSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.audioCodec)),this.audioSourceBuffer.addEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){return n.a.warn("MSEPlayer.initSourceBuffer audio err="+t.message),t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(n.a.log("MSEPlayer.initSourceBuffer resetMediasource in audio"),this.handler.resetMediasource)?void this.handler.resetMediasource():(this._onErrorEvent(4),void this._onPlayerError(!0))}}else this.audioCodec&&this.audioSourceBuffer&&this.discontinuityAudio&&(n.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset audio codec=")+this.audioCodec),this.audioSourceBuffer.changeType("video/mp4;codecs=".concat(this.audioCodec)));if(this.videoCodec&&!this.videoSourceBuffer){n.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer video codec=")+this.videoCodec);try{this.videoSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.videoCodec)),this.videoSourceBuffer.addEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){if(t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(n.a.log("MSEPlayer.initSourceBuffer resetMediasource in video"),this.handler.resetMediasource))return void this.handler.resetMediasource();n.a.warn("MSEPlayer(".concat(this._num_,").initSourceBuffer video err=")+t.message),this.getIsMseHevc()?this.handler.onMseHevcError(1):(this._onErrorEvent(5),this._onPlayerError(!0))}}else this.videoCodec&&this.videoSourceBuffer&&this.discontinuityVideo&&(n.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset video codec=")+this.videoCodec),this.videoSourceBuffer.changeType("video/mp4;codecs=".concat(this.videoCodec)));this.discontinuityVideo=!1,this.discontinuityAudio=!1}appendBuffer(t){const e=_.a.now();if(0!=this.mediaSource.sourceBuffers.length&&!this.isPlayerError)if("audio"==t){if(this.audioSegments.length>0&&this.audioSourceBuffer&&!this.audioSourceBuffer.updating){let i=this.audioSegments.shift();try{this.audioSourceBuffer.appendBuffer(i),this.videoDataAppended=!0,this.audioPlayConsuming.pushRemuxedVideoFrameData(e)}catch(t){n.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer audio err=")+t.message),this._onErrorEvent(7),this._onPlayerError(!0)}}}else{if("video"!=t)throw new Error("MSEPlayer(".concat(this._num_,").appendBuffer type error! Valide type is audio or video."));if(this.videoSegments.length>0&&this.videoSourceBuffer&&!this.videoSourceBuffer.updating){let i=this.videoSegments.shift();try{this.videoSourceBuffer.appendBuffer(i),this.videoDataAppended=!0,this.videoPlayConsuming.pushRemuxedVideoFrameData(e)}catch(t){n.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer video err=")+t.message),this._onErrorEvent(8),this._onPlayerError(!0)}}}}triggerH265Play(t,e){this.isH265Play||(n.a.log("MSEPlayer.triggerH265Play"),this.isH265Play=!0,this.h265Proxy&&this.h265Proxy.reportDecodeRenderTime(t,e)),!this.videoElement&&this.isLive||(n.a.log("MSEPlayer.triggerH265Play.triggerPlay"),this.triggerPlay())}triggerPlay(){if(!this.playing&&this.isMediaSourceOpen){if(n.a.log("check MSEPlayer.triggerPlay",h.a.name,this.video.video.videoWidth,this.video.video.videoHeight),this.playing=!0,this.playStartTime=_.a.now(),o.a.platform===N.a.PLATFORM_TYPE_NAME.wap&&null!=this.videoElement)return;"safari"===h.a.name?(o.a.safariFirstLoad?(o.a.safariFirstLoad=!1,this.triggerPlayVideo()):X.once(this.triggerPlayVideo,this,o.a.safariPlayDelay),this.video.triggerPlay()):this.triggerPlayVideo()}}triggerPlayVideo(){let t=!!this.videoSourceBuffer,e=this.getCodecType();const i=this.h265Proxy&&this.h265Proxy.isH265MseCodec;n.a.log("MSEPlayer.onPlayVideo codec: ".concat(e).concat(i?" (mse)":"")),0==this.parser.decodeIFRTime&&1==Number(o.a.isNoVideoReport)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(u.P2P_REPORT);let s=null;e===b&&this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.canvas,e===b&&this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.isVideoTrack?this.handler.onPlayVideo(this.h265Proxy.canvas,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime,e):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,this.h265Proxy.canvas,this.onFragParsedTime,e):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime,e),this.startPlayTime=_.a.now(),this.isPlayVideo=!0}triggerH5PlayVideo(){if(n.a.log("trigger h5 video play"),this.pausedByBrowser)return void(this.pausedByBrowser=!1);this.startPlayTime=_.a.now();const t=this._hasVideo();this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime)}onH264Sei(t,e){this.handler.onSendSeiData(t,e,this.video.video.currentTime)}onMediaSourceOpen(){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind),n.a.log("MSEPlayer.onMediaSourceOpen"),this.m4sPlayer.onMediaSourceOpen(this.mediaSource),(this.audioSegments.length>0||this.videoSegments.length>0)&&(this.initSourceBuffer(),this.appendBuffer("audio"),this.appendBuffer("video"),0==this.onFragParsedTime&&(this.onFragParsedTime=_.a.now()),null==this.videoElement&&this.triggerPlay())}onAudioUpdateEnd(){this.checkSeek(),this.appendBuffer("audio"),this.checkAppendOver()}onVideoUpdateEnd(){this.checkSeek(),this.appendBuffer("video"),this.checkAppendOver()}checkSeek(){this.video.realSeek()}checkCurrentTime(){this.video.checkCurrentTime()}checkAppendOver(){0===this.videoSegments.length&&0===this.audioSegments.length&&(this.videoSourceBuffer&&this.videoSourceBuffer.updating||this.audioSourceBuffer&&this.audioSourceBuffer.updating||this.handler&&this.handler.onSBUpdateEnd&&this.handler.onSBUpdateEnd())}onUpdateError(t){n.a.warn("MSEPlayer.onUpdateError",t)}onVideoPause(t){n.a.log("MSEPlayer.onVideoPause"),this.userPaused=!0,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause()}onPauseByBrowser(){n.a.log("MSEPlayer.onPauseByBrowser autoMutedPlay=".concat(this.autoMutedPlay," volume=").concat(this.getVolume()," muted=").concat(this.getMuted()," paused=").concat(this.video.video.paused)),super.onPauseByBrowser(),this.browserStatus!==p.BROWSER_PAUSE&&this.browserStatus!==p.BROWSER_AUTOPLAY_FAIL||(this.pausedByBrowser=!0,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause(),this.handler&&1===o.a.h5FirstPlay&&this.handler&&this.handler.onVideoStop&&this.handler.onVideoStop(this.getVideo(),this._hasVideo()))}checkAutoMutedPlay(){let t=this.getVolume();n.a.log("MSEPlayer.checkAutoMutedPlay volume=".concat(t,", muted=").concat(this.getMuted(),", paused=").concat(this.video.video.paused)),this.autoMutedPlay&&(t>0&&this.setVolume(0),this.video.play())}onVideoTimeupdate(){this.handler&&this.handler.onVideoTimeupdate&&this.handler.onVideoTimeupdate()}onVideoVolumeChange(){n.a.log("MSEPlayer.onVideoVolumeChange volume: ".concat(this.getVolume(),", muted: ").concat(this.getMuted())),this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(u.VOLUME_CHANGE,{volume:this.getVolume(),muted:this.getMuted()})}onVideoPlaying(){if(this.handler&&this.handler.updateStatus){if(this.video&&this.video.video&&this.video.video.paused)return void n.a.log("video is playing, video.paused=",this.video.video.paused);n.a.log("video is playing",this.isPureAudio);const t=this.isPureAudio?p.AUDIO_PLAYING:p.VIDEO_PLAYING;this.handler.updateStatus(t)}}onVideoPlay(t){n.a.log("MSEPlayer.onVideoPlay"),this.userPaused=!1,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPlay&&this.h265Proxy.onVideoPlay()}onVideoError(t){let e="";if(this.video.video.error){let t=this.video.video.error.code;e=" errCode="+t+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][t],3!=t&&4!=t||(this.getIsMseHevc()?this.handler.onMseHevcError(2):(this._onErrorEvent(3==t?1:2),this._onPlayerError(!0)),f.a.decodeabnormal="abnormal_"+(new Date).getTime(),3==t&&this.handler.decoderDecodeError())}n.a.warn("MSEPlayer(".concat(this._num_,").onVideoError id=").concat(t.currentTarget.id)+e,t),this.isLive||T.getFirstFragStatus()===y&&T.setFirstFragStatus(-4)}pause(){n.a.info("MSEPlayer.pause"),this.userPaused=!0,this.video&&this.video.pause()}play(){n.a.info("MSEPlayer.play"),this.userPaused=!1,this.video&&this.video.play()}resetHls(){this.parser.pushAllData&&this.parser.pushAllData(),super.resetHls(),this.clearSourceBuffer()}seek(t){this.lastPlayTime=t,n.a.info("MSEPlayer.seek seekTime="+t,"currentTime="+this.video.video.currentTime),this.video&&this.video.seek(t)}onCheckTimer(t,e){if(!this.playing||!this.isMediaSourceOpen)return void(this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo());if(super.onCheckTimer(t,e),0!=this.shildAudioStartTs&&this.video&&this.video.video){let t=this.getCurrentDts();this.video.video.muted&&t>=this.shildAudioStartTs&&(n.a.log("MSEPlayer.shieldAudioMute recover"),this.video.video.muted=!1,this.shildAudioStartTs=0)}let i=this.getBufferLen(),s=Number(f.a._printBufferLen);if(-1==s||s>0&&s==this._num_){let t=Math.max(0,i/100);n.a.debug(this._getTag(),"bufLen","-".repeat(t),i)}if(Number(f.a._printMseLog)&&this.audioSegments&&this.videoSegments&&n.a.debug("MSE aSegments=".concat(this.audioSegments.length," vSegments=").concat(this.videoSegments.length," bufLen=").concat(this.getBufferLen())),this.video.video.paused||this.userPaused)return;if(this.checkVideoRenderFrames(),null==this.videoElement&&this.isLive&&e%4==0&&i>o.a.jitJump[0]&&!Number(f.a._localFlvTest)){let t=.001*(o.a.jitJump[0]-o.a.jitJump[1]);this.video.video.currentTime+=t,n.a.warn("MSEPlayer.onCheckTimer jumpTs=".concat(t," bufLen=").concat(this.getBufferLen()))}this.checkBuffer();let r=(this.handler?this.handler.lastEmptySliceTs:0)||0,a=r>0&&t-r<3e3,h=this._hasVideo();this.isLive&&h&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>5e3&&!a&&this.sensitivePause&&(n.a.warn("MSEPlayer.onCheckTimer paused 5 sec."),this._onErrorEvent(3),this._onPlayerError(!0),this.handler&&this.handler.onPause5Sec&&this.handler.onPause5Sec())}checkVideoRenderFrames(){let t=this.frameCallBackNums-this.lastFrameCallBackNums;this.parser&&this.parser.fps&&(this.parser.fps.getRecvFps()>=25&&0==t&&"visble"==document.visibilityState?this.isMseRCErrorCnt++:this.isMseRCErrorCnt=0,this.getIsMseHevc()&&this.video&&this.video.isSupportRVCB&&1==o.a.isMseCheckRcRd&&this.isMseRCErrorCnt>=10&&(n.a.log("MSEPlayer.checkVideoRenderFrames, close mse hevc!"),this.handler.onMseHevcError(3)));const e=_.a.now();this.renderList.length>=5&&this.renderList.shift(),"hidden"==document.visibilityState?(this.renderList.length=0,this.renderHiddenTs=e):(e-this.renderHiddenTs>=1e3||0==this.renderHiddenTs)&&!this.renderListFirst&&this.renderList.push(t),1==Number(f.a._printVideoCallBackFps)&&n.a.log("MSEPlayer.checkVideoRenderFrames,isHevc=".concat(isHevc,",rfps=").concat(t,",vs=").concat(document.visibilityState,",rl=").concat(this.renderList.toString(),",ecECnt=").concat(this.isMseRCErrorCnt)),this.mseRenderList.push(t),this.renderListFirst=!1,this.lastFrameCallBackNums=this.frameCallBackNums}getMseRenderList(){let t=[...this.mseRenderList];return this.mseRenderList.length=0,n.a.log("MSEPlayer.renderList",t.toString()),t}onCheckFastTimer(t,e){if(super.onCheckFastTimer(t),!this.playing||!this.isMediaSourceOpen||this.video.video.paused||this.userPaused)return;this.checkEmptyFrames(),this.checkDelayReset(),this.onJitterTimer(),this.msePause.check(t);let i=(this.handler?this.handler.lastEmptySliceTs:0)||0,s=i>0&&t-i<3e3,r=this._hasVideo();if(null==this.videoElement&&!this.pause500checked&&r&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>500&&!s){this.pause500checked=!0;let t=this.bufferedInfo(),e=t.bufferLen.toFixed(2),i=(t.nextStart-t.end).toFixed(2);if(n.a.info("MSEPlayer(".concat(this._num_,").onCheckFastTimer paused"),"bufferLen="+e,"hole="+i,"nextStart="+t.nextStart.toFixed(2),"currentTime="+this.video.video.currentTime,"audioSegments=".concat(this.audioSegments.length," videoSegments=").concat(this.videoSegments.length," videoSamples=").concat(this.ctrlBuffer.avBuffer.vBuffer.getInfo()," audioSamples=").concat(this.ctrlBuffer.avBuffer.aBuffer.getInfo())),this.isLive&&"ts"!=this.videoType){this.video.printBuffered();let e=Number(t.nextStart);this.video.video&&e&&i>0&&i<3&&e-this.video.video.currentTime>.5&&(this.video.video.currentTime=e,n.a.log("MSEPlayer(".concat(this._num_,").onCheckFastTimer try jump currentTime=")+this.video.video.currentTime))}}}onCheckFastWorkerTimer(t){super.onCheckFastWorkerTimer(t),this.playing&&this.isMediaSourceOpen&&!this.video.video.paused&&!this.userPaused&&this.msePauseWorker.check(t)}checkEmptyFrames(){this.handler.setEmptyFrames&&this.parser.hasEmptyFrames&&this.handler.setEmptyFrames(this.parser.hasEmptyFrames)}checkDelayReset(){this.delayReset&&this.getBufferLen()<500&&(n.a.log("MSEPlayer(".concat(this._num_,").checkDelayReset reset player")),this.remuxer.reset(),this.parser.setPaused(!1),this.delayReset=!1)}_hasAudio(){return!!this.audioSourceBuffer||this.m4sPlayer&&this.m4sPlayer.hasVideo()}_hasVideo(){return!!this.videoSourceBuffer||this.m4sPlayer&&this.m4sPlayer.hasVideo()}_msePaused(t){this.pauseStat.pause(),this.handler.onPlayPause(t,this._hasVideo())}_mseResume(t,e){this.pauseStat.resume(),this.pause500checked=!1,this.handler.onPlayResume(t,this._hasVideo())}_msePausedWorker(t){this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(t,this._hasVideo())}_mseResumeWorker(t,e){this.parser.dropFrameCtrl&&this.pausePerf.checkLive(this.pid,this.bitrate,this.pauseStat.getCnt(),this.buffered.continueBuffer)&&(this.parser.dropFrameCtrl.start(),this.parser.dropFrameDts.start()),this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(t,this._hasVideo())}bufferedInfo(){let t,e,i,s,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,o=[],n=[],h=this.video.video.buffered;for(r=0;r<h.length;r++)o.push({start:h.start(r),end:h.end(r)});for(o.sort((t,e)=>{return t.start-e.start||e.end-t.end}),r=0;r<o.length;r++){let t=n.length;if(t){let e=n[t-1].end;o[r].start-e<a?o[r].end>e&&(n[t-1].end=o[r].end):n.push(o[r])}else n.push(o[r])}let d=this.video.video.currentTime;for(r=0,t=0,e=i=d;r<n.length;r++){let o=n[r].start,h=n[r].end;if(d+a>=o&&d<h)e=o,i=h,t=i-d;else if(d+a<o){s=o;break}}return s||(s=i),{bufferLen:t,start:e,end:i,nextStart:s}}printBuffer(t){if(this.video.video){let e=this.video.video.buffered,i="buffered=["+(1e3*e.start(0)|0)+","+(1e3*e.end(0)|0)+"]",s=1e3*this.video.video.currentTime>>0,r=this.getBufferLen();n.a.log("MSEPlayer(".concat(this._num_,").printBuffer ").concat(t," currentTime=").concat(s," bufLen=").concat(r," ").concat(i))}}playbackRateSet(t){const e=this.getPlayVideo();if(!e)return;const i=t=>{if(this.playRateIncrease%2!=0)return;let i=t<1&&t+.02>1?1:t+.02;i>o.a.playbackrateMax&&(i=o.a.playbackrateMax),this.playRateDecrease=0,e.playbackRate=i},s=t=>{if(this.playRateDecrease%2!=0)return;let i=t>1&&t-.02<1?1:t-.02;i<o.a.playbackrateMin&&(i=o.a.playbackrateMin),this.playRateIncrease=0,e.playbackRate=i},r=this.getBufferLen();let a=e.playbackRate;t<0?s(a):t>0?i(a):1!==a&&(a<1&&r<this.JITTER_BUFLEN?s(a):a>1&&r>this.JITTER_BUFLEN?i(a):e.playbackRate=1),this.playRateDecrease++,this.playRateIncrease++}setMuffledVolume(t){this.video.setMuffledVolume(t)}setPlaybackRate(t){if(this.handler&&this.handler._hyPlayer&&this.handler._hyPlayer.getSupportAuto&&!this.handler._hyPlayer.getSupportAuto())return;let e=this.getPlayVideo();e&&(e.playbackRate=t)}onJitterTimer(t,e){if(!this.playing)return;if("ts"==this.videoType&&!this.isLive)return;if(!this.autoJitter)return;if(this.autoBitrateJitter)return;let i=this.getPlayVideo();if(!i)return;let s=this.getBufferLen();if(o.a.getEnableJumpBuffer()||this.isShieldAudio){let t=_.a.now();if(this.latencySeek>0&&s>4e3)return void(i.currentTime+=s-this.latencySeek);if(this.enableLowLatency&&s>Number(o.a.jitLowLatency))i.currentTime+=s-o.a.jitLowLatency;else{let e=this.getFrameBufferLen();1==o.a.jumpBufferCfg2[0]&&(s+=e);let i=s-this.JITTER_BUFLEN;if(t-this.startPlayTime<this.startCd)return;if(this.isShieldAudio){let t=e+s;const r=this.JITTER_BUFLEN+o.a.shieldAudioCfg[1],a=this.JITTER_BUFLEN;if(this.printJitter&&n.a.log("MSEPlayer.onJitterTimer.shield bufLen=".concat(s,",frameBufLen=").concat(e,",minusBuffer=").concat(i,",newBuf=").concat(t-i)),i=t-r,i<=0)return;if(s-i<a&&(i=s-a),i<0)return}if(this.isStartBuffer)i>=o.a.jumpBufferCfg[1]&&(this.isRevFastOver||t-this.startPlayTime>=this.startCdMax)&&this.setJumpBufferCurrentTime(i,s,1,t);else if(t-this.setVideoCurrentTime>=this.bufferCd||0==this.setVideoCurrentTime){if(t-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime)return void this.setJumpBufferCurrentTime(i,s,2,t);i>=o.a.jumpBufferCfg[1]?0==this.startMoreBufferTime&&(this.startMoreBufferTime=t):this.startMoreBufferTime=0}}}else if(this.latencySeek>0&&s>4e3)i.currentTime+=s-this.latencySeek;else try{let t=0;if(s<this.JITTER_BUFMIN?t=s-this.JITTER_BUFLEN:s>this.JITTER_BUFMAX&&(t=s-this.JITTER_BUFMAX),this.enableLowLatency&&s>Number(o.a.jitLowLatency))i.playbackRate=1.1;else if(this.playbackrateChangeAccess){t=Number(f.a.ab_adjust)||t,1!=i.playbackRate&&this.isPlaybackRateNormal&&n.a.log("MSEPlayer.onJitterTimer.playbackRate=",i.playbackRate),1!=i.playbackRate?this.isPlaybackRateNormal=!1:this.isPlaybackRateNormal=!0,this.playbackRateSet(t)}else i.playbackRate=1;-1===Number(f.a._print_ab_log)&&n.a.log("BUFMIN: %d, BUFMAX: %d, BUFLEN:%d, bufLen: %d, adjust: %d, playbackRate: %f",this.JITTER_BUFMIN,this.JITTER_BUFMAX,this.JITTER_BUFLEN,s,t,i.playbackRate)}catch(t){n.a.error("MSEPlayer.onJitterTimer set playbackRateSet error",t)}}setJumpBufferCurrentTime(t,e,i,s){this.lastJumpBufferTs=s||_.a.now(),this.h265Proxy&&this.h265Proxy.isReady&&!this.h265Proxy.isH265MseCodec?(-1==f.a._printWasmJump&&n.a.log("MSEPlayer.setJumpBufferCurrentTime",t,e,i,s),this.h265Proxy.jumpBuffer(t,e,i,s)):this.setVideoCurrentTimeHand(t,e,i,s)}setVideoCurrentTimeHand(t,e,i,s){let r=this.getPlayVideo();if(!r)return;let a="";1===i?(this.isStartBuffer=!1,a="fiveJump"):2===i&&(a="ContinueJudgeJump",this.startMoreBufferTime=0),n.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(a," video.currentTime before=").concat(r.currentTime," bufLen=").concat(e," minusBuffer=").concat(t," curDts=").concat(this.getCurrentDts())),r.currentTime+=t/1e3,this.setVideoCurrentTime=s,n.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(a," video.currentTime now=").concat(r.currentTime," curDts=").concat(this.getCurrentDts()," bufLen=").concat(this.getBufferLen()," frameBufLen=").concat(this.getFrameBufferLen()))}onWasmRenderCallback(){this.video._renderCallback()}requestVideoFrameCallback(){if(this.frameCallBackNums++,o.a.renderStat[0]){this.renderFps&&this.renderFps.addRender();const t=_.a.now(),e=t-this.videoCallBackTs;0!=this.videoCallBackTs&&e>=200&&(n.a.log("MSEPlayer.requestVideoFrameCallback dis=".concat(e)),this.videoCallBackLargeCnt++);const i=this.getCurrentRealTime();this.audioPlayConsuming.addRenderFrameData(i,t),this.videoPlayConsuming.addRenderFrameData(i,t),this.videoCallBackTs=t}}getOsDiscardConfig(){let t=D.a.os||"",e=D.a.osVersion||"";return!("windows"!=t.toLocaleLowerCase()||7!=Number(e))||1==Number(f.a._enableOsDiscardFrame)}getIsMseHevc(){return this.videoCodec&&(-1!=this.videoCodec.indexOf("hev")||-1!=this.videoCodec.indexOf("hvc"))}getVideoCapabilities(t){navigator&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:'video/mp4;codecs="'.concat(t.videoCodec,'"'),width:t.videoWidth,height:t.videoHeight,bitrate:1e4,framerate:60}}).then(t=>{t&&t.supported&&n.a.log("MSEPlayer.getVideoCapabilities",JSON.stringify(t))})}switchShieldAudio(t){this.ctrlBuffer.switchShieldAudio(t)}check500Pause(){this.handler.check500Pause&&this.handler.check500Pause()}isSupportRequestVideoFrameCallback(){return this.video&&this.video.isSupportRequestVideoFrameCallback()}getRenderElement(){return this.getCodecType()===b&&this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.getRenderElement():this.video.video}};if(!Object.values){const t=Function.bind.call(Function.call,Array.prototype.reduce),e=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),i=Function.bind.call(Function.call,Array.prototype.concat),s=Reflect.ownKeys;Object.values=function(r){return t(s(r),(t,s)=>i(t,"string"==typeof s&&e(r,s)?[r[s]]:[]),[])}}var eo=class{constructor(t){this.player=t,this.recordMap=new Map,this.init(),this.reset()}destroy(){this.player=null,this.recordMap&&this.recordMap.clear(),this.recordMap=null,this.exceptionStat=null,this.keys=null}init(){this.keys=Object.values(d.a.DIM_LINK_STA);let t=this.keys.indexOf(d.a.DIM_LINK_STA.name);-1!==t&&this.keys.splice(t,1)}setStat(t,e){this.recordMap.has(t)||(this.recordMap.set(t,1),this.exceptionStat[t]=e)}getStat(){this.player.getDurationTime&&this.player.getDurationTime()>2&&this.setStat(d.a.DIM_LINK_STA.DATA_ENOUGH,1);let t=[];return Object.keys(this.exceptionStat).forEach(e=>{t.push("".concat(e,":").concat(this.exceptionStat[e]))}),t.join(",")}reset(){this.recordMap.clear(),this.exceptionStat={},this.keys.forEach(t=>{this.exceptionStat[t]=0})}},io=class{constructor(t){this.iHEVCBitRate=t.iHEVCBitRate,this.iCodecType=t.iCodecType,this.iBitRate=t.iBitRate,this.bitrate=t.bitrate}};let so=0;var ro=class{constructor(t){this._id=so++,this._callbacks=t,this._timeout=!1,this._destroy=!1,this._timeoutTime=1e3,this._onRspBind=this._onRsp.bind(this)}destroy(){this._destroy=!0,this._callbacks=null,X.remove(this._onTimeout,this)}sendP2PFlv(t){let e=t.info,i=this._getReq(t);i.mAppendInfo.value={streamType:t.type,expVideoFps:t.metadata&&t.metadata.fps||0,expAudioFps:t.metadata&&t.metadata.audioFps||0,codeRate:e.curBitrate,isOriginal:Number(0===e.originalBitrate),line:t.lineType,codeType:t.isH265?"265":"264",sStreamName:e.sStreamName,playType:t.playType,isServer:0,iIsP2PSupport:e.iIsP2PSupport},this._sendReq(i)}sendAuto(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._timeoutTime=e;let i=this._getReq(t);i.mAppendInfo.value=t.appendInfo,this._sendReq(i)}_getReq(t){let e=new tt.HUYA.RecSysReq;return e.tId.iAppid=v.a.appid,e.tId.lUid=v.a.uid,e.tId.sGuid=v.a.sGuid,e.tId.sUA="webh5",e.sAnchorUid=t.presenterUid,e.sRoomId=t.roomId,e.iScene=t.scene,e.bDebug=0,e}_sendReq(t){let e=Object.assign({},t);n.a.log("RecSysProxy(".concat(this._id,").sendReq"),t,JSON.stringify(e)),r.sendWup("mediaui","getMediaRec",t,this._onRspBind,!0,r.getRequestId(),!0),X.once(this._onTimeout,this,this._timeoutTime)}_onRsp(t){if(1==f.a._testTimeout)return void n.a.log("RecSysProxy._onRsp _testTimeout=".concat(f.a._testTimeout));X.remove(this._onTimeout,this);let e=Object.assign({},t);n.a.log("RecSysProxy(".concat(this._id,").onRsp"),t,JSON.stringify(e)),this._destroy||this._callbacks&&this._callbacks.onRsp(t)}_onTimeout(){this._callbacks&&this._callbacks.onTimeout&&this._callbacks.onTimeout()}},ao=1,oo=class{constructor(t){this.ctrlBitrate=t,this.timeLineTs=0,this.sampleTs=0,this.sampleCheckTs=0,this.sampleDts=0,this.sampleCheckDts=0,this.printTs=0,this.printSampleTs=0,this.printSampleDts=0,this.startTs=0,this.startDts=0,this.cnt12=0}destroy(){this.ctrlBitrate=null}start(t,e){n.a.log("EvalBw.start now=".concat(t," dts=").concat(e)),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=t,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=e,this.cnt12=0}stop(){this.reset()}reset(){n.a.log("EvalBw.reset"),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=0,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=0,this.cnt12=0}onCheckFastTimer(t,e){if(this.startTs>0){let e=t-this.timeLineTs;if(e>300){let i=this.sampleTs-this.sampleCheckTs,s=this.sampleDts-this.sampleCheckDts,r=s>0?i/s:2;n.a.log("EvalBw.onCheckFastTimer eval timeline=".concat(e," costtime=").concat(i," duration=").concat(s," costtime/duration=").concat(r," dts=").concat(this.sampleDts)),r>1.4&&!this._downBwCheck()?this._evalFail():r>1.2&&!this._downBwCheck()?(this.cnt12++,this.cnt12>=2&&this._evalFail()):this.cnt12=0,this.timeLineTs=t,this.sampleCheckTs=t,this.sampleCheckDts=this.sampleDts}}if(Number(f.a._printEval)>0&&t-this.printTs>Number(f.a._printEval)&&this.sampleDts>0){let e=t-this.printTs,i=this.sampleTs-this.printSampleTs,s=this.sampleDts-this.printSampleDts;n.a.log("EvalBw.onCheckFastTimer print timeline=".concat(e," duration=").concat(s," costtime=").concat(i," costtime/duration=").concat(i/s," dts=").concat(this.sampleDts)),this.printTs=t,this.printSampleTs=this.sampleTs,this.printSampleDts=this.sampleDts}}_evalFail(){this.stop(),this.ctrlBitrate.evalFail()}_downBwCheck(){let t=this.sampleTs-this.startTs,e=this.sampleDts-this.startDts;return n.a.log("EvalBw._downBwCheck costtime=".concat(t," duration=").concat(e," costtime/duration=").concat(t/e," dts=").concat(this.sampleDts)),e>0&&t/e<1.2}addSample(t){let e=_.a.now();if(0===this.printSampleDts&&(this.printSampleDts=t.ts,this.printTs=this.printSampleTs=e),this.sampleTs=e,this.sampleDts=t.ts,this.startTs>0&&t.key){let t=this._downBwCheck();this.stop(),t?this.ctrlBitrate.evalSuc():this.ctrlBitrate.evalFail()}}},no=class{constructor(t){this.statSwitch=t,this.type=0,this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0,this.lastPlayerType=0}destroy(){this.statSwitch=null}start(t){let{type:e,reason:i,playerType:s}=t;n.a.log("AutoSeg.start, type=".concat(e,", reason=").concat(i,", playerType=").concat(s)),this.lastPlayerType=s||0,this.statSwitch.sendSwitchAuto([e,i||0]),this.type=e,this.reset(),this.startTs=_.a.now()}nextIFrame(){this.startTs>0&&(this.nextIFrameTs=_.a.now())}connected(){this.startTs>0&&(this.connectedTs=_.a.now())}firstVideo(){this.startTs>0&&(this.firstVideoPkgTs=_.a.now())}ptsIFrame(){this.startTs>0&&(this.ptsIFrameTs=_.a.now())}end(t){let{full:e,playerType:i}=t;if(this.startTs>0){this.endTs=_.a.now();let t=[this.endTs-this.startTs,this.nextIFrameTs>0?this.nextIFrameTs-this.startTs:-1,this.connectedTs>0&&this.nextIFrameTs>0?this.connectedTs-this.nextIFrameTs:-1,this.firstVideoPkgTs>0&&this.connectedTs>0?this.firstVideoPkgTs-this.connectedTs:-1,this.ptsIFrameTs>0&&this.firstVideoPkgTs>0?this.ptsIFrameTs-this.firstVideoPkgTs:-1,this.ptsIFrameTs>0?this.endTs-this.ptsIFrameTs:-1,i||0,this.lastPlayerType];n.a.log("AutoSeg.end, result=".concat(t.toString(),", full=").concat(e,", playerType=").concat(i)),this.statSwitch.sendSwitchCost(t,[this.type,e])}this.reset()}reset(){this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0}},ho=class{constructor(){this._size=0,this._cnt=0,this._index=0,this._map=new Map,this._bufCnt=Number(o.a.autoCfg.bufCnt),this._sucPer=Number(o.a.autoCfg.sucPer),this._sucCnt=0,this._contiCnt=0}destroy(){this._map&&(this._map.clear(),this._map=null)}reset(){this._cnt=0,this._index=0,this._map.clear(),this._sucCnt=0,this._contiCnt=0}setSwitchTime(t){this.reset(),this._size=t/Number(o.a.autoCfg.sampleTime)}addSample(t){if(this._cnt++,t?(this._contiCnt++,this._sucCnt++,this._map.set(this._index,1)):(this._contiCnt=0,this._map.set(this._index,0)),this._cnt>this._size){this._cnt--;let t=this._index-this._size,e=this._map.get(t);this._map.delete(t),1===e&&this._sucCnt--}return this._index++,this.isFullSize()&&this.isLastReach()&&this.isPercentReach()}isFullSize(){return this._cnt>=this._size}isLastReach(){return this._contiCnt>=this._bufCnt}isPercentReach(){return this._sucCnt/this._cnt>=this._sucPer}},lo=class{constructor(){this._minTime=Number(o.a.autoCfg.minTime),this._maxTime=Number(o.a.autoCfg.maxTime),this._map=new Map}destroy(){this._map&&(this._map.clear(),this._map=null)}reset(){n.a.log("AutoUpGap.reset"),this._map.clear()}getMin(){return this._minTime}getGap(t){return this._map.has(t)||this._map.set(t,this._minTime),this._map.get(t)}addFail(t,e){n.a.log("AutoUpGap.addFail bitrate=".concat(t," isMin=").concat(e));let i=this.getGap(t);if(!e){let e=Math.min(2*i,this._maxTime);this._map.set(t,e)}}};let co=new Set,uo=new Map;var po=class{constructor(){this._highRate=Number(o.a.autoCfg.highRate),this._badBuf=Number(o.a.autoCfg.badBuf),this._badCnt=Number(o.a.autoCfg.badCnt),this._sList=[],this._sTime=o.a.autoCfg.badS[0],this._sCnt=o.a.autoCfg.badS[1],this._lList=[],this._lTime=o.a.autoCfg.badL[0],this._lCnt=o.a.autoCfg.badL[1]}destroy(){this._sList=null,this._lList=null}reset(){this._sList=[],this._lList=[]}getBitrates(){return Array.from(co).join(",")}hasBitrate(t){return co.has(t)}addBadQuality(t,e,i,s){return this._addBadQuality(t,e,i,s,this._sList,this._sTime,this._sCnt)||this._addBadQuality(t,e,i,s,this._lList,this._lTime,this._lCnt)}_addBadQuality(t,e,i,s,r,a,o){if(r.push({now:e,pauseTime:i,bufferLen:s}),r.length>o&&r.shift(),r.length>=o){let i=e-r[0].now;if(i<=a)return n.a.log("AutoBadQuality._addBadQuality disTime=".concat(i," time=").concat(a," cnt=").concat(o)),this._checkPerformance(t,r),!0}return!1}_checkPerformance(t,e){if(t>this._highRate)if(e.some(t=>t.bufferLen<this._badBuf)){uo.has(t)||uo.set(t,0);let e=uo.get(t)+1;uo.set(t,e),e>=this._badCnt&&co.add(t)}else co.add(t)}},mo={UP_PTS:Math.pow(2,0),UP_WAIT_IFRAME:Math.pow(2,1),UP_CONNECT_FAIL:Math.pow(2,2),UP_CONNECT_SLOW:Math.pow(2,3),UP_FIRST_FRAME:Math.pow(2,4),UP_PTS_FRAME:Math.pow(2,5),BACK_CONNECT_FAIL:Math.pow(2,6),BACK_PTS:Math.pow(2,7),EVAL_BEFORE:Math.pow(2,8),EVAL_AFTER:Math.pow(2,9),BACK_CONNECT_SLOW:Math.pow(2,10),BACK_FIRST_FRAME:Math.pow(2,11),BACK_PTS_FRAME:Math.pow(2,12),DOWN_NO_IFRAME:Math.pow(2,13),DOWN_CONNECT_FAIL:Math.pow(2,14),DOWN_PTS:Math.pow(2,15),DOWN_CONNECT_SLOW:Math.pow(2,16),DOWN_FIRST_FRAME:Math.pow(2,17),DOWN_PTS_FRAME:Math.pow(2,18),UP_NO_IFRAME:Math.pow(2,19)},_o=class{constructor(t,e){this._ctrlBitrate=t,this._autoMonitor=e,this._buffer=null,this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}destroy(){this._ctrlBitrate=null,this._autoMonitor=null,this._buffer=null}set buffer(t){this._buffer=t}setStart(t){this._startTs=_.a.now(),this._connectedTs=0,this._firstFrameTs=0,t<o.a.autoBufferScore&&this._ctrlBitrate.isSwitchUp()&&this._autoMonitor.addBadReason(mo.UP_WAIT_IFRAME)}setConnected(){this._connectedTs=_.a.now(),this._connectedTs-this._startTs>o.a.autoConnectScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_CONNECT_SLOW):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(mo.DOWN_CONNECT_SLOW):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(mo.BACK_CONNECT_SLOW))}setFirstFrame(){this._firstFrameTs=_.a.now(),this._checkFirstFrame()}setFirstVideoTimeout(){this._connectedTs>0?this._checkFirstFrame():this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_CONNECT_FAIL):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(mo.DOWN_CONNECT_FAIL):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(mo.BACK_CONNECT_FAIL)}_checkFirstFrame(){_.a.now()-this._connectedTs>o.a.autoFirstScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_FIRST_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(mo.DOWN_FIRST_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(mo.BACK_FIRST_FRAME))}setPtsFrame(t){this._checkPtsFrame(),t>0&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_PTS):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(mo.DOWN_PTS):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(mo.BACK_PTS))}setPtsFrameTimeout(){this._checkPtsFrame()}_checkPtsFrame(){_.a.now()-this._firstFrameTs>o.a.autoPtsScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_PTS_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(mo.DOWN_PTS_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(mo.BACK_PTS_FRAME))}setEvalBefore(t){t<o.a.autoBufferScore&&this._autoMonitor.addBadReason(mo.EVAL_BEFORE)}setEvalAfter(t){t<o.a.autoBufferScore&&this._autoMonitor.addBadReason(mo.EVAL_AFTER)}setNoIFrame(){this._buffer&&this._buffer.isWaitForIFrame()&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(mo.UP_NO_IFRAME):this._ctrlBitrate.isSwitchDown()&&this._autoMonitor.addBadReason(mo.DOWN_NO_IFRAME))}reset(){this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}};const fo={NONE:0,H264ToH264:1,H264ToH265:2,H265ToH264:3,H265ToH265:4},go=0,So=1,yo=2,To=3,Po=4,vo=5,Eo=6,Co=0,Io=1,Ao=2;class Do{constructor(t,e){let{player:i,statSwitch:s,autoMonitor:r,recSysStat:a}=t;this._player=i,this._statSwitch=s,this._autoMonitor=r,this._recSysStat=a,this._callbacks=e,this._seg=new no(s),this._badStat=new _o(this,r),this._buffer=null,this._curBitrate=0,this._lastBitrate=0,this._startBitrate=0,this._sessionId=0,this._maxBitrate=0,this._originalMaxBitrate=0,this._minBitrate=0,this._bitrateList=[],this._allBitratebps="",this._switchSampleTime=Number(o.a.autoCfg.sampleTime),this._switchUpGap=Number(o.a.autoCfg.upGap),this._switchDownGap=Number(o.a.autoCfg.downGap),this._switchBackGap=Number(o.a.autoCfg.backGap),this._nextReqInterval=Number(o.a.recSysExpiredTime),this._firstRecSysTime=Number(o.a.autoCfg.sysTime),this._switchUpPer=Number(o.a.autoCfg.upPer),this._switchDownPer=Number(o.a.autoCfg.downPer),this._switchDownNowPer=Number(o.a.autoCfg.downNowPer),this._switchWaitPer=Number(o.a.autoCfg.waitPer),this._switchDownBitrate=Number(o.a.autoCfg.downBitrate),this._beforeSwitchCb=null,this._mse=null,this._evalBw=new oo(this),this._switchNextTime=0,this._switchSampleTs=0,this._upGap=new lo,this._switchUpSample=new ho,this._badRate=new po,this._switchUpReason=ks.NONE,this._switchDownReason=Us.NONE,this._switchType=fo.NONE,this._switchOver=!1,this._evalOver=!1,this._started=!1,this._nextRecSysTs=0,this._switchState=go,this._recSysProxy=null,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._visibilityState=N.a.VISIBILITY_STATE.VISIBLE,this._onRecSysBind=this._onRecSys.bind(this),this._onRecSysDownTimeoutBind=this._onRecSysDownTimeout.bind(this),this._onRecSysIntervalTimeoutBind=this._onRecSysIntervalTimeout.bind(this),this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this._switchUpSample.setSwitchTime(this._upGap.getMin()),this.closeAuto=2===Number(f.a.openAuto),this.switchStartTime=0}destroy(){this._player=null,this._statSwitch=null,this._autoMonitor=null,this._recSysStat=null,this._callbacks=null,this._seg&&this._seg.destroy(),this._seg=null,this._badStat&&this._badStat.destroy(),this._badStat=null,this._bitrateList=null,this._evalBw&&this._evalBw.destroy(),this._evalBw=null,this._upGap&&this._upGap.destroy(),this._upGap=null,this._switchUpSample&&this._switchUpSample.destroy(),this._switchUpSample=null,this._badRate&&this._badRate.destroy(),this._badRate=null,this._badQualityCoderatebps=null}get switchType(){return this._switchType}set switchType(t){this._switchType=t}set beforeSwitchCb(t){this._beforeSwitchCb=t}get lastBitrate(){return this._lastBitrate}get curBitrate(){return this._curBitrate}isSwitchUp(){return this._switchState===So}isSwitchDown(){return this._switchState===To}isSwitchBack(){return this._switchState===Po}start(t,e){if(this._started)return;if(!t)return void n.a.warn("CtrlBitrate.start waring mse");n.a.log("CtrlBitrate.start",JSON.stringify(e)),this._mse=t;let i=t.ctrlBuffer;i.setEval(this._evalBw),i.callbacks=this._callbacks,this._buffer=i,this._badStat.buffer=i,this._sessionId=e.sessionId,this._curBitrate=e.curBitrate,this._maxBitrate=e.startBitrate,3===Number(o.a.isWebAutoAB)&&(this._maxBitrate=o.a.maxBitRate),this._originalMaxBitrate=this._maxBitrate,this._startBitrate=e.startBitrate,this._bitrateList=[],this._minBitrate=Number.MAX_SAFE_INTEGER;let s=[];e.bitrateList.forEach(t=>{this._bitrateList.push(new io(t)),s.push(1e3*t.bitrate),this._minBitrate=Math.min(this._minBitrate,t.bitrate)}),this._allBitratebps=s.join(","),this._bitrateList.sort((t,e)=>t.bitrate>e.bitrate?-1:1),this._start()}_start(){n.a.log("CtrlBitrate._start started=".concat(this._started," bitrates=").concat(this._bitrateList.length," mse=").concat(!!this._mse)),this._mse&&this._bitrateList.length>0&&!this._started&&(this._started=!0,this._player.eventEmitter.on(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind),this._switchNextTime=_.a.now()+5e3,X.add(this._onCheckFastTimer,this,100),X.once(this._firstReqAuto,this,1e3+10*Math.floor(Math.random()*this._firstRecSysTime/10)),this._onVisibilityChange())}_onVisibilityChange(){n.a.log("CtrlBitrate._onVisibilityChange old=".concat(this._visibilityState," new=").concat(document.visibilityState)),this._visibilityState!==N.a.VISIBILITY_STATE.VISIBLE&&document.visibilityState===N.a.VISIBILITY_STATE.VISIBLE&&(this._switchSampleTs=0,this._switchUpSample.reset()),this._visibilityState=document.visibilityState}_firstReqAuto(){n.a.log("CtrlBitrate._firstReqAuto"),this._reqAutoRecSys(Io,this._onRecSysIntervalTimeoutBind)}stop(){n.a.log("CtrlBitrate.stop"),this._mse=null,this._buffer=null,this._started=!1,this._switchState=go,this._switchType=fo.NONE,this._switchUpReason=ks.NONE,this._switchDownReason=Us.NONE,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._switchNextTime=0,this._switchTarget=null,this._curBitrate=0,this._lastBitrate=0,this._nextRecSysTs=0,this._bitrateList=[],this._evalBw.stop(),this._switchUpSample.reset(),this._upGap.reset(),this._badRate.reset(),this._destroyRecSys(),this._player.eventEmitter.off(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind),X.remove(this._onCheckFastTimer,this),X.remove(this._firstReqAuto,this),this.switchStartTime=0}pause(){this._buffer.pause()}_sendSwitchStat(t){let{values:e,strs:i}=this._buffer.switchTs.getMetric();this._buffer.switchTs.resetPtsSample(),e[3]=this._seg.type,i[2]=t,this._statSwitch.sendSwitchPts(e,i),this._seg.end({full:t,playerType:this._player._type})}switchBitrate(t){this._curBitrate!==t&&(0!==this._curBitrate&&n.a.log("CtrlBitrate.switchBitrate from=".concat(this._curBitrate," to=").concat(t," buffer=").concat(this._mse.getBufferLen())),this._switchOver=!1,this._lastBitrate=this._curBitrate,this._curBitrate=t,this._buffer.switchBitrate(this._switchState===To,this._lastBitrate,this._curBitrate))}switchBack(t){if(this.switchStartTime=0,this._switchState!==go&&this._lastBitrate<this._curBitrate){this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),this._evalBw.stop(),this._sendSwitchStat(t===Bs.evalFail?1:2),this._seg.start({type:Ns.BACK,reason:t,playerType:this._player._type}),this._switchState=Po,n.a.log("CtrlBitrate.switchBack from=".concat(this._curBitrate," lastBitrate=").concat(this._lastBitrate," reason=").concat(t," buffer=").concat(this._mse.getBufferLen()));let e=this._bitrateList.length;for(let t=0;t<e;t++){let i=this._bitrateList[t];if(i.bitrate===this._lastBitrate){let s=this._getDownInfo(t+1,e);s&&s.bitrate>=this._switchDownBitrate&&(i=s),n.a.log("CtrlBitrate.switchBack to=".concat(i.bitrate)),this._beforeSwitchCb&&this._beforeSwitchCb(i),this._buffer.switchBack();break}}}}startEval(t){if(this._switchState===So){let e=this._mse.getBufferLen();n.a.log("CtrlBitrate.switchDone start eval buffer=".concat(e)),this._badStat.setEvalBefore(e),this._switchState=Eo,this._switchUpReason=ks.EVAL_BW,this._evalOver=!1,this._evalBw.start(_.a.now(),t)}}evalSuc(){let t=this._mse.getBufferLen();n.a.log("CtrlBirate.evalSuc buffer=".concat(t)),this._badStat.setEvalAfter(t);let e=_.a.now();this._switchNextTime>e?this._switchNextTime+=this._switchUpGap:this._switchNextTime=e+this._switchUpGap,this._evalOver=!0,this._resetProperties(),this._sendSwitchStat(1),this._setPlaybackrate(!1),this._switchUpSample.setSwitchTime(this._upGap.getGap(this._curBitrate))}evalFail(){let t=this._mse.getBufferLen();n.a.log("CtrlBirate.evalFail buffer=".concat(t)),this._badStat.setEvalAfter(t),this._switchUpReason=ks.EVAL_FAIL,this._evalOver=!0,this.switchBack(Bs.evalFail)}_resetProperties(){this._evalOver&&this._switchOver&&(this._switchState=go,this._switchType=fo.NONE,this._switchUpReason=ks.NONE,this._switchDownReason=Us.NONE)}switchDone(t){this._switchOver=!0;let e=this._mse.getBufferLen();n.a.log("CtrlBitrate.switchDone buffer=".concat(e," switchType=").concat(this._switchType," switchNextGap=").concat(t));let i=_.a.now();if(this._switchNextTime=i+t,this._switchState===Eo&&(this.switchStartTime=i),this._switchState===To||this._switchState===Po){this._evalBw.reset(),this._sendSwitchStat(1),this._switchState===To?(this._switchUpReason=ks.NONE,this._switchDownReason=Us.NONE,this._switchNextTime+=this._switchDownGap,this._switchState=go,this._switchType=fo.NONE,this._setPlaybackrate(!1)):(this._switchState=vo,this._switchNextTime+=this._switchBackGap);let t=this._upGap.getGap(this._curBitrate);n.a.log("CtrlBitrate.switchDone switchTime=".concat(t)),this._switchUpSample.setSwitchTime(t)}else this._resetProperties();this._buffer.play()}_setPlaybackrate(t){let e=this._mse.getBufferLen(),i=Number(o.a.autoCfg.slow);i=e>3e3?.95:e>2e3?.9:.85,this._mse.setPlaybackRate(t?i:1),this._mse.autoBitrateJitter=t}_switchUp(t){if(t||(t=this._curBitrate),this._curBitrate<this.maxBitrate){if(this._switchState===go){let e=null;for(let i=this._bitrateList.length-1;i>=0;i--){let s=this._bitrateList[i];if(s.bitrate>t&&!this._badRate.hasBitrate(s.bitrate)&&s.bitrate<=this.maxBitrate&&!this._isBadBitrate(s.bitrate)){e=s;break}}if(e){if(this._player&&this._player.getIsEnableAuto&&!this._player.getIsEnableAuto(e))return void(this._switchUpReason=ks.CLOSE_P2P);n.a.log("CtrlBitrate._switchUp suc"),this._setPlaybackrate(!0),this._seg.start({type:Ns.UP,playerType:this._player._type}),this._switchState=So,this._beforeSwitchCb&&this._beforeSwitchCb(e),this._autoMonitor.start(Ns.UP,this.switchType)}else this._bitrateList[0].bitrate>this.maxBitrate?this._switchUpReason=ks.TARGET_MAX:this._switchUpReason=ks.TARGET_BAD}}else this._switchUpReason=ks.MAX_BITRATE}addBadQuality(t,e,i){t=t||_.a.now(),n.a.log("CtrlBitrate.addBadQuality started=".concat(this._started," switchState=").concat(this._switchState)),this._started&&this._switchState===go&&this._badRate.addBadQuality(this._curBitrate,t,e,i)&&(this._badRate.reset(),n.a.log("CtrlBitrate pause down!"),this._switchDownBefore())}_switchDownBefore(){if(0===Number(o.a.autoDownTimer))return;let t=this._bitrateList[this._bitrateList.length-1].bitrate;this._curBitrate>t&&(this._switchState=yo,1===Number(o.a.sdkCloseAutoAi)||2===Number(o.a.isWebAutoAB)||3===Number(o.a.isWebAutoAB)?this._switchDown():this._reqAutoRecSys(Ao,this._onRecSysDownTimeoutBind))}_switchDown(t){let e=_.a.now();o.a.autoCfg&&0!=this.switchStartTime&&e-this.switchStartTime<o.a.autoCfg.noRederTime&&this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),t||(t=this._curBitrate),this.switchStartTime=0;let i=this.badQualityCoderatebps,s=this._bitrateList.length,r=null;for(let e=0;e<s;e++){let i=this._bitrateList[e];if(i.bitrate<t&&!this._isBadBitrate(i.bitrate)){if(i.bitrate===this._minBitrate||i.bitrate<=this._switchDownBitrate)r=i;else{let t=this._getDownInfo(e+1,s);r=!t||t.bitrate<this._switchDownBitrate?i:t}break}}if(r){if(this._player&&this._player.getIsEnableAuto&&!this._player.getIsEnableAuto(r))return void(this._switchDownReason=Us.CLOSE_P2P);n.a.log("CtrlBitrate._switchDown suc"),this._setPlaybackrate(!0),this._seg.start({type:Ns.DOWN,playerType:this._player._type}),this._switchState=To,this._beforeSwitchCb&&this._beforeSwitchCb(r),this._autoMonitor.start(Ns.DOWN,this.switchType)}else{n.a.log("CtrlBitrate._switchDown fail bad_host=".concat(this._badRate.getBitrates()," bad_svr=").concat(i.join(",")));let t=this._bitrateList[s-1];-1!==i.indexOf(1e3*t.bitrate)?this._switchDownReason=Us.TARGET_SVR:this._badRate.hasBitrate(t.bitrate)&&(this._switchDownReason=Us.TARGET_HOST)}}_isBadBitrate(t){return-1!==this.badQualityCoderatebps.indexOf(1e3*t)||this._badRate.hasBitrate(t)}_getDownInfo(t,e){return null}_onRecSysDownTimeout(){n.a.log("CtrlBitrate._onRecSysTimeout"),this._nextRecSysTs=_.a.now()+this.nextReqInterval,this._destroyRecSys(),this._switchDown()}_onCheckFastTimer(t,e){if(this._evalBw.onCheckFastTimer(t,e),this._switchState===vo)this._fillBuf();else if(this._visibilityState===N.a.VISIBILITY_STATE.VISIBLE&&this._switchState===go&&t>this._switchNextTime&&!this._buffer.isPaused()&&!this.closeAuto){if(0===this._switchSampleTs)this._switchSampleTs=t;else if(t-this._switchSampleTs>=this._switchSampleTime){this._switchSampleTs=t;let e=this._mse.getBufferLen(),i=this._player.getWaitBufferLen(),s=this._player.getWaitFrameTime(t);this._needSwitchDown(t,e,i,s)?(n.a.log("CtrlBitrate buffer down! buffer=".concat(e," waitBuffer=").concat(i," waitFrameTime=").concat(s)),this._switchDownBefore()):(this._switchDownReason=Us.BUFFER,this._switchUpSample.addSample(e>=this._mse.JITTER_BUFLEN*this._switchUpPer)?this._switchUp():this._switchUpSample.isFullSize()?this._switchUpSample.isLastReach()?this._switchUpSample.isPercentReach()||(this._switchUpReason=ks.SAMPLE_PERCENT):this._switchUpReason=ks.SAMPLE_LAST:this._switchUpReason=ks.SAMPLE_SIZE)}}else t<this._switchNextTime&&(this._switchUpReason=ks.NEXT_TIME,this._switchDownReason=Us.NEXT_TIME);this._nextRecSysTs>0&&t>=this._nextRecSysTs&&this._reqAutoRecSys(Co,this._onRecSysIntervalTimeoutBind)}_needSwitchDown(t,e,i,s){return e+i<this._mse.JITTER_BUFLEN*this._switchDownPer}_fillBuf(){let t=this._mse.getBufferLen();t>=this._mse.JITTER_BUFLEN*this._switchUpPer&&(n.a.log("CtrlBitrate.fillBuf suc bufferLen=".concat(t)),this._switchState=go,this._switchType=fo.NONE,this._setPlaybackrate(!1))}_reqAutoRecSys(t,e){if(1===Number(o.a.sdkCloseAutoAi)||2===Number(o.a.isWebAutoAB)||3===Number(o.a.isWebAutoAB))return;this._nextRecSysTs=Number.MAX_SAFE_INTEGER,this._destroyRecSys();let i=this._player.info,s=new ro({onRsp:this._onRecSysBind,onTimeout:e});const r=this._player.getAutoProps();s.sendAuto({presenterUid:i.presenterUid,roomId:i.roomId,scene:ao,appendInfo:{platform:"webh5&".concat(2508270844),p2p:this._player._type,h265:this._player.h265Proxy&&this._player.h265Proxy.isReady?1:0,line:i.lineType,coderatebps:1e3*i.curBitrate,gameid:i.gameId,all_coderatebps:this._allBitratebps,req_type:t,start_coderatebps:1e3*this._startBitrate,session_id:this._sessionId,video_play_buf:r.videoBuffers,audio_play_buf:"",video_block_count:r.aiAutoCnt,video_block_duration:r.aiAutoDuration,real_kbps_sample:r.realKbpsSample,v_loss_frames:"",v_recv_frames:r.recvFps}},1e3),this._recSysProxy=s}_onRecSysIntervalTimeout(){this._nextRecSysTs=_.a.now()+this.nextReqInterval,this._destroyRecSys()}_onRecSys(t){let e=!1,i=!1,s=_.a.now();if(t){if(this._recSysStat.addItem(ao,t.tRecSysInfo.sDispatchId,s+o.a.recSysExpiredTime),Number(f.a._testAction)>0&&(n.a.log("CtrlBitrate._onRecSys _testAction=".concat(f.a._testAction)),t.tRecSysInfo.lAction=Number(f.a._testAction)),0===t.tRecSysInfo.lAction)e=!0;else if(t.tRecSysInfo.lAction>=100&&t.tRecSysInfo.lAction<200){if(""!==t.tRecSysInfo.sActValue){let e=JSON.parse(R.b.unescapeHTML(t.tRecSysInfo.sActValue));n.a.log("CtrlBitrate._onRecSys",JSON.stringify(e)),i=e.force_switch&&1==Number(e.force_switch),this._maxBitrate=Number(e.auto_max_coderatebps)/1e3||this._maxBitrate,this._nextReqInterval=1e3*Number(e.next_req_interval)||this._nextReqInterval,this._badQualityCoderatebps=e.bad_quality_coderatebps||[],this._recSysExpiredTime=_.a.now();let s=e.auto_user_tags||"";this._player.eventEmitter.autoUserTags=s,this._statSwitch.stat.setComDim(d.a.DIM_COM.AUTO_USER_TAGS,s);let r=Number(e.force_auto_count),a=Number(e.force_auto_effective_time);r>0&&a>0&&this._player.trigger(m.AUTO_FORCE_RSP,{force_auto_count:r,force_auto_effective_time:a})}e=!0}}else e=!0;Number(f.a._testBadQuality)>0&&(n.a.log("CtrlBitrate._onRecSys _testBadQuality=".concat(f.a._testBadQuality)),this._badQualityCoderatebps=[1e3*Number(f.a._testBadQuality)]),Number(f.a._testMaxBitrate)>0&&(this._recSysExpiredTime=_.a.now(),n.a.log("CtrlBitrate._onRecSys _testMaxBitrate=".concat(f.a._testMaxBitrate)),this._maxBitrate=Number(f.a._testMaxBitrate)),1===f.a._testActAble&&(n.a.log("CtrlBitrate._onRecSys _testMaxBitrate=".concat(f.a._testActAble)),e=!0),Number(f.a._testForceSwitch)>0&&(n.a.log("CtrlBitrate._onRecSys _testForceSwitch=".concat(f.a._testForceSwitch)),i=1==f.a._testForceSwitch),i?this._maxBitrate<this._curBitrate?this._switchDown(this._maxBitrate+1):this._switchUp(this._maxBitrate-1):this._switchState===yo?(this._switchState=go,e?this._switchDown():this._switchNextTime=this._nextRecSysTs):1===Number(o.a.autoDownMaxBitrate)&&this._maxBitrate<this._curBitrate&&this._switchDown(this._maxBitrate+1),this._nextRecSysTs=s+this.nextReqInterval-1e4}_destroyRecSys(){this._recSysProxy&&this._recSysProxy.destroy(),this._recSysProxy=null}get maxBitrate(){return this._recSysExpired()&&(this._maxBitrate=this._originalMaxBitrate),this._maxBitrate}get nextReqInterval(){return this._recSysExpired()&&(this._nextReqInterval=Number(o.a.recSysExpiredTime)),this._nextReqInterval}get badQualityCoderatebps(){return this._recSysExpired()&&(this._badQualityCoderatebps=[]),this._badQualityCoderatebps}_recSysExpired(){let t=_.a.now()-this._recSysExpiredTime;return 0!=this._recSysExpiredTime&&t>o.a.recSysExpiredTime}}Do.SwitchType=fo;var Ro=Do;let Oo={};self||(self=window),function(){let t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(edg)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},r={};if(s.browser){r[s.browser]=!0;let t=s.majorVersion.split(".");r.version={major:parseInt(s.majorVersion,10),string:s.version,majorVersion:s.majorVersion},t.length>1&&(r.version.minor=parseInt(t[1],10)),t.length>2&&(r.version.build=parseInt(t[2],10))}if(s.platform&&(r[s.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;let t="msie";s.browser=t,r[t]=!0}if(r.edge){delete r.edge;let t="msedge";s.browser=t,r.chrome=!0}if(r.edg){delete r.edg;let t="msedge";s.browser=t,r.chrome=!0}if(r.opr){let t="opera";s.browser=t,r[t]=!0}if(r.safari&&r.android){let t="android";s.browser=t,r[t]=!0}r.name=s.browser,r.platform=s.platform;for(let t in Oo)Oo.hasOwnProperty(t)&&delete Oo[t];Object.assign(Oo,r)}(),Oo.version||(Oo.version={major:0,minor:0,build:0,string:"0.0.0"});var Lo=Oo;function Mo(t,e){let i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(let t=0;t<s;t++)r+="0";return r+t}let wo=0;var Fo={now:function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return~~t.now();if(void 0!==t.webkitNow)return~~t.webkitNow();if(void 0!==t.mozNow)return~~t.mozNow();if(void 0!==t.msNow)return~~t.msNow()}0===wo&&(wo=Date.now()-1);let e=Date.now()-wo;return e>4294967295?(wo+=4294967295,e-4294967295):e},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;var e=null,i=(e=t?new Date(t):new Date).getFullYear(),s=Mo(e.getMonth()+1,2),r=Mo(e.getDate(),2);return"".concat(i,"-").concat(s,"-").concat(r)},getTimeStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=null,s=Mo((i=t?new Date(t):new Date).getHours(),2),r=Mo(i.getMinutes(),2),a=Mo(i.getSeconds(),2),o="".concat(s,":").concat(r,":").concat(a);if(e){var n=Mo(i.getMilliseconds(),3);o+="."+n}return o},getDateTimeStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=null,s=(i=t?new Date(t):new Date).getFullYear(),r=Mo(i.getMonth()+1,2),a=Mo(i.getDate(),2),o=Mo(i.getHours(),2),n=Mo(i.getMinutes(),2),h=Mo(i.getSeconds(),2),d="".concat(s,"-").concat(r,"-").concat(a," ").concat(o,":").concat(n,":").concat(h);if(e){var l=Mo(i.getMilliseconds(),3);d+="."+l}return d}},bo=99;function Vo(){return Fo.getDateTimeStr()+" "}var No=!1;let Bo={_data:[],_length:0,debug:function(){var t=Vo(),e=Array.apply(null,arguments);e[0]=t+e[0],bo<=-1&&console.log.apply(console,e)},log:function(t){var e=Vo(),i=Array.apply(null,arguments);i[0]=e+i[0],bo<=0&&console.log.apply(console,i),Bo.record(i,"log")},info:function(t){var e=Vo(),i=Array.apply(null,arguments);i[0]=e+i[0],bo<=1&&console.info.apply(console,i),Bo.record(i,"info")},warn:function(t){var e=Vo(),i=Array.apply(null,arguments);i[0]=e+i[0],bo<=2&&console.warn.apply(console,i),Bo.record(i,"warn")},error:function(t){var e=Vo(),i=Array.apply(null,arguments);i[0]=e+i[0],bo<=3&&console.error.apply(console,i),Bo.record(i,"error")},group:function(t){var e=Vo(),i=Array.apply(null,arguments);if(i[0]=e+i[0],bo<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}Bo.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=bo&&(console.log(Vo()+" set log level from "+bo+" to "+t),bo=t)},getLevel:function(){return bo},record:function(t,e){1100===Bo._length&&(Bo._data.splice(0,100),Bo._length=1e3);var i=0,s=(t.shift()||"").toString();for(s=s.replace(/\%c/gi,(function(t,e){return i++,""}));i--&&t.length;)t.shift();for(var r=0,a=t.length;r<a;r++)"object"==typeof t[r]&&(t[r]="");t.unshift(s);var o=t.join(" ");Bo._length++,Bo._data.push("[".concat(e,"][HYLineTrans]").concat(o))},getLog:function(){return No||(No=!0,Bo._data.unshift(Lo.platform+" "+Lo.name+" "+Lo.version.string)),Bo._data},logcss:function(t,e,i){let s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s},padNum:function(t,e){let i=t.toString().length,s=Math.max(0,e-i);return"0".repeat(s)+t}};var ko=Bo,Uo={logger:null,TimeUtil:null,init:function(t){this.logger=t.logger||ko,this.TimeUtil=t.TimeUtil||Fo}},xo=s(9);class Ho{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0;this.data=i,this.timeStamp=e,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=s,this.isKeyFrame=r,this.compositionTime=a,this.naluType=o,this.isEmptyAudioFrame=!1,n&&n.spsUnit&&(this.sps=n.spsUnit),n&&n.vpsUnit&&(this.vps=n.vpsUnit),n&&n.ppsUnit&&(this.pps=n.ppsUnit),n&&n.videoCodec&&(this.codec=n.videoCodec),n&&n.videoWidth&&(this.width=n.videoWidth),n&&n.videoHeight&&(this.height=n.videoHeight)}setIsEmptyAudioFrame(t){this.isEmptyAudioFrame=t}}Ho.VIDEO=0,Ho.AUIDO=1;var Wo=Ho,Go=(()=>{let t=null;try{t=window.localStorage}catch(e){t={removeItem:function(t){},getItem:function(t){return null},setItem:function(t,e){},clear:function(){}}}return t})(),Yo=class{constructor(){this.framelist=[]}appendFrame(t){this.framelist.push(t)}appendFrames(t){for(;t.length>0;)this.framelist.push(t.shift())}dropFrames(t){let e=0;for(let i=0;i<this.framelist.length&&this.framelist[i].timeStamp<t;i++)e++;e>0&&this.framelist.splice(0,e)}dropInvalidFrames(t,e){let i=-1,s=0;for(let r=0;r<this.framelist.length;r++){let a=this.framelist[r];if(!(a.timeStamp<t)){if(-1==i&&a.timeStamp>t&&(i=r),!(a.timeStamp<e))break;s++}}s>0&&this.framelist.splice(i,s)}close(){for(;this.framelist.length>0;)this.framelist.pop().frame.close();this.framelist=null}},qo=class extends Yo{constructor(t){super(),this.rafNow=0,this.renderedFrameNums=0,this.webCodecsPlayer=t,this.frameRenderFps=0,this.renderFpsList=[],this.canvas=null,this.pauseList=[],this.lastRenderNums=0,this.lastVideoThrowNums=0,this.lastFrameTimeStamp=0,this.lastToDecodeAudioNums=0,this.lastToDecodeVideoNums=0,this.lastDecodedAudioNums=0,this.lastDecodedVideoNums=0,this.lastDiscardVideoNums=0,this.lastEnhanceVideoNums=0,this.videoPlayerElement=null,this.agenerator=null,this.processedStream=null,this.isPlayVideo=!1,this.isLive=this.webCodecsPlayer.isLive}start(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Uo.logger.log("VideoRender.start, videoElement=",i),this.videoPlayerElement=i||document.createElement("video"),this.agenerator=new MediaStreamTrackGenerator({kind:"video"}),this.processedStream=new MediaStream([this.agenerator]),this.videoPlayerElement.srcObject=this.processedStream,this.webCodecsPlayer.getWorkerHolder().postVideoRenderStart({agenerator:this.agenerator.writable,width:t,height:e,mainSharedArrayBuffer:this.webCodecsPlayer.getSharedArrayBufferHolder().getMainBuffer()},[this.agenerator.writable])}appendFrame(t){this.webCodecsPlayer.getWorkerHolder().postFrameInfo({frameInfo:t}),this.lastFrameTimeStamp=t.timeStamp,t.frame.close(),t=null}getVideoStatData(t){1==Number(Go._printVideoRenderStat)&&Uo.logger.log("VideoRender.getVideoStatData",t)}getVideoElement(){return this.videoPlayerElement}onAudioPauseByBrowser(){this.videoPlayerElemen&&this.videoPlayerElement.pause(),Uo.logger.log("VideoRender.onAudioPauseByBrowser")}play(){if((!this.isPlayVideo||!this.webCodecsPlayer.audioBrowserPaused)&&(this.isPlayVideo=!0,this.videoPlayerElement&&this.videoPlayerElement.paused)){let t=this.videoPlayerElement.play();t&&t.then(()=>{Uo.logger.log("VideoRender.play success"),this.webCodecsPlayer.audioBrowserPaused&&(this.videoPlayerElement.pause(),this.webCodecsPlayer&&this.webCodecsPlayer.onPauseByBrowser())}).catch(t=>{const e=t.toString();ko.warn("VideoRender.play error: ".concat(e)),this.webCodecsPlayer&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0)&&this.webCodecsPlayer&&this.webCodecsPlayer.onPauseByBrowser()})}}getPauseStatList(){let t=[].slice.call(this.pauseList);return this.pauseList.length=0,t}getRenderedFrameNums(){return this.renderedFrameNums}getVideoPts(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoPts()}getDecodedBuffer(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getDecodedBuffer()}getRenderFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getRenderNums(),e=t-this.lastRenderNums;return this.lastRenderNums=t,e<0&&(e=0),e}getVideoThrowFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoThrowNums(),e=t-this.lastVideoThrowNums;return this.lastVideoThrowNums=t,e<0&&(e=0),e}containerResize(t){}onVisibilitychange(){let t=document.visibilityState;this.webCodecsPlayer.getWorkerHolder().postVisibilityChange({state:t})}updateVideoFPS(t,e){this.webCodecsPlayer.getWorkerHolder().postUpdateVideoFps({fps:t,noReferFps:e})}setPlayMinBuffer(t){this.webCodecsPlayer.getWorkerHolder().postSetPlayMinBuffer({bufferLen:t})}getDecodeFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder(),e=t.getAudioTodecodeNums(),i=t.getVideoTodecodeNums(),s=t.getAudioDecodedNums(),r=t.getVideoDecodedNums(),a=t.getDecodedVideoDelay(),o=t.getDecodedVideoDelaySmooth(),n=t.getVideoReadyToRenderListLen(),h=t.getVideoEnhanceCost(),d=e-this.lastToDecodeAudioNums,l=i-this.lastToDecodeVideoNums,c=s-this.lastDecodedAudioNums,u=r-this.lastDecodedVideoNums;return this.lastToDecodeAudioNums=e,this.lastToDecodeVideoNums=i,this.lastDecodedAudioNums=s,this.lastDecodedVideoNums=r,{toDecodeAudioFps:d,toDecodeVideoFps:l,decodedAudioFps:c,decodedVideoFps:u,decodedVideoDelay:a,decodedVideoDelaySmooth:o,videoFrameLen:n,videoEnhanceCost:h,enhanceLess30Nums:t.getEnhanceLess30Nums(),enhanceLess150Nums:t.getEnhanceLess150Nums(),enhanceLess200Nums:t.getEnhanceLess200Nums(),enhanceLarge200Nums:t.getEnhanceLarge200Nums(),enhanceTotal:t.getEnhanceTotal()}}getDiscardVideoFrames(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoDecodeDiscardNums(),e=t-this.lastDiscardVideoNums;return this.lastDiscardVideoNums=t,e}getEnhanceVideoFrames(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getEnhanceVideoFrames(),e=t-this.lastEnhanceVideoNums;return this.lastEnhanceVideoNums=t,e}setAudioDecodedBuffer(t){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xo.a.AUDIO_DECODED_BUFFER,t)}getVideoBufferLen(){let t=0;if(this.videoPlayerElement){let e=this.videoPlayerElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoPlayerElement.currentTime)>>0)}return t}userPause(){Uo.logger.log("VideoRenderWorker.userPause"),this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xo.a.PAUSE_STATUS,1)}userPlay(){Uo.logger.log("VideoRenderWorker.userPlay"),this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xo.a.PAUSE_STATUS,0)}onVideoPause(){Uo.logger.log("VideoRenderWorker.onVideoPause"),this.isLive||this.videoPlayerElement.pause()}onVideoPlay(){Uo.logger.log("VideoRenderWorker.onVideoPlay")}setRealFps(t){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xo.a.VIDEO_REAL_FPS,t)}getVideoWidth(){return this.videoPlayerElement?this.videoPlayerElement.videoWidth:0}getVideoHeight(){return this.videoPlayerElement?this.videoPlayerElement.videoHeight:0}startMuteRender(){Uo.logger.log("VideoRenderWorker.startMuteRender"),this.webCodecsPlayer.onVideoPlay(),this.videoPlayerElement.play()}setPlaybackRate(t){this.webCodecsPlayer.getWorkerHolder().postPlayBackRate(t)}close(){this.videoPlayerElement&&this.videoPlayerElement.pause(),super.close(),this.rafNow=0,this.renderedFrameNums=0,this.isBrowserHidden=!1,this.renderFpsList.length=0,this.canvas=null,this.lastRenderNums=0,this.lastVideoThrowNums=0,this.lastToDecodeAudioNums=0,this.lastToDecodeVideoNums=0,this.lastDecodedAudioNums=0,this.lastDecodedVideoNums=0,this.lastDiscardVideoNums=0,this.lastEnhanceVideoNums=0,this.videoPlayerElement&&this.videoPlayerElement.removeEventListener("resize",this.webCodecsPlayer.onVideoResizeBind),this.videoPlayerElement=null,this.agenerator=null,this.processedStream=null}},Ko=class extends Yo{constructor(t){super(t),this.audioDuration=0,this.ageneratorWriter=null,this.audioPlayerElement=null,this.processedStream=null,this.agenerator=null,this.renderTimer=0,this.frameTimeStamps=[],this.renderQueueLimit=5,this.audioSampleRate=44100,this.volume=1,this.paused=!1,this.renderNums=0,this.lastRenderNums=0,this.player=t,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.isMuffled=!1,this.cacheVolume=1,this.isPlaying=!1,this.userPaused=!1,this.audioPlayerElement=document.createElement("audio"),this.audioPlayerElement.addEventListener("error",t.onVideoErrorBind),this.audioPlayerElement.addEventListener("play",t.onVideoPlayBind),this.audioPlayerElement.addEventListener("playing",t.onVideoPlayingBind),this.playing=!1}start(){"MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window?(this.agenerator=new MediaStreamTrackGenerator({kind:"audio"}),this.processedStream=new MediaStream([this.agenerator]),this.audioPlayerElement.srcObject=this.processedStream,this.player.getWorkerHolder().postAuidoTrack({ageneratorWriter:this.agenerator.writable},[this.agenerator.writable]),this.setVolume(this.volume)):this.player.onWebcodecsError(xo.d.NOT_SUPPORT_MEDIASRTREAMTRACK)}getCurrentDts(){return this.player.getSharedArrayBufferHolder().getAudioDts()}getCurrentTime(){return this.audioPlayerElement&&this.audioPlayerElement.currentTime?Math.round(1e3*this.audioPlayerElement.currentTime):0}setVolume(t){this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.audioPlayerElement&&(this.audioPlayerElement.volume=t),this.volume=t,this.cacheVolume=t}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.setVolume(this.cacheVolume)}setMuted(t){this.isMute=t,t?this.audioPlayerElement&&(this.audioPlayerElement.muted=!0):this.audioPlayerElement&&(this.audioPlayerElement.muted=!1)}getRenderFps(){let t=this.player.getSharedArrayBufferHolder().getAudioRenderNums(),e=t-this.lastRenderNums;return e<0&&(e=0),this.lastRenderNums=t,e}pause(){this.audioPlayerElement.pause()}play(){this._play()}_checkPlay(){ko.log("AudioRender.checkPlay playing=".concat(this.playing)),this.playing?Timer.remove(this._checkPlay,this):this._play()}_play(){let t=this.audioPlayerElement.play();t?t.then(()=>{this.playing=!0,ko.log("AudioRender.play success")}).catch(t=>{this.playing=!1;const e=t.toString();ko.warn("AudioRender.play error: ".concat(e)),this.player&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0||this.audioPlayerElement.paused)&&this.player&&this.player.onPauseByBrowser(),this.userPaused=!0}):this.playing=!1}userPlay(){ko.log("AudioRender.userPlay"),this.userPaused=!1,this.play()}userPause(){ko.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPauseBind()}workerMessage(t){switch(t.data.type){case xo.b.WORKERSHAREBUFFER:break;case xo.b.AUDIODECODEERROR:ko.log("webCodecs worker.onDecoderError, audio decode error"),this.player.onWebcodecsError(xo.d.AUDIODECODEERROR)}}getAudioBufferLen(){let t=0;if(this.audioPlayerElement){let e=this.audioPlayerElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.audioPlayerElement.currentTime)>>0)}return t}initAudio(){}onCheckFastTimer(){}close(){super.close(),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.audioPlayerElement.removeEventListener("pause",this.player.onVideoPauseBind),this.audioPlayerElement.removeEventListener("error",this.player.onVideoErrorBind),this.audioPlayerElement.removeEventListener("play",this.player.onVideoPlayBind),this.audioPlayerElement.removeEventListener("playing",this.player.onVideoPlayingBind),this.agenerator=null,this.ageneratorWriter=null,this.audioPlayerElement=null,this.processedStream=null,this.renderNums=0,this.lastRenderNums=0,this.firstFinshed=!1,this.frameTimeStamps.length=0,this.isPlaying=!1,this.userPaused=!1,this.playing=!1}};class jo{constructor(){}}jo.INIT="init",jo.INITED="inited",jo.STOP="stop",jo.PAUSE="pause",jo.RESUME="resume",jo.PLAY="play",jo.AUDIO_FRAME="audio_frame",jo.UPDATE_CURRENT_TIME="update_current_time",jo.TIME_STAMP="timestamp",jo.VOLUME="volume",jo.AUDIO_DATA_NAN="AUDIO_DATA_NAN",jo.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",jo.LOG_CFG="LOG_CFG",jo.UPDATE_PLAYBACKRATE="UPDATE_PLAYBACKRATE",jo.SEEK="SEEK",jo.ON_VIDEO_SEEK="ON_VIDEO_SEEK";var zo=jo,Jo=s(26),Qo=s.n(Jo);let Xo=window.AudioContext||window.webkitAudioContext,$o=0;var Zo={setLogLevel:function(t){ko.setLevel(t)},init:function(t){Uo.init(t)},createIns:function(t,e){return new class{constructor(t,e){this._config=t,this.isLive=t.isLive,this.videoElement=t.videoElement,this._callbacks=e,this._worker=k()(29),this._workerHolder=new class{constructor(t){this._player=t,this._worker=t.getWorker(),this._workerErrorBind=this._workerError.bind(this),this._workerMessageBind=this._workerMessage.bind(this),this._worker.addEventListener("message",this._workerMessageBind)}postInitConfig(t){this._post(xo.c.INIT_CONFIG,t)}postAvcConfig(t){this._post(xo.c.AVCCONFIG,t)}postAv1InitSeg(t){this._post(xo.c.AV1_INIT_SEG,t)}postAVCPPS(t){this._post(xo.c.AVCPPS,t)}postAVCSPS(t){this._post(xo.c.AVCSPS,t)}postAVCVPS(t){this._post(xo.c.AVCVPS,t)}postVideoSamples(t){this._post(xo.c.VIDEOSAMPLES,t)}postAudioConfig(t){this._post(xo.c.AACCONFIG,t)}postAudioSamples(t){this._post(xo.c.AUDIOSAMPLES,t)}postFastOver(){this._post(xo.c.FAST_OVER,{})}postClose(){this._post(xo.c.CLOSE,{})}postLocalConfig(){this._post(xo.c.LOCAL_CONFIG,{_webcodecsNoRenderVideo:Number(Go._webcodecsNoRenderVideo),_useSoftAcceleration:Number(Go._useSoftAcceleration)})}postSetUseSoftAcceleration(){this._post(xo.c.SET_USE_SOFTACCELERATION,{})}postUpdateSoftAcceleration(){this._post(xo.c.UPDATE_SOFTACCELERATION,{})}postEnableDiscardVideo(t){this._post(xo.c.ENABLE_DISCARD_VIDEO,t)}postSetAudioWriter(t){this._post(xo.c.SET_AUDIO_WRITER,{writer:t},[t])}postSetPauseVideoDecode(t){this._post(xo.c.PAUSE_VIDEO_DECODE,t)}postSetPauseAudioDecode(t){this._post(xo.c.PAUSE_AUDIO_DECODE,t)}postUpdateCurBitrate(t){this._post(xo.c.UPDATE_CURBITRATE,t)}postSetJitter(t){this._post(xo.c.SET_JITTER,t)}postFrameInfo(t){this._post(xo.c.POSTFRAME,t)}postResize(t){this._post(xo.c.RESIZE,t)}postVisibilityChange(t){this._post(xo.c.VISIBILITYCHANGE,t)}postUpdateVideoFps(t){this._post(xo.c.UPDATE_VIDEOFPS,t)}postSetPlayMinBuffer(t){this._post(xo.c.SET_PLAY_MINBUFFER,t)}postVideoRenderStart(t,e){this._post(xo.c.START,t,e)}postAuidoTrack(t,e){this._post(xo.c.SET_AUDIO_WRITER,t,e)}postLogCfg(t){this._post(xo.c.LOG_CFG,t)}setEnhance(t){this._post(xo.c.SET_ENHANCE,t)}setSegmenttion(t){this._post(xo.c.SET_SEGMENTTION,t)}onRevFastOver(){this._post(xo.c.RECV_FAST_OVER)}seek(t){this._post(xo.c.SEEK_TIME,t)}postSetVodAv1(){this._post(xo.c.SET_VOD_AV1)}postPlayBackRate(t){this._post(xo.c.SET_PLAYBACKRATE,t)}_post(t,e,i){t!==xo.c.VIDEOSAMPLES&&t!==xo.c.AUDIOSAMPLES&&t!==xo.c.UPDATE_VIDEOFPS&&t!==xo.c.VISIBILITYCHANGE&&t!==xo.c.AVCPPS&&t!==xo.c.AVCSPS&&t!==xo.c.AVCVPS&&Uo.logger.log("WokerHolder.post type=".concat(t)),i?this._worker&&this._worker.postMessage({type:t,data:e},i):this._worker&&this._worker.postMessage({type:t,data:e})}_workerError(t){this._player.onWebcodecsError(xo.d.WORKERERROR,t.message)}_workerMessage(t){let e=t.data;switch(e.type){case xo.b.WOREKR_READY:this._onWorkerReady();break;case xo.b.INTERVAL:this._player.onWorkerInterval(Fo.now());break;case xo.b.TURN_TO_WEBCODECS_SOFT:this._player.turnToWebcodecsSoft();break;case xo.b.AUDIORENDERERROR:this._player.onWebcodecsError(xo.d.AUDIORENDERERROR);break;case xo.b.SOFT_TURN_TO_MSE:this._player.onWebcodecsError(xo.d.SOFT_TURN_TO_MSE);break;case xo.b.AUDIO_FRAME_DECODED:this._player.getAudioRender().appendFrame(e.data);break;case xo.b.WEBGLPLAY:this._player.triggerWebcodecsPlay();break;case xo.b.AUDIO_PLAY:this._player.triggerAudioPlay();break;case xo.b.STAT:this._player.getVideoStatData(e.data);break;case xo.b.PAUSE:case xo.b.WORKERSHAREBUFFER:break;case xo.b.RENDERERROR:this._player.onWebcodecsError(xo.d.VIDEORENDEERROR);break;case xo.b.LOG:Uo.logger.log("webCodecs worker log:\n",e.data.join("\n"));break;case xo.b.VIDEODECODEERROR:Uo.logger.log("webCodecs worker.onDecoderError, video decode error",e.data&&e.data.msg),this._player.onWebcodecsError(xo.d.VIDEODECODEERROR,e.data&&e.data.msg);break;case xo.b.AUDIODECODEERROR:Uo.logger.log("webCodecs worker.onDecoderError, audio decode error",e.data&&e.data.msg),this._player.onWebcodecsError(xo.d.AUDIODECODEERROR,e.data&e.data.msg);break;case xo.b.DECODE_COST:Uo.logger.log("webCodecs worker.onDecoderCostError, video decode_cost error"),this._player.onWebcodecsError(xo.d.DECODE_COST);break;case xo.b.DECODE_DTS:Uo.logger.log("webCodecs worker.decodeByDts, video decode error"),this._player.onWebcodecsError(xo.d.DECODE_DTS);break;case xo.b.WAIT_KEY_FRAME:this._player.onWaitKeyFrame(e.data);break;case xo.b.SET_FRAME_PAUSE:this._player.setFramePause();break;case xo.b.SET_FRMAE_RESUME:this._player.setFrameRusume();break;case xo.b.RENDER_FPS_PAUSE:this._player.renderFpsPause();break;case xo.b.AUDIO_FORMAT_ERROR:this._player.onWebcodecsError(xo.d.AUDIO_FORMAT_ERROR);break;case xo.b.VIDEO_ENHANCE_ERROR:this._player.onVideoEnhanceError(e.data);break;case xo.b.VIDEO_ENHANCE_SUCCESS:this._player.onVideoEnhanceSuccess();break;case xo.b.ON_WCS_VIDEO_SEEK:this._player.onVideoSeek(e.data)}}_onWorkerReady(){this.postLocalConfig(),1===Number(Go._useSoftAcceleration)&&this._player.setUseSoftAcceleration()}}(this),this._sharedArrayBufferHolder=new class{constructor(){let t=new SharedArrayBuffer(1024);this._mainBuffer=new Uint32Array(t),this._workerBufferAudio=null}getMainBuffer(){return this._mainBuffer}setWorkerBufferVideo(t){this._mainBuffer=t}setWorkerBufferAudio(t){this._workerBufferAudio=t}storeMainBuffer(t,e){this._mainBuffer&&Atomics.store(this._mainBuffer,t,e)}storeMainShieldAudio(t){this.storeMainBuffer(xo.a.IS_SHIELD_AUDIO,t)}storeFrameBuffer(t){this.storeMainBuffer(xo.a.FRAME_BUFFER_LEN,t)}storeRecvVideoTs(t){this.storeMainBuffer(xo.a.LAST_VIDEO_RCV_TS,t)}getBufferLen(){return this._loadWorker(xo.e.VIDEO_BUFFER_LEN,this._mainBuffer)}getVideoPts(){return this._loadWorker(xo.e.VIDEO_PTS,this._mainBuffer)}getDecodedBuffer(){return this._loadWorker(xo.e.VIDEO_NOT_RENDERD_BUFFER,this._mainBuffer)}getRenderNums(){return this._loadWorker(xo.e.VIDEO_RENDER_NUMS,this._mainBuffer)}getAudioRenderNums(){return this._loadWorker(xo.e.AUDIO_RENDER_NUMS,this._mainBuffer)}getVideoThrowNums(){return this._loadWorker(xo.e.VIDEO_THROW_FRAME_FPS,this._mainBuffer)}getAudioTodecodeNums(){return this._loadWorker(xo.e.AUDIO_TODECODE_NUMS,this._mainBuffer)}getVideoTodecodeNums(){return this._loadWorker(xo.e.VIDEO_TODECODE_NUMS,this._mainBuffer)}getAudioDecodedNums(){return this._loadWorker(xo.e.AUDIO_DECODE_NUMS,this._mainBuffer)}getVideoDecodedNums(){return this._loadWorker(xo.e.VIDEO_DECODE_NUMS,this._mainBuffer)}getDecodedVideoDelay(){return this._loadWorker(xo.e.VIDEO_DECODED_DELAY,this._mainBuffer)}getDecodedVideoDelaySmooth(){return this._loadWorker(xo.e.VIDEO_DECODED_DELAY_SMOOTH,this._mainBuffer)}getVideoReadyToRenderListLen(){return this._loadWorker(xo.e.VIDEO_READY_TO_RENDER_LIST_LEN,this._mainBuffer)}getVideoDecodeDiscardNums(){return this._loadWorker(xo.e.VIDEO_DECODE_DISCARD_NUMS,this._mainBuffer)}getEnhanceVideoFrames(){return this._loadWorker(xo.e.VIDEO_ENHANCE_NUMS,this._mainBuffer)}getVideoEnhanceCost(){return this._loadWorker(xo.e.VIDEO_ENAHNCE_COST,this._mainBuffer)}getEnhanceLess30Nums(){return this._loadWorker(xo.e.VIDEO_ENHANCE_LESS30_NUMS,this._mainBuffer)}getEnhanceLess150Nums(){return this._loadWorker(xo.e.VIDEO_ENHANCE_LESS150_NUMS,this._mainBuffer)}getEnhanceLess200Nums(){return this._loadWorker(xo.e.VIDEO_ENHANCE_LESS200_NUMS,this._mainBuffer)}getEnhanceLarge200Nums(){return this._loadWorker(xo.e.VIDEO_ENHANCE_LARGE200_NUMS,this._mainBuffer)}getEnhanceTotal(){return this._loadWorker(xo.e.VIDEO_ENHANCE_TOTAL,this._mainBuffer)}getAudioDts(){return this._loadWorker(xo.e.AUDIO_DTS,this._mainBuffer)}getVideoFirstFrameDecodeCost(){return this._loadWorker(xo.e.VIDEO_FIRST_FRAME_DECODEC_COST,this._mainBuffer)}getAudioFirstFrameDecodeCost(){return this._loadWorker(xo.e.AUDIO_FIRST_FRAME_DECODEC_COST,this._mainBuffer)}_loadWorker(t,e){return e?Atomics.load(e,t):0}},this._videoRender=new qo(this),1==Go._enableAudioTrack?this._audioRender=new Ko(this):this._audioRender=new class{constructor(t){this._id=$o++,this.player=t,this.audioCtx=null,this.outputAnalyser=null,this.oscillator=null,this.bypasser=null,this.outputChannelCount=2,this.sampleRate=44100,this.currentDts=0,this.isMuffled=!1,this.isMute=!1,this.cacheVolume=1,this.isPlaying=!1,this.userPaused=!1,this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.gainNode=null,this.audioContextState="",this.isFirstPlay=!1,this.onAudioStateChangeBind=this.onAudioStateChange.bind(this),this.audioFrames=[],this._logCfg={},this._logTs=0,this.volume=1,this.playbackRate=1,this.player.isLive?this.playMode=0:this.playMode=1,this.sampleRate=44100,this.outputChannelCount=2,this.isInited=!1}isSuspended(){return"suspended"===this.audioContextState}start(){}initAudio(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(44100==t||48e3==t){if(this.sampleRate=t,this.outputChannelCount=e,Uo.logger.log("AudioWorkletNodeRenderer.initAudio"),this.audioCtx=new Xo({sampleRate:t}),"suspended"==this.audioCtx.state)return this.player.onAudioPauseByBrowser(),void(this.isAudioPause=!0);this.initAudioContext(e)}else this.player.onWebcodecsError(xo.d.NOT_SUPPORT_AUDIO_SAMPLERATE)}getAudioAnalyser(){return this.outputAnalyser}initAudioContext(t){Uo.logger.log("AudioWorkletNodeRenderer.initAudioContext"),this.outputChannelCount=t,this.audioCtx.audioWorklet.addModule(Qo.a).then(()=>{this.audioCtx&&(this.outputAnalyser=this.audioCtx.createAnalyser(),this.bypasser=new AudioWorkletNode(this.audioCtx,"bypass-processor",{outputChannelCount:[t]}),this.bypasser.port.onmessage=this.onMessage.bind(this),this.bypasser.connect(this.outputAnalyser),this.outputAnalyser.connect(this.audioCtx.destination),this.player&&this.player.onAudioAnalyserInit(this.outputAnalyser))}),this.audioCtx.addEventListener("statechange",this.onAudioStateChangeBind)}setPlaybackRate(t){Uo.logger.log("AudioWorkletNodeRenderer.setPlaybackRate",t),this.playbackRate!=t&&(this.playbackRate=t,this.postMessage(zo.UPDATE_PLAYBACKRATE,t))}muteRecoverInit(){Uo.logger.log("AudioWorkletNodeRenderer.muteRecoverInit"),this.isAudioPause=!1,this.audioCtx=null,this.initAudio(this.sampleRate,this.outputChannelCount)}onAudioStateChange(){let t=this.audioCtx.state;Uo.logger.log("AudioWorkletNodeRenderer.onAudioStateChange, state=".concat(t)),this.audioContextState=t,"suspended"==t?(this.player.onVideoPause(),this.isAudioPause=!0):"running"==t&&(this.player.onAudioPlay(),this.isAudioPause=!1)}seek(){this.isSeek=!0,this.postMessage(zo.SEEK)}onVideoSeek(){Uo.logger.log("AudioWorkletNodeRenderer.onVideoSeek"),this.isSeek=!1,this.postMessage(zo.ON_VIDEO_SEEK)}appendFrame(t){-1!=t.format.indexOf("32")?this.isAudioPause?!this.isSeek&&this.audioFrames.push(t):this.isInited?this.postMessage(zo.AUDIO_FRAME,t):this.audioFrames.push(t):this.player.onWebcodecsError(xo.d.AUDIO_FORMAT_ERROR)}onWorkLetReady(){Uo.logger.log("AudioWorkletNodeRenderer.onWorkLetReady, frameLen=".concat(this.audioFrames.length)),this.audioFramesClear(),this.audioFrames.length>=0&&(this.audioFrames.map(t=>{this.postMessage(zo.AUDIO_FRAME,t)}),this.audioFrames.length)}onCheckFastTimer(){if(this.audioFramesClear(),this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage){let t=Fo.now();if(t-this._logTs>1e3){this._logTs=t;let e={printProcess:1==Go._printProcess,printAudioData:1==Go._printAudioData,printRenderSkipAudio:1==Go._printRenderSkipAudio};e.printProcess==this._logCfg.printProcess&&e.printAudioData===this._logCfg.printAudioData&&e.printRenderSkipAudio===this._logCfg.printRenderSkipAudio||(this._logCfg=e,this.postMessage(zo.LOG_CFG,e))}}}audioFramesClear(){const t=this.player.getVideoPts();for(;this.audioFrames.length>0;){let e=this.audioFrames[0];if(!(e.timeStamp<t))break;this.audioFrames.shift(),this.player.isLive||this.isAudioPause||this.player.getSharedArrayBufferHolder().storeMainBuffer(xo.e.AUDIO_DTS,e.timeStamp)}}onMessage(t){switch(t.data.type){case zo.INITED:Uo.logger.log("AudioWorkletNodeRenderer.onMessage inited, playMode=".concat(this.playMode)),this.setVolume(this.volume),this.postMessage(zo.INIT,{outputChannelCount:this.outputChannelCount,id:this._id,playMode:this.playMode,playbackRate:this.playbackRate,mainSharedArrayBuffer:this.player.getSharedArrayBufferHolder().getMainBuffer()}),this.onWorkLetReady(),this.isSeek?this.postMessage(zo.SEEK):this.postMessage(zo.ON_VIDEO_SEEK),this.isInited=!0;break;case zo.TIME_STAMP:const e=Fo.now();this.currentDts=t.data.data.timeStamp,this.renderNums=t.data.data.renderNums,this.isFirstPlay||(this.isFirstPlay=!0,this.player.triggerAudioPlay()),this.player.audioPlayConsuming&&this.player.audioPlayConsuming.addRenderFrameData&&this.player.audioPlayConsuming.addRenderFrameData(this.currentDts,e),0==this.isFirstFrameTs?(this.isFirstFrameTs=e,this.firstTimeStamp=this.currentDts):Number(1==Go._printWebcodecsWorkletDts)&&Uo.logger.log("AudioWorkLet, dts=".concat(this.currentDts,",localPast=").concat(Fo.now()-this.isFirstFrameTs,",audioPast=").concat(this.currentDts-this.firstTimeStamp));break;case zo.AUDIO_DATA_NAN:this.player.onWebcodecsError(xo.d.AUDIO_DATA_NAN);break;case zo.AUDIO_DATA_MUTE:}}postMessage(t,e){this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage&&this.bypasser.port.postMessage({type:t,data:e})}workerMessage(){}getCurrentDts(){return this.player.getSharedArrayBufferHolder().getAudioDts()||this.currentDts}getCurrentTime(){return this.audioCtx?Math.round(this.audioCtx.currentTime):0}setVolume(t){this.isMuffled||this.isMute?this.postMessage(zo.VOLUME,0):this.postMessage(zo.VOLUME,t),this.volume=t,this.cacheVolume=t}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.postMessage(zo.VOLUME,0):this.setVolume(this.cacheVolume)}setMuted(t){this.isMute=t,t?this.postMessage(zo.VOLUME,0):this.setVolume(this.cacheVolume)}getRenderFps(){let t=this.renderNums,e=t-this.lastRenderNums;return e<0&&(e=0),this.lastRenderNums=t,e}pause(){Uo.logger.log("AudioWorkletNodeRenderer.pause"),this.postMessage(zo.PAUSE)}play(){this._play(),this.postMessage(zo.PLAY)}_play(){if(!this.audioCtx)return;let t=this.audioCtx.resume();t?t.then(()=>{this.playing=!0,Uo.logger.log("AudioRender.play success")}).catch(t=>{this.playing=!1;const e=t.toString();Uo.logger.warn("AudioRender.play error: ".concat(e)),this.player&&this.player.onAudioPauseByBrowser(),this.userPaused=!0}):this.playing=!1}userPlay(){Uo.logger.log("AudioRender.userPlay"),this.isAudioPause&&!this.player.isLive&&this.muteRecoverInit(),this.userPaused=!1,this.play()}userPause(){Uo.logger.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPause()}workerMessage(t){switch(t.data.type){case xo.b.WORKERSHAREBUFFER:break;case xo.b.AUDIODECODEERROR:Uo.logger.log("webCodecs worker.onDecoderError, audio decode error"),this.player.onWebcodecsError(xo.d.AUDIODECODEERROR)}}getAudioBufferLen(){return 0}close(){this.currentDts=0,this.audioCtx&&(this.postMessage(zo.STOP,null),Uo.logger.log("AudioWorkletNodeRenderer.close"),this.bypasser&&(this.bypasser.port.close(),this.bypasser.disconnect(this.audioCtx),this.bypasser=null),this.audioCtx.removeEventListener("statechange",this.onAudioStateChangeBind),this.audioCtx.close(),this.audioCtx=null),this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.isFirstPlay=!1}}(this),this._isAudioPause=!1,this._isRenderStart=!1,this._logCfgCheckTs=0,this._logCfg={},this._initConfig()}_initConfig(){this._workerHolder.postInitConfig({config:JSON.stringify(this._config)}),this._checkLogCfg(Fo.now())}setVodAv1(){this._workerHolder.postSetVodAv1()}getWorker(){return this._worker}getWorkerHolder(){return this._workerHolder}getSharedArrayBufferHolder(){return this._sharedArrayBufferHolder}getVideoRender(){return this._videoRender}getAudioRender(){return this._audioRender}getVideoElement(){return this._videoRender.getVideoElement()}getVideoPts(){return this._videoRender?this._videoRender.getVideoPts():0}getDecodeFps(){return this._videoRender.getDecodeFps()}getDecodedBuffer(){return this._videoRender.getDecodedBuffer()}getVideoRenderFps(){return this._videoRender.getRenderFps()}getAudioRenderFps(){return this._audioRender.getRenderFps()}getVideoThrowFps(){return this._videoRender.getVideoThrowFps()}getDiscardVideoFrames(){return this._videoRender.getDiscardVideoFrames()}getEnhanceVideoFrames(){return this._videoRender.getEnhanceVideoFrames()}getDecodedVideoDelaySmooth(){return this._sharedArrayBufferHolder.getDecodedVideoDelaySmooth()}getCurrentTime(){return this._audioRender.getCurrentTime()}getCurrentAudioDts(){return this._audioRender.getCurrentDts()}getBufferLen(){return this._sharedArrayBufferHolder.getBufferLen()}setRealFps(t){this._videoRender.setRealFps(t)}updateVideoFPS(t,e){this._videoRender.updateVideoFPS(t,e)}getAudioError(){return this._audioRender.audioPlayerElement.error}userPause(){this._audioRender.userPause(),this._videoRender.userPause()}userPlay(){this._audioRender.userPlay(),this._videoRender.userPlay()}setPlayMinBuffer(t){this._workerHolder.postSetPlayMinBuffer({bufferLen:t})}startMuteRender(t){this._audioRender.isAudioPause&&(Uo.logger.log("WebcodecsPlayer.startMuteRender.".concat(0===t?"mute":"setVolume"," val=").concat(t)),0===t?(this._isAudioPause=!0,this.audioBrowserPaused=!1,this._videoRender.startMuteRender()):this._isAudioPause&&(this.onAudioPlay(),this._audioRender.muteRecoverInit())),this._audioRender.setVolume(t)}setMuffledVolume(t){this._audioRender.setMuffledVolume(t)}setPauseVideoDecode(t){this._workerHolder.postSetPauseVideoDecode({isPause:t})}setPauseAudioDecode(t){this._workerHolder.postSetPauseAudioDecode({isPause:t})}isAudioSuspended(){return this._audioRender.isSuspended()}onVisibilitychange(){this._videoRender.onVisibilitychange()}onAudioPauseByBrowser(){Uo.logger.log("WebcodecsPlayer.onAudioPauseByBrowser"),this.getSharedArrayBufferHolder().storeMainBuffer(xo.a.BROWSER_PAUSE_STATUS,1),this.audioBrowserPaused=!0,this._videoRender.onAudioPauseByBrowser()}onAudioAnalyserInit(t){this._callbacks&&this._callbacks.onAudioAnalyserInit(t)}onPauseByBrowser(){this._callbacks&&this._callbacks.onPauseByBrowser()}onVideoPause(){this._videoRender.onVideoPause()}onVideoPlay(){this._videoRender.onVideoPlay(),this._callbacks.onVideoPlay&&this._callbacks.onVideoPlay()}onAudioPlay(){Uo.logger.log("WebcodecsPlayer.onAudioPlay"),this.audioBrowserPaused=!1,this._videoRender.onVideoPlay(),this.getSharedArrayBufferHolder().storeMainBuffer(xo.a.BROWSER_PAUSE_STATUS,0)}triggerAudioPlay(){if(!this._audioRender)return;const t=this.getSharedArrayBufferHolder().getAudioFirstFrameDecodeCost();Uo.logger.log("WebcodecsPlayer.triggerPlay audio",t),this._audioRender.play(),this.triggerPlay("audio")}triggerPlay(t){this._videoRender.play();const e=this.getSharedArrayBufferHolder().getVideoFirstFrameDecodeCost(),i=this.getSharedArrayBufferHolder().getAudioFirstFrameDecodeCost();this._callbacks&&this._callbacks.triggerPlay(e,i,t)}triggerWebcodecsPlay(){this.triggerPlay("video"),this._callbacks&&this._callbacks.triggerWebcodecsPlay()}setFramePause(){this._callbacks&&this._callbacks.setFramePause&&this._callbacks.setFramePause()}setFrameRusume(){this._callbacks&&this._callbacks.setFrameRusume&&this._callbacks.setFrameRusume()}renderFpsPause(){this._callbacks&&this._callbacks.renderFpsPause&&this._callbacks.renderFpsPause()}getVideoStatData(t){1==Number(Go._printVideoRenderStat)&&Uo.logger.log("VideoRender.getVideoStatData",t)}onWorkerInterval(t){this._audioRender.onCheckFastTimer(),this._callbacks&&this._callbacks.onWorkerInterval(t),this._checkLogCfg(t)}_checkLogCfg(t){if(0===this._logCfgCheckTs||t-this._logCfgCheckTs>1e3){this._logCfgCheckTs=t;let e={printTodecodeVideo:1==Go._printTodecodeVideo,printToDecodeAudio:1==Go._printToDecodeAudio,printDecodedVideo:1==Go._printDecodedVideo,printDecodedAudio:1==Go._printDecodedAudio,printTorenderVideo:1==Go._printTorenderVideo,printTorenderAudio:1==Go._printTorenderAudio,printAppendVideo:1==Go._printAppendVideo,printAppendAudio:1==Go._printAppendAudio,printVideoDecodeFast:1==Go._printVideoDecodeFast,printRenderSkipFrame:1==Go._printRenderSkipFrame},i=!1;for(let t in e)if(this._logCfg[t]!==e[t]){i=!0;break}this._logCfg=e,i&&this._workerHolder.postLogCfg(e)}}onWebcodecsError(t,e){Uo.logger.log("WebcodecsPlayer.onWebcodecsError type=".concat(t),e),this._callbacks&&this._callbacks.onWebcodecsError(t,e)}containerResize(t){this._videoRender.containerResize(t)}setEnableDiscard(t){this._workerHolder.postEnableDiscardVideo({enableDiscard:t})}updateCurBitrate(t){this._workerHolder.postUpdateCurBitrate({curBitrate:t})}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;this._workerHolder.postSetJitter({bufLen:t,bufMin:e,bufMax:i,jumpBufferCfg:s,shieldAudioCfgBufLen:r,isRemuxBuf:1===a})}updateAVCConfig(t){let{width:e,height:i}=t;Uo.logger.log("WebcodecsPlayer.updateAVCConfig width=".concat(e," height=").concat(i)),this._isRenderStart||(this._videoRender.start(e,i,this.videoElement),this._audioRender.start(),this._isRenderStart=!0),this._workerHolder.postAvcConfig(t)}initSegmentSuc(t){this._workerHolder.postAv1InitSeg(t)}updateAVCPPS(t,e){this._workerHolder.postAVCPPS({data:t,timestamp:e})}updateAVCSPS(t,e){this._workerHolder.postAVCSPS({data:t,timestamp:e})}updateAVCVPS(t,e){this._workerHolder.postAVCVPS({data:t,timestamp:e})}appendVideoSample(t){let e=Math.floor(t.ts),i=t.key,s=Math.floor(t.cts),r=t.units,a=0,o=0,n=0;r.map(t=>{o+=t.data.byteLength,n++});let h=new Uint8Array(o+4*n),d=new DataView(h.buffer);d.setUint32(0,h.byteLength);let l=!1,c=0;r.map((t,e)=>{let i=t,s=i.data.byteLength;c=i.naluType,l=i.discardAllow,d.setUint32(a,s),a+=4,h.set(i.data,a),a+=s});let u=new EncodedVideoChunk({type:i?"key":"delta",timestamp:e,duration:3e3,data:d.buffer}),p=new Wo(Wo.VIDEO,e,u,l,i,s,c,t);1!==Number(Go._dropVideoUnit)&&this._workerHolder.postVideoSamples({videoSamples:[p]})}appendAv1VideoSample(t){let e=Math.floor(t.ts),i=t.key,s=new EncodedVideoChunk({type:i?"key":"delta",timestamp:e,duration:3e3,data:t.data}),r=new Wo(Wo.VIDEO,e,s,!1,i,0,void 0,t);1!==Number(Go._dropVideoUnit)&&this._workerHolder.postVideoSamples({videoSamples:[r]})}updateAudioConfig(t){Uo.logger.log("WebcodecsPlayer.updateAudioConfig ".concat(JSON.stringify(t)));const{codec:e,audioSampleRate:i,audioChannelCount:s,timeStamp:r}=t;this._audioRender&&(this._audioRender.initAudio(i,s),this._workerHolder.postAudioConfig({codec:e,sampleRate:i,numberOfChannels:s,timestamp:r}))}appendAudioSample(t){let e=t.unit,i=t.ts,s=new Uint8Array(e.byteLength+4);new DataView(s.buffer).setUint32(0,e.byteLength),s.set(e,4);let r=new EncodedAudioChunk({type:"key",timestamp:0,duration:3e3,data:e}),a=new Wo(Wo.AUIDO,i,r);1==t.empty&&a.setIsEmptyAudioFrame(!0),this._workerHolder.postAudioSamples({audioSamples:[a]})}onFastOver(){this._workerHolder.postFastOver()}turnToWebcodecsSoft(){this._callbacks&&this._callbacks.turnToWebcodecsSoft()}setUseSoftAcceleration(){this._workerHolder.postSetUseSoftAcceleration()}updateSoftAcceleration(){this._workerHolder.postUpdateSoftAcceleration()}onWaitKeyFrame(t){this._callbacks&&this._callbacks.onWaitKeyFrame(t)}storeMainShieldAudio(t){this._sharedArrayBufferHolder.storeMainShieldAudio(t)}storeFrameBuffer(t){this._sharedArrayBufferHolder.storeFrameBuffer(t)}storeRecvVideoTs(t){this._sharedArrayBufferHolder.storeRecvVideoTs(t)}setMuted(t){this._audioRender&&this._audioRender.setMuted(t)}setEnhance(t){this._workerHolder.setEnhance({data:t})}setSegmenttion(t){this._workerHolder.setSegmenttion({data:t})}onVideoEnhanceError(t){this._callbacks&&this._callbacks.onVideoEnhanceError&&this._callbacks.onVideoEnhanceError(t)}onVideoEnhanceSuccess(){this._callbacks&&this._callbacks.onVideoEnhanceSuccess&&this._callbacks.onVideoEnhanceSuccess()}onRevFastOver(){this._workerHolder.onRevFastOver()}seek(t,e){this._workerHolder.seek({seekTime:t,initDts:e}),this._audioRender&&this._audioRender.seek(t)}onVideoSeek(t){Uo.logger.log("WebcodecsPlayer.onVideoSeek seekTime=".concat(t)),this._audioRender&&this._audioRender.onVideoSeek(t),this._callbacks&&this._callbacks.onVideoSeekBind&&this._callbacks.onVideoSeekBind(t)}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._audioRender&&this._audioRender.setPlaybackRate&&this._audioRender.setPlaybackRate(t),this._videoRender&&this._videoRender.setPlaybackRate&&this._videoRender.setPlaybackRate(t)}destroy(){this._callbacks=null,this._worker&&(this._workerHolder.postClose(),this._worker.terminate(),this._worker=null),this._audioRender&&(this._audioRender.close(),this._audioRender=null),this._videoRender&&(this._videoRender.close(),this._videoRender=null)}}(t,e)},WebCodecsErrType:xo.d,MainSharedBufferType:xo.a};let tn=0;var en=class extends Xa{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e,N.a.PLAYER_CORE_TYPE.WEBCODECS),this._id=++tn;let i=e.h265Proxy;this.h265Proxy=i;let{videoType:s="flv",videoElement:r=null,ignoreSei:a=!1,closeFetch:h=!1,continuousTimeStamp:d=!1}=e;this.lowlatencyCfg=e.lowlatencyCfg||{lowlatencyBuf:-1,lowlatencyMin:-1,lowlatencyMax:-1,lowlatencyJit:-1},this.lowlatency=-1!==this.lowlatencyCfg.lowlatencyBuf,this.pushAvcDts=0,Zo.init({logger:n.a,TimeUtil:_.a});let l={};this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.videoEnhance&&(l={isUseEnhance:this.handler.eventEmitter.isUseEnhance,modelRes:this.handler.eventEmitter.videoEnhance.getModelRes(),h5Root:this.handler.eventEmitter.videoEnhance.getH5Root()}),this._mediaWebcodecs=Zo.createIns({lowlatencyCfg:this.lowlatencyCfg,webcodecCfg:o.a.webCodecCfg,aiEnhanceCfg:l,dtsJumpOpen:o.a.dtsJumpOpen,dtsJumpThreshold:o.a.dtsJumpThreshold,isLive:this.isLive,videoElement:this.videoElement},{turnToWebcodecsSoft:this.turnToWebcodecsSoft.bind(this),onPauseByBrowser:this.onPauseByBrowser.bind(this),setUseSoftAcceleration:this.setUseSoftAcceleration.bind(this),onWebcodecsError:this.onWebcodecsError.bind(this),triggerWebcodecsPlay:this.triggerWebcodecsPlay.bind(this),triggerPlay:this.triggerPlay.bind(this),onAudioAnalyserInit:this.onAudioAnalyserInit.bind(this),onWorkerInterval:this.onWorkerInterval.bind(this),setFramePause:this.setFramePause.bind(this),setFrameRusume:this.setFrameRusume.bind(this),renderFpsPause:this.renderFpsPause.bind(this),onVideoEnhanceError:this.onVideoEnhanceError.bind(this),onVideoEnhanceSuccess:this.onVideoEnhanceSuccess.bind(this),onVideoSeekBind:this.onVideoSeek.bind(this),onVideoPlay:this.onVideoPlay.bind(this),onVideoPause:this.onVideoPause.bind(this)}),this.toDecodeVideoFrameNums=0,this.decodedVideoFrameNums=0,this.decodeNums=0,this.destroyed=!1,this.count=0,this.width=1280,this.height=720,this.playbackrateChangeAccess=!0,this.mediaDelay=null,this.seiAnchorDelay=-1,this.pushVideoStartRenderTime=0,this.offsetDts=0,this.curVideoDts=0,this.curAudioDts=0,this.playing=!1,this.pause500checked=!1,this.lastFrameTs=0,this.lastVideoDts=0,this.lastAudioDts=0,this.videoWebcodecsPauseTs=0,this.audioWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1,this.isAudioWebCodecsPaused=!1,"ts"===s?(this.parser=new Xr(this,this.remuxer),this.parser.ignoreSei=a,this.parser.closeFetch=h,this.parser.continuousTimeStamp=d):(this.parser=new Te(this,this.remuxer,$t),this.parser2=new Te(this,this.remuxer,Zt)),this.ctrlBuffer.setBuffered(this.buffered),this.pauseHanlder=new class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._webCodecsPlayer=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0}check(t){if(0!=this._lastCheckTime&&t-this._lastCheckTime<50)return;const e=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();0!==this._playedPts&&(e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t)),this._playedPts=e,this._lastCheckTime=t}_setPaused(t){this._paused=!0,this._pausedTs=t,n.a.log("WebCodecsPause._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;n.a.log("WebCodecsPause._setResume pausedTime=",e,this._playedPts),this._playResume(t,e),this._paused=!1,this._pausedTs=0}}(this,{pauseFunc:this._playPause.bind(this),resumeFunc:this._playResume.bind(this)}),this.pauseWorkerHanlder=new class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._webCodecsPlayer=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}check(t){if(0!=this._lastCheckTime&&t-this._lastCheckTime<50)return;const e=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();if(0!==this._playedPts){e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t);const i=t-this._lastCheck500Time,s=Math.round(e-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=o.a.pause500Cfg[0]&&(1==Number(f.a._printPauseCheckWorker)&&n.a.log("WebCodecsPauseWorker.check.500ms check500Delta=".concat(i,", check500CurrentTimeDelta=").concat(s,", pauseDelta=").concat(i-s)),this._webCodecsPlayer.check500Pause()),this._lastCheck500CurrntTime=e,this._lastCheck500Time=t)}this._playedPts=e,this._lastCheckTime=t}_setPaused(t){this._paused=!0,this._pausedTs=t,n.a.log("WebCodecsPauseWorker._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;n.a.log("WebCodecsPauseWorker._setResume pausedTime=",e,this._playedPts),this._playResume(t,e),this._paused=!1,this._pausedTs=0}}(this,{pauseFunc:this._playWorkerPause.bind(this),resumeFunc:this._playWorkerResume.bind(this)}),this.webCodecsStat=new class{constructor(t){this._webCodecsPlayer=t,this.delayList=[],this.decodedList=[],this.renderList=[],this.deltaList=[],this.videoBufList=[],this.videoToDecodeList=[],this.audioToDecodeList=[],this.audioDecodedList=[],this.audioRenderList=[],this.videoDiscardList=[],this.videoThrowFpsList=[],this.videoRender5SecFpsList=[],this.videoEnhanceList=[],this.videoEnhanceCostList=[],this.lastEnhanceLess30Nums=0,this.lastEnhanceLess150Nums=0,this.lastEnhanceLess200Nums=0,this.lastEnhanceLarge200Nums=0,this.lastEnhanceTotal=0,this.checkTimes=0}onCheckTimer(t,e){let i=this._webCodecsPlayer.getDecodeFps(),s=i.decodedVideoFps,r=i.decodedAudioFps,a=this._webCodecsPlayer.getVideoRenderFps(),o=this._webCodecsPlayer.getAudioRenderFps(),h=this._webCodecsPlayer.getVideoThrowFps(),d=i.toDecodeAudioFps,l=i.toDecodeVideoFps,c=i.decodedVideoDelay,u=i.videoFrameLen,p=Math.floor(this._webCodecsPlayer.getCurrentAudioDts()-this._webCodecsPlayer.getCurrentDts()),m=this._webCodecsPlayer.getDecodedBuffer(),_=this._webCodecsPlayer.getDiscardVideoFrames(),g=this._webCodecsPlayer.getBufferLen(),S=this._webCodecsPlayer.getEnhanceVideoFrames();this.delayList.push(c),this.decodedList.push(s),this.renderList.push(a),this.videoEnhanceList.push(S),this.videoEnhanceCostList.push(i.videoEnhanceCost),this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(a),this.deltaList.push(p),this.videoBufList.push(g),this.audioToDecodeList.push(r),this.videoToDecodeList.push(l),this.audioDecodedList.push(r),this.audioRenderList.push(o),this.videoDiscardList.push(_),this.videoThrowFpsList.push(h),this.checkTimes%5==0&&1==Number(f.a._printWebCodecsStat)&&n.a.log("WebCodecsPlayer.getWebCodecsStats,","videoDecodeDelay=".concat(c,", audioToDecodeFps=").concat(d,", audioDecodeFps=").concat(r,","),"audioRenderFps=".concat(o,", videoBufferLen=").concat(this._webCodecsPlayer.getBufferLen(),", delta=").concat(p,", videoToDecodeFps=").concat(l,","),"videoDecodeFps=".concat(s,", discardVideoFps=").concat(_,", videoRenderFps=").concat(a,", videoThrowFps=").concat(h,","),"videoDecodedBuffer=".concat(m,", videoFrameLen=").concat(u)),this.checkTimes++}getStats(){let t=[...this.delayList],e=[...this.decodedList],i=[...this.renderList],s=[...this.deltaList],r=[...this.audioToDecodeList],a=[...this.videoToDecodeList],o=[...this.audioDecodedList],h=[...this.audioRenderList],d=[...this.videoDiscardList],l=[...this.videoThrowFpsList],c=[...this.videoEnhanceList],u=[...this.videoEnhanceCostList];this.delayList.length=0,this.decodedList.length=0,this.renderList.length=0,this.deltaList.length=0,this.audioToDecodeList.length=0,this.videoToDecodeList.length=0,this.audioDecodedList.length=0,this.audioRenderList.length=0,this.videoDiscardList.length=0,this.videoThrowFpsList.length=0,this.videoEnhanceList.length=0,this.videoEnhanceCostList.length=0;let{enhanceLess30Nums:p,enhanceLess150Nums:m,enhanceLess200Nums:_,enhanceLarge200Nums:f,enhanceTotal:g}=this._webCodecsPlayer.getDecodeFps();const S=p-this.lastEnhanceLess30Nums,y=m-this.lastEnhanceLess150Nums,T=_-this.lastEnhanceLess200Nums,P=f-this.lastEnhanceLarge200Nums,v=g-this.lastEnhanceTotal;this.lastEnhanceLess30Nums=p,this.lastEnhanceLess150Nums=m,this.lastEnhanceLess200Nums=_,this.lastEnhanceLarge200Nums=f,this.lastEnhanceTotal=g;let E={delayList:t,decodedList:e,renderList:i,deltaList:s,videoToDecodeList:a,videoDiscardList:d,audioToDecodeList:r,auidoDecodedList:o,audioRenderList:h,videoThrowFpsList:l,videoEnhanceList:c,videoEnhanceCostList:u,ehLess30Nums:S,ehLess150Nums:y,ehLess200Nums:T,ehLarge200Nums:P,ehTotal:v},C="WebCodecsPlayer.getStats\n";for(let t in E)C+="".concat(t,": ").concat(E[t].toString(),"\n");return C+="bufferLen:".concat(this.videoBufList.toString(),"\n"),n.a.log(C),this.videoBufList.length=0,E}destroy(){this.videoRender5SecFpsList.length=0}}(this),i&&i.initRender&&i.initRender(this),this.isRenderStart=!1,this.onVisibilityChangedBind=this.onVisibilitychange.bind(this),this.addEvents(),this.checkQuickTime=0,this.firstGetCurrentTime=0,this.firstPerformentTime=0,this.lastToDecodeAudioTs=0,this.lastToDecodeVideoTs=0,this.startAudioFastTs=0,this.startVideoFastTs=0,this.quickTime=_.a.now(),this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlaying.bind(this),this.onVideoResizeBind=this.onVideoResize.bind(this),this.isWebcodecsError=!1,this.lastIFrameTs=0,this.audioBrowserPaused=!1,this.isBrowserCloseHardAcc=!1,this.isAudioMuted=!1,this.PES_TIMESCALE=9e4,this._initPTS=void 0,this._initDTS=void 0,this.seekTime=0,this.isSeek=!1,this._lastVideoTs=-1e4,this._lastAudioTs=-1e4,this.audioSampleDuration=1024e3/44100,this.videoFirstFrameDecodeCost=0,this.audioFirstFrameDecodeCost=0,this.triggerPlayType=0,this._videoEl=null,this._status=null}appendTs(t){this.parser.parseTs(t)}addEvents(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.on(u.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}delEvents(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.off(u.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}initTs(t,e,i){if(null!=this._initPTS)return;let s=t.samples,r=e.samples,a=s.length,o=r.length,h=this.PES_TIMESCALE;0===o?(this._initPTS=s[0].pts-h*i,this._initDTS=s[0].dts-h*i):0===a?(this._initPTS=r[0].pts-h*i,this._initDTS=r[0].dts-h*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-h*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-h*i),n.a.log("WebCodecsPlayer initDTS/initPTS=[".concat(this._initDTS,", ").concat(this._initPTS,"]")),this.isSeek&&this.realSeek(this.seekTime)}getInitDts(){return this.isLive?super.getInitDts():this._initDTS/90}getCurrentTime(){const t=this.getVideoPts()-this.getInitDts();return Number.isNaN(t)?0:t}getCurrentAudioDts(){return this._mediaWebcodecs.getCurrentAudioDts()}setMuffledVolume(t){this._mediaWebcodecs.setMuffledVolume(t)}onWorkerInterval(t){this.destroyed||(t-this.quickTime>=1e3&&(this.quickTime=t,this.webCodecsStat.onCheckTimer(t)),(0==this.checkQuickTime||t-this.checkQuickTime>=2e4)&&(this.checkQuickTime=t,n.a.log("WebCodecsPlayer(".concat(this._id,").onCheckAudioQuickTimer aduio currentTime"),this.getCurrentAudioDts())))}setPlayMinBuffer(t){this._mediaWebcodecs.setPlayMinBuffer(t)}getBufferLen(){return this._mediaWebcodecs.getBufferLen()}getCurrentDts(){return this.getVideoPts()}getCurrentRealTime(){return this.getCurrentDts()}getCorrentCurrentDts(){return this.isPureAudio&&this.parser.timelineAudio?this.parser.timelineAudio.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.parser.timelineVideo?this.parser.timelineVideo.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.getCurrentTime()+this.getInitDts()}getVideoDecodeDelaySmooth(){return this._mediaWebcodecs.getDecodedVideoDelaySmooth()}triggerPlay(t,e,i){if(!this.playing){this.videoFirstFrameDecodeCost=t,this.audioFirstFrameDecodeCost=e,this.triggerPlayType="video"==i?1:2,n.a.log("WebcodecsPlayer.triggerPlay, type=".concat(i,", acost=").concat(e,", vcost=").concat(t));let s=this._mediaWebcodecs.getVideoElement();this.playing=!0,this.handler.onPlayVideo(s,this.widthCfg,this.heightCfg,!1,null,0,this.getCodecType()),this.isPlayVideo=!0}}triggerWebcodecsPlay(){if(this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.renderCallback(),this.handler.setWebCodecsSuccess(),this.isLive&&o.a.renderStat[0]){const t=this.getVideoPts();this.videoPlayConsuming.addRenderFrameData(t,_.a.now()),this.renderFps.addRender()}}setFramePause(){this.handler.setFramePause()}setFrameRusume(){this.handler.setFrameRusume()}renderFpsPause(){1==o.a.mobVBlockCfg&&this.handler.renderFpsPause(!0)}onFastOver(){this._mediaWebcodecs.onFastOver()}onCheckTimer(t,e){if(this.playing){if(0!=this.shildAudioStartTs){let t=this.getCurrentAudioDts();this.isAudioMuted&&t>=this.shildAudioStartTs&&(n.a.log("WebCodecsPlayer.shieldAudioMute recover"),this.setMuted(!1),this.shildAudioStartTs=0)}if(super.onCheckTimer(t,e),this.parser.fps&&this.parser.fps.getNoReferFps){const t=this.parser.fps.getNoReferFps();this._mediaWebcodecs.updateVideoFPS(this.metadata.recvVideoFps,t)}}else this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo()}getWebCodecsStats(){return this.webCodecsStat.getStats()}onCheckFastTimer(t,e){if(super.onCheckFastTimer(t,e),this.playing&&!this.userPaused){if(this.pauseHanlder.check(t),!this.pause500checked&&this.pauseHanlder.paused&&t-this.pauseHanlder.pausedTs>500){this.pause500checked=!0;const t=this.getBufferLen();n.a.log("WebCodecsPlayer(".concat(this._id,").onCheckFastTimer: play paused buf=").concat(t))}this.isLive&&this.checkPause5Sec(t)}}onCheckFastWorkerTimer(t){super.onCheckFastWorkerTimer(t),this.playing&&!this.userPaused&&(this.pauseWorkerHanlder.check(t),this._mediaWebcodecs.storeMainShieldAudio(this.isShieldAudio?1:0),this._mediaWebcodecs.storeFrameBuffer(this.getFrameBufferLen()))}checkPause5Sec(t){let e=this.getCurrentDts(),i=this.getCurrentAudioDts(),s=!1,r=!1;0!=e&&0!=this.lastVideoDts&&e==this.lastVideoDts?this.isVideoWebCodecsPaused||(this.videoWebcodecsPauseTs=t,this.isVideoWebCodecsPaused=!0):(this.videoWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1),0!=i&&0!=this.lastAudioDts&&i==this.lastAudioDts?this.isAudioWebCodecsPaused||(this.audioWebcodecsPauseTs=t,this.isAudioWebCodecsPaused=!0):(this.audioWebcodecsPauseTs=0,this.isAudioWebCodecsPaused=!1),0!=this.videoWebcodecsPauseTs&&t-this.videoWebcodecsPauseTs>=5e3&&(s=!0),0!=this.audioWebcodecsPauseTs&&t-this.audioWebcodecsPauseTs>=5e3&&(r=!0),s?n.a.warn("WebCodecsPlayer.onCheckTimer video paused 5 sec."):r&&n.a.warn("WebCodecsPlayer.onCheckTimer audio paused 5 sec."),(s||r)&&(this._onErrorEvent(3),this._onPlayerError(!0)),this.lastVideoDts=e,this.lastAudioDts=i}onWebcodecsError(t,e){if(this.isWebcodecsError)return;this.isWebcodecsError=!0,n.a.log("WebCodecsPlayer.onWebcodecsError, type=".concat(t));let i=[t];e&&i.push(e),this.handler&&this.handler.onActWebCodecs&&this.handler.onActWebCodecs([22],i),this.turnToMse(t)}turnToMse(t){if(this.handler&&this.handler._hyPlayer){if(t===Zo.WebCodecsErrType.VIDEODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++,this.handler.decoderDecodeError();else if(t===Zo.WebCodecsErrType.AUDIODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++;else if(t===Zo.WebCodecsErrType.VIDEOFAST)this.handler._hyPlayer.webcodecsErrCount++;else if(t===Zo.WebCodecsErrType.AUDIOFAST)this.handler._hyPlayer.webcodecsErrCount++;else{if(t!==Zo.WebCodecsErrType.WORKERERROR)return this.handler._hyPlayer&&(this.handler._hyPlayer.turnMseType=t),t===Zo.WebCodecsErrType.DECODE_COST?f.a.nextWcsTime=Date.now()+2592e5:t===Zo.WebCodecsErrType.DECODE_DTS&&(f.a.nextWcsTime=Number.MAX_SAFE_INTEGER),void this.handler.turnToMse();this.handler._hyPlayer.webcodecsErrCount++}this.handler._hyPlayer&&this.handler._hyPlayer.webcodecsErrCount>=3?(this.handler._hyPlayer.turnMseType=Zo.WebCodecsErrType.RETRY_MAX_TIMES,this.handler.turnToMse()):this.handler.webcodecsRetry()}}initAv1M4sTs(t,e,i){if(null!=this._initPTS)return;let s=this.PES_TIMESCALE;this._initPTS=Math.min(t.pts,e.pts)-s*i,this._initDTS=Math.min(t.dts,e.dts)-s*i,n.a.log("WebCodecsPlayer.initAv1M4sTs initDTS/initPTS=[".concat(this._initDTS,", ").concat(this._initPTS,"]")),this.isSeek&&this.realSeek(this.seekTime)}setVodAv1(){this._mediaWebcodecs&&this._mediaWebcodecs.setVodAv1&&this._mediaWebcodecs.setVodAv1()}remuxAv1(t,e){const i=t.sidxAudio.time_scale,s=t.moof.trafAudio.tfdt.base_media_decode_time,r=t.moof.trafAudio.tfhd.default_sample_duration,a=t.moof.trafAudio.trun.samples,o=1e3*s/i,h=t.sidxVideo.time_scale,d=t.moof.trafVideo.tfdt.base_media_decode_time,l=t.moof.trafVideo.tfhd.default_sample_duration,c=t.moof.trafVideo.trun.samples,u=1e3*d/h;let p=1024e3/i;p<this.audioSampleDuration-1&&(p=this.audioSampleDuration);let m=1e3*l/h;this.audioSampleNums=0,this.videoSampleNums=0,this.audioNewSamples=[],this.videoNewSamples=[];const _=1e3*r/i;_<20&&n.a.log("WebCodecsPlayer.remuxAv1 audio sampleDuration",_),a.map((t,e)=>{if(!t.units)return;const i=Math.floor(o+e*p),s=90*i;let r={type:"aac",empty:0,sampleDuration:p,pts:s,dts:s,ts:i,unit:t.units};this.audioNewSamples.push(r)}),c.map((t,e)=>{if(!t.units)return;this.videoSampleNums++;const i=Math.floor(u+e*m),s=90*i;let r={pts:s,dts:s,ts:i,cts:0,key:0==e,data:t.units};this.videoNewSamples.push(r)}),this.audioNewSamples.length>0&&this.videoNewSamples.length>0&&this.initAv1M4sTs(this.audioNewSamples[0],this.videoNewSamples[0],e.timeOffset),this.audioNewSamples.forEach(t=>{this._appendAudioSample(t)}),this.videoNewSamples.forEach(t=>{this._appendAv1VideoSample(t)})}updateAVCConfig(t){this._mediaWebcodecs.updateAVCConfig(t),this._addResizeEvt()}_addResizeEvt(){if(this._delResizeEvt(),this._mediaWebcodecs){let t=this._mediaWebcodecs.getVideoElement();this._videoEl!==t&&(t.addEventListener("resize",this.onVideoResizeBind),this._videoEl=t)}}_delResizeEvt(){this._videoEl&&(this._videoEl.removeEventListener("resize",this.onVideoResizeBind),this._videoEl=null)}getVideoWidth(){return this._videoEl?this._videoEl.videoWidth:0}getVideoHeight(){return this._videoEl?this._videoEl.videoHeight:0}updateAudioConfig(t,e,i){(e||this.audioConfig&&t.audioConfig&&this.audioConfig.toString(16)!==t.audioConfig.toString(16))&&this._mediaWebcodecs&&this._mediaWebcodecs.updateAudioConfig(t),super.updateAudioConfig(t,e,i)}updateM4sAudioConfig(t){this._mediaWebcodecs&&this._mediaWebcodecs.updateAudioConfig(t)}updateAVCPPS(t,e){this._mediaWebcodecs.updateAVCPPS(t,e)}updateAVCSPS(t,e){this._mediaWebcodecs.updateAVCSPS(t,e)}updateAVCVPS(t,e){this._mediaWebcodecs.updateAVCVPS(t,e)}pushAvcSample(t){this._mediaWebcodecs&&this._mediaWebcodecs.storeRecvVideoTs&&this._mediaWebcodecs.storeRecvVideoTs(t.ts),this.lowlatency?(this.pushAvcDts=t.ts,this._appendVideoSample(t)):super.pushAvcSample(t)}pushAacSample(t,e){this.lowlatency?this._appendAudioSample(t):super.pushAacSample(t,e)}appendAvcTrack(t){t.samples.map(t=>{t&&this._appendVideoSample(t)}),t.samples.length=0}_appendVideoSample(t){if(this.isLive){const e=_.a.now();this.videoPlayConsuming.pushRemuxedVideoFrameData(e),this.videoPlayConsuming.addRemuxFrameData(t.ts,t.ts+t.cts,e)}this._mediaWebcodecs.appendVideoSample(t)}_appendAv1VideoSample(t){if(-1e4!=this._lastVideoTs){const e=t.ts-this._lastVideoTs;e>=200&&n.a.log("WebCodecsPlayer._appendAv1VideoSample ts delta=",e,t.ts,this._lastVideoTs)}if(this.isLive){const e=_.a.now();this.videoPlayConsuming.pushRemuxedVideoFrameData(e),this.videoPlayConsuming.addRemuxFrameData(t.ts,t.ts+t.cts,e)}this._lastVideoTs=t.ts,this._mediaWebcodecs.appendAv1VideoSample(t)}_initSegmentSuc(t){this._mediaWebcodecs&&this._mediaWebcodecs.initSegmentSuc(t)}appendAacSample(t){t.samples.map(t=>{t&&this._appendAudioSample(t)}),t.samples.length=0}_appendAudioSample(t){if(t&&t.ts){if(-1e4!=this._lastAudioTs){const e=t.ts-this._lastAudioTs;e>=200&&n.a.log("WebCodecsPlayer._appendAudioSample ts delta=",e,t.ts,this._lastAudioTs)}if(this._lastAudioTs=t.ts,this.isLive){const e=_.a.now();this.audioPlayConsuming.addRemuxFrameData(t.ts,t.ts,e),this.audioPlayConsuming.pushRemuxedVideoFrameData(e)}this._mediaWebcodecs.appendAudioSample(t)}}onVisibilitychange(){super.onVisibilitychange(),this._mediaWebcodecs.onVisibilitychange(),"hidden"==document.visibilityState?this.isBrowserHidden=!0:"visible"==document.visibilityState&&(this.isBrowserHidden=!1)}containerResize(t){this._mediaWebcodecs.containerResize(t)}getVideoPts(){if(o.a.dtsJumpOpen){if(this.isPureAudio&&this.parser.timelineAudio)return this.parser.timelineAudio.getRealDtsByPts(this._mediaWebcodecs.getVideoPts());if(this.parser.timelineVideo)return this.parser.timelineVideo.getRealDtsByPts(this._mediaWebcodecs.getVideoPts())}return this._mediaWebcodecs.getVideoPts()}reset(){super.reset()}destroy(){super.destroy(),this._delResizeEvt(),this._mediaWebcodecs&&this._mediaWebcodecs.destroy(),this.destroyed=!0,this.isRenderStart=!1,this.playing=!1,this.pause500checked=!1,this.parser&&this.parser.destroy(),this.pauseHanlder&&this.pauseHanlder.reset(),Ps(this.rafId),this.startAudioFastTs=0,this.startVideoFastTs=0,this.userPaused=!1,this.quickTime=0,this.delEvents(),this.lastVideoDts=0,this.lastAudioDts=0,this.videoWebcodecsPauseTs=0,this.audioWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1,this.isAudioWebCodecsPaused=!1,this.isWebcodecsError=!1,this.lastIFrameTs=0,this.webCodecsStat&&this.webCodecsStat.destroy(),this.isBrowserCloseHardAcc=!1,this.isAudioMuted=!1}_playPause(t){this.pauseStat.pause();const e=this.getVideoPts()>0;this.handler.onPlayPause(t,e)}_playResume(t,e){this.pauseStat.resume(),this.pause500checked=!1;const i=this.getVideoPts()>0;this.handler.onPlayResume(t,i)}_playWorkerPause(t){const e=this.getVideoPts()>0;this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(t,e)}_playWorkerResume(t,e){const i=this.getVideoPts()>0;this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(t,i)}check500Pause(){this.handler.check500Pause&&this.handler.check500Pause()}getDecodeFps(){return this._mediaWebcodecs.getDecodeFps()}getVideoRenderFps(){return this._mediaWebcodecs.getVideoRenderFps()}getAudioRenderFps(){return this._mediaWebcodecs.getAudioRenderFps()}getVideoThrowFps(){return this._mediaWebcodecs.getVideoThrowFps()}getDecodedBuffer(){return this._mediaWebcodecs.getDecodedBuffer()}getDiscardVideoFrames(){return this._mediaWebcodecs.getDiscardVideoFrames()}getEnhanceVideoFrames(){return this._mediaWebcodecs.getEnhanceVideoFrames&&this._mediaWebcodecs.getEnhanceVideoFrames()}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;super.setJitter(t,e,i),this._mediaWebcodecs.setJitter(t,e,i,o.a.jumpBufferCfg,o.a.shieldAudioCfg[1],o.a.jumpBufferCfg2[0])}onVideoPause(t){n.a.log("WebCodecsPlayer.onVideoPause"),this.userPaused=!0}onVideoPlaying(){if(this.handler&&this.handler.updateStatus){if(this._mediaWebcodecs.isAudioSuspended())return;const t=p.VIDEO_PLAYING;this.handler.updateStatus(t)}}turnToWebcodecsSoft(){this.handler.turnToWebcodecsSoft()}getVideo(){return this._mediaWebcodecs&&this._mediaWebcodecs.getVideoElement()}getVolume(){let t=this._mediaWebcodecs&&this._mediaWebcodecs.getVideoElement();return t?t.volume:0}getMuted(){let t=this._mediaWebcodecs&&this._mediaWebcodecs.getVideoElement();return!!t&&t.muted}onPauseByBrowser(){let t=this._mediaWebcodecs.getVideoElement();n.a.log("WebCodecsPlayer.onPauseByBrowser volume=".concat(this.getVolume()," muted=").concat(this.getMuted()," paused=").concat(t&&t.paused)),this.isBrowserPause=!0,this._mediaWebcodecs.onVideoPause(),super.onPauseByBrowser()}checkAutoMutedPlay(){let t=this.getVolume();if(n.a.log("WebCodecsPlayer.checkAutoMutedPlay volume=".concat(t,", muted=").concat(this.isAudioMuted)),this.autoMutedPlay){t>0&&this.setVolume(0);let e=this._mediaWebcodecs.getVideoRender();e&&e.play()}}onAudioPauseByBrowser(){this.audioBrowserPaused=!0}onVideoPlay(t){n.a.log("WebCodecsPlayer.onVideoPlay"),this.userPaused=!1,this.audioBrowserPaused=!1}onVideoError(t){let e="",i=this._mediaWebcodecs.getAudioError();if(i){let t=i.code;e=" errCode="+t+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][t],3!=t&&4!=t||(this._onErrorEvent(3==t?1:2),this._onPlayerError(!0))}n.a.warn("WebCodecsPlayer.onVideoError"+e)}_onPlayerError(t){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(t))}_onErrorEvent(t){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:t}))}pause(){n.a.info("WebCodecsPlayer.pause"),this.userPaused=!0,this._mediaWebcodecs.userPause()}play(){n.a.info("WebCodecsPlayer.play"),this.userPaused=!1,this._mediaWebcodecs.userPlay()}setUseSoftAcceleration(){this._mediaWebcodecs.setUseSoftAcceleration(),this.handler.setUseSoftAcceleration(!0)}setPauseVideoDecode(t){this._mediaWebcodecs.setPauseVideoDecode(t)}setPauseAudioDecode(t){this._mediaWebcodecs.setPauseVideoDecode(t)}disableHardAcc(){super.disableHardAcc(),this.onWebcodecsError(Zo.WebCodecsErrType.DISABLE_HARDWARE_ACCELERATION)}win7PerfInsufficient(){this.onWebcodecsError(Zo.WebCodecsErrType.WIN_PERF_INSUFFICIENT)}angelNullError(){this.onWebcodecsError(Zo.WebCodecsErrType.ANGLE_NULL)}chromeH265RenderEmptyError(){this.isH265Mode&&(f.a.isChromeH265RenderInfoEmpty=1,this.onWebcodecsError(Zo.WebCodecsErrType.CHROME_H265_RENDER_INFO_EMPTY))}isNotSupportWebcodecsConfig(){this.onWebcodecsError(Zo.WebCodecsErrType.IS_NOT_SUPPORT_CONFIGURE)}setEnableDiscard(t){this._mediaWebcodecs.setEnableDiscard(t)}updateCurBitrate(t){this._mediaWebcodecs.updateCurBitrate(t)}setDisableHardAcc(){this.isBrowserCloseHardAcc=!0}autoReport(){h.a.name.indexOf("chrome")>-1&&this.isH265Mode&&1e3*Math.random()<=100&&1==o.a.isAutoWcsReport&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(u.P2P_REPORT)}setRealFps(t){this._mediaWebcodecs.setRealFps(t)}startMuteRender(t){let e=this._mediaWebcodecs.getVideoElement();e&&(e.volume=t,e.muted=0===t),this._mediaWebcodecs.startMuteRender(t)}setMuted(t){let e=this._mediaWebcodecs.getVideoElement();e&&(e.muted=t),this.isAudioMuted=t,this._mediaWebcodecs.setMuted(t)}on265StartCodeError(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}turnToH264(t){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(t)}setEnhance(t){this._mediaWebcodecs.setEnhance&&this._mediaWebcodecs.setEnhance(t)}setSegmenttion(t){this._mediaWebcodecs.setSegmenttion&&this._mediaWebcodecs.setSegmenttion(t)}onVideoEnhanceError(t){this.handler&&this.handler&&this.handler.onVideoEnhanceError(t)}onVideoEnhanceSuccess(){this.handler&&this.handler&&this.handler.onVideoEnhanceSuccess()}getRenderElement(){return this._mediaWebcodecs&&this._mediaWebcodecs.getVideoElement()}onRevFastOver(){this._mediaWebcodecs.onRevFastOver()}onVideoSeek(t){n.a.log("WebcodecsPlayer.onVideoSeek",t),this.handler&&this.handler.onVideoSeek&&this.handler.onVideoSeek(t)}seek(t){null==this._initPTS?(this.isSeek=!0,this.seekTime=t):this.realSeek(t)}realSeek(t){const e=this.getInitDts();n.a.log("WebcodecsPlayer.realSeek, seekTime=".concat(t,", initDts=").concat(e)),this._mediaWebcodecs&&this._mediaWebcodecs.seek&&this._mediaWebcodecs.seek(t,e),this.isSeek=!1}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n.a.log("WebcodecsPlayer.setPlaybackRate",t),this._mediaWebcodecs&&this._mediaWebcodecs.setPlaybackRate&&this._mediaWebcodecs.setPlaybackRate(t)}};let sn=0;var rn=class{constructor(t,e,i){this._id=sn++,n.a.log("P2PFlvPlayer(".concat(this._id,").constructor")),this._isP2pPlayIng=!1,this._type=w.FLV,this.eventEmitter=t,this._hyPlayer=e.hyPlayerIns,this.player=null,this.p2pPlayer=null,this.flvPlayer=null,this.exceptionStat=new eo(this),this.info=null,this.isPureAudio=e.isPureAudio,this.isPureVideo=e.isPureVideo,this.h265Proxy=e.h265Proxy,this.statSwitch=e.statSwitch,this.autoMonitor=e.autoMonitor,this.recSysStat=e.recSysStat,this.isSoftSolution=e.isSoftSolution,this.seiDataChannl=e.seiDataChannl,this._switch265FailBind=this._switch265Fail.bind(this),this.ctrlBitrate=new Ro({player:this,statSwitch:this.statSwitch,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat},{start:this._switchStart.bind(this),first:this._switchFirstSample.bind(this),done:this._switchDone.bind(this)}),this.videoElement=e.videoElement,this.tsdb=e.tsdb,this.stat=e.stat,this.mse=null,this.ctrlBitrate.beforeSwitchCb=this._beforeSwitch.bind(this),this.switchDoneBefore=new class{constructor(){this.mse=null,this.dtsGap=0,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=null}stop(){this.mse=null,this.dtsGap=0,this.callbacks=null,X.remove(this._onTimer,this)}start(t,e,i){n.a.log("SwitchDoneBefore.start bufferLen=".concat(t.getBufferLen()," dtsGap=").concat(e)),this.mse=t,this.dtsGap=e,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=i,X.add(this._onTimer,this,100),this._onTimer(0)}_onTimer(t){if(this.mse){let t=200;Number(f.a._localBuffer)>0&&(t=Number(f.a._localBuffer));let e=this.mse.getBufferLen();e<=t||this.dtsGap+e<=0||this.pauseCnt>2?(n.a.log("SwitchDoneBefore.done bufferLen=".concat(e," dtsGap=").concat(this.dtsGap," pauseCnt=").concat(this.pauseCnt)),X.remove(this._onTimer,this),this.callbacks&&this.callbacks.done()):e===this.lastBufferLen&&this.pauseCnt++,this.lastBufferLen=e}else this.stop()}},this.anticode=new Gi,this.videoStatus=p.VIDEO_INIT,this.closeP2pCoderates=[],this.onP2PTimeoutBind=this.onP2pTimeout.bind(this),this.flvTryToP2PBind=this.flvTryToP2P.bind(this),this.eventEmitter.on(u.P2P_TIMEOUT,this.onP2PTimeoutBind),this.eventEmitter.on(u.FLV_TRY_TO_P2P,this.flvTryToP2PBind),this.handlerType=0,this.playerCoreType="",this.isWebcodecsPlaying=!1,this.isWasmH265Playing=!1,this.useMultiVideo=!0,this.autoMutedPlay=!0,this.mutilVideo=new class{constructor(){this.renderInfo=null,this._stop=!1,this.mutilVideoNums=2,this.originVideoWidth=0,this.originVideoHeight=0,this.video1X=0,this.video1Y=0,this.video1Width=0,this.video1Height=0,this.video2X=0,this.video2Y=0,this.video2Width=0,this.video2Height=0,this.videoScale=1,this._start=!1,this.animationFrameId=null,this.canvasImgWidth=0,this.canvasImgHeight=0,this.canvasImgX=0,this.canvasImgY=0,this.canvas2ImgX=0,this.canvas2ImgY=0,this.canvas2ImgWidth=0,this.canvas2ImgHeight=0,this.containerWidth=1280,this.containerHeight=720,this._canvas2ContainerWidth=288,this._canvas2ContainerHeight=161,this._canvas2Container=null,this.containerSizes=null,this._isMultiVideo=!1,this.h265Proxy={},this.avccWidth=1280,this.avccHeight=720,this._multiVideoRenderRects=[]}updateRenderInfo(t){this._isMultiVideo=!0,this.renderInfo||(this.renderInfo=t,this._canvas1=document.createElement("canvas"),this._canvas2=document.createElement("canvas"),this._ctx1=this._canvas1.getContext("2d"),this._ctx2=this._canvas2.getContext("2d"),this.h265Proxy.canvas=this._canvas1,this.h265Proxy.isReady=!0,this.parseRenderInfo(t))}parseRenderInfo(t){this.originVideoWidth=t[2]+(t[3]<<8),this.originVideoHeight=t[4]+(t[5]<<8),this.video1X=t[8]+(t[9]<<8),this.video1Y=t[10]+(t[11]<<8),this.video1Width=t[12]+(t[13]<<8),this.video1Height=t[14]+(t[15]<<8),console.log("parseRenderInfo",this.video1Width,this.video1Height),this.video2X=t[18]+(t[19]<<8),this.video2Y=t[20]+(t[21]<<8),this.video2Width=t[22]+(t[23]<<8),this.video2Height=t[24]+(t[25]<<8),this.video1WidthScale=this.video1Width/this.originVideoWidth,this.video2WidthScale=this.video2Width/this.originVideoWidth,this.video1HeightScale=this.video1Height/this.originVideoHeight,this.video2WidthScale=this.video2Height/this.originVideoHeight}getVideoScale(){return{scale1:{ws:this.video1WidthScale,hs:this.video1HeightScale},scale2:{ws:this.video2WidthScale,hs:this.video2HeightScale}}}playStart(t,e,i){this.renderInfo&&(this.avccWidth=e,this.avccHeight=i,this.video=t,this.videoScale=e/this.originVideoWidth,this._initializeCanvas(this.videoScale),this.startCapture(),this._start=!0,this.containerSizes&&this.containerResize(this.containerSizes),this.addTimer())}addTimer(){this.removeTimer(),X.add(this.onCheckTimer,this,50)}removeTimer(){X.remove(this.onCheckTimer,this,50)}onCheckTimer(){this.getReady()&&(!this._canvas2Container&&this._canvas2.parentElement&&(this._canvas2Container=this._canvas2.parentElement),this._canvas2Container&&this._canvas2Container.offsetWidth>0&&this._canvas2Container.offsetHeight>0&&(this._canvas2Container.offsetWidth!=this._canvas2ContainerWidth||this._canvas2ContainerHeight!=this._canvas2Container.offsetHeight)&&this.canvas2ContainerResize({width:this._canvas2Container.offsetWidth,height:this._canvas2Container.offsetHeight}))}_initializeCanvas(){const t=()=>{if(!this.video)return;let t=this.video.videoWidth,e=this.video.videoHeight;0!=t&&0!=e||(t=this.avccWidth,e=this.avccHeight),this.videoScale=t/this.originVideoWidth,this._canvas1.width=this.video1Width*this.videoScale,this._canvas1.height=this.video1Height*this.videoScale,this._canvas2.width=this.video2Width*this.videoScale,this._canvas2.height=this.video2Height*this.videoScale,this.updateCanvas1Sizes()};t(),this.video.addEventListener("loadedmetadata",t)}canvas2ContainerResize(t){this.getReady()&&(this._canvas2ContainerWidth=t.width,this._canvas2ContainerHeight=t.height,this.updateCanvas2Sizes(),this._initializeCanvas())}containerResize(t){console.log("MutilVideo.containerResize",t.width,t.height),this.containerSizes=t,this.containerWidth=t.width,this.containerHeight=t.height,this.getReady()&&this._initializeCanvas()}updateCanvas1Sizes(){let t=this.updateRenderRect(this.video1Width,this.video1Height,this.containerWidth,this.containerHeight,this.videoScale);this.canvasImgX=t.canvasImgX,this.canvasImgY=t.canvasImgY,this.canvasImgWidth=t.canvasImgWidth,this.canvasImgHeight=t.canvasImgHeight,this._multiVideoRenderRects=[{videoX:this.canvasImgX,videoY:this.canvasImgY,width:this.canvasImgWidth,height:this.canvasImgHeight}]}updateCanvas2Sizes(){let t=this.updateRenderRect(this.video2Width,this.video2Height,this._canvas2ContainerWidth,this._canvas2ContainerHeight,this.videoScale);this.canvas2ImgX=t.canvasImgX,this.canvas2ImgY=t.canvasImgY,this.canvas2ImgWidth=t.canvasImgWidth,this.canvas2ImgHeight=t.canvasImgHeight}updateRenderRect(t,e,i,s,r){let a,o,n,h;if(e&&t&&i&&s){let d=t/e,l=i/s;if(l>d){let i=(1-d/l)*t*r;a=i/2,o=0,h=e*r,n=t*r-i}else{let i=(1-l/d)*e*r;a=0,n=t*r,o=i/2,h=e*r-i}return{canvasImgX:a,canvasImgY:o,canvasImgWidth:n,canvasImgHeight:h}}return{canvasImgX:0,canvasImgY:0,canvasImgWidth:0,canvasImgHeight:0}}getMultiVideoRenderRects(){return this._multiVideoRenderRects}startCapture(){const t=()=>{this._stop?cancelAnimationFrame(this.animationFrameId):(this.getReady()&&(this._ctx1.clearRect(0,0,this._canvas1.width,this._canvas1.height),this._ctx2.clearRect(0,0,this._canvas2.width,this._canvas2.height),this._ctx1.drawImage(this.video,0,0,Math.floor(this.video1Width*this.videoScale),Math.floor(this.video1Height*this.videoScale),this.canvasImgX,this.canvasImgY,this.canvasImgWidth,this.canvasImgHeight),this._ctx2.drawImage(this.video,this.video2X*this.videoScale,this.video2Y*this.videoScale,this.video2Width*this.videoScale,this.video2Height*this.videoScale,this.canvas2ImgX,this.canvas2ImgY,this.canvas2ImgWidth,this.canvas2ImgHeight)),this.animationFrameId=requestAnimationFrame(t))};t()}getCanvas1(){return{canvas:this._canvas1,width:this._canvas1.width,height:this._canvas1.height}}getCanvas2(){return{canvas:this._canvas2,width:this._canvas2.width,height:this._canvas2.height}}stop(){this._stop=!0,this.removeTimer()}getIsMultiVideo(){return this._isMultiVideo}getReady(){return this._start}getMse1AvcCfgWidth(){return this.video1Width*this.videoScale}getMse1AvcCfgHeight(){return this.video1Height*this.videoScale}getRender1Element(){return this._canvas1}getMse2AvcCfgWidth(){return this.video2Width*this.videoScale}getMse2AvcCfgHeight(){return this.video2Height*this.videoScale}getRender2Element(){return this._canvas2}getCanvas1Info(){let t={};return t.getRenderElement=this.getRender1Element.bind(this),t.getMseAvcCfgWidth=this.getMse1AvcCfgWidth.bind(this),t.getMseAvcCfgHeight=this.getMse1AvcCfgHeight.bind(this),t.h265Proxy=this.h265Proxy,t}getCanvas2Info(){let t={};return t.getRenderElement=this.getRender2Element.bind(this),t.getMseAvcCfgWidth=this.getMse2AvcCfgWidth.bind(this),t.getMseAvcCfgHeight=this.getMse2AvcCfgHeight.bind(this),t.h265Proxy=this.h265Proxy,t}getVideo2Rect(){return{x:this.video2X,y:this.video2Y,width:this.video2Width,height:this.video2Height,originVideoWidth:this.originVideoWidth,originVideoHeight:this.originVideoHeight}}},this.voiceChecker=new class{constructor(){this.analyser=null,this.audioEnergy=null,this.lastVoiceTs=0,this.noVoiceDur=0,this.noVoiceCnt=0,this.muted=!1,this.volume=1}setAnalyser(t){n.a.log("VoiceChecker.setAnalyser analyser=".concat(!!t)),t&&(this.analyser=t,t.fftSize=64,t.smoothingTimeConstant=0,this.audioEnergy=new Uint8Array(this.analyser.frequencyBinCount))}start(){this.lastVoiceTs=_.a.now(),X.add(this.onCheckFastTimer,this,o.a.voiceTimer)}stop(){this.analyser=null,this.audioEnergy=null,this.lastVoiceTs=0,X.remove(this.onCheckFastTimer,this)}onCheckFastTimer(t){if(this.analyser){this.analyser.getByteFrequencyData(this.audioEnergy);let t=!1;for(let e=0;e<this.audioEnergy.length;e++)if(this.audioEnergy[e]>0){t=!0;break}this.onAudioEnergy(t)}}onAudioEnergy(t){if(!this.muted&&0!==this.volume&&t){let t=_.a.now();if(0===this.lastVoiceTs)this.lastVoiceTs=t;else{let e=t-this.lastVoiceTs;e>200&&(this.noVoiceDur+=e,this.noVoiceCnt++),this.lastVoiceTs=t}}}setMuted(t){!this.muted&&t?this.onAudioEnergy(!0):this.muted&&!t&&(this.lastVoiceTs=_.a.now()),this.muted=t}setVolume(t){0===this.volume&&t>0?this.lastVoiceTs=_.a.now():this.volume>0&&0===t&&this.onAudioEnergy(!0),this.volume=t}getStats(){let t={noVoiceDur:this.noVoiceDur,noVoiceCnt:this.noVoiceCnt};return this.noVoiceDur=this.noVoiceCnt=0,t}getEmptyAudioDurationHeart(){let t=this.noVoiceDur;return this.noVoiceDur=0,this.noVoiceCnt=0,t}}}getAnticodeHandler(){return this.anticode}initPlayer(t,e){this.info=t,t.hasOwnProperty("autoMutedPlay")&&(this.autoMutedPlay=t.autoMutedPlay),"safari"==h.a.name?this.useMultiVideo=!1:t.hasOwnProperty("useMultiVideo")&&(this.useMultiVideo=t.useMultiVideo),t.mpExtArgs&&t.mpExtArgs.closep2pcoderate&&(this.closeP2pCoderates=t.mpExtArgs.closep2pcoderate.split(","));let i=t.iIsP2PSupport,s=this.getIsCloseP2P();i&&s&&(t.type===HYPlayer.VR?t.vr.playerType=0:t.type=HYPlayer.FLV),this.handlerType=e.handlerType,n.a.log("P2PFlvPlayer(".concat(this._id,").initPlayer, closeP2pCoderates"),this.closeP2pCoderates),X.add(this.onCheckTimer,this,1e3);let r=e.playerCoreType;return this.playerCoreType=r,this.mse=r===N.a.PLAYER_CORE_TYPE.WEBCODECS?this.createWebCodecsPlayer():this.createMse(),this.mse.setSeiDataChannelPortListers(this.seiDataChannl),r===N.a.PLAYER_CORE_TYPE.WEBCODECS?this.isSoftSolution?this.stat.setComDim(d.a.DIM_COM.MSE_PLAYER,3):this.stat.setComDim(d.a.DIM_COM.MSE_PLAYER,2):this.stat.setComDim(d.a.DIM_COM.MSE_PLAYER,this.mse.isMMS?4:1),t.team_port&&this.stat.setComDim(d.a.DIM_COM.TEAM_PORT,t.team_port),e.mse=this.mse,e.exceptionStat=this.exceptionStat,e.p2pFlvPlayer=this,e.anticode=this.anticode,e.voiceChecker=this.voiceChecker,this.flvPlayer=new or(this.eventEmitter,e,this.videoElement),this.p2pPlayer=new Lr(this.eventEmitter,e,this.videoElement),this.startPlayer(t)}sendAnticodeHeart(){this.player&&this.player.sendAnticodeHeart&&this.player.sendAnticodeHeart()}updateCurrentPageRenderFps(t){this.eventEmitter.updateCurrentPageRenderFps&&this.eventEmitter.updateCurrentPageRenderFps(t)}createMse(){let t=new to(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement});return t.setAutoMutedPlay(this.autoMutedPlay),t.setPushGop(o.a.pushGop),t}createWebCodecsPlayer(){let t=f.a.hasOwnProperty("_minBuffer")?Number(f.a._minBuffer):3e3;const e=new en(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement,isH265Mode:this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,lowlatencyCfg:{lowlatencyBuf:-1,lowlatencyMin:t+500,lowlatencyMax:t+1e3,openRenderSync:1}});return e.setAutoMutedPlay(this.autoMutedPlay),e.setPushGop(o.a.pushGop),e}startPlayer(t){this.resetStartProps(),this.stat.setComDim(d.a.DIM_COM.UA,navigator.userAgent);const e=R.b.isXiaomi(navigator.userAgent)&&1==o.a.isCloseXiaomiPcdnP2p;switch(t.type){case w.FLV:this._hyPlayer.lastFlvInfo=t,this._hyPlayer.lastP2PInfo&&(this.flvPlayer.backToP2P.lastP2PInfo=this._hyPlayer.lastP2PInfo),this.player=this.flvPlayer,this._type=w.FLV;break;case w.P2P:if(!$.isSupportP2P()||e||o.a.isCloseP2PAid(t.presenterUid)||o.a.isCloseP2P(t.uid)||o.a.isCloseAllFuncs(t.uid)||o.a.isCloseP2PBroVer()||o.a.isClosePidMediaP2P(t.presenterUid,t.lineType))return this._hyPlayer.lastP2PInfo=t,this.onP2pTimeout(u.P2P_TIMEOUT,{reason:N.a.turnToFlvReason.NOT_SUPPORT_P2P}),void n.a.warn("xxxxxxx "+h.a.name+" "+h.a.version.major+" unsupport p2p !");this._hyPlayer.lastP2PInfo=t,this._isP2pPlayIng=!0,this.p2pPlayingEvent(this._isP2pPlayIng),this._hyPlayer.isForceFlv=!1,this.player=this.p2pPlayer,this._type=w.P2P}return this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.isSoftSolution&&this.mse.setUseSoftAcceleration(),this.mse&&this.mse.updateCurBitrate&&this.mse.updateCurBitrate(t.curBitrate),!0}resetStartProps(){this.videoStatus=p.VIDEO_INIT,this.isWasmH265Playing=!1,this.isWebcodecsPlaying=!1,this.h265Proxy.isLive=!0}start(t){P.bindEvent(this.tsdb,t._sessionId,t.lineType,t.sDisplayName,t.iBitRate),t.type==w.P2P&&this.flvPlayer.checkParams(t),t.hasOwnProperty("autoMutedPlay")&&(this.autoMutedPlay=t.autoMutedPlay),"safari"==h.a.name?this.useMultiVideo=!1:t.hasOwnProperty("useMultiVideo")&&(this.useMultiVideo=t.useMultiVideo),this.videoStatus=p.VIDEO_LOADING,t.type==w.P2P&&t.p2purl?this.player.startP2PUrl(t):this.player.start(t)}startP2PUrl(t){t.type==w.P2P&&t.p2purl&&this.player.startP2PUrl(t)}onCheckTimer(t,e){this.anticode.onCheckTimer(t,e)}setMuffled(t,e){this.eventEmitter.setMuffled(t,e)}flvTryToP2P(){n.a.log("P2PFlvPlayer(".concat(this._id,").flvTryToP2P")),this._hyPlayer.lastP2PInfo&&(this._hyPlayer.flvTryToP2P&&this._hyPlayer.flvTryToP2P(),this._hyPlayer.metrics.setP2p(1),v.a.flvTryToP2P=1,this._hyPlayer.lastP2PInfo.type===HYPlayer.VR?this._hyPlayer.lastP2PInfo.vr.playerType=1:this._hyPlayer.lastP2PInfo.type=HYPlayer.P2P,this.trigger(u.FLV_TO_P2P),this._hyPlayer.isForceFlv=!1,this._hyPlayer.sdkTurnToP2P=!0,this._hyPlayer.start(this._hyPlayer.lastP2PInfo)),this._hyPlayer.flacMgr&&(this._hyPlayer.stopFlac(),this._hyPlayer.startFlac())}onP2pTimeout(t,e){this._hyPlayer.onP2pTimeout&&this._hyPlayer.onP2pTimeout(),this._isP2pPlayIng=!1,this.p2pPlayingEvent(this._isP2pPlayIng),this._hyPlayer.isForceFlv=!0,this._hyPlayer.lastP2PInfo.type===HYPlayer.VR?this._hyPlayer.lastP2PInfo.vr.playerType=0:this._hyPlayer.lastP2PInfo.type=HYPlayer.FLV,this._hyPlayer.start(this._hyPlayer.lastP2PInfo);const{reason:i,domain:s,pcdnIaas:r}=e;i!=N.a.turnToFlvReason.P2P_ARGS_ERROR&&i!=N.a.turnToFlvReason.P2P_COOLING&&i!=N.a.turnToFlvReason.IS_NOT_FIRST_FETCH&&i!=N.a.turnToFlvReason.VIDEO_BUFFER_EMPTY&&i!=N.a.turnToFlvReason.NOT_SUPPORT_P2P&&(n.a.log("P2PFlvPlayer.onP2pTimeout, domain=".concat(s,", reason=").concat(i)),this.stat&&this.stat.setComDim(d.a.DIM_COM.P2P_TO_FLV_DOMAIN,s),this.stat.setComDim(d.a.DIM_COM.PCDN_IAAS,r))}p2pPlayingEvent(t){this.trigger(u.P2P_PLAYING_EVENT,{isP2pPlayIng:t})}trigger(t,e){this.eventEmitter.trigger(t,e)}setVolume(t){this.player.setVolume(t),this.voiceChecker.setVolume(t)}setEnableLowLatency(t){this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(t)}setPlaybackrateAccess(t){this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(t)}updateFlvConfig(){this.player&&this.player.updateFlvConfig&&this.player.updateFlvConfig()}updateP2PConfig(){this.player&&this.player.updateP2PConfig&&this.player.updateP2PConfig()}getFrameData(){return this.player&&this.player.getFrameData()}getExceptionStat(){return this.player.exceptionStat?this.player.exceptionStat.getStat():""}seek(t){this.player&&this.player.seek&&this.player.seek(t)}getBufferLen(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}setMuted(t){this.player&&this.player.setMuted(t),this.voiceChecker.setMuted(t)}getMuted(){return this.player&&this.player.getMuted()}getCurrentTime(){return this.player&&this.player.getCurrentTime()}getCurrentDts(){return this.player?this.player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this.player?this.player.getCurrentSeiOffsetDts():0}play(){this.player&&this.player.play()}pause(){this.player&&this.player.pause()}stop(){n.a.log("P2PFlvPlayer(".concat(this._id,").stop")),this._isP2pPlayIng=!1,this.videoStatus=p.VIDEO_INIT,this.p2pPlayingEvent(this._isP2pPlayIng),this.flvPlayer&&(this.flvPlayer.stop(),this.flvPlayer=null),this.p2pPlayer&&(this.p2pPlayer.stop(),this.p2pPlayer=null),this.mse&&(this.mse.destroy(),this.mse=null),this.mutilVideo&&this.mutilVideo.stop(),this.voiceChecker.stop(),this.eventEmitter.off(u.P2P_TIMEOUT,this.onP2PTimeoutBind),this.eventEmitter.off(u.FLV_TRY_TO_P2P,this.flvTryToP2PBind),this.ctrlBitrate.stop(),this.switchDoneBefore.stop(),X.remove(this._switchFirstVideoTimeout,this),X.remove(this._switchPtsIFrameTimeout,this),X.remove(this.onCheckTimer,this),this.info=null,this.handlerType=0,this.isWebcodecsPlaying=!1,this.isWasmH265Playing=!1}destroy(){this.videoElement=null,this.flvPlayer&&(this.flvPlayer.destroy(),this.flvPlayer=null),this.p2pPlayer&&(this.p2pPlayer.destroy(),this.p2pPlayer=null),this.mse&&(this.mse.destroy(),this.mse=null),this.ctrlBitrate&&(this.ctrlBitrate.destroy(),this.ctrlBitrate=null),this.voiceChecker&&this.voiceChecker.stop(),this.voiceChecker=null,this.exceptionStat&&this.exceptionStat.destroy(),this.exceptionStat=null,this.eventEmitter.off(u.P2P_TIMEOUT,this.onP2PTimeoutBind),this.eventEmitter.off(u.FLV_TRY_TO_P2P,this.flvTryToP2PBind),this.switchDoneBefore&&this.switchDoneBefore.stop(),this.switchDoneBefore=null,X.remove(this._switchFirstVideoTimeout,this),X.remove(this._switchPtsIFrameTimeout,this),X.remove(this.onCheckTimer,this),this.info=null,this.eventEmitter=null}stopStream(t){this.player&&this.player.stopStream&&this.player.stopStream(t)}checkPcdnMode(t){this.player&&this.player.checkPcdnMode&&this.player.checkPcdnMode(t.mPcdnModeSwitch.value,t.mPcdnModePcdnName.value)}containerResize(t){this.player&&this.player.h265Proxy&&this.player.h265Proxy.containerResize&&this.player.h265Proxy.containerResize(t)}containerResizeNew(t){if(this.mutilVideo&&this.mutilVideo.getReady()&&this.mutilVideo.containerResize){this.mutilVideo.containerResize(t);let e=this.mutilVideo.getMultiVideoRenderRects();this.updateMultivideoRenderRects(e)}}updateMultivideoRenderRects(t){let[{videoX:e,videoY:i,width:s,height:r}]=t;this.eventEmitter.updateMultivideoRenderRects([{videoX:e,videoY:i,width:s,height:r}])}getCdnSip(){return this.player&&this.player.getCdnSip&&this.player.getCdnSip()}getDelayInfo(){return this.player&&this.player.mse.getDelayInfo()}getRealBitrate(){return this.player&&this.player.mse.getRealBitrate()}setVideoPlayTimeSended(){this.player&&this.player.setVideoPlayTimeSended&&this.player.setVideoPlayTimeSended()}onVideoStop(t,e){this.player&&this.player.onVideoStop&&this.player.onVideoStop(t,e)}onPlayResume(t){this.player&&this.player.onPlayResume&&this.player.onPlayResume(t)}onPlayResumeWorker(t){this.player&&this.player.onPlayResumeWorker&&this.player.onPlayResumeWorker(t)}onPlayerError(t){this.player&&this.player.onPlayerError&&this.player.onPlayerError(t)}onErrorEvent(t){n.a.log("P2PFlvPlayer(".concat(this._id,").onErrorEvent"),t),this.player&&this.player.onErrorEvent&&this.player.onErrorEvent(t)}onMseHevcError(t){n.a.log("P2PFlvPlayer(".concat(this._id,").onMseHevcError"));let e=0;1==t?e=3e3:2==t?e=3001:3==t?e=3002:4==t?e=3003:5==t&&(e=3004),this.stat.setComDim("backup_field1",e),this.player&&this.player.turntoH265Wasm&&this.player.turntoH265Wasm()}wcsRenderError(t){n.a.log("P2PFlvPlayer(".concat(this._id,").wcsRenderErr"),t)}mseHevcRenderErr(t){n.a.log("P2PFlvPlayer(".concat(this._id,").mseHevcRenderErr"),t)}onVideoParseInvalid(){this.player&&this.player.onVideoParseInvalid&&this.player.onVideoParseInvalid()}onGop(t){this.player&&this.player.onGop&&this.player.onGop(t)}turnToH264(t){this.player&&this.player.turnToH264&&this.player.turnToH264(t)}h265Retry(){this.player&&this.player.h265Retry&&this.player.h265Retry()}reloadInError(){this.player&&this.player.reloadInError&&this.player.reloadInError()}resetMediasource(){this.player&&this.player.resetMediasource&&this.player.resetMediasource()}recvDataFull(){this.player&&this.player.recvDataFull&&this.player.recvDataFull()}onAudioAnalyserInit(t){this.voiceChecker.setAnalyser(t)}onMultiStart(t,e,i,s,r){this.mutilVideo.playStart(t||r,e,i)}onPlayVideo(t,e,i,s,r,a,o){this.voiceChecker.start(),this.updateStatus(p.VIDEO_PLAYING),this.mutilVideo.playStart(t||r,e,i);let n=void 0,h=void 0;this.mutilVideo&&this.mutilVideo.getReady()&&(n=this.mutilVideo.getCanvas1(),h=this.mutilVideo.getCanvas2()),this.player&&this.player.onPlayVideo&&this.player.onPlayVideo(t,e,i,s,r,a,o,n,h)}isMutilVideo(){return this.useMultiVideo&&this.mutilVideo.getIsMultiVideo()}getVideoScale(){return this.mutilVideo.getVideoScale()}onSendSeiData(t,e,i){this.player&&this.player.onSendSeiData&&this.player.onSendSeiData(t,e,i)}onSendScriptVolumeInfo(t,e){this.player&&this.player.onSendScriptVolumeInfo&&this.player.onSendScriptVolumeInfo(t,e)}onSBUpdateEnd(){this.player&&this.player.onSBUpdateEnd&&this.player.onSBUpdateEnd()}onPauseByBrowser(){this.player&&this.player.onPauseByBrowser&&this.player.onPauseByBrowser()}updateStatus(t){this.player&&this.player.updateStatus&&this.player.updateStatus(t),this.videoStatus=t}onPause5Sec(){this.player&&this.player.onPause5Sec&&this.player.onPause5Sec()}setEmptyFrames(t){this.player&&this.player.hasEmptyFrames&&(this.player.hasEmptyFrames=t)}onPlayPause(t,e){this.player&&this.player.onPlayPause&&this.player.onPlayPause(t,e)}onPlayPauseWorker(t,e){this.player&&this.player.onPlayPauseWorker&&this.player.onPlayPauseWorker(t,e)}getWaitBufferLen(){return this.player?this.player.getWaitBufferLen():0}getWaitFrameTime(t){return this.player?this.player.getWaitFrameTime(t):0}getRecvInfo(){return this.player&&this.player.getRecvInfo&&this.player.getRecvInfo()}setAudioUtil(t){return this.player&&this.player.setAudioUtil&&this.player.setAudioUtil(t)}turnToMse(){this.stop(),this.eventEmitter.trigger(u.TURN_TO_MSE)}webcodecsRetry(){this.stop(),this.eventEmitter.trigger(u.WEBCODECS_RETRY)}turnToWebcodecsSoft(){R.b.isWebCodecsSupported()&&(n.a.log("P2PFlvPlayer.turnToWebcodecsSoft"),this.stop(),this.eventEmitter.trigger(u.TURN_TO_WEBCODECS_SOFT))}_beforeSwitch(t){this.switchDoneBefore.stop();let e=this.info;e._delayRemove=!1,e.iBitRate=t.iBitRate,e.curBitrate=t.bitrate,e.originalBitrate=0===t.iBitRate,e.iCodecType=t.iCodecType,e.iHEVCBitRate=t.iHEVCBitRate;let i=this.h265Proxy.renderInited;this.h265Proxy.initSupport(e);let s=this.h265Proxy.isSupported;!i&&s?(this.ctrlBitrate.switchType=Ro.SwitchType.H264ToH265,this.h265Proxy.loadDecoder(e.h5Root,{ready:this._onH265DecoderReady.bind(this),error:this._switch265FailBind,timeout:this._switch265FailBind})):(i||s?i&&s?this.ctrlBitrate.switchType=Ro.SwitchType.H265ToH265:i&&!s&&(this.ctrlBitrate.switchType=Ro.SwitchType.H265ToH264,e._delayRemove=!0):this.ctrlBitrate.switchType=Ro.SwitchType.H264ToH264,this.switchLevel(e))}_onH265DecoderReady(){n.a.log("IPlayer._onH265DecoderReady"),this.info._delayRemove=!0,this.switchLevel(this.info)}_switch265Fail(){this.ctrlBitrate.switchType=Ro.SwitchType.H264ToH264,this.switchLevel(this.info)}setAutoInfo(t){this.ctrlBitrate.setAutoInfo(t)}switchLevel(t){o.a.initByBitrate(t.curBitrate),this.player.started&&(this.info=t,this.statSwitch.check(t,!0),this.ctrlBitrate.switchBitrate(t.curBitrate),this._triggerAutoChanged())}getIsCloseP2P(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o.a.closeP2PPids.length>0){let t=!1;if(o.a.closeP2PPids.forEach(e=>{Number(e)===Number(this.info.presenterUid)&&(t=!0)}),t)return!0}if(0===o.a.closeP2PConfig[0])return!1;let e=t.iBitRate||this.info.iBitRate,i=!1;return this.closeP2pCoderates.map(t=>{Number(t)===Number(e)&&(i=!0)}),i}getIsEnableAuto(t){if(0==o.a.closeP2PConfig[0]||0==o.a.closeP2PConfig[1])return!0;if(this.info.iIsP2PSupport&&1==o.a.closeP2PConfig[1]){let t=this.info.bitrateList,e=0;if(t.map(t=>{-1!=this.closeP2pCoderates.indexOf(String(t.iBitRate))&&e++}),0!=t.length){if(0===e)return!0;if(0!=e&&e!=t.length)return!1;if(0!=e&&e==t.length)return!0}}return!0}getDurationTime(){return this.player?this.player.getDurationTime&&this.player.getDurationTime():0}setUseSoftAcceleration(t){this.player&&this.player.setUseSoftAcceleration&&this.player.setUseSoftAcceleration(t)}onActWebCodecs(t,e){this.player&&this.player.onActWebCodecs&&this.player.onActWebCodecs(t,e)}_switchStart(t,e){let i=this.info.iBitRate,s=this.info.iIsP2PSupport,r=this.getIsCloseP2P(),a=this.getBufferLen();n.a.log("IPlayer(".concat(this._id,")._switchStart bufferLen=").concat(a," dts=").concat(t," pts=").concat(e," isCloseP2P=").concat(r," iIsP2PSupport=").concat(s," iBitRate=").concat(i)),s?r&&this._type==w.P2P?(this.info.type=w.FLV,this._type=w.FLV,this.flvPlayer.info=this.info,this.p2pPlayer.stopPlayer(),this.flvPlayer.startPlayer(this.info),this._switchStartFlv(t,e),this.player=this.flvPlayer):r&&this._type==w.FLV?this._switchStartFlv():r||this._type!=w.P2P?r||this._type!=w.FLV||(this.info.type=w.P2P,this.flvPlayer.stopPlayer(),this.flvPlayer.loader.close(),this._type=w.P2P,this.p2pPlayer.startPlayer(this.info),this._hyPlayer.lastP2PInfo=this.info,this._switchStartP2P(t,e),this.player=this.p2pPlayer):this._switchStartP2P(t,e):this._switchStartFlv(t,e),this.ctrlBitrate._badStat.setStart(a),this.ctrlBitrate._seg.nextIFrame(),X.once(this._switchFirstVideoTimeout,this,1e3),this.isSwitchPause=!1}_switchStartP2P(t,e){this.p2pPlayer.loaderMgr.stopFullStream(),this.p2pPlayer._switchStart(t,e),this.p2pFlvPlayerSetType(w.P2P)}_switchStartFlv(t,e){this.flvPlayer.loader.close(),this.flvPlayer._switchStart(t,e),this.p2pFlvPlayerSetType(w.FLV)}p2pFlvPlayerSetType(t){this.handlerType==M&&this._hyPlayer.p2pFlvPlayerSetType(t)}onConnected(){n.a.log("IPlayer(".concat(this._id,").onConnected")),this.ctrlBitrate._badStat.setConnected(),this.ctrlBitrate._seg.connected()}_switchFirstSample(){n.a.log("IPlayer(".concat(this._id,")._switchFirstSample")),this.ctrlBitrate._badStat.setFirstFrame(),this.ctrlBitrate._seg.firstVideo(),X.remove(this._switchFirstVideoTimeout,this),X.once(this._switchPtsIFrameTimeout,this,1e3)}_switchFirstVideoTimeout(){n.a.log("IPlayer(".concat(this._id,")._switchFirstVideoTimeout")),this.ctrlBitrate._badStat.setFirstVideoTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(Bs.firstVideo)}_switchPtsIFrameTimeout(){n.a.log("IPlayer(".concat(this._id,")._switchPtsIFrameTimeout")),this.ctrlBitrate._badStat.setPtsFrameTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(Bs.ptsIFrame)}_switchDone(t,e,i){this.ctrlBitrate._badStat.setPtsFrame(i),this.ctrlBitrate._seg.ptsIFrame(),X.remove(this._switchPtsIFrameTimeout,this),this.ctrlBitrate.startEval(e),this.ctrlBitrate.switchType===Ro.SwitchType.H264ToH265||this.ctrlBitrate.switchType===Ro.SwitchType.H265ToH264?(this.ctrlBitrate.pause(),this.switchDoneBefore.start(this.mse,t,{done:this._onSwitchDoneBefore.bind(this)})):this._switchDoneReal(0),n.a.log("P2PFlvPlayer._switchDone _type=".concat(this._type)),this._type===w.P2P&&this.p2pPlayer._switchDone(t,e,i)}_onSwitchDoneBefore(){let t=this.mse;n.a.log("IPlayer(".concat(this._id,")._onSwitchDoneBefore mse=").concat(!!t," switchType=").concat(this.ctrlBitrate.switchType)),t&&(t.resetVideo(),t.playing=!1,t.parser.remuxer.reset(),this.ctrlBitrate.switchType===Ro.SwitchType.H265ToH264?this.h265Proxy.stop():this.ctrlBitrate.switchType===Ro.SwitchType.H264ToH265&&this.h265Proxy.initRender(t)),this._switchDoneReal(3e3)}_switchDoneReal(t){n.a.log("IPlayer(".concat(this._id,")._switchDoneReal")),this.ctrlBitrate.switchDone(t)}_triggerAutoChanged(){this.eventEmitter.trigger(u.AUTO_BITRATE_CHANGED,{lastBitrate:this.ctrlBitrate.lastBitrate,curBitrate:this.ctrlBitrate.curBitrate})}getAutoProps(){return this.player&&this.player.getAutoProps&&this.player.getAutoProps()}setWebCodecsSuccess(){this.isWebcodecsPlaying=!0}startShildAudioPlayer(t){this.player.startShildAudioPlayer(t)}stopShieldAudioPlayer(){this.player.stopShieldAudioPlayer()}onSwitchShieldAudioFail(t,e){this.player.onSwitchShieldAudioFail(t,e)}onSwitchShieldAudioSuc(t){this.player.onSwitchShieldAudioSuc(t)}check500Pause(){this.player.check500Pause&&this.player.check500Pause()}getMuffleCacheData(){let t=[];return this._hyPlayer&&this._hyPlayer.muffleAudio&&(t=this._hyPlayer.muffleAudio.getCacheData()),t}setStreamFormat(t){const e={Avcc:1,Hvcc:1,AnnexB:2};t&&e[t]&&this.stat&&this.stat.setComDim(d.a.DIM_COM.STREAM_FORMAT,e[t])}resetPlayer(){this.eventEmitter&&this.eventEmitter.trigger(u.RESET_PLAYER)}setEnhance(t){this.mse&&this.mse.setEnhance&&this.mse.setEnhance(t)}setSegmenttion(t){this.mse&&this.mse.setSegmenttion&&this.mse.setSegmenttion(t)}setFramePause(){this.player&&this.player.setFramePause&&this.player.setFramePause()}setFrameRusume(){this.player&&this.player.setFrameRusume&&this.player.setFrameRusume()}renderFpsPause(t){this.player&&this.player.renderFpsPause&&this.player.renderFpsPause(t)}onVideoEnhanceError(t){this.eventEmitter&&this.eventEmitter.trigger(u.ON_VIDEO_ENHANCE_ERROR,t)}onVideoEnhanceSuccess(){this.eventEmitter&&this.eventEmitter.trigger(u.ON_VIDEO_ENHANCE_SUCCESS)}setIFrameAvcChageStat(){this.stat.setComDim(d.a.DIM_COM.I_AVC_CHANGE,1)}getFetchCodecType(){return this.player&&this.player.getFetchCodecType?this.player.getFetchCodecType():"264"}sendNoPicture(){this.player&&this.player.sendNoPicture&&this.player.sendNoPicture()}setWasmPlaying(){this.isWasmH265Playing=!0}decoderDecodeError(){(this._type==w.FLV&&this.flvPlayer.isUsingPcdn||this._type==w.P2P&&this.p2pPlayer.isUsingPcdn)&&(n.a.log("P2PFlvPlayer.decoderDecodeError, _type=".concat(this._type)),this._hyPlayer&&this._hyPlayer.decoderDecodeError&&this._hyPlayer.decoderDecodeError())}updateMultiRenderInfo(t){this.useMultiVideo&&this.mutilVideo.updateRenderInfo(t)}get wasmH265Playing(){return this.isWasmH265Playing}get webcodecsPlaying(){return this.isWebcodecsPlaying}get isP2P(){return this._type==w.P2P}get type(){return this._type}get isFlv(){return this._type==w.FLV}get isPlaying(){return this.videoStatus!==p.VIDEO_STOP&&this.videoStatus!==p.VIDEO_INIT&&this.videoStatus!==p.VIDEO_LOADING}get hasPicture(){if(!this.player)return!1;let t=this.isPlaying;return this.playerCoreType===N.a.PLAYER_CORE_TYPE.MSE?t=t&&0!==this.mse.getCurrentTime():this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&(t=t&&this.isWebcodecsPlaying),this.player&&this.player.h265Proxy&&this.player.h265Proxy.rendering&&(t=t&&this.player.h265Proxy.rendering),t}get voiceEliminationData(){return this.player.voiceEliminationData}set voiceEliminationData(t){this.player.voiceEliminationData=t}get connected(){return!!this.player&&this.player.connected}get playerType(){return this._type}get isTieStream(){return this.player&&this.player.is_tie_stream}},an=s(24),on=s.n(an),nn={PCDN_REALTIME:1,PCDN_FREETIME:2,PCDN_NOT_OPEN:3,PCDN_CLIENT_NOT_OPEN:4,FIRST_TS:5,NOT_SEND_REQ:6,OPEN_BUFFER_NOT_REACHED:7,BUFFER_LACK_TO_CDN:8,REALTIME_NOT_REACHED:9,REALTIME_OVER_RUN:10,FREETIME_OVER_RUN:11,FREETIME_NOT_COVERD:12,ERROR_REQ:13,PCDN_REQ_OTHER:14,TAF_REQ_ERROR:15,TS_LOAD_ERROR:16},hn=class{constructor(t){this.url="",this.time=0,this.duration=0,this.start=0,this.level=0,this.sn=0,this.discontinuity=!1,this.discontinuityCnt=0,this.byteRangeStartOffset=0,this.byteRangeEndOffset=0,this.decryptdata=null,this.pcdnFreetime=!1,this.isPcdn=!1,this.tryCnt=0,this.pcdnUrls=[],this.isLoadError=!1,this.statPcdn=!1,this.isFirstLoad=!1,this.pcdnStatus=nn.NOT_SEND_REQ,this.pcdnStatusBk1=nn.NOT_SEND_REQ,this.pcdnStatusBk2=nn.NOT_SEND_REQ,this.loadStartTs=0,this.loadEndTs=0}setUrl(t){this.url=t+""}getUrl(t){const{useCdn:e,bufferLen:i}=t;return this.pcdnUrls.length>0&&i>=o.a.vodPcdnOpenBuffer&&!e?(this.isPcdn=!0,this.pcdnUrls.shift()):(this.isPcdn=!1,this.url)}hasPcdn(){return this.pcdnUrls.length>0}loadError(){this.isLoadError=!0}},dn={TS:1,M4S:2,getType:function(t){return-1!==t.indexOf(".m4s")?this.M4S:this.TS}};class ln extends tt.PcdnVodProxy{constructor(t,e){super(t,e,d.a,nn,X)}getVodPcdnProxy(t,e){let i=v.a.uid||v.a.getAnonymouUid();this._getVodPcdnProxy(t,e,{uid:i,appid:v.a.appid,sGuid:v.a.sGuid,TafLink:r})}}var cn=ln,un=class{static isSupported(){if(1==f.a._noFetch)return!1;try{let t=h.a.msedge&&h.a.version.minor>=15048,e=!h.a.msedge||t;return fetch&&ReadableStream&&e}catch(t){return!1}}constructor(t){this._config=t,this._receivedLength=0,this._status=0,this.fromByte=0,this.toByte=0}destroy(){this.fromByte=0,this.toByte=0,this.onChunk=null,this.onSuccess=null,this.onError=null,this.onTimeout=null,this._status=0,this._clearTimeout(),this.abort()}loadBuffer(t,e,i,s,r,a,o,n,h){this.url=t,this.onOpen=e,this.onChunk=i,this.onSuccess=s,this.onError=r,this.onTimeout=a,this.stats={trequest:performance.now(),retry:0},this.timeout=o,this.maxRetry=n,this.retryDelay=h,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),o),this.loadInternal()}loadInternal(){this._requestAbort=!1;let t=new self.Headers;this.fromByte>0&&t.append("Range","bytes=".concat(this.fromByte,"-").concat(this.toByte>0?this.toByte:""));let e={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};fetch(this.url,e).then(t=>{if(!this._requestAbort)return t.ok&&t.status>=200&&t.status<=299?(this._status=t.status,this._onopen({code:this._status}),this._pump.call(this,t.body.getReader())):(this._status=t.status,void this._onerror({code:t.status,msg:t.statusText}));this._requestAbort=!1})}abort(){this._requestAbort=!0}_clearTimeout(){let t=this.timeoutHandle;t&&(clearTimeout(t),this.timeoutHandle=null)}_pump(t){return t.read().then(e=>{if(this._clearTimeout(),e.done)this._onsuccess();else{if(!0===this._requestAbort)return this._requestAbort=!1,t.cancel();let i=e.value.buffer;this.onChunk&&this.onChunk(i),this._pump(t)}})}_onopen(t){this.onOpen&&this.onOpen(t)}_onerror(t){0!==t.code&&404!==t.code?this.stats.retry<this.maxRetry?(n.a.warn("FetchLoader.loaderror url=".concat(this.url," retryDelay=").concat(this.retryDelay," error: "),t),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.abort()):(this._clearTimeout(),n.a.warn("FetchLoader.loaderror reach max retry url=".concat(this.url," error: "),t),this.onError&&this.onError(t)):this.onError&&this.onError(t)}_onsuccess(t){this._clearTimeout(),this.onSuccess&&this.onSuccess(t)}loadtimeout(){this._status=-2,this.stats.retry<this.maxRetry?(n.a.warn("FetchLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.abort(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(this._clearTimeout(),n.a.warn("FetchLoader.loadtimeout max retry url="+this.url),this.onTimeout&&this.onTimeout())}},pn=class{constructor(){this.hlsPlayer=null,this.cachedVodBlock={},this.vodBlockReasons=[]}destroy(){this.hlsPlayer=null,this.cachedVodBlock=null,this.vodBlockReasons=null}setHlsPlayer(t){this.hlsPlayer=t}cacheBlockReason(t,e){!t||e<=0||(n.a.log("VodBlockHelper.checkInBufBlock: reason=",t,e),this.cachedVodBlock[t.CODE]=e)}checkInBufBlock(){if(!this.hlsPlayer)return;let t=Nr;const e=this.hlsPlayer.getCurrentTime();for(let i in this.cachedVodBlock){const s=this.cachedVodBlock[i];if(Math.abs(s-e)<1){if(i===Yr.CODE){t=Yr,delete this.cachedVodBlock[i];break}if(t===Gr.CODE){t=Gr,delete this.cachedVodBlock[i];break}if(t===Hr.CODE){t=Hr,delete this.cachedVodBlock[i];break}}}t===Nr&&this.hlsPlayer.getBufferLen()>1e3&&(t=Wr),n.a.log("VodBlockHelper.checkInBufBlock: reason code =",t.CODE),this.vodBlockReasons.push(t)}checkNoBufBlock(){if(!this.hlsPlayer)return;let t=Nr;const e=this.hlsPlayer.playlist.currFrag;if(!e)return;const i=Br,s=kr;t=e.isPcdn?i:s;const r=this.vodBlockReasons.find(t=>t.code===i.CODE),a=this.vodBlockReasons.find(t=>t.code===s.CODE);r&&a&&(t=Ur);const o=Br,h=kr;e.isLoadError&&(t=e.isPcdn?o:h);const d=this.vodBlockReasons.find(t=>t.code===i.CODE),l=this.vodBlockReasons.find(t=>t.code===s.CODE);d&&l&&(t=xr),n.a.log("VodBlockHelper.checkNoBufBlock: reason code =",t.CODE),this.vodBlockReasons.push(t)}checkVodBlock(){this.hlsPlayer&&(this.checkInBufBlock(),this.hlsPlayer.getBufferLen()<1e3&&this.checkNoBufBlock())}getBlockReason(){return this.vodBlockReasons.length<=0?0:(this.vodBlockReasons=this.vodBlockReasons.sort((t,e)=>t.PRIORITY-e.PRIORITY),this.vodBlockReasons[0].CODE)}resetBlockReason(){this.vodBlockReasons=[]}},mn=class extends it{constructor(t){super(t),this.tsdbUtil=this.handlerPlayer.tsdb,this.isPaused=!1,this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[]}destroy(){super.destroy(),this.tsdbUtil=null,this.tsOpens=null,this.tsLoadeds=null,this.tsSpeeds=null,this.tsSizes=null,X.remove(this.checkSuc,this),X.remove(this.checkVideo,this)}get statQps(){return this._statQps||(this._statQps=new Z({presenterUid:this.handlerPlayer.info.presenterUid,lineType:this.handlerPlayer.info.lineType})),this._statQps}setPause(){this.isPaused=!0,this.stat.setCore(d.a.DIM_CORE.VIDEO_BAD_QUALITY,100)}start(){this.stop(),X.once(this.checkSuc,this,1e4),X.once(this.checkVideo,this,2e4)}stop(){this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[],X.remove(this.checkSuc,this),X.remove(this.checkVideo,this)}checkSuc(){let{_loaderType:t,hasVideo:e,url:i,playTs:s}=this.handlerPlayer,r=e?100:0,a=[];a.push(this.stat.createAct(d.a.ACT.HLS_PLAY_SUCC,{value:[r,t],str:[i,"".concat(s)]})),this.tsdbUtil.sendMetrics(a)}checkVideo(){let t=this.handlerPlayer.hasVideo?100:0,e=[];e.push(this.stat.createAct(d.a.ACT.HLS_LOAD_SUCC,{value:[t]})),this.tsdbUtil.sendMetrics(e)}report(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];if(0===o.a.statLv[15]&&e.push({sMetricName:A.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0},vDimension:{p2p:2}}),this.handlerPlayer.mse.metadata.recvAudioFps&&this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_RATE,this.handlerPlayer.mse.metadata.recvAudioFps),this.handlerPlayer.mse.metadata.recvVideoFps&&this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_RATE,this.handlerPlayer.mse.metadata.recvVideoFps),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.SPEED,this.handlerPlayer.getSpeed()),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_DTS,this.handlerPlayer.mse.curVideoDts),this.stat.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_DTS,this.handlerPlayer.mse.curAudioDts),this.stat.setCompFormat(d.a.DIM_LINK_SAM.name,":",","),this.stat.setCore(d.a.CORE.PLAY_DELAY,this.handlerPlayer.getBufferLen()),this.stat.setCore(d.a.CORE.FRAME_BUFFER_DELAY,this.handlerPlayer.getFrameBufferLen()),this.handlerPlayer.h265Proxy.rendering&&(this.h265PauseProps=this.handlerPlayer.h265Proxy.getStats(t)),this.recordBaseStat(),this.reportVideoBadQuality(this.isPaused,t),this.isPaused){let t=this.handlerPlayer.blockHelper;if(t){const e=t.getBlockReason();this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_REASON,e)}}this.stat.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_OPEN_AVG,this.getAvg(this.tsOpens)),this.stat.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_LOADED_AVG,this.getAvg(this.tsLoadeds)),this.stat.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_SPEED_AVG,this.getAvg(this.tsSpeeds)),this.stat.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_SIZE_AVG,this.getAvg(this.tsSizes)),this.stat.fill(e,t),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.reportVod(e,t),this.statQps.sendQps(this.tsdbUtil,e,t),this.isPaused=!1,this.handlerPlayer&&(this.handlerPlayer.blockHelper&&this.handlerPlayer.blockHelper.resetBlockReason(),this.handlerPlayer.resetHeartTsTime()),this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[]}reportVideoBadQuality(t,e){this.handlerPlayer.h265Proxy&&this.handlerPlayer.h265Proxy.rendering?this.reportH265(t,e):this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,t?100:0)}reportH265(t,e){const{videoPauseCnt:i,isVideoPaused:s,hiddenTime:r,statProps:a}=this.h265PauseProps;let o=t?100:0,n=s||i>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&r>=2e4?(this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,n),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,o)):(this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,o),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,n));for(let t in a)"toDecode"==t?this.recordH265Frame(a[t],d.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==t?this.recordH265Frame(a[t],d.a.DIM_COM.V_DECODE_FRAME):"render"==t?this.recordH265Frame(a[t],d.a.DIM_COM.V_PLAY_FRAME):"rawList"==t?this.recordH265Frame(a[t],d.a.DIM_COM.V_RECV_FRAME):"frameList"==t||this.stat.setComp(d.a.DIM_H265_SAM.name,t,a[t].join("|"))}recordH265Frame(t,e){this.stat.setComp(e,"size",t.length),t.map((t,i)=>{this.stat.setComp(e,"k"+(i+1),t),this.stat.setCompFormat(e,":",",")}),this.handlerPlayer&&!this.handlerPlayer.isLive&&(this.statVod.setComp(e,"size",t.length),t.map((t,i)=>{this.statVod.setComp(e,"k"+(i+1),t),this.statVod.setCompFormat(e,":",",")}))}reportVod(t,e){if(this.handlerPlayer.mse.metadata.recvAudioFps&&this.statVod.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_RATE,this.handlerPlayer.mse.metadata.recvAudioFps),this.handlerPlayer.mse.metadata.recvVideoFps&&this.statVod.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_RATE,this.handlerPlayer.mse.metadata.recvVideoFps),this.statVod.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.SPEED,this.handlerPlayer.getSpeed()),this.statVod.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.VIDEO_DTS,this.handlerPlayer.mse.curVideoDts),this.statVod.setComp(d.a.DIM_LINK_SAM.name,d.a.DIM_LINK_SAM.AUDIO_DTS,this.handlerPlayer.mse.curAudioDts),this.statVod.setCompFormat(d.a.DIM_LINK_SAM.name,":",","),this.statVod.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_OPEN_AVG,this.getAvg(this.tsOpens)),this.statVod.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_LOADED_AVG,this.getAvg(this.tsLoadeds)),this.statVod.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_SPEED_AVG,this.getAvg(this.tsSpeeds)),this.statVod.setComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_SIZE_AVG,this.getAvg(this.tsSizes)),this.statVod.setCoreDim(d.a.VOD_DIM_CORE.TS_START_TIME,this.handlerPlayer.heartTsStartTime),this.statVod.setCoreDim(d.a.VOD_DIM_CORE.TS_END_TIME,this.handlerPlayer.heartTsEndTime),this.handlerPlayer.h265Proxy.rendering){const{videoPauseCnt:t,isVideoPaused:e,hiddenTime:i}=this.h265PauseProps;let s=this.isPaused?100:0,r=e||t>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&i>=2e4?(this.statVod.setCoreDim(d.a.VOD_CORE.VIDEO_H265_BAD_QUALITY,r),this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,s)):(this.statVod.setCoreDim(d.a.VOD_CORE.VIDEO_H265_BAD_QUALITY,s),this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,r))}else this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,this.isPaused?100:0);if(this.isPaused){let t=this.handlerPlayer.blockHelper;if(t){const e=t.getBlockReason();this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_REASON,e)}}this.statVod.fill(t,e)}getAvg(t){let e=t.length;if(0===e)return 0;let i=0;for(let s=0;s<e;s++)i+=t[s];return Math.floor(i/e)}},_n=class{constructor(t){this._hlsPlayer=t,this._seekTime=0}destroy(){this._hlsPlayer=null}seek(t){this._seekTime=t}check(){this._seekTime>0&&(this._seek()?this._seekTime=0:this._reseek())}_seek(){let t=this._seekTime,e=!1;if(this._hlsPlayer&&this._hlsPlayer.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE){let i=this._hlsPlayer.mse.video.video.buffered,s=[];for(let r=0;r<i.length;r++){let a=i.start(r),o=i.end(r);if(s.push("[".concat(a,", ").concat(o,"]")),a-.5<=t&&t<o+1){e=!0;break}if(t<a){this._seekTime=a;break}}e&&(this._hlsPlayer.onVideoSeek(t),!this._hlsPlayer.userPaused&&this._hlsPlayer.play()),n.a.log("HlsSeek.buffered",s.join(" "))}return e}_reseek(){if(this._hlsPlayer&&this._hlsPlayer.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE){n.a.log("HlsSeek._reseek");let t=this._hlsPlayer.playlist.currDetails;t&&t.fragments&&(t.fragIdx>1&&t.fragIdx--,this._hlsPlayer.mse.seek(this._seekTime),this._hlsPlayer.mse.resetHls(),this._hlsPlayer.seekTime=this._seekTime,n.a.log("HlsSeek._reseek",t.fragIdx))}}_findIdxFront(t,e,i){let s=e.length,r=null;for(let a=i;a<s;a++)if(r=e[a],(t+=r.duration)>=this._seekTime)return r.seeking=!0,a;return s-1}_findIdxBack(t,e,i){let s=null;for(let r=i;r>0;r--)if(s=e[r],(t-=s.duration)<this._seekTime)return s.seeking=!0,r;return 0}},fn={isClose:function(t,e){return this.isCloseSwiftshader(t,e)||this.isCloseCore(t)},isCloseSwiftshader:function(t,e){if(!e||""===e||-1!==e.indexOf("swiftshader")&&o.a.vodAv1CloseCfg[0]){let e=o.a.vodAv1CloseCfg[0],i=e.length;for(let s=0;s<i;s++){let i=e[s],r=i[0],a=i[1];if(t>=r)return navigator.hardwareConcurrency<=a}}return!1},isCloseCore:function(t){if(o.a.vodAv1CloseCfg[1]){let e=o.a.vodAv1CloseCfg[1];return t>=e[0]&&navigator.hardwareConcurrency<=e[1]}return!1}},gn=class{constructor(){this.startTs=0,this.m3u8StartTs=0,this.m3u8OpenTs=0,this.m3u8EndTs=0,this.initStartTs=0,this.initOpenTs=0,this.initEndTs=0,this.firstStartTs=0,this.firstOpenTs=0,this.firstBufTs=0,this.playTs=0}setStart(){this.startTs=_.a.now(),this.m3u8StartTs=0,this.m3u8OpenTs=0,this.m3u8EndTs=0,this.initStartTs=0,this.initOpenTs=0,this.initEndTs=0,this.firstStartTs=0,this.firstOpenTs=0,this.firstBufTs=0,this.loadedDataTs=0}setM3u8Start(){0===this.m3u8StartTs&&(this.m3u8StartTs=_.a.now(),n.a.log("VodSecHelper setM3u8Start: ".concat(this.m3u8StartTs)))}setM3u8Open(){0===this.m3u8OpenTs&&(this.m3u8OpenTs=_.a.now(),n.a.log("VodSecHelper setM3u8Open: ".concat(this.m3u8OpenTs,", start to open cost: ").concat(this.m3u8OpenTs-this.m3u8StartTs,"ms")))}setM3u8End(){0===this.m3u8EndTs&&(this.m3u8EndTs=_.a.now(),n.a.log("VodSecHelper setM3u8End: ".concat(this.m3u8EndTs,", open to end cost: ").concat(this.m3u8EndTs-this.m3u8OpenTs,"ms")))}setInitStart(){0===this.initStartTs&&(this.initStartTs=_.a.now(),n.a.log("VodSecHelper setInitStart: ".concat(this.initStartTs,", m3u8 end to init start cost: ").concat(this.initStartTs-this.m3u8EndTs,"ms")))}setInitOpen(){0===this.initOpenTs&&(this.initOpenTs=_.a.now(),n.a.log("VodSecHelper setInitOpen: ".concat(this.initOpenTs,", init start to open cost: ").concat(this.initOpenTs-this.initStartTs,"ms")))}setInitEnd(){0===this.initEndTs&&(this.initEndTs=_.a.now(),n.a.log("VodSecHelper setInitEnd: ".concat(this.initEndTs,", init open to end cost: ").concat(this.initEndTs-this.initOpenTs,"ms")))}setFirstStart(){0===this.firstStartTs&&(this.firstStartTs=_.a.now(),0===this.m3u8StartTs&&(this.m3u8StartTs=this.m3u8OpenTs=this.m3u8EndTs=this.firstStartTs),0===this.initStartTs&&(this.initStartTs=this.initOpenTs=this.initEndTs=this.firstStartTs),n.a.log("VodSecHelper setFirstStart: ".concat(this.firstStartTs,", m3u8 end to first start cost: ").concat(this.firstStartTs-this.m3u8EndTs,"ms")))}setFirstOpen(){0===this.firstOpenTs&&(this.firstOpenTs=_.a.now(),n.a.log("VodSecHelper setFirstOpen: ".concat(this.firstOpenTs,", first start to open cost: ").concat(this.firstOpenTs-this.firstStartTs,"ms")))}setFirstBuf(){0===this.firstBufTs&&(this.firstBufTs=_.a.now(),n.a.log("VodSecHelper setFirstBuf: ".concat(this.firstBufTs,", first open to buf cost: ").concat(this.firstBufTs-this.firstOpenTs,"ms")))}setPlayTs(){0===this.playTs&&(this.playTs=_.a.now(),n.a.log("VodSecHelper setPlayTs: ".concat(this.playTs,", first buf to play cost: ").concat(this.playTs-Math.max(this.firstBufTs,this.initEndTs),"ms")))}getCostTimes(){let t=99999,e=99999,i=99999,s=99999,r=99999,a=99999,o=99999,n=99999,h=99999,d=99999;return this.playTs>0&&(t=this.playTs-this.startTs),this.m3u8OpenTs>0&&(e=this.m3u8OpenTs-this.startTs),this.m3u8EndTs>0&&this.m3u8OpenTs>0&&(i=this.m3u8EndTs-this.m3u8OpenTs),this.initStartTs>0&&this.m3u8EndTs>0&&(s=this.initStartTs-this.m3u8EndTs),this.initOpenTs>0&&this.initStartTs>0&&(r=this.initOpenTs-this.initStartTs),this.initEndTs>0&&this.initOpenTs>0&&(a=this.initEndTs-this.initOpenTs),this.firstStartTs>0&&this.m3u8EndTs>0&&(o=this.firstStartTs-this.m3u8EndTs),this.firstOpenTs>0&&this.firstStartTs>0&&(n=this.firstOpenTs-this.firstStartTs),this.firstBufTs>0&&this.firstOpenTs>0&&(h=this.firstBufTs-this.firstOpenTs),this.playTs>0&&this.firstBufTs>0&&this.initEndTs>0&&(d=this.playTs-Math.max(this.firstBufTs,this.initEndTs)),[t,e,i,s,r,a,o,n,h,d]}};var Sn=class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,h265Proxy:n}=e;this.playerCoreType=e.playerCoreType,this.isSoftSolution=e.isSoftSolution,this.isPureAudio=!!e.isPureAudio,this.isPureVideo=!!e.isPureVideo,this.dropBeforeFirstIDR=!!e.dropBeforeFirstIDR,this.config={autoStartLoad:!0,maxBufferLength:30,minBufferLength:15,secondBufferLength:20,fragLoadingTimeOut:5e3,fragLoadingMaxRetry:a?3:1,fragLoadingRetryDelay:1e3,listLoadingTimeOut:a?15e3:8e3,listLoadingMaxRetry:a?0:3,listLoadingRetryDelay:1e3,appendErrorMaxRetry:200,minFragBufferNum:3,autoReconnect:!0,firstFragLoadTimeout:15e3},this.eventEmitter=t,this._hyPlayer=t,this.stat=i,this.statVod=s,this.tsdb=r,this.h265Proxy=n,this.statSwitch=e.statSwitch,this.isLive=!1,this.liveType=0,this.url=null,this.cdnName=null,this.seekTime=0,this.playlist=null,this.mse=null,this.m4sInitcb=this.onM4sInit.bind(this),this.m4sInitOpenCb=this.onM4sInitOpen.bind(this),this.onFirstBufCb=this.onFirstBuf.bind(this),this.userPaused=!1,this.targetDuration=0,this.isLoading=!1,this.fragStartTs=0,this.fragOpenTs=0,this.fragSize=0,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.started=!1,this.isTryAgain=!1,this.fragLoader=null,this.tryTimer=null,this.hasVideo=!1,this.playStat=new mn(this),this.hlsSeek=new _n(this),this.firstPlay=!0,this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.videoStatus=p.VIDEO_INIT,this.flvLoadTimeSended=!1,this.sOrigUrl="",this.curAppendFrag=null,this.seeking=!1,this.skipStatForSeek=!1,this.playTriggered=!1;let{clz:d,type:l}=(()=>{let t=o.a.hlsUseFetch>Math.floor(100*Math.random())&&un.isSupported(),{FETCH:e,XHR:i}=N.a.HLS_LOAD_TYPE;return"safari"===h.a.name&&(t=!1),{clz:t?un:Sa,type:t?e:i}})();this._loaderClz=d,this._loaderType=l,this.videoElement=a,this.loadHlsStatus=N.a.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.needReset=!1,this.resetPlayTs=0,this.lastPlayTs=0,this.pauseInBufferFullTimes=0,this.sendPauseTimeout=0,this.businessStartCost=0,this.startTimeStamp=0,this.loadStartTs=0,this.anticode=new Gi,this.isSwitchSeamLessLine=!1,this.pausedByBrowser=!1,this._nextRefreshTime=Number.MAX_SAFE_INTEGER,this._pcdnFragStartTs=0,this._cdnFragStartTs=0,this.firstTsInfo=null,this._getPcdnDataTime=0,this._getCdnDataTime=0,this.forceUseCdn=!1,this.coolLoadFragment=!1,this.vodAbSwitch=!1,this.pcdnRepeatByteLen=0,this.lastSN=-1,this.errorPcdnSN=-1,this.needStatPcdnRepeatBW=!1,this.tsFileSize=0,this.heartTsStartTime=0,this.heartTsEndTime=0,this.videoLoadTimeSent=!1,this.videoLoadTime=0,this.loadM3u8Time=0,this.firstFragLoadTime=0,this.firstFragLoadedTime=0,this.firstFragParsedTime=0,this.uiLoadTime=0,this.businessLoadTime=0,this.firstTsHttpCode=0,this.avgSpeed=new O(20),this.exceptionStat=new eo(this),this.realStartBind=this.realStart.bind(this),this._clickEventBind=this._clickEvent.bind(this),this.refreshAnticodeBind=this.refreshAnticode.bind(this),this._sendVideoLoadTimeBind=this._sendVideoLoadTime.bind(this),this._sendVideoLoadTimer=null,this.anticode.on(Gi.Events.REFRESH,this.refreshAnticodeBind),this.playerType=w.HLS,this.seekBeforeTime=0,this.endTs=0,this.nowEndTs=0,this.blockHelper=new pn,this.blockHelper.setHlsPlayer(this),T.setHlsPlayer(this),this.vodSecHelper=new gn,this.codecType=F,this.isAv1State=!1,this.stopLoadFragment=!1,this.playBackRate=1,this.continuousTimeStamp=!1}selectXhrLoader(){this._loaderClz=Sa,this._loaderType=N.a.HLS_LOAD_TYPE.XHR}selectFetchLoader(){this._loaderClz=un,this._loaderType=N.a.HLS_LOAD_TYPE.FETCH}getSpeed(){let t=this.avgSpeed.average();return t===R.b.UintMax?0:t}destroy(){n.a.log("HlsPlayer.destroy"),this.started=!1,this.removeTimer(),this.anticode=null,this.playStat&&this.playStat.destroy(),this.playStat=null,this.hlsSeek&&this.hlsSeek.destroy(),this.hlsSeek=null,this.avgSpeed&&this.avgSpeed.reset(),this.avgSpeed=null,this.exceptionStat&&this.exceptionStat.destroy(),this.exceptionStat=null,this.blockHelper&&this.blockHelper.destroy(),this.blockHelper=null,T.destroy(this),this.vodSecHelper=null,this.destroyMse(),this.playlist&&(this.playlist.destroy(),this.playlist=null),this.releaseLoader(),this.isSwitchSeamLessLine=!1,this.url=null,this.firstTsInfo=null,this.eventEmitter=null,this._hyPlayer=null,this.stat=null,this.statVod=null,this.tsdb=null,this.h265Proxy=null,this.statSwitch=null,this._loaderClz=null,this.videoElement=null}reset(){n.a.log("HlsPlayer.reset"),this.exceptionStat&&this.exceptionStat.reset(),this.avgSpeed&&this.avgSpeed.reset(),this.removeTimer(),this.destroyMse(),this.playlist&&(this.playlist.destroy(),this.playlist=null),this.releaseLoader(),this.isSwitchSeamLessLine=!1,this.isLive=null,this.liveType=0,this.url=null,this.cdnName=null,this.seekTime=0,this.targetDuration=0,this.isLoading=!1,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.hasVideo=!1,this.started=!1,this.userPaused=!1,this.isTryAgain=!1,this.playStat&&this.playStat.stop(),this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.curAppendFrag=null,this.seeking=!1,this.skipStatForSeek=!1,this.firstPlay=!0,this.playTriggered=!1,this.stat&&this.stat.clearFill(),this.statVod&&this.statVod.clearFill(),this.isSwitchSeamLessLine=!1,this.pausedByBrowser=!1,this.sOrigUrl="",this._pcdnFragStartTs=0,this._cdnFragStartTs=0,this.firstTsInfo=null,this._getPcdnDataTime=0,this._getCdnDataTime=0,this.forceUseCdn=!1,this.coolLoadFragment=!1,this.vodAbSwitch=!1,this.pcdnRepeatByteLen=0,this.lastSN=-1,this.errorPcdnSN=-1,this.needStatPcdnRepeatBW=!1,this.seekBeforeTime=0,this.isSeekBefore=!1,this.tsFileSize=0,this.heartTsStartTime=0,this.heartTsEndTime=0,this.firstTsHttpCode=0,this.endTs=0,this.nowEndTs=0,this.isAv1State=!1,this.stopLoadFragment=!1}resetMediasource(){this.resetPlayTs=0,this.needReset=!0}reloadInError(){if(this.isLive){let t=this.playlist.currFrag;t&&(this.releaseLoader(),this.destroyMse(),this.mse=this.createMse(),this.isLoading=!1,n.a.log("HlsPlayer.reloadInError, seek"),this.seek(t.start+.5))}else if(this.info){const t=this.getCurrentTime();this.info.seekTime=t+1,this.start(this.info)}}destroyMse(){this.mse&&(this.mse.destroy(),this.mse=null)}createMse(){let t={isLive:this.isLive,videoType:"ts",videoElement:this.videoElement,h265Proxy:this.h265Proxy,ignoreSei:this.ignoreSei,closeFetch:this.closeFetch,continuousTimeStamp:this.continuousTimeStamp,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,dropBeforeFirstIDR:this.dropBeforeFirstIDR};if(1==f.a._isPureAudio&&(t.isPureAudio=!0),1==f.a._isPureVideo&&(t.isPureVideo=!0),this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS){let t=f.a.hasOwnProperty("_minBuffer")?Number(f.a._minBuffer):3e3;const e=new en(this,{videoType:"ts",isLive:this.isLive,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,dropBeforeFirstIDR:this.dropBeforeFirstIDR,h265Proxy:this.h265Proxy,videoElement:this.videoElement,isH265Mode:this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,lowlatencyCfg:{lowlatencyBuf:-1,lowlatencyMin:t+500,lowlatencyMax:t+1e3,openRenderSync:1}});return e.parser.openConvertIDR=1===o.a.vodConvertIDR,this.isAv1State&&e.setVodAv1&&e.setVodAv1(),e}{let e=new to(this,t);return e.onInitSegmentCb=this.onFirstBuf.bind(this),e.m4sPlayer.onFirstBufCb=this.onFirstBufCb,e.parser.openConvertIDR=1===o.a.vodConvertIDR,e}}releaseLoader(){this.fragLoader&&(this.fragLoader.destroy(),this.fragLoader=null)}removeTimer(){clearTimeout(this.tryTimer),X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),X.remove(this.onCheckIfCanPCDN,this)}setConfig(t,e){}setVodPcdnConfig(t){const e=t.vid||R.b.getQueryString("vid",t.url),i=t.presenterUid;o.a.setVodPcdnConfig({vid:e,anchoruid:i,useVodPcdnAbCfg:this.vodAbSwitch}),n.a.log("vodPcdnOpenBuffer=".concat(o.a.vodPcdnOpenBuffer,", vodPcdnCloseBuffer=").concat(o.a.vodPcdnCloseBuffer,", vodPcdnCoolTime=").concat(o.a.vodPcdnCoolTime))}start(t){this.stop(),1==f.a.continuousTimeStamp&&(t.continuousTimeStamp=!0),this.continuousTimeStamp=!!t.continuousTimeStamp;let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.stat.setComDim(d.a.DIM_COM.H265,e?1:0),this.stat.setComDim(d.a.DIM_COM.P2P,d.a.LIVE_TYPE.HLS),this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,3),t.isLive&&(P.bindEvent(this.tsdb,t._sessionId,t.lineType,t.sDisplayName,t.iBitRate),this.statSwitch&&this.statSwitch.check(t,!1)),this.checkParams(t,this.realStartBind)}checkParams(t,e){if(n.a.log("HlsPlayer.checkParams",JSON.stringify(t),t),!t.isLive){this.vodAbSwitch=R.b.getSdkAbRandom(t,o.a.vodAbSwitch);const e=this.vodAbSwitch?1:2;this.stat.setComDim(d.a.VOD_DIM_COM.VOD_AB_SWITCH,e),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_AB_SWITCH,e),n.a.log("%cVOD_AB_SWITCH = ".concat(e),"color:#A23400;background:#FFF5C2"),this.setVodPcdnConfig(t)}this.started=!0,t.isLive&&t.sHlsUrl&&t.sStreamName?(t.sHlsUrl=t.sHlsUrl.replace("http://","https://"),t.sHlsAntiCode?(this.anticode.init(t.sHlsUrl,t.sStreamName,t.sHlsAntiCode),this.anticode.valid().then(()=>{e(t)})):e(t)):t.url?e(t):n.a.warn("HlsPlayer.checkParams has no params(sHlsUrl,sStreamName,url)"),this.h265Proxy&&this.h265Proxy.onStarted&&this.h265Proxy.onStarted()}initInfo(t){let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.info=t;let i=t.url;1==t._av1State?i=t.av1Url:e&&(i=t.h265Url),t.sHlsUrl&&t.sStreamName&&(i=t.sHlsUrl+"/"+t.sStreamName+".m3u8"),i=this.replaceProtocl(i),this.sOrigUrl=i;let s=[];return this.anticode.hasAnticode()&&s.push(this.anticode.getAnticode()),t.iBitRate>0&&s.push("ratio=".concat(t.iBitRate)),s.length>0&&(i+=(-1!==i.indexOf("?")?"&":"?")+"".concat(s.join("&"))),this.lineType=t.lineType,this.liveType=t.liveType,i}realStart(t){let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;if(this.isAv1State=1==t._av1State,this.isH265=e,!this.started)return;this.url=this.initInfo(t),this.h265Proxy.isLive=!!t.isLive,this.h265Proxy.isH265Stream=!1,1==t._av1State?this.firstTsInfo=t.tsAv1Info:e?(this.firstTsInfo=t.tsH265Info,this.h265Proxy.isH265Stream=!0):this.firstTsInfo=t.tsInfo,this.firstTsInfo&&(this.firstTsInfo.sn=1e3);let i=(new Date).getTime();if(this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(t.startTimeStamp)||0,t.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=t.startTimeStamp?Math.floor(i-t.startTimeStamp):0,this.noNeedSendVideoLoadTime=!1),t.uistartTs&&t.uistartTs>0&&(this.UIStartCost=Math.floor(i-t.uistartTs)),n.a.log("HlsPlayer.start startTimeStamp="+t.startTimeStamp,"uistartTs="+t.uistartTs,"businessStartCost="+this.businessStartCost,"UIStartCost="+this.UIStartCost,"now="+i,"uistartTs="+t.uistartTs),!this.url)return void n.a.warn("HlsPlayer.start invalid argument, pls check the url.");this.loadHlsStatus=N.a.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.isLive=t.isLive,this.closeFetch=Boolean(t.closeFetch),this.ignoreSei=Boolean(t.ignoreSei),this.cdnName=t.cdnName,this.liveType=t.liveType,this.closeFetch&&this.selectXhrLoader(),n.a.log("HlsPlayer.start isLive=".concat(this.isLive," url=").concat(this.url)),this.playlist=new class{constructor(t){this.hls=t,this.isLive=t.isLive,this.config=t.config,this.m3u8Parser=new class{constructor(t){this.isLive=t,this.seqGener=new class{constructor(){this.startSeq=1e3,this.m3u8Len=0,this.preTsArr=void 0}genSnFromM3u8(t){let e=this.convertM3u8ToArray(t);if(void 0===this.preTsArr)this.preTsArr=e;else{let t=this.findSeq(this.preTsArr,e[0],this.startSeq);-1===t&&(t=this.startSeq+this.preTsArr.length),this.preTsArr=e,this.startSeq=t}return this.startSeq}convertM3u8ToArray(t){let e,i=/#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^#|\r\n]+)?/gi,s=[];for(;null!==(e=i.exec(t));)e.shift(),e=e.filter((function(t){return void 0!==t})),"INF"===e[0]&&s.push(e[2]),e=[];return s}findSeq(t,e,i){for(let s=t.length-1;s>=0;s--){let r=t[s],a=r.split("?");r=a.length>1?a[0]:r;let o=e.split("?");if(r===(e=o.length>1?o[0]:e))return i+s}return-1}},this.isSwitchSeamLessLine=!1}resolve(t,e){return t.indexOf("../")>=0?on.a.buildAbsolutePath(e,t):on.a.buildAbsoluteURL(e,t)}resolveUrlQuery(t,e){return""!==e&&(-1===t.indexOf("?")?t+="?":t+="&",t+=e),t}cloneObj(t){return JSON.parse(JSON.stringify(t))}parseMasterPlaylist(t,e){for(var i,s,r,a=[],o={},n=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/gi;null!=(i=n.exec(t));){for(i.shift(),i=i.filter((function(t){return void 0!==t})),(o={}).url=this.resolve(i.pop(),e);i.length>0;)switch(i.shift()){case"RES":o.width=parseInt(i.shift()),o.height=parseInt(i.shift());break;case"BAND":o.bitrate=parseInt(i.shift());break;case"NAME":o.name=i.shift();break;case"CODECS":for(s=i.shift().split(",");s.length>0;)-1!==(r=s.shift()).indexOf("avc1")?o.videoCodec=this.avc1toavcoti(r):o.audioCodec=r}a.push(o)}return a}avc1toavcoti(t){var e,i=t.split(".");return i.length>2?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("00"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e}parseKeyParamsByRegex(t,e){var i=e.exec(t);return i&&(i.shift(),2===(i=i.filter((function(t){return void 0!==t}))).length)?i[1]:null}parseLevelPlaylist(t,e,i){return this._parseByLine(t,e,i)}_getUrlQuery(){let t="";const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("?");return e.length>=2&&e.shift(),t=e.join(""),t}_getValue(t,e,i){for(let s=e+1;s<i;s++)if(!t[s].startsWith("#"))return[s,t[s]];return!1}_getIv(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e}_parseByLine(t,e,i){var s,r,a,h,d,l,c=0,u=0,p=!1,m=0,_={url:e,initUrl:"",fragments:[],fileType:-1,live:this.isLive,startSN:0},f=!1;let g=0,S=!1,y="";this.isLive||(S=!0,s=this.seqGener.genSnFromM3u8(t),_.startSN=s,y=R.b.getQueryString("newmode",e)?this._getUrlQuery(e):"");var T={method:null,key:null,iv:null,uri:null};let P=t.replace("\r").split("\n"),v=P.length;for(let t=0;t<v;t++){let R=P[t];if(-1!==R.indexOf("#EXT-X-MEDIA-SEQUENCE"))this.isLive&&(u=_.startSN=parseInt(R.match(/\d+/g)[0]));else if(-1!==R.indexOf("#EXT-X-TARGETDURATION"))_.targetduration=parseFloat(R.match(/[\d\.]+/g)[0]);else if(-1!==R.indexOf("#EXT-X-ENDLIST"))_.live=!1,n.a.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");else if(-1!==R.indexOf("#EXT-X-MAP")){let t=R.match(/URI=\"(.+?)\"/);if(t[1]&&(_.initUrl=this.resolveUrlQuery(this.resolve(t[1],e),y),-1==_.initUrl.indexOf("?"))){let t=e.split("?");t.length>1&&(_.initUrl+="?".concat(t[1]))}}else if(-1!==R.indexOf("#EXT-X-DISCONTINUITY"))f=!0,g++;else if(-1!==R.indexOf("#EXT-X-BYTERANGE")){var E=R.match(/[\d@]+/g)[0].split("@");if(l=1===E.length?d:parseInt(E[1]),d=parseInt(E[0])+l,(h=_.fragments.length?_.fragments[_.fragments.length-1]:null)&&(h.byteRangeStartOffset=l,h.byteRangeEndOffset=d,(r=this._getValue(P,t,v))&&!h.url)){let t=r[1];h.setUrl(t?this.resolve(t,e):null)}}else if(-1!==R.indexOf("#EXT-ALIGN-PTS"))1===o.a.switchSeamLessLine&&(c=Number(R.replace("#EXT-ALIGN-PTS:","")),p=!0,this.isSwitchSeamLessLine=!0);else if(-1!==R.indexOf("#EXTINF")){var C=parseFloat(R.match(/[\d\.]+/g)[0]);if(!isNaN(C)){if(S&&C<1)continue;var I;if(S=!1,a=p?c:++u,this.isLive||(a=s++),T.method&&T.uri&&!T.iv?(I=this.cloneObj(T)).iv=this._getIv(this.isLive?u:a):I=T,r=this._getValue(P,t,v)){let t=r[1];(h=new hn).setUrl(t?this.resolveUrlQuery(this.resolve(t,e),y):null),h.time=t?on.a.getTimeFromUrl(t,this.isLive):0,h.duration=C,h.start=m,h.level=i,h.sn=a,h.discontinuity=f,h.discontinuityCnt=g,h.byteRangeStartOffset=l,h.byteRangeEndOffset=d,h.decryptdata=I,_.fragments.push(h),-1===_.fileType&&(_.fileType=dn.getType(t)),f&&(f=!1),m+=C,l=null}}}else if(-1!==R.indexOf("#EXT-X-KEY")){var A=R.replace("#EXT-X-KEY:",""),D=this.parseKeyParamsByRegex(A,/(METHOD)=([^,]*)/),O=this.parseKeyParamsByRegex(A,/(URI)=["]([^,]*)["]/),L=this.parseKeyParamsByRegex(A,/(IV)=([^,]*)/);D&&(T={method:null,key:null,iv:null,uri:null},O&&"AES-128"===D&&(T.method=D,T.uri=this.resolve(O,e),T.key=null,L&&(T.iv=L,"0x"===T.iv.substring(0,2)&&(T.iv=T.iv.substring(2)),T.iv=T.iv.match(/.{8}/g),T.iv[0]=parseInt(T.iv[0],16),T.iv[1]=parseInt(T.iv[1],16),T.iv[2]=parseInt(T.iv[2],16),T.iv[3]=parseInt(T.iv[3],16),T.iv=new Uint32Array(T.iv))))}}return _.totalduration=m,_.endSN=c-1,this.isLive||(_.endSN=s-1),_}_parseByReg(t,e,i){var s,r,a,o,h,d=0,l=0,c={url:e,fragments:[],live:this.isLive,startSN:0},u=!1;this.isLive||(s=this.seqGener.genSnFromM3u8(t),c.startSN=s);for(var p={method:null,key:null,iv:null,uri:null},m=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;null!==(r=m.exec(t));)switch(r.shift(),(r=r.filter((function(t){return void 0!==t})))[0]){case"MEDIA-SEQUENCE":this.isLive&&(d=c.startSN=parseInt(r[1]));break;case"TARGETDURATION":c.targetduration=parseFloat(r[1]);break;case"ENDLIST":c.live=!1,n.a.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");break;case"DIS":u=!0;break;case"BYTERANGE":var _=r[1].split("@");h=1===_.length?o:parseInt(_[1]),o=parseInt(_[0])+h,(a=c.fragments.length?c.fragments[c.fragments.length-1]:null)&&!a.url&&(a.byteRangeStartOffset=h,a.byteRangeEndOffset=o,a.setUrl(this.resolve(r[2],e)));break;case"INF":var f=parseFloat(r[1]);if(!isNaN(f)){var g,S=d++;if(this.isLive||(S=s++),p.method&&p.uri&&!p.iv){g=this.cloneObj(p);for(var y=new Uint8Array(16),T=12;T<16;T++)y[T]=S>>8*(15-T)&255;g.iv=y}else g=p;let t=r[2];c.fragments.push({url:t?this.resolve(t,e):null,time:t?on.a.getTimeFromUrl(t,this.isLive):0,duration:f,start:l,level:i,sn:S,discontinuity:u,byteRangeStartOffset:h,byteRangeEndOffset:o,decryptdata:g}),u&&(u=!1),l+=f,h=null}break;case"KEY":var P=r[1],v=this.parseKeyParamsByRegex(P,/(METHOD)=([^,]*)/),E=this.parseKeyParamsByRegex(P,/(URI)=["]([^,]*)["]/),C=this.parseKeyParamsByRegex(P,/(IV)=([^,]*)/);v&&(p={method:null,key:null,iv:null,uri:null},E&&"AES-128"===v&&(p.method=v,p.uri=this.resolve(E,e),p.key=null,C&&(p.iv=C,"0x"===p.iv.substring(0,2)&&(p.iv=p.iv.substring(2)),p.iv=p.iv.match(/.{8}/g),p.iv[0]=parseInt(p.iv[0],16),p.iv[1]=parseInt(p.iv[1],16),p.iv[2]=parseInt(p.iv[2],16),p.iv[3]=parseInt(p.iv[3],16),p.iv=new Uint32Array(p.iv))))}return c.totalduration=l,c.endSN=d-1,this.isLive||(c.endSN=s-1),c}}(t.isLive),this.currLevelId=0,this.m3u8FileSize=0,this.levels=[],this.firstLevelLoaded=!1,this.m3u8Parsered=!1,this.loader=null,this.manifestLoadedTs=0,this.isMasterPlayList=!1,this.currLevel=null,this.fragHelper=new class{constructor(t,e,i){this._isLive=i,this._details=null,this._fragments=null,this._totalDuration=0,this._idx=0,this._lastFrag=null,this._curFrag=null,this._seekTime=0,this._sOrigUrl="",this._initUrl="",this._fileType=1,this._pcdnIdx=-1,this._pcdnVodProxy=new cn(t,e)}destroy(){this._pcdnVodProxy&&this._pcdnVodProxy.destroy(),this._sOrigUrl=null,this._initUrl=null,this._details=null,this._fragments=null,this._lastFrag=null,this._curFrag=null}setOrigUrl(t){this._sOrigUrl=t}setFileType(t){this._fileType=t}reset(){this._details=null,this._fragments=null,this._totalDuration=0,this._idx=0,this._lastFrag=null,this._curFrag=null,this._seekTime=0,this._pcdnIdx=-1,this._sOrigUrl=""}set details(t){this._details=t,this._fragments=t.fragments,this._totalDuration=t.totalduration,this._initUrl=t.initUrl,this._fileType=t.fileType,this._seekTime>0&&(this.seek(this._seekTime),this._seekTime=0)}get details(){return this._details}isM4s(){return this._fileType===dn.M4S}setInitUrl(t){this._initUrl=t}getInitUrl(){return this._initUrl}setFirst(){this._idx++}get currFragNum(){return this._fragments?this._fragments.length:0}get totalDuration(){return this._totalDuration}get lastFrag(){return this._lastFrag}set lastFrag(t){t&&(this._lastFrag=t)}get curFrag(){return this._curFrag}set curFrag(t){t&&(this._lastFrag=this._curFrag,this._curFrag=t)}get isPcdnProxyOpen(){return this._pcdnVodProxy.isPcdnOpen}get isPcdnClientOpen(){return!o.a.isCloseVodPcdn}getNearFragStart(t){let e=this._fragments;if(e){let i=null,s=0,r=e.length-1;for(;s<r;s++)if(i=e[s],i.start>t)return i.start}return Math.ceil(t+1)}getFrag(t){let e=this._idx,i=this._fragments,s=null;return t?i.length>0&&(s=i.shift()):e<i.length&&(s=i[e],e++),s&&(this._idx=e,this._lastFrag=this._curFrag,this._curFrag=s),s}seek(t){this._pcdnIdx=-1;let e=this._fragments;if(!e)return this._seekTime=t,!1;t=Math.min(t,this._totalDuration);let i=null,s=0,r=0,a=!1,o=this._fragments.length;for(;r<o;r++)if(i=e[r],s=i.start+i.duration,i.start<=t&&t<s){s-.2<t&&r<o-1&&(i=e[r+1],r+=1),i.seeking=!0,a=!0;break}return a?(n.a.info("HlsPlaylist.seek suc seekTime=".concat(t," fragIdx=").concat(this._idx,", ").concat(r),i.sn),this._idx=r):n.a.info("HlsPlaylist.seek fail seekTime=".concat(t," fragIdx=").concat(this._idx)),a}mergeDetails(t){let e=null;if(this._details){e=this._details;let i=t,s=0,r=0,a=0,o=null;o=e.fragments.length>0?e.fragments[e.fragments.length-1]:this._curFrag,a=o.sn,r=o.start+o.duration;let h=[];i.fragments.forEach(t=>{t.sn>a&&(e.fragments.push(t),h.push(t))}),e.endSN=i.endSN,e.fragments.forEach(t=>{s+=t.duration,t.sn>a&&(t.start=r,r+=t.duration)}),e.totalduration=s,h.length>0&&P.isOpen()&&n.a.log("FragHelper.mergeDetails newFrags=".concat(h.length))}else e=t,this._isLive&&n.a.log("FragHelper.mergeDetails first frags=".concat(t.fragments.length));this.details=e}getVodPcdnProxy(){if(1!==o.a.isCloseVodPcdn&&(-1===this._pcdnIdx||this._pcdnIdx-this._idx<=3)){-1===this._pcdnIdx&&(this._pcdnIdx=this._idx);let t=this._pcdnIdx+10,e=Math.min(this._fragments.length,t),i=[],s=[];for(let t=this._pcdnIdx;t<e;t++){let e=this._fragments[t];i.push(e),s.push(e.sn)}i.length>0&&(n.a.log("FragHelper.getVodPcdnProxy firstIdx=".concat(this._pcdnIdx," sn=").concat(s.join(","))),this._pcdnVodProxy.getVodPcdnProxy(this._sOrigUrl,i),this._pcdnIdx=t)}}getVodPcdnProxyCursor(){if(1===o.a.isCloseVodPcdn)return;if(!this._pcdnVodProxy.isPcdnOpen)return;let t=[],e=[],i=this._idx;if(this._fragments.length-i>=3&&this._fragments[i].pcdnUrls.length>0&&this._fragments[i+1].pcdnUrls.length>0&&this._fragments[i+2].pcdnUrls.length>0)n.a.log("FragHelper.getVodPcdnProxy idx=".concat(this._idx-1," curFrag.sn=").concat(this._curFrag.sn," pcdn fragment is enough"));else{for(;i<this._fragments.length;){let s=this._fragments[i];if(s.pcdnUrls.length<=0&&(t.push(s),e.push(s.sn)),t.length>=10)break;i++}t.length>0&&(n.a.log("FragHelper.getVodPcdnProxy idx=".concat(this._idx-1," curFrag.sn=").concat(this._curFrag.sn," req sn=").concat(e.join(","))),this._pcdnVodProxy.getVodPcdnProxy(this._sOrigUrl,t))}}}(t.statVod,t.stat,t.isLive),this.firstTsInfo=null,this.loadM3u8HttpCode=-1,this.m3u8ContentErrorCnt=0}destroy(){this.m3u8Parser=null,this.currLevelId=0,this.m3u8FileSize=0,this.levels=null,this.currLevel=null,this.firstLevelLoaded=!1,this.m3u8Parsered=!1,this.loader&&this.loader.destroy(),this.loader=null,this.manifestLoadedTs=0,this.isMasterPlayList=!1,this.fragHelper&&this.fragHelper.destroy(),this.fragHelper=null,this.firstTsInfo=null,this.loadM3u8HttpCode=-1,this.config=null,this.hls=null}get currDetails(){return this.fragHelper.details}get currFragNum(){return this.fragHelper.currFragNum}get totalDuration(){return this.firstTsInfo&&this.firstTsInfo.totalDuration||this.fragHelper.totalDuration}get currFrag(){return this.fragHelper.curFrag}set currFrag(t){t&&(this.lastFrag=this.currFrag,this.fragHelper.curFrag=t)}get lastFrag(){return this.fragHelper.lastFrag}set lastFrag(t){t&&(this.fragHelper.lastFrag=t)}get nextFrag(){return this.fragHelper.getFrag(this.isLive)}getNearFragStart(t){return this.fragHelper.getNearFragStart(t)}setOrigUrl(t){this.fragHelper.setOrigUrl(t)}setCurrentFrag(t){t&&(this.lastFrag=this.currFrag,this.currFrag=t)}seek(t){return!this.isLive&&this.fragHelper.seek(t)}loadFirstFragment(t){t&&t.tsUrl&&!this.firstLevelLoaded&&(n.a.log("HlsPlaylist.loadFirstFragment firstTsInfo = ",t),this.fragHelper.setFileType(dn.getType(t.tsUrl)),t.initUrl&&this.fragHelper.setInitUrl(t.initUrl),this.fragHelper.setFirst(),t.tsUrl=this.addUrlParams(t.tsUrl),this.firstLevelLoaded=!0,this.firstTsInfo=t,this.hls.loadFragment(!1,t),T.setFirstTs(t))}loadManifest(t){this.hls.vodSecHelper.setM3u8Start(),this.m3u8Parser.isSwitchSeamLessLine=!1,this.loader&&(this.loader.destroy(),this.loader=null),t=this.addUrlParams(t),this.manifsetUrl=t,n.a.log("HlsPlaylist.loadManifest url=".concat(t)),this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_CNT,1),this.loader=new Sa(this.config),this.loader.onOpen=this.onManiFestOpen.bind(this),this.loader.load(t,"text",this.onManifestLoaded.bind(this),this.loadManifestError.bind(this),this.loadManifestTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay),T.setM3u8Loader(this.loader)}onManiFestOpen(){this.hls.vodSecHelper.setM3u8Open()}refreshManifsetUrl(t){t=this.addUrlParams(t),this.manifsetUrl=t}addUrlParams(t){if(-1!==t.indexOf("hyscence=vodadv")&&(t=t.replace("hyscence=vodadv","hyscence=vodbusiness")),-1!==t.indexOf("scene=vodadv")&&(t=t.replace("scene=vodadv","scene=vodbusiness")),-1===t.indexOf("&sv=")){const e=o.a.platform,i=N.a.PLATFORM_TYPE[e]||N.a.PLATFORM_TYPE.web;t+=-1===t.indexOf("?")?"?":"&";const s=e===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);t+="".concat(s,"&t=").concat(i),t=R.b.urlInfoParams(t,this.hls.info),this.m3u8ContentErrorCnt>0&&(t+="&mceCnt=".concat(this.m3u8ContentErrorCnt))}return R.b.checkDMod(t,this.hls.info._dMod,this.hls.info._sMod)}onManifestLoaded(t,e){if(0==this.manifestLoadedTs&&(this.manifestLoadedTs=_.a.now()),this.loadM3u8HttpCode=t.currentTarget.status,404===this.loadM3u8HttpCode||0===this.loadM3u8HttpCode||403===this.loadM3u8HttpCode)return n.a.warn("HlsPlaylist.onManifestLoaded status=".concat(this.loadM3u8HttpCode)),this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_FAIL_CNT,1),void this.hls.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR);if(T.setM3u8Status(1),!this.isLive){const t=this.loader.getResponseHeader("Content-length")||0;this.m3u8FileSize=1*t,this.hls.statVod.setCore(d.a.VOD_CORE.M3U8_FILE_BW,this.m3u8FileSize),this.hls.statVod.addCore(d.a.CORE.CDN_TOTAL_BW,this.m3u8FileSize),this.hls.stat.addCore(d.a.CORE.CDN_TOTAL_BW,this.m3u8FileSize)}let i,s=t.currentTarget.response,r=this.manifsetUrl,a=null,o=[];if(-1==s.indexOf("#EXTM3U"))return this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_WRONG_CNT,1),n.a.warn("HlsPlaylist.onManifestLoaded m3u8 doesn't match #EXTM3U\n",s),this.hls.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR),void(this.m3u8ContentErrorCnt<3&&(this.m3u8ContentErrorCnt++,this.hls.onM3u8ContentError()));this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_SUC_CNT,1);let h=-1==s.indexOf("#EXTINF:");h?(this.isMasterPlayList=!0,a=this.m3u8Parser.parseMasterPlaylist(s,r)):(this.isMasterPlayList=!1,a=[{url:r}]),o=a,i=o[0].bitrate,o.sort((t,e)=>t.bitrate-e.bitrate),this.levels=o;for(let t=0;t<o.length;t++)if(o[t].bitrate===i){this.currLevelId=t;break}this.currLevel={bitrate:i},this.hls.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_SUCCESS),h?(this.currLevel.url=o[this.currLevelId].url,this.loadLevel()):(this.currLevel.url=this.manifsetUrl,this.onLevelLoaded(t))}loadManifestError(t){this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_FAIL_CNT,1),n.a.warn("HlsPlaylist.loadManifestError "+t.currentTarget.status,t.currentTarget.readyState),this.loadM3u8HttpCode=t.currentTarget.status,T.setM3u8Status(t.currentTarget.status>0?-1:-2),404!==t.currentTarget.status&&0!==t.currentTarget.status||this.hls.onAnchorStop(),this.hls.onLoadM3u8Error(t)}loadManifestTimeout(t){this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_TIMEOUT_CNT,1),t&&t.readyState>=2?(T.setM3u8Status(-4),this.hls.onLoadManifestTimeout()):(T.setM3u8Status(-3),this.hls.onConnectManifestTimeout())}loadLevel(){if(!this.currLevel)return;let t=this.currLevel.url;if(!this.isLive&&this.currDetails){let e=this.currDetails.fragments,i=e[e.length-1];i||(n.a.log("HlsPlaylist.loadLevel: fragments run out"),i=this.fragHelper.curFrag),t=e.length<=this.config.minFragBufferNum?this.currLevel.url.replace(/\?btime=\d*$/,"?btime=".concat(i.time)):null}t&&this._loadLevel(t)}updateLiveVodUrl(t){this.currLevel&&(t=this.addUrlParams(t),this.manifsetUrl=t,this.m3u8Updating=!0,this.currLevel.url=t,this._loadLevel(t))}_loadLevel(t){this.isLive&&P.isOpen()&&n.a.log("HlsPlaylist._loadLevel url=".concat(t)),this.loader&&(this.loader.destroy(),this.loader=null),this.anticode&&(t+="?"+this.anticode),this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_CNT,1),this.loader=new Sa(this.config),this.loader.load(t,"",this.onLevelLoaded.bind(this),this.loadLevelError.bind(this),this.loadLevelTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay)}onLevelLoaded(t,e){if(404===t.currentTarget.status||0===t.currentTarget.status)return void this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_FAIL_CNT,1);let i=t.currentTarget.responseText,s=this.manifsetUrl,r=this.currLevel,a=null;if(s&&(r.url=s),this.isLive&&n.a.log(i),0===i.indexOf("#EXTM3U")&&i.indexOf("#EXTINF:")>0){if(this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_SUC_CNT,1),a=this.m3u8Parser.parseLevelPlaylist(i,r.url,this.currLevelId),this.fragHelper.mergeDetails(a),r.details=this.fragHelper.details,this.isLive||(n.a.log("HlsPlaylist.onLevelLoaded : fragments.length:".concat(r.details.fragments.length)),this.hls.eventEmitter.trigger(u.PLAYBACK_M3U8_UPDATED,{totalDuration:this.totalDuration})),this.m3u8Parsered=!0,this.isLive&&r.details.fragments.length>o.a.hlsLiveMaxFragNum)return n.a.info("HlsPlaylist.onLevelLoaded fragments.length =",r.details.fragments.length),void this.hls.reconnectLive();this.hls.setTargetDuration(this.currDetails.targetduration),this.hls.vodSecHelper.setM3u8End(),this.firstLevelLoaded||(this.firstLevelLoaded=!0,this.hls.loadFragment())}else{this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_EMPTY_CNT,1);var h=r.details.fragments.length;n.a.warn("HlsPlaylist.onLevelLoaded no playlist. fragments.length=".concat(h,"\n").concat(i))}this.hls.isSwitchSeamLessLine=this.m3u8Parser.isSwitchSeamLessLine}loadLevelError(t){this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_FAIL_CNT,1),n.a.warn("HlsPlaylist.loadLevelError "+t.currentTarget.status),404!==t.currentTarget.status&&0!==t.currentTarget.status||this.hls.onAnchorStop()}loadLevelTimeout(){this.hls.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.M3U8_TIMEOUT_CNT,1),this.hls.reset()}onCheckTimer(t){this.isLive&&this.loadLevel()}}(this),this.playlist.setOrigUrl(this.url),this.destroyMse(),this.mse=this.createMse(),this.setPlaybackRate(this.playBackRate);let s=1;this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&(s=this.isSoftSolution?3:2),this.stat.setComDim(d.a.DIM_COM.MSE_PLAYER,s),this.isLive||this.statVod.setComDim(d.a.VOD_DIM_COM.MSE_PLAYER,s),this.playerCoreType===N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.isSoftSolution&&this.mse.setUseSoftAcceleration(),-1!==this.url.indexOf("hyscence=vodadv")&&this.mse.setMuted(!0);const r=t.seekTime||this.seekTime;if(this.firstTsInfo&&r&&(this.firstTsInfo.tsDuration?r<=this.firstTsInfo.tsDuration?this.firstTsInfo.seeking=!0:r>this.firstTsInfo.tsDuration&&(this.firstTsInfo=null):this.firstTsInfo=null),this.startTs=_.a.now(),this.vodSecHelper.setStart(),this.updateStatus(p.VIDEO_LOADING),this.firstTsInfo&&this.playlist.loadFirstFragment(this.firstTsInfo),this.playlist.loadManifest(this.url),ut.setCdnDomain(this.stat,this.url,this.info.sStreamName),ut.setVodCdnDomain(this.statVod,this.url),this.seek(t.seekTime||this.seekTime),this.playStat.start(),this.stat.setComDim(d.a.DIM_COM.STREAM_URL,this.url),this.stat.setComDim(d.a.DIM_COM.HLS_TYPE,t.isLhls?2:1),this.stat.setComDim(d.a.DIM_COM.V_DECODEC,1==t._av1State?2:e?1:0),this.statVod.setComDim(d.a.DIM_COM.STREAM_URL,this.url),this.statVod.setComDim(d.a.DIM_COM.STREAM_TYPE,3),this.statVod.setComDim(d.a.DIM_COM.V_DECODEC,1==t._av1State?2:e?1:0),this.eventEmitter&&this.eventEmitter.roomRecordStat&&t.isLive&&this.eventEmitter.roomRecordStat.startStream(t.presenterUid,t.lineType,t.curBitrate,e?"h265":"h264","hls"),e&&this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.H265_STATUS,{value:[0],str:[0]})]),!this.isLive){let i=t.vid||R.b.getQueryString("vid",this.url);this.stat.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.stat.setComDim(d.a.DIM_COM.CODERATE_BPS,1e3*(t.curBitrate||t.coderate)),this.stat.setComDim(d.a.DIM_COM.ANCHOR_UID,t.presenterUid||0),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_CODERATE,t.curBitrate||t.coderate),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.statVod.setComDim(d.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),this.statVod.setComDim(d.a.DIM_COM.H265,e?1:0),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0)}this.isNotSupportWebcodecsConfigure()}onInitSegment(){let t=this.mse.getIsMseHevc()?1:0;this.stat.setComDim(d.a.DIM_COM.H265,t),this.statVod.setComDim(d.a.DIM_COM.H265,t)}onM3u8ContentError(){this.playlist.loadManifest(this.url)}refreshAnticode(){this.url=this.initInfo(this.info),this.playlist.refreshManifsetUrl(this.url)}setVideoPlayTimeSended(){this.flvLoadTimeSended=!0}setLoadStatus(t){if(this.loadHlsStatus!==t){if(t===N.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_SUCCESS){this.exceptionStat.setStat(d.a.DIM_LINK_STA.CONNECT_SUC,1);const t=this.playlist.manifestLoadedTs-this.startTs;this.tsdb.sendM3u8LoadedTime(this._loaderType,t),this.tsdb.sendVodM3u8LoadedTime(this._loaderType,t)}this.loadHlsStatus=t}}sendLoadVideoErrorStatus(){this.tsdb.sendMetrics([this.stat.createAct(A.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadHlsStatus]})])}getPlayVideo(){return this.mse.getPlayVideo()}stop(){this.started&&(n.a.log("HlsPlayer.stop"),this.playTriggered&&this.playStat.report(!0),this.reset())}seek(t){if(this.isLive||null==t)return;if(this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.getPlayVideo){const e=this.mse.getPlayVideo();if(e&&"number"==typeof t){const i=e.currentTime;this.seekBeforeTime=i,this.isSeekBefore=t<i}}this.h265Proxy&&this.h265Proxy.seek&&this.h265Proxy.seek(t);let e=!1;if(this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE){const i=this.mse&&this.mse.video&&this.mse.video.video;i&&i.buffered.length>0&&i.buffered.start(0)>1&&i.currentTime>0&&1*t==0&&(n.a.log("%cHlsPlayer.seek first buffered fixed","color:#A23400;background:#FFF5C2"),this.releaseLoader(),this.destroyMse(),this.mse=this.createMse(),this.isLoading=!1,e=!0)}this.pauseTs=0,this.endTs=0,this.nowEndTs=0,this.seeking=!0,this.skipStatForSeek=!0,this.seekTime=t,this.hlsSeek.seek(0);const i=this.getCurrentTime();if(n.a.log("HlsPlayer.seek curTime=".concat(i,", seekTime=").concat(t)),0==t){if(this.firstPlay=!1,!this.mse)return;if(this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS){if(i<1)return}else if(0==i&&!e)return}this.playlist&&(n.a.log("HlsPlayer.seek playlist "+t),t=Math.max(0,Number(t)),this.playlist.seek(t)?(this.mse.seek(t),this.mse.resetHls(),this.releaseLoader(),this.isLoading=!1,this.loadFragment(),this.hlsSeek.seek(this.seekTime)):this.playlist.m3u8Parsered&&this.playlist.firstLevelLoaded&&(n.a.warn("HlsPlayer.seek out of range.time=".concat(t,", duration=").concat(this.getFixedDurationTime())),this.stop(),this.onAnchorStop()))}pause(){this.started&&(n.a.info("HlsPlayer.pause"),this.userPaused=!0,this.mse&&this.mse.pause())}play(){this.started&&(n.a.info("HlsPlayer.play"),this.userPaused=!1,this.mse&&this.mse.play())}setVolume(t){this.videoElement&&(this.videoElement.volume=t),this.mse&&this.mse.setVolume(t)}getVolume(){return this.mse?this.mse.getVolume():-1}getBufferLen(){if(this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS)return this.mse?this.mse.getBufferLen():0;if(this.isLive)return this.mse?this.mse.getBufferLen():0;{if(!this.mse)return 0;this.mse.getPlayVideo();let t=0;return t=this.mse&&this.mse.isNoAudio&&this.h265Proxy.isReady?this.h265Proxy.getVideoBufferLen():this.mse.getBufferLen(),t}}getFrameBufferLen(){return this.mse.getFrameBufferLen()}getCurrentTime(){return this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.lastPlayTs=this.h265Proxy.getCurrentVideoTime()/1e3:this.mse&&(this.lastPlayTs=this.mse.getCurrentTime()/1e3),this.lastPlayTs>this.getDurationTime()?this.getDurationTime():this.lastPlayTs}getCurrentRealTime(){return this.mse&&this.mse.video&&this.mse.video.getCurrentTime()||0}getCurrentDts(){return this.mse?this.mse.getCurrentDts():0}getCurrentSeiOffsetDts(){return this.mse?this.mse.getCurrentSeiOffsetDts():0}getDurationTime(){return this.playlist&&this.playlist.totalDuration?this.playlist.totalDuration:0}getFixedDurationTime(){return this.playlist&&this.playlist.totalDuration?this.playlist.totalDuration:0}getAnticodeHandler(){return this.anticode}updateFlvConfig(){this.mse&&this.mse.setJitter(o.a.hlsJitCfg[0],o.a.hlsJitCfg[1],o.a.hlsJitCfg[2])}updateLiveVodUrl(t,e){e!==this.cdnName?this.eventEmitter.trigger(u.PLAYBACK_DIF_CDN):this.playlist.updateLiveVodUrl(t)}setMuted(t){this.mse&&this.mse.setMuted(t)}getMuted(){return this.mse?this.mse.getMuted():-1}addNoPictureReason(){const t=T.getHlsNoPictureReason();this.stat&&this.stat.setActDim(d.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t),this.statVod&&this.statVod.setActDim(d.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}reconnectLive(){if(n.a.log("HlsPlayer.reconnectLive"),this.isLive)P.addRetryStream(this.stat),this.destroy(),this.reset(),this.start(this.info);else{P.addRetryStreamVod(this.url);let t=this.playlist.currFrag;t.tryCnt>0?(t.tryCnt--,this.loadFragment(!0)):this.loadFragment(!1)}}setTargetDuration(t){this.targetDuration=t*this.config.minFragBufferNum}setStopLoadFragment(){this.stopLoadFragment=!0}loadFragment(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.stopLoadFragment)return;if(this.playlist.fragHelper.isM4s()&&!this.mse.isM4sInitLoaded()){this.vodSecHelper.setInitStart();let t=this.playlist.fragHelper.getInitUrl();t=R.b.checkDMod(t,this.info._dMod,this.info._sMod),t=this.replaceProtocl(t),this.mse.loadM4sInit(t,this.config,{initCb:this.m4sInitcb,openCb:this.m4sInitOpenCb})}if(this.vodSecHelper.setFirstStart(),this.isLoading)return;if(null===this.playlist.currDetails&&!e)return;if(this.hlsSeek.check(),!this.started)return;let i=this.getCurrentTime(),s=void 0,r=this.mse.getPlayVideo();if(s=this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.h265Proxy.getVideoBufferLen():this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS?this.mse.getBufferLen()/1e3:this.bufferedInfo(i,r.buffered).len,0==this.seekTime){let t=this.config.maxBufferLength,e=this.config.secondBufferLength;if(this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS){if(!(this.isSeekBefore&&i<this.seekBeforeTime)){if(this.coolLoadFragment){if(s>=e)return;this.coolLoadFragment=!1}if(s>=t)return void(this.coolLoadFragment=!0);this.seekBeforeTime=0,this.isSeekBefore=!1}}else if(!(this.h265Proxy.renderInited&&this.isSeekBefore&&i<this.seekBeforeTime)){if(this.coolLoadFragment){if(s>=e)return;this.coolLoadFragment=!1}if(s>=t)return void(this.coolLoadFragment=!0);this.seekBeforeTime=0,this.isSeekBefore=!1}}let a=null;if(e)a=new hn,a.sn=Number(e.sn)||1e3,a.setUrl(e.tsUrl),a.start=~~e.tsStartTime,a.discontinuity=!!e.discontinuity,a.seeking=!!this.firstTsInfo.seeking,a.byteRangeStartOffset=e.byteRangeStartOffset,a.byteRangeEndOffset=e.byteRangeEndOffset,this.playlist.currFrag=a;else if(a=t?this.playlist.currFrag:this.playlist.nextFrag,!this.seeking&&a&&this.firstTsInfo){const t=R.b.removeUrlAllParam(this.firstTsInfo.tsUrl),e=R.b.removeUrlAllParam(a.url);a.byteRangeEndOffset&&t===e?a=a.byteRangeEndOffset===this.firstTsInfo.byteRangeEndOffset?this.playlist.nextFrag:a:t===e&&(a=this.playlist.nextFrag)}if(this.mse.parser.parseAllData()&&this.mse.parser.pushAllData(),this.mse.parser.convertToIDR=!1,a){a.loadStartTs=_.a.now(),!this.isLive&&o.a.vodDtsFixCfg[0]&&this._ptsJumpTest(),!this.isLive&&this.loadVodPcdnProxy();let t=this.config,e=o.a.vodBs2Delay+this.targetDuration/3*1e3,i=a.getUrl({bufferLen:this.getBufferLen(),useCdn:this.forceUseCdn});this.playlist.fragHelper.isPcdnProxyOpen||(a.pcdnStatus=nn.PCDN_NOT_OPEN),this.playlist.fragHelper.isPcdnClientOpen||(a.pcdnStatus=nn.PCDN_CLIENT_NOT_OPEN),(o.a.vodPcdnStatCfg[0]?a.hasPcdn():a.pcdnStatus!==nn.PCDN_NOT_OPEN&&a.pcdnStatus!==nn.PCDN_CLIENT_NOT_OPEN)&&this.getBufferLen()<o.a.vodPcdnOpenBuffer&&!this.forceUseCdn?(a.pcdnStatus!==nn.OPEN_BUFFER_NOT_REACHED&&a.pcdnStatus!==nn.BUFFER_LACK_TO_CDN&&(a.pcdnStatusBk1=a.pcdnStatus),a.pcdnStatus=nn.OPEN_BUFFER_NOT_REACHED):this.forceUseCdn&&(a.pcdnStatus!==nn.OPEN_BUFFER_NOT_REACHED&&a.pcdnStatus!==nn.BUFFER_LACK_TO_CDN&&(a.pcdnStatusBk2=a.pcdnStatus),a.pcdnStatus=nn.BUFFER_LACK_TO_CDN),0==this.firstFragLoadTs&&(this.firstFragLoadTs=_.a.now(),a.pcdnStatus=nn.FIRST_TS,a.isFirstLoad=!0,0===T.getFirstFragStatus()&&T.setFirstFragStatus(1)),a.isPcdn?(this.statVod.addCore(d.a.CORE.GET_STREAM_CNT,1),this._pcdnFragStartTs=_.a.now()):this._cdnFragStartTs=_.a.now(),this.playlist.m3u8Parsered||(e=this.config.firstFragLoadTimeout),this.isLoading=!0,this.releaseLoader();let s=null;s=new this._loaderClz(t),this.fragLoader=s,a.byteRangeEndOffset&&(s.fromByte=a.byteRangeStartOffset,s.toByte=a.byteRangeEndOffset-1),n.a.log("HlsPlayer.loadFragment sn="+a.sn,i),this.fragStartTs=_.a.now(),this.fragSize=0,this.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_CNT,1),i=R.b.checkDMod(i,this.info._dMod,this.info._sMod),i=this.replaceProtocl(i),s.loadBuffer(i,this.loadOpen.bind(this),this.loadChunk.bind(this),this.loadSuccess.bind(this),this.loadError.bind(this),this.loadTimeout.bind(this),e,a.isPcdn?0:t.fragLoadingMaxRetry,a.isPcdn?0:t.fragLoadingRetryDelay)}else if(null!=s&&s<=2){let t=_.a.now();if(0===this.endTs&&(this.endTs=t+1e3*s+300),t>=this.endTs&&!this.isLive){n.a.log("HlsPlayer.loadFragment ANCHOR_STOP bufferedLen="+s.toFixed(2));let t=0;const e=this.mse.getPlayVideo();t=this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.h265Proxy.getCurrentVideoTime()/1e3:this.mse.getCurrentTime()/1e3;const i=this.getFixedDurationTime();i-t-s<=2&&(2===Number(this.liveType)?(this.stop(),this.onAnchorStop()):(n.a.log("HlsPlayer.loadFragment.onEnded currentTime=".concat(t," duration=").concat(i," bufferedLen=").concat(s)),this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&(e.currentTime=i),this.onEnded()))}}else if(this.seekTime>0)if(n.a.warn("HlsPlayer.loadFragment out of range."),this.isLive)this.stop(),this.onAnchorStop();else{const t=this.mse.getCurrentTime()/1e3,e=this.getFixedDurationTime();e-t<=2&&this.seek(e)}}_isEnded(){if(!this.started||1===this.liveType)return;const t=this.getFixedDurationTime(),e=this.getCurrentTime(),i=t-e,s=_.a.now();if(i<1)if(0==this.nowEndTs)this.nowEndTs=s+1e3*(t-e)+300;else if(s>=this.nowEndTs)return n.a.log("HlsPlayer._isEnded,duration=".concat(t,",currentTime=").concat(e,",delta=").concat(i)),!0;return!1}loadVodPcdnProxy(){o.a.platform!==N.a.PLATFORM_TYPE_NAME.wap&&this.playlist.m3u8Parsered&&this.playTriggered&&!this.forceUseCdn&&this.playlist.fragHelper.getVodPcdnProxyCursor()}loadOpen(t){this.vodSecHelper.setFirstOpen(),this.fragOpenTs=_.a.now();let e=this.fragOpenTs-this.fragStartTs;e<5e3&&this.playStat.tsOpens.push(e);const i=this.playlist&&this.playlist.currFrag;i&&i.isFirstLoad&&(t&&(this.firstTsHttpCode=t.code),1===T.getFirstFragStatus()&&T.setFirstFragStatus(2))}loadChunk(t){this.pushData(t)}loadSuccess(){let t=this.playlist.currFrag;t&&(t.loadEndTs=_.a.now(),n.a.log("HlsPlayer.loadSuccess sn=".concat(t.sn," costTime=").concat(t.loadEndTs-t.loadStartTs," duration=").concat(t.duration))),this.isLoading=!1;let e=_.a.now()-this.fragOpenTs;e<1e4&&(this.playStat.tsLoadeds.push(e),this.playStat.tsSpeeds.push(this.fragSize/e),this.playStat.tsSizes.push(this.fragSize)),this.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_SUC_CNT,1),this.fragSize=0}pushData(t){if(!t)return;this._loaderType===N.a.HLS_LOAD_TYPE.XHR&&n.a.log("HlsPlayer.pushData payload.length=".concat(t.byteLength));let e=this.playlist.currLevel||{},i=this.playlist.currFrag,s=this.playlist.lastFrag,r=this.playlist.totalDuration;if(this.exceptionStat.setStat(d.a.DIM_LINK_STA.HAS_DATA,1),this.avgSpeed.addCur(t.byteLength),this.fragSize+=t.byteLength,this.statFragData(t),!(t=this.discardPcdnRepeatData(t)))return;0==this.firstFragLoadedTs&&(this.firstFragLoadedTs=_.a.now(),this.firstFragSize=t.byteLength/1024|0);let a=i.discontinuity;this.curAppendFrag&&this.curAppendFrag.sn===i.sn?a=!1:this.curAppendFrag&&this.curAppendFrag.sn!==i.sn&&(this.curAppendFrag=i),this.curAppendFrag||(this.curAppendFrag=i),this.lastSN!==i.sn&&(this.lastSN=i.sn);const o={timeOffset:i.start,duration:r,level:i.level,sn:i.sn,seeking:i.seeking};if(this.playlist.fragHelper.isM4s()?this.mse.appendM4sSegment(t,o):this.mse.appendTs({data:t,audioCodec:e.audioCodec,videoCodec:e.videoCodec,timeOffset:i.start,duration:r,discontinuity:a,_discontinuity:i.seeking&&s&&i.discontinuityCnt!==s.discontinuityCnt,level:i.level,sn:i.sn,seeking:i.seeking,hlsDT:i.hlsDT,tsDT:i.tsDT}),i&&i.seeking){if(i.seeking=!1,this.firstPlay){this.firstPlay=!1;let t=i.start;this.info.secUseSeekTime&&(t=this.seekTime),this.mse.seek(t),this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&(this.onVideoSeek(t),this.play())}this.seekTime=0}X.has(this.onCheckTimer,this)||(X.add(this.onCheckTimer,this,1e3),X.add(this.onCheckFastTimer,this,100)),this.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_LOADFRAMENT_SUCCESS)}onM4sInit(){this.vodSecHelper.setInitEnd(),this.loadFragment()}onM4sInitOpen(){this.vodSecHelper.setInitOpen()}onFirstBuf(){this.vodSecHelper.setFirstBuf()}loadError(t){let{code:e,currentTarget:i,msg:s}=t;const r=this.playlist&&this.playlist.currFrag;r&&(r.isPcdn&&(this.errorPcdnSN=this.playlist.currFrag.sn,this.needStatPcdnRepeatBW=!0,this.statVod.addCore(d.a.CORE.GET_STREAM_LINK_ERROR_CNT,1),this.statVod.addCore(d.a.CORE.GET_STREAM_ERROR_CNT,1),r.pcdnStatus=nn.TS_LOAD_ERROR),r.isFirstLoad&&1===T.getFirstFragStatus()&&T.setFirstFragStatus(-1),r.isFirstLoad&&(this.firstTsHttpCode=e)),this.playlist&&this.playlist.currFrag&&this.playlist.currFrag.loadError(),this.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_FAIL_CNT,1),n.a.warn("HlsPlayer.loadError load fragment error:".concat(e||i&&i.status," ").concat(s||"")),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive(),this.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_LOADFRAMENT_ERROR)}loadTimeout(t){const e=this.playlist&&this.playlist.currFrag;e&&(e.loadError(),e.isPcdn&&(this.statVod.addCore(d.a.CORE.GET_STREAM_LINK_TIMEOUT_CNT,1),this.statVod.addCore(d.a.CORE.GET_STREAM_ERROR_CNT,1),e.pcdnStatus=nn.TS_LOAD_ERROR),e.isFirstLoad&&1===T.getFirstFragStatus()&&T.setFirstFragStatus(-2),e.isFirstLoad&&(this.firstTsHttpCode=code)),this.stat.addComp(d.a.HLS_INFO.name,d.a.HLS_INFO.TS_TIMEOUT_CNT,1),n.a.warn("load fragment timeout",t),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive()}discardPcdnRepeatData(t){let e=this.playlist.currFrag;if(this.lastSN!==e.sn&&(this.pcdnRepeatByteLen=0,this.playlist.fragHelper.isM4s()&&this.mse.m4sPlayer.createMp4()),!e.isPcdn&&this.errorPcdnSN===e.sn&&this.pcdnRepeatByteLen>0){if(this.needStatPcdnRepeatBW&&(this.statVod.setCore(d.a.PCDN_DATA.PCDN_REPEAT_BW,this.pcdnRepeatByteLen),this.needStatPcdnRepeatBW=!1),this.pcdnRepeatByteLen>t.byteLength)return this.pcdnRepeatByteLen-=t.byteLength,null;{let e=t.slice(this.pcdnRepeatByteLen,t.byteLength);this.pcdnRepeatByteLen=0,t=e}}return e.isPcdn&&(this.pcdnRepeatByteLen+=t.byteLength),t}statFragData(t){let e=this.playlist.currFrag;if(e.isFirstLoad&&2===T.getFirstFragStatus()&&T.setFirstFragStatus(S),this.tsFileSize+=t.byteLength,0===this.heartTsStartTime&&(this.heartTsStartTime=e.start,this.heartTsEndTime=this.heartTsStartTime),this.lastSN>0&&this.lastSN!==e.sn&&(this.heartTsEndTime+=e.duration,this.statVod.addCore(d.a.VOD_CORE.TS_PLAY_TIME,e.duration),this.statVod.addCore(d.a.VOD_CORE.TS_SIZE,this.tsFileSize),this.tsFileSize=0),this.lastSN!==e.sn&&(this._getPcdnDataTime>0&&(this.statVod.addCore(d.a.PCDN_DATA.GET_PCDN_DATA_TIME,this._getPcdnDataTime),this.statVod.addCore(d.a.PCDN_DATA.GET_PCDN_DATA_TIME_CNT,1),this._getPcdnDataTime=0),this._getCdnDataTime>0&&(this.statVod.addCore(d.a.PCDN_DATA.GET_CDN_DATA_TIME,this._getCdnDataTime),this.statVod.addCore(d.a.PCDN_DATA.GET_CDN_DATA_TIME_CNT,1),this._getCdnDataTime=0)),this.statVod.addKeyvalCoreDim(d.a.VOD_CORE.VOD_PCDN_STATE,"".concat(e.pcdnStatus,":").concat(t.byteLength)),this.statBackupPcdnState(t),e.isPcdn){const i=e.pcdnFreetime?d.a.CORE.PCDN_FREETIME_BW:d.a.CORE.PCDN_REALTIME_BW;this.statVod.addCore(i,t.byteLength),this.stat.addCore(d.a.CORE.PCDN_TOTAL_BW,t.byteLength),this._pcdnFragStartTs>0&&(this._getPcdnDataTime+=_.a.now()-this._pcdnFragStartTs,this._pcdnFragStartTs=_.a.now())}else this.statVod.addCore(d.a.CORE.CDN_TOTAL_BW,t.byteLength),this.stat.addCore(d.a.CORE.CDN_TOTAL_BW,t.byteLength),this._cdnFragStartTs>0&&(this._getCdnDataTime+=_.a.now()-this._cdnFragStartTs,this._cdnFragStartTs=_.a.now())}statBackupPcdnState(t){let e=this.playlist.currFrag;if(!e||!t)return;let i="";o.a.vodUseBackupField[2]&&this.statVod.setCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD3,String(o.a.vodUseBackupField[6])),e.pcdnStatus===nn.OPEN_BUFFER_NOT_REACHED?(o.a.vodUseBackupField[0]&&this.statVod.addKeyvalCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD1,"".concat(e.pcdnStatusBk1,":").concat(t.byteLength)),i=0===o.a.vodUseBackupField[6]&&e.pcdnStatusBk1):e.pcdnStatus===nn.BUFFER_LACK_TO_CDN&&(o.a.vodUseBackupField[1]&&this.statVod.addKeyvalCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD2,"".concat(e.pcdnStatusBk2,":").concat(t.byteLength)),i=1===o.a.vodUseBackupField[6]&&e.pcdnStatusBk2);const s=0===o.a.vodUseBackupField[6]?nn.REALTIME_OVER_RUN:nn.NOT_SEND_REQ;if(i)switch(i){case nn.PCDN_REALTIME:case nn.PCDN_FREETIME:o.a.vodUseBackupField[3]&&this.statVod.addCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD4,t.byteLength);break;case nn.REALTIME_NOT_REACHED:o.a.vodUseBackupField[4]&&this.statVod.addCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD5,t.byteLength);break;case s:o.a.vodUseBackupField[5]&&this.statVod.addCoreDim(d.a.VOD_DIM_COM.BACKUP_FIELD6,t.byteLength)}}bufferedInfo(t,e){let i,s,r,a,o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,h=[],d=[];for(o=0;o<e.length;o++)h.push({start:e.start(o),end:e.end(o)});for(h.sort((t,e)=>{return t.start-e.start||e.end-t.end}),o=0;o<h.length;o++){let t=d.length;if(t){let e=d[t-1].end;h[o].start-e<n?h[o].end>e&&(d[t-1].end=h[o].end):d.push(h[o])}else d.push(h[o])}for(o=0,i=0,s=r=t;o<d.length;o++){let e=d[o].start,h=d[o].end;if(t+n>=e&&t<h)s=e,r=h,i=r-t;else if(t+n<e){a=e;break}}return{len:i,start:s,end:r,nextStart:a}}checkCatonError(){if(this.playerCoreType!=N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.mse&&this.mse.getBufferLen&&this.mse.getBufferLen()>8e3&&!this.mse.video.paused&&Math.floor(this.mse.getCurrentTime()/1e3)<5){if(Math.floor(this.lastPlayTs)==Math.floor(this.mse.getCurrentTime()/1e3)&&this.pauseInBufferFullTimes++,this.playTriggered)return;if(this.pauseInBufferFullTimes>=5){let t=this.playlist.getNearFragStart(this.lastPlayTs+1);n.a.log("HlsPlayer.checkCatonError, seek"),this.seek(t),this.pauseInBufferFullTimes=0}}}fixedByBuffered(){if(this.isLive&&this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE)return;const t=this.mse&&this.mse.video&&this.mse.video.video,e=this.playlist&&this.playlist.currFrag&&this.playlist.currFrag.duration;if(t&&e)for(let i=0;i<t.buffered.length;i++){const s=t.buffered.start(i);if(i>=1&&t.buffered.end(i-1)-t.currentTime<=1&&s>t.currentTime&&s<=t.currentTime+e){n.a.log("%cHlsPlayer.fixedByBuffered currentTime=".concat(t.currentTime," fixed time=").concat(s),"color:#A23400;background:#FFF5C2"),t.currentTime=s;break}}}onCheckTimer(t,e){if(this.anticode.onCheckTimer(t,e),this.avgSpeed.calculate(),this.started&&this.mse&&!this.needReset&&this.mse&&!this.mse.userPaused){if(this.mse&&this.mse.onCheckTimer(t,e),this.playlist&&this.playlist.onCheckTimer(e),this.playTs>0){let i=t-this.pauseTs;this.playStat&&(this.pauseTs>0&&i>200&&!this.skipStatForSeek&&0==this.pauseCnt&&(this.playStat.setPause(),P.addBadQuality(this.stat)),this.pauseCnt>0&&(this.pauseCnt=0,this.playStat.setPause()),e%20==0&&this.playStat.report()),this.pauseTs>0&&i>o.a.vodRetryTime&&(n.a.warn("HlsPlayer.onCheckTimer pauseTime=".concat(i,", bufferLen=").concat(this.getBufferLen())),this.isLive||(this.triggerH5PlayError(),this.pauseTs=0))}this.checkCatonError(),this.updateTime()}}onVideoTimeupdate(){this.updateTime()}updateTime(){const t=this.getCurrentTime(),e=this.getDurationTime();-1==f.a._printVodTimer&&n.a.log("HlsPlayer.PlayTimeUpdate",t,e),this.eventEmitter.trigger(u.PLAY_TIME_STATUS,{current:t,total:e}),this.eventEmitter.trigger(u.PLAY_FRAME_BUFFER,{frameStorage:this.mse&&this.mse.getFrameReadyed(),jitterBuffer:this.mse&&this.mse.getBufferLen()})}onCheckFastTimer(t,e){if(this.needReset)return 0===this.resetPlayTs&&(this.resetPlayTs=t+this.mse.getBufferLen()-500),void((this.mse&&this.mse.getBufferLen()<500||t>this.resetPlayTs)&&(this.reloadInError(),this.needReset=!1,this.resetPlayTs=0));if(!this.started||!this.mse||this.mse.userPaused)return;let i=this.getBufferLen(),s=this.playlist.currFrag;-1===Number(f.a._print_pcdn_buf)&&n.a.log("%cHlsPlayer.onCheckTimer isPcdn=".concat(s.isPcdn," sn=").concat(s.sn," bufferlen=").concat(this.getBufferLen()," forceUseCdn=").concat(this.forceUseCdn),"color:green"),s.isPcdn&&i<o.a.vodPcdnCloseBuffer&&!this.forceUseCdn?(n.a.log("%cHlsPlayer.onCheckTimer: pcdn close","color:#A23400;background:#FFF5C2"),this.fragLoader.abort(),this.forceUseCdn=!0,this.isLoading=!1,this.errorPcdnSN=s.sn,this.needStatPcdnRepeatBW=!0,s.pcdnStatusBk2=s.pcdnStatus,s.pcdnStatus=nn.BUFFER_LACK_TO_CDN,this.loadFragment(!0),this.statVod.addCore(d.a.CORE.GET_STREAM_LOW_DATA_CNT,1),X.once(this.onCheckIfCanPCDN,this,o.a.vodPcdnCoolTime)):this.loadFragment(),this.mse&&this.mse.onCheckFastTimer(t,e);let r=t-this.pauseTs;if(this.pauseTs>0&&r>200&&this.fixedByBuffered(),this.info&&this.info.type===w.PLAYBACK&&this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE){let t=this.getBufferLen();if(this.pauseTs>0&&r>=1e3&&t>2e3){let t=this.mse.video.video;t.currentTime+=1,n.a.log("HlsPlayer.onCheckFastTimer.playback pauseTime=".concat(r,", currentTime + 1, currentTime=").concat(t.currentTime)),this.play()}}this._isEnded()&&3===Number(this.liveType)&&(n.a.log("HlsPlayer.check onEnded, curTime=".concat(this.getCurrentTime(),", duration=").concat(this.getFixedDurationTime())),this.onEnded())}onCheckIfCanPCDN(t,e){n.a.log("%cHlsPlayer.onCheckIfCanPCDN: pcdn open","color:#A23400;background:#FFF5C2"),this.forceUseCdn=!1,X.remove(this.onCheckIfCanPCDN,this)}sendNoPicture(t){this._sendVideoLoadTime(t),this._sendVideoNoPictureAll()}_sendVideoNoPictureAll(){if(this.isLive&&!this.hasPicture){const t=99999,e=this.getCostTimes();let i=e[0],s=e[2];this.tsdb.sendNoPictureTimeAll(t,i,s,"hls","","")}}_sendVideoLoadTime(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.videoLoadTimeSent||this.isLive)return;this.videoLoadTimeSent=!0,t=t||_.a.now()-this.startTs,this.isLive||this.statVod.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,t);let e=this.videoLoadTime,i=this.loadM3u8Time,s=this.firstFragLoadTime,r=this.firstFragLoadedTime,a=this.firstFragParsedTime;if(!this.hasPicture){e=99999;const t=this.getCostTimes();i=t[0],s=t[1],r=t[2],a=t[3]}let o=0;this.mse&&(o=this.mse.isMediaSourceOpen?1:2);const h=R.b.getBrowserHidden();h&&2==o?n.a.log("HlsPlayer._sendVideoLoadTime browserHidden=".concat(h,", isMediaSourceOpen=").concat(o)):(99999===e?(P.addVodFail(this.url),this.tsdb.autoReport()):P.delVodFail(this.url),this.tsdb.sendVodHlsTime({loadType:this._loaderType,loadTime:e,loadM3u8Time:i,firstFragLoadTs:s,firstFragLoadedTs:r,firstFragParsedTs:a,firstFragSize:this.firstFragSize,businessCost:this.businessLoadTime,UICost:this.uiLoadTime,playTs:this.playTs,startTs:this.startTs,m3u8Status:this.playlist.loadM3u8HttpCode,firstTsStatus:this.firstTsHttpCode,costTimes:this.vodSecHelper.getCostTimes()}))}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(u.PLAY_STATUS,{status:t}))}cacheBlockReason(t,e){this.blockHelper.cacheBlockReason(t,e)}resetHeartTsTime(){this.heartTsStartTime=0,this.heartTsEndTime=0}onStartVideo(){this.loadStartTs=_.a.now()}onPlayVideo(t,e,i,s,r,a,o){this.isLive&&P.delFail(this.stat);let h=_.a.now();this.pauseTs=0,this.playTs=h,this.hasVideo=s,this.vodSecHelper.setPlayTs(),0!==this.startTs&&(this.videoLoadTime=h-this.startTs,this.loadM3u8Time=this.playlist.manifestLoadedTs-this.startTs,this.firstFragLoadTime=this.firstFragLoadTs-this.playlist.manifestLoadedTs,this.firstTsInfo&&(this.firstFragLoadTime=this.firstFragLoadTs-this.startTs),this.firstFragLoadedTime=this.firstFragLoadedTs-this.firstFragLoadTs,this.firstFragParsedTime=h-this.firstFragLoadedTs,this.uiLoadTime=this.UIStartCost>0?this.videoLoadTime+this.UIStartCost:0,this.businessLoadTime=0,this.startTimeStamp>1?this.businessLoadTime=this.videoLoadTime+this.businessStartCost:1===this.startTimeStamp&&(this.businessLoadTime=h-this.loadStartTs),this.tsdb.sendHlsTime(this._loaderType,this.videoLoadTime,this.loadM3u8Time,this.firstFragLoadTime,this.firstFragLoadedTime,this.firstFragSize,this.businessLoadTime,this.uiLoadTime,this.firstFragParsedTime,this.vodSecHelper.getCostTimes()),!this.isLive&&!this.videoLoadTimeSent&&this.videoLoadTime<=1e4&&this._sendVideoLoadTime(),n.a.log("%cHlsPlayer.onPlayVideo loadTime="+this.videoLoadTime,"color:#A23400;background:#FFF5C2")),this.seeking=!1,this.skipStatForSeek=!1,this.playTriggered=!0,!this.pausedByBrowser&&this.updateStatus(p.VIDEO_PLAYING),this.codecType=o;let d={video:t,width:e,height:i,canvas:r,codec:o};this.eventEmitter.trigger(u.VIDEO_PLAY,d),n.a.log("HlsPlayer.onPlayVideo playInfo",d),!this.isLive&&this.loadVodPcdnProxy(),this.playlist.fragHelper.isM4s()&&fn.isCloseCore(this.info.curBitrate,ct())&&this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{video:t,code:1e3,msg:"配置关闭av1"})}onVideoStop(t,e){n.a.log("HlsPlayer.onVideoStop hasVideo="+e),this.hasVideo=!1,e&&(this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.VIDEO_STOP,{video:t}))}onAnchorStop(){let t=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(u.ANCHOR_STOP,{video:t})}onEnded(){this.started=!1,this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.M3U8_PLAY_ENDED),this.h265Proxy&&this.h265Proxy.onEnded&&this.h265Proxy.onEnded(),this.mse&&this.mse.onEnded&&this.mse.onEnded()}onLoadM3u8Error(t){const e=t&&t.currentTarget&&t.currentTarget.status;404!==e&&0!==e||this.isLive||this.videoLoadTimeSent||(!this.hasPicture&&this.addNoPictureReason&&this.addNoPictureReason(),this._sendVideoLoadTime()),this.eventEmitter.trigger(u.HLS_URL_UNAVAILABLE)}onLoadManifestTimeout(){this.eventEmitter.trigger(u.HLS_MAINFEST_LOAD_TIMEOUT)}onConnectManifestTimeout(){this.eventEmitter.trigger(u.HLS_URL_LOAD_TIMEOUT)}onPlayerError(t){this.videoElement}triggerH5PlayError(){if(this.info.type===w.PLAYBACK)return;let t=this.getCurrentTime();n.a.log("HlsPlayer.triggerH5PlayError seekTime = ".concat(t)),this.info&&(this.eventEmitter.trigger(u.PAUSE_5S_RETRY),this.info.seekTime=t+1,this.start(this.info))}onErrorEvent(t){const e=this.playlist&&this.playlist.currFrag;e&&e.isFirstLoad&&T.getFirstFragStatus()===S&&T.setFirstFragStatus(-3);let i=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{video:i,code:t.type,msg:"播放错误"}),this.setLoadStatus(N.a.LoadVideoTimeoutReason.HLS_PLAY_ERROR)}decoderDecodeError(){n.a.log("HlsPlayer.decoderDecodeError")}onPlayPause(t,e,i){if(!e)return;if(this.pauseTs=t,this.updateStatus(p.VIDEO_CACHING),this.blockHelper.checkVodBlock(),!this.playlist||this.isLive)return;let s=1e3*this.playlist.totalDuration,r=this.mse?this.mse.getCurrentTime()/1e3:0;s>0&&r>0&&Math.abs(s-r)<1e3&&this.isLive&&(n.a.warn("HlsPlayer detect anchor stop."),this.onAnchorStop(),this.stop()),this.startSendPauseTimer()}onPlayResume(t,e){if(this.pauseTs>0){let e=t-this.pauseTs,i=200;this.playBackRate<1&&this.playBackRate>0&&(i=Math.min(400,200*~~(1/this.playBackRate))),e>200&&!this.skipStatForSeek&&(f.a[g.AUTO_VIEW_LOG]=1,n.a.warn("HlsPlayer.onPlayResume pauseTime=".concat(e,", pauseDelta=").concat(i)),this.pauseCnt++,"hidden"!==this.stat.getComDim(d.a.DIM_COM.VISIBILITY_STATE)&&(this.stat.addCore(d.a.DIM_CORE.V_BAD_FRONT,1),this.isLive||this.statVod.addCore(d.a.VOD_CORE.V_BAD_FRONT,1)),this.stat.addCore(d.a.CORE.VIDEO_BLOCK_COUNT,1),this.stat.addCore(d.a.CORE.VIDEO_BLOCK_DURATION,e),this.isLive||(this.statVod.addCore(d.a.VOD_CORE.VOD_BLOCK_COUNT,1),this.statVod.addCore(d.a.VOD_CORE.VOD_BLOCK_DURATION,e),P.addBadQualityVod(this.url)),this.eventEmitter.trigger(u.VIDEO_BAD_QUALITY)),this.pauseTs=0}this.skipStatForSeek=this.seeking,e&&(this.updateStatus(p.VIDEO_PLAYING),this.eventEmitter.trigger(u.VIDEO_PLAYING,{video:this.videoElement,event:event}))}onVideoSeek(t){if(!this.started)return;n.a.log("HlsPlayer.onVideoSeek",t),this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS&&(this.hlsSeek._seekTime=0),this.seeking=!1,this.seekTime=0;let e=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(u.VIDEO_SEEK,{video:e,currentTime:t}),this.h265Proxy&&this.h265Proxy.onVideoSeek&&this.h265Proxy.onVideoSeek(t)}onPauseByBrowser(){window&&(n.a.warn("HlsPlayer.onPauseBrowser: video was paused by browser, define click listener"),window.removeEventListener("click",this._clickEventBind,!0),window.addEventListener("click",this._clickEventBind,!0),this.pausedByBrowser=!0)}_clickEvent(){if(document){n.a.log("HlsPlayer._clickEvent: click for play a temp video");let t=document.createElement("video").play();t&&t.catch(t=>{n.a.log("HlsPlayer._clickEvent err=".concat(t.message))}),this.pausedByBrowser=!1,window&&window.removeEventListener("click",this._clickEventBind,!0)}}startSendPauseTimer(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}stopSendPauseTimer(){clearTimeout(this.sendPauseTimeout)}sendPauseEvent(){this.videoStatus!==p.VIDEO_PLAYING&&this.eventEmitter&&this.eventEmitter.trigger(u.PLAY_CARTON)}get isPlaying(){return this.videoStatus!==p.VIDEO_STOP&&this.videoStatus!==p.VIDEO_INIT&&this.videoStatus!==p.VIDEO_LOADING}get hasPicture(){return this.videoLoadTime>0}getCostTimes(){if(!this.playlist)return[0,0,0,0,-1,0,0];let t=this.playlist.manifestLoadedTs>0?this.playlist.manifestLoadedTs-this.startTs:0,e=this.firstFragLoadedTs>0?this.firstFragLoadTs-this.playlist.manifestLoadedTs:0;return this.firstTsInfo&&(e=this.firstFragLoadedTs>0?this.firstFragLoadTs-this.startTs:0),[t,e,this.firstFragLoadedTs>0?this.firstFragLoadedTs-this.firstFragLoadTs:0,this.playTs&&this.firstFragLoadedTs>0?this.playTs-this.firstFragLoadedTs:0,this.playlist.loadM3u8HttpCode,this.firstTsHttpCode,this.startTs,this.playTs]}switchLevel(t){let e=this.playlist.levels,i=t.curBitRate;if(e.length>0&&this.playlist.isMasterPlayList){for(let t=0;t<e.length;t++)if(e[t].bitrate===i&&this.playlist.currLevel.bitrate!=i){this.playlist.currLevel.bitrate=i,this.playlist.currLevelId=t,this.playlist.currLevel.url=e[t].url,this.mse.parser.switchLevel(),this.play();break}}else this.playlist.currLevel.url=t.url,this.playlist.currLevel.bitrate=i,this.mse.parser.switchLevel(),this.play()}turnToH264(t){const e=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(u.TURN_TO_H264,{seekTime:e,reason:t})}h265Retry(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(u.H265_VIDEO_RETRY,{seekTime:t})}containerResize(t){this.h265Proxy&&this.h265Proxy.containerResize&&this.h265Proxy.containerResize(t)}_ptsJumpTest(){1===Number(f.a.ptsJumpTest)&&(qr.ptsJumpTest=!0)}getCodecType(){return this.codecType}getVideoWidth(){return this.isAv1State?this.videoElement&&this.videoElement.videoWidth:this.mse.getMseAvcCfgWidth()}getVideoHeight(){return this.isAv1State?this.videoElement&&this.videoElement.videoHeight:this.mse.getMseAvcCfgHeight()}getFps(){if(this.isAv1State){if(this.mse&&this.mse.m4sPlayer&&this.mse.m4sPlayer.mp4){const t=this.mse.m4sPlayer.mp4.getVideoFps();return t>0?t:-100}return-100}return this.mse&&this.mse.parser&&this.mse.parser.getFps()}replaceProtocl(t){return t.replace(/^https?\:/,"https:")}setWebCodecsSuccess(){this.isWebcodecsPlaying=!0}setFrameRusume(){}setFramePause(){}renderFpsPause(){}getEnhanceStats(){return this.eventEmitter&&this.eventEmitter.getEnhanceStats&&this.eventEmitter.getEnhanceStats()}getDpi(){let t=0,e=0;return this.mse&&this.mse.getMseAvcCfgWidth&&(t=this.mse.getMseAvcCfgWidth()),this.mse&&this.mse.getMseAvcCfgHeight&&(e=this.mse.getMseAvcCfgHeight()),{width:t,height:e}}turnToWebcodecsSoft(){const t=this.getCurrentTime();this.stop(),R.b.isWebCodecsSupported()&&(n.a.log("HlsPlayer.turnToWebcodecsSoft"),this.eventEmitter.trigger(u.TURN_TO_WEBCODECS_SOFT,{seekTime:t}))}getRefreshRate(){return this.eventEmitter&&this.eventEmitter.getRefreshRate&&this.eventEmitter.getRefreshRate()}webcodecsRetry(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(u.WEBCODECS_RETRY,{seekTime:t})}turntoH265Wasm(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(u.TURN_TO_H265_WASM,{seekTime:t})}turnToMse(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(u.TURN_TO_MSE,{seekTime:t})}setUseSoftAcceleration(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isLive||this.statVod.setComDim(d.a.VOD_DIM_COM.DECODE_HARDWARE_ACCELERATION,t?1:0),this.stat.setComDim(d.a.DIM_COM.DECODE_HARDWARE_ACCELERATION,t?1:0)}setEnhance(t){this.mse&&this.mse.setEnhance&&this.mse.setEnhance(t)}onVideoEnhanceSuccess(){this.eventEmitter&&this.eventEmitter.trigger(u.ON_VIDEO_ENHANCE_SUCCESS)}onVideoEnhanceError(t){this.eventEmitter&&this.eventEmitter.trigger(u.ON_VIDEO_ENHANCE_ERROR,t)}isNotSupportWebcodecsConfigure(){let t="avc1.42E01E",e="h264";this.isAv1State?(t="av01.0.08M.08",e="av1"):this.isH265&&(t="hvc1.1.6.L93",e="h265");const i=this.mse;"h265"!=e&&"h264"!=e&&"av1"!=e||"undefined"!=typeof VideoDecoder&&VideoDecoder.isConfigSupported({codec:t}).then(t=>{n.a.log("HlsPlayer.isConfigSupported",t,e),t.supported?"h265"==e?f.a.isCloseWebcodecsH265=0:"h264"==e?f.a.isCloseWebcodecsH264=0:"av1"==e&&(f.a.isCloseWebcodecsAv1=0):("h265"==e?f.a.isCloseWebcodecsH265=1:"h264"==e?f.a.isCloseWebcodecsH264=1:"av1"==e&&(f.a.isCloseWebcodecsAv1=1),i&&i.isNotSupportWebcodecsConfig&&i.isNotSupportWebcodecsConfig())}).catch(t=>{n.a.log("HlsPlayer.isConfigSupported.catch",t.message)})}setDisableHardAcc(){const t=this.mse;t&&t.setDisableHardAcc&&t.setDisableHardAcc()}win7PerfInsufficient(){const t=this.mse;t&&t.win7PerfInsufficient&&t.win7PerfInsufficient()}angelNullError(){const t=this.mse;t&&t.angelNullError&&t.angelNullError()}chromeH265RenderEmptyError(){const t=this.mse;t&&t.chromeH265RenderEmptyError&&t.chromeH265RenderEmptyError()}onMseHevcError(){this.info&&!this.info.h265Url&&(this.info.h265Url=this.info.url),n.a.log("HlsPlayer.onMseHevcError"),this.turntoH265Wasm&&this.turntoH265Wasm()}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playBackRate=t,n.a.log("HlsPlayer.setPlaybackRate",t),this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.getPlayVideo?this.mse.getPlayVideo().playbackRate=Number(t):this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS&&this.mse.setPlaybackRate(t)}get isWebCodec(){return this.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS}},yn=class{constructor(t,e){this.handler=t,this.connected=!1,this.startTs=0,this.playing=!1,this.loadTime=0,this.connectTime=0,this.players=[],this.libURL=e,this.libLoaded=!1,this.flacURL="",this.playInfo=null,this.anticode=new Gi,this.playUrlBind=this.playUrl.bind(this),this.refreshAnticodeBind=this.refreshAnticode.bind(this),this.anticode.on(Gi.Events.REFRESH,this.refreshAnticodeBind)}loadFlacLib(t){var e=document.createElement("script");e.type="text/javaScript",e.onload=this.flacLibLoaded.bind(this),e.src=t,document.getElementsByTagName("head")[0].appendChild(e)}flacLibLoaded(){n.a.log("flaclib complete"),this.libLoaded=!0,this.play(this.playInfo)}isPlaying(){return this.playing}getLoger(){return n.a}play(t){t&&(this.playInfo=t),this.libLoaded?this.checkParams(this.playInfo,this.playUrlBind):this.loadFlacLib(this.libURL)}playUrl(t,e){this.initInfo(t,e);const i=new class{constructor(t){this.sampleController=t.handler.sampleController,this.flacPlayer=new FlacPlayer(t,this.sampleController.realFlacSample),this.flacPlayer.setLogger(n.a),this.flacPlayer.uuid=v.a.uuid}setVolume(t){this.flacPlayer.setVolume(t)}stop(){this.flacPlayer.stop(),this.sampleController=null}onHeader(t){this.flacPlayer.onHeader&&this.flacPlayer.onHeader(t)}onConnected(){this.flacPlayer.onConnected&&this.flacPlayer.onConnected()}onClosed(){this.flacPlayer.onClosed&&this.flacPlayer.onClosed()}onLoadError(){this.flacPlayer.onLoadError&&this.flacPlayer.onLoadError()}onData(t){this.sampleController.addTotalSample(t.byteLength),this.flacPlayer.onData&&this.flacPlayer.onData(t)}onLoadTimeout(){this.flacPlayer.onLoadTimeout&&this.flacPlayer.onLoadTimeout()}requestUrl(){this.flacPlayer.requestUrl&&this.flacPlayer.requestUrl()}}(this),s=new xe(i),r={player:i,loader:s};this.players.push(r),s.connect(this.flacURL),X.add(this.onCheckTimer,this,1e3)}checkParams(t,e){n.a.log("FlacPlayer.checkParams",JSON.stringify(t)),t.sFlvUrl&&t.sStreamName?(t.sFlvUrl=t.sFlvUrl.replace("http://","https://"),this.initDomain(t),t.sFlvAntiCode?(this.anticode.init(t.sFlvUrl,t.sStreamName,t.sFlvAntiCode),this.anticode.valid().then(()=>{e(t)})):e(t)):t.url?e(t):n.a.error("FlacPlayer.checkParams has no params(sFlvUrl, sStreamName, url)")}_getUrlParams(t,e){let i="";e&&(i+="pulltype=pcdn&");const s=o.a.platform,r=N.a.PLATFORM_TYPE[s]||N.a.PLATFORM_TYPE.web,a=s===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);return i+="".concat(a,"&t=").concat(r),i=Utils.urlInfoParams(i,this.playInfo),-1===t.indexOf("?")?t+="?":t+="&",t+i}initDomain(t){if(t.inited)return;t.inited=!0;let e=t.domainList;if(e&&e.length){let i=t.sFlvUrl.match(/\/\/(.+?)\//i);t._domain=i?i[1]:"",n.a.log("FlvPlayer.initDomain:\n\t"+e.join("\n\t"));let s=e.shift();t.sFlvUrl=t.sFlvUrl.replace(/\/\/(.+?)\//,"//"+s+"/"+t._domain+"/")}}initInfo(t,e){this.playInfo=t,t.sFlvUrl&&t.sStreamName&&(t.url="".concat(t.sFlvUrl,"/").concat(t.sStreamName,"_audio.flv"));let i=[];this.anticode.hasAnticode()&&i.push(this.anticode.getAnticode(e)),t.bitrate>0?i.push("ratio=".concat(t.bitrate)):f.a._ratio&&i.push("&ratio=".concat(f.a._ratio)),-1===t.url.indexOf("va.huya.com")&&-1===t.url.indexOf("cdnweb.huya.com")&&-1===t.url.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(t.url+=(-1!==t.url.indexOf("?")?"&":"?")+"".concat(i.join("&")));const s=this._getUrlParams(t.url,!1);this.flacURL=s}onCheckTimer(t,e){this.anticode.onCheckTimer(t,e)}refreshAnticode(){this.initInfo(this.playInfo)}setVolume(t){for(var e=0;e<this.players.length;e++)this.players[e].player.setVolume(110*t)}getCurrentTime(){return this.handler?Math.floor(this.handler.getCurrentTime()):0}playerFlacError(t){n.a.log("playerFlacError error:"+t),this.isPlaying()&&(this.playing=!1,this.handler.flacPlayStatusChange(),this.handler.trigger(u.FLAC_AUDIO_ERROR))}onstartplay(){this.isPlaying()||(this.playing=!0,setTimeout(function(){this.isPlaying()&&(this.handler.trigger(u.FLAC_AUDIO_START),this.handler.flacPlayStatusChange())}.bind(this),1e3))}onClosed(){this.reset()}stop(){this.reset(),this.handler.flacPlayStatusChange()}reset(){this.connected=!1,this.startTs=0,this.playing=!1;for(var t=0;t<this.players.length;t++){let e=this.players[t].player,i=this.players[t].loader;e&&(e.stop(),e=null),i&&(i.close(),i=null)}this.players=[],this.playInfo=null,this.anticode.off(Gi.Events.REFRESH,this.refreshAnticodeBind),X.remove(this.onCheckTimer,this)}},Tn=class{constructor(){this._ignoreMap=new Map,this._ignoreDefault=!1,this.initLv()}destroy(){this._ignoreMap&&(this._ignoreMap.clear(),this._ignoreMap=null)}addStreamUrl(t,e){let i=o.a.statLv;R.b.isOpen(o.a.statCfg,t,e,!1)&&i[2]>0&&this._ignoreMap.set(d.a.DIM_COM.STREAM_URL,1)}initLv(t,e){this._ignoreDefault=!1,this._ignoreMap.clear();let i=o.a.statLv,s=R.b.isOpen(o.a.statCfg,t,e,!1);if(n.a.log("StatFilter.init isOpen=".concat(s," statLv=").concat(i)),s){this._ignoreDefault=1===i[0];let t=this._ignoreMap;t.clear(),i[1]>0&&(t.set(d.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,1),t.set(d.a.DIM_COM.P2P_COOL_FLAG,1),t.set(d.a.DIM_COM.ACT_LOAD_TYPE,1)),i[2]>0&&(i[2]>1&&t.set(d.a.DIM_COM.STREAM,1),t.set(d.a.DIM_COM.CDP_ID,1)),i[3]>0&&(i[3]>1&&(t.set(d.a.DIM_COM.V_RECV_FRAMES,1),t.set(d.a.DIM_COM.V_RECV_FRAME,1),t.set(d.a.DIM_COM.V_PLAY_FRAME,1),t.set(d.a.DIM_COM.V_TO_PLAY_FRAME,1),t.set(d.a.DIM_COM.VISIBILITY_STATE,1)),t.set(d.a.DIM_COM.VIDEO_PAUSE_BUFFERS,1),t.set(d.a.DIM_COM.VIDEO_PAUSE_CONTINUE_BUFFERS,1),t.set(d.a.DIM_LINK_STA.name,1),t.set(d.a.DIM_LINK_SAM.name,1),t.set(d.a.FRAME_INFO.name,1)),i[4]>0&&t.set(d.a.AI_CONTROL_DATA.name,1),i[5]>0&&(i[5]>1&&(t.set(d.a.SUB_INFO.name,1),t.set(d.a.PUNCH_INFO.name,1)),t.set(d.a.CORE.FORWARD_REJECT_CNT,1),t.set(d.a.DIM_COM.SUB_CHANGE_STATE,1),t.set(d.a.UPDOWN_INFO.name,1),t.set(d.a.PUNCH_BACK_RET.name,1),t.set(d.a.SUBSTREAM_INFO.name,1),t.set(d.a.FORCESUB_REASON.name,1),t.set(d.a.SUB_RETURN.name,1),t.set(d.a.NONODE_RETURN.name,1),t.set(d.a.P2P_TCP_TYPE.name,1),t.set(d.a.P2P_TCP_STATE.name,1)),i[6]>0&&(t.set(d.a.DIM_COM.BROWSER_NAME,1),t.set(d.a.DIM_COM.BROWSER_VERSION,1),t.set(d.a.DIM_COM.BROWSER_KERNEL,1),t.set(d.a.DIM_COM.BROWSER_KERNEL_VERSION,1),t.set(d.a.DIM_COM.OS_NAME,1),t.set(d.a.DIM_COM.OS_VERSION,1),t.set(d.a.DIM_COM.RENDER_INFO,1)),i[7]>0&&(t.set(d.a.DIM_COM.STREAM_INDEX,1),t.set(d.a.DIM_COM.OBS_RENDER_MODE,1),t.set(d.a.CORE.OBS_FPS,1),t.set(d.a.CORE.OBS_UPLOAD_TS,1)),i[8]>0&&(t.set(d.a.DIM_COM.VR_ENABLE,1),t.set(d.a.DIM_COM.VR_MODE,1)),i[9]>0&&(t.set(d.a.DIM_COM.CDN_CIP,1),t.set(d.a.DIM_COM.CDN_SIP,1),t.set(d.a.DIM_COM.ALT_SVC,1),t.set(d.a.DIM_COM.QUIC,1)),i[10]>0&&(i[10]>3&&(t.set("pcdn_hot_degree_in",1),t.set("pcdn_hot_degree_kick",1),t.set("pcdn_hot_degree",1),t.set("get_pcdn_url_result",1),t.set(d.a.DIM_COM.CLI_ISP,1),t.set(d.a.DIM_COM.CLI_PROV,1),t.set(d.a.DIM_COM.PCDN_SVR_ISP,1),t.set(d.a.DIM_COM.PCDN_SVR_AREA,1)),i[10]>2&&(t.set(d.a.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),t.set(d.a.PCDN_DATA.GET_PCDN_URL_SUCCESS,1),t.set(d.a.PCDN_DATA.GET_PCDN_URL_SUC_FREETIME,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERR_NOT_REACHED,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN_FREETIME,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERR_NOT_COVERD,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERR_OTHER,1),t.set(d.a.PCDN_DATA.GET_PCDN_ERROR_REQ,1),t.set(d.a.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),t.set(d.a.PCDN_DATA.GET_PCDN_DATA_TIME,1),t.set(d.a.PCDN_DATA.GET_PCDN_DATA_TIME_CNT,1),t.set(d.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME,1),t.set(d.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME_CNT,1),t.set(d.a.PCDN_DATA.GET_CDN_DATA_TIME,1),t.set(d.a.PCDN_DATA.GET_CDN_DATA_TIME_CNT,1)),i[10]>1&&(t.set(d.a.DIM_COM.SUB_PCDN_STATE,1),t.set(d.a.DIM_COM.FLV_PCDN_STATE,1)),t.set("pcdn_pull_stream_user_cnt",1),t.set("pcdn_get_proxy_user_cnt",1),t.set(d.a.PCDN_BW_DATA.name,1)),i[11]>0&&(i[11]>1&&(t.set(d.a.CORE.REAL_KBPS_SAMPLE,1),t.set(d.a.CORE.REAL_FLAC_KBPS_SAMPLE,1),t.set(d.a.CORE.RECV_TOTAL_SAMPLE,1),t.set(d.a.CORE.RECV_LAN_SAMPLE,1)),t.set(d.a.DIM_COM.AUTO_U_REASON,1),t.set(d.a.DIM_COM.AUTO_D_REASON,1),t.set(d.a.DIM_COM.AUTO_HEART_TYPE,1),t.set(d.a.DIM_COM.AUTO_CODEC_CHANGE_TYPE,1),t.set(d.a.DIM_COM.AUTO_BAD_REASON,1),t.set(d.a.DIM_COM.AUTO_BAD_MIN_REASON,1),t.set(d.a.CORE.AUTO_SWITCH_CNT,1),t.set(d.a.CORE.AUTO_SWITCH_SAME_CNT,1),t.set(d.a.CORE.AUTO_BAD_QUALITY,1),t.set(d.a.CORE.AUTO_BAD_QUALITY_UP,1),t.set(d.a.CORE.AUTO_BAD_DURATION,1),t.set(d.a.CORE.AUTO_BAD_DURATION_UP,1),t.set(d.a.CORE.AUTO_BAD_SWITCH,1),t.set(d.a.CORE.AUTO_BAD_SWITCH_SAME,1),t.set(d.a.CORE.AUTO_BAD_SWITCH_UP,1),t.set(d.a.CORE.AUTO_BAD_DONE,1),t.set(d.a.CORE.AUTO_BAD_BUFFER,1),t.set(d.a.CORE.AUTO_CONTINUE_BUFFER,1),t.set(d.a.AUTO_INFO.name,1)),1===i[12]&&(t.set(d.a.CORE.SVR_DELAY_INFOS,1),t.set(d.a.CORE.DELAY_NODE_INFO,1),t.set(d.a.CORE.SVR_LAST_P_DELAY,1)),1===i[13]&&t.set(d.a.HLS_INFO.name,1),i[14],1===i[16]&&(t.set(d.a.VIDEO_LINK.PVSSC,1),t.set(d.a.VIDEO_LINK.PVFSC,1),t.set(d.a.VIDEO_LINK.PVLSC,1),t.set(d.a.VIDEO_LINK.PVLFC,1),t.set(d.a.VIDEO_LINK.PVPFC,1),t.set(d.a.VIDEO_LINK.PVPTC,1),t.set(d.a.VIDEO_LINK.PVPAFC,1),t.set(d.a.VIDEO_LINK.PVRFC,1))}}checkFilter(t){t.forEach(t=>{this.filterObj(t.vField),this.filterObj(t.vDimension),this.filterObj(t.vExLog)})}filterObj(t){let e=[];for(let i in t)(0===t[i]||""===t[i]&&this._ignoreDefault||this._ignoreMap.has(i))&&e.push(i);for(let i=0;i<e.length;i++)delete t[e[i]]}static fillterMetrics(t,e,i,s,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];if(1!==o.a.statIgnoreOpen)return;let n=[];t.forEach(t=>{-1!==t.sMetricName.indexOf("heart")?(s.forEach(e=>{-1===r.indexOf(e)&&(t.vField.hasOwnProperty(e)?delete t.vField[e]:t.vDimension.hasOwnProperty(e)&&delete t.vDimension[e])}),n.push(t)):-1!==t.sMetricName.indexOf("act")&&(-1!==e.indexOf(t.vDimension.act_type)&&-1===i.indexOf(t.vDimension.act_type)||n.push(t)),a.forEach(e=>{t.vField[e]=""})}),t.splice(0,t.length,...n)}};var Pn=class{constructor(){this.comDim=new Map,this.coreDim=new Map,this.actDim=new Map,this.extDim=new Map,this.comFormatMap=new Map,this.coreMap=new Map,this.compMap=new Map,this.keyvalCoreDimMap=new Map,this.heart_type=d.a.HEART_TYPE.START,this.recordTs=this.create_time=_.a.now(),this.filter=new Tn}destroy(){this.comDim&&(this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.comFormatMap.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.filter.destroy(),this.comDim=null,this.coreDim=null,this.actDim=null,this.extDim=null,this.comFormatMap=null,this.coreMap=null,this.compMap=null,this.keyvalCoreDimMap=null,this.filter=null)}startRecord(){this.recordTs=_.a.now()}checkFilter(t){this.filter.checkFilter(t),Tn.fillterMetrics(t,o.a.statIgnoreActsSdk,o.a.statHoldActsSdk,o.a.statIgnoreFieldsSdk,o.a.statHoldFieldsSdk)}setCreateTime(t){isNaN(t)||(this.create_time=t)}reset(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.heart_type=d.a.HEART_TYPE.START,this.create_time=_.a.now()}clearFill(){this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear()}createAct(t,e){return this._createAct(t,e)}createActs(t){let e=[];if(t)for(let i=0;i<t.length;i++){let s=t[i],r=this._createAct(s.type,s.params);e.push(r)}return e}_createAct(t,e){let i={sMetricName:d.a.ACT.name,vField:{},vDimension:{}};if(i.vDimension[d.a.ACT.field]=t,i.vDimension[d.a.DIM_CORE.CREATE_TIME]=_.a.now()-this.create_time,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),e){let t=0;if(e.hasOwnProperty(d.a.KEY_VALUE)){let s=e[d.a.KEY_VALUE];for(t=0;t<s.length;t++)i.vField[d.a.KEY_VALUE+(t+1)]=s[t]}if(e.hasOwnProperty(d.a.KEY_STR)){let s=e[d.a.KEY_STR];for(t=0;t<s.length;t++)i.vDimension[d.a.KEY_STR+(t+1)]=s[t]}e.hasOwnProperty(d.a.KEY_DIM)&&Object.assign(i.vDimension,e[d.a.KEY_DIM])}return i.vDimension.appid=v.a.appid,this.actDim.clear(),i}fill(t,e){e?(this.heart_type=d.a.HEART_TYPE.END,this._fill(t),this.heart_type=d.a.HEART_TYPE.START):this._fill(t)}fillAnticode(t){this.coreMap.set(d.a.CORE.HTD,_.a.now()-this.recordTs+1),this.heart_type=d.a.HEART_TYPE.START,this._fill(t)}_fill(t){if(0==this.coreMap.size&&0==this.compMap.size)return;let e={sMetricName:d.a.CORE.name,vField:{},vDimension:{},vExLog:{}},i=_.a.now();this.coreMap.set(d.a.CORE.HTD,i-this.recordTs),this.recordTs=i,this.coreDim.set(d.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(e.vDimension,this.comDim),this._fillFromMap(e.vDimension,this.coreDim),this._fillFromMap(e.vExLog,this.extDim),this._fillFromMap(e.vField,this.coreMap),this._fillComp(e.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type==d.a.HEART_TYPE.START&&(this.heart_type=d.a.HEART_TYPE.CONTINUS),e.vDimension.appid=v.a.appid,t.push(e)}_fillComp(t){for(let e of this.compMap.keys()){const i=this._getCompMapFormat(e),s=i.get("ref")||",",r=i.get("split")||";";let a=this.compMap.get(e),o="";for(let t of a.keys())o.length>0&&(o+=r),o+=t+s+a.get(t);t[e]=o}}_fillFromMap(t,e){for(let i of e.keys())t[i]=e.get(i)}_fillFromKeyvalMap(t,e){for(let i of e.keys()){const s=e.get(i),r=s.entries();let a="";for(let t=0;t<s.size;t++){const e=r.next().value;a+="".concat(e[0],":").concat(e[1]),t<s.size-1&&(a+=",")}s.clear(),t[i]=a}}getComDim(t){return this.comDim.get(t)}setComDim(t,e){this.comDim.set(t,e)}setCoreDim(t,e){this.coreDim.set(t,e)}addCoreDim(t,e){this._addValue(this.coreDim,t,e)}addKeyvalCoreDim(t,e){this._addKeyvalValue(this.keyvalCoreDimMap,t,e)}setActDim(t,e){this.actDim.set(t,e)}setExtDim(t,e){this.extDim.set(t,e)}delDim(t){this.comDim.has(t)?this.comDim.delete(t):this.coreDim.has(t)?this.coreDim.delete(t):this.actDim.has(t)&&this.actDim.delete(t)}setCore(t,e){this.coreMap.set(t,e)}addCore(t,e){this._addValue(this.coreMap,t,e)}setComp(t,e,i){this._getCompMap(t).set(e,i)}addComp(t,e,i){let s=this._getCompMap(t);this._addValue(s,e,i)}setCompFormat(t,e,i){const s=this._getCompMapFormat(t);s.set("ref",e),s.set("split",i)}_getCompMapFormat(t){if(this.comFormatMap.has(t))return this.comFormatMap.get(t);const e=new Map;return this.comFormatMap.set(t,e),e}_getCompMap(t){if(this.compMap.has(t))return this.compMap.get(t);let e=new Map;return this.compMap.set(t,e),e}_addValue(t,e,i){if(t.has(e)){let s=t.get(e);t.set(e,s+i)}else t.set(e,i)}_addKeyvalValue(t,e,i){if(t.has(e)){let s=t.get(e);const r=i.split(":");if(r.length<2)return;const a=r[0],o=Number(r[1]);if(s.has(a)){const t=s.get(a);s.set(a,t+o)}else s.set(a,o)}else{const s=i.split(":");if(s.length<2)return;let r=new Map;const a=s[0],o=Number(s[1]);r.set(a,o),t.set(e,r)}}},vn=class{constructor(){this.played=!1,this.audioMutedState=!1,this.playTime=300,this.volume=0,this.audio=null,this.audioLib="bi_44100_stereo_.wav",this.videoVolume=1,this.playerCheckTimer=0,this.muted=!1,this.root=""}setAudioMutedState(t){if(t){this.audio.src||(this.audio.src=this.root+"/"+this.audioLib),this.played=!0;let t=this.audio.play();n.a.log("MuteAudioBiPlayer.setAudioMutedState play ,visibilityState=".concat(document.visibilityState)),t?t.then(()=>{n.a.log("MuteAudioBiPlayer.setAudioMutedState audio play success")}).catch(t=>{n.a.log("MuteAudioBiPlayer.setAudioMutedState audio play error",JSON.stringify(t))}):n.a.log("MuteAudioBiPlayer.setAudioMutedState audio play error1",JSON.stringify(e)),this.audio.volume=this.muted?0:Math.min(this.volume,1),clearTimeout(this.playerCheckTimer),this.playerCheckTimer=setTimeout(this.playTimer.bind(this),50)}else this.played=!1,this.pauseAudio()}init(t){n.a.log("MuteAudioBiPlayer.init init audio root="+t),this.root=t,this.audio&&this.audio.pause(),this.audio=document.createElement("audio"),this.checkMacSafari()&&(this.audio.src=this.root+"/"+this.audioLib,this.audio.volume=0,this.audio.play()),this.audio.addEventListener("timeupdate",this.timeUpdateListener.bind(this)),n.a.log("MuteAudioBiPlayer.init init audio success")}checkMacSafari(){return"safari"==(h.a.name+"").toLowerCase()}updateRoot(t){}playTimer(){this.checkPlayFinish()||(this.playerCheckTimer=setTimeout(this.playTimer.bind(this),50))}pauseAudio(){this.audio&&(this.audio.currentTime=0,this.audio.volume=0,this.audio.pause(),clearTimeout(this.playerCheckTimer)),n.a.log("MuteAudioBiPlayer.pauseAudio")}checkPlayFinish(){return!!(this.audio&&this.audio.currentTime>=.3)&&(n.a.log("MuteAudioBiPlayer.checkPlayFinish"),this.pauseAudio(),!0)}timeUpdateListener(t){this.checkPlayFinish()}onPlayingListener(t){this.pauseAudio(),this.audio.removeEventListener("playing",this.onPlayingListener.bind(this))}setVideoVolume(t){this.videoVolume=t}setMuted(t){this.muted=t}setMuffled(t,e){n.a.log("MuteAudioBiPlayer.setMuffled start=".concat(t," muteStyle=").concat(e)),setTimeout(()=>{n.a.log("MuteAudioBiPlayer.setMuffled startPlay ,visibilityState=".concat(document.visibilityState)),this.audioMutedState!=t&&(this.audioMutedState=t,t&&e?(this.volume=this.videoVolume*(1+e.percent/100),this.setAudioMutedState(!0)):this.setAudioMutedState(!1))},100)}release(){this.pauseAudio()}destroy(){this.pauseAudio(),this.audio&&(this.audio.src="",this.audio.load())}},En=class extends Pn{constructor(){super()}_createAct(t,e){let i={sMetricName:d.a.VOD_ACT.name,vField:{},vDimension:{}};if(i.vDimension[d.a.ACT.field]=t,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),e){let t=0;if(e.hasOwnProperty(d.a.KEY_VALUE)){let s=e[d.a.KEY_VALUE];for(t=0;t<s.length;t++)0===t?i.vField[d.a.KEY_VALUE]=s[t]:i.vField[d.a.KEY_VALUE+t]=s[t]}if(e.hasOwnProperty(d.a.KEY_STR)){let s=e[d.a.KEY_STR];for(t=0;t<s.length;t++)i.vDimension[d.a.KEY_STR+(t+1)]=s[t]}e.hasOwnProperty(d.a.KEY_DIM)&&Object.assign(i.vDimension,e[d.a.KEY_DIM])}return i.vDimension.appid=v.a.appid,this.actDim.clear(),i}_fill(t){if(0==this.coreMap.size&&0==this.compMap.size)return;let e={sMetricName:d.a.VOD_CORE.name,vField:{},vDimension:{},vExLog:{}};this.coreDim.set(d.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(e.vDimension,this.comDim),this._fillFromMap(e.vDimension,this.coreDim),this._fillFromKeyvalMap(e.vDimension,this.keyvalCoreDimMap),this._fillFromMap(e.vExLog,this.extDim),this._fillFromMap(e.vField,this.coreMap),this._fillComp(e.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.heart_type==d.a.HEART_TYPE.START&&(this.heart_type=d.a.HEART_TYPE.CONTINUS),e.vDimension.appid=v.a.appid,t.push(e)}};class Cn extends at.EventEmitter{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(),this._tafLink=new tt.TafLinkSignalImpl(t,e,r)}get connected(){return r.connected}getRequestId(){return r.getRequestId()}resetVpRequest(){this.vpRequestId=0}setTafWup(t){this._tafLink.setTafWup(t)}getVoiceProxy(t){this._tafLink.getVoiceProxy(t)}on(t,e){return this._tafLink.on(t,e)}off(t,e){return this._tafLink.off(t,e)}addListener(t,e){return this._tafLink.addListener(t,e)}removeListener(t,e){return this._tafLink.removeListener(t,e)}}Cn.TAF_WUP_READY="TAF_WUP_READY";var In=Cn;class An{constructor(){this.framesReceived=0,this.framesDecoded=0,this.framesDropped=0,this.packetsReceived=0,this.packetsLost=0,this.keyFramesDecoded=0,this.totalRoundTripTime=0,this.nackCount=0}}var Dn=class{constructor(t){this.hyPlayer=t,this.video=null,this.mediaMgr=null,this.roomId=0,this.appid=v.a.appid,this.playerList=[],this.playerMap=new Map,this.playerStreamList=[],this.tafLinkSignal=new In(this),this.qaStat=new class{constructor(t){this.flvPlayer=t,this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat,this.data={act:"webhuyah5qa",uid:0,sid:0,subsid:0,linetype:-1,sendcnt:0,paucount:0,paulength:0,bflength:0,vr:0,httphead:"",rel:"jsscene",ref:location.href,isp2p:0},this.img=null,this.pausedCount=0,this.pausedTime=0,this.isPaused=!1,this.isFirstReport=!0}send(){}sendFlow(t){let e=[];this.stat.setCoreDim(d.a.DIM_CORE.USER_PROPERTY,this.getUserProperty()),this.stat.fill(e,!0),this.hyPlayer.tsdbUtil.sendMetrics(e)}getUserProperty(){let t=this.hyPlayer.tsdbUtil,e=0;return e=this.flvPlayer.getConfig(100)?this.flvPlayer.getConfig(101)?$.isBrowserSupport()?$.isP2PCooling()?N.a.userProperty.P2P_COOLING:1==t.turnToFlvTimes&&0==t.restartTimes?t.turnToFlvReason==N.a.turnToFlvReason.FULL_CONNECT_TIMEOUT?N.a.userProperty.FIRST_FULL_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.FULL_NO_DATA?N.a.userProperty.FIRST_FULL_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.FULL_PLAY_FAIL?N.a.userProperty.FIRST_FULL_PLAY_FAIL:t.turnToFlvReason==N.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?N.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.SUB_NO_DATA?N.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.P2P_ARGS_ERROR?N.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==N.a.turnToFlvReason.P2P_COOLING?N.a.userProperty.P2P_COOLING:N.a.userProperty.UNKNOW:t.turnToFlvReason==N.a.turnToFlvReason.FULL_CONNECT_TIMEOUT||t.turnToFlvReason==N.a.turnToFlvReason.FULL_NO_DATA||t.turnToFlvReason==N.a.turnToFlvReason.FULL_PLAY_FAIL?t.restartReason==N.a.restartReason.RANGE_SEQ_MAX?N.a.userProperty.RESTART_RANGE_MAX:t.restartReason==N.a.restartReason.RANGE_SEQ_LARGE?N.a.userProperty.RESTART_RANGE_LARGE:t.restartReason==N.a.restartReason.CONNECT?N.a.userProperty.RESTART_CONNECT:t.restartReason==N.a.restartReason.MULTI_CDN?N.a.userProperty.RESTART_MUTI_CDN:t.restartReason==N.a.restartReason.PLAYER_NO_DATA?N.a.userProperty.RESTART_PLAYER_NO_DATA:t.restartReason==N.a.restartReason.PLAYER_ERROR?N.a.userProperty.RESTART_PLAYER_ERROR:t.restartReason==N.a.restartReason.FLV_TO_P2P?N.a.userProperty.FLV_TO_P2P:t.restartReason==N.a.restartReason.LOST_SEQ?N.a.userProperty.LOST_SEQ:N.a.userProperty.UNKNOW:t.turnToFlvReason==N.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?N.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==N.a.turnToFlvReason.SUB_NO_DATA?N.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==N.a.turnToFlvReason.P2P_ARGS_ERROR?N.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==N.a.turnToFlvReason.P2P_COOLING?N.a.userProperty.P2P_COOLING:N.a.userProperty.UNKNOW:N.a.userProperty.BROWSER_UN_SUPPORT:N.a.userProperty.CLIENT_CLOSE:N.a.userProperty.SERVER_CLOSE,e}record(t,e,i,s,r,a,o,n){if(this.pausedCount+=e,this.pausedTime+=i,t%120==0&&(s&&this.pausedCount++,this.send()),s&&(this.isPaused=!0),t%20==0){let t=this.getUserProperty();this.stat.setCoreDim(d.a.DIM_CORE.USER_PROPERTY,t),this.stat.setCoreDim(d.a.DIM_CORE.SIGNAL_USER_PROPERTY,0);let i=[];this.flvPlayer.info,this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,s?100:0),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,s||e>0?100:0),this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_REASON,a),this.stat.setCore(d.a.CORE.BUFFER_LENGTH,n),this.stat.setCore(d.a.CORE.PLAY_DELAY,n),this.stat.setCore(d.a.CORE.DELAY_ANCHOR,o),this.isFirstReport&&(this.isFirstReport=!1),this.stat.setComDim(d.a.DIM_COM.CDNIP,this.flvPlayer.cdnip),this.stat.fill(i),this.hyPlayer.tsdbUtil.sendMetrics(i),this.isPaused=!1}}getHost(t){return t.replace("https*://","").split("/")[0]}setHttpHead(t){this.data.httphead=this.getHost(t)}}(this),this.webrtcStat=new class{constructor(){this.framesReceivedList=[],this.framesDecodedList=[],this.framesDroppedList=[],this.packetsReceivedList=[],this.packetsLostList=[],this.keyFramesDecodedList=[],this.lastStat=new An}reset(){this.framesReceivedList=[],this.framesDecodedList=[],this.framesDroppedList=[],this.packetsReceivedList=[],this.packetsLostList=[],this.keyFramesDecodedList=[],this.lastStat=new An}recordStats(t){this.recordInfo(t,this.framesReceivedList,d.a.DIM_COM.V_RECV_FRAME),this.recordInfo(t,this.framesDecodedList,d.a.DIM_COM.V_DECODE_FRAME),this.recordInfo(t,this.framesDroppedList,d.a.DIM_COM.V_TO_DECODE_FRAMES),this.recordInfo(t,this.packetsReceivedList,d.a.DIM_COM.V_TO_PLAY_FRAME),this.recordInfo(t,this.packetsLostList,d.a.DIM_COM.V_PLAY_FRAME),t.setComDim("backup_field1",this.keyFramesDecodedList.toString()),this.framesReceivedList=[],this.framesDecodedList=[],this.framesDroppedList=[],this.packetsReceivedList=[],this.packetsLostList=[],this.keyFramesDecodedList=[]}recordInfo(t,e,i){t.setComp(i,"size",e.length),e.map((e,s)=>{t.setComp(i,"k"+(s+1),e),t.setCompFormat(i,":",",")})}addStat(t){t&&(this.framesReceivedList.push(t.framesReceived-this.lastStat.framesReceived),this.framesDecodedList.push(t.framesDecoded-this.lastStat.framesDecoded),this.framesDroppedList.push(t.framesDropped-this.lastStat.framesDropped),this.packetsReceivedList.push(t.packetsReceived-this.lastStat.packetsReceived),this.packetsLostList.push(t.packetsLost-this.lastStat.packetsLost),this.keyFramesDecodedList.push(t.keyFramesDecoded-this.lastStat.keyFramesDecoded),Object.assign(this.lastStat,t))}},this.started=!1,this.videoProxyInfos=[],this.streamsWaiting=[],this.vpConnectedList=[],this.lastCheckPlayTime=0,this.pauseTs=0,this.paused=!1,this.pauseCount=0,this.sendMetricTimes=0,this.pauseTime=0,this.startLoadTime=0,this.videoInfo=null,this.getVpStartTs=0,this.getVpSuccessTs=0,this.videoDelaySended=!1,this.pauseStartTs=0,this.videoVolume=-1,this._curAnchorDelay=0,this._curPlayDelay=0,this._curKbps=0,this._curAnchorDelaySum=0,this._curAnchorDelayCnt=0,this._curPlayDelaySum=0,this._curPlayDelayCnt=0,this.libFile="hymda.js",this.sslUrl="-server.va.huya.com",this.videoStatus=p.VIDEO_STOP,this.callbacks={onLoaded:this.webrtcPlayerLibLoaded,onTimeout:this.webrtcPlayerTimeout,thisObj:this},this.videoChecker=null,this.videoCheckerCallbacks={renderCallback:this._renderCallback.bind(this)},this.clickEventBind=this._clickEvent.bind(this),this.initPlayer()}initPlayer(){this._addTafSignalEvents()}start(t){n.a.log("WebrtcPlayer.start ".concat(JSON.stringify(t))),this.videoInfo=t,this.videoDelaySended=!1,t.sStreamName&&this._getVoiceProxy(),this.startLoadTime=_.a.now(),this.loadWebrtcPlayerLib(t.h5Root||"./")}stop(){n.a.log("WebrtcPlayer.stop"),X.remove(this._getVoiceProxyTimeout,this),X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),X.remove(this.onSendStatTimer,this),this.removeLibHandler(),this.started=!1,this.video=null,this.videoProxyInfos=[],this.streamsWaiting=[],this.vpConnectedList=[],this.lastCheckPlayTime=0,this.pauseTs=0,this.paused=!1,this.pauseCount=0,this.sendMetricTimes=0,this.pauseTime=0,this.getVpStartTs=0,this.getVpSuccessTs=0,this.pauseStartTs=0,this._curAnchorDelay=0,this._curPlayDelay=0,this._curKbps=0,this._curAnchorDelaySum=0,this._curAnchorDelayCnt=0,this._curPlayDelaySum=0,this._curPlayDelayCnt=0,this.tafLinkSignal.resetVpRequest(),this.webrtcStat.reset(),this.mediaMgr&&(this.mediaMgr.stop(),this.mediaMgr=null)}_initMediaMgr(){this.mediaMgr=new MediaMgr({type:"applets"}),this.mediaMgr.setLogger(n.a),this.tafLinkSignal.setTafWup(this.mediaMgr.getTaf()),this._setPlayout()}_setPlayout(){o.a.playoutUids.length>0?o.a.playoutUids.indexOf(this.videoInfo.presenterUid)>=0&&this.mediaMgr.setPlayout(o.a.minPlayout,o.a.maxPlayout):this.mediaMgr.setPlayout(o.a.minPlayout,o.a.maxPlayout)}_getVoiceProxy(t){if(!this.videoInfo)return;this.started&&this.stop(),n.a.log("WebrtcPlayer._getVoiceProxy: get voice proxy"),this.started=!0;const e=this.videoInfo.sStreamName;-1===this.playerStreamList.indexOf(e)&&this.playerStreamList.push(e);const i=Number(this.videoInfo.lineType)||N.a.LATENCY_MODEL_TYPE.RTC_MODEL;this.getVpStartTs=_.a.now(),this.tafLinkSignal.getVoiceProxy({playerdata:o.a.playerdata||{},appid:v.a.appid,streamName:e,presenterUid:this.videoInfo.presenterUid,clientType:14,userid:v.a.uid,latencyModel:i,useCase:this.videoInfo.useCase||3,rtctrans:this.videoInfo.mpExtArgs&&this.videoInfo.mpExtArgs.rtctrans,iBitRate:this.videoInfo.iBitRate}),X.add(this.onCheckFastTimer,this,100),X.add(this.onCheckTimer,this,1e3),X.add(this.onSendStatTimer,this,2e4),X.add(this._getVoiceProxyTimeout,this,1e4)}_getVoiceProxyTimeout(){this._videoError()}setVolume(t){t<0||this.video&&(this.video.volume=t,this.videoVolume=t)}loadWebrtcPlayerLib(t){window.MediaMgr?this.webrtcPlayerLibLoaded():Ji(t,this.libFile,this.callbacks)}webrtcPlayerLibLoaded(){this.removeLibHandler(),n.a.log("webrtcplayer lib complete"),this.streamsWaiting.length>0?this._playStreams(this.streamsWaiting.shift()):this._initMediaMgr()}webrtcPlayerTimeout(){this.removeLibHandler(),n.a.log("webrtcplayer lib timeout")}removeLibHandler(){Qi(this.libFile,this.callbacks)}getConfig(t){return this.hyPlayer.getConfig(t)}onCheckTimer(t,e){}onCheckFastTimer(t,e){this.checkPause(t)}onSendStatTimer(t,e){if(this.qaStat){let t=this.pauseStartTs>0;this.sendMetricTimes++;const e=this._curAnchorDelayCnt>0?parseInt(this._curAnchorDelaySum/this._curAnchorDelayCnt):0,i=this._curPlayDelayCnt>0?parseInt(this._curPlayDelaySum/this._curPlayDelayCnt):0;this.webrtcStat.recordStats(this.hyPlayer.stat),this.qaStat.record(20*this.sendMetricTimes,this.pauseCount,this.pauseTime,t,0,0,e,i),this.pauseCount=0,this._curAnchorDelaySum=0,this._curAnchorDelayCnt=0,this._curPlayDelaySum=0,this._curPlayDelayCnt=0}}checkPause(t){this.video&&this.videoStatus!==p.BROWSER_PAUSE&&(this.video.currentTime==this.lastCheckPlayTime?0==this.pauseStartTs?this.pauseStartTs=t:t-this.pauseStartTs>200&&(this.paused||(this.pauseCount++,this.paused=!0),n.a.warn("Webrtcplayer.checkPause: video paused ".concat(t-this.pauseStartTs)),t-this.pauseStartTs>=5e3&&(n.a.warn("Video had been Paused ".concat(5e3,", reload vp")),this._getVoiceProxy())):(this.pauseStartTs>0&&t-this.pauseStartTs>200&&(this.pauseTime+=t-this.pauseStartTs),this.paused=!1,this.pauseStartTs=0),this.lastCheckPlayTime=this.video?this.video.currentTime:0)}onPAudienceGetProxyListRsp(t){n.a.log("WebrtcPlayer.onPAudienceGetProxyListRsp ".concat(t&&JSON.stringify(t)),t);let e=(new class{constructor(){}parseInfo(t){let e=[],i=new Map;t.allocatedStreams.forEach((function(t,i){e.push({stream:t,streamName:i})}));let s=[];for(let t=0;t<e.length;t++){let a=e[t].stream,o=[],h=[];if(a.length<1)return{};for(var r=0;r<a.length;r++){if(a[r].streamId)if(a[r].streamId.streamType<32){let t=a[r].streamId.appid+"-"+a[r].streamId.streamType+"-"+a[r].streamId.codecType+"-"+a[r].streamId.sid+"-"+a[r].streamId.startTs+"-"+a[r].streamId.serverGenSeq;h.push(t)}else{let t=a[r].streamId.appid+"-"+a[r].streamId.streamType+"-"+a[r].streamId.codecType+"-"+a[r].streamId.sid+"-"+a[r].streamId.startTs+"-"+a[r].streamId.serverGenSeq;o.push(t)}for(let t=0;t<a[r].videoProxyInfos.length;t++)s.push(a[r].videoProxyInfos[t])}0!==o.length&&0!==h.length||n.a.warn("streams[streamIndex].streamName aStreamIdList.size=".concat(o.length," vStreamIdList.size=").concat(h.length)),i.set(e[t].streamName,{aStreamIdList:o,vStreamIdList:h})}let a=new Map;for(let t=s.length-1;t>=0;t--)a.has(s[t].ip)?s.splice(t,1):a.set(s[t].ip,1);return{streams:i,videoProxyInfos:s}}}).parseInfo(t);t.sslUrl&&(this.sslUrl=t.sslUrl),!e.streams||e.streams.size<0?n.a.warn("WebrtcPlayer.onPAudienceGetProxyListRsp no streams"):(this.videoProxyInfos=e.videoProxyInfos,this.getVpSuccessTs=_.a.now(),window.MediaMgr?this._playStreams(e):this.streamsWaiting.push(e))}_playStreams(t){n.a.log("WebrtcPlayer._playStreams ".concat(t&&JSON.stringify(t))),t.streams.forEach(this._playStreamGroupIds.bind(this))}_playStreamGroupIds(t,e){if(n.a.log("WebrtcPlayer._playStreamGroupIds started=".concat(this.started)),this.started&&-1!=this.playerStreamList.indexOf(e)){this.mediaMgr||this._initMediaMgr();let i=t.vStreamIdList[0],s=t.aStreamIdList[0];this.mediaMgr.on(MediaMgr.ONVIDEOPLAY,this.onVideoPlay.bind(this)),this.mediaMgr.on(MediaMgr.FRAME_INFO_STATS,this.onWebRtcStat.bind(this)),this.mediaMgr.on(MediaMgr.UPDATE_SEI_DATA,this.onUpdateSeiData.bind(this));let r=this._getIpPort();if(""==r.ip||""==r.port&&""==r.sslPort)n.a.log("WebrtcPlayer._playStreamGroupIds  no vp play"),this._videoError();else{let t=r.sslPort?R.b.ip2uint(r.ip)+this.sslUrl:r.ip,a=r.sslPort?r.sslPort:r.port,o={videoCodeRate:this.videoInfo.iBitRate,streamName:this.videoInfo.sStreamName,appId:this.videoInfo.appid};this.videoInfo.mpExtArgs&&this.videoInfo.mpExtArgs.rtctrans&&(o.rtctrans=this.videoInfo.mpExtArgs.rtctrans),n.a.log("WebrtcPlayer._playStreamGroupIds mediaMgr.connect host=".concat(t," port=").concat(a," v=").concat(i," a=").concat(s)),this.mediaMgr.connect(t,a,!!r.sslPort,i,s,v.a.uid,o),this.playerMap.set(e,this.mediaMgr)}}}_getIpPort(){if(this.videoProxyInfos.length>0){let t="",e="",i="",s=null;for(let t=1;t<this.videoProxyInfos.length;t++)-1==this.vpConnectedList.indexOf(this.videoProxyInfos[t].ip)&&(this.vpConnectedList.push(this.videoProxyInfos[t].ip),s=this.videoProxyInfos[t]);if(s||(s=this.videoProxyInfos[0],this.vpConnectedList=[]),t=s.ip,s.tcpPorts&&s.tcpPorts.length>0&&(e=s.tcpPorts[Math.floor(Math.random()*s.tcpPorts.length)]),s.videoProxyInfo&&s.videoProxyInfo.has(8)){let t=s.videoProxyInfo.get(8),e=[65535&t,t>>16];i=e[Math.floor(Math.random()*e.length)]}return{ip:t,port:e,sslPort:i}}return{ip:"",port:""}}get hasPicture(){return this.videoStatus===p.VIDEO_PLAYING}getRecvInfo(){let t=[this.getVpSuccessTs-this.getVpStartTs];if(this.mediaMgr&&this.mediaMgr.getVideoPlayDelay){let e=this.mediaMgr.getVideoPlayDelay();t.push(e.connectVPDelay),t.push(e.recvStreamIdDelay),t.push(e.waitingVideoDelay)}return t}_renderCallback(){this.hyPlayer&&this.hyPlayer.roomRecordStat&&this.hyPlayer.roomRecordStat.renderCallback()}onVideoPlay(t){this.started&&(n.a.log("WebrtcPlayer.onVideoPlay",t),X.remove(this._getVoiceProxyTimeout,this),this.webrtcStat.reset(),this.video!=t.video&&(this.video=t.video,this.videoChecker&&(this.videoChecker.destroy(),this.videoChecker=null),this.videoChecker=new Zr(t.video,!1,this.videoCheckerCallbacks),this.videoChecker.start(),this.video.muted=!1,this.videoVolume>=0&&(this.video.volume=this.videoVolume),n.a.log("WebrtcPlayer.onVideoPlay this.video.paused",this.video.paused),this.updateStatus(p.VIDEO_PLAYING),this.hyPlayer.trigger(u.VIDEO_PLAY,{video:t.video}),this.sendStat(),this.video.paused&&(this.hyPlayer.trigger(u.BROWSER_PAUSE),this._initClickEvent())))}sendNoVideoStat(){this.sendStat(!1)}sendStat(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.videoDelaySended)if(this.videoDelaySended=!0,this.mediaMgr){let e=this.mediaMgr.getVideoPlayDelay();this.hyPlayer.tsdbUtil.sendWebRtcTime(t?_.a.now()-this.startLoadTime:99999,this.getVpSuccessTs-this.getVpStartTs,e.connectVPDelay,e.recvStreamIdDelay,e.waitingVideoDelay)}else this.hyPlayer.tsdbUtil.sendWebRtcTime(99999,0,0,0,0)}onWebRtcStat(t){this.webrtcStat.addStat(t)}onUpdateSeiData(t){const e=t.serverDts,i=t.seiData,s=t.playDelay||{};this._curPlayDelay=s.delay>0?s.delay:0,this._curKbps=s.kbps>0?s.kbps:0,this._curPlayDelaySum+=this._curPlayDelay,this._curPlayDelayCnt++,this._recordDelay(e,i)}startJoinRoom(){}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.hyPlayer.trigger(u.PLAY_STATUS,{status:t}))}_recordDelay(t,e){if(!Ft.isFinishNtp())return;const i=Ft.getSyncTime(),s=t-e.serverSei.dtsGapSum-e.anchorSei.frameDts,r=i-e.anchorSei.sendFrameTime-s;0<r&&r<3e5&&(this._curAnchorDelay=i-e.anchorSei.caputureTime-s,this._curAnchorDelaySum+=this._curAnchorDelay,this._curAnchorDelayCnt++)}getDelayInfo(){const t={total_delay:this._curAnchorDelay+this._curPlayDelay,buffer_delay:this._curPlayDelay,status:0};return 0===this._curAnchorDelay&&0===this._curPlayDelay&&(t.status=1),n.a.log("WebrtcPlayer.getDelayInfo: delay: ",t),t}getRealBitrate(){return this._curKbps}_videoError(){this.stop(),this.hyPlayer.onWebrtcVideoError(this.videoInfo)}_addTafSignalEvents(){this.tafLinkSignal.on(tt.ProtoUri.PAudienceGetProxyListRsp,this.onPAudienceGetProxyListRsp.bind(this))}_initClickEvent(){window&&(window.addEventListener("click",this.clickEventBind,!1),this.updateStatus(p.BROWSER_PAUSE))}_clickEvent(){if(n.a.log("WebrtcPlayer._clickEvent: listen click event, video status is playing"),this.video){let t=this.video.play();t&&t.catch(t=>{n.a.log("WebrtcPlayer._clickEvent err=".concat(t.message))})}this.updateStatus(p.VIDEO_PLAYING),window&&window.removeEventListener("click",this.clickEventBind,!1)}setMuted(t){this.video&&(this.video.muted=t)}},Rn={VIDEO_CANPLAY:"VIDEO_CANPLAY",VIDEO_TIMEUPDATE:"VIDEO_TIMEUPDATE",VIDEO_PROGRESS:"VIDEO_PROGRESS",VIDEO_ERROR:"VIDEO_ERROR",VIDEO_ENDED:"VIDEO_ENDED",VIDEO_LOAD_START:"VIDEO_LOAD_START"};let On=[m.H264_SEI_PLAY,m.AUDIO_SOUND,m.SIGNAL_DATA,m.UPDATE_INTERSITY,m.SIGNAL_HEART,m.METADATA,m.TRANS_END,m.PLAY_DOWNLINK_INFO,m.PLAY_FRAME_BUFFER,m.PLAY_TIME_STATUS,m.PLAYBACK_UPDATE,m.PLAYBACK_M3U8_UPDATED,m.SEI_INFO,Rn.VIDEO_TIMEUPDATE,Rn.VIDEO_PROGRESS,m.VIDEO_TAG_SEEKED,m.VIDEO_TAG_PLAYING,m.VIDEO_TAG_PROGRESS,m.VIDEO_TAG_CANPLAY,m.VIDEO_TAG_PAUSE,m.VIDEO_TAG_LOADSTART,m.VIDEO_TAG_PLAY];function Ln(){let t=new ot.a;return t.setMaxListeners(0),t.trigger=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];let a=s;if("Array"===s.constructor.name&&(a=s[0]),e===m.PLAY_STATUS?n.a.log("%c"+e+" %c"+a.status,"color:#F9F900;background:gray","color:#53FF53;background:gray"):-1===On.indexOf(e)&&n.a.log("%c"+e,"color:#F9F900;background:gray",a),e===m.DATA_METRIC2&&navigator){let t=navigator.userAgent;if(t=t.toLowerCase(),-1!=t.indexOf("headlesschrome"))return}t.emit(e,e,...s)},t.off=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];t.removeListener(e,...s)},t}var Mn=new class extends Ht{constructor(){super(),this.libName="HYThree.js",this.loaded=!1,this.ON_LOAD="on_load",this.callbacks={onLoaded:this.onLoaded,thisObj:this}}loadLib(t){this.loaded?this.trigger(this.ON_LOAD):Ji(t,this.libName,this.callbacks)}onLoaded(){this.loaded=!0,Qi(this.libName,this.callbacks),window.HYThree&&window.HYThree.default.init({logger:n.a}),this.trigger(this.ON_LOAD)}createVr(t,e){return window.HYThree?window.HYThree.default.createVr(t,e):null}},wn=class{constructor(t,e){this.params=e,this._hyPlayer=t,this._sampleContrllor=e.sampleController,this._h265Proxy=e.h265Proxy,this._statSwitch=e.statSwitch,this._autoMonitor=e.autoMonitor,this._recSysStat=e.recSysStat,this._observer=Ln(),this._player=null,this._onObserverBind=this._onObserver.bind(this),this._observer.on(m.VIDEO_PLAY,this._onObserverBind),this._observer.on(m.FLV_URL_UNAVAILABLE,this._onObserverBind),this._observer.on(m.H5_PLAYER_ERROR_IN,this._onObserverBind),this._observer.on(m.NO_DATA_RECEIVED,this._onObserverBind),this._observer.on(m.P2P_TIMEOUT,this._onObserverBind),this._observer.on(m.FLV_TRY_TO_P2P,this._onObserverBind),this._info=null,this._data=null,this._vr=null,this._viewWidth=0,this._viewHeight=0,this._hyPlayer.setSize=this.setSize.bind(this),this._hyPlayer.addViewport=this.addViewport.bind(this),this._hyPlayer.getViewport=this.getViewport.bind(this),this._hyPlayer.setViewport=this.setViewport.bind(this)}_onObserver(t,e){switch(t){case m.VIDEO_PLAY:this.onPlayVideo(t,e);break;case m.FLV_URL_UNAVAILABLE:case m.H5_PLAYER_ERROR_IN:case m.NO_DATA_RECEIVED:case m.P2P_TIMEOUT:this._hyPlayer.trigger(t);break;case m.FLV_TRY_TO_P2P:this._hyPlayer.lastP2PInfo&&(this._hyPlayer.lastP2PInfo.vr.playerType=1,this.start(this._hyPlayer.lastP2PInfo))}}destroy(){this.stop(),this._data=null}disposeVr(){this._vr&&(this._vr.dispose(),this._vr=null)}disposePlayer(){this._player&&(this._player.stop(),this._player=null)}start(t){this.disposeVr(),this.disposePlayer(),n.a.log("VrPlayer.play",t),this._info=t,this._hyPlayer.stat.setComDim(d.a.DIM_COM.VR_MODE,t.vr&&t.vr.type?t.vr.type:0);let e=Object.assign({},t);this.params.hanlerType=2,1===t.vr.playerType?(e.type=md.P2P,this._player=new rn(this._observer,this.params)):(e.type=md.FLV,this._player=new rn(this._observer,this.params)),this._player.initPlayer(e,this.params),this._player.start(e)}stop(){Mn.off(Mn.ON_LOAD,this.onLoadVrLib,this),this._viewWidth=0,this._viewHeight=0,this.disposeVr(),this.disposePlayer()}setVolume(t){this._player&&this._player.setVolume(t)}setMuted(t){this._player&&this._player.setMuted(t)}getMuted(){return!!this._player&&this._player.getMuted()}getBufferLen(){return this._player?this._player.getBufferLen():0}getCurrentTime(){return this._player&&this._player.getCurrentRealTime?this._player.getCurrentRealTime():this._player&&this._player.getCurrentTime?this._player.getCurrentTime():0}getCurrentDts(){return this._player?this._player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this._player?this._player.getCurrentSeiOffsetDts():0}get connected(){return!!this._player&&this._player.connected}get isPlaying(){return!!this._player&&this._player.isPlaying}play(){this._player&&this._player.play()}pause(){this._player&&this._player.pause()}setSize(t,e){this._viewWidth=t,this._viewHeight=e,this._vr&&this._vr.setSize(t,e)}getViewport(){return this._vr?this._vr.getViewport():{x:0,y:0,z:0}}setViewport(t){this._vr&&this._vr.setViewport(t)}addViewport(t){this._vr&&this._vr.addViewport(t)}onPlayVideo(t,e){this._data=e,this._info.vr.videoWidth=e.width,this._info.vr.videoHeight=e.height,Mn.on(Mn.ON_LOAD,this.onLoadVrLib,this),Mn.loadLib(this._info.h5Root)}onLoadVrLib(){Mn.off(Mn.ON_LOAD,this.onLoadVrLib,this),this._data.width=this._viewWidth||this._data.width,this._data.height=this._viewHeight||this._data.height,this._vr=Mn.createVr(this._data.video,this._info.vr),this._vr.play(),this._hyPlayer.trigger(m.VIDEO_PLAY,{video:this._vr.getView(),width:this._data.width,height:this._data.height})}},Fn=s(15),bn=class extends ar{constructor(t,e){super(t,e),this.playerParams=e,this.player=null,this.updating=!1,this.seeking=!1,this.waitSeekTime=0,this.onSeekBind=this.onSeek.bind(this),this.onM3u8UpdatedBind=this.onM3u8Updated.bind(this),this.m3u8UpdateTime=30}start(t){t.isLive=!1,super.start(t),t.m3u8UpdateTime&&(this.m3u8UpdateTime=Number(t.m3u8UpdateTime)),this.seeking=!0,this.player=new Sn(this.eventEmitter,this.playerParams),this.player.start(t),X.add(this.onCheckTimer,this,1e3),this.eventEmitter.on(u.VIDEO_SEEK,this.onSeekBind),this.eventEmitter.on(u.PLAYBACK_M3U8_UPDATED,this.onM3u8UpdatedBind)}pause(){this.player&&this.player.pause&&this.player.pause()}seek(t){this.player&&this.player.playlist&&(this.seeking=!0,this.player.playlist.totalDuration-t<30?(this.waitSeekTime=t,this.eventEmitter.trigger(u.NEED_UPDATE_M3U8)):(this.waitSeekTime=0,this.player.seek(t)))}onSeek(t,e){this.seeking=!1}onM3u8Updated(t,e){n.a.log("PlaybackPlayer.onM3u8Updated totalDuration=".concat(e.totalDuration)),this.waitSeekTime&&(this.player.seek(this.waitSeekTime),this.waitSeekTime=0),this.updating=!1}stop(){this.player&&(this.player.stop(),this.player=null),this.seeking=!1,X.remove(this.onCheckTimer,this),this.eventEmitter.off(u.VIDEO_SEEK,this.onSeekBind),this.eventEmitter.off(u.PLAYBACK_M3U8_UPDATED,this.onM3u8UpdatedBind)}setVolume(t){this.player&&this.player.setVolume(t)}onCheckTimer(t,e){!this.updating&&this.needUpdate()&&(this.updating=!0,this.eventEmitter.trigger(u.NEED_UPDATE_M3U8)),!this.seeking&&this.player&&this.player.mse&&this.player.playlist&&this.eventEmitter.trigger(u.PLAYBACK_UPDATE,{currentTime:this.player.mse.getCurrentTime(),totalDuration:this.player.playlist.totalDuration})}needUpdate(){if(this.player&&this.player.mse&&this.player.playlist){let t=this.player.mse.getCurrentTime()/1e3;if(t>0){let e=this.player.playlist.totalDuration;if(e>0)return e-t<this.m3u8UpdateTime}}return!1}updateLiveVodUrl(t){this.player&&this.player.updateLiveVodUrl(t)}getDurationTime(){return this.player?this.player.getDurationTime():0}setMuted(t){this.player&&this.player.setMuted(t)}},Vn=s(18),Nn=s.n(Vn);let Bn=-1,kn=-1;var Un=class{constructor(t,e,i){this.tsdb=t,this.stat=e,this.autoMonitor=null,this.recSysStat=null,this.autoForce=null,this.handler=i}destroy(){this.tsdb=null,this.stat=null,this.autoMonitor=null,this.recSysStat=null,this.autoForce=null,this.handler=null}init(t,e,i){this.autoMonitor=t,this.recSysStat=e,this.autoForce=i}check(t,e){if(!isNaN(t.lineType)&&!isNaN(t.curBitrate)&&-1!==t.lineType){if(this.stat.setComDim(d.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),-1!==Bn){let i=null;if(Bn!==t.lineType)i=this.stat.createAct(d.a.ACT.SWITCH_LINE,{value:[Bn,t.lineType]});else{let s=1e3*t.curBitrate,r=1e3*kn,a=e?1:0,o=0;e?kn!==t.curBitrate&&(o=2):t&&(t.pullStreamFrom==js?o=1:t.pullStreamFrom!=js&&6!=t.pullStreamFrom&&7!=t.pullStreamFrom&&P.addRetryStream(this.stat));let h=[s,r,a,o,0,0,1,t.bitrateList?t.bitrateList.length:0],l=[];if(this.handler.player&&this.handler.player.player&&this.handler.player.player.getAutoProps){const t=this.handler.player.player.getAutoProps();l[0]="",l[1]=t.videoBuffers,l[2]="",l[3]=t.blockDurationSample,l[4]=t.continueBufferSample,l[5]=t.realKbpsSample,l[6]="",l[7]=t.recvFps}1===a&&(this.recSysStat.recordAct(this.stat),1===o&&(this.autoForce.addForce(),this.recSysStat.removeItem(ao))),this.autoMonitor.addSwitch(_.a.now(),s,r,o),i=this.stat.createAct(d.a.ACT.SWITCH_BITRATE,{value:h,str:l}),n.a.log("StatSwitch.reportSwitchBitrate getAutoProps value4=".concat(o," metric="),i)}i&&this.tsdb.sendMetrics([i])}Bn=t.lineType,kn=t.curBitrate,e=t.isAuto}}sendSwitchAuto(t){t[0]===Ns.UP?this.stat.addComp(d.a.AUTO_INFO.name,d.a.AUTO_INFO.UP_CNT,1):t[0]===Ns.DOWN?this.stat.addComp(d.a.AUTO_INFO.name,d.a.AUTO_INFO.DOWN_CNT,1):t[0]===Ns.BACK&&this.stat.addComp(d.a.AUTO_INFO.name,d.a.AUTO_INFO.BACK_CNT,1),this.stat.setComDim(d.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags);let e=this.stat.createAct(d.a.ACT.SWITCH_AUTO,{value:t});this.tsdb.sendMetrics([e])}sendSwitchCost(t,e){this.stat.setComDim(d.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),this._sendMetric(d.a.ACT.SWITCH_COST,t,e)}sendSwitchPts(t,e){this.stat.setComDim(d.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),this._sendMetric(d.a.ACT.SWITCH_PTS,t,e)}_sendMetric(t,e,i){let s=this.stat.createAct(t,{value:e,str:i});this.tsdb.sendMetrics([s])}},xn=class extends qt{constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:100),this.duration=t,this.lastTs=0}addCur(t,e){super.addCur(t,e),this.samples.addCur(t),this.calculate(e)}calculate(t){0===this.lastTs?this.lastTs=t:t-this.lastTs>=this.duration&&(this.lastTs=t,this.samples.calculate())}onCheckFastTimer(t,e){this.calculate(t)}},Hn=class{constructor(){this.recvTotalSample=new xn(1e3),this.recvLanSample=new xn(1e3),this.realFlacSample=new Kt}destroy(){this.recvTotalSample.reset(),this.recvLanSample.reset(),this.realFlacSample.reset()}start(){X.add(this.onCheckFastTimer,this,100)}stop(){X.remove(this.onCheckFastTimer,this)}onCheckFastTimer(t,e){this.recvTotalSample.onCheckFastTimer(t,e),this.recvLanSample.onCheckFastTimer(t,e)}addTotalSample(t){this.recvTotalSample.addCur(t,_.a.now())}recordStat(t,e){this._recordStat(t,d.a.CORE.RECV_TOTAL_SAMPLE,this.recvTotalSample,!0,e),this._recordStat(t,d.a.CORE.RECV_LAN_SAMPLE,this.recvLanSample,!0,e),this._recordStat(t,d.a.CORE.REAL_FLAC_KBPS_SAMPLE,this.realFlacSample)}_recordStat(t,e,i,s,r){if(i.hasSample){let a=i.getResult();""!==a&&(i.reset(),s?t.setCoreDim(e,"type:".concat(r?2:t.heart_type,",").concat(a)):t.setCoreDim(e,a))}}addLanSample(t){this.recvLanSample.addCur(t,_.a.now())}},Wn=class{constructor(t){this.handler=t,this.sessionId=this.handler.sdkInRoomTs,this.anchoruid=0,this.busi_play=!1,this.busi_stop=!1,this.bLive=!1,this.line=0,this.coderate=0,this.h265=0,this.p2p=0,this.lastStream="",this.startTs=-1,this._lastTs=-1,this.supported=!0,this.pfps=0,this.pfpsMin=0,this.pfpsMax=0,this.roomNoRenderStatV1=new class{constructor(){this._hisStats=[],this._curStat=null,this._hidden=-1,this.checkHidden()}destroy(){this._hisStats=null,this._curStat=null}isVisible(){return 0===this._hidden}checkHidden(){const t=document.visibilityState===N.a.VISIBILITY_STATE.HIDDEN?1:0;if(this._hidden!==t){let e=this._hidden;this._hidden=t,-1!==e&&(t?this.toHiddenCallback():this.toVisibleCallback())}}getStats(){let t={noRenderCnt:0,noRenderDur:0,noRenderDurMax:0,noRenderStreams:[]},e=this._hisStats.length;for(let i=0;i<e;i++){let e=this._hisStats[i];this._getStat(e,t)}return this._hisStats=[],this._curStat&&(this._getStat(this._curStat,t),this._curStat.clearStat()),t}_getStat(t,e){if(t){let i=t.getStats();e.noRenderCnt+=i.noRenderCnt,e.noRenderDur+=i.noRenderDur,e.noRenderDurMax<i.noRenderDurMax&&(e.noRenderDurMax=i.noRenderDurMax),e.noRenderStreams.push(i.text)}}recordCurStat(){this._curStat&&(this.isVisible()&&this._curStat.checkNoRender(!1),this._hisStats.push(this._curStat),this._curStat=null)}reset(){this._curStat=null,this._hisStats=[]}start(t){this._curStat=new class{constructor(t){this._name=t,this._noRenderCnt=0,this._noRenderDur=0,this._noRenderDurMax=0,this._lastRenderTs=_.a.now(),this._noRenderDurCfg=o.a.noRenderDur||500}getStats(){return{noRenderCnt:this._noRenderCnt,noRenderDur:this._noRenderDur,noRenderDurMax:this._noRenderDurMax,text:"".concat(this._name,":").concat(this._noRenderCnt,"_").concat(this._noRenderDur,"_").concat(this._noRenderDurMax)}}clearStat(){this._noRenderCnt=0,this._noRenderDur=0,this._noRenderDurMax=0}resetRender(){this._lastRenderTs=_.a.now()}checkNoRender(t){let e=_.a.now(),i=e-this._lastRenderTs;i>=this._noRenderDurCfg&&(this._noRenderCnt++,this._noRenderDur+=i,this._noRenderDurMax<i&&(this._noRenderDurMax=i)),t&&(this._lastRenderTs=e)}}(t)}renderCallback(){this.isVisible()&&this._curStat&&this._curStat.checkNoRender(!0)}statCallback(){this.isVisible()&&this._curStat&&this._curStat.checkNoRender(!0)}toHiddenCallback(){this._curStat&&this._curStat.checkNoRender(!0)}toVisibleCallback(){this._curStat&&this._curStat.resetRender()}exitCallback(){this.isVisible()&&this._curStat&&this._curStat.checkNoRender(!0)}},this._noRenderMetricTime=o.a.noRenderMetricTime||6e4,this._noRenderValidTime=o.a.noRenderValidTime||1e3,this.onBeforeUnloadBind=this.onBeforeUnload.bind(this),window.addEventListener("beforeunload",this.onBeforeUnloadBind)}destroy(){window.removeEventListener("beforeunload",this.onBeforeUnloadBind),X.remove(this.onCheckTimer,this),this.roomNoRenderStatV1=null,this.handler=null}setPageFps(t){let{pfps:e,pfpsMin:i,pfpsMax:s}=t;this.pfps=e,this.pfpsMax=s,this.pfpsMin=i}setLive(t){this.bLive=t,this.start()}setBusiPlay(){this.busi_play=!0,this.busi_stop=!1}setBusiStop(){this.busi_stop=!0}startStream(t,e,i,s,r){if(!this.supported)return void n.a.log("RoomRecord startStream fail, not supported!");this.start();let a="".concat(e,"_").concat(i,"_").concat(s,"_").concat(r);if(this.lastStream!==a){let t=_.a.now();if(this._lastTs>0){let e=t-this._lastTs;e>o.a.noRenderDur&&(this.roomNoRenderStatV1.recordCurStat(),this.sendMetric(e))}this._lastTs=t,this.roomNoRenderStatV1.reset(),this.roomNoRenderStatV1.start("".concat(e,"_").concat(i,"_").concat(s,"_").concat(r))}this.lastStream=a,this.anchoruid=t,this.line=e,this.coderate=i,this.h265="h265"===s?1:0,this.p2p="p2p"===r?1:0}start(){this.supported?-1===this.startTs&&(this._lastTs=this.startTs=_.a.now(),this.lastStream="init",this.roomNoRenderStatV1.start("init"),X.add(this.onCheckTimer,this,100)):n.a.log("RoomRecord start fail, not supported!")}stop(){this.startTs=-1,X.remove(this.onCheckTimer,this)}sendMetric(t){if(-1===this.startTs)return;let e={sMetricName:d.a.ROOM_HEART60.name,vDimension:{},vExLog:{},vField:{}};e.vDimension[d.a.ROOM_HEART60.SESSION_ID]=this.sessionId,e.vDimension[d.a.ROOM_HEART60.ANCHORUID]=this.anchoruid,e.vDimension[d.a.ROOM_HEART60.LINE]=this.line,e.vDimension[d.a.ROOM_HEART60.CODERATE]=this.coderate,e.vDimension[d.a.ROOM_HEART60.H265]=this.h265,e.vDimension[d.a.ROOM_HEART60.P2P]=this.p2p,e.vDimension[d.a.ROOM_HEART60.BLIVE]=this.bLive?1:0,e.vDimension[d.a.ROOM_HEART60.BUSI_PLAY]=this.busi_play?1:0,e.vDimension[d.a.ROOM_HEART60.BUSI_STOP]=this.busi_stop?1:0,e.vDimension[d.a.DIM_COM.BROWSER_KERNEL]=h.a.name,e.vDimension[d.a.DIM_COM.BROWSER_KERNEL_VERSION]=h.a.version.major,e.vDimension[d.a.DIM_COM.HARDWARE_CONCURRENCY]=navigator.hardwareConcurrency||0,e.vDimension[d.a.DIM_COM.RENDER_INFO]=ct(),e.vDimension[d.a.DIM_COM.VISIBILITY_STATE]=document.visibilityState,e.vDimension[d.a.DIM_CORE.PFPS]=this.pfps,e.vDimension[d.a.DIM_CORE.PFPSMAX]=this.pfpsMax,e.vDimension[d.a.DIM_CORE.PFPSMIN]=this.pfpsMin;let i=this.roomNoRenderStatV1.getStats();e.vField[d.a.ROOM_HEART60.DURATION]=t,e.vField[d.a.ROOM_HEART60.RNR_CNT]=i.noRenderCnt,e.vField[d.a.ROOM_HEART60.RNR_DUR]=i.noRenderDur,e.vField[d.a.ROOM_HEART60.RNR_DUR_MAX]=i.noRenderDurMax,e.vDimension[d.a.ROOM_HEART60.SNR_INFOS]=i.noRenderStreams.join(","),this.handler.sendMetrics([e])}onCheckTimer(t,e){if(-1===this.startTs)return;this.roomNoRenderStatV1.checkHidden();const i=t-this._lastTs;i>=this._noRenderMetricTime&&(this._lastTs=t,this.roomNoRenderStatV1.statCallback(),this.sendMetric(i))}renderCallback(){this.roomNoRenderStatV1.renderCallback()}onBeforeUnload(t){if(this.supported){if(this.startTs>0){let t=_.a.now();t-this.startTs>this._noRenderValidTime&&(this.roomNoRenderStatV1.exitCallback(),this.sendMetric(t-this._lastTs))}}else n.a.log("RoomRecord onBeforeUnload fail, not supported!")}},Gn=class{constructor(t,e){this.stat=t,this.tsdb=e,this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0,this.costUs=0,this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1,this.serverSupported=!1,this.lastCurBitrate=0,this.lastLine=0,this.isUseH265Mse=!0}destroy(){}get isSupported(){let t=this.isCodecSupport&&this.isBrowserSupport&&this.isCfgSupport;return 1==Number(f.a._localCloseHevc)&&(t=!1),1===Number(f.a._enableForceH265)&&(t=!0),t}get canPreload(){return this.isBrowserSupport&&this.isCfgSupport}onTurntoH264(t){t===w.P2P?this.isP2PUseH265=!1:t===w.FLV?this.isFlvUseH265=!1:t==w.HLS&&(this.isHlsUseH265=!1)}onTurntoH265Wasm(){this.isUseH265Mse=!1}init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetProps(t),this._initCodec(t),this._initBrowser(),this._initRandom(t),this._initCfg(t),this.lastCurBitrate=Number(t.curBitrate),this.lastLine=Number(t.lineType),n.a.log("H265Support.init isCodecSupport=".concat(this.isCodecSupport," isBrowserSupport=").concat(this.isBrowserSupport," isCfgSupport=").concat(this.isCfgSupport))}mseHevcInit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetMseHevcProps(t),this._initBrowserMseHevcSupport(t),this._initMseHevcCodec(t),this._initMseHevcCfg(t),this.lastCurBitrate=Number(t.curBitrate),this.lastLine=Number(t.lineType),n.a.log("H265Support.mseHevcInit isCodecSupport=".concat(this.isCodecSupport," isBrowserSupport=").concat(this.isBrowserSupport," isCfgSupport=").concat(this.isCfgSupport))}resetProps(t){this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1;let e=Number(t.lineType),i=Number(t.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=e)&&(this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0)}resetMseHevcProps(t){this.resetProps(t);let e=Number(t.lineType),i=Number(t.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=e)&&(this.isUseH265Mse=!0)}_initCodec(t){if(1==f.a.open265&&(f.a.w265LastCost=0),this.isReport265||t.type===w.STREAM||(this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.H265_STATUS,{value:[10],str:[R.b.is64bitSoftware()?1:2,navigator.userAgent]})]),n.a.log("HYPlayer.initH265 support hardwareConcurrency hardwareConcurrency=",navigator.hardwareConcurrency),this.isReport265=!0),this._isSupported(t)&&Nn.a&&Nn.a.getInstance){let e={enableWebH265:1,baseCostUs:{2e3:32e3,4e3:3e4},loopCount:100,singleThreadBitKbps:[10],multiThreadBitKbps:[4e3,2e3,500],threadCount:2,degrade:0,statIntervalMs:1e3,fmt:11,share:0,wasmLoad:500,core:{2e3:3,4e3:4},x86:{4e3:1}},i={};e.x86={4e3:1},o.a.h265Config[0][0].forEach((t,e)=>{i[t]=o.a.h265Config[0][1][e]}),e.baseCostUs=i,e.multiThreadBitKbps=o.a.h265Config[1];let s={};o.a.h265Config[3][0].forEach((t,e)=>{s[t]=o.a.h265Config[3][1][e]}),e.core=s,Nn.a.getInstance().parseConfigs(e);let r=t.curBitrate,a=Nn.a.getInstance().isSupportH265(r);n.a.log("H265Support.initH265 bitRate",r,a),this.isCodecSupport=a.isSupport,0==o.a.vodH265Config[2]&&t.type===w.HLS&&(this.isCodecSupport=!1),this.costUs=a.costUs,this.codecSupportReason=a.reason,this.tsdb.sendMetrics([this.stat.createAct(d.a.ACT.H265_STATUS,{value:[2],str:[a.reason]})]),Nn.a.getInstance().setLogCallback(()=>{let t=["H265 render setLogCallback"].concat(Array.apply(null,arguments));n.a.log.apply(n.a,t)})}}_initMseHevcCodec(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isUseH265Mse){if(this._isSupported(t)){this.isCodecSupport=!1;let e=t.curBitrate;if(h.a.version.major>=o.a.h265MseChromeConfig[0])navigator.hardwareConcurrency<o.a.h265MseChromeConfig[2]?this.isCodecSupport=!1:this.isCodecSupport=!0;else{if(o.a.h265MseConfig[4].length>0){const t={},i={},s={};if(o.a.h265MseConfig[4][0].forEach((e,r)=>{t[e]=o.a.h265MseConfig[4][1][r],i[e]=o.a.h265MseConfig[4][2][r],s[e]=o.a.h265MseConfig[4][3][r]}),navigator.hardwareConcurrency<=t[e]){if(!(i[e]&&navigator.hardwareConcurrency>i[e]))return void n.a.warn("H265Support._initMseHevcCodec Mse Config: curThread=".concat(navigator.hardwareConcurrency," isn't greater than thread=").concat(t[e]));if(this.isBrowserSupport&&s[e]){const t=ct().toLowerCase();if(!(t.indexOf(s[e])>=0))return void n.a.warn("H265Support._initMseHevcCodec Mse Render Config: curRender=".concat(t," isn't suppored render=").concat(s[e]));this.isCodecSupport=!0}}}this.isCodecSupport=!0}}0==o.a.vodH265Config[1]&&t.type===w.HLS&&(this.isCodecSupport=!1)}else this.isCodecSupport=!1}_isSupported(t){let e=!1;if(t.type===w.HLS){if(t.h265Url&&(this.serverSupported=!0),t.h265Url&&this.isHlsUseH265)return!0}else{if(e=t.iIsHEVCSupport>0&&t.iHEVCBitRate>=0||this._isH265(t.iCodecType)&&0===t.iBitRate,this.serverSupported=e,t.type===w.FLV)return this.isFlvUseH265&&e||1==f.a._enableServer265;if(t.type===w.P2P)return this.isP2PUseH265&&e||1==f.a._enableServer265}return!1}_isH265(t){return 1===t||4===t||6===t||8===t}_initBrowser(){let t=h.a.version.major,e=!1;h.a.chrome&&t>=o.a.h265Config[2]&&(e=!0),h.a.chrome&&-1!==o.a.wasm265BlackBrowVers.indexOf(t)&&(n.a.log("H265Support._initBrowser wasm265BlackBrowVers",o.a.wasm265BlackBrowVers),e=!1),1===Number(f.a._enableBrowser)&&(e=!0),"undefined"==typeof SharedArrayBuffer&&(e=!1),this.isBrowserSupport=e}_initBrowserMseHevcSupport(t){let e=dt.a.isMseSupportedHevc();if(e){const i=o.a.h265MseConfig[1];if(i.length>0){const t=h.a.version.major;e=h.a.chrome&&i.indexOf(t)>=0?e&&!0:e&&!1}h.a.chrome&&h.a.version.major>=o.a.h265MseChromeConfig[0]&&(e=!0,e=e&&this.getChromeHevcRenderSupport(t))}else n.a.warn("H265Support._initMseHevcCodec browser isn't supported mse h265");1==Number(f.a._closeMseHevc)&&(e=!1),1===Number(f.a._enableMseHevcBrowser)&&(e=!0),this.isBrowserSupport=e}_initRandom(t){let e=this._getRandomUse(t);this.isCodecSupport&&(e||(this.isCodecSupport=!1)),t.randomH265=e}_getRandomUse(t){let e=f.a.h265PresentUid,i=t.presenterUid,s=!0,r=o.a.h265BlackUids;if(t.liveType==Fn.a.REPLAY&&(r=o.a.replayH265BlackUids),r.forEach(t=>{i&&t.toString()==i.toString()&&(s=!1)}),!s)return!1;if(t.liveType==Fn.a.REPLAY||t.liveType==Fn.a.VOD){let t=o.a.whiteH265Uids;if(0==t[1]){let e=!1;return t[0].forEach(t=>{i&&t.toString()==i.toString()&&(e=!0)}),e}}f.a.randomH265Percent&&e==i||(f.a.randomH265Percent=o.a.randomH265Percent),1==f.a.open265?f.a.randomH265Percent=3e3:2==f.a.open265&&(f.a.randomH265Percent=6e3);let a=Number(f.a.randomH265Percent);return f.a.h265PresentUid=t.presenterUid,a<o.a.h265PercentConfig}_initCfg(t){let e=1===Number(o.a.isConfigSupportH265);t.liveType!=Fn.a.VOD&&t.liveType!=Fn.a.REPLAY||(e=1===Number(o.a.isVodSupportH265)),(o.a.isCloseAllFuncs(t.uid)||-1!=o.a.wcsSoft264Uids.indexOf(Number(t.uid)))&&(e=!1,n.a.log("H265Support._initCfg closeAllFuncs!")),-1!==o.a.h265BlackBrows.indexOf(h.a.version.major)&&(e=!1),o.a.wasmCloseCfg.length>0&&1==o.a.wasmCloseCfg[0]&&(n.a.log("H265Support._initCfg wasm close!"),e=!1),o.a.wasmCloseCfg.length>0&&o.a.wasmCloseCfg[1].length>0&&-1!=o.a.wasmCloseCfg[1].indexOf(Number(t.presenterUid))&&(n.a.log("H265Support._getConfigUse wasm black anchoruid"),e=!1),this.isCfgSupport=e}_initMseHevcCfg(t){let e=1===Number(o.a.h265MseConfig[0])&&1===Number(o.a.isConfigSupportH265);if(t.type==w.HLS&&(e=1===Number(o.a.isVodSupportH265)),(o.a.isCloseAllFuncs(t.uid)||-1!==o.a.wcsSoft264Uids.indexOf(Number(t.uid)))&&(e=!1,n.a.log("H265Support._initCfg closeAllFuncs!")),-1!==o.a.h265BlackBrows.indexOf(h.a.version.major)&&(e=!1),h.a.version.major>=o.a.h265MseChromeConfig[0]&&t.curBitrate<=o.a.h265MseChromeConfig[1])this.isCfgSupport=e;else{const i=o.a.h265MseConfig[2];i.length>0&&i.indexOf(t.curBitrate)>=0?e=e&&!0:(n.a.warn("H265Support._initMseHevcCodec Mse Config: bitrate ".concat(t.curBitrate," isn't supported mse h265")),e=e&&!1);let s=o.a.h265MseConfig[3];s.length>0&&(s.indexOf(t.lineType)>=0?e=e&&!0:(n.a.warn("H265Support._initMseHevcCodec Mse Config: line ".concat(t.lineType," isn't supported mse h265")),e=e&&!1))}const i=o.a.h265MseWhiteBlackUids[0];i.length>0&&(t.presenterUid&&i.indexOf(Number(t.presenterUid))>=0?e=e&&!0:(e=e&&!1,n.a.warn("H265Support._initMseHevcCodec uid ".concat(t.presenterUid," isn't in white list"))));const s=o.a.h265MseWhiteBlackUids[1];s.length>0&&t.presenterUid&&s.indexOf(Number(t.presenterUid))>=0&&(e=e&&!1,n.a.warn("H265Support._initMseHevcCodec uid ".concat(t.presenterUid," is in black list"))),this.isCfgSupport=e}getChromeHevcRenderSupport(t){return 0!=o.a.h265MseChromeConfig[4]&&-1===o.a.wcs265BlackUids.indexOf(Number(t.uid))&&-1===o.a.mse265BlackUids.indexOf(Number(t.uid))&&(-1!=o.a.enableEdgeBroMseCfg.indexOf(h.a.version.major)||-1===h.a.name.indexOf("edg")||1!=t._isTurnTomse)}},Yn={NO_DATA:1,NO_DECODE:2,WORKER_ERROR:3,DECODE_ERROR:4,RENDER_ERROR:5,NO_RENDER:6,RECEIVE_LIST_OUT_LIMIT:7,YUV_OUT_LIMIT:8,WASM_TIMEOUT:9,CREATE_WEBGL_FAIL:10,CREATE_WORKER_ERROR:11,AUDIO_FAST:12,VIDEO_FAST:13,START_CODE_ERROR:14,WORKER_TIMEOUT:15,RETRY_MAX:16,dic:{1:"20s无数据",2:"10s无解码",3:"worker异常",4:"解码失败",5:"渲染失败",6:"10s无渲染",7:"解码前队列大于2000",8:"yuv队列大于300",9:"wasm timeout",10:"创建webgl失败",11:"web worker异常",12:"音频快，视频慢，切264",13:"音频慢，视频快，切264",14:"hevcFindNextStartCode failed",15:"worker超时",16:"重试超过最大次数"}};class qn{constructor(t,e){this._stat=t,this._tsdb=e,this._onMessageBind=this._onMessage.bind(this),this._onErrorBind=this._onError.bind(this),this._startTs=0,this._readyTs=0,this._isReady=!1,this._isTimeout=!1,this._isError=!1,this._decoder=null,this._callbacks=null,this._onMessageCb=null}set onMessageCb(t){this._onMessageCb=t}get decoder(){return this._decoder}get isReady(){return this._isReady}terminate(){n.a.log("H265Decoder.terminate"),this._destroyDecoder(),X.remove(this._onTimeout,this),this._callbacks=null,this._onMessageCb=null,this._isReady=!1,this._startTs=0,this._readyTs=0}destroy(){n.a.log("H265Decoder.destroy"),this._stat=null,this._tsdb=null,this._callbacks=null,this._onMessageCb=null,this.stopDecoder(),this._decoder&&this._decoder.terminate(),X.remove(this._onTimeout,this)}_destroyDecoder(){if(this._decoder){this._decoder.onmessage=null,this._decoder.onerror=null,this.stopDecoder();try{this._decoder.terminate()}catch(t){n.a.log("H265Decoder._destroyDecoder",t)}this._decoder=null}}stopDecoder(){this._decoder&&this._decoder.postMessage({t:6})}load(t,e){if("undefined"==typeof SharedArrayBuffer)return;if(this._callbacks=e,this._decoder)return void(this._callbacks&&this._callbacks.ready());let i=h.a.chrome&&h.a.version.major>=91;1==Number(f.a._unSupportSimd)&&(i=!1),n.a.log("H265Decoder.load"),this._startTs=_.a.now();let s='importScripts("'.concat(t+(i?"decoder.worker.simd.js":"decoder.worker.js"),'")'),r=new Blob([s],{type:"application/javascript"}),a=window.URL.createObjectURL(r),o=new Worker(a);o.onmessage=this._onMessageBind,o.onerror=this._onErrorBind,this._decoder=o,X.remove(this._onTimeout,this),X.once(this._onTimeout,this,1e3)}_onMessage(t){switch(t.data.t){case 0:this._decoder.postMessage({t:1});break;case 2:n.a.log("H265Decoder._onMessage worker isReady!"),X.remove(this._onTimeout,this),qn.preloaded=!0,this._isReady=!0,this._readyTs=_.a.now();let t=this._readyTs-this._startTs;this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(d.a.ACT.H265_WORKER_LOAD_TS,{value:[t]})]),this._isError||this._isTimeout||this._callbacks&&this._callbacks.ready()}this._onMessageCb&&this._onMessageCb(t)}_onError(t){n.a.error("H265Decoder._onError",t),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(d.a.ACT.H265_STATUS,{value:[1],str:[Yn.CREATE_WORKER_ERROR]})]),this._destroyDecoder(),X.remove(this._onTimeout,this),this._readyTs=0,this._isReady=!1,this._isError=!0,f.a.h265WorkerError=1,this._callbacks&&this._callbacks.error()}_onTimeout(){n.a.log("H265Decoder._onTimeout"),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(d.a.ACT.H265_STATUS,{value:[1],str:[Yn.WORKER_TIMEOUT]})]),this._destroyDecoder(),this._readyTs=0,this._isTimeout=!0,this._isReady=!1,this._callbacks&&this._callbacks.timeout()}}Object(ds.a)(qn,"preloaded",!1);var Kn=qn;class jn{constructor(){this.count=0,this.arr=[]}inc(t){this.count+=t}dec(t){this.count-=t,this.count<0&&(this.count=0)}collect(){this.arr.push(this.count),this.count=0}stat(){let t=this.arr;return this.arr=[],t}reset(){this.count=0,this.arr=[]}}const zn={toDecode:0,decoded:1,render:2,throwFrame:3,throwRaw:4,rawList:5,frameList:6};var Jn=class{static get TYPES(){return zn}constructor(){this.toDecodeItem=new jn,this.decodedItem=new jn,this.renderItem=new jn,this.throwFraItem=new jn,this.throwRawItem=new jn,this.rawItem=new jn,this.frameItem=new jn,this.rafItem=new jn,this.items=[this.toDecodeItem,this.decodedItem,this.renderItem,this.throwFraItem,this.throwRawItem,this.rawItem,this.frameItem,this.rafItem],this.reset()}inc(t,e){for(let i=0;i<t.length;i++){let s=this.getItem(t[i]);s&&s.inc(e[i])}this.collect()}dec(t,e){for(let i=0;i<t.length;i++){let s=this.getItem(t[i]);s&&s.dec(e[i])}this.collect()}collect(){let t=Date.now();if(0==this.lastStatTime&&(this.lastStatTime=t),t-this.lastStatTime>=1e3){for(let t=0;t<this.items.length;t++)this.items[t].collect();this.lastStatTime=t}}getStat(){return{toDecode:this.toDecodeItem.stat(),decoded:this.decodedItem.stat(),render:this.renderItem.stat(),rawList:this.rawItem.stat(),frameList:this.frameItem.stat()}}getItem(t){return t>=this.items.length?null:this.items[t]}reset(){this.lastStatTime=0;for(let t=0;t<this.items.length;t++)this.items[t].reset()}};const Qn=3;var Xn=class{constructor(t,e){this.stat=t.stat,this.tsdb=t.tsdb,this.vodStat=t.vodStat,this.handler=e,this.reset()}destroy(){}addH265Support(t,e){let i=t;if(-1e4==i){const t=this.handler.h265Support,e=t.serverSupported,s=t.isCodecSupport,r=t.isBrowserSupport,a=t.isCfgSupport;e?a?r?s?a&&r&&s&&(i=0):i=6:i=5:i=4:i=1}this.stat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,i),!e.isLive&&this.vodStat&&this.vodStat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,i)}addTurnTo264Support(t,e){let i=0;switch(t){case Yn.WORKER_TIMEOUT:i=5;break;case Yn.WORKER_ERROR:case Yn.CREATE_WORKER_ERROR:i=6;break;case Yn.START_CODE_ERROR:i=12;break;case Yn.WASM_TIMEOUT:i=13;break;case Yn.VIDEO_FAST:i=14;break;case Yn.AUDIO_FAST:i=15;break;case Yn.CREATE_WEBGL_FAIL:i=16;break;case Yn.RETRY_MAX:i=17}this.stat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,i),!e.isLive&&this.vodStat&&this.vodStat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,i)}addH265SupportNew(t){let e;const i=this.handler.h265Support,s=i.serverSupported,r=i.isCodecSupport,a=i.isBrowserSupport,o=i.isCfgSupport,n=i.codecSupportReason;if(s)if(o)if(a){if(r)o&&a&&r&&(e=1);else if(-1e4!=n)switch(n){case 2:e=7;break;case 3:e=8;break;case 5:e=9;break;case 6:e=10;break;case 7:e=11}}else e=3;else e=4;else e=2;this.stat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,e),!t.isLive&&this.vodStat&&this.vodStat.setComDim(d.a.DIM_COM.H265_SUPPORT_REASON,e)}reset(){}},$n=class{constructor(t,e,i){this._stat=t,this._vodStat=i,this._tsdb=e,this._support=new Gn(t,e),this._decoder=new Kn(t,e),this._render=new class{static isSupported(){return"object"==typeof WebAssembly}constructor(t,e){this.stat=t,this.tsdb=e,this.fpsList=[],this.frameList=[],this.renderStat=[],this.decodedStat=[],this.toDecodeStat=[],this.frameListStat=[],this.avDeltaList=[],this.rafStat=[],this.rawListStat=[],this._videoTracks=[],this.resetProps(),this.stat=new Jn,this.avgFrameGap=0,this.rafTime=0,this.isHidden=!1,this.retryFlvTimes=0,this.retryP2PTimes=0,this.retryHlsTimes=0,this.currentVideoDts=0,this.isH265Error=!1,this.rafFrameBind=this.rafFrame.bind(this),this.onVisibilityChangedBind=this.onVisibilityChanged.bind(this),this.pauseHanlder=new class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._player=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}check(){const t=_.a.now(),e=this._player.getVideoPts();if(0!==this._playedPts){e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t);const i=t-this._lastCheck500Time,s=Math.round(e-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=o.a.pause500Cfg[0]&&(1==Number(f.a._printPauseCheck)&&n.a.log("H265Pause.check.500ms",i,s,i-s),this._player.check500Pause()),this._lastCheck500CurrntTime=e,this._lastCheck500Time=t)}this._playedPts=e}_setPaused(t){this._paused=!0,this._pausedTs=t,n.a.log("H265Pause._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;n.a.log("H265Pause._setResume pausedTime=",e),this._playResume(t,e),this._paused=!1,this._pausedTs=0}}(this,{pauseFunc:this._playPause.bind(this),resumeFunc:this._playResume.bind(this)}),this.workerSharedArrayBuffer=null,this.isH265Played=!1,this.videoPlayerElement=null}addEvents(){this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&this.mse.handler.eventEmitter.on(m.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}delEvents(){this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&this.mse.handler.eventEmitter.off(m.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}addTimer(){X.add(this.timerHandler,this,1e3)}delTimer(){X.remove(this.timerHandler,this)}attachMse(t){n.a.log("H265Player.attachMse"),this.mse=t,this.resetProps(),this.isH265Played=!1;let e=_.a.now();this.onVideoFrameTime=e,this.pushVideoTime=0,this.workerHeartTime=e,this.updteFpsTime=0,this.rafId=null,this.rafFrame(),this._initGL(t),this.addEvents(),this.addTimer()}_initGL(t){let e=t.h265Proxy.decoder;if(e.onMessageCb=this._onMessage.bind(this),this.decoder=e.decoder,this.decoder.postMessage({t:8,d:o.a.h265Config}),this.isPlaying=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t.getWidth(),this.canvas.height=t.getHeight(),n.a.log("H265Player._initGL width=".concat(t.getWidth()," height=").concat(t.getHeight())),this.isSupportVideoTrack="undefined"!=typeof MediaStreamTrackGenerator&&"undefined"!=typeof VideoFrame,1==Number(f.a._forceWasmWebgl)&&(this.isSupportVideoTrack=!1),this.isSupportVideoTrack)this.videoPlayerElement=document.createElement("video"),this.videoPlayerElement.muted=!0,this.agenerator=new MediaStreamTrackGenerator({kind:"video"}),this.processedStream=new MediaStream([this.agenerator]),this.videoPlayerElement.srcObject=this.processedStream,this.decoder.postMessage({t:10,agenerator:this.agenerator.writable,width:this.mse.getWidth(),height:this.mse.getHeight(),config:o.a.h265Config[6],isPostRenderCallback:o.a.renderStat[0],devicePixelRatio:window.devicePixelRatio},[this.agenerator.writable]);else{let t=this.canvas.transferControlToOffscreen();this.decoder.postMessage({t:10,canvas:t,width:this.mse.getWidth(),height:this.mse.getHeight(),config:o.a.h265Config[6],isPostRenderCallback:o.a.renderStat[0],devicePixelRatio:window.devicePixelRatio},[t])}this._initDecodeWorker()}updateSize(){}resetProps(){this.canvas=null,this.frameList.length=0,this.isPlaying=!1,this._audioErrorCnt=0,this.onVideoFrameTime=0,this.pushVideoTime=0,this.workerHeartTime=0,this.decodeNow=0,this.renderTime=0,this.curPic=null,this.pauseDecode=!1,this.avgFrameGap=33,this.updteFpsTime=0,this.rafTime=0,this.pauseCnt=0,this.videoPauseCnt=0,this.countHeart=0,this.rafNoRenderCount=0,this.isFirsrToDecode=!1,this.toDecodeStamp=0,this.isFirstDecoded=!1,this.decodedStamp=0,this.isFirstRender=!1,this.renderStamp=0,this.hlsStarted=!1,this.fpsList.length=0,this.frameList.length=0,this.renderStat.length=0,this.decodedStat.length=0,this.toDecodeStat.length=0,this.frameListStat.length=0,this.rafStat.length=0,this.rawListStat.length=0,this._videoTracks.length=0,this.avDeltaList.length=0,this.userPaused=!1,this.isH265Error=!1,this.pauseStartTs=0,this.pauseMobStartTs=0,this.isRenderFpsPaused=!1,this.isFramePaused=!1,this.pauseMobCnt=0,this.rafLastNow=0,this.hiddenStartTs=0,this.pause500Cnt=0,this.isWasmPlay=!1,this.currentVideoDts=0,this.isSupportVideoTrack=!1}timerHandler(){let t=_.a.now();this.checkTimer(t),this.timerTime=t}checkTimer(){if(!this.mse||!this.mse.handler)return;if(this.userPaused)return;if(this.mse.handler.playerType==w.HLS&&!this.hlsStarted)return;if(this.isH265Error)return;let t=_.a.now();0!=this.workerHeartTime&&t-this.workerHeartTime>5e3&&this.mse.h265Proxy&&(n.a.log("H265Player.checkTimer worker error"),this.mse.h265Proxy.terminate(),setTimeout(()=>{this.handlerError(Yn.WORKER_ERROR),this.turnToH264(Yn.WORKER_ERROR)},200));const e=this.getPts()-this.getVideoPts();this.avDeltaList.push(Math.floor(e))}onVisibilityChanged(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?(this.hiddenStartTs=_.a.now(),n.a.log("H265Player.onVisibilityChanged isHidden true",this.hiddenStartTs),this.isHidden=!0,this.decoder&&this.decoder.postMessage({t:12})):(n.a.log("H265Player.onVisibilityChanged isHidden false"),this.renderTime=0,this.isHidden=!1,this.hiddenStartTs=0,this.decoder&&this.decoder.postMessage({t:13}))}_onMessage(t){if(!this.mse||!this.mse.handler)return;if(this.mse.handler.playerType==w.HLS&&!this.hlsStarted)return;let e=t.data;if(this.isH265Error)return;const i=_.a.now();switch(e.t){case 5:break;case 7:if(!this.isPlaying)return;e.d.logList&&e.d.logList.length>0&&(n.a.log("H265Player.onmessage.worker.log",e.d.logList.join(",")),e.d.logList=[]),this.onDecodeError(e.d.data);break;case 9:if(0==e.d.length)return;n.a.log("H265Player.onmessage.worker.log",e.d.join(",")),e.d=[];break;case 10:this.workerHeartTime=i,this.countHeart++,this.countHeart%20==0&&n.a.log("H265Player.onmessage.webWorker.heart");break;case 11:case 12:break;case 13:this.onRenderError(e.d);break;case 14:let t=e.d.renderNow,s=e.d.decodedNow,r=Date.now()-t;n.a.log("H265Player.onmessage render play postMessage cost",r),this.isFirstDecoded||(this.decodedStamp=s,this.isFirstDecoded=!0),this.isFirstRender||(this.renderStamp=t,this.isFirstRender=!0,n.a.log("H265Player.onmessage 送帧到解码，解码到渲染耗时",this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp)),this.mse&&this.mse.handler&&(this.mse.handler.setWasmPlaying&&this.mse.handler.setWasmPlaying(),this.isH265Played=!0,this.mse.triggerH265Play(this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp),this.triggerWasmPlay());break;case 15:this.pauseCnt++,n.a.log("H265Player.onmessage pauseCnt",this.pauseCnt);break;case 16:n.a.log("H265Player.onmessage worker noRender 10s",this.isHidden),this.handlerError(Yn.NO_RENDER),this.autoReport();break;case 17:this.handlerError(Yn.NO_DECODE);break;case 18:e.d.render.length>0&&(this.renderStat=this.renderStat.concat(e.d.render)),e.d.decoded.length>0&&(this.decodedStat=this.decodedStat.concat(e.d.decoded)),e.d.toDecode.length>0&&(this.toDecodeStat=this.decodedStat.concat(e.d.toDecode)),e.d.frameList.length>0&&(this.frameListStat=this.frameListStat.concat(e.d.frameList)),e.d.raf.length>0&&(this.rafStat=this.rafStat.concat(e.d.raf)),e.d.rawList.length>0&&(this.rawListStat=this.rawListStat.concat(e.d.rawList));break;case 19:this.handlerError(Yn.YUV_OUT_LIMIT);break;case 20:this.reportError(Yn.CREATE_WEBGL_FAIL),this.turnToH264(Yn.CREATE_WEBGL_FAIL);break;case 21:if(this.reportError(Yn.AUDIO_FAST),1==f.a._closeTurnTo264)return;this.turnToH264(Yn.AUDIO_FAST);break;case 22:if(this.reportError(Yn.VIDEO_FAST),1==f.a._closeTurnTo264)return;this.turnToH264(Yn.VIDEO_FAST);break;case 23:let a=e.data.width,h=e.data.height;n.a.log("H265Player.onMessage 23 width=".concat(a," height = ").concat(h)),this.mse.setResolution&&this.mse.setResolution(a,h);break;case 24:if(this.mse&&e&&e.d){this.mse.setVideoCurrentTimeHand(e.d.minusBuffer,e.d.bufLen,e.d.type,e.d.timeNow);let t=this.getPts();0!=t&&this.storeAudioDts(t)}break;case 25:this.isHidden&&this.rafTimer();break;case 26:this.workerSharedArrayBuffer=e.d.workerSharedArrayBuffer;break;case 27:if(this.mse.isLive&&this.mse.onWasmRenderCallback&&this.mse.onWasmRenderCallback(),this.mse.isLive&&o.a.renderStat[0]){const t=this.getVideoPts();this.mse.videoPlayConsuming.addRenderFrameData(t,_.a.now()),this.mse.audioPlayConsuming.addRenderFrameData(t,_.a.now()),this.mse.renderFps.addRender()}break;case 28:this.setFramePause(i);break;case 29:this.setFrameRusume(i);break;case 30:1==o.a.mobVBlockCfg&&(this.isRenderFpsPaused=!0)}}setFramePause(t){this.isFramePaused||(this._playMobPause(t),this.isFramePaused=!0)}setFrameRusume(t){this.isFramePaused&&(this._playMobResume(t),this.isFramePaused=!1)}triggerWasmPlay(){!this.isWasmPlay&&this.videoPlayerElement&&(this.videoPlayerElement.play(),this.isWasmPlay=!0)}getRenderElement(){return this.isSupportVideoTrack?this.videoPlayerElement:null}_initDecodeWorker(t){let e=new SharedArrayBuffer(1024);this.mainSharedArrayBuffer=new Uint32Array(e),this.decoder.postMessage({t:16,d:this.mainSharedArrayBuffer})}rafFrame(){1==Number(f.a._print265RenderInterval)&&!this.isRenderInterval&&this.decoder&&(this.isRenderInterval=!0,this.isNotRenderInterval=!1,this.decoder.postMessage({t:14,d:0})),0==Number(f.a._print265RenderInterval)&&!this.isNotRenderInterval&&this.decoder&&(this.isNotRenderInterval=!0,this.isRenderInterval=!1,this.decoder.postMessage({t:14,d:1})),this.rafFrameBind&&(this.rafId=Ts(this.rafFrameBind)),this.rafTimer()}rafTimer(){let t=_.a.now();(0==this.rafLastNow||t-this.rafLastNow>=100)&&!this.userPaused&&this.isH265Played&&(this.pauseHanlder.check(t),this.rafLastNow=t),this.storeMainBuffer(),this.getFps()}getFps(){if(!this.mse.parser.fps)return;let t=_.a.now();if(t-this.updteFpsTime>=1e3){if(this.fpsList.length>=5){let t=0;this.fpsList.forEach(e=>{t+=e});let e=Math.floor(1e3/(t/5));this.avgFrameGap=e>this.avgFrameGap?this.avgFrameGap:e,this.decoder.postMessage({t:9,d:this.avgFrameGap}),this.fpsList.length=0}else this.fpsList.push(this.mse.parser.fps.getFps());this.updteFpsTime=t}}check500Pause(){1!=o.a.pause500Cfg&&this.pause500Cnt++}getStats(t){let e=_.a.now();t?(this._checkPaused(e,Ks),this._checkMobPaused(e,Ks)):(this._checkPaused(e,Ys),this._checkMobPaused(e,Ys));let i=this.stat.getStat();i.decoded=[].slice.call(this.decodedStat),i.render=[].slice.call(this.renderStat),i.toDecode=[].slice.call(this.toDecodeStat),i.frameList=[].slice.call(this.rafStat),i.deltaList=[...this.avDeltaList],i.rawListWorker=[].slice.call(this.rawListStat);let s="H265Player.getStats\n";for(let t in i)s+="".concat(t,": ").concat(i[t].toString(),"\n");n.a.log(s),this.avDeltaList.length=0;let r={frameListLen:this.frameList.length,statProps:i,h265PauseCnt:this.pauseCnt,videoPauseCnt:this.videoPauseCnt,videoPauseTime:this.pauseTime,isVideoPaused:this.pauseStartTs>0,hiddenTime:0==this.hiddenStartTs?0:e-this.hiddenStartTs,pause500CntH265:this.pause500Cnt,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPaused};return this.isRenderFpsPaused=!1,this.pauseMobCnt=0,this.resetStats(),r}resetStats(){this.pauseCnt=0,this.videoPauseCnt=0,this.pauseTime=0,this.renderStat.length=0,this.decodedStat.length=0,this.toDecodeStat.length=0,this.frameListStat.length=0,this.rafStat.length=0,this.rawListStat.length=0,this.pause500Cnt=0}pushVideoFrame(t){if(!this.isPlaying)return;if(this.isH265Error)return;let e,i=_.a.now();for(this.stat.inc([Jn.TYPES.rawList],[t.samples.length]);t&&t.samples&&t.samples.length;){e=t.samples.shift();let i={units:e.units,dtsInMs:e.dts/90,ptsInMs:e.pts/90,key:e.key?1:0};this.currentVideoDts=e.dts/90,this.isFirsrToDecode||(this.toDecodeStamp=Date.now(),this.isFirsrToDecode=!0),1==Number(f.a._printH265VideoFrame)&&n.a.log("H265Player.pushVideoFrame objData",i),this.decoder.postMessage({t:4,d:i})}this.mse.isLive&&this.mse.videoPlayConsuming.pushRemuxedVideoFrameData(i),this.pushVideoTime=i}toHexString(t){return Array.prototype.map.call(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join(" ")}getPts(){if(o.a.dtsJumpOpen){if(this.mse&&this.mse.getCorrentCurrentDts)return this.mse.getCorrentCurrentDts()}else if(this.mse&&this.mse.getCurrentDts)return this.mse.getCurrentDts();return 0}getCurrentTime(){return this.mse&&this.mse.getCurrentTime?this.mse.getCurrentTime():0}getInitDts(){return this.mse&&this.mse.getInitDts?this.mse.getInitDts():0}autoReport(){1==o.a.isAutoH265&&this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&(n.a.log("H265Player.autoReport"),this.mse.handler.eventEmitter.trigger(m.P2P_REPORT))}destroy(){this.delTimer(),this.delEvents(),this.resetStats(),n.a.log("H265Player.destroy, rafid=",this.rafId),Ps(this.rafId),this.rafId=null,clearInterval(this.timerHandler),this.decoder&&this.decoder.postMessage({t:6}),this.isH265Played=!1,this.resetProps(),this.mse=null,this.pauseDecode=!1,this.stat.reset(),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,0,0)}onDecodeError(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;n.a.error("H265Player.onDecodeError desc",i,e),7==e?(this.reportError(Yn.WASM_TIMEOUT),this.turnToH264(Yn.WASM_TIMEOUT)):(this.autoReport(),this.handlerError(Yn.DECODE_ERROR,e))}onRenderError(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;n.a.error("H265Player.onRenderError desc",i,e),this.handlerError(Yn.RENDER_ERROR)}turnToH264(t){this.mse&&this.mse.turnToH264(t)}retry(){if(this.mse&&this.mse.handler){let t=this.mse.handler.playerType;t==w.FLV?this.retryFlvTimes++:t==w.P2P?this.retryP2PTimes++:t==w.HLS&&this.retryHlsTimes++}this.mse&&this.mse.h265Retry()}handlerError(t,e){if(this.isPlaying&&(n.a.log("H265Player.handlerError",t),this.reportError(t,e),this.mse&&this.mse.handler)){let t=this.mse.handler.playerType;t==w.FLV?this.retryFlvTimes>=10?this.turnToH264(Yn.RETRY_MAX):this.retry():t==w.P2P?this.retryP2PTimes>=10?this.turnToH264(Yn.RETRY_MAX):this.retry():t==w.HLS&&(this.retryHlsTimes>=10?this.turnToH264(Yn.RETRY_MAX):this.retry())}}reportError(t,e){if(this.isPlaying&&(this.isH265Error=!0,n.a.log("H265Player.reportError",t,Yn.dic[t]),this.mse&&this.mse.handler)){let i={value:[1],str:[t,null!=e?e:1e4]};this.mse.handler.tsdb.sendMetrics([this.mse.handler.stat.createAct(d.a.ACT.H265_STATUS,i)])}}reportDecodeRenderTime(t,e){if(n.a.log("H265Player.reportDecodeRenderTime",t,e),this.mse&&this.mse.handler){let i={value:[t,e]};this.mse.handler.tsdb.sendMetrics([this.mse.handler.stat.createAct("pcdn_video_load_ts",i)])}}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.canvas)return;const e=this.canvas.clientWidth,i=this.canvas.clientHeight;t.width=e,t.height=i,this.decoder&&this.decoder.postMessage({t:15,d:t})}storeMainBuffer(){let t=this.getPts(),e=this.getCurrentTime();this.mainSharedArrayBuffer&&this.isPlaying&&(Atomics.store(this.mainSharedArrayBuffer,0,t),this.canvas&&(Atomics.store(this.mainSharedArrayBuffer,1,this.canvas.clientWidth),Atomics.store(this.mainSharedArrayBuffer,2,this.canvas.clientHeight)),Atomics.store(this.mainSharedArrayBuffer,4,e))}storeAudioDts(t){this.mainSharedArrayBuffer&&this.isPlaying&&Atomics.store(this.mainSharedArrayBuffer,0,t)}jumpBuffer(t,e,i,s){this.decoder&&this.decoder.postMessage({t:17,d:{minusBuffer:t,bufLen:e,type:i,timeNow:s}})}onVideoPause(){n.a.log("H265Player.onVideoPause"),this.userPaused=!0,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,3,1)}onVideoPlay(){this.pushVideoTime=0,n.a.log("H265Player.onVideoPlay"),this.userPaused=!1,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,3,0)}getVideoPts(){return this.workerSharedArrayBuffer?Atomics.load(this.workerSharedArrayBuffer,5):0}_playPause(t){this.pauseStartTs=t}_playResume(t,e){this._checkPaused(t,qs)}_playMobPause(t){this.pauseMobStartTs=t,this.pauseMobCnt++,n.a.log("H265Player._playMobPause,pauseMobStartTs=",this.pauseMobStartTs)}_playMobResume(t,e){n.a.log("H265Player._playMobResume"),this._checkMobPaused(t,qs)}_checkMobPaused(t,e){this.pauseMobStartTs>0&&(this.pauseMobStartTs=e===Ys?t:0)}_checkPaused(t,e){if(this.pauseStartTs>0){let i=t-this.pauseStartTs;i>=200&&(n.a.warn("H265Player._checkPaused type=".concat(e," pauseTime=").concat(i)),this.videoPauseCnt++,this.pauseTime+=i),this.pauseStartTs=e===Ys?t:0}}onVideoSeek(t){n.a.log("H265Player.onVideoSeek",this.getPts())}seek(t){const e=this.getCurrentTime();t*=1e3;const i=this.getInitDts();n.a.log("H265Player.seek curTime=".concat(e,", time=").concat(t,", initDts=").concat(i)),this.decoder&&this.decoder.postMessage({t:18,d:{curTime:e,time:t,initDts:i}}),this.storeAudioDts(e+i)}onEnded(){this.hlsStarted=!1}onStarted(){this.hlsStarted=!0}_getPlayerType(){if(this.mse&&this.mse.handler){let t=this.mse.handler.playerType;t==w.FLV?this.retryFlvTimes++:t==w.P2P?this.retryP2PTimes++:t==w.HLS&&this.retryHlsTimes++}}on265StartCodeError(){this.isH265Error||(this.isH265Error=!0,this.handlerError(Yn.START_CODE_ERROR),this.turnToH264(Yn.START_CODE_ERROR))}getCurrentVideoTime(){return this.getVideoPts()-this.getInitDts()}getVideoBufferLen(){return 0==this.currentVideoDts?0:(this.currentVideoDts-this.getVideoPts())/1e3}}(t,e),this._h265StatReport=new Xn({stat:t,tsdb:e,vodStat:i},this),this._renderInited=!1,this._rendering=!1,this._isH265WasmCodec=!0,this._isH265Stream=!1,this._isLive=!0,this.decodeType="wasm"}set isLive(t){this._isLive=t}set isH265Stream(t){this._isH265Stream=t}stop(){n.a.log("H265Proxy.stop"),this._isH265Stream=!1,this._rendering=!1,this._renderInited=!1,this._decoder&&this._decoder.stopDecoder(),this._render&&this._render.destroy&&this._render.destroy()}destroy(){this._render&&(this._render.destroy(),this._support.destroy(),this._decoder.destroy(),this._h265StatReport.destroy(),this._stat=null,this._tsdb=null,this._vodStat=null,this._render=null,this._support=null,this._decoder=null,this._h265StatReport=null,this._isH265Stream=!1)}initSupport(t){this._support&&(this._isH265Stream=!1,this._support.init(t))}loadDecoder(t,e){this._decoder.load(t,e)}initRender(t){this.isSupported&&(this._isLive||this._isH265Stream)&&(n.a.log("H265Proxy.initRender isSupported=".concat(this._support.isSupported," isReady=").concat(this._decoder.isReady)),this._rendering=!1,this._renderInited=!1,this._render.destroy(),this.isReady&&(this._renderInited=!0,this._render.attachMse(t)))}terminate(){this._decoder.terminate()}containerResize(t){this.rendering&&this._render.containerResize(t)}pushVideoFrame(t,e){this._rendering=!0,this._render&&this._render.pushVideoFrame(t,e)}onTurnToH264(t){this._rendering=!1,this._renderInited=!1,this._support.onTurntoH264(t)}checkUrl(t){this.isReady&&-1===t.url.indexOf("codec=265")&&(t.url+="&codec=265")}on265StartCodeError(){this._render&&this._render.on265StartCodeError()}reportDecodeRenderTime(t,e){this._render&&this._render.reportDecodeRenderTime(t,e)}getStats(){return this._render&&this._render.getStats()}jumpBuffer(t,e,i,s){this._rendering&&this._render.jumpBuffer(t,e,i,s)}seek(t){this._render&&this._render.seek&&this._render.seek(t)}onVideoPause(){this._render.onVideoPause()}onVideoPlay(){this._render.onVideoPlay()}onVideoSeek(t){this._render&&this._render.onVideoSeek&&this._render.onVideoSeek(t)}onStarted(){this._render&&this._render.onStarted()}onEnded(){this._render&&this._render.onEnded()}getCurrentVideoTime(){return this._render&&this._render.getCurrentVideoTime?this._render.getCurrentVideoTime():0}getVideoBufferLen(){return this._render&&this._render.getVideoBufferLen?this._render.getVideoBufferLen():0}getRenderElement(){return this._render&&this._render.getRenderElement?this._render.getRenderElement():null}get render(){return this._render}get canvas(){return this._render.videoPlayerElement?this._render.videoPlayerElement:this._render.canvas}get isVideoTrack(){return this._render.isSupportVideoTrack}get decoder(){return this._decoder}get isSupported(){return this._support&&this._support.isSupported}get isReady(){return this._support&&this._support.isSupported&&this._decoder.isReady}get needPreload(){return!Kn.preloaded&&this._support.canPreload&&!this._decoder.isReady}get renderInited(){return this._renderInited}get rendering(){return this._rendering}get h265StatReport(){return this._h265StatReport}get h265Support(){return this._support}get isServerSupported(){return this._support&&this._support.serverSupported}},Zn=class{constructor(t,e,i){this._stat=t,this._vodStat=i,this._tsdb=e,this._support=new Gn(t,e),this._h265StatReport=new Xn({stat:t,tsdb:e,vodStat:i},this),this._isH265MseCodec=!0,this._mse=null,this.decodeType="mse_hevc"}stop(){n.a.log("H265MseProxy.stop")}destroy(){this._support&&this._support.destroy(),this._h265StatReport&&this._h265StatReport.destroy(),this._stat=null,this._tsdb=null,this._vodStat=null,this._support=null,this._h265StatReport=null,this._mse=null}initSupport(t){this._support.mseHevcInit(t)}initRender(t){this._mse=t}checkUrl(t){-1===t.url.indexOf("codec=265")&&(t.url+="&codec=265")}turnToH264(t){this._mse&&this._mse.turnToH264(t)}reportError(t,e){n.a.log("H265MseProxy.reportError",t,Yn.dic[t]),this._tsdb.sendMetrics([this._stat.createAct(d.a.ACT.H265_STATUS,{value:[1],str:[t,null!=e?e:1e4]})])}onTurntoH265Wasm(t){this._support.onTurntoH265Wasm(t)}onTurnToH264(t){this._support.onTurntoH264(t)}on265StartCodeError(){this.reportError(Yn.START_CODE_ERROR),this.turnToH264(Yn.START_CODE_ERROR)}get isSupported(){return this._support&&this._support.isSupported}get h265StatReport(){return this._h265StatReport}get h265Support(){return this._support}get isH265MseCodec(){return this._support&&this._support.isSupported}get isServerSupported(){return this._support&&this._support.serverSupported}},th=s(19),eh=new class extends Ht{constructor(){super(),this.loadCount=0,this.libName="mainlib.js",this.loaded=!1,this.p2pLib=null,this.ON_LOAD="on_mainlib_load",this.callbacks={onLoaded:this.onLoaded,onError:this.onLoadedError,thisObj:this}}hasLib(){return null!==window.MainLib}loadLib(t){this.loadCount>=3?Qi(this.libName,this.callbacks):(this.loadCount++,t?(this.root=t,this.loaded?this.trigger(this.ON_LOAD):Ji(t,this.libName,this.callbacks)):n.a.warn("MainLibProxy.loadLib root none"))}onLoadedError(){this.loadLib(this.root)}onLoaded(){Qi(this.libName,this.callbacks),window.MainLib&&(this.loaded=!0,this.mainlib=new MainLib({UserInfo:v.a,roomInfo:null,config:o.a,TafLink:th.default,Timer:X,TimeUtil:_.a,logger:n.a,HUYA:tt.HUYA,Taf:tt.TafBase,hyPlayer:this.hyPlayer,Const:N.a,Event:u,StatCfg:d.a,P2PLibProxy:Cr,Ntp:Ft,AverageCalculator:O,NtpInfo:nr,Utils:R.b,ProtoLink:pt,Status:p,MetadataTick:rt,AacFrame:Vr,MSEPlayer:to}),this.trigger(this.ON_LOAD))}},ih=class{constructor(t){this.handler=t,this.libLoaded=!1,this.StreamPlayer=null,this.playInfo=null,eh.on(eh.ON_LOAD,this.onLoadLib,this)}onLoadLib(){this.libLoaded=!0,this.play(this.playInfo)}play(t){this.playInfo=t,(this.libLoaded||eh.loaded)&&(t._statQps=new Z({presenterUid:t.presenterUid,lineType:t.lineType}),this.StreamPlayer=new window.MainLib.StreamPlayer(this.handler),this.StreamPlayer.start(t))}stop(){this.reset(),this.StreamPlayer&&this.StreamPlayer.stop()}reset(){}},sh=class{constructor(t){this.handler=t,this.libLoaded=!1,this.huyaMgr=null,this.voiceStreamMgr=null,this.liveMeetingMgr=null,this.pureAudioMgr=null,this.startVoiceInfo=null,this.liveMeetingObj=null,this.auidoInfos=null,this.meetingStatByUidRsp=null,this.isLiveMeeting=!1,this.isPlayAudio=!1,this.isVoice=!1,this.isSetMeetingStat=!1,eh.on(eh.ON_LOAD,this.onLoadLib,this)}destroy(){eh.off(eh.ON_LOAD,this.onLoadLib,this),this.handler=null,this.huyaMgr=null,this.voiceStreamMgr=null,this.liveMeetingMgr=null,this.pureAudioMgr=null,this.startVoiceInfo=null,this.liveMeetingObj=null,this.auidoInfos=null,this.meetingStatByUidRsp=null}init(){(this.libLoaded||eh.loaded)&&this.createVoice()}createVoice(){try{this.huyaMgr||(this.huyaMgr=new window.MainLib.HuyaMgr(this.handler),this.voiceStreamMgr=new window.MainLib.VoiceStreamMgr(this.handler,this.huyaMgr),this.liveMeetingMgr=new window.MainLib.LiveMeetingMgr(this.handler,this.huyaMgr),this.pureAudioMgr=new window.MainLib.AudioMgr(this.handler,this.huyaMgr))}catch(t){n.a.error("VoiceMgr.createVoice",t)}}onLoadLib(){this.libLoaded=!0,this.createVoice(),this.loadedPlay()}loadedPlay(){(this.libLoaded||eh.loaded)&&(this.isVoice&&this.startVoiceStreamMgr(this.startVoiceInfo),this.isLiveMeeting&&this.startLiveMeeting(this.liveMeetingObj.presenterUid,this.liveMeetingObj.sid,this.liveMeetingObj.subSid),this.isPlayAudio&&this.updateAudioPlay(this.auidoInfos),this.isSetMeetingStat&&this.setMeetingStat())}startVoiceStreamMgr(t){this.isVoice=!0,this.startVoiceInfo=t,(this.libLoaded||eh.loaded)&&(this.voiceStreamMgr&&this.voiceStreamMgr.getLivingStreamInfo(t),this.isVoice=!1)}startLiveMeeting(t,e,i){this.isLiveMeeting=!0,this.liveMeetingObj={presenterUid:t,sid:e,subSid:i},(this.libLoaded||eh.loaded)&&(this.liveMeetingMgr&&this.liveMeetingMgr.start(t,e,i),this.isLiveMeeting=!1)}setMeetingStat(t){this.isSetMeetingStat=!0,this.meetingStatByUidRsp=t,(this.libLoaded||eh.loaded)&&(this.liveMeetingMgr&&this.liveMeetingMgr.setMeetingStat(t),this.isSetMeetingStat=!1)}updateAudioPlay(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.isPlayAudio=!0,this.auidoInfos=t,(this.libLoaded||eh.loaded)&&(this.pureAudioMgr&&this.pureAudioMgr.updateAudioPlay(t),this.isPlayAudio=!1)}stop(){this.reset()}reset(){this.startVoiceInfo=null,this.liveMeetingObj=null,this.auidoInfos=null,this.meetingStatByUidRsp=null}},rh=class{constructor(t){this.handler=t,this.libLoaded=!1,this.videoPixelate=null,this.miniVideoPixelate=null,this.videoPixelateBox=null,this.mutilVideoPixelateBox1=null,this.mutilVideoPixelateBox2=null,this.mutilVideoPixelateBox1Sizes={width:0,height:0},this.mutilVideoPixelateBox2Sizes={width:0,height:0},this.playInfo=null,this.fpsList=[],this.grassMode=!0,this.grassModeCheckStartTime=2e4,this.videoStartTime=0,this.needCheckGrassMode=!0,this.grassModeRecorded=!1,eh.on(eh.ON_LOAD,this.onLoadLib,this),this.onResolutionChangeBind=this.onResolutionChange.bind(this),this.handler.on(m.VIDEO_RESOLUTION_CHANGE,this.onResolutionChangeBind),this.multiVideoRenderRects=[],this._isMultiVideo=!1,this._multiVideoScale=null}destroy(){eh.off(eh.ON_LOAD,this.onLoadLib,this),this.handler&&this.handler.off(m.VIDEO_RESOLUTION_CHANGE,this.onResolutionChangeBind),this.handler=null,this.fpsList=null}onLoadLib(){this.libLoaded=!0,this.init()}init(){this.videoPixelate||(this.videoPixelate=new window.MainLib.VideoPixelateUtil(this.handler,this.handler.stat),this.miniVideoPixelate=new window.MainLib.VideoPixelateUtil(this.handler,this.handler.stat),this.playInfo&&this.setEnablePixelate(this.playInfo),this.mutilVideoPixelateBox1?this.setDoubleScreenPixelateBox(this.videoPixelateBox,this.mutilVideoPixelateBox2):this.videoPixelateBox&&this.setVideoPixelateBox(this.videoPixelateBox),this.videoPixelate&&this.videoPixelate.setMosaicGlassAllow&&(this.grassMode=!this.getgrassModeRecorded(),this.videoPixelate.setMosaicGlassAllow(this.grassMode)))}setIsMultiVideo(t,e){this._isMultiVideo=t,this._multiVideoScale=e}setVideoPixelate(){if(this.handler.player&&this.handler.player.mse&&this.videoPixelate&&this.videoPixelateBox){const t=this.handler.player.mse||{},e=this.videoPixelateBox;this.videoPixelate.setVideoPixelateBox({viewElm:e,mse:t})}}setMultiVideoPixelate(){if(this.handler.player&&this.handler.player.mse&&this.videoPixelate&&this.mutilVideoPixelateBox1){const t=this.handler.player.mutilVideo.getCanvas1Info()||{},e=this.mutilVideoPixelateBox1;this.videoPixelate.setVideoPixelateBox({viewElm:e,mse:t});const i=this.handler.player.mutilVideo.getCanvas2Info()||{},s=this.mutilVideoPixelateBox2;this.miniVideoPixelate.setVideoPixelateBox({viewElm:s,mse:i})}}setVideoPixelateBox(t){this._isMultiVideo?n.a.log("video isMultiVideo box"):t?(this.videoPixelateBox=t,(this.libLoaded||eh.loaded)&&this.setVideoPixelate()):n.a.warn("video pixelate box is null")}setDoubleScreenPixelateBox(t,e){t?(this.mutilVideoPixelateBox1=t,this.mutilVideoPixelateBox2=e,this.addTimer(),this.setMultiVideoPixelate()):n.a.warn("video box1 pixelate box is null")}updateMultivideoRenderRects(t){let[{videoX:e,videoY:i,width:s,height:r}]=t;this.multiVideoRenderRects=[{videoX:e,videoY:i,width:s,height:r}]}setEnablePixelate(t){this.playInfo=t,(this.libLoaded||eh.loaded)&&(this.videoPixelate&&this.videoPixelate.setEnablePixelate(t),this.miniVideoPixelate&&this.miniVideoPixelate.setEnablePixelate(t))}containerResize(t){!this._isMultiVideo&&this.videoPixelate&&this.videoPixelate.containerResize(t)}containerResizeNew(t){if(this.mutilVideoPixelateBox1&&this.mutilVideoPixelateBox1.clientWidth&&this.mutilVideoPixelateBox1.clientHeight){let t={},e=this.mutilVideoPixelateBox1.clientWidth,i=this.mutilVideoPixelateBox1.clientHeight;t.width=e,t.height=i,this._isMultiVideo&&this.videoPixelate&&this.videoPixelate.containerResize(t),this.mutilVideoPixelateBox1Sizes=t}}miniContainerResizeNew(t){if(this.mutilVideoPixelateBox2&&this.mutilVideoPixelateBox2.clientWidth&&this.mutilVideoPixelateBox2.clientHeight){let t={},e=this.mutilVideoPixelateBox2.clientWidth,i=this.mutilVideoPixelateBox2.clientHeight;t.width=e,t.height=i,this._isMultiVideo&&this.miniVideoPixelate&&this.miniVideoPixelate.containerResize(t),this.mutilVideoPixelateBox2Sizes=t}}addTimer(){this.removeTimer(),X.add(this.onCheckTimer,this,50)}removeTimer(){X.remove(this.onCheckTimer,this,50)}onCheckTimer(){this._isMultiVideo&&(!this.mutilVideoPixelateBox1||this.mutilVideoPixelateBox1Sizes.width==this.mutilVideoPixelateBox1.clientWidth&&this.mutilVideoPixelateBox1Sizes.height==this.mutilVideoPixelateBox1.clientHeight||this.containerResizeNew(),!this.mutilVideoPixelateBox2||this.mutilVideoPixelateBox2Sizes.width==this.mutilVideoPixelateBox2.clientWidth&&this.mutilVideoPixelateBox2Sizes.height==this.mutilVideoPixelateBox2.clientHeight||this.miniContainerResizeNew())}pushVideoPixlateInfo(t){if(this._isMultiVideo&&this._multiVideoScale&&this._multiVideoScale.scale1&&this.handler.player&&this.handler.player.mutilVideo){let e=JSON.parse(JSON.stringify(t)),i=t.shapeInfos;i.frame_height=i.frame_height*this._multiVideoScale.scale1.hs,i.frame_width=i.frame_width*this._multiVideoScale.scale1.ws;for(let t=0;t<i.contrs.value.length;t++)(i.contrs.value[t].x>i.frame_width||i.contrs.value[t].y>i.frame_height)&&(i.contrs.value[t].x=i.contrs.value[t].y=i.contrs.value[t].w=i.contrs.value[t].h=0);this.clearUseLessInfo(i.contrs.value);let s=e.shapeInfos,r=this.handler.player.mutilVideo.getVideo2Rect(),a=r.originVideoWidth/s.frame_width,o={x:r.x,y:r.y,w:r.width,h:r.height};for(let t=0;t<s.contrs.value.length;t++){let e={x:s.contrs.value[t].x*a,y:s.contrs.value[t].y*a,w:s.contrs.value[t].w*a,h:s.contrs.value[t].h*a};if(this.checkMiniVideoPixelateInfo(e,o)){let i=this.getOverlapAndReset(o,e);s.contrs.value[t].x=i.x,s.contrs.value[t].y=i.y,s.contrs.value[t].w=i.w,s.contrs.value[t].h=i.h}else s.contrs.value[t].x=s.contrs.value[t].y=s.contrs.value[t].w=s.contrs.value[t].h=0;s.frame_width=r.width,s.frame_height=r.height}this.clearUseLessInfo(s.contrs.value),n.a.log("miniVideoPixelate",e),this.miniVideoPixelate&&this.miniVideoPixelate.pushVideoPixlateInfo(e)}this.videoPixelate&&this.videoPixelate.pushVideoPixlateInfo(t)}clearUseLessInfo(t){for(let e=t.length-1;e>0;e--)0!=t[e].w&&0!=t[e].h||t.splice(e,1)}getOverlapAndReset(t,e){let i=Math.max(t.x,e.x),s=Math.max(t.y,e.y),r=Math.min(t.x+t.w,e.x+e.w)-i,a=Math.min(t.y+t.h,e.y+e.h)-s;return r<=0||a<=0?{x:0,y:0,w:0,h:0}:{x:i-t.x,y:s-t.y,w:r,h:a}}checkMiniVideoPixelateInfo(t,e){return!(t.x+t.w<=e.x||e.x+e.w<=t.x||t.y+t.h<=e.y||e.y+e.h<=t.y)}setVideoPixelateData(t){this._isMultiVideo&&this.miniVideoPixelate&&this.miniVideoPixelate.setVideoPixelateData&&this.miniVideoPixelate.setVideoPixelateData(t),this.videoPixelate&&this.videoPixelate.setVideoPixelateData&&this.videoPixelate.setVideoPixelateData(t)}onResolutionChange(){if(this.videoPixelateBox&&this.videoPixelateMgr){const t=this.videoPixelateBox.clientWidth,e=this.videoPixelateBox.clientHeight;n.a.log("VideoPixelateMgr.onResolutionChange",t,e),this.containerResize({width:t,height:e}),this.videoPixelateMgr.updateMultivideoRenderRects(this.multiVideoRenderRects)}}getMosaicStat(){return this.videoPixelate&&this.videoPixelate.getMosaicStat?this.videoPixelate.getMosaicStat():null}getMosaicGrassMode(){return this.videoPixelate&&this.videoPixelate.getUseMosaicGrass?this.videoPixelate.getUseMosaicGrass()?1:2:this.grassModeAllow?1:2}destory(){this.videoPixelate&&this.videoPixelate.destory(),this.removeTimer(),this.miniVideoPixelate&&this.miniVideoPixelate.destory(),this._isMultiVideo=!1,this.playInfo=null}resetData(){this.videoPixelate&&this.videoPixelate.resetData&&this.videoPixelate.resetData()}onVisibilitychange(t){this.videoPixelate&&this.videoPixelate.onVisibilitychange&&this.videoPixelate.onVisibilitychange(t),this.fpsList=[]}setVideoStart(){this.videoStartTime=this.getWindowsTime()}updateCurrentPageRenderFps(t){this.grassModeRecorded||this.getWindowsTime()-this.videoStartTime>this.grassModeCheckStartTime&&(this.fpsList.push(t),this.fpsList.length>=10&&this.checkGrassMode())}checkGrassMode(){let t=!1;if(navigator.hardwareConcurrency>2)for(let e=this.fpsList.length-1;e>this.fpsList.length-10;e--)if(this.fpsList[e]>this.handler.config.grassModeAllowFPS){t=!0;break}this.grassMode=t,this.videoPixelate&&this.videoPixelate.setMosaicGlassAllow&&this.videoPixelate.setMosaicGlassAllow(t),this.fpsList&&this.fpsList.length>11&&this.fpsList.shift(),this.grassMode||this.setgrassModeRecorded(this.getWindowsTime())}getgrassModeRecorded(){try{let t=f.a._recordGrass;!t||this.getWindowsTime()-t>864e5*this.handler.config.mosaicGrassExpired?(this.grassModeRecorded=!1,this.setgrassModeRecorded(0)):this.grassModeRecorded=!0}catch(t){}return this.grassModeRecorded}setgrassModeRecorded(t){try{f.a._recordGrass=t,t>0&&(this.grassModeRecorded=!0)}catch(t){}}setGrassModeMetric(){this.stat.createAct(Main.StatCfg.ACT.USED_XP2P,{value:[suc,dtsType,curDts],str:[pixelateKey,buss]})}getWindowsTime(){return(new Date).getTime()}},ah=class{constructor(t,e){this.handler=t,this.stat=e,this.streamName="",this.muteData=[],this.cacheData=[]}destroy(){this.handler=null,this.stat=null,this.muteData=[],this.cacheData=[]}unescapeHTML(t){return R.b.unescapeHTML(t)}sendMuffledMessageAddStreamName(t){if(this.handler._type!==w.STREAM)if(t&&t.sMuteInfo){n.a.log("MuffleAudio._sendMuffledMessage ".concat(t.sMuteInfo));let e=JSON.parse(this.unescapeHTML(t.sMuteInfo));this.sendMuffledMessage(e.voiceEliminationData)}else n.a.log("MuffleAudio._sendMuffledMessage dataIsNull=".concat(!!t))}setStreamName(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.streamName=t}sendMuffledMessage(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.handler.player||!this.handler.player.player)return;let e=this.handler.player.player;e.voiceEliminationData||(e.voiceEliminationData=[]);const i=e.mse.getBufferLen();let s=this.handler.getCurrentDts(),r=this.handler.getCurrentSeiOffsetDts();t.length>0&&t.map(t=>{if(t.streamName==this.streamName){let a=!1;if(0===e.voiceEliminationData.length?a=!0:e.voiceEliminationData.map(e=>{e.type===t.type&&e.begin===t.begin&&e.end===t.end||(a=!0)}),a){if(this.reportMuffledDelay(r,s,t),e.voiceEliminationData.push(t),0==t.type){const t=s-r;this.cacheData.length>0&&t-this.cacheData[0].begin>=o.a.muteCfg[0]&&this.cacheData.shift()}else this.cacheData.length>0&&s-this.cacheData[0].begin>=o.a.muteCfg[0]&&this.cacheData.shift();n.a.log("MuffleAudio",t),this.cacheData.push(t);const a=t.end-t.begin;if(0==t.type){const e=t.begin+r,o=t.end+r;n.a.log("HYPlayer._sendMuffledMessage,bufer=".concat(i,",currentSeiOffsetDts:").concat(r,",currentDts:").concat(s,",beigin=").concat(e,",end=").concat(o,",delta=").concat(a),JSON.stringify(t))}else n.a.log("HYPlayer._sendMuffledMessage,bufferLen=".concat(i,",currentDts:").concat(s,",beigin=").concat(t.begin,",end=").concat(t.end,",delta=").concat(a),JSON.stringify(t))}}})}reportMuffledDelay(t,e,i){let s=i.begin,r=i.end,a=e;0==i.type&&(s+=t,r+=t,a=e-t);let h=0;e<=s?h=0:e>s&&e<r?h=2:e>=r&&(h=1);let l=[this.stat.createAct(d.a.ACT.MUTE_STATUS,{value:[h,i.type,a,i.begin,i.end],str:[i.reqKey]})];n.a.log("HYPlayer.reportMuffledDelay"),this.muteData.push({begin:i.begin,end:i.end,reqKey:i.reqKey,value:h,type:i.type,currentDts:a}),1==Number(o.a.isMuteAct)&&this.handler.sendMetrics(l)}getMuteStat(){let t=this.muteData;return this.muteData=[],{muteData:t}}getCacheData(){return[...this.cacheData]}resetData(){this.muteData.length=0,this.cacheData.length=0}},oh=class{constructor(t){this.eventEmitter=t,this.hasEvent=!1,this.isSupported=void 0!==document.addEventListener&&void 0!==document.hidden,this.onVisibilitychangeBind=this.onVisibilitychange.bind(this),this.stat=null,this.vodStat=null,this.hiddenTs=0,this.visibleTs=_.a.now(),this.lastStatHiddenTs=0}destroy(){this.delVisibilitychange(),this.eventEmitter=null,this.stat=null,this.vodStat=null}setStat(t,e){this.stat=t,this.vodStat=e,this.onVisibilitychange(),this.addVisibilitychange()}addVisibilitychange(){!this.hasEvent&&this.isSupported&&(this.hasEvent=!0,document.addEventListener("visibilitychange",this.onVisibilitychangeBind))}delVisibilitychange(){this.hasEvent&&(this.hasEvent=!1,document.removeEventListener("visibilitychange",this.onVisibilitychangeBind))}onVisibilitychange(){this.isSupported&&(n.a.log("Visibility.onVisibilitychange visibilityState=".concat(document.visibilityState)),this.stat&&this.stat.setComDim(d.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.vodStat&&this.vodStat.setComDim(d.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.eventEmitter.trigger(u.VISIBILITY_CHANGE,document.visibilityState),document.visibilityState===N.a.VISIBILITY_STATE.VISIBLE?(this.visibleTs=_.a.now(),this.eventEmitter.onVisibilitychange&&this.eventEmitter.onVisibilitychange(!0)):document.visibilityState===N.a.VISIBILITY_STATE.HIDDEN&&(this.hiddenTs=_.a.now(),this.eventEmitter.onVisibilitychange&&this.eventEmitter.onVisibilitychange(!1)))}setHiddenTimeStat(){if(this.isSupported){let t=_.a.now(),e=0;0!=this.hiddenTs&&(document.visibilityState===N.a.VISIBILITY_STATE.HIDDEN&&this.hiddenTs>=this.visibleTs?e=t-this.hiddenTs:document.visibilityState===N.a.VISIBILITY_STATE.VISIBLE&&t-this.visibleTs<t-this.lastStatHiddenTs&&0!=this.lastStatHiddenTs&&(e=this.visibleTs-this.hiddenTs)),this.stat&&this.stat.setCore(d.a.CORE.VISIBILITY_HIDDEN_TIME,e),this.lastStatHiddenTs=t}}};class nh{constructor(){this._buffer=-1}reset(){this._buffer=-1}get buffer(){return this._buffer}set buffer(t){(-1===this._buffer||t<this._buffer)&&(this._buffer=t<0?0:t)}}class hh{constructor(){this._badBuffer=new nh}reset(){this._badBuffer.reset()}setItem(t){this._badBuffer.buffer=t.badBuffer}setBuffers(t){this._badBuffer.buffer=t}get badBuffer(){return this._badBuffer.buffer}}class dh{constructor(){this.autoBuffer=new hh,this.videoBuffer=new hh}reset(){this.autoBuffer.reset(),this.videoBuffer.reset()}}var lh=class{constructor(){this.stat=null,this.endTs=0,this.pausedStartTs=0,this.isInTime=!1,this.switchType=0,this.switchCodecType=0,this.recordCodecType=0,this.heartType=0,this.monitorTime=Number(o.a.autoCfg.monitorTime),this.tempBuffer=new dh,this.usefulBuffer=new dh,this._continueBuffer=-1,this._badReasons=0,this._minReason=0}init(t){this.stat=t}start(t,e){0===this.endTs&&(this._badReasons=0,this._minReason=0),this.switchType=t,this.switchCodecType=e,n.a.log("AutoSwitchMonitor.start"),this.endTs=_.a.now()+this.monitorTime,this.pausedStartTs>0&&(this.isInTime=!0,this.tempBuffer.autoBuffer.setItem(this.tempBuffer.videoBuffer)),this._checkStat(),X.add(this.onCheckTimer,this,100)}_checkStat(){this.endTs>_.a.now()?(this.heartType=this._getHeartType(),this.recordCodecType=this.switchCodecType):(this.heartType=0,this.recordCodecType=0)}recordHeartType(){this.stat.setCoreDim(d.a.DIM_CORE.AUTO_HEART_TYPE,this.heartType),this.stat.setCoreDim(d.a.DIM_CORE.AUTO_CODEC_CHANGE_TYPE,this.recordCodecType),this.stat.setCoreDim(d.a.CORE.AUTO_BAD_BUFFER,this.usefulBuffer.autoBuffer.badBuffer),this.stat.setCoreDim(d.a.CORE.VIDEO_BAD_BUFFER,this.usefulBuffer.videoBuffer.badBuffer),this.stat.setCore(d.a.CORE.AUTO_CONTINUE_BUFFER,this._continueBuffer),this.usefulBuffer.reset(),this._continueBuffer=-1,this._checkStat()}_getHeartType(){return this.switchType===Ns.UP?1:2}destroy(){this.stat=null,X.remove(this.onCheckTimer,this),this.tempBuffer.reset(),this.usefulBuffer.reset()}stop(){this.endTs=0,X.remove(this.onCheckTimer,this)}addBadReason(t){this._badReasons|=t;let e=Math.log2(t)+1;(0===this._minReason||this._minReason>e)&&(this._minReason=e)}addSwitch(t,e,i,s){1===s&&(n.a.log("AutoSwitchMonitor.addSwitch, now=".concat(t,", value1=").concat(e,", value2=").concat(i,", value4=").concat(s)),this.stat.addCore(d.a.CORE.AUTO_SWITCH_CNT,1),e===i&&this.stat.addCore(d.a.CORE.AUTO_SWITCH_SAME_CNT,1),this.endTs>t&&(e===i&&this.stat.addCore(d.a.CORE.AUTO_BAD_SWITCH_SAME,1),this.switchType===Ns.UP&&this.stat.addCore(d.a.CORE.AUTO_BAD_SWITCH_UP,1),this.stat.addCore(d.a.CORE.AUTO_BAD_SWITCH,1)))}addBadQuality(t,e,i,s){n.a.log("AutoSwitchMonitor.addBadQuality isIntime=".concat(this.isInTime," pausedStartTs=").concat(this.pausedStartTs," endTs=").concat(this.endTs," now=").concat(t)),this.usefulBuffer.videoBuffer.setItem(this.tempBuffer.videoBuffer),this.isInTime&&(this.usefulBuffer.autoBuffer.setItem(this.tempBuffer.autoBuffer),this.stat.addCore(d.a.CORE.AUTO_BAD_QUALITY,1),this.stat.addCore(d.a.CORE.AUTO_BAD_DURATION,e),this.stat.setCoreDim(d.a.DIM_CORE.AUTO_BAD_REASON,this._badReasons),this.stat.setCoreDim(d.a.DIM_CORE.AUTO_BAD_MIN_REASON,this._minReason),this._continueBuffer=s,this.switchType===Ns.UP&&(this.stat.addCore(d.a.CORE.AUTO_BAD_QUALITY_UP,1),this.stat.addCore(d.a.CORE.AUTO_BAD_DURATION_UP,e))),i!==Ys&&(this.pausedStartTs=0,this.isInTime=!1),this.tempBuffer.reset()}onCheckTimer(t,e){t>=this.endTs&&(n.a.log("AutoSwitchMonitor.onCheckTimer stop."),this.stat.setCore(d.a.CORE.AUTO_BAD_DONE,1),this.stop())}resetPausedTs(){this.tempBuffer.reset(),this.pausedStartTs=0,this.isInTime=!1}setPause(t,e){n.a.log("AutoSwitchMonitor.setPause now=".concat(t," buffer=").concat(e," endTs=").concat(this.endTs)),this.pausedStartTs=t,this.tempBuffer.videoBuffer.setBuffers(e),this.endTs>t?(this.isInTime=!0,this.tempBuffer.autoBuffer.setBuffers(e)):this.isInTime=!1}reportDimPullStreamReason(t){null==t&&(t=14),n.a.log("AutoSwitchMonitor.reportDimPullStreamReason, type=".concat(t)),this.stat.setComDim(d.a.DIM_COM.PULLSTREAM_REASOM,t)}},ch=class{constructor(){this._sysMap=new Map}destroy(){this._sysMap.clear()}addItem(t,e,i){n.a.log("RecSysStat.addItem scene=".concat(t," now=").concat(_.a.now()," expiredTime=").concat(i));let s=this._sysMap.get(t);s||(s=new class{constructor(t){this.scene=t,this.sDispatchId="",this.expiredTime=0}isExpired(t){return t>this.expiredTime}}(t),this._sysMap.set(t,s)),s.sDispatchId=e,s.expiredTime=Number(i)||_.a.now()+6e4}removeItem(t){this._sysMap.delete(t)}recordAct(t){let e=this.getResult();e.length>0&&t.setActDim(d.a.DIM_CORE.DISPATCH_ID,e)}recordHeart(t){let e=this.getResult();e.length>0&&t.setCoreDim(d.a.DIM_CORE.DISPATCH_ID,e)}getResult(){let t=[],e=_.a.now();return this._sysMap.forEach(i=>{i.isExpired(e)||t.push("".concat(i.scene,":").concat(i.sDispatchId))}),t.join(",")}};const uh="force_auto_count",ph="force_auto_effective_time";var mh=class{constructor(t,e){this._h5Player=t,this._abConfig=e,this._forceCnt=0,this._sysForceCnt=0,this._effectiveTime=0,this._sysEffectiveTime=0,this._isInit=!1,this._closed=!1,this.onAutoForceRspBind=this.onAutoForceRsp.bind(this),t.on(m.AUTO_FORCE_RSP,this.onAutoForceRspBind)}destroy(){this._h5Player&&this._h5Player.off(m.AUTO_FORCE_RSP,this.onAutoForceRspBind),this._h5Player=null,this._abConfig=null}_init(){if(!this._isInit)if(this._isInit=!0,this._sysEffectiveTime>0?this._effectiveTime=this._sysEffectiveTime:this._effectiveTime=Number(o.a.force_auto_effective_time),this._sysForceCnt>0)this._forceCnt=this._sysForceCnt,n.a.log("AutoForce._init useSys");else{this._forceCnt=Number(o.a.force_auto_count);let t=[],e=this._abConfig.getConfig("quitAutoCount");null!==e&&(this._forceCnt=Number(e),t.push("_forceCnt=".concat(this._forceCnt)));let i=this._abConfig.getConfig("isWebAutoABBBB");null!==i&&(this._closed=1===i,t.push("isWebAutoAB=".concat(i))),n.a.log("AutoForce._init ".concat(t.join(" ")))}}onAutoForceRsp(t,e){let{force_auto_count:i,force_auto_effective_time:s}=e;n.a.log("AutoForce.onAutoForceRsp force_auto_count=".concat(i," force_auto_effective_time=").concat(s)),this._forceCnt=this._sysForceCnt=i,this._effectiveTime=this._sysEffectiveTime=1e3*s,this._checkEffective()}addForce(){let t=Number(f.a.getItem(uh))||0;f.a.setItem(uh,t+1),n.a.log("AutoForce.addForce forceCnt=".concat(t+1)),this._checkEffective()}_checkEffective(){(Number(f.a.getItem(uh))||0)>=this._forceCnt&&!f.a.hasOwnProperty(ph)&&(f.a.setItem(ph,Date.now()+this._effectiveTime),n.a.log("AutoForce._checkEffective cooling"))}getUseAuto(){if(this._init(),this._closed)return!1;if(f.a.hasOwnProperty(ph)){let t=Number(f.a.getItem(ph));if(Date.now()<t)return n.a.log("AutoForce.getUseAuto cooling!"),!1;f.a.removeItem(uh),f.a.removeItem(ph)}let t=Number(f.a.getItem(uh))||0;return n.a.log("AutoForce.getUseAuto forceCnt=".concat(t," _forceCnt=").concat(this._forceCnt)),t<this._forceCnt}},_h=class{constructor(){this._isInit=!1,this._mpConfig=null}destroy(){this._mpConfig=null}_init(){if(!this._isInit){n.a.log("AbConfigParser._init",f.a.abConfig),this._isInit=!0;try{let t=JSON.parse(f.a.abConfig);t&&t.mpConfig&&(this._mpConfig=t.mpConfig)}catch(t){n.a.log("AbConfigParser._init ".concat(t.message))}}}getConfig(t){return this._init(),this._mpConfig&&this._mpConfig.hasOwnProperty(t)?this._mpConfig[t]:null}},fh=class{constructor(t){this._abConfig=t,this._isInit=!1,this._pids=new Set,this._lines=new Set,this._bitrateMap=new Map}destroy(){this._abConfig=null,this._pids=null,this._lines=null,this._bitrateMap&&this._bitrateMap.clear(),this._bitrateMap=null}_init(){if(!this._isInit){n.a.log("BitrateChange._init"),this._isInit=!0;let t=this._abConfig.getConfig("pidList");null!==t&&0!==Number(t)&&t.split(",").forEach(t=>{this._pids.add(Number(t))});let e=this._abConfig.getConfig("lineList");null!==e&&0!==Number(e)&&e.split(",").forEach(t=>{this._lines.add(Number(t))});let i=this._abConfig.getConfig("bitrateList");null!==i&&0!==Number(i)&&(i=i.split(","),i.forEach(t=>{let e=t.split(":");this._bitrateMap.set(Number(e[0]),Number(e[1]))}))}}getBitrate(t,e,i){return this._init(),this._pids.has(Number(t))&&this._lines.has(Number(e))&&this._bitrateMap.has(Number(i))&&(i=this._bitrateMap.get(i)),i}},gh=class{constructor(t){this._abConfig=t,this._isInit=!1,this.streamNameTrickEnable=0,this.isImgPlusExp=!1,this.extStreamName=""}destroy(){this._abConfig=null}_init(){if(!this._isInit){n.a.log("StreamChange._init");try{if(this._isInit=!0,this.streamNameTrickEnable=this._abConfig.getConfig("streamNameTrickEnable"),0==this.streamNameTrickEnable)return;this.streamNameTrickConfig=JSON.parse(this._abConfig.getConfig("streamNameTrickConfig"))}catch(t){n.a.error("StreamChange._init error",t)}}}getStreamName(t,e,i){this._init();let s="";return 1==Number(this.streamNameTrickEnable)&&this.streamNameTrickConfig.map(r=>{let a=r.presenterUids,o=r.extStreamName;-1!=a.indexOf(Number(t))&&(this.isImgPlusExp=!0,this.extStreamName=r.extStreamName,-1==e.indexOf(o)&&(s=o),i&&(e=e.replace(o,""),s=""))}),e+s}},Sh=16384;const yh=["4090","4080","4070","4060","3090","3080","3070","3060","3050","2080","2070","2060","1660","1650","1080","1070","1060","1050","titan rtx","titan xp","titan x"];var Th=class{constructor(t,e,i){this.handler=t,this.stat=e,this.statVod=i,this.h5Root="",this.modelRes="live",this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.vFrames=0,this.vEnhanceDelay=-1,this.lastBitrate=-1,this.lastLine=-1,this.isCloseEnhance=!1,this.isLive=!0}isGpuSupport(){return!!navigator.gpu}resetProps(){this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.isCloseEnhance=!1}setInfo(t){t&&(-1!=this.lastBitrate&&this.lastBitrate!=t.curBitrate&&this.resetProps(),this.lastBitrate=t.curBitrate,-1!=this.lastLine&&this.lastLine!=t.lineType&&this.resetProps(),this.lastLine=t.lineType,this.h5Root=t.h5Root,t.liveType!=Fn.a.VOD&&t.liveType!=Fn.a.REPLAY||(this.h5Root="https://a.msstatic.com/huya/h5player/sdk_static/vod/1.0.1/",this.modelRes="vod"),f.a._h5Root&&(this.h5Root=f.a._h5Root),this._isGameIdSupport=!1,this.vGameId=t.gameId||0)}getConfigSupport(t){if(this.isCloseEnhance=!1,t.liveType==Fn.a.LIVE){let e=1==o.a.enhanceVCfg[0],i=t.curBitrate<=o.a.enhanceVCfg[1];if(this.isConfigSupport=e&&i,this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getMseAvcCfgHeight){const t=this.handler.player.mse.getMseAvcCfgHeight();t>o.a.enhanceVCfg[3]&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport height unsupport!",t)),this._isGameIdSupport=-1!==o.a.enhanceGameIds.indexOf(this.vGameId),this._isGameIdSupport&&o.a.enhanceGameIdRatioMap&&o.a.enhanceGameIdRatioMap[this.vGameId]&&-1===o.a.enhanceGameIdRatioMap[this.vGameId].indexOf(t)&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport game height unsupport!",t))}1==o.a.ehWhiteAnchoruids[0]&&-1===o.a.ehWhiteAnchoruids[1].indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport anchorUid white not support!")),-1!==o.a.eHBlackUids.indexOf(Number(t.uid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport uid black")),-1!==o.a.eHBlackAnchoruids.indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport anchorUid black")),-1!=o.a.eHBlackBrowVerList.indexOf(h.a.version.major)&&(n.a.log("VideoEnhance.getConfigSupport anchorUid black"),this.isConfigSupport=!1)}else if(t.liveType==Fn.a.REPLAY||t.liveType==Fn.a.VOD){this.isLive=!1;let e=1==o.a.enhanceVodVCfg[0],i=t.curBitrate<=o.a.enhanceVodVCfg[1];this.isConfigSupport=e&&i,this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getMseAvcCfgHeight&&this.handler.player.mse.getMseAvcCfgHeight()>o.a.enhanceVodVCfg[3]&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport height unsupport!")),1==o.a.ehVodWhiteAnchoruids[0]&&-1===o.a.ehVodWhiteAnchoruids[1].indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport anchorUid white not support!")),1==o.a.ehVodWhiteVids[0]&&-1===o.a.ehVodWhiteVids[1].indexOf(Number(t.vid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport vid white not support!")),-1!==o.a.eHVodBlackUids.indexOf(Number(t.uid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport uid black")),-1!==o.a.eHVodBlackAnchoruids.indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport anchorUid black")),-1!==o.a.eHVodBlackVids.indexOf(Number(t.vid))&&(this.isConfigSupport=!1,n.a.log("VideoEnhance.getConfigSupport vid black")),-1!=o.a.eHVodBlackBrowVers.indexOf(h.a.version.major)&&(n.a.log("VideoEnhance.getConfigSupport anchorUid black"),this.isConfigSupport=!1)}}getHardSupport(t){let e=this.isGpuSupport(),i=ct().toLowerCase(),s=-1!=i.indexOf("nvidia"),r=!1;yh.map(t=>{-1!=i.indexOf(t)&&(r=!0)}),t.liveType==Fn.a.LIVE?o.a.eHBlackRenderList.forEach(t=>{-1!=i.indexOf(t)&&(r=!1,n.a.log("VideoEnhance.getHardSupport renderList black"))}):o.a.eHVodBlackRenderList.forEach(t=>{-1!=i.indexOf(t)&&(r=!1,n.a.log("VideoEnhance.getHardSupport renderList black"))});let a=r,h=navigator.hardwareConcurrency>=o.a.enhanceVCfg[2];n.a.log("VideoEnhance.getHardSupport gpu=".concat(e,",gType=").concat(s,",gList=").concat(a,",hardWare=").concat(h)),this.isHardSupport=e&&s&&a&&h}getPlayTypeSupport(t){let e=this.handler.playerCoreType==N.a.PLAYER_CORE_TYPE.WEBCODECS;this.isPlayTypeSupport=e}getSupport(t){return!!t&&(1!=f.a._enableEnhance?(t.liveType==Fn.a.LIVE?(n.a.log("Config.enhanceGameIds",o.a.enhanceGameIds),this._isGameIdSupport=-1!==o.a.enhanceGameIds.indexOf(this.vGameId)):this._isGameIdSupport=-1!==o.a.enhanceVodGameIds.indexOf(this.vGameId),this.getConfigSupport(t),this.getHardSupport(t),this.getPlayTypeSupport(t),n.a.log("VideoEnhance.getSupport game=".concat(this._isGameIdSupport,",cfg=").concat(this.isConfigSupport,",hard=").concat(this.isHardSupport,",playType=").concat(this.isPlayTypeSupport,",errCnt=").concat(this.enhanceErrorCnt)),this.isHardSupport?(this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_ENTRY,1),this.vSupport=1,!this.isLive&&this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_ENTRY,1)):(this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_ENTRY,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_ENTRY,"0"),this.vSupport=0),this.isConfigSupport?this.isHardSupport?1!=this._isGameIdSupport?(this._isSupport=!1,this.onVideoEhanceError(10),void this.setUnSupportReport()):R.b.isWebcodecsBrowserSupported()?this.handler&&(this.handler.h265Proxy.isSupported&&1==f.a.isCloseWebcodecsH265||1==f.a.isCloseWebcodecsH264)?(this.onVideoEhanceError(14),this.setUnSupportReport(),void(this._isSupport=!1)):this.isPlayTypeSupport?this.enhanceErrorCnt>=3?(this._isSupport=!1,void this.onVideoEhanceError(8)):void(1!=f.a._closeLocalEnhance?this._isSupport=!0:this._isSupport=!1):(this.onVideoEhanceError(2),1==o.a.enhanceSupportMode&&this.setUnSupportReport(),void(this._isSupport=!1)):(this.onVideoEhanceError(15),this.setUnSupportReport(),void(this._isSupport=!1)):(this.onVideoEhanceError(1),this._isSupport=!1,void this.setUnSupportReport()):(this.onVideoEhanceError(11),this.setUnSupportReport(),void(this._isSupport=!1))):void(this._isSupport=!0))}setUnSupportReport(){this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_TYPE,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_TYPE,"0"),this.vEnhanceType=0}getModelRes(){const t=this.h5Root,e={lol_web:[7185,5485,5699,7,6203,9521,393],lol_web2:[1],kog_web:[2336],xingxiu_web:[1663,2168,2633],fps_web:[2793,3203,5937,862,4,2413,1964,1997,6219,7579,2,4921,9961,802,7601,1732]};let i=null;for(let t in e)-1!==e[t].indexOf(this.vGameId)&&(i=t);if(!i)return null;if(this.res={"360p":t+"models/".concat(this.modelRes,"/").concat(i,"/360p.bin"),"450p":t+"models/".concat(this.modelRes,"/").concat(i,"/450p.bin"),"720p":t+"models/".concat(this.modelRes,"/").concat(i,"/720p.bin"),"1080p":t+"models/".concat(this.modelRes,"/").concat(i,"/1080p.bin")},f.a._enhanceModelRes){const t=JSON.parse(f.a._enhanceModelRes);t["360p"]&&(this.res["360p"]=t["360p"]),t["450p"]&&(this.res["450p"]=t["450p"]),t["720p"]&&(this.res["720p"]=t["720p"]),t["1080p"]&&(this.res["1080p"]=t["1080p"])}return this.res}getH5Root(){return this.h5Root}onVideoEhanceErrorCb(t){let e=0;1==t?e=3:2==t?e=4:3==t?e=5:4==t?e=7:5==t?e=6:6==t?e=9:7==t?e=12:8==t?e=13:9==t?e=18:10==t?e=19:11==t?e=20:12==t?e=21:13==t?e=22:14==t&&(e=23),this.enhanceErrorCnt++,this.onVideoEhanceError(e)}onVideoEhanceError(t){this.isCloseEnhance=!0,3!=t&&4!=t&&5!=t&&7!=t&&6!=t&&9!=t&&12!=t&&13!=t&&8!=t&&2!=t&&18!=t&&19!=t&&20!=t&&21!=t||(this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_TYPE,1),!this.isLive&&this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_TYPE,1),this.vEnhanceType=1),this.stat.setComDim(d.a.DIM_COM.ENHANCE_BACK_REASON,t),this.vErrorCode=t}onVideoEhanceSuccess(){this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_TYPE,2),this.stat.setComDim(d.a.DIM_COM.ENHANCE_BACK_REASON,0),!this.isLive&&this.statVod&&(this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_TYPE,2),this.statVod.setComDim(d.a.VOD_DIM_COM.ENHANCE_BACK_REASON,0)),this.vEnhanceType=2,this.vErrorCode=0}getEnhanceStats(){return{vEnhanceType:this.vEnhanceType,vSupport:this.vSupport,vGameId:this.vGameId,vErrorCode:this.vErrorCode}}onCheckTimer(){let t=0;this.isLive?this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getRealFps&&(t=this.handler.player.mse.getRealFps()):this.handler&&this.handler.player&&this.handler.player.getFps&&(t=this.handler.player.getFps()),t>=40&&!this.isCloseEnhance&&(this.onVideoEhanceError(17),this.stat.setComDim(d.a.DIM_COM.V_ENHANCE_TYPE,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(d.a.VOD_DIM_COM.V_ENHANCE_TYPE,"0"),this.vEnhanceType=0,n.a.log("VideoEnhance.RealFps Error"),this.handler.player.setEnhance(!1))}destroy(){this.handler=null,this.stat=null,this.statVod=null,this.h5Root="",this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.vFrames=0,this.vEnhanceDelay=-1,this.lastBitrate=-1,this.lastLine=-1,this.isCloseEnhance=!1,this.isLive=!0}get isSupport(){return this._isSupport}};const Ph=[];let vh=-1,Eh=!1;function Ch(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=function(t,e){for(let i=0;i<Ph.length;i++){const s=Ph[i];return s.callback==t&&s.thisObj==e?s:null}}(t,e);r||(r={callback:t,thisObj:e,bindCallback:e?t.bind(e):t},Ph.push(r)),r.times=s,r.tickCnt=0,r.interval=i/10,r.delayDel=!1,-1===vh&&(vh=setInterval(Ih,10))}function Ih(){if(0===Ph.length)clearInterval(vh),vh=-1;else{Eh=!0;let t=_.a.now();for(let e=Ph.length-1;e>=0;e--){let i=Ph[e];if(i&&!i.delayDel){if(++i.tickCnt%i.interval==0){const s=i.tickCnt/i.interval;i.bindCallback(t,s),i.times>0&&i.times<=s&&i.tickCnt>0&&Ph.splice(e,1)}}else Ph.splice(e,1)}Eh=!1}}var Ah=function(t,e,i){Ch(t,e,i+10,1)},Dh=function(t,e){for(let i=0;i<Ph.length;i++){let s=Ph[i];if(s.callback==t&&s.thisObj==e){Eh?s.delayDel=!0:Ph.splice(i,1);break}}},Rh=class{constructor(t){this.callbacks=t}delTimeout(){Dh(this.onTime,this)}addTimeout(t){Ah(this.onTime,this,t)}onTime(){this.callbacks&&this.callbacks.onTime()}},Oh=class{constructor(){this.seiDataChannelPortListeners=[]}destroy(){this.seiDataChannelPortListeners=null}addDataChannelPortListener(t){-1==this.seiDataChannelPortListeners.indexOf(t)&&this.seiDataChannelPortListeners.push(t)}removeDataChannelPortListener(t){let e=this.seiDataChannelPortListeners.indexOf(t);-1!=e&&this.seiDataChannelPortListeners.splice(e,1)}checkDataChannelPortListener(t){return-1!=this.seiDataChannelPortListeners.indexOf(t)}},Lh=new class{constructor(){this.callbacks={onLoaded:this.onLoaded,onError:this.onLoadedError,thisObj:this},this._init=!1,this._open=!1,this._mpsBufferSendMode=o.a.mpsBufferSendMode,this._initMps=!1,this.eventEmiter=null}load(t,e,i){this._init||(this._init=!0,this._open=R.b.isOpen(o.a.mpsCfg,e,i,!1),this._mpsBufferSendMode=R.b.isOpen(o.a.mpsBufferSendModeCfg,e,i,!1)?2:1,-1!==o.a.mpsWhiteUids.indexOf(v.a.uid)&&(this._open=!0),o.a.isCloseMps(v.a.uid)&&(this._open=!1)),th.default.getTaf()&&(this._open?(n.a.log("MpsLibProxy load mpsLib open=true"),Ji(t,o.a.mpsLibName,this.callbacks)):n.a.log("MpsLibProxy load mpsLib open=false"))}setEventEmiter(t){this.eventEmiter=t}onLoaded(){let t=window.mpsApi;t&&(this._initMps||(this._initMps=!0,n.a.log("MpsLibProxy onLoaded mpsApi=".concat(!!t)),t.setLogLevel(n.a.getLevel()),t.init({signalSdk:th.default.getTaf(),uid:v.a.uid,sguid:v.a.sGuid,config:{canStartMps:1,canServiceAsMps:1,supportReverse:o.a.mpsSupportReverse,webrtcLimitTime:o.a.mpsWebrtcLimitTime,useSvrNat:o.a.useSvrNat,srcStartMode:o.a.mpsSrcStartMode,srcProtoType:1,srcWaitStopTime:o.a.mpsSrcWaitStopTime,lossRateClose:o.a.mpsLossRateClose,lossRateCloseTime:o.a.mpsLossRateCloseTime,lossRateOpen:o.a.mpsLossRateOpen,lossRateOpenTime:o.a.mpsLossRateOpenTime,upUserBw:o.a.mpsUpUserBw,upUserCnt:o.a.mpsUpUserCnt,bufferMode:o.a.mpsBufferMode,bufferTime:o.a.mpsBufferTime,bufferSize:o.a.mpsBufferSize,bufferSendMode:this._mpsBufferSendMode,bufferSendPowerFast:o.a.mpsBufferSendPowerFast,bufferSendPowerNormal:o.a.mpsBufferSendPowerNormal,bufferSendFastTime:o.a.mpsBufferSendFastTime,bufferSendMaxSize:o.a.mpsBufferSendMaxSize,bufferDropLimit:o.a.mpsBufferDropLimit,bufferDropTime:o.a.mpsBufferDropTime,bufferSendRateLimit:o.a.mpsBufferSendRateLimit,bufferSendRatePower:o.a.mpsBufferSendRatePower,bufferBlockLimit:o.a.mpsBufferBlockLimit,bufferDropLimitTime:o.a.mpsBufferDropLimitTime,bufferBlock:o.a.mpsBufferBlock,bufferBlockSenders:o.a.mpsBufferBlockSenders,bufferBlockPer:o.a.mpsBufferBlockPer,bufferBlockResumeTime:o.a.mpsBufferBlockResumeTime,bufferBlockDelTime:o.a.mpsBufferBlockDelTime,isSupportMpsCluster:o.a.mpsGroupOpen},ntp:Ft}),t.on(t.MpsEvents.DATA_METRIC,this._onDataMetric,this),t.start()),t.setPlayingVideo(!0))}_onDataMetric(t){Tn.fillterMetrics(t,o.a.statIgnoreActsMps,o.a.statHoldActsMps,o.a.statIgnoreFieldsMps,o.a.statHoldFieldsMps,o.a.statCoverFieldsMps),this.eventEmiter&&t.length>0&&this.eventEmiter.trigger(m.DATA_METRIC2,t)}onLoadedError(){n.a.log("MpsLibProxy onLoadedError")}},Mh={play:2,zhixu_web:3,editor:4,diy:5,material:6,anchor_room_play:7,"m-video":8,vodadv_live:9,header_youliao_play:10,kj_youliao_play:11,ai_clip:12,endGameChallenge:13,ymzx_game_challenge:14,bainian:15,new_year:16,vodadv:20,anchor_slap_face:21,endGameChallenge_share:22,pc_anchor_shequ:23,act_photo_h5:24,hotspot:50,microsoft:60,other:99,getPlace:function(t){return this.hasOwnProperty(t)?this[t]:this.other},isZhiXu:function(t){return this[t]===this.zhixu_web}},wh=class{static create(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||(e={}),t||((t=document.createElement("video")).id="_video_".concat(Math.floor(1e3*Math.random()))),t.autoplay="safari"!==(h.a.name+"").toLowerCase(),t.setAttribute("playsinline",!0),t.setAttribute("webkit-playsinline",!0),t.setAttribute("webkit-inline",!0),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("x5-video-player-type","h5"),t.setAttribute("x5-autoplay","true"),t.muted=!1,e.hasOwnProperty("autoplay")&&(t.autoplay=e.autoplay,t.setAttribute("x5-autoplay",e.autoplay?"true":"false")),t}static getErrorMessage(t){let e="message:";return t&&(e+="networkState=".concat(t.networkState),t.error&&(e+=" errorcode=".concat(t.error.code," details=").concat(t.error.message))),e}},Fh={LOADSTART:"loadstart",PAUSE:"pause",LOADEDMETADATA:"loadedmetadata",LOADEDDATA:"loadeddata",ERROR:"error",CANPLAY:"canplay",CANPLAYTHROUGH:"canplaythrough",PLAY:"play",PLAYING:"playing",STALLED:"stalled",SUSPEND:"suspend",VOLUMECHANGE:"volumechange",WAITING:"waiting",PROGRESS:"progress",ENDED:"ended",DURATIONCHANGE:"durationchange",RATECHANGE:"ratechange",SEEKED:"seeked",SEEKING:"seeking",getEvents:function(){return[this.LOADSTART,this.PAUSE,this.LOADEDMETADATA,this.LOADEDDATA,this.ERROR,this.CANPLAY,this.CANPLAYTHROUGH,this.PLAY,this.PLAYING,this.STALLED,this.SUSPEND,this.VOLUMECHANGE,this.WAITING,this.PROGRESS,this.ENDED,this.DURATIONCHANGE,this.RATECHANGE,this.SEEKED,this.SEEKING]}},bh=class{constructor(t){this._interval=t,this._curTime=0}reset(){this._curTime=0}isDone(t){if(0===this._curTime)this._curTime=t;else if(t-this._curTime>=this._interval)return this._curTime=t,!0;return!1}};let Vh=[];var Nh=function(t){n.a.log(t),Vh.push("".concat(_.a.getTimeStr()," ").concat(t)),Vh.length>200&&Vh.shift()};let Bh=1;var kh=class{constructor(t,e){this.id=Bh++,this.eventEmitter=t,this.tsdb=e.tsdb,this.videoElement=wh.create(e.videoElement,e.options),this._triggerPlayTimeInterval=new bh(1e3),this._checkBufferInterval=new bh(200),this._heartInterval=new bh(2e4),this.downTotalBufTs=0,this.started=!1,this.videoStatus=p.VIDEO_INIT,this.videoLoadTimeSent=!1,this.allowedAutoPlay=!0,this.isLoadstart=!1,this._isPlaying=!1,this.urlNetworkstate=0,this.seekTime=0,this.played=!1,this.isSeek=!1,this.pauseByUser=!1,this.sysPause=!1,this.ended=!1,this.playTimeout=2e3,this.hasEvents=!1,this.waiting=!1,this.seeking=!1,this.firstStartTs=0,this.startTs=0,this.loadedmetadataTs=0,this.loadeddataTs=0,this.progressTs=0,this.stalledTs=0,this.videoDuration=0,this.retryCnt=3,this.autoplay=!e.options||!e.options.hasOwnProperty("autoplay")||e.options.autoplay,this.info=null,this.url="",this.videoChecker=new Zr(this.videoElement,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0,this._videoEvtHandlerBind=this._videoEvtHandler.bind(this),this._onWaitPlayTimeoutBind=this._onWaitPlayTimeout.bind(this),this._waitPlayTimeoutInt=0}destroy(){this._delEvents(),this.clearTimer(),this.stopVideo(),this.videoElement=null,this.videoChecker&&this.videoChecker.destroy(),this.videoChecker=null,this.eventEmitter=null,this.tsdb=null,this._triggerPlayTimeInterval=null,this._checkBufferInterval=null,this._heartInterval=null,this.info=null,this.url=null}play(){this.clearWaitPlayTimeout(),this.pauseByUser=!1,this.sysPause=!1,this.autoplay=!0,this._updateStatus(p.VIDEO_LOADING),this._addPlayTimer(),this._addEvents(),Nh("(".concat(this.id,")VideoTagPlayer.play ").concat(this.getCost()," ").concat(this.getVideoInfo())),this._resetTs();let t=this.videoElement.play();return t?t.then(()=>{this._updateStatus(p.VIDEO_PLAYING),this.trigger(u.VIDEO_PLAYING,{video:this.videoElement}),X.remove(this._playFailed,this,this.playTimeout),Nh("(".concat(this.id,")VideoTagPlayer.play success ").concat(this.getCost()," ").concat(this.getVideoInfo())),this._playSuc()}).catch(t=>{n.a.log("(".concat(this.id,")VideoTagPlayer.play error"),t.message,this.videoElement&&this.videoElement.paused)}):n.a.warn("(".concat(this.id,")VideoTagPlayer.play promise is null")),t}_resetTs(){this.startTs=_.a.now()}_playSuc(){}pause(){n.a.log("(".concat(this.id,")VideoTagPlayer.pause ").concat(this.getVideoInfo())),this._updateStatus(p.VIDEO_PAUSED),this.pauseByUser=!0,this.clearTimer(),this.videoElement.pause()}seek(t){n.a.log("(".concat(this.id,")VideoTagPlayer.seek time=").concat(t," ").concat(R.b.getBufferedLog(this.videoElement))),this.ended=!1,this.seeking=!0,this._seek(t,this.playTimeout)}setVolume(t){this.videoElement&&(this.videoElement.volume=t),n.a.log("(".concat(this.id,")VideoTagPlayer.setVolume val=").concat(t," video=").concat(!!this.videoElement," volume=").concat(this.videoElement&&this.videoElement.volume))}setMuted(t){n.a.log("(".concat(this.id,")VideoTagPlayer.setMuted val=").concat(t," video=").concat(!!this.videoElement)),this.videoElement&&(this.videoElement.muted=t)}setPlaybackRate(t){n.a.log("(".concat(this.id,")VideoTagPlayer.setPlaybackRate val=").concat(t," video=").concat(!!this.videoElement)),this.videoElement&&(this.videoElement.playbackRate=t)}retryStart(){return!!(this.info&&this.retryCnt>0)&&(this.retryCnt--,!0)}clearTimer(){X.remove(this.onCheckFastTimer,this),X.remove(this._playFailed,this),X.remove(this._onAutoPlayTimeout,this),X.remove(this._onSeekTimeout,this),X.remove(this._videoErrorRetry,this),this.clearWaitPlayTimeout()}stop(){this.clearTimer(),this.startTs=0,this.loadedmetadataTs=0,this.loadeddataTs=0,this.progressTs=0,this.stalledTs=0,this.started=!1,this.pauseByUser=!1,this.ended=!1,this.played=!1,this.videoStatus=p.VIDEO_INIT,this._heartInterval.reset(),this._checkBufferInterval.reset(),this._triggerPlayTimeInterval.reset(),this.videoChecker.stop(),this._delEvents(),this.stopVideo()}stopVideo(){this.videoElement&&(this.videoElement.pause(),this.videoElement.src="",this.videoElement.load())}_addPlayTimer(){X.once(this._playFailed,this,this.playTimeout),X.add(this.onCheckFastTimer,this,50)}_delPlayTimer(){X.remove(this._playFailed,this,this.playTimeout),X.remove(this.onCheckFastTimer,this,50)}start(t){0===this.firstStartTs&&(this.firstStartTs=_.a.now()),this.stop(),n.a.log("(".concat(this.id,")VideoTagPlayer.start info=").concat(t&&JSON.stringify(t))),this.info=t,t&&(this.playTimeout=t.playTimeout||this.playTimeout),X.once(this._checkUrlActive,this,3e3),this._addPlayTimer()}_start(t){""!==this.url?(this._addEvents(),t.seekTime>0&&(this.seekTime=t.seekTime,this.isSeek=!0),this.ended=!1,this.startTs=_.a.now(),Nh("(".concat(this.id,")VideoTagPlayer._start ").concat(this.getCost()," url=").concat(this.url)),this.videoElement.src=this.url,this.videoElement.load(),this._updateStatus(p.VIDEO_LOADING)):Nh("(".concat(this.id,")VideoTagPlayer._start url is empty!").concat(this.getCost()))}_checkUrlActive(){try{if(this.url){const t=this.url,e=new XMLHttpRequest;e.open("HEAD",t),e.onreadystatechange=()=>{e.readyState===e.DONE&&(this.urlNetworkstate=e.status,n.a.log("(".concat(this.id,")VideoTagPlayer._checkUrlActive current status: "),this.urlNetworkstate))},e.send()}}catch(t){n.a.log("(".concat(this.id,")VideoTagPlayer._checkUrlActive error"),t.message)}}onCheckFastTimer(t){this.ended||(this._checkHeartbeat(t),this._triggerPlayTime(t))}_updateStatus(t){this.videoStatus!==t&&(n.a.log("(".concat(this.id,")VideoTagPlayer._updateStatus status=").concat(this.videoStatus," => ").concat(t)),this.videoStatus=t,this.trigger(u.PLAY_STATUS,{status:t}))}_onVideoRender(t){t===Zr.Types.FRAME?this.videoFrameRenderTs=_.a.now():this.videoTimerRenderTs=_.a.now()}_addEvents(){!this.hasEvents&&this.videoElement&&(n.a.log("(".concat(this.id,")VideoTagPlayer._addEvents")),this.hasEvents=!0,Fh.getEvents().forEach(t=>{this.videoElement.addEventListener(t,this._videoEvtHandlerBind)}))}_delEvents(){this.hasEvents&&(n.a.log("(".concat(this.id,")VideoTagPlayer._delEvents")),this.hasEvents=!1,this.videoElement)&&Fh.getEvents().forEach(t=>{this.videoElement.removeEventListener(t,this._videoEvtHandlerBind)})}_videoEvtHandler(t){if(t){n.a.log("(".concat(this.id,")VideoTagPlayer._videoEvtHandler type=").concat(t.type," ").concat(this.getVideoInfo()));let e="on".concat(t.type);this[e]&&this[e](t)}else n.a.error("(".concat(this.id,")VideoTagPlayer._videoEvtHandler e is null"))}getRecvInfo(){return[this.loadedmetadataTs>0?this.loadedmetadataTs-this.startTs:0,this.progressTs>0?this.progressTs-this.startTs:0,this.stalledTs>0?this.stalledTs-this.startTs:0]}onloadstart(){this.isLoadstart=!0}onpause(){!this.pauseByUser&&this.videoElement.currentTime<this.videoElement.duration&&(this.sysPause=!0,this._updateStatus(p.SYS_PAUSE),this.trigger(u.BROWSER_PAUSE))}onloadedmetadata(){1!=localStorage._testNoMeta&&(this.loadedmetadataTs=_.a.now(),Nh("(".concat(this.id,")VideoTagPlayer.onloadedmetadata ").concat(this.getCost()," ").concat(this.getVideoInfo())))}onprogress(){1!=localStorage._testNoProgress&&0===this.progressTs&&(this.progressTs=_.a.now(),Nh("(".concat(this.id,")VideoTagPlayer.onprogress ").concat(this.getCost()," ").concat(this.getVideoInfo())))}onstalled(){1!=localStorage._testNoStalled&&0===this.stalledTs&&(this.stalledTs=_.a.now(),Nh("(".concat(this.id,")VideoTagPlayer.onstalled ").concat(this.getCost()," ").concat(this.getVideoInfo())))}onloadeddata(){1!=localStorage._testNoData&&(X.remove(this._playFailed,this),X.remove(this._onAutoPlayTimeout,this),X.remove(this._checkUrlActive,this),this.played||(this.played=!0,this.loadeddataTs=_.a.now(),this.videoDuration=this.videoElement.duration,Nh("(".concat(this.id,")VideoTagPlayer.onloadeddata play, ").concat(this.getCost(),", x5-autoplay=").concat(this.videoElement.getAttribute("x5-autoplay")," ").concat(this.getVideoInfo())),this._updateStatus(p.VIDEO_PLAYING),this.sendVideoLoadTime(),this.trigger(u.SOURCE_READY,{totalDuration:this.videoElement.duration}),this.trigger(u.VIDEO_PLAY,{video:this.videoElement}),this.pauseByUser||(this.videoChecker.start(),this._startPauseStat(),this._triggerPlayTime(_.a.now(),!0),this._checkPlay(),!this.autoplay&&this.videoElement.paused&&this.trigger(u.BROWSER_PAUSE,{video:this.videoElement}))))}_startPauseStat(){}_playFailed(){!D.a.matches.Wechat||this.isLoadstart?this.retryStart()?(Nh("(".concat(this.id,")VideoTagPlayer._playFailed retry start! ").concat(this.getCost()," ").concat(wh.getErrorMessage(this.videoElement))),0===this.retryCnt&&(this.info.seekTime=this.getCurrentTime()+.1),this.start(this.info)):(Nh("(".concat(this.id,")VideoTagPlayer._playFailed retry end! ").concat(this.getCost()," ").concat(wh.getErrorMessage(this.videoElement))),this._updateStatus(p.VIDEO_STOP),this.trigger(u.H5_PLAY_FAIL),this.trigger(u.H5_PLAYER_ERROR_IN,{code:N.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"})):Nh("(".concat(this.id,")VideoTagPlayer._playFailed Wechat not loadstart! ").concat(this.getCost()))}_checkPlay(){if(this.videoElement.autoplay||"true"===this.videoElement.getAttribute("x5-autoplay")){const t=this.videoElement.play();t?t.then(()=>{n.a.log("(".concat(this.id,")VideoTagPlayer._checkPlay play success ").concat(this.getVideoInfo())),this.allowedAutoPlay=!0,this.videoElement&&this.isSeek&&this.videoElement.duration>0&&this._startSeek()}).catch(t=>{n.a.warn("(".concat(this.id,")VideoTagPlayer._checkPlay play error"),t.message),this._autoPlayFail()}):(n.a.log("(".concat(this.id,")VideoTagPlayer._checkPlay play result is not a promise!")),D.a.matches.UC&&this.videoElement.paused?(n.a.log("(".concat(this.id,")VideoTagPlayer._checkPlay UC browser paused")),this._autoPlayFail()):X.once(this._onAutoPlayTimeout,this,this.playTimeout))}}_autoPlayFail(){this.videoElement&&(1===o.a.h5FirstPlay&&(this.clearWaitPlayTimeout(),this._waitPlayTimeoutInt=setTimeout(this._onWaitPlayTimeoutBind,o.a.h5WaitTime)),this.allowedAutoPlay=!1,this.videoElement.pause(),this._updateStatus(p.BROWSER_PAUSE),this.trigger(u.BROWSER_PAUSE))}_onWaitPlayTimeout(){this._updateStatus(p.VIDEO_STOP),this.trigger(u.VIDEO_STOP)}clearWaitPlayTimeout(){this._waitPlayTimeoutInt>0&&(clearTimeout(this._waitPlayTimeoutInt),this._waitPlayTimeoutInt=0)}_onAutoPlayTimeout(){this.videoElement&&(n.a.warn("(".concat(this.id,")VideoTagPlayer._onAutoPlayTimeout pauseByUser=").concat(this.pauseByUser," ").concat(this.getVideoInfo()),navigator.userAgent),this.videoElement.paused?this.pauseByUser||(this._updateStatus(p.BROWSER_PAUSE),this.trigger(u.BROWSER_PAUSE)):D.a.matches.XiaoMi||0!==this.videoElement.currentTime||this.trigger(u.PLAY_TIMEOUT))}_startSeek(){this.isSeek=!1,this.seekTime>0&&this._seek(this.seekTime)}_seek(t,e){this.videoElement.duration>0&&(t===Math.ceil(this.videoElement.duration)?this._end("seek"):(n.a.log("(".concat(this.id,")VideoTagPlayer._seek time=").concat(t," ").concat(this.getVideoInfo())),this.seekTime=t,this.videoElement.currentTime=t,X.once(this._onSeekTimeout,this,e||2e4)))}_onSeekTimeout(){n.a.log("(".concat(this.id,")VideoTagPlayer._onSeekTimeout seekTime=").concat(this.seekTime," ").concat(this.getVideoInfo())),this.seekTime>0&&this.seekTime===this.videoElement.currentTime&&!this.pauseByUser&&(this.seekTime=0,this.trigger(u.SEEK_TIMEOUT))}_end(t){n.a.log("(".concat(this.id,")VideoTagPlayer._end type=").concat(t," ended=").concat(this.ended)),this.ended||(this.ended=!0,this.clearTimer(),this._delEvents(),this._onheartbeat(!0),this.videoElement.currentTime=this.videoElement.duration,this.videoElement.pause(),this._triggerPlayTime(_.a.now(),!0),this.trigger(u.VIDEO_TAG_ENDED))}_triggerPlayTime(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(this._triggerPlayTimeInterval.isDone(t)||e)&&this.trigger(u.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}onerror(t){this.videoElement&&this.videoElement.error&&(this.retryStart()?(Nh("(".concat(this.id,")VideoTagPlayer.onerror retry start! ").concat(this.getCost()," ").concat(wh.getErrorMessage(this.videoElement))),X.remove(this._playFailed,this),X.once(this._videoErrorRetry,this,2e3)):(Nh("(".concat(this.id,")VideoTagPlayer.onerror retry end! ").concat(this.getCost()," ").concat(wh.getErrorMessage(this.videoElement))),this._onVodError(),this._updateStatus(p.VIDEO_STOP),this.trigger(u.H5_PLAY_FAIL),this.trigger(u.H5_PLAYER_ERROR_IN,{video:this.videoElement,code:N.a.H5_ERROR_CODE.VIDEO_ERROR,error:t})))}_videoErrorRetry(){Nh("(".concat(this.id,")VideoTagPlayer._videoErrorRetry ").concat(this.getCost())),this.start(this.info)}_onVodError(){}oncanplay(t){this.ended||this.trigger(Rn.VIDEO_CANPLAY,{video:this.videoElement,event:t})}onplay(t){}onplaying(t){n.a.log("(".concat(this.id,")VideoTagPlayer.onplaying status=").concat(this.videoStatus," ").concat(this.getVideoInfo())),this._isPlaying=!0,this.seeking=!1,this.ended||this.videoStatus===p.VIDEO_PLAYING||this.videoStatus===p.BROWSER_PAUSE||(this._updateStatus(p.VIDEO_PLAYING),this.trigger(u.VIDEO_PLAYING,{video:this.videoElement,event:t}))}onprogress(t){this.ended||this.trigger(Rn.VIDEO_PROGRESS,{video:this.videoElement,event:t})}onended(t){}ondurationchange(){this.isSeek&&this.videoElement.duration>0&&(n.a.log("(".concat(this.id,")VideoTagPlayer.ondurationchange seekTime=").concat(this.seekTime," ").concat(this.getVideoInfo())),this._startSeek())}onvolumechange(){n.a.log("(".concat(this.id,")VideoTagPlayer.onvolumechange ").concat(this.getVideoInfo())),this.trigger(u.VOLUME_CHANGE,{volume:this.videoElement.volume,muted:this.videoElement.muted})}onseeked(t){}trigger(t,e){this.eventEmitter&&this.eventEmitter.trigger(t,e)}_checkBuffer(t){if(this.downTotalBufTs!==this.videoDuration&&this._checkBufferInterval.isDone(t)){const t=this.videoElement.buffered,e=t.length;let i=0;for(let s=0;s<e;s++){const e=t.start(s);i+=t.end(s)-e}this.downTotalBufTs=i}}getBufferLen(){let t=0;if(this.videoElement){let e=this.videoElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoElement.currentTime)>>0)}return t}getCurrentTime(){return this.videoElement.currentTime}getDurationTime(){return this.videoElement.duration}_checkHeartbeat(t){this._heartInterval.isDone(t)&&this._onheartbeat(!1)}_onheartbeat(){}sendVideoLoadTime(){if(!this.videoLoadTimeSent){this.videoLoadTimeSent=!0;let t=this.loadeddataTs-this.startTs,e=this.loadedmetadataTs-this.startTs,i=this.loadeddataTs-this.firstStartTs;n.a.log("(".concat(this.id,")VideoTagPlayer.sendVideoLoadTime loadTime=").concat(t," loadmetadataTime=").concat(e," loadTime1=").concat(i)),t>0&&t<1e4&&this._sendVideoLoadTime(t,e,i)}}_sendVideoLoadTime(t,e,i){}sendNoPicture(){}addNoPictureReason(){}get isPlaying(){return this.videoStatus!==p.VIDEO_STOP&&this.videoStatus!==p.VIDEO_INIT&&this.videoStatus!==p.VIDEO_LOADING}get hasPicture(){return this.isPlaying}get paused(){return this.isPlaying&&this.videoElement.paused}get notAllowedAutoplay(){return!this.allowedAutoPlay}get networkState(){return this.videoElement&&this.videoElement.networkState}get networkStateCode(){return this.urlNetworkstate||0}get errorCode(){return this.videoElement&&this.videoElement.error&&this.videoElement.error.code}getErrorMessage(){return wh.getErrorMessage(this.videoElement)}getCost(){let t=_.a.now();return"totalCost=".concat(t-this.firstStartTs,"ms curCost=").concat(t-this.startTs,"ms")}getVideoInfo(){return this.videoElement?"pauseByUser=".concat(this.pauseByUser," paused=").concat(this.videoElement.paused," currentTime=").concat(this.videoElement.currentTime," ").concat(R.b.getBufferedLog(this.videoElement)," duration=").concat(this.videoElement.duration," playbackRate=").concat(this.videoElement.playbackRate," volume=").concat(this.videoElement.volume," muted=").concat(this.videoElement.muted," ").concat(R.b.getBufferedLog(this.videoElement)):"videoElement is null"}printBlackInfo(){n.a.log("(".concat(this.id,")HlsTagPlayer.printBlackInfo: ").concat(wh.getErrorMessage(this.videoElement)))}},Uh={FLV:1,HLS:3,VR:7,MP4:11};o.a.isForceUseWorker=1;const xh=66,Hh=67;class Wh{static isSupported(){return dt.a.isMseSupportedH264()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Number(f.a.sdkLogLevel);isNaN(e)||this._setLogLevel(e),Object(tt.setLogger)(n.a);let i=Ln();this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.videoElm=t.videoElement||null,this.appId=t.appId||xh,this.uid=t.uid||"0",this.guid=t.guid||"",this.ua=t.ua||"",this.anchorUid=t.anchorUid||"",this.source=t.source||"",this.isMute=t.isMute||0,this.gameid=t.gameid||0;let s="".concat(D.a.os,"/").concat(D.a.osVersion," ").concat(D.a.browser,"/").concat(D.a.version.full);n.a.warn("VOD SDK MAIN ".concat(2508270844," | ").concat("2025-08-27 08:44:06"," | ").concat("RELEASE"," | ").concat(s," | ").concat(this.uid," | ").concat(this.guid)),this.config=o.a,o.a.setMute(this.isMute),o.a.audioCtx=0,f.a.appid=Number(this.appId)===Hh?this.appId:"",v.a.initUUId(),this.uid&&(v.a.uid=this.uid),this.appId&&(v.a.appid=this.appId),this.guid&&(v.a.sGuid=this.guid),this.videoElmIncome=!!t.videoElement,this.mediaMuffedData=[],this.playerMgr=new dd(this,t),this.started=!1,1==f.a._showVodSdk&&(window.sdkPlayer=this),this.webcodecsErrCount=0,this.turnMseType=0}destroy(){this.playerMgr&&(this.playerMgr.destroy(),this.playerMgr=null),this.on=null,this.off=null,this.trigger=null,this.config=null,this.mediaMuffedData=null,this.videoElm=null}_setLogLevel(t){n.a.setLevel(t)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&this.stop();try{n.a.log("HYVodPlayer.start ".concat(JSON.stringify(t)))}catch(t){n.a.log("HYVodPlayer.start")}t.guid=this.guid,0==this.gameid||t.hasOwnProperty("gameId")||(t.gameId=this.gameid),this.started=!0,t.hasOwnProperty("curBitrate")||(t.curBitrate=t.coderate),t.url&&(-1!==t.url.indexOf(".flv")&&t.type!==Uh.FLV?t.type=Uh.FLV:-1!==t.url.indexOf(".m3u8")&&t.type!==Uh.HLS?t.type=Uh.HLS:-1!==t.url.indexOf(".mp4")&&t.type!==Uh.MP4&&(t.type=Uh.MP4)),T.reset(),this.playerMgr.start(t)}setExtendConfig(t){let e={};t.p2pConfig&&(Object.assign(e,t.p2pConfig),delete t.p2pConfig),t.sdk&&(t.sdk.p2pConfig&&(Object.assign(e,t.sdk.p2pConfig),delete t.sdk.p2pConfig),Object.assign(e,t.sdk),delete t.sdk),Object.assign(e,t),this.config.init(e)}stop(){this.started&&this.reset()}reset(){this.started=!1,this.videoElmIncome||(this.videoElm=null),this.playerMgr&&this.playerMgr.stop()}getVideoElement(){return this.playerMgr.getVideoElement()}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playerMgr&&this.playerMgr.setVolume(t)}getVolume(){return this.playerMgr&&this.playerMgr.getVolume()}setMuted(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.playerMgr&&this.playerMgr.setMuted(t)}getMuted(){return this.playerMgr&&this.playerMgr.getMuted()}showControls(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.playerMgr&&this.playerMgr.showControls(t)}getCurrentTime(){return this.playerMgr&&this.playerMgr.getCurrentTime()}getDuration(){return this.playerMgr&&this.playerMgr.getDurationTime()}seek(t){Mh.isZhiXu(this.playerMgr.busiSource)||this.playerMgr.streamType!==dd.StreamType.HLS||!this.playerMgr.ended?this.playerMgr&&this.playerMgr.seekTime(t):n.a.log("HYVodPlayer.seek end!")}getBuffered(){return this.playerMgr&&this.playerMgr.getBuffered()}fullScreen(){this.videoElm=this.getVideoElement(),this.videoElm&&(this.videoElm.requestFullscreen?this.videoElm.requestFullscreen():this.videoElm.mozRequestFullScreen?this.videoElm.mozRequestFullScreen():this.videoElm.webkitRequestFullScreen&&this.videoElm.webkitRequestFullScreen())}exitFullscreen(){this.videoElm.exitFullscreen?this.videoElm.exitFullscreen():this.videoElm.mozCancelFullScreen?this.videoElm.mozCancelFullScreen():this.videoElm.webkitCancelFullScreen&&this.videoElm.webkitCancelFullScreen()}play(){return this.playerMgr&&this.playerMgr.play()}pause(){this.playerMgr&&this.playerMgr.pause()}getPaused(){return this.playerMgr&&this.playerMgr.paused}getEnded(){return this.playerMgr&&this.playerMgr.ended}getReadyState(){return this.playerMgr&&this.playerMgr.readyState}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playerMgr&&this.playerMgr.setPlaybackRate(t)}getPlaybackRate(){return this.playerMgr&&this.playerMgr.getPlaybackRate()}getVideoWidth(){return this.playerMgr&&this.playerMgr.getVideoWidth()}getVideoHeight(){return this.playerMgr&&this.playerMgr.getVideoHeight()}setLoop(t){this.playerMgr&&this.playerMgr.setLoop(t)}getLoop(){return this.playerMgr&&this.playerMgr.getLoop()}setCodeRate(t){this.playerMgr&&this.playerMgr.setCodeRate(t)}getCodeRate(){return this.playerMgr&&this.playerMgr.getCodeRate()}getLog(){return this.playerMgr&&this.playerMgr.getLog()}getNewLog(){return this.playerMgr&&this.playerMgr.getNewLog()}pushMuffedData(t){(t=t||{}).begin&&t.end?this.playerMgr.pushMuffedData(t):n.a.warn("muffed data error, beginDts=".concat(t.begin,", endDts=").concat(t.end))}setTafHandler(t){this.playerMgr.setTafHandler(t)}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.playerMgr&&this.playerMgr.containerResize&&this.playerMgr.containerResize(t)}getVideoExtractData(){return this.playerMgr.getVideoExtractData()}getEnhanceStats(){return this.playerMgr&&this.playerMgr.getEnhanceStats&&this.playerMgr.getEnhanceStats()}replay(){this.playerMgr&&this.playerMgr.replay&&this.playerMgr.replay()}onPlayEnded(){this.playerMgr&&this.playerMgr.onPlayEnded&&this.playerMgr.onPlayEnded()}get videoEnhance(){return this.playerMgr.videoEnhance}}Wh.FLV=Uh.FLV,Wh.HLS=Uh.HLS,Wh.MP4=Uh.MP4,Wh.VR=Uh.VR,Wh.StreamType=Uh,Wh.Event={DATA_METRIC2:m.DATA_METRIC2,VIDEO_PLAY:m.VIDEO_PLAY,VIDEO_NATIVE_PLAY:m.VIDEO_NATIVE_PLAY,PLAY_CARTON:m.PLAY_CARTON,VIDEO_PLAYING:m.VIDEO_PLAYING,VIDEO_SEEK:m.VIDEO_SEEK,VIDEO_PAUSE:m.VIDEO_PAUSE,BROWSER_PAUSE:m.BROWSER_PAUSE,VIDEO_CANPLAY:Rn.VIDEO_CANPLAY,VIDEO_TIMEUPDATE:Rn.VIDEO_TIMEUPDATE,VIDEO_PROGRESS:Rn.VIDEO_PROGRESS,VIDEO_ERROR:Rn.VIDEO_ERROR,VIDEO_ENDED:Rn.VIDEO_ENDED,VIDEO_LOOP_ENDED:m.VIDEO_LOOP_ENDED,VIDEO_STOP:m.VIDEO_STOP,VIDEO_LOAD_START:Rn.VIDEO_LOAD_START},window.HYVodPlayer=Wh;var Gh=Wh;let Yh=1;let qh=1;var Kh=class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,options:o}=e;this.eventEmitter=t,this.stat=i,this.statVod=s,this.tsdb=r,this._id=qh++,this.started=!1,this.videoElement=wh.create(a,o),this.createVideoElmInner=!1,this.videoStatus=p.VIDEO_STOP,this.startTs=0,this.lastCheckPlayTs=0,this.lastPausePlayTs=0,this.lastPauseTs=0,this.resumeTs=0,this.videoIsBadQuality=!1,this.pauseDuration=0,this.pauseDurationReal=0,this.pauseTimes=0,this.pauseBuffer=[],this.pauseDownBuffer=[],this.pauseCurrentTime=[],this.seeking=!1,this.downTotalBufTs=0,this.videoDuration=0,this.videoLoadTime=0,this.videoLoadTimeSent=!1,this.playTimeout=5e3,this.retryCnt=1,this.lastInfo=null,this._onLoadedMetadataBind=this._onLoadedMetadata.bind(this),this._onLoadedDataBind=this._onLoadedData.bind(this),this._onVideoEndedBind=this._onVideoEnded.bind(this),this._onVideoPlayingBind=this._onVideoPlaying.bind(this),this._onVideoErrorBind=this._onVideoError.bind(this),this._onVideoSeekBind=this._onVideoSeek.bind(this),this._onVideoSeekingBind=this._onVideoSeeking.bind(this),this._isEnded=!1,this._seekCnt=0,this.vodBadReason=0,this.videoErrorTs=0,this.isTestPaused=!1,this.isLoopEnded=!1,this.isPlayVideo=!1,this._heartTs=0,this.videoChecker=new Zr(this.videoElement,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoChecker.start(),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0,this.url=""}_onVideoRender(t){t===Zr.Types.FRAME?this.videoFrameRenderTs=_.a.now():this.videoTimerRenderTs=_.a.now()}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.videoElement&&(this.videoElement.volume=t)}retryStart(){return this.retryCnt>0&&(this.retryCnt--,!0)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isPlayVideo=!1,this.isLoopEnded=!1,this.lastInfo=t,this.resumeTs=0,this.videoErrorTs=0,X.remove(this._videoErrorRetry,this),this.started&&this.stop(),t.playTimeout&&(this.playTimeout=t.playTimeout),t.retryCnt&&(this.retryCnt=t.retryCnt),this.started=!0;let e=t.url;e=this._addUrlParams(e),this.url=e,this._addVideoListeners(),n.a.log("MP4Player(".concat(this._id,") is started! url=").concat(e)),this.videoElement.src=e,this.videoElement.load(),t.seekTime&&this.seek(t.seekTime),this.startTs=_.a.now(),T.setMP4Status(1),this.stat.setComDim(d.a.DIM_COM.STREAM_URL,e),this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,6),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.stat.setComDim(d.a.DIM_COM.ANCHOR_UID,t.presenterUid||0);let i=t.vid||R.b.getQueryString("vid",this.url);this.stat.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),ut.setVodCdnDomain(this.stat,e),this.statVod.setComDim(d.a.DIM_COM.STREAM_URL,e),this.statVod.setComDim(d.a.DIM_COM.STREAM_TYPE,6),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.statVod.setComDim(d.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),ut.setVodCdnDomain(this.statVod,e),X.once(this._playVideoFailed,this,this.playTimeout)}_playVideoFailed(){n.a.log("MP4Player(".concat(this._id,") _playVideoFailed")),this.retryStart()?(n.a.log("MP4Player(".concat(this._id,") _playVideoFailed retryPlay!")),X.remove(this._videoErrorRetry,this),this.start(this.lastInfo)):this.eventEmitter.trigger(m.H5_PLAYER_ERROR_IN,{code:N.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"})}stop(){this.started=!1,this.videoStatus=p.VIDEO_STOP,this._heartTs=0,this.videoChecker.destroy(),this.videoElement.src="",this._removeVideoListeners(),this._removePlayTimer(),this._statReport(!0),X.remove(this._playVideoFailed,this),X.remove(this._videoErrorRetry,this),this.isTestPaused=!1,this.isLoopEnded=!1,n.a.log("MP4Player(".concat(this._id,") is stopped"))}pause(){n.a.log("MP4Player(".concat(this._id,") pause")),this.videoElement&&this.videoElement.pause()}play(){n.a.log("MP4Player(".concat(this._id,").play")),this.videoElement&&this.videoElement.play()}seek(t){n.a.log("MP4Player(".concat(this._id,") seek"),t),this.seeking=!0,this.videoElement.currentTime=t}getDurationTime(){return this.videoElement.duration}getCurrentTime(){return this.videoElement.currentTime}addNoPictureReason(){const t=T.getMP4NoPictureReason();this.stat.setActDim(d.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t),this.statVod.setActDim(d.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}get isPlaying(){return this.videoStatus!==p.VIDEO_STOP}get hasPicture(){return this.isPlaying}get paused(){return this.isPlaying&&this.videoElement.paused}sendNoPicture(t){n.a.log("MP4Player(".concat(this._id,") sendNoPicture hasPicture=").concat(this.hasPicture," videoLoadTimeSent=").concat(this.videoLoadTimeSent)),this.hasPicture||this.videoLoadTimeSent||(this.videoLoadTimeSent=!0,this.statVod.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,_.a.now()-this.statVod.create_time),this.tsdb.sendVodMP4Time({loadTime:99999,errorMessage:this.getErrorMessage()}))}_sendVideoLoadTime(t){if(this.videoLoadTimeSent)return void n.a.log("MP4Player(".concat(this._id,") _sendVideoLoadTime, videoLoadTimeSent=true"));this.videoLoadTimeSent=!0,t=t||_.a.now()-this.startTs,this.statVod.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,t);let e=this.videoLoadTime,i="";this.hasPicture||(e=99999,i=this.getErrorMessage()),99999===e?(P.addVodFail(this.url),this.tsdb.autoReport()):P.delVodFail(this.url);let s=0;0!=this.videoErrorTs&&(s=this.videoErrorTs-this.startTs),n.a.log("MP4Player(".concat(this._id,") _sendVideoLoadTime, loadTime=").concat(e,", errorLoadTime=").concat(s," errorMessage=").concat(i)),this.tsdb.sendVodMP4Time({loadTime:e,errorLoadTime:s,errorMessage:i})}_addUrlParams(t){const e=o.a.platform,i=N.a.PLATFORM_TYPE[e]||N.a.PLATFORM_TYPE.web;t+=-1===t.indexOf("?")?"?":"&";const s=e===N.a.PLATFORM_TYPE_NAME.wap?"&uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"&u=".concat(v.a.convertUid);return t+="".concat(s,"&t=").concat(i),R.b.urlInfoParams(t,this.lastInfo)}_checkVideoFreeze(){if(!this.videoElement)return;if(this.paused)return;const t=this.getDurationTime(),e=this.videoElement.currentTime;this.videoElement.loop&&!this.isLoopEnded&&e>0&&t>0&&1e3*t-1e3*e<=200&&(n.a.log("MP4Player(".concat(this._id,").onCheckFastTimer.VIDEO_LOOP_ENDED")),this.eventEmitter.trigger(m.VIDEO_LOOP_ENDED),this.isLoopEnded=!0);const i=+Date.now(),s=+Date.now()-this.lastPauseTs;if(this.lastCheckPlayTs&&this.lastCheckPlayTs===this.videoElement.currentTime){const t=this.lastPausePlayTs,r=this.getBufferLen();return n.a.log("MP4Player(".concat(this._id,")._checkVideoFreeze,buffer=").concat(r,",totalBuffer=").concat(this.downTotalBufTs,",pauseDuration=").concat(s,",curtime=").concat(this.videoElement.currentTime,",resumeTs=").concat(this.resumeTs,",delta=").concat(i-this.resumeTs,",seeking=").concat(this.seeking)),s>=200&&t!==this.videoElement.currentTime?(this.seeking||(this.videoIsBadQuality=!0,this.pauseDuration+=s,this.pauseTimes+=1,P.addBadQualityVod(this.url),s>=200&&(this.pauseBuffer.length<20&&this.pauseBuffer.push(r),this.pauseDownBuffer.length<20&&this.pauseDownBuffer.push(~~this.downTotalBufTs),this.pauseCurrentTime.length<20&&this.pauseCurrentTime.push(~~e)),this.vodBadReason=r<2e3?kr.CODE:Wr.CODE),this.pauseDurationReal+=s,this.lastPauseTs=+Date.now(),this.lastPausePlayTs=this.videoElement.currentTime,this.videoStatus=p.VIDEO_CACHING,this.isTestPaused=!0,this.eventEmitter.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal})):s>=200&&(this.seeking||(this.pauseDuration+=s),this.pauseDurationReal+=s,this.lastPauseTs=+Date.now(),this.videoStatus=p.VIDEO_CACHING,this.isTestPaused=!0,this.eventEmitter.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal})),void(0!=this.resumeTs&&i-this.resumeTs>=5e3&&this.pause5sRestart(this.videoElement.currentTime))}this.isTestPaused&&(n.a.log("Mp4Player(".concat(this._id,").resume")),this.eventEmitter.trigger(m.VIDEO_PLAYING,{video:this.videoElement})),this.isTestPaused=!1,this.resumeTs=+Date.now(),this.lastCheckPlayTs=this.videoElement.currentTime,this.lastPauseTs=+Date.now()}_checkBuffer(){if(this.downTotalBufTs===this.videoDuration)return;const t=this.videoElement.buffered,e=t.length;let i=0;for(let s=0;s<e;s++){const e=t.start(s);i+=t.end(s)-e}this.downTotalBufTs=i}getBufferLen(){let t=0;if(this.videoElement){let e=this.videoElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoElement.currentTime)>>0)}return t}_addVideoListeners(){this.videoElement.addEventListener("loadedmetadata",this._onLoadedMetadataBind),this.videoElement.addEventListener("loadeddata",this._onLoadedDataBind),this.videoElement.addEventListener("ended",this._onVideoEndedBind),this.videoElement.addEventListener("playing",this._onVideoPlayingBind),this.videoElement.addEventListener("error",this._onVideoErrorBind),this.videoElement.addEventListener("seeking",this._onVideoSeekingBind),this.videoElement.addEventListener("seeked",this._onVideoSeekBind)}_removeVideoListeners(){this.videoElement.removeEventListener("loadedmetadata",this._onLoadedMetadataBind),this.videoElement.removeEventListener("loadeddata",this._onLoadedDataBind),this.videoElement.removeEventListener("ended",this._onVideoEndedBind),this.videoElement.removeEventListener("playing",this._onVideoPlayingBind),this.videoElement.removeEventListener("error",this._onVideoErrorBind),this.videoElement.removeEventListener("seeking",this._onVideoSeekingBind),this.videoElement.removeEventListener("seeked",this._onVideoSeekBind)}_initPlayTimer(){X.add(this._checkVideoFreeze,this,100),X.add(this._checkBuffer,this,100),X.add(this._onHeart20sMetric,this,1e3)}_removePlayTimer(){X.remove(this._checkVideoFreeze,this),X.remove(this._checkBuffer,this),X.remove(this._onHeart20sMetric,this)}_onLoadedMetadata(t){n.a.log("MP4Player(".concat(this._id,")._onLoadedMetadata"))}_onLoadedData(t){const e=_.a.now();this.videoStatus=p.VIDEO_PLAYING,this.videoDuration=this.videoElement.duration,n.a.log("MP4Player(".concat(this._id,")._onLoadedData, currentTime=").concat(this.videoElement.currentTime,", videoDuration=").concat(this.videoDuration)),this.triggerPlayTimeStatus(),this._initPlayTimer(),this.isPlayVideo=!0,0!==this.startTs&&(this.videoLoadTime=e-this.startTs,this.tsdb.sendMP4Time({loadTime:this.videoLoadTime}),!this.videoLoadTimeSent&&this.videoLoadTime<=1e4&&this._sendVideoLoadTime()),this.stat.setComDim(d.a.DIM_COM.STREAM_TOTAL_DURATION,this.videoDuration),this.eventEmitter.trigger(m.SOURCE_READY,{totalDuration:this.videoElement.duration}),this.eventEmitter.trigger(m.VIDEO_PLAY,{video:this.videoElement,width:this.videoElement.videoWidth,height:this.videoElement.videoHeight}),X.remove(this._playVideoFailed,this);let i=this.videoElement.play();i&&i.then(()=>{n.a.log("MP4Player(".concat(this._id,") autoplay success"))}).catch(t=>{n.a.warn("MP4Player(".concat(this._id,") autoplay fail, change volume to 0 try play again,  error: ").concat(t.message)),this.eventEmitter.trigger(m.BROWSER_PAUSE)})}_onVideoEnded(t){n.a.log("MP4Player(".concat(this._id,")._onVideoEnded")),this.triggerPlayTimeStatus(),this.eventEmitter.trigger(m.VIDEO_ENDED,{video:this.videoElement}),this._isEnded=!0,this.started&&this._statReport(!0)}_onVideoPlaying(){n.a.log("MP4Player(".concat(this._id,")._onVideoPlaying")),this.seeking=!1,this._isEnded=!1}getErrorMessage(){return wh.getErrorMessage(this.videoElement)}_onVideoError(t){const e=100*Math.random();n.a.log("MP4Player(".concat(this._id,")._onVideoError "),e,this.getErrorMessage(),this.videoElement.error),this.videoElement.error&&(this.videoErrorTs=_.a.now(),this.retryStart()?(n.a.log("Mp4Player(".concat(this._id,")._onVideoError, retry!")),X.remove(this._playVideoFailed,this),X.once(this._videoErrorRetry,this,2e3)):(T.setMP4Status(-1),!this.isPlayVideo&&e<=o.a.mp4ErrorReportRandom&&(n.a.log("Mp4Player(".concat(this._id,")._onVideoError, noPicture")),this._sendVideoLoadTime()),this.eventEmitter.trigger(m.VIDEO_MP4_ERROR)))}_videoErrorRetry(){P.addRetryStreamVod(this.url),this.start(this.lastInfo)}_onVideoSeeking(t){const e=this.videoElement?this.videoElement.currentTime:0;n.a.log("MP4Player(".concat(this._id,")._onVideoSeeking, cur=").concat(e),t),this.seeking=!0}_onVideoSeek(t){const e=this.videoElement?this.videoElement.currentTime:0;this.seeking=!1,n.a.log("MP4Player(".concat(this._id,")._onVideoSeek, cur=").concat(e),t),e>1&&this._seekCnt++,this.isLoopEnded=!1}_onHeart20sMetric(t,e){this.started&&(this._isEnded||(0===this._heartTs?this._heartTs=t:t-this._heartTs>=2e4&&(this._heartTs=t,this._statReport(!1))),this.triggerPlayTimeStatus())}_statReport(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,this.videoIsBadQuality?100:0),this.stat.setCore(d.a.CORE.VIDEO_BLOCK_COUNT,this.pauseTimes),this.stat.setCore(d.a.CORE.VIDEO_BLOCK_DURATION,this.pauseDuration),this.stat.setCore(d.a.CORE.STREAM_BUFFERED,this.downTotalBufTs),this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_REASON,this.vodBadReason),this.statVod.setComDim(d.a.VOD_DIM_COM.BACKUP_FIELD6,this.getBufferLen()),this.statVod.setComDim(d.a.VOD_DIM_COM.BACKUP_FIELD5,Math.floor(this.downTotalBufTs)),this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,this.videoIsBadQuality?100:0),this.statVod.setCore(d.a.VOD_CORE.VOD_BLOCK_COUNT,this.pauseTimes),this.statVod.setCore(d.a.VOD_CORE.VOD_BLOCK_DURATION,this.pauseDuration),this.statVod.setCore(d.a.CORE.STREAM_BUFFERED,this.downTotalBufTs),this.lastCheckPlayTs=0,this.lastPausePlayTs=0,this.lastPauseTs=0,this.videoIsBadQuality=!1,this.pauseDuration=0,this.pauseTimes=0,this.pauseBuffer.length=0,this.pauseDownBuffer.length=0,this.pauseCurrentTime.length=0,this._seekCnt=0,this.vodBadReason=0;let e=[];this.stat.fill(e,t),this.statVod.fill(e,t),this.tsdb.sendMetrics(e)}triggerPlayTimeStatus(){this.eventEmitter.trigger(m.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}setVolume(t){n.a.log("MP4Player(".concat(this._id,").setVolume"),t),this.videoElement&&(this.videoElement.volume=t)}getCodecType(){return F}getVideoWidth(){return this.videoElement&&this.videoElement.videoWidth}getVideoHeight(){return this.videoElement&&this.videoElement.videoHeight}getFps(){return-100}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n.a.log("MP4Player(".concat(this._id,").setPlaybackRate"),t),this.videoElement&&(this.videoElement.playbackRate=Number(t))}setLoop(t){n.a.log("MP4Player(".concat(this._id,").setLoop"),t),this.videoElement&&(this.videoElement.loop=!!t)}setMuted(t){n.a.log("MP4Player(".concat(this._id,").setMuted"),t),this.videoElement&&(this.videoElement.muted=!!t)}pause5sRestart(){if(n.a.log("MP4Player(".concat(this._id,").pause5sRestart!")),!this.videoElement)return;const t=this.videoElement.currentTime;this.start(this.lastInfo),this.seek(t)}},jh=class{constructor(t,e){this._hyPlayer=t,this._observer=Ln(),this._player=null,this._stat=e.stat,this._tsdb=e.tsdb,this._videoElement=e.videoElement,this._onObserverBind=this._onObserver.bind(this),this._observer.on(m.VIDEO_PLAY,this._onObserverBind),this._observer.on(m.FLV_URL_UNAVAILABLE,this._onObserverBind),this._observer.on(m.H5_PLAYER_ERROR_IN,this._onObserverBind),this._observer.on(m.NO_DATA_RECEIVED,this._onObserverBind),this._observer.on(m.P2P_TIMEOUT,this._onObserverBind),this._observer.on(m.FLV_TRY_TO_P2P,this._onObserverBind),this._info=null,this._data=null,this._vr=null,this._viewWidth=0,this._viewHeight=0,this._hyPlayer.setSize=this.setSize.bind(this),this._hyPlayer.addViewport=this.addViewport.bind(this),this._hyPlayer.getViewport=this.getViewport.bind(this),this._hyPlayer.setViewport=this.setViewport.bind(this)}_onObserver(t,e){switch(t){case m.VIDEO_PLAY:this.onPlayVideo(t,e);break;case m.FLV_URL_UNAVAILABLE:case m.H5_PLAYER_ERROR_IN:case m.NO_DATA_RECEIVED:case m.P2P_TIMEOUT:this._hyPlayer.trigger(t);break;case m.FLV_TRY_TO_P2P:this._hyPlayer.lastP2PInfo&&(this._hyPlayer.lastP2PInfo.vr.playerType=1,this.start(this._hyPlayer.lastP2PInfo))}}destroy(){this.stop(),this._data=null}disposeVr(){this._vr&&(this._vr.dispose(),this._vr=null)}disposePlayer(){this._player&&(this._player.stop(),this._player=null)}start(t){this.disposeVr(),this.disposePlayer(),n.a.log("VrPlayer.play",t),this._info=t,this._stat.setComDim(d.a.DIM_COM.VR_MODE,t.vr&&t.vr.type?t.vr.type:0);let e=Object.assign({},t),i=null;i=t.streamType===Gh.StreamType.MP4?Kh:Gh.isSupported()?Sn:class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,h265Proxy:o}=e;this.eventEmitter=t,this._videoElm=a,this._stat=i,this.statVod=s,this._tsdb=r,this._id=Yh++,this.anticode=new Gi,this._pauseStat=new class{constructor(){this.video=null,this._startWaitingTs=0,this._badQualityCnt=0,this._badQualityTime=0,this._badQuality=!1,this._paused=!1,this.onWaitingBind=this.onWaiting.bind(this),this.onPlayingBind=this.onPlaying.bind(this),this.onPauseBind=this.onPause.bind(this),this.onCanplayThroughBind=this.onCanplayThrough.bind(this)}get paused(){return this._badQualityCnt>0}get waiting(){return this._startWaitingTs>0}reset20(){this._badQuality&&(this._startWaitingTs=_.a.now()),this._badQuality=!1,this.resetBadQuality()}reset(){this.delEventListener(this.video),this.resetBadQuality(),this.resetStat(),this._paused=!1,this.video=null}resetBadQuality(){this._badQualityCnt=0,this._badQualityTime=0}resetStat(){this._startWaitingTs=0,this._badQuality=!1}start(t){this.reset(),this.addEventListener(t),this.video=t,X.add(this.onCheckStat,this,50)}stop(){this.reset(),X.remove(this.onCheckStat,this)}addEventListener(t){t&&(t.addEventListener("waiting",this.onWaitingBind),t.addEventListener("playing",this.onPlayingBind),t.addEventListener("pause",this.onPauseBind),t.addEventListener("canplaythrough",this.onCanplayThroughBind))}delEventListener(t){t&&(t.removeEventListener("waiting",this.onWaitingBind),t.removeEventListener("playing",this.onPlayingBind),t.removeEventListener("pause",this.onPauseBind),t.removeEventListener("canplaythrough",this.onCanplayThroughBind))}onCheckStat(t,e){!this._paused&&this._startWaitingTs>0&&t-this._startWaitingTs>200&&(this._badQuality||(this._badQuality=!0,this._badQualityCnt++))}onWaiting(t){0===this._startWaitingTs&&(this._startWaitingTs=_.a.now())}onPlaying(t){this.checkBadQuality(),this.resetStat(),this._paused=!1}onPause(t){this.checkBadQuality(),this.resetStat(),this._paused=!0}onCanplayThrough(t){this._paused||(this.checkBadQuality(),this.resetStat())}checkBadQuality(){if(this._badQuality&&this._startWaitingTs>0){let t=_.a.now()-this._startWaitingTs;n.a.log("PauseStat.checkBadQuality badQualityTime=".concat(t,", this.video.paused=").concat(this.video.paused)),this._badQualityTime+=t}}},this.started=!1,this.startTs=0,this.videoStatus=p.VIDEO_STOP,this.videoLoadTimeSent=!1,this.sysPause=!1,this.pauseByUser=!1,this.waiting=!1,this.ended=!1,this.hasEvents=!1,this.videoInfo=null,this._tickTs=0,this.lineType=0,this.loadeddataTs=0,this.allowedAutoPlay=!0,this.seekTime=0,this.noPictureSent=!1,this.isLoadstart=!1,this.playTimeout=5e3,this.urlNetworkstate=0,this.startPlayTs=0,this.h265Proxy=o,this._isEnded=!1,this._videoEvts=["loadstart","pause","loadedmetadata","loadeddata","error","canplay","canplaythrough","play","playing","stalled","suspend","volumechange","waiting","progress","emptied","ended","durationchange"],this._videoEvtHandlerBind=this._videoEvtHandler.bind(this),this._startUrlBind=this._startUrl.bind(this),this._refreshAnticodeBind=this._refreshAnticode.bind(this),this.anticode.on(Gi.Events.REFRESH,this._refreshAnticodeBind),this.videoChecker=new Zr(this._videoElm,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoChecker.start(),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0}_onVideoRender(t){t===Zr.Types.FRAME?this.videoFrameRenderTs=_.a.now():this.videoTimerRenderTs=_.a.now()}get isPlaying(){return this.videoStatus!==p.VIDEO_STOP}get hasPicture(){return this.isPlaying}get notAllowedAutoplay(){return!this.allowedAutoPlay}get networkState(){return this._videoElm&&this._videoElm.networkState}printBlackInfo(){this._videoElm&&n.a.log("HlsTagPlayer(".concat(this._id,").printNetworkState: ").concat(this._videoElm.networkState)),this._videoElm&&this._videoElm.error&&n.a.log("HlsTagPlayer(".concat(this._id,").printError: ").concat(this._videoElm.error.code,", ").concat(this._videoElm.error.message))}get networkStateCode(){return this.urlNetworkstate||0}get errorCode(){return this._videoElm&&this._videoElm.error&&this._videoElm.error.code}start(t){t&&(this.videoInfo=t),this.videoInfo&&this.videoInfo.playTimeout&&(this.playTimeout=this.videoInfo.playTimeout),this.isLive=t.isLive,this._checkParams(this.videoInfo,this._startUrlBind),X.once(this._playVideoFailed,this,this.playTimeout),X.once(this._checkUrlActive,this,3e3)}stop(){this.videoChecker.destroy(),this._videoElm.pause(),this._videoElm.src="",this._delEvents(),X.remove(this.onPlayTimeout,this),X.remove(this.onCheckTimer,this),X.remove(this.onCheckFastTimer,this),X.remove(this._playVideoFailed,this),X.remove(this._checkUrlActive,this),this.reset(),n.a.log("HlsTagPlayer(".concat(this._id,").stop: player is stopped"))}triggerPlayTimeStatus(){this.eventEmitter.trigger(u.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}reset(){n.a.log("HlsTagPlayer(".concat(this._id,").reset: player is reset")),this.started=!1,this.startTs=0,this.videoStatus=p.VIDEO_STOP,this.sysPause=!1,this.pauseByUser=!1,this.waiting=!1,this.ended=!1,this.hasEvents=!1,this.videoInfo=null,this._tickTs=0,this.lineType=0,this.loadeddataTs=0,this.seekTime=0}destroy(){this._videoElm.pause(),n.a.log("HlsTagPlayer(".concat(this._id,").stop: player is destory")),this.isAutoplaying=!1,this.startPlayTs=0,this.seekTime=0}getBufferLen(){let t=0;if(this._videoElm){const e=this._videoElm.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this._videoElm.currentTime)>>0)}return t}seek(t){this.setCurrentTime(t)}setCurrentTime(t,e){0!==this._videoElm.duration&&(t!==Math.ceil(this._videoElm.duration)?(this.seekTime=t,this._videoElm.currentTime=t,n.a.log("HlsTagPlayer(".concat(this._id,").setCurrentTime seekTime=").concat(t,", currentTime=").concat(this._videoElm.currentTime,", duration=").concat(this._videoElm.duration)),X.remove(this.onPlayTimeout,this),X.once(this.onSeekTimeout,this,e||2e4)):this._setEnded(1))}getCurrentTime(){return this._videoElm.currentTime}getDurationTime(){return this._videoElm.duration}setVolume(t){this._videoElm&&(this._videoElm.volume=t)}play(){n.a.log("HlsTagPlayer(".concat(this._id,").play: call play.")),this.pauseByUser=!1,this.sysPause=!1,this._addEvents(),this.playing||(this.startTs=_.a.now());const t=this._videoElm.play();return t?t.then(()=>{n.a.log("HlsTagPlayer(".concat(this._id,").play: play successfully"))}).catch(t=>{n.a.error("HlsTagPlayer(".concat(this._id,").play: playing error="),t.toString(),this._videoElm.paused)}):n.a.warn("HlsTagPlayer(".concat(this._id,").play: play result is not a promise")),t}pause(){this.pauseByUser=!0,this._delEvents(),this._videoElm.pause()}getAnticodeHandler(){return this.anticode}_checkParams(t,e){t.sHlsUrl&&t.sStreamName?(t.sHlsUrl=t.sHlsUrl.replace("http://","https://"),t.sHlsAntiCode?(this.anticode.init(t.sHlsUrl,t.sStreamName,t.sHlsAntiCode),this.anticode.valid().then(()=>{e(t)})):e(t)):t.url?e(t):n.a.error("HlsTagPlayer(".concat(this._id,").checkParams has no params(sHlsUrl, sStreamName, url)"))}_initInfo(t){t.sHlsUrl&&t.sStreamName&&(t.url=t.sHlsUrl+"/"+t.sStreamName+".m3u8");const e=[];this.anticode.hasAnticode()&&e.push(this.anticode.getAnticode()),t.iBitRate>0&&e.push("ratio=".concat(t.iBitRate));const i=o.a.platform,s=N.a.PLATFORM_TYPE[i]||N.a.PLATFORM_TYPE.web,r=i===N.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(v.a.uid,"&uuid=").concat(v.a.uuid):"u=".concat(v.a.convertUid);let a="".concat(r,"&t=").concat(s);a=R.b.urlInfoParams(a,t),e.push(a),e.length>0&&(t.url+=(-1!==t.url.indexOf("?")?"&":"?")+"".concat(e.join("&"))),this.lineType=t.lineType,this.url=t.url}_startUrl(t){this._initInfo(t),n.a.log("HlsTagPlayer(".concat(this._id,").startUrl url="),this.url),this.startTs=_.a.now(),this._stat.setComDim(d.a.DIM_COM.STREAM_URL,t.url),this._stat.setComDim(d.a.DIM_COM.P2P,d.a.LIVE_TYPE.HLS),this._stat.setComDim(d.a.DIM_COM.STREAM_TYPE,3),this._stat.setComDim(d.a.DIM_COM.HLS_TYPE,t.isLhls?2:1);let e=t.vid||R.b.getQueryString("vid",t.url);this.statVod.setComDim(d.a.DIM_COM.STREAM_URL,t.url),this.statVod.setComDim(d.a.DIM_COM.STREAM_TYPE,3),this.statVod.setComDim(d.a.DIM_COM.P2P,d.a.LIVE_TYPE.HLS),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,e||""),this.statVod.setComDim(d.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),X.add(this.onCheckTimer,this,1e3),this._videoElm=this._createVideo(this.url),t.seekTime&&(this.seekTime=t.seekTime,this.isSeek=!0),this._addEvents()}_checkUrlActive(){const t=new XMLHttpRequest;t.open("HEAD",this.url),t.onreadystatechange=()=>{t.readyState==t.DONE&&(this.urlNetworkstate=t.status,n.a.log("HlsTagPlayer(".concat(this._id,").checkUrlActive current status: "),this.urlNetworkstate,this.url))},t.send()}_createVideo(t){if(this._videoElm)return this._videoElm.src=this.url,this._videoElm.getAttribute("x5-autoplay")?this._videoElm.autoplay=!0:this._videoElm.autoplay&&this._videoElm.setAttribute("x5-autoplay","true"),this._videoElm;{const e=document.createElement("video");return e.src=t,e.autoplay=!0,e.setAttribute("playsinline",!0),e.setAttribute("webkit-playsinline",!0),e.setAttribute("webkit-inline",!0),e.setAttribute("x-webkit-airplay","allow"),e.setAttribute("x5-video-player-type","h5"),e.setAttribute("x5-autoplay","true"),e.preload="auto",e}}_refreshAnticode(){this.initInfo(this.videoInfo)}_addEvents(){this._videoElm&&!this.hasEvents&&(this.hasEvents=!0,this._videoEvts.forEach(t=>{this._videoElm.addEventListener(t,this._videoEvtHandlerBind)}))}_delEvents(){this._videoElm&&this.hasEvents&&(this.hasEvents=!1,this._videoEvts.forEach(t=>{this._videoElm.removeEventListener(t,this._videoEvtHandlerBind)}))}_videoEvtHandler(t){switch(n.a.log("HlsTagPlayer(".concat(this._id,")._videoEvtHandler event: e.type="),t?t.type:t),t.type){case"loadstart":this.onLoadStart();break;case"pause":this.onVideoPause();break;case"loadedmetadata":this.onLoadedmetadata();break;case"loadeddata":this.onPlayVideo();break;case"playing":this.onPlayingVideo();break;case"error":this.onVideoError(t);break;case"ended":this.onEnded();break;case"durationchange":this.onDurationChange()}}_updateTime(){if(!this.ended&&this._videoElm&&this._videoElm.buffered&&this._videoElm.currentTime>0){const t=this._videoElm.buffered;if("function"!=typeof t.start||"function"!=typeof t.end)return void n.a.warn("HlsTagPlayer(".concat(this._id,")._updateTime video.buffered start&end not a function"));for(let e=0;e<t.length;e++)if(t.start(e)<=this._videoElm.currentTime&&t.end(e)>=this._videoElm.currentTime){let i=t.end(e)-this._videoElm.currentTime;i=i<0?0:i,this._videoElm.duration>0&&this._videoElm.currentTime>=this._videoElm.duration?this._setEnded(3):this.eventEmitter.onPlayTime&&this.eventEmitter.onPlayTime(Math.floor(this._videoElm.currentTime),Math.floor(this._videoElm.duration),Math.floor(i));break}}}_setEnded(t){this.ended||(n.a.log("HlsTagPlayer(".concat(this._id,")._setEnded, type=").concat(t)),this._reportVideoQuality(!0),this.ended=!0,this._videoElm.currentTime=this._videoElm.duration,this._videoElm.pause(),this.triggerPlayTimeStatus(),this.eventEmitter.onPlayEnded&&this.eventEmitter.onPlayEnded())}_checkPause(t){!this.ended&&!this.sysPause&&!this.pauseByUser&&this._setWaiting(this._pauseStat.waiting)}_updateStatus(t){this.videoStatus!==t&&(n.a.log("HlsTagPlayer(".concat(this._id,")._updateStatus: ").concat(this.videoStatus," -> ").concat(t)),this.videoStatus=t,this.eventEmitter.trigger(u.PLAY_STATUS,{status:t}))}_playVideoFailed(){if(D.a.matches.Wechat&&!this.isLoadstart)return void n.a.log("HlsTagPlayer(".concat(this._id,")._playVideoFailed webchat not trigger loadstart"));let t="HlsTagPlayer(".concat(this._id,")._playVideoFailed: ")+wh.getErrorMessage(this._videoElm);n.a.error(t),this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{code:N.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"}),X.remove(this._playVideoFailed,this)}onPlayTimeout(){this._videoElm&&(n.a.warn("HlsTagPlayer(".concat(this._id,").onPlayTimeout: userAgent=%s, paused=%s, pauseByUser=%s"),navigator.userAgent,this._videoElm.paused,this.pauseByUser),this._videoElm.paused?!this.pauseByUser&&this.eventEmitter.trigger(u.VIDEO_PAUSE):D.a.matches.XiaoMi||0!==this._videoElm.currentTime||this.eventEmitter.trigger(u.PLAY_TIMEOUT))}onSeekTimeout(){n.a.log("HlsTagPlayer(".concat(this._id,").onSeekTimeout: seekTime=").concat(this.seekTime,", currentTime=").concat(this._videoElm&&this._videoElm.currentTime)),this.seekTime>0&&this.seekTime===this._videoElm.currentTime&&!this.pauseByUser&&(this.seekTime=0,this.eventEmitter.trigger(u.SEEK_TIMEOUT))}onCheckTimer(t,e){0===this._tickTs?this._tickTs=t:t-this._tickTs>=2e4&&(this._tickTs=t,!this.started||this.pauseByUser||this.sysPause||this.ended?n.a.log("HlsTagPlayer(".concat(this._id,").onCheckTimer: heartbeat fail!{started=").concat(this.started,", pauseByUser=").concat(this.pauseByUser,", sysPause=").concat(this.sysPause,"}")):(n.a.log("HlsTagPlayer(".concat(this._id,").onCheckTimer: heartbeat suc")),this._reportVideoQuality(!1))),this.ended||this.triggerPlayTimeStatus()}onCheckFastTimer(t,e){!this.playing||this.pauseByUser||this.sysPause||(this._checkPause(t),e%10==0&&this._updateTime())}onLoadStart(){this.eventEmitter.onLoadStart&&this.eventEmitter.onLoadStart(),this.isLoadstart=!0}onLoadedmetadata(){n.a.log("HlsTagPlayer(".concat(this._id,").onLoadedmetadata, paused="),this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay"))}onVideoPause(){this.sysPause=!0,this.eventEmitter.trigger(u.VIDEO_PAUSE),this._updateStatus(p.BROWSER_PAUSE)}onPlayVideo(){if(!this.started&&(this.started=!0,n.a.log("HlsTagPlayer(".concat(this._id,").onPlayVideo, paused="),this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay"),"currentTime=".concat(this._videoElm.currentTime)),this.eventEmitter.trigger(u.VIDEO_PLAY,{video:this._videoElm}),this.eventEmitter.onPlayVideo&&this.eventEmitter.onPlayVideo({video:this._videoElm}),this.loadeddataTs=_.a.now()-this.startTs,X.remove(this.onPlayTimeout,this),this._videoElm.autoplay||this._videoElm.getAttribute("x5-autoplay"))){const t=this._videoElm.play();t?t.then(()=>{n.a.log("HlsTagPlayer(".concat(this._id,") Auto play is ok")),this.allowedAutoPlay=!0,X.remove(this._playVideoFailed,this),X.remove(this._checkUrlActive,this);const t=this._videoElm.duration;this.isSeek&&0!=t&&(n.a.log("HlsTagPlayer(".concat(this._id,").onPlayVideo, seek, duration=").concat(t)),this.startSeek())}).catch(t=>{n.a.warn("HlsTagPlayer(".concat(this._id,") auto playing error: "),t.toString(),this._videoElm.paused),this.eventEmitter.trigger(u.BROWSER_PAUSE),this._videoElm.paused&&(this._updateStatus(p.BROWSER_PAUSE),this.allowedAutoPlay=!1,X.remove(this._playVideoFailed,this),X.remove(this._checkUrlActive,this),this.eventEmitter.trigger(u.BROWSER_PAUSE,{video:this._videoElm}))}):(n.a.warn("HlsPlayer(".concat(this._id,") video.play is not a promise")),D.a.matches.UC&&this._videoElm.paused?(n.a.log("HlsPlayer(".concat(this._id,") UC Browser, this._videoElm.paused ="),this._videoElm.paused),this._updateStatus(p.BROWSER_PAUSE),this.eventEmitter.trigger(u.BROWSER_PAUSE),this.allowedAutoPlay=!1,X.remove(this._playVideoFailed,this),X.remove(this._checkUrlActive,this),this.eventEmitter.trigger(u.BROWSER_PAUSE,{video:this._videoElm}),!this.isLive&&this._videoElm&&this._videoElm.pause()):X.once(this.onPlayTimeout,this,this.playTimeout||2e3))}}onPlayingVideo(){if(n.a.log("HlsTagPlayer(".concat(this._id,").onPlayingVideo, paused="),this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay")),this.sysPause=!1,this.ended=!1,this._updateStatus(p.VIDEO_PLAYING),!this.playing){this.playing=!0,this._pauseStat.start(this._videoElm),X.add(this.onCheckFastTimer,this,100),this.playTs=_.a.now();const t=this.playTs-this.startTs;t<=1e4&&(this._sendVideoLoadMetrics(t,this.loadeddataTs),this._sendVideoVodLoad(t)),X.remove(this._playVideoFailed,this)}}onDurationChange(){const t=this._videoElm.duration;this.isSeek&&0!=t&&this.started&&(n.a.log("HlsTagPlayer(".concat(this._id,").onDurationChange seek, duration=").concat(t)),this.startSeek())}onVideoError(t){n.a.log("HlsTagPlayer(".concat(this._id,").onVideoError: ")+wh.getErrorMessage(this._videoElm),t),this._videoElm&&this._videoElm.error&&(this._checkUrlActive(this.url),this.isPlaying||this._sendVideoVodLoad(99999),this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{code:N.a.H5_ERROR_CODE.VIDEO_ERROR,video:this._videoElm,error:t}),this.eventEmitter.onPlayerError&&this.eventEmitter.onPlayerError())}onEnded(t){n.a.log("HlsTagPlayer(".concat(this._id,").onEnded"),this.getCurrentTime()),this._setEnded(2)}startSeek(){this.setCurrentTime(this.seekTime),this.isSeek=!1}_sendVideoLoadMetrics(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._stat.setComDim(d.a.DIM_COM.ACT_LOAD_TYPE,N.a.HLS_LOAD_TYPE.XHR);const i=[this._stat.createAct(d.a.ACT.VIDEO_LOAD_TS,{value:[t,e]})];this._tsdb.sendMetrics(i)}sendNoPicture(){n.a.log("HlsTagPlayer(".concat(this._id,").sendNoPicture hasPicture=").concat(this.hasPicture," isLive=").concat(this.isLive)),this.hasPicture||this.isLive||(this.statVod.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,_.a.now()-this.statVod.create_time),this._tsdb.sendVodMP4Time({loadTime:99999,errorMessage:wh.getErrorMessage(this._videoElm)}))}_sendVideoVodLoad(t){this.isLive||this.videoLoadTimeSent||(this.videoLoadTimeSent=!0,n.a.log("HlsTagPlayer(".concat(this._id,")._sendVideoVodLoad"),t),this.statVod.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,_.a.now()-this.statVod.create_time),this.hasPicture||(t=99999),this._tsdb.sendVodMP4Time({loadTime:t}))}_setWaiting(t){if(this.waiting!==t){this.waiting=t,this.eventEmitter.trigger(u.PLAY_CARTON,t);const e=t?p.VIDEO_CACHING:p.VIDEO_PLAYING;this._updateStatus(e)}}_reportVideoQuality(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=[];this._stat.setCore(d.a.CORE.PLAY_DELAY,this.getBufferLen()),this._stat.setCore(d.a.CORE.VIDEO_BLOCK_COUNT,this._pauseStat._badQualityCnt),this._stat.setCore(d.a.CORE.VIDEO_BLOCK_DURATION,this._pauseStat._badQualityTime),this._stat.setCoreDim(d.a.DIM_CORE.VIDEO_BAD_QUALITY,this._pauseStat.paused?100:0),this.statVod.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,this._pauseStat.paused?100:0),this.statVod.setCore(d.a.VOD_CORE.VOD_BLOCK_COUNT,this._pauseStat._badQualityCnt),this.statVod.setCore(d.a.VOD_CORE.VOD_BLOCK_DURATION,this._pauseStat._badQualityTime),this._stat.fill(e,t),this.isLive||this.statVod.fill(e,t),this._tsdb.sendMetrics(e),this._pauseStat.checkBadQuality(),this._pauseStat.reset20()}setMuted(t){this._videoElm&&(this._videoElm.muted=t)}getCodecType(){return F}getVideoWidth(){return this._videoElm?this._videoElm.videoWidth:0}getVideoHeight(){return this._videoElm?this._videoElm.videoHeight:0}getFps(){return-100}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._videoElm&&(this._videoElm.playbackRate=Number(t))}},i?(this._player=new i(this._observer,{stat:this._stat,tsdb:this._tsdb,videoElement:this._videoElement}),this._player.start(e)):n.a.error("play error, streamType=",t.streamType)}stop(){Mn.off(Mn.ON_LOAD,this.onLoadVrLib,this),this._viewWidth=0,this._viewHeight=0,this.disposeVr(),this.disposePlayer()}setVolume(t){this._player&&this._player.setVolume(t)}setMuted(t){this._player&&this._player.setMuted(t)}getMuted(){return!!this._player&&this._player.getMuted()}getBufferLen(){return this._player?this._player.getBufferLen():0}getCurrentTime(){return this._player?this._player.getCurrentTime():0}getCurrentDts(){return this._player?this._player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this._player?this._player.getCurrentSeiOffsetDts():0}getDurationTime(){return this._player?this._player.getDurationTime():0}get connected(){return!!this._player&&this._player.connected}get isPlaying(){return!!this._player&&this._player.isPlaying}get hasPicture(){return!!this._player&&this._player.hasPicture}play(){this._player&&this._player.play()}pause(){this._player&&this._player.pause()}updatePlayerStatus(t){this._info.streamType===Gh.StreamType.HLS&&(this._player.started=t)}seek(t){this._player&&this._player.seek(t)}setSize(t,e){this._viewWidth=t,this._viewHeight=e,this._vr&&this._vr.setSize(t,e)}getViewport(){return this._vr?this._vr.getViewport():{x:0,y:0,z:0}}setViewport(t){this._vr&&this._vr.setViewport(t)}addViewport(t){this._vr&&this._vr.addViewport(t)}onPlayVideo(t,e){this._data=e,this._info.vr.videoWidth=e.width,this._info.vr.videoHeight=e.height,Mn.on(Mn.ON_LOAD,this.onLoadVrLib,this),Mn.loadLib(this._info.h5Root)}onLoadVrLib(){Mn.off(Mn.ON_LOAD,this.onLoadVrLib,this),this._data.width=this._viewWidth||this._data.width,this._data.height=this._viewHeight||this._data.height,this._vr=Mn.createVr(this._data.video,this._info.vr),this._vr.play(),this._hyPlayer.trigger(m.VIDEO_PLAY,{video:this._vr.getView(),width:this._data.width,height:this._data.height})}};var zh=class{constructor(){this.player=null,this.eventEmitter=null,this.backCd=o.a.vodAv1Cd,this.backCntMax=o.a.vodAv1CdCnt,this.backCnt=0,this.backTs=0,this.switchTs=-1,this.state=0,this.pauseTs=0}destroy(){X.remove(this.onCheckTimer,this),this.player=null,this.eventEmitter=null}isTimeToBack(){return 2===this.state}start(t){this.backCnt>=this.backCntMax||(this.player=t,this.eventEmitter=t.eventEmitter,0===this.state&&(this.backCnt<this.backCntMax&&this.backCnt++,this.backTs=_.a.now()+this.backCd*this.backCnt,X.add(this.onCheckTimer,this,1e3),this.state=1,n.a.log("BackToAV1.start")))}stop(){this.state=0,X.remove(this.onCheckTimer,this)}onCheckTimer(t){if(1===this.state)t>this.backTs&&(n.a.log("BackToAV1.onCheckTimer time to back"),this.state=2,this.player.setStopLoadFragment());else if(2===this.state){let t=this.player.getBufferLen();if(t<1e3){let e=this.player.getCurrentTime();n.a.log("BackToAV1.onCheckTimer time to switch curTime=".concat(e)),this.stop(),this.state=0;let i=e+t/1e3;this.eventEmitter.trigger(u.TRY_TO_AV1,i)}}}};class Jh extends Ht{constructor(t,e){super(),this.type=t,this.config=e,this.link=null,this._onOpenBind=this._onOpen.bind(this),this._onDataBind=this._onData.bind(this),this._onSucBind=this._onSuc.bind(this),this._onErrorBind=this._onError.bind(this),this._onTimeoutBind=this._onTimeout.bind(this),this.openTs=0,this.completeTs=0,this.byteSize=0}_createLoader(t,e){let i=null;return i=un.isSupported()&&this.type===Jh.Types.FETCH?new un({}):new Sa({}),i.fromByte=t,i.toByte=e,i}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.stop(),this.link=this._createLoader(e,i),this.link.loadBuffer(t,this._onOpenBind,this._onDataBind,this._onSucBind,this._onErrorBind,this._onTimeoutBind,this.config.timeout||3e3,this.config.retry||3,this.config.retryDelay||1e3)}stop(){this.link&&(this.link.destroy(),this.link=null),this.openTs=0,this.completeTs=0,this.byteSize=0}_onOpen(){this.openTs=_.a.now()}_onData(t){this.byteSize+=t.byteLength,this.trigger(Jh.Events.DATA,t)}_onSuc(){this.completeTs=_.a.now(),this.trigger(Jh.Events.COMPLETE)}_onError(){this.trigger(Jh.Events.ERROR)}_onTimeout(){this.trigger(Jh.Events.TIMEOUT)}}Jh.Events={DATA:"data",COMPLETE:"complete",ERROR:"error",TIMEOUT:"timeout"},Jh.Types={FETCH:"fetch",XHR:"xhr"};var Qh=Jh,Xh=class{constructor(t,e){this.isReady=!1,this.isHevc=!1,this.isAV01=!1,this.VPS=[],this.SPS=[],this.PPS=[],this.sps=null,this.pps=null,this.vps=null,this.codec="",this.width=t,this.height=e,this.codecID=0,this.streamFormat="",this.lengthSizeMinusOne=0,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.hevcSpsParser=new Xt}parse(t,e,i){if(i<5)return void n.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+i);let s=t[e]>>4;this.codecID=15&t[e++];let r=t[e++];5!==i?0===r&&(e+=3,12===this.codecID?this.parseVideoConfigH265(t,e,i):13===this.codecID?this.parseVideoConfigAV1(t,e):(this.streamFormat="Avcc",this.parseVideoConfigH264(t,e)),this.isReady=!0):n.a.log("FlvParser.parseVideo avc_empty frameType="+s+" avcPacketType="+r)}parseVideoConfigH265(t,e,i){let s=this.hevcFindNextStartCode(t,e);s.found?(this.streamFormat="AnnexB",this.parseVideoConfigH265AnnexB(t,e+s.startCodeSize,i)):(this.streamFormat="Hvcc",this.parseVideoConfigH265Hvcc(t,e,i))}parseVideoConfigH265AnnexB(t,e,i){let s=e+i-5,r=(126&t[e])>>1,a=e,o=[],n=[],h=[],d=[],l=[],c=[];for(;e<s;){let i=this.hevcFindNextStartCode(t,e);if(i.found||e+1===s){switch(r){case 32:let i=null;i=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.vpsUnit=i,o.push(i.data),d.push({length:i.data.length,nalu:i.data});break;case 33:let u=null;u=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.spsUnit=u,n.push(u.data),l.push({length:u.data.length,nalu:u.data});break;case 34:let p=null;p=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.ppsUnit=p,h.push(p.data),c.push({length:p.data.length,nalu:p.data})}if(e+i.startCodeSize<s){r=(126&t[e+=i.startCodeSize])>>1,a=e;continue}}e++}this.VPS=d,this.SPS=l,this.PPS=c,this.vps=o,this.sps=n,this.pps=h}parseVideoConfigH265Hvcc(t,e,i){e+=21;let s=[],r=[],a=[],o=[],h=[],d=[];this.lengthSizeMinusOne=3&t[e++];const l=t[e++];n.a.log("FlvParser.parseVideoConfig Hvcc nNaluArrayCount=".concat(l));for(let i=0;i<l;i++){let i=99&t[e++];if(32===i){let i=(t[e++]<<8)+t[e++],r=0;for(let a=0;a<i;++a){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:32};this.vpsUnit=i,e+=r,s.push(i.data),o.push({length:i.data.length,nalu:i.data})}}else if(33===i){let i=(t[e++]<<8)+t[e++],s=0;for(let a=0;a<i;++a){s=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+s),type:33};this.spsUnit=i,e+=s,r.push(i.data),h.push({length:i.data.length,nalu:i.data})}}else if(34===i){let i=0,s=(t[e++]<<8)+t[e++];for(let r=0;r<s;++r){i=(t[e++]<<8)+t[e++];let s={data:t.subarray(e,e+i),type:34};this.ppsUnit=s,e+=i,a.push(s.data),d.push({length:s.data.length,nalu:s.data})}}}this.VPS=o,this.SPS=h,this.PPS=d,this.vps=s,this.sps=r,this.pps=a}parseVideoConfigAV1(t,e){}parseVideoConfigH264(t,e){e+=4,this.lengthSizeMinusOne=3&t[e++],this.streamFormat="Avcc";let i=[],s=[],r=0,a=31&t[e++];for(let o=0;o<a;++o){r=(t[e++]<<8)+t[e++];let a={data:t.subarray(e,e+r),type:7};this.spsUnit=a,e+=r,i.push(a.data),s.push({length:r,nalu:a.data})}let o=[],n=[],h=0,d=t[e++];for(let i=0;i<d;++i){h=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+h),type:8};this.ppsUnit=i,e+=h,o.push(i.data),n.push({length:h,nalu:i.data})}this.SPS=s,this.PPS=n,this.sps=i,this.pps=o,this.parseSPS(this.spsUnit)}parseSPS(t){if(12===this.codecID){this.isHevc=!0;let e={};this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,e);let i=e.profile_space,s=e.profile_idc,r=e.profile_compatibility_flags;r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16|r<<16;let a=e.tier_flag,o=e.level_idc;this.codec="hvc1."+["","A","B","C"][i%4]+s.toString()+"."+r.toString(16).toLowerCase()+"."+["L","H"][a%2]+o.toString(),this.width=e.width||this.width,this.height=e.height||this.height}else{try{let e=new Dt(t.data);config=e.readSPS(),this.width=config.width,this.height=config.height}catch(t){n.a.log("FlvParser.parseSPS error, msg=".concat(t.message))}let e=t.data.subarray(1,4),i="avc1.";for(let t=0;t<3;t++){let s=e[t].toString(16);s.length<2&&(s="0"+s),i+=s}this.codec=i}}hevcFindNextStartCode(t,e){return 0===t[e]&&0===t[e+1]?1===t[e+2]?{found:!0,startCodeSize:3}:0===t[e+2]&&1===t[e+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}},$h=class{constructor(){this.isReady=!1,this.audioConfig=null,this.audioObjectType=0,this.audioChannelCount=0,this.audioSampleRate=0,this.aacTimeLen=0}parse(t,e,i){let s=t[e++]>>>4;if(10!=s&&n.a.warn("FlvParser.parseAudio Unsupported audio codec, soundFormat="+s),0===t[e++])if(i>=4){this.audioObjectType=t[e]>>3;let i=((7&t[e])<<1)+((128&t[e+1])>>7);if(i>=Te.AdtsSampleingRates.length)return void n.a.warn("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+i);this.audioChannelCount=(120&t[e+1])>>3,this.audioConfig=this.getAdtsConfig(this.audioObjectType,i,this.audioChannelCount),this.isReady=!0}else n.a.warn("FlvParser.parseAudio adts error dataLen="+i+" ts="+timeStamp)}getAdtsConfig(t,e,i){let s=0,r=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?e>=6?(t=5,r=new Array(4),s=e-3):(t=2,r=new Array(2),s=e):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,r=new Array(2),s=e):(t=5,r=new Array(4),s=e):(t=5,r=new Array(4),s=e,e>=6?s=e-3:1===i&&(t=2,r=new Array(2),s=e)),this.audioSampleRate=Te.AdtsSampleingRates[e],this.aacTimeLen=1024e3/this.audioSampleRate,n.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),r[0]=t<<3,r[0]|=(14&e)>>1,r[1]=(1&e)<<7,r[1]|=i<<3,5===t&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),n.a.log("FlvParser.getAdtsConfig type="+t+" index="+e+" channel="+i+" exIndex="+s+" config="+r),r}},Zh=class{constructor(t){this.index=t,this.fromByte=0,this.endByte=0,this.duration=0,this.start=0,this.prevFrag=null,this.nextFrag=null}isInRange(t){return t>=this.start&&t<this.start+this.duration}},td=class{constructor(){this.isReady=!1,this.fragList=[],this.totalDuration=0}parse(t){this.totalDuration=t.duration;let e=t.filepositions,i=t.times;if(e&&i){let s=e.length,r=null;for(let a=0;a<s;a++){let o=new Zh(a);o.fromByte=e[a],o.start=i[a],a+1<s?(o.endByte=e[a+1]-1,o.duration=i[a+1]-i[a]):t.duration&&(o.duration=t.duration-i[a]),r&&(r.nextFrag=o,o.prevFrag=r),this.fragList.push(o),r=o}this.isReady=!0}}seek(t){let e=this.fragList[0];for(;e;){if(e.isInRange(t))return e;e=e.nextFrag}return null}},ed=class{constructor(){this.isReady=!1,this.metadata={}}parse(t,e,i){if(e+Te.SCRIPT_AMF1_HEAD_LEN>i)return void n.a.log("script too small");t[e++];let s=(t[e++]<<8)+t[e++],r=Lt.getStr(t,e,s);e+=s,"onMetaData"===r&&(this.metadata=Lt.parseScript(t,e,t.length).data,this.isReady=!0)}};class id extends Ht{constructor(){super(),this.loader=new Qh(Qh.Types.FETCH,{}),this.loader.on(Qh.Events.DATA,this._onData,this),this.loader.on(Qh.Events.ERROR,this._onError,this),this.loader.on(Qh.Events.TIMEOUT,this._onTimeout,this),this.headerBuffer=null,this.parseHeader=!1,this.buffer=new Pe,this.metadata=new ed,this.videoConfig=new Xh(this.metadata.metadata.width||1280,this.metadata.metadata.height||720),this.audioConfig=new $h,this.fileList=new td,this.isReady=!1}stop(){this.loader.stop()}load(t){this.loader.load(t)}_onData(t){if(t instanceof Uint8Array||(t=new Uint8Array(t)),this.headerBuffer){let e=new Uint8Array(this.headerBuffer.length+t.length);e.set(this.headerBuffer,0),e.set(t,this.headerBuffer.length),t=e}let e,i=t.length,s=0;if(!this.parseHeader){let e=Te.FLV_HEADER_LEN+Te.PREV_TAG_SIZE_LEN;if(i<e)return void(this.headerBuffer=t.slice());if(this.headerBuffer=null,s+=e,!Te.probe(t))return;this.parseHeader=!0}for(this.buffer.append(0===s?t:t.slice(s));null!==(e=this.buffer.popFrame());)if(this.parseTag(e),this.videoConfig.isReady&&this.audioConfig.isReady&&this.metadata.isReady){this.isReady=!0;break}this.isReady&&(this.loader.stop(),this.trigger(id.Events.READY))}parseTag(t){let e=t.length;if(e<Te.TAG_HEADER_LEN+Te.PREV_TAG_SIZE_LEN)return void n.a.warn("FlvParser.parseTag flv has no whole tag len="+e+" data="+t);let i=0,s=t[i++],r=(t[i++]<<16)+(t[i++]<<8)+t[i++];e-(Te.TAG_HEADER_LEN+Te.PREV_TAG_SIZE_LEN)<r?n.a.warn("FlvParser.parseTag flv has no enough data dataLen="+r+" len="+e):0!==r?(i+=4,i+=3,s===Te.VIDEO_TYPE?this.videoConfig.parse(t,11,r):s===Te.AUDIO_TYPE?this.audioConfig.parse(t,11,r):s===Te.SCRIPT_TYPE&&(this.metadata.parse(t,11,r),this.fileList.parse(this.metadata.metadata))):n.a.warn("FlvParser.parseTag flvtag empty type="+s)}_onError(){this.trigger(id.Events.ERROR)}_onTimeout(){this.trigger(id.Events.TIMEOUT)}}id.Events={READY:"READY",ERROR:"ERROR",TIMEOUT:"TIMEOUT"};var sd=id;class rd extends Ht{constructor(){super(),this.type=Qh.Types.XHR,this.seeking=!1,this.frag=null,this.loading=!1,this.url="",this.loader=new Qh(this.type,{}),this.loader.on(Qh.Events.DATA,this._onData,this),this.loader.on(Qh.Events.ERROR,this._onError,this),this.loader.on(Qh.Events.TIMEOUT,this._onTimeout,this),this.loader.on(Qh.Events.COMPLETE,this._onComplete,this)}_onData(t){this.trigger(rd.Events.DATA,t)}_onError(){}_onTimeout(){}_onComplete(){this.loading=!1,this.seeking&&(this.seeking=!1,this.trigger(rd.Events.SEEKED)),this.trigger(rd.Events.COMPLETE)}hasNext(){return this.frag&&this.frag.nextFrag}load(t){this.loading=!0,this.frag=t,this.loader.load(this.url,t.fromByte,t.endByte)}loadNext(){this.loading||(this.frag&&this.frag.nextFrag?this.load(this.frag.nextFrag):this.frag=null)}seek(t){n.a.log("VodFlvFragLoader.seek idx=".concat(t.index," start=").concat(t.start," dur=").concat(t.duration)),this.loader.stop(),this.load(t),this.seeking=!0,this.trigger(rd.Events.SEEKING)}}rd.Events={DATA:"data",SEEKING:"seeking",SEEKED:"seeked",COMPLETE:"complete"};var ad=rd,od=class{constructor(t,e){this.eventEmitter=t,this.stat=e.statVod,this.tsdb=e.tsdb,this.videoElement=e.videoElement,this.h265Proxy=e.h265Proxy,this.isPureAudio=!!e.isPureAudio,this.isPureVideo=!!e.isPureVideo,this.videoStatus=p.VIDEO_INIT,this.info=null,this.url="",this.seekTime=0,this.lastPlayTime=0,this.lastTimerTs=0,this.isMuted=!1,this.volume=1,this.playBackRate=1,this.nowEndTs=0,this.userPaused=!1,this.mse=this._createMse(),this.playList=new sd,this.playList.on(sd.Events.READY,this.onPlayListReady,this),this.playList.on(sd.Events.ERROR,this.onPlayListError,this),this.playList.on(sd.Events.TIMEOUT,this.onPlayListTimeout,this),this.fragLoader=new ad,this.fragLoader.on(ad.Events.DATA,this._onData,this),this.fragLoader.on(ad.Events.COMPLETE,this._onFragComplete,this),this.fragLoader.on(ad.Events.SEEKING,this._onFragSeeking,this),this.fragLoader.on(ad.Events.SEEKED,this._onFragSeeked,this)}get started(){return this.videoStatus!==p.VIDEO_INIT&&this.videoStatus!==p.VIDEO_STOP}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(u.PLAY_STATUS,{status:t}))}_createMse(){let t=new to(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,isLive:!1,videoElement:this.videoElement});return t.setPushGop(o.a.pushGop),t.setMuted(this.isMuted),t.setPlaybackRate(this.playBackRate),t.setVolume(this.volume),t}start(t){this.stop(),this.info=t,this.initInfo(t),this.url?(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,this.h265Proxy.isLive=!1,this.h265Proxy.isH265Stream=!1,this.stat.setComDim(d.a.VOD_DIM_COM.MSE_PLAYER,1),this.seekTime=t.seekTime||0,this.playList.load(this.url),this.updateStatus(p.VIDEO_LOADING)):n.a.warn("VodFlvPlayer.start invalid argument, pls check the url.")}initInfo(t){let e=t.url,i=[];t.iBitRate>0&&i.push("ratio=".concat(t.iBitRate)),i.length>0&&(e+=(-1!==e.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.url=e,this.fragLoader.url=e}onPlayListReady(){this.eventEmitter.trigger(u.PLAYBACK_M3U8_UPDATED,{totalDuration:this.playList.fileList.totalDuration}),this.updateMseInfo(),this.fragLoader.load(this.playList.fileList.seek(this.seekTime)),X.add(this._onTimer,this,100)}updateMseInfo(){let t=this.mse.parser;t.parseFlvHead=!0,Object.assign(t.metadata,this.playList.metadata.metadata);let e=this.playList.videoConfig;t.streamFormat=e.streamFormat,t.lengthSizeMinusOne=e.lengthSizeMinusOne,t.codec=e.codecID,t.videoCodec=e.codec,t.VPS=e.VPS,t.SPS=e.SPS,t.PPS=e.PPS,t.videoWidth=e.width,t.videoHeight=e.height,this.mse.setAvcCfg(e.width,e.height),this.mse.updateVideoConfig({isHevc:e.isHevc,isAV01:e.isAV01,vps:e.vps,sps:e.sps,pps:e.pps,codec:e.codec,width:e.width,height:e.height},!0),t.remuxer.switchLevel(!1,!1);let i=this.playList.audioConfig;t.recvAudioConfig=!0,t.audioConfig=i.audioConfig.slice(),t.audioSampleRate=i.audioSampleRate,t.aacTimeLen=i.aacTimeLen,t.audioObjectType=i.audioObjectType,t.audioChannelCount=i.audioChannelCount,this.mse.updateAudioConfig({audioConfig:t.audioConfig,codec:"mp4a.40.5",audioSampleRate:t.audioSampleRate,aacTimeLen:t.aacTimeLen,audioObjectType:t.audioObjectType,audioChannelCount:t.audioChannelCount},!1,$t)}_onTimer(t){if(this._loadNextFrag(),0===this.lastTimerTs?this.lastTimerTs=t:t-this.lastTimerTs>1e3&&(this._playTimeUpdate(),this.lastTimerTs=t),this._isEnded()){if(n.a.log("VodFlvPlayer.check onEnded, curTime=".concat(this.getCurrentTime(),", duration=").concat(this.getDurationTime())),this.mse){let t=this.mse.getPlayVideo();t&&(t.currentTime=this.playList.fileList.totalDuration)}this.onEnded()}}onEnded(){this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.M3U8_PLAY_ENDED),this.h265Proxy&&this.h265Proxy.onEnded&&this.h265Proxy.onEnded(),this.mse&&this.mse.onEnded&&this.mse.onEnded()}_isEnded(){if(this.videoStatus===p.VIDEO_STOP)return!1;const t=this.playList.fileList.totalDuration,e=this.getCurrentTime(),i=t-e,s=_.a.now();if(i<3){if(0===this.nowEndTs)this.nowEndTs=s+1e3*(t-e)+300;else if(s>=this.nowEndTs)return n.a.log("HlsPlayer._isEnded,duration=".concat(t,",currentTime=").concat(e,",delta=").concat(i)),this.nowEndTs=0,!0}else this.nowEndTs=0;return!1}_playTimeUpdate(){this.eventEmitter.trigger(u.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}_loadNextFrag(){this.getBufferLen()<2e4&&!this.userPaused&&this.fragLoader.loadNext()}seek(t){n.a.log("VodFlvPlayer.seek time=".concat(t)),this.seekTime=t,this.fragLoader.seek(this.playList.fileList.seek(t))}setMuted(t){this.isMuted=t,this.mse&&this.mse.setMuted(t)}getMuted(){return this.isMuted}setVolume(t){this.volume=t,this.mse&&this.mse.setVolume(t)}getVolume(){return this.volume}setPlaybackRate(t){this.playBackRate=t,this.mse&&this.mse.getPlayVideo&&(this.mse.getPlayVideo().playbackRate=Number(t))}onPlayPause(t,e,i){e&&(this.pauseTs=t,this.updateStatus(p.VIDEO_CACHING),this.startSendPauseTimer())}onPlayResume(t,e){if(this.pauseTs>0){let e=t-this.pauseTs,i=200;this.playBackRate<1&&this.playBackRate>0&&(i=Math.min(400,200*~~(1/this.playBackRate))),e>i&&(n.a.warn("HlsPlayer.onPlayResume pauseTime=".concat(e,", pauseDelta=").concat(i)),this.stat.addCore(d.a.CORE.VIDEO_BLOCK_COUNT,1),this.stat.addCore(d.a.CORE.VIDEO_BLOCK_DURATION,e),this.eventEmitter.trigger(u.VIDEO_BAD_QUALITY)),this.pauseTs=0}e&&(this.updateStatus(p.VIDEO_PLAYING),this.eventEmitter.trigger(u.VIDEO_PLAYING,{video:this.videoElement,event:event}))}startSendPauseTimer(){this.stopSendPauseTimer(),X.add(this.sendPauseEvent,this,200)}stopSendPauseTimer(){X.remove(this.sendPauseEvent,this)}sendPauseEvent(){this.videoStatus!==p.VIDEO_PLAYING&&this.eventEmitter.trigger(u.PLAY_CARTON)}onPlayVideo(t,e,i,s,r,a,o){let n={video:t,width:e,height:i,canvas:r,codec:o};this.updateStatus(p.VIDEO_PLAYING),this.eventEmitter.trigger(u.VIDEO_PLAY,n)}onVideoStop(t,e){e&&(this.updateStatus(p.VIDEO_STOP),this.eventEmitter.trigger(u.VIDEO_STOP,{video:t}))}onPlayListError(){this.eventEmitter.trigger(u.HLS_URL_UNAVAILABLE)}onPlayListTimeout(){this.eventEmitter.trigger(u.HLS_MAINFEST_LOAD_TIMEOUT)}onErrorEvent(t){let e=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(u.H5_PLAYER_ERROR_IN,{video:e,code:t.type,msg:"播放错误"})}_onData(t){t instanceof Uint8Array||(t=new Uint8Array(t)),this.mse&&this.mse.appendFlv(t)}_onFragComplete(){!this.fragLoader.hasNext()&&this.mse&&this.mse.ctrlBuffer&&this.mse.ctrlBuffer._popAllBuffer()}_onFragSeeking(){let t=this.mse.remuxer,e=t._initDTS,i=t._initPTS;this.mse.destroy(),this.mse=this._createMse(),this.mse.remuxer._initDTS=e,this.mse.remuxer._initPTS=i,this.updateMseInfo()}_onFragSeeked(){n.a.log("VodFlvPlayer._onFragSeeked"),this.seekTime>0&&(this.mse.seek(this.seekTime),this.seekTime=0)}stop(){this.videoStatus=p.VIDEO_STOP,X.remove(this._onTimer,this),this.playList.stop(),this.destroyMse()}destroyMse(){this.mse&&(this.mse.destroy(),this.mse=null),this.mse=this._createMse()}getBufferLen(){return this.mse?this.mse.getBufferLen():0}getCurrentTime(){return this.seekTime>0?this.seekTime:(this.mse&&(this.lastPlayTime=this.mse.getCurrentTime()/1e3),this.lastPlayTime>this.getDurationTime()?this.getDurationTime():this.lastPlayTime)}getCurrentRealTime(){return this.mse&&this.mse.video&&this.mse.video.getCurrentTime()||0}getCurrentDts(){return this.mse?this.mse.getCurrentDts():0}getDurationTime(){return this.playList.fileList.totalDuration}pause(){this.started&&(n.a.info("VodFlvPlayer.pause"),this.userPaused=!0,this.mse&&this.mse.pause())}play(){this.started&&(n.a.info("VodFlvPlayer.play"),this.userPaused=!1,this.mse&&this.mse.play())}};let nd=1;class hd{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._id=nd++,this.player=null,this.playInfo=null,this.started=!1,this.ended=!1,this.playerType="",this._loop=!1,this._volume=0,this._muteVal=!1,this._paused=!1,this._playbackRate=1,this._duration=0,this._coderate="1000",this.videoElement=e.videoElement,this.eventEmitter=t,this.createVideoElmInner=!1,this.busiSource=e.source,this.busiPlace=e.place,this.vrElement=null,this.streamType="",this.isRetrying=!1,this.hadPlayVideo=!1,this._type=0,this.h264StreamBitrate=0,this.h265StreamBitrate=0,this.av1StreamBitrate=0,this.av1State=0,this.anchorUid=e.anchorUid,this.sdkInRoomTs=Date.now(),this.hlsNoPictureStartTs=0,this.isSendNoPicture=!1,this.visibility=new oh(this.eventEmitter),this.stat=new Pn,this.statVod=new En,this.metrics=new L,this.tsdbUtil=new A({stat:this.stat,statVod:this.statVod,eventEmiter:this.eventEmitter}),this.videoEnhance=new Th(this,this.stat,this.statVod),this.h265WasmProxy=new $n(this.stat,this.tsdbUtil,this.statVod),this.h265MseProxy=new Zn(this.stat,this.tsdbUtil,this.statVod),this.statVod.setComDim(d.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_PLACE,this.busiSource||"other"),this.statVod.setComDim(d.a.DIM_COM.PLACE,this.busiPlace||Mh.getPlace(this.busiSource)),this.tsdbUtil.setBusiSource(e.source),this._onStartPlayBind=this._onStartPlay.bind(this),this._onWorkerTimeoutBind=this._onWorkerTimeout.bind(this),this.eventsMap=new Map,this.eventsMap.set(m.TURN_TO_H264,this.onTurntoH264.bind(this)),this.eventsMap.set(m.H265_VIDEO_RETRY,this.onH265Retry.bind(this)),this.eventsMap.set(m.TURN_TO_MSE,this.onTurnToMse.bind(this)),this.eventsMap.set(m.TURN_TO_WEBCODECS_SOFT,this.onTurnToWebcodecsSoft.bind(this)),this.eventsMap.set(m.WEBCODECS_RETRY,this.onWebcodecsRetry.bind(this)),this.eventsMap.set(m.ON_VIDEO_ENHANCE_ERROR,this.onVideoEhanceError.bind(this)),this.eventsMap.set(m.ON_VIDEO_ENHANCE_SUCCESS,this.onVideoEhanceSuccess.bind(this)),this.eventsMap.set(m.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.eventsMap.set(m.PLAY_TIME_STATUS,this._onVideoTimeupdate.bind(this)),this.eventsMap.set(m.VIDEO_SEEK,this._onVideoHlsSeek.bind(this)),this.eventsMap.set(m.H5_PLAYER_ERROR_IN,this._onH5PlayerError.bind(this)),this.eventsMap.set(m.PAUSE_5S_RETRY,this._onVideoPause5sRetry.bind(this)),this.eventsMap.set(m.M3U8_PLAY_ENDED,this._onM3u8PlayEnded.bind(this)),this.eventsMap.set(m.TRY_TO_AV1,this._onBackToAV1.bind(this)),this.eventsMap.set(m.TURN_TO_H265_WASM,this.onTurntoH265Wasm.bind(this)),this.eventsMap.set(m.VIDEO_TAG_ENDED,this._onVideoEnded.bind(this)),this.eventsMap.set(m.VIDEO_TAG_SEEKED,this._onVideoSeek.bind(this)),this.eventsMap.set(m.VIDEO_TAG_LOADSTART,this._onVideoLoadStart.bind(this)),this._backToAv1=new zh,this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!1,this.isUseEnhance=!1,this.h264StreamInfo=null,this.h265StreamInfo=null,this.av1StreamInfo=null,this.hasPlayed=!1,this.isUseHlsTag=!1,this.errorReplayCnt=0}destroy(t){X.remove(this.onCheckTimer,this),X.remove(this.onNoPicture,this),this._removeVideoListeners(),this.eventsMap&&this.eventsMap.clear(),this.eventsMap=null,this.visibility&&this.visibility.destroy(),this.visibility=null,this.player&&(this.player.destroy(),this.player=null),this.videoElement=null,this.stat&&this.stat.destroy(),this.stat=null,this.statVod&&this.statVod.destroy(),this.statVod=null,this._backToAv1&&this._backToAv1.destroy(),this._backToAv1=null,this.metrics&&this.metrics.destroy(),this.metrics=null,this.tsdbUtil&&this.tsdbUtil.destroy(),this.tsdbUtil=null,this.videoEnhance&&this.videoEnhance.destroy(),this.videoEnhance=null,this.h265WasmProxy&&this.h265WasmProxy.destroy(),this.h265WasmProxy=null,this.h265MseProxy&&this.h265MseProxy.destroy(),this.h265MseProxy=null,this.h265Info=null,this.playInfo=null,this.eventEmitter=null,n.a.log("VodMgr destroyed id=".concat(this._id))}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P.bindEvent(this.tsdbUtil,t._sessionId,t.lineType||0,"",t.bitrate||"1000"),this.errorReplayCnt=0,t._started_||(t._started_=!0,this.isSendNoPicture=!1),this._start(t)}_start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&this.stop(),t=Object.assign({isLive:!1},t),n.a.log("VodMgr.palyer id=".concat(this._id," info: "),t),this._addVideoListeners(),ut.recordComDim(this.stat,t),ut.recordComDim(this.statVod,t),t.isCloseVodPcdn&&(o.a.isCloseVodPcdn=1),t.hasOwnProperty("isVodTurnTo264")&&(o.a.isVodTurnTo264=t.isVodTurnTo264),t.hasOwnProperty("isVodSupportH265")&&(o.a.isVodSupportH265=t.isVodSupportH265),t.uid&&(v.a.uid=t.uid),t.presenterUid||(t.presenterUid=this.anchorUid),0===v.a.convertUid&&v.a.uid>0&&(v.a.convertUid=R.b.rotUid(v.a.uid,t.presenterUid)),this.visibility.setStat(this.stat,this.statVod),this.started=!0,this._coderate=t.coderate||"1000",t.coderate=this._coderate,this.stat.setComDim(d.a.DIM_COM.PLAYER_TYPE,t.type),this.stat.setComDim(d.a.DIM_COM.LIVE_TYPE,t.liveType||Fn.a.VOD),this.stat.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.stat.setComDim(d.a.VOD_DIM_COM.LINE,t.lineType||0),this.stat.setComDim(d.a.VOD_DIM_COM.PULLSTREAM_REASOM,t.pullStreamFrom||0),this.stat.setComDim(d.a.VOD_DIM_COM.IS_MEMORY_GEAR,t.isMemoryGear?1:0),this.statVod.setComDim(d.a.DIM_COM.PLAYER_TYPE,t.type),this.statVod.setComDim(d.a.DIM_COM.LIVE_TYPE,t.liveType||Fn.a.VOD),this.statVod.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.statVod.setComDim(d.a.VOD_DIM_COM.LINE,t.lineType||0),this.statVod.setComDim(d.a.VOD_DIM_COM.PULLSTREAM_REASOM,t.pullStreamFrom||0),this.statVod.setComDim(d.a.VOD_DIM_COM.IS_MEMORY_GEAR,t.isMemoryGear?1:0),this.stat.setComDim(d.a.DIM_COM.GAMEID,t.gameId),this.statVod.setComDim(d.a.VOD_DIM_COM.GAMEID,t.gameId),this.playerType=t.type,this.streamType=t.streamType||this.playerType,!this.videoElement&&this._createVideoElm(),this.videoElement.setAttribute("crossOrigin","anonymous"),this.videoElement&&(this.videoElement.volume=this._volume),this.h265Info=t,this.playInfo=t,this._type=t.type,this.startByCodec(t)}startByCodec(t){this._hasHttpPrefix(t.url)||(t.url="https:".concat(t.url)),t.tsInfo&&!this._hasHttpPrefix(t.tsInfo.tsUrl)&&(t.tsInfo.tsUrl="https:".concat(t.tsInfo.tsUrl)),this.startTs=_.a.now(),n.a.log("VodMgr.startNow id=".concat(this._id),this.startTs),this.h265Info=t,this.getVStreamInfo(t),this.h265WasmProxy.initSupport(t);let e=this.getMseHevcSupport(t);if(X.add(this.onCheckTimer,this,1e3),e&&o.a.useNextWcsTime&&f.a.hasOwnProperty("nextWcsTime")){let i=Number(f.a.nextWcsTime)||0,s=Date.now();-1===o.a.noNextWcsTimeUids.indexOf(Number(t.uid))&&i>s&&-1!==h.a.name.indexOf("edg")&&(e=!1)}this.h265Proxy=e?this.h265MseProxy:this.h265WasmProxy,this.av1StreamInfo&&1==t._av1State?(t.iBitRate=this.av1StreamInfo.iBitRate,this.statVStreamExtInfo(this.av1StreamInfo,t)):this.h265StreamInfo&&(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec)?(t.iBitRate=this.h265StreamInfo.iBitRate,this.statVStreamExtInfo(this.h265StreamInfo,t)):this.h264StreamInfo&&this.statVStreamExtInfo(this.h264StreamInfo,t),this.videoEnhance.setInfo(t),t._sMod=R.b.getSupportMod(this.h265WasmProxy.isSupported,this.h265Proxy.isServerSupported,!!t._vodStates&&t._vodStates.av1SvrOpen,!!t._vodStates&&t._vodStates.av1Support),e||1==t._av1State?(n.a.log("VodMgr.startByCodec id=".concat(this._id," Play MSE H265")),this.stat.setComDim(d.a.DIM_COM.HARDDECODE,1),this.statVod.setComDim(d.a.VOD_DIM_COM.HARDDECODE,1),this.startPlayer(t)):this.h265Proxy.isSupported?(this.stat.setComDim(d.a.DIM_COM.HARDDECODE,2),this.statVod.setComDim(d.a.VOD_DIM_COM.HARDDECODE,2),this.h265Proxy.loadDecoder(t.h5Root,{ready:this._onStartPlayBind,error:this._onWorkerTimeoutBind,timeout:this._onWorkerTimeoutBind}),this.h265StreamBitrate&&(this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate))):(this.h264StreamBitrate&&(this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate)),this.startPlayer(t))}getMseHevcSupport(t){return this.h265MseProxy.initSupport(t),1==Number(f.a._forceMseHevc)?(n.a.warn("VodMgr.getMseHevcSupport id=".concat(this._id," force mse h265")),!0):!!this.h265MseProxy.isSupported}_onWorkerTimeout(){this.startPlayer(this.h265Info,!0)}startPlayer(t,e){let i=R.b.checkWebCodec(t,this.stat,this.h265Proxy.isSupported);this.checkWebCodecSoft(t),this.isTurnToMse?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,this.eventEmitter.turnMseType),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,this.eventEmitter.turnMseType)):t.isPureAudio?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_PUREAUDIO),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_PUREAUDIO)):1==f.a.isAngelNull?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.ANGLE_NULL),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.ANGLE_NULL)):R.b.isWebcodecsBrowserSupported()?1==f.a.isChromeH265RenderInfoEmpty?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.CHROME_H265_RENDER_INFO_EMPTY),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.CHROME_H265_RENDER_INFO_EMPTY)):this.h265Proxy.isSupported&&1==f.a.isCloseWebcodecsH265||1==f.a.isCloseWebcodecsH264||1==t._av1State&&1==f.a.isCloseWebcodecsAv1?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_CONFIGURE),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_CONFIGURE)):-1!=D.a.os.toLowerCase().indexOf("mac")?(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_OS),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_OS)):1==t._av1State&&0==o.a.av1Webcodecs&&(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.VOD_AV1_CLOSE_CFg),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.VOD_AV1_CLOSE_CFg)):(i=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.BROWSER_NOT_SUPPORTED),this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.BROWSER_NOT_SUPPORTED)),this.h265Proxy&&this.h265Proxy.h265StatReport&&(this.isTurnTo264?this.h265Proxy.h265StatReport.addTurnTo264Support(this.turnTo264Reason,t):e&&this.h265Proxy.isSupported?this.h265Proxy.h265StatReport.addTurnTo264Support(Qn,t):this.h265Proxy.h265StatReport.addH265SupportNew(t)),n.a.log("VodMgr.useWebCodecs id=".concat(this._id),i);let s=i?N.a.PLAYER_CORE_TYPE.WEBCODECS:N.a.PLAYER_CORE_TYPE.MSE;this.playerCoreType=s,t._dMod=R.b.getDecodeMod(i,this.h265Proxy.isReady,!1),this.h265Proxy.isSupported&&(this.isTurnToWebcodecsSoft=!1);const r={options:t.options,stat:this.stat,statVod:this.statVod,tsdb:this.tsdbUtil,videoElement:this.videoElement,h265Proxy:this.h265Proxy,playerCoreType:s,isSoftSolution:this.isTurnToWebcodecsSoft,isPureAudio:!!t.isPureAudio,isPureVideo:!!t.isPureVideo,dropBeforeFirstIDR:!!t.dropBeforeFirstIDR};switch(this._type=t.type,t.type){case hd.MP4:this.player=new ld(this.eventEmitter,r);break;case hd.FLV:this.player=new od(this.eventEmitter,r);break;case hd.HLS:let e=null;t.isForceHlsTagPlayer||!Gh.isSupported()?(e=ld,this.isUseHlsTag=!0):e=Sn,this.player=new e(this.eventEmitter,r),2===this.av1State&&this._backToAv1.start(this.player);break;case hd.VR:this.player=new jh(this.eventEmitter,r)}X.has(this.onNoPicture,this)||(this.hlsNoPictureStartTs=_.a.now(),X.once(this.onNoPicture,this,1e4)),t.options&&t.options.hasOwnProperty("volume")?this.setVolume(t.options.volume):this.setVolume(this._volume),t.options&&t.options.hasOwnProperty("muted")?this.setMuted(t.options.muted):this.setMuted(this._muteVal),this.player.start(t)}getVStreamInfo(t){f.a.hlsVStreamInfo&&(t.vStreamInfo=JSON.parse(f.a.hlsVStreamInfo));let e=R.b.isOpen(o.a.vodAv1Cfg,this.anchorUid,t.lineType,!1);this.statVod.setComDim("experiment",e?1:2);let i=!1,s=dt.a.isMseSupportedAV01(),r=!1;s&&f.a._renderInfo&&(r=fn.isClose(t.curBitrate,f.a._renderInfo));let a=2===this.av1State;2!==this.av1State&&(this.av1State=0);let n=null,h=null,l=null,c=!1;if(t.vStreamInfo&&t.vStreamInfo.length>0){if(t.sWidth=t.vStreamInfo[0].sWidth||0,t.sHeight=t.vStreamInfo[0].sHeight||0,t.vStreamInfo.map(t=>{"h265"==t.sCodec?(h=t,this.h265StreamInfo=t,c=!0):"av1"==t.sCodec?(n=t,this.av1StreamInfo=t,i=!0):"h264"==t.sCodec&&(this.h264StreamInfo=t,l=t)}),"av1"==f.a._vDecodec?h=null:"h265"==f.a._vDecodec?n=null:"h264"==f.a._vDecodec&&(h=null,n=null),n&&(t.av1Url=n.sM3u8,this._hasHttpPrefix(t.av1Url)||(t.av1Url="https:".concat(t.av1Url)),1==o.a.vodAv1UseFirst)){let e=this.changeOffset(n.sTs1Offset);n.sTs1Url&&(t.tsAv1Info={initUrl:n.sM3u8.replace(".m3u8","/init.mp4"),tsUrl:n.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset})}if(h){t.h265Url=h.sM3u8,this._hasHttpPrefix(t.h265Url)||(t.h265Url="https:".concat(t.h265Url));let e=this.changeOffset(h.sTs1Offset);h.sTs1Url&&t.duration&&(t.tsH265Info={tsUrl:h.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset,totalDuration:t.duration},t.tsH265Info&&!this._hasHttpPrefix(t.tsH265Info.tsUrl)&&(t.tsH265Info.tsUrl="https:".concat(t.tsH265Info.tsUrl)))}n&&i&&!a&&e&&s&&!r&&(this.av1State=1),t._av1State=this.av1State}let u=R.b.getAv1Support(s,e,r,a);this.statVod.setComDim(d.a.VOD_CORE.AV1_SVR,i?n?1:2:3),this.statVod.setComDim(d.a.VOD_CORE.AV1_SPT,u),this.statVod.setComDim(d.a.VOD_CORE.AV1_USE,1===this.av1State?1:2),t._vodStates={av1SvrOpen:i,av1Support:u}}statVStreamExtInfo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;const i=t.extParam||t.mpExtraParam,s=t.sCodec,r=i.value;r&&(r.channel&&o.a.vodEnhanceChannelMap.map(t=>{t[r.channel]&&(e.gameId=t[r.channel],this.stat.setComDim(d.a.DIM_COM.GAMEID,e.gameId),this.statVod.setComDim(d.a.VOD_DIM_COM.GAMEID,e.gameId))}),r.vid&&(e.vid=r.vid),r.pid&&(e.presenterUid=r.pid),this.stat.setComDim(d.a.VOD_EXT_COM.VID,r.vid),this.stat.setComDim(d.a.VOD_EXT_COM.CLIENT,r.client),this.stat.setComDim(d.a.VOD_EXT_COM.PID,r.pid),this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,r.bitrate),this.stat.setComDim(d.a.VOD_EXT_COM.DEFINITION,r.definition),this.stat.setComDim(d.a.VOD_EXT_COM.SCENE,r.scene),this.statVod.setComDim(d.a.VOD_EXT_COM.VID,r.vid),this.statVod.setComDim(d.a.VOD_EXT_COM.CLIENT,r.client),this.statVod.setComDim(d.a.VOD_EXT_COM.PID,r.pid),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,r.bitrate),this.statVod.setComDim(d.a.VOD_EXT_COM.DEFINITION,r.definition),this.statVod.setComDim(d.a.VOD_EXT_COM.SCENE,r.scene),"h265"===s&&(this.h265StreamBitrate=r.bitrate),"h264"===s&&(this.h264StreamBitrate=r.bitrate),"av1"===s&&(this.av1StreamBitrate=r.bitrate))}changeOffset(t){var e=0,i=0,s=t.split("@");if(s.length>1){var r=parseInt(s[0],10),a=parseInt(s[1],10);e=a,i=a+r}return{byteRangeStartOffset:e,byteRangeEndOffset:i}}_onStartPlay(){this.startPlayer(this.h265Info)}stop(){n.a.log("VodMgr stop id=".concat(this._id,"!")),X.remove(this.onNoPicture,this),X.remove(this.onCheckTimer,this),this.visibility&&this.visibility.delVisibilitychange(),this._removeVideoListeners(),this.player&&this.player.destroy(),this.player=null,this.isUseEnhance=!1,this.isUseHlsTag=!1,this.stat&&this.stat.reset(),this.statVod&&this.statVod.reset(),this.h265WasmProxy&&this.h265WasmProxy.stop(),this.h265MseProxy&&this.h265MseProxy.stop()}reset(t){this.started=!1,this.ended=!1,this.playerType="",this._loop=!1,this._volume=1,this._paused=!1,this._playbackRate=1}setTafHandler(t){n.a.log("VodMgr.setTafHandler id=".concat(this._id," success")),th.default.setTafHandler(t)}getDurationTime(){let t=0;return this.player?(t=this.player.getDurationTime(),this._duration=t,t):t}getDurationRealTime(){let t=0;return this.player?(t=this.player.getFixedDurationTime?this.player.getFixedDurationTime():this.player.getDurationTime(),this._duration=t,t):t}getCurrentTime(){let t=0;return this.player?(t=this.player.getCurrentTime(),t):t}getCurrentRealTime(){let t=0;return this.player?(t=this.player.getCurrentRealTime?this.player.getCurrentRealTime()/1e3:this.player.getCurrentTime(),t):t}seekTime(t){if(n.a.log("VodMgr seekTime id=".concat(this._id,", time=").concat(t)),!this.player)return;t=Math.floor(t),this.streamType===hd.StreamType.HLS&&(this.playerType===hd.VR?this.player.updatePlayerStatus(!0):this.player.started=!0);const e=this.getDurationTime();t>e&&(t=e),this.ended=!1,this._backToAv1.isTimeToBack()?this._onBackToAV1("seek",t):this.player.seek(t)}play(){n.a.log("VodMgr play id=".concat(this._id," ended=").concat(this.ended)),X.has(this.onNoPicture,this)||this.isSendNoPicture||(this.hlsNoPictureStartTs=_.a.now(),X.once(this.onNoPicture,this,1e4)),this.videoElement&&(this.streamType===hd.StreamType.HLS&&this.ended&&(Gh.isSupported()?this.restart():this.seekTime(0)),this.ended=!1,this._paused=!1,this.player&&this.player.play())}replay(){n.a.log("VodMgr replay id=".concat(this._id)),this.videoElement&&(this.streamType===hd.StreamType.HLS&&this.ended&&Gh.isSupported()&&(this.videoElement.currentTime=0),this.seekTime(0),clearTimeout(this.replayTimeout),this.replayTimeout=setTimeout(()=>{this.ended=!1,this._paused=!1,this.videoElement.play()},200))}get paused(){return this._paused}get readyState(){return this.videoElement&&this.videoElement.readyState}pause(){n.a.log("VodMgr pause id=".concat(this._id)),this._paused||(this.player&&this.player.isWebCodec?this.player.pause():(this._paused=!0,this.streamType===hd.StreamType.HLS&&(this.playerType===hd.VR?this.player.updatePlayerStatus(!0):this.player.started=!0),this.player&&this.player.pause()))}setLoop(t){this._loop=t}getLoop(){return this._loop}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n.a.log("VodMgr.setVolume id=".concat(this._id," val=").concat(t," player=").concat(!!this.player)),this._volume=t,this.videoElement&&(this.videoElement.volume=t)}getVolume(){return this.videoElement?this.videoElement.volume:this._volume}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n.a.log("VodMgr.setPlaybackRate id=".concat(this._id),t),this._playbackRate=Number(t),this.player&&this.player.setPlaybackRate&&this.player.setPlaybackRate(this._playbackRate),this.stat.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.statVod.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate)}getPlaybackRate(){return this._playbackRate}setCodeRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1000";this._coderate=t,this.stat.setComDim(d.a.DIM_COM.VOD_CODERATE,this._coderate)}getCodeRate(){return this._coderate}getBuffered(){return this.videoElement&&this.videoElement.buffered}onNoPicture(){if(n.a.log("VodMgr.onNoPicture id=".concat(this._id," isSendNoPicture=").concat(this.isSendNoPicture)),this.isSendNoPicture)return;this.isSendNoPicture=!0;const t=this.getCurrentTime(),e=this.player.getCostTimes?this.player.getCostTimes():[];let i=[this.player.hasPicture||this.hadPlayVideo?0:100];i=i.concat(e),this.player.hasPicture||this.hadPlayVideo||!this.player.addNoPictureReason||this.player.addNoPictureReason();const s=_.a.now()-this.hlsNoPictureStartTs;this.player.sendNoPicture&&this.player.sendNoPicture(s);const r=[this.stat.createAct(d.a.ACT.NO_PICTURE,{value:i,str:[h.a.platform,this.busiSource,0==t?0:1]})];let a=0;this.player&&this.player.mse&&(a=this.player.mse.isMediaSourceOpen?1:2);const o=R.b.getBrowserHidden();o&&2==a?n.a.log("VodMgr.onNoPicture id=".concat(this._id," browserHidden=").concat(o,", isMediaSourceOpen=").concat(a)):this.eventEmitter.trigger(m.DATA_METRIC2,r)}getLog(){return n.a.getLog()}getNewLog(){return n.a.getNewLog()}pushMuffedData(t){this.player&&this.playerType===hd.HLS&&(this.player.voiceEliminationData||(this.player.voiceEliminationData=[]),this.player.voiceEliminationData.push(t))}getMuted(){return this.player&&this.player.isWebCodec?this._muteVal:this.videoElement&&this.videoElement.muted}getVideoWidth(){return this.videoElement&&this.videoElement.videoWidth}getVideoHeight(){return this.videoElement&&this.videoElement.videoHeight}getVideoElement(){return this.playerType===hd.VR?this.vrElement:this.videoElement}showControls(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.videoElement&&(this.videoElement.controls=t)}_hasHttpPrefix(t){return/^http(s)?/.test(t)}_createVideoElm(){let t=wh.create(this.videoElement,{});this.playerType===hd.VR&&t.setAttribute("crossOrigin","anonymous"),this.videoElement=t,this.createVideoElmInner=!0,n.a.log("VodMgr._craeteVideoElm id=".concat(this._id," id=").concat(t.id))}_isEnded(){const t=this.getDurationRealTime(),e=this.getCurrentRealTime();return t>0&&t-e<.1}onPlayEnded(){n.a.log("VodMgr.onPlayEnded id=".concat(this._id))}_videoPlayEnded(){n.a.log("VodMgr end id=".concat(this._id)),this.streamType===hd.StreamType.HLS&&(this.playerType===hd.VR?this.player.updatePlayerStatus(!1):this.player.started=!1),this._loop?(this.ended=!1,this.seekTime(0),this.player instanceof kh&&this.player&&this.player.play()):(this.ended=!0,this.eventEmitter.trigger(hd.Event.VIDEO_ENDED,{video:this.videoElement}))}_addVideoListeners(){n.a.log("VodMgr._addVideoListeners id=".concat(this._id)),this.eventsMap.forEach((t,e)=>{this.eventEmitter.on(e,t)})}_removeVideoListeners(){n.a.log("VodMgr._removeVideoListeners id=".concat(this._id)),this.eventsMap&&this.eventsMap.forEach((t,e)=>{this.eventEmitter.off(e,t)})}_onVideoSeek(t){this.ended=!1;const e=this.videoElement.currentTime;this.eventEmitter.trigger(m.VIDEO_SEEK,{video:this.videoElement,currentTime:1*e}),this._isEnded()||this._paused||this.ended||this.play()}_onVideoHlsSeek(t,e){this.ended=!1,this._isEnded()&&this._onVideoTimeupdate()}_onVideoEnded(t){this._videoPlayEnded()}_onM3u8PlayEnded(){this._videoPlayEnded()}_onVideoTimeupdate(t,e){if(this.ended||this.isRetrying)return;!this._duration&&this.getDurationTime();const i=this._duration;let s=this.getCurrentTime();this.eventEmitter.trigger(hd.Event.VIDEO_TIMEUPDATE,{duration:i,currentTime:s})}_onVideoError(t){n.a.log("VodMgr._onVideoError id=".concat(this._id," id=").concat(t.currentTarget.id)),1!==this.av1State&&this.eventEmitter.trigger(hd.Event.VIDEO_ERROR,{error:t})}_onVideoLoadStart(t){this.isRetrying||this.eventEmitter.trigger(hd.Event.VIDEO_LOAD_START,{video:this.videoElement,event:t})}_onVideoStartPlay(t,e){e&&(this.vrElement=e.video),this.isRetrying=!1,this.hadPlayVideo=!0}_onH5PlayerError(t,e){if(setTimeout(()=>{this.eventEmitter.trigger(m.H5_PLAYER_ERROR,e)},10),e&&(e.code===zr||e.code===N.a.H5_ERROR_CODE.PLAY_TIMEOUT||e.code===N.a.H5_ERROR_CODE.VIDEO_ERROR))return;const i=this.getCurrentTime();this.playInfo.seekTime=i+1,this.isRetrying=!0,1===this.av1State&&(this.av1State=2);let s=this._volume;this.errorReplayCnt>=3||(this._start(this.playInfo),this.setVolume(s),this.setPlaybackRate(this._playbackRate),this.errorReplayCnt++)}_onBackToAV1(t,e){if(2===this.av1State){n.a.log("VodMgr._onBackToAV1 id=".concat(this._id,", seekTime=").concat(e)),this.av1State=0,this.isRetrying=!0,this.playInfo.seekTime=e;let t=this._volume;this.start(this.playInfo),this.setVolume(t),this.setPlaybackRate(this._playbackRate)}}_onVideoPause5sRetry(){this.isRetrying=!0}onTurntoH264(t,e){n.a.log("VodMgr.onTurntoH264".concat(this._id,", turn to h264, isVodTurnTo264=").concat(o.a.isVodTurnTo264," LocalProxy.isVodTurnTo264=").concat(f.a.isVodTurnTo264),t,e),1!==o.a.isVodTurnTo264&&1!=f.a.isVodTurnTo264||this.h265Proxy.onTurnToH264(this._type),this.playInfo&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate))}onH265Retry(t,e){n.a.log("VodMgr.onH265Retry id=".concat(this._id,", H265 retry!"),t),this.playInfo&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate))}onTurnToMse(t,e){n.a.log("VodMgr.onTurnToMse id=".concat(this._id,", turn to MSE")),this.isTurnToMse=!0,this.isTurnToWebcodecsSoft=!1,e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onTurnToWebcodecsSoft(t,e){n.a.log("VodMgr.onTurnToWebcodecsSoft id=".concat(this._id),e),f.a._webcodecSoftNums||(f.a._webcodecSoftNums=0,f.a._webcodecSoftDate=Date.now());let i=Number(f.a._webcodecSoftNums)+1;f.a._webcodecSoftNums=i,this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!0,e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onTurntoH265Wasm(t,e){n.a.log("VodMgr.onTurntoH265Wasm id=".concat(this._id,", turn to h265 wasm"),t),1===Number(f.a._forceMseHevc)&&f.a.setItem&&f.a.setItem("_forceMseHevc",0),this.h265MseProxy.onTurntoH265Wasm(this.type),e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onWebcodecsRetry(t,e){e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),n.a.log("VodMgr.onWebcodecsRetry id=".concat(this._id)),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}restart(){n.a.log("VodMgr.restart id=".concat(this._id,", volume=").concat(this._volume,", mute=").concat(this._muteVal)),this.playInfo.seekTime=0,this.start(this.playInfo),this.setVolume(this._volume),this.setMuted(this._muteVal),this.setPlaybackRate(this._playbackRate)}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.player&&this.player.containerResize&&this.player.containerResize(t)}getVideoExtractData(){let t={};return t.codec=this.player.getCodecType().toUpperCase(),t.videoWidth=this.getVideoWidth()||this.playInfo.sWidth,t.videoHeight=this.getVideoHeight()||this.playInfo.sHeight,t.frameRate=this.player.getFps(),t.bitrate=this.playInfo.curBitrate||0,n.a.log("VodMgr.getVideoExtractData id=".concat(this._id),JSON.stringify(t)),t}checkWebCodecSoft(t){if(f.a._webcodecSoftDate){const t=864e5;Date.now()-Number(f.a._webcodecSoftDate)>=t?(delete f.a._webcodecSoftDate,delete f.a._webcodecSoftNums):Number(f.a._webcodecSoftNums)>=3&&(this.isTurnToWebcodecsSoft=!0)}1==o.a.isQQSoft&&94==h.a.version.major&&-1!=navigator.userAgent.toLowerCase().indexOf("qq")&&"7"==D.a.osVersion&&(this.isTurnToWebcodecsSoft=!0),1!=o.a.isWin7WcsSoft||"7"!=D.a.osVersion&&(109!=h.a.version.major||R.b.isMseSupportedHevc()||-1===h.a.name.indexOf("chrome"))||(this.isTurnToWebcodecsSoft=!0),-1!=o.a.wcsSoftBrows.indexOf(h.a.version.major)&&-1!==h.a.name.indexOf("chrome")&&(this.isTurnToWebcodecsSoft=!0),-1!=o.a.wcsSoft264Uids.indexOf(Number(t.uid))&&(this.isTurnToWebcodecsSoft=!0),1==f.a._forceWebcodecsSoft&&(this.isTurnToWebcodecsSoft=!0)}setMuted(t){this._muteVal=!!t,n.a.log("VodMgr.setMuted id=".concat(this._id),t),this.videoElement&&(this.videoElement.muted=t)}setSegmenttion(t){n.a.log("VodMgr.setSegmenttion id=".concat(this._id),t),this.player&&this.player.setSegmenttion(t)}getModelRes(){return this.videoEnhance.getModelRes()}onVideoEhanceError(t,e){this.player.setEnhance(!1),this.videoEnhance&&this.videoEnhance.onVideoEhanceErrorCb&&this.videoEnhance.onVideoEhanceErrorCb(e.type)}onVideoEhanceSuccess(){this.videoEnhance&&this.videoEnhance.onVideoEhanceSuccess&&this.videoEnhance.onVideoEhanceSuccess()}getEnhanceStats(){return this.videoEnhance.getEnhanceStats()}onPlayVideo(t,e){n.a.log("VodMgr.onPlayVideo id=".concat(this._id)),e&&(this.vrElement=e.video),this.isRetrying=!1,this.hadPlayVideo=!0,this.setEnhance(!0);let i=ct().toLowerCase();this.stat.setComDim(d.a.DIM_COM.RENDER_INFO,i),this.statVod.setComDim(d.a.VOD_DIM_COM.RENDER_INFO,i),-1==i.toLocaleLowerCase().indexOf("swiftshader device")&&""!=i||this.player&&this.player.setDisableHardAcc&&this.player.setDisableHardAcc();let s=D.a.os||"",r=D.a.osVersion||"",a="windows"==s.toLocaleLowerCase()&&7==Number(r),o=-1!=i.toLocaleLowerCase().indexOf("intel"),h=-1!=i.toLocaleLowerCase().indexOf("angle (null"),l=""==i.toLocaleLowerCase(),c=navigator.hardwareConcurrency;a&&o&&c<=4&&this.player&&this.player.win7PerfInsufficient&&this.player.win7PerfInsufficient(),h?(f.a.isAngelNull=1,this.player&&this.player.angelNullError&&this.player.angelNullError()):f.a.isAngelNull=0,l?this.player&&this.player.chromeH265RenderEmptyError&&this.player.chromeH265RenderEmptyError():f.a.isChromeH265RenderInfoEmpty=0,this.playerCoreType==N.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.h265Proxy.isH265MseCodec&&-1!=i.indexOf("amd")&&-1!=i.indexOf("radeon")&&(n.a.log("VodMgr.onPlayVideo id=".concat(this._id," amd.hevError")),this.player.onMseHevcError())}onCheckTimer(t,e){this.videoEnhance&&this.videoEnhance.onCheckTimer&&this.videoEnhance.onCheckTimer(t,e)}setEnhance(t){this._type===hd.HLS&&(n.a.log("VodMgr.setEnhance id=".concat(this._id),t),this.isUseEnhance=!!t,this.videoEnhance.getSupport(this.playInfo,ct()),this.isUseEnhance&&(this.videoEnhance.isSupport||this.eventEmitter.trigger(m.ON_VIDEO_ENHANCE_UNSUPPORT),this.isUseEnhance=this.videoEnhance.isSupport),this.player&&this.player.setEnhance&&this.player.setEnhance(this.isUseEnhance))}}hd.FLV=Uh.FLV,hd.HLS=Uh.HLS,hd.MP4=Uh.MP4,hd.VR=Uh.VR,hd.StreamType=Uh,hd.Event=Rn,hd.StopType={INNER:1,OUTER:2};var dd=hd,ld=class extends kh{constructor(t,e){super(t,e),this.stat=e.statVod,this._checkVideoFreezeInterval=new bh(50),this.lastPauseTs=0,this.lastCheckPlayTs=0,this.pauseBuffer=[],this.pauseDownBuffer=[],this.pauseCurrentTime=[],this.pauseTimes=0,this.pauseDuration=0,this.pauseDurationNow=0,this.pauseDurationReal=0,this.videoIsBadQuality=!1,this.downTotalBufTs=0,this.vodBadReason=0}destroy(){super.destroy(),this.stat=null,this._checkVideoFreezeInterval=null,this.pauseBuffer=null,this.pauseDownBuffer=null,this.pauseCurrentTime=null}stop(){this._checkVideoFreezeInterval.reset(),super.stop()}start(t){super.start(t);let e=t.vid||R.b.getQueryString("vid",t.url);this.url=t.url+(-1!==t.url.indexOf("?")?"&":"?")+"timeStamp=".concat(_.a.getDateTimeStr().replace(" ","_")),this.stat.setComDim(d.a.DIM_COM.STREAM_URL,this.url),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,e||""),this.stat.setComDim(d.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),t.type===dd.MP4?(this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,6),this.stat.setComDim(d.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),ut.setVodCdnDomain(this.stat,this.url)):this.stat.setComDim(d.a.DIM_COM.STREAM_TYPE,3),this._start(t)}_playSuc(){this.videoChecker.start(),this._startPauseStat(),this._triggerPlayTime(_.a.now(),!0)}onCheckFastTimer(t){this.ended||(this._checkEnded(t),this._checkBuffer(t),this._checkVideoFreeze(t)),super.onCheckFastTimer(t)}_checkVideoFreeze(t){if(!this.paused&&this._checkVideoFreezeInterval.isDone(t)&&this._isPlaying){const e=this.videoElement.currentTime;if(this.lastCheckPlayTs>0){let i=this.lastPauseTs>0?t-this.lastPauseTs:0;this.lastCheckPlayTs===e?0===this.lastPauseTs?(n.a.log("VideoTagVodPlayer(".concat(this.id,")._checkVideoFreeze startPaused, buffer=").concat(this.getBufferLen(),",totalBuffer=").concat(this.downTotalBufTs,",pauseDuration=").concat(i,",curtime=").concat(e,",seeking=").concat(this.seeking)),this.lastPauseTs=this.lastCheckTs):i>200&&(this._addPauseDuration(i),this.lastPauseTs=t,this.videoStatus!==p.VIDEO_CACHING&&(n.a.log("VideoTagVodPlayer(".concat(this.id,")._checkVideoFreeze setPaused, buffer=").concat(this.getBufferLen(),",totalBuffer=").concat(this.downTotalBufTs,",pauseDuration=").concat(i,",curtime=").concat(e,",seeking=").concat(this.seeking)),this.videoStatus=p.VIDEO_CACHING,this.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal}))):((i>200||this.pauseDurationNow>0)&&(this.pauseTimes++,this._addPauseDuration(i),n.a.log("VideoTagVodPlayer(".concat(this.id,")._checkVideoFreeze setResume, buffer=").concat(this.getBufferLen(),",totalBuffer=").concat(this.downTotalBufTs,",pauseDuration=").concat(this.pauseDurationNow,",curtime=").concat(e,",seeking=").concat(this.seeking))),this.lastPauseTs>0&&this.pauseDurationNow>0&&(this.videoStatus=p.VIDEO_PLAYING,this.trigger(m.VIDEO_PLAYING,{video:this.videoElement})),this.lastPauseTs=0,this.pauseDurationNow=0)}this.lastCheckTs=t,this.lastCheckPlayTs=e,this.pauseDurationNow>=5e3&&this._pause5sRestart()}}_addPauseDuration(t){if(this.pauseDurationReal+=t,!this.seeking){this.pauseDuration+=t,this.pauseDurationNow+=t,this.videoIsBadQuality=!0;const e=this.getBufferLen();this.pauseBuffer.length<20&&this.pauseBuffer.push(e),this.pauseDownBuffer.length<20&&this.pauseDownBuffer.push(~~this.downTotalBufTs),this.pauseCurrentTime.length<20&&this.pauseCurrentTime.push(~~this.videoElement.currentTime),this.vodBadReason=e<2e3?kr.CODE:Wr.CODE}}_pause5sRestart(){if(n.a.log("VideoTagVodPlayer".concat(this.id,").pause5sRestart!")),!this.videoElement)return;const t=this.videoElement.currentTime;this.info&&(this.start(this.info),this.seek(t))}_calcPausedByHeart(){this.pauseDurationNow>0&&this.pauseTimes++}_onheartbeat(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._calcPausedByHeart(),this.stat.setCore(d.a.VOD_CORE.VOD_BAD_QUALITY,this.videoIsBadQuality?100:0),this.stat.setCore(d.a.VOD_CORE.VOD_BLOCK_COUNT,this.pauseTimes),this.stat.setCore(d.a.VOD_CORE.VOD_BLOCK_DURATION,this.pauseDuration),this.stat.setCore(d.a.VOD_CORE.VOD_BAD_REASON,this.vodBadReason),this.stat.setCore(d.a.CORE.STREAM_BUFFERED,this.downTotalBufTs);let e=[];this.stat.fill(e,t),this.tsdb.sendMetrics(e),this.videoIsBadQuality=!1,this.pauseTimes=0,this.pauseDuration=0,this.pauseDurationNow=0,this.pauseDurationReal=0,this.lastCheckPlayTs=0,this.lastPauseTs=0,this.pauseBuffer.length=0,this.pauseDownBuffer.length=0,this.pauseCurrentTime.length=0,this.vodBadReason=0}_sendVideoLoadTime(t,e){this.stat.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,_.a.now()-this.stat.create_time),this.tsdb.sendVodMP4Time({loadTime:t})}sendNoPicture(){this.hasPicture||(this.stat.setActDim(d.a.VOD_DIM_COM.CREATE_TIME,_.a.now()-this.stat.create_time),this.tsdb.sendVodMP4Time({loadTime:99999,errorMessage:wh.getErrorMessage(this.videoElement)}))}_onVodError(){this.info.type===dd.MP4&&T.setMP4Status(-1),this.sendNoPicture()}addNoPictureReason(){if(this.info.type===dd.MP4){const t=T.getMP4NoPictureReason();this.stat.setActDim(d.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}}onplaying(t){this.lastPauseTs=0,super.onplaying(t)}onended(t){this._end("onended")}_checkEnded(t){this.videoElement.duration>0&&this.videoElement.currentTime>=this.videoElement.duration&&this._end("checkEnded")}onseeked(t){this.info.type===dd.MP4&&this.trigger(m.VIDEO_TAG_SEEKED,t)}};let cd=0;Nn.a&&Nn.a.getInstance&&Nn.a.getInstance().setLogCallback(n.a.loggerCallback);let ud="";class pd extends c{static setLogFlag(t){n.a.setLogFlag(t)}static setAudioCtx(t){o.a.audioCtx=t}static isSupported(){return dt.a.isMseSupportedH264()}static isMseSupportedHevc(){return dt.a.isMseSupportedHevc()}static get Events(){return m}static isSupportedHevc(t){return!0}static isWebCodecsSupported(){return R.b.isWebCodecsSupported()}constructor(t){super(t),this.config=o.a,this.config.init(t),o.a.closeSub=0,f.a[g.AUTO_VIEW_LOG]=0,_.a.now(),t&&1==t.closeWorker||(Vs.initWorker(),X.initWorker());let e=Number(f.a.sdkLogLevel);isNaN(e)||this.setLogLevel(e),Object(tt.setLogger)(n.a),v.a.initUUId(),this.uuid=v.a.uuid;let i=h.a.platform+" "+h.a.name+" "+h.a.version.string;n.a.warn("SDK ".concat(2508270844," | ").concat("2025-08-27 08:44:06"," | ").concat("RELEASE"," | ").concat(i," | ").concat(this.uuid));let s=Ln();this.on=s.on.bind(s),this.off=s.off.bind(s),this.trigger=s.trigger.bind(s),this.stat=new Pn,this.statVod=new En,this.metrics=new L,this.abConfig=new _h,this.tsdbUtil=new A({stat:this.stat,statVod:this.statVod,eventEmiter:this}),this.statSwitch=new Un(this.tsdbUtil,this.stat,this),this.sampleController=new Hn,this.h265WasmProxy=new $n(this.stat,this.tsdbUtil,this.statVod),this.h265MseProxy=new Zn(this.stat,this.tsdbUtil,this.statVod),this.autoMonitor=new lh,this.recSysStat=new ch,this.visibility=new oh(this),this.autoForce=new mh(this,this.abConfig),this.bitrateChange=new fh(this.abConfig),this.streamChange=new gh(this.abConfig),this._onStartPlayBind=this._onStartPlay.bind(this),this._onTurntoH264Bind=this.onTurntoH264.bind(this),this.statSwitch.init(this.autoMonitor,this.recSysStat,this.autoForce),this.autoMonitor.init(this.stat),this.volume=1,this.player=null,this.lastFlvInfo=null,this.lastP2PInfo=null,this.lastHlsInfo=null,this.lastPlayBackInfo=null,this.noPictureP2PSended=!1,this.noPictureFlvSended=!1,this.noPictureWebrtcSended=!1,this.flacMgr=null,this.flacLibURL="flaclib.js",this.videoPlaybackrateAccess=!0,this.webrtcPlayerMgr=null,this.videoPixelateMgr=new rh(this,this.stat),this.muffleAudio=new ah(this,this.stat),this.videoEnhance=new Th(this,this.stat,this.statVod),this.enableLowLatency=!1,this.webrtcErrored=!1,this.isForceFlv=!1,this.isGetPcdnMode=!1,window.HYApplication&&(window.HYApplication.tafHandler&&r.setTafHandler(window.HYApplication.tafHandler),window.HYApplication.config&&this.config.init(window.HYApplication.config)),this.on(m.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.on(m.TURN_TO_H264,this.onTurntoH264.bind(this)),this.on(m.H265_VIDEO_RETRY,this.onH265Retry.bind(this)),this.on(m.H5_PLAYER_ERROR_IN,this.onH5PlayerError.bind(this)),this.on(m.FLV_URL_UNAVAILABLE_IN,this.onFlvUrlUnavailable.bind(this)),this.on(m.NO_DATA_RECEIVED_IN,this.onNoDataReceived.bind(this)),this.on(m.AUTO_BITRATE_CHANGED,this.onAutoBitrateChanged.bind(this)),this.on(m.TURN_TO_MSE,this.onTurnToMse.bind(this)),this.on(m.TURN_TO_WEBCODECS_SOFT,this.onTurnToWebcodecsSoft.bind(this)),this.on(m.WEBCODECS_RETRY,this.onWebcodecsRetry.bind(this)),this.on(m.TURN_TO_H265_WASM,this.onTurntoH265Wasm.bind(this)),this.on(m.RESET_PLAYER,this.onResetPlayer.bind(this)),this.on(m.ON_VIDEO_ENHANCE_ERROR,this.onVideoEhanceError.bind(this)),this.on(m.ON_VIDEO_ENHANCE_SUCCESS,this.onVideoEhanceSuccess.bind(this)),this.on(m.BROWSER_AUTOPLAY_FAIL_IN,this.onBrowserAutoplayFail.bind(this)),this._mediaLink=new tt.MediaLink,this.imgplusABTestNoticeBind=this.imgplusABTestNotice.bind(this),r.addListener("1400200",this.imgplusABTestNoticeBind),this.startTs=0,this.costUs=0,this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.getAIRequestTime=0,this.getVideoP2PBuffertEmptyTime=0,this.getVideoFlvBuffertEmptyTime=0,this.isAiSupportP2P=!0,this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,this.aiComp=0,this.sdkTurnToP2P=!0,this.isPlayerStarted=!1,this.pureAudioMgr=null,this.isBusiStop=!1,this.sdkInRoomTs=Date.now(),this.isInitRoomTicker=!1,this.noLoadAv1Count=0,this.lastTypeLineBitRateKey="",this.isTurnTo264=!1,this.turnTo264Reason=-1e4,this.startInfo=null,this.mainLibUrl="MainLib.js",this.chatStreamMgr=null,this.voiceMgr=null,this.autoStartBitrate=0,this.inRoomTimeNow=_.a.now(),this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!1,this.autoUserTags="",this.h264StreamBitrate=0,this.h265StreamBitrate=0,this.av1StreamBitrate=0,this.av1State=0,this._onWorkerTimeoutBind=this._onWorkerTimeout.bind(this),this._onWorkerErrorBind=this._onWorkerError.bind(this),this.hasPlayed=!1,this.hlsNoPictureStartTs=0,this.webcodecsErrCount=0,this.turnMseType=0,this.isCloseImgPlusAB=!1,this._onGetMediaCofigBind=this.onGetMediaCofig.bind(this),this.isUseEnhance=!1,this.payCount403=0,this.isPaidRoom=!1,this.lastPresenterUid=0,this.refreshRate=0,this.h264StreamInfo=null,this.h265StreamInfo=null,this.av1StreamInfo=null,this._playbackRate=1,this.netFlvErrorCnt=0,this.seiDataChannl=new Oh,this.roomRecordStat=new Wn(this),this.muteAudioBiPlayer=new vn,this.printLog=n.a.log,this._getPcdnScheduleByTafBind=this._getPcdnScheduleByTaf.bind(this),this._getMediaConfigByTafBind=this._getMediaConfigByTaf.bind(this),this.noPictureTimeoutFlv=new Rh({onTime:this.onNoPictureFlv.bind(this)}),this.noPictureTimeoutP2p=new Rh({onTime:this.onNoPictureP2P.bind(this)}),this.noPictureTimeoutHls=new Rh({onTime:this.onNoPictureHls.bind(this)}),this.noPictureTimeoutWebrtc=new Rh({onTime:this.onNoPictureWebrtc.bind(this)}),this.noPictureTimeoutPlayback=new Rh({onTime:this.onNoPicturePlayBack.bind(this)})}destroy(){this.removeGetPcdnEvents(),this.removeTafEvents(),this.removeNoPictureEvents(),r.removeListener("1400200",this.imgplusABTestNoticeBind),this.tsdbUtil&&this.tsdbUtil.destroy(),this.tsdbUtil=null,this.stat&&this.stat.destroy(),this.stat=null,this.statVod&&this.statVod.destroy(),this.statVod=null,this.abConfig&&this.abConfig.destroy(),this.abConfig=null,this.statSwitch&&this.statSwitch.destroy(),this.statSwitch=null,this.sampleController&&this.sampleController.destroy(),this.sampleController=null,this.h265WasmProxy&&this.h265WasmProxy.destroy(),this.h265WasmProxy=null,this.h265MseProxy&&this.h265MseProxy.destroy(),this.h265MseProxy=null,this.autoMonitor&&this.autoMonitor.destroy(),this.autoMonitor=null,this.recSysStat&&this.recSysStat.destroy(),this.recSysStat=null,this.visibility&&this.visibility.destroy(),this.visibility=null,this.autoForce&&this.autoForce.destroy(),this.autoForce=null,this.bitrateChange&&this.bitrateChange.destroy(),this.bitrateChange=null,this.streamChange&&this.streamChange.destroy(),this.streamChange=null,this.voiceMgr&&this.voiceMgr.destroy(),this.voiceMgr=null,this.seiDataChannl&&this.seiDataChannl.destroy(),this.seiDataChannl=null,this.metrics&&this.metrics.destroy(),this.metrics=null,this._mediaLink&&this._mediaLink.destroy(),this._mediaLink=null,this.videoPixelateMgr&&this.videoPixelateMgr.destroy(),this.videoPixelateMgr=null,this.muffleAudio&&this.muffleAudio.destroy(),this.muffleAudio=null,this.videoEnhance&&this.videoEnhance.destroy(),this.videoEnhance=null,this.roomRecordStat&&this.roomRecordStat.destroy(),this.roomRecordStat=null,this.muteAudioBiPlayer&&this.muteAudioBiPlayer.destroy(),this.muteAudioBiPlayer=null,this.player&&this.player.destroy&&this.player.destroy(),this.player=null,this.lastFlvInfo=null,this.lastP2PInfo=null,this.lastHlsInfo=null,this.lastPlayBackInfo=null,this.startInfo=null,this.pcdnInfo=null,this.h265Info=null,this.h265Proxy=null,this.config=null,this.on=null,this.off=null,this.trigger=null,super.destroy()}loginMedia(t,e,i){this._mediaLink.loginMedia(t,e,i,v.a.appid)}quitMedia(){this._mediaLink.quitMedia()}onPlayVideo(t,e){this.player&&(this.player.setVolume(this.volume),this.player.isMutilVideo&&this.player.isMutilVideo()?(this.videoPixelateMgr.setIsMultiVideo(!0,this.player.getVideoScale()),this.videoPixelateMgr.setMultiVideoPixelate()):(this.videoPixelateMgr.setIsMultiVideo(!1),this.videoPixelateMgr.setVideoPixelate())),this.hasPlayed=!0,this.setEnhance(!0),this.netFlvErrorCnt=0,this._loadMps()}get isSupportP2P(){return $.isSupportP2P()}get isWebrtcSupport(){return $.isWebrtcSupport()}checkCooling(){if(v.a.p2pCooling=!1,this.stat.delDim(d.a.DIM_COM.P2P_COOL_FLAG),f.a.hasOwnProperty("p2p_cooling_time")){let t=new Date,e=new Date(Number(f.a.p2p_cooling_time));v.a.p2pCooling=!(t.getFullYear()!=e.getFullYear()||t.getMonth()!=e.getMonth()||t.getDate()!=e.getDate()),v.a.p2pCooling&&this.stat.setComDim(d.a.DIM_COM.P2P_COOL_FLAG,1)}}noticeMetricSize(t){this.stat.addCore(d.a.CORE.STAT_BW,t)}setIDs(){}setExtendConfig(t){if(1==f.a._forbidConfig)return;let e={};t.p2pConfig&&(Object.assign(e,t.p2pConfig),delete t.p2pConfig),t.sdk&&(t.sdk.p2pConfig&&(Object.assign(e,t.sdk.p2pConfig),delete t.sdk.p2pConfig),Object.assign(e,t.sdk),delete t.sdk),Object.assign(e,t),this.config.init(e)}setConfig(t,e){this.config[t]!=e&&(this.config[t]=e,n.a.log("HYPlayer.setConfig ".concat(t,"=").concat(e)))}addDataChannelPortListener(t){this.seiDataChannl.addDataChannelPortListener(Number(t))}removeDataChannelPortListener(t){this.seiDataChannl.removeDataChannelPortListener(Number(t))}getConfig(t){return this.config[t]}getVolume(){return this.volume}setVolume(t){let e=Math.max(0,Number(t));e=Math.min(1,e),this.volume=e,this.flacMgr&&this.flacMgr.isPlaying()?(e=0,this.flacMgr.setVolume(this.volume),this.setVideoPlaybackrateAccess(!1)):this.setVideoPlaybackrateAccess(!0),this.player&&this.player.setVolume(e),this.voiceMgr&&this.voiceMgr.huyaMgr&&this.voiceMgr.huyaMgr.setVolume&&this.voiceMgr.huyaMgr.setVolume(e)}setLogLevel(t){n.a.setLevel(t)}getLog(){const t=n.a.getLog();if(window.mpsApi&&window.mpsApi.getLog){let e=window.mpsApi.getLog();return t.concat(e)}return t}getMetrics(){return this.metrics.getResult()}getBufferLen(){return this.player&&this.player.getBufferLen&&this.player.getBufferLen()||0}getCurrentTime(){return this.player&&this.player.getCurrentTime?this.player.getCurrentTime():0}getCurrentDts(){return this.player&&this.player.getCurrentDts?this.player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this.player&&this.player.getCurrentSeiOffsetDts?this.player.getCurrentSeiOffsetDts():0}getCurrentSeiDts(){return this.getCurrentDts()-this.getCurrentSeiOffsetDts()}getVideoInfo(){let t=0,e=NaN,i=this.player;if(i&&i.mse){var s=i.mse.video;t=s.currentTime,e=s.duration}return{currentTime:t,duration:e}}sendMetrics(t){this.stat.checkFilter(t),t.length>0&&this.trigger(m.DATA_METRIC2,t)}start(t){if(t.businessType&&"HUYA"==t.businessType&&(t.type!==pd.STREAM&&t.liveType==Fn.a.LIVE&&t.pullStreamFrom!==zs&&(this.payCount403=0),n.a.log("HYPlayer.start business")),delete t.businessType,delete t.usePcdn,this.getAbTestConfig(),t.appid&&(v.a.appid=t.appid),t.liveType!==Fn.a.LIVE&&t.liveType!==Fn.a.REPLAY||Lh.setEventEmiter(this),this.loadlMainLib(t.h5Root),t.type===pd.STREAM&&(o.a.isCloseP2P(t.uid)||o.a.isCloseAllFuncs(t.uid)||o.a.isClosePidSignalP2P(t.presenterUid,t.lineType)))n.a.log("HYPlayer.start config close signal p2p!");else{if(this.isFakeHdr(t)&&this.mappingFakeHdrBitrate(t),t.iBitRate=this.bitrateChange.getBitrate(t.presenterUid,t.lineType,t.iBitRate),!t.isAuto||0!==this.autoStartBitrate&&t.pullStreamFrom!=js||(this.autoStartBitrate=t.curBitrate),this.videoEnhance.setInfo(t),t._startBitrate=this.autoStartBitrate,t._sessionId=this.sdkInRoomTs,t.type!==pd.STREAM){this.roomRecordStat.setBusiPlay(),et.start(t.presenterUid,t.uid);let e=R.b.isOpen(o.a.p2pSubSdkCfg,t.presenterUid,t.lineType,!1);o.a.p2pSubSdkV2=e?1:2,n.a.log("HYPlayer.random p2pSubSdkV2=".concat(o.a.p2pSubSdkV2)),o.a.setUseAV1(t),o.a.setUseAuto(t.hasAutoBitrate||t.isAuto),o.a.initByBitrate(t.curBitrate),o.a.initRepaireSameDtsCfg(t.presenterUid),0!=this.lastPresenterUid&&t.presenterUid!=this.lastPresenterUid&&(this.muffleAudio&&this.muffleAudio.resetData&&this.muffleAudio.resetData(),this.videoPixelateMgr&&this.videoPixelateMgr.resetData&&this.videoPixelateMgr.resetData()),this.lastPresenterUid=t.presenterUid}if(t.type===pd.STREAM||this.isInitRoomTicker||(X.add(this.onCheckTimer,this,1e3),this.isInitRoomTicker=!0),t=Object.assign({uuid:this.uuid,type:0,lineType:-1,curBitrate:0,originalBitrate:0},t),this.stop("sdk"),this.isBusiStop=!1,t.liveType==Fn.a.LIVE&&(this.getLocalImgplusTestNotice(t),t.sStreamName=this.streamChange.getStreamName(t.presenterUid,t.sStreamName,this.isCloseImgPlusAB),this.isCloseImgPlusAB&&this.stat.setComDim(d.a.DIM_COM.CLOSE_EXTSTREAM,1)),t.hasOwnProperty("gzip")&&1!==t.gzip&&(o.a.statLv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.stat.setComDim("trans_commitid",1)),this.stat.filter.initLv(t.presenterUid,t.lineType),this.checkSignalOpenExp(t),o.a.setEnableIaas(t.presentUid,t,this.stat),t.type!==pd.STREAM||2!=o.a.signalOpen){if(t.liveType===Fn.a.LIVE&&(this.resetWebcodecs(t),o.a.setJumpCfg(t)),t.isAuto&&(t.isAuto=!o.a.isAutoClose(t.lineType,t.presenterUid),o.a.isCloseAllFuncs(t.uid)&&(t.isAuto=!1)),1==o.a.payRoomCfg[0]&&(this.isPaidRoom=!0,this.stat.setComDim(d.a.DIM_COM.IS_PAID_ROOM,1)),this.visibility.setStat(this.stat),t.liveType===Fn.a.LIVE&&this.autoMonitor.reportDimPullStreamReason(t.pullStreamFrom),t.type!==pd.STREAM&&(o.a.useFastTime=R.b.isOpen(o.a.fastTimeCfg,t.presenterUid,t.lineType,!1),o.a.rtPeerSelector=R.b.isOpen(o.a.rtPeerSelectorCfg,t.presenterUid,t.lineType,!1),o.a.audioDtsOpen=R.b.isOpen(o.a.audioDtsCfg,t.presenterUid,t.lineType,!1),o.a.dtsJumpOpen=R.b.isOpen(o.a.dtsJumpCfg,t.presenterUid,t.lineType,!1),o.a.pcdnPubIceOpen=R.b.isOpen(o.a.pcdnPubIceCfg,t.presenterUid,t.lineType,!1),o.a.initOpen(t.presenterUid,t.lineType,"statIgnoreOpenCfg","statIgnoreOpen"),o.a.initOpen(t.presenterUid,t.lineType,"mpsGroupOpenCfg","mpsGroupOpen"),this.stat.setComDim("backup_field3",0===o.a.mpsGroupOpen?1:2),this.stat.setComDim(d.a.DIM_COM.STAT_BW_FLAG,0===o.a.statIgnoreOpen?1:2)),this.stat.startRecord(),this.stat.setComDim(d.a.DIM_COM.IS_MUTE,0),this.stat.setComDim(d.a.DIM_COM.AUTO_OPEN,t.hasAutoBitrate?1:0),this.stat.setComDim(d.a.DIM_COM.START_CODERATEBPS,1e3*this.autoStartBitrate),this.stat.setComDim(d.a.DIM_COM.DEFAULT_BITRATEBPS,t.defaultBitrate>-1?1e3*t.defaultBitrate:Math.pow(2,32)-1),this.stat.setComDim(d.a.DIM_COM.MEMORY_BITRATEBPS,t.memoryBitrate>-1?1e3*t.memoryBitrate:Math.pow(2,32)-1),this.stat.setComDim(d.a.DIM_COM.RECOMMEND_BITRATEBPS,t.recommendBitRate>-1?1e3*t.recommendBitRate:Math.pow(2,32)-1),this.stat.setComDim(d.a.DIM_COM.AUTO_VERSION,1),this.stat.setComDim(d.a.DIM_COM.PLAYER_TYPE,t.type),this.stat.setComDim(d.a.DIM_COM.LIVE_TYPE,t.liveType||Fn.a.NONE),this.stat.setComDim(d.a.DIM_COM.VR_ENABLE,t.type===pd.VR?1:0),ut.recordComDim(this.stat,t),this.stat.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.stat.setComDim(d.a.DIM_COM.GAMEID,t.gameId||0),t.hasOwnProperty("isLive")&&!t.isLive&&(this.statVod.setComDim(d.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.statVod.setComDim(d.a.VOD_DIM_COM.GAMEID,t.gameId||0)),this.stat.setComDim(d.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),this.stat.setComDim(d.a.DIM_COM.AUTO_BITRATE,t.isAuto?1:0),t.hasOwnProperty("isLive")&&!t.isLive){ut.recordComDim(this.statVod,t),this.statVod.setComDim(d.a.DIM_COM.PLAYER_TYPE,t.type),this.statVod.setComDim(d.a.DIM_COM.LIVE_TYPE,t.liveType||Fn.a.NONE),this.statVod.setComDim(d.a.DIM_COM.VR_ENABLE,t.type===pd.VR?1:0),this.statVod.setComDim(d.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),this.statVod.setComDim(d.a.DIM_COM.PLACE,1);let e=t.busiSource;"vodadv"===e&&(e+="_live"),this.statVod.setComDim(d.a.VOD_DIM_COM.VOD_PLACE,e||"huya"),this.statVod.setComDim(d.a.DIM_COM.PLACE,Mh.getPlace(e))}this.setAv1Ab(t),v.a.sGuid=t.sGuid||v.a.sGuid,v.a.uid=t.uid||v.a.uid,v.a.roomId=t.uid||v.a.roomId,v.a.uid>0&&(v.a.convertUid=R.b.rotUid(v.a.uid,t.presenterUid)),Ft.wsTimeSync(),n.a.log("HYPlayer.start type=".concat(t.type," convertUid=").concat(v.a.convertUid," sessionId=").concat(this.sdkInRoomTs," ").concat(t&&JSON.stringify(t)),t),this.isAiSupportP2P=!0,t.type===pd.P2PFLV?t.iIsP2PSupport?(this.lastP2PInfo=t,t.type=pd.P2P):t.type=pd.FLV:t.type===pd.VR&&t.iIsP2PSupport&&!this.isForceFlv&&(t.vr.playerType=1),t.type===pd.FLV&&(this.lastFlvInfo=t),this._type=t.type,t.type===pd.FLV&&(this.lastFlvInfo=t),t.type===pd.FLV||t.type===pd.P2P?(this.getAutoBitrateList(t),o.a.setClosePause500(t.presenterUid),this.noPictureTimeoutFlv.addTimeout(1e4),Vs.once(this.onNoPictureNew,this,1e4)):t.type===pd.HLS||t.type===pd.MP4?(t.hasOwnProperty("isLive")&&!t.isLive&&(this.noPictureHlsSended||(this.hlsNoPictureStartTs=_.a.now())),t.type===pd.HLS&&t.isLive&&Vs.once(this.onNoPictureNew,this,1e4),this.noPictureTimeoutHls.addTimeout(1e4)):this.webrtcErrored&&t.type==pd.HUYAWEBRTC&&(n.a.log("HYPlayer.start type=".concat(t.type)+"  change to flv for error"),t.type=pd.FLV,this._type=pd.FLV),t.sStreamName&&this.muffleAudio.setStreamName(t.sStreamName),this.startInfo=t,this.startByCodec(t),this.videoPixelateMgr.setVideoStart(),this.muteAudioBiPlayer.init(t.h5Root)}else n.a.log("HYPlayer.start signal fail signalOpen=2")}}checkSignalOpenExp(t){R.b.isOpen(o.a.signalOpenExp,t.presenterUid,t.lineType,!1)&&-1==o.a.signalOpen&&(o.a.signalOpen=Math.random()<.5?1:2,n.a.log("HYPlayer.checkSignalOpenExp=".concat(o.a.signalOpen)))}startByCodec(t){this.startTs=_.a.now(),n.a.log("HYPlayer.startNow",Date.now(),this.startTs),this.h265Info=t,t.liveType!=Fn.a.LIVE&&this.getVStreamInfo(t),this.h265WasmProxy.initSupport(t);let e=this.getMseHevcSupport(t);if(1==o.a.hardHevcConfig[0]&&e&&o.a.useNextWcsTime&&f.a.hasOwnProperty("nextWcsTime")){let i=Number(f.a.nextWcsTime)||0,s=Date.now();-1===o.a.noNextWcsTimeUids.indexOf(Number(t.uid))&&i>s&&-1!==h.a.name.indexOf("edg")&&(e=!1)}this.h265Proxy=e?this.h265MseProxy:this.h265WasmProxy,t.liveType==Fn.a.LIVE&&(this.h265Proxy.isLive=!0),this.av1StreamInfo&&1==t._av1State?(t.iBitRate=this.av1StreamInfo.iBitRate,this.statVStreamExtInfo(this.av1StreamInfo,t)):this.h265StreamInfo&&(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec)?(t.iBitRate=this.h265StreamInfo.iBitRate,this.statVStreamExtInfo(this.h265StreamInfo,t)):this.h264StreamInfo&&this.statVStreamExtInfo(this.h264StreamInfo,t),t._sMod=R.b.getSupportMod(this.h265WasmProxy.isSupported,this.h265Proxy.isServerSupported,!!t._vodStates&&t._vodStates.av1SvrOpen,!!t._vodStates&&t._vodStates.av1Support),e||1==t._av1State&&this.av1StreamInfo?(n.a.log("HYPlayer.startByCodec Play MSE H265"),this.stat.setComDim(d.a.DIM_COM.HARDDECODE,1),this.startPlayer(this.h265Info)):this.h265Proxy.isSupported?(this.stat.setComDim(d.a.DIM_COM.HARDDECODE,2),t.hasOwnProperty("isLive")&&!t.isLive&&this.h265StreamBitrate&&(this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate)),this.h265Proxy.loadDecoder(t.h5Root,{ready:this._onStartPlayBind,error:this._onWorkerErrorBind,timeout:this._onWorkerTimeoutBind})):(t.hasOwnProperty("isLive")&&!t.isLive&&this.h264StreamBitrate&&(this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate)),this.startPlayer(t))}getMseHevcSupport(t){return this.h265MseProxy.initSupport(t),1==Number(f.a._forceMseHevc)?(n.a.warn("HYPlayer.getMseHevcSupport force mse h265"),!0):!!this.h265MseProxy.isSupported}_onStartPlay(){this.startPlayer(this.h265Info)}_onWorkerTimeout(){this.startPlayer(this.h265Info,!0)}_onWorkerError(){this.onTurntoH264(m.TURN_TO_H264,{reason:Yn.CREATE_WORKER_ERROR})}startPlayer(t,e){let i=this._type+t.lineType+t.iBitRate;i!==this.lastTypeLineBitRateKey&&(this.noLoadAv1Count=0),this.getAiSupportP2P(t),o.a.setAiP2PToFlv(0),this._type!==pd.P2P||this.isAiSupportP2P?t.type===pd.VR&&t.vr.playerType&&!this.isAiSupportP2P&&(t.vr.playerType=0):(t.type=pd.FLV,this._type=pd.FLV),this._type!==pd.P2P&&this._type!==pd.FLV||(this.setAiP2PFlvComp(t),t.isStartShield&&o.a.setAiP2PToFlv(0)),this.roomRecordStat.anchoruid=t.presenterUid;let s=Date.now(),r=R.b.checkWebCodec(t,this.stat,this.h265Proxy.isSupported);if(this.checkWebCodecSoft(t),r&&this.h265Proxy.isSupported&&o.a.useNextWcsTime&&f.a.hasOwnProperty("nextWcsTime")){let e=Number(f.a.nextWcsTime)||0;-1===o.a.noNextWcsTimeUids.indexOf(Number(t.uid))&&e>s&&(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.DECODE_ERROR_COOL),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.DECODE_ERROR_COOL))}if(this.isTurnToMse?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,this.turnMseType),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,this.turnMseType)):t.isPureAudio?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_PUREAUDIO),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_PUREAUDIO)):1==f.a.isAngelNull?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.ANGLE_NULL),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.ANGLE_NULL)):R.b.isWebcodecsBrowserSupported()?1==f.a.isChromeH265RenderInfoEmpty?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.CHROME_H265_RENDER_INFO_EMPTY),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.CHROME_H265_RENDER_INFO_EMPTY)):this.h265Proxy.isSupported&&1==f.a.isCloseWebcodecsH265||1==f.a.isCloseWebcodecsH264||1==t._av1State&&1==f.a.isCloseWebcodecsAv1?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_CONFIGURE),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_CONFIGURE)):-1!=D.a.os.toLowerCase().indexOf("mac")?(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_OS),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.IS_NOT_SUPPORT_OS)):f.a.hasOwnProperty("_nextWcsRenderErrTime")&&f.a._nextWcsRenderErrTime>s&&(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.SCREEN_COLOR),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.SCREEN_COLOR)):(r=!1,this.stat.setComDim(d.a.DIM_COM.WEBCODECS_BACK_REASON,ja.a.BROWSER_NOT_SUPPORTED),t.hasOwnProperty("isLive")&&!t.isLive&&this.statVod.setComDim(d.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,ja.a.BROWSER_NOT_SUPPORTED)),n.a.log("HYPlayer.useWebCodecs",r),!r&&this.h265Proxy.isH265MseCodec){if(-1!==h.a.name.indexOf("edg")&&-1==o.a.enableEdgeBroMseCfg.indexOf(h.a.version.major))return n.a.log("HYPlayer.edge not support mseHevc"),void this.onTurntoH265Wasm();if(h.a.chrome&&-1!==o.a.mse265BlackBrowVers.indexOf(h.a.version.major))return n.a.log("HYPlayer.Browser version not support mseHevc"),void this.onTurntoH265Wasm();if(f.a.hasOwnProperty("_nextMseHevcRenderErrTime")&&f.a._nextMseHevcRenderErrTime>s)return n.a.log("HYPlayer.startPlayer render single color, not support mseHevc"),this.onTurntoH265Wasm(),void this.stat.setComDim("backup_field1",3004)}t._dMod=R.b.getDecodeMod(r,this.h265Proxy.isReady,this.h265Proxy.isH265MseCodec);let a=r?N.a.PLAYER_CORE_TYPE.WEBCODECS:N.a.PLAYER_CORE_TYPE.MSE;a===N.a.PLAYER_CORE_TYPE.WEBCODECS?o.a.resendUrgentCfg=o.a.resendUrgentWcs:o.a.resendUrgentCfg=o.a.resendUrgentMse,this.h265Proxy.isSupported&&(this.isTurnToWebcodecsSoft=!1);let l={stat:this.stat,tsdb:this.tsdbUtil,statSwitch:this.statSwitch,sampleController:this.sampleController,h265Proxy:this.h265Proxy,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat,playerCoreType:a,isPureVideo:!!t.isPureVideo,isPureAudio:!!t.isPureAudio,hyPlayerIns:this,statVod:this.statVod,isSoftSolution:this.isTurnToWebcodecsSoft,seiDataChannl:this.seiDataChannl,team_port:t.team_port};this.playerCoreType=a,this.h265Proxy&&this.h265Proxy.h265StatReport&&(this.isTurnTo264?this.h265Proxy.h265StatReport.addTurnTo264Support(this.turnTo264Reason,t):e&&this.h265Proxy.isSupported?this.h265Proxy.h265StatReport.addTurnTo264Support(Qn,t):this.h265Proxy.h265StatReport.addH265SupportNew(t)),t.type!=pd.FLV&&t.type!=pd.P2P||this.handleH265Brodcast(t),this.isPlayerStarted=!0;let c=!0;switch(t.type){case pd.FLV:if(l.handlerType=M,this.player=new rn(this,l),c=this.player.initPlayer(t,l),!c)return;this.roomRecordStat.liveType=d.a.LIVE_TYPE.FLV;break;case pd.P2P:if(l.handlerType=M,this.player=new rn(this,l),c=this.player.initPlayer(t,l),!c)return;this.noPictureTimeoutP2p.addTimeout(5e3),this.roomRecordStat.liveType=d.a.LIVE_TYPE.P2P;break;case pd.HLS:this.player=new Sn(this,l),this.roomRecordStat.liveType=d.a.LIVE_TYPE.HLS,this.lastHlsInfo=t;break;case pd.HUYAWEBRTC:this.player=new Dn(this,{config:this.config}),this.noPictureTimeoutWebrtc.addTimeout(1e4);break;case pd.STREAM:this.stat.filter.addStreamUrl(t.presenterUid,t.lineType),this.startChatStream(t);break;case pd.VR:this.player=new wn(this,l);break;case pd.PLAYBACK:this.player=new bn(this,l),this.noPictureTimeoutPlayback.addTimeout(1e4),this.lastPlayBackInfo=t;break;case pd.MP4:this.player=new Kh(this,l);break;case pd.MP4GX:this.player=new ld(this,l);break;default:return void n.a.error("HYPlayer.start Unknown type[".concat(t.type,"]"))}this.checkCooling(),t.type==pd.HUYA?(this.player.init(t),this.player.start(t.curBitrate)):this._type!=pd.STREAM&&this.player.start(t),this.enableLowLatency&&this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(!0),this._type!==pd.STREAM&&(this.initMeeting(),this.voiceMgr.startVoiceStreamMgr(t)),this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(this.videoPlaybackrateAccess),this._type!==pd.STREAM&&(this.pcdnInfo=t,this.isGetPcdnMode=!1,t.usePcdn=this.getUsePcdn(t),this.getPcdnSchedule(t),this._getMediaConfig()),this._type!=pd.STREAM&&this._setEnablePixelate(t),this.typeLineBitRateKey=i}updateCurrentPageRenderFps(t){this.videoPixelateMgr.updateCurrentPageRenderFps(t)}pushVoiceMuteInfo(t){this.muffleAudio&&this.muffleAudio.sendMuffledMessageAddStreamName(t)}updateMultivideoRenderRects(t){let[{videoX:e,videoY:i,width:s,height:r}]=t;this.videoPixelateMgr.updateMultivideoRenderRects([{videoX:e,videoY:i,width:s,height:r}])}setMuffled(t,e){this.muteAudioBiPlayer.setVideoVolume(this.volume),this.muteAudioBiPlayer.setMuffled(t,e)}getVStreamInfo(t){f.a.hlsVStreamInfo&&(t.vStreamInfo=JSON.parse(f.a.hlsVStreamInfo));let e=R.b.isOpen(o.a.vodAv1Cfg,t.presenterUid,t.lineType,!1),i=!1,s=dt.a.isMseSupportedAV01(),r=!1;s&&f.a._renderInfo&&(r=fn.isClose(t.curBitrate,f.a._renderInfo));let a=2===this.av1State;2!==this.av1State&&(this.av1State=0);let n=null,h=null,l=null,c=!1;if(t.vStreamInfo&&t.vStreamInfo.length>0){if(t.vStreamInfo.map(t=>{"h265"==t.sCodec?(h=t,this.h265StreamInfo=t,c=!0):"av1"==t.sCodec?(n=t,this.av1StreamInfo=t,i=!0):"h264"==t.sCodec&&(this.h264StreamInfo=t,l=t)}),"av1"==f.a._vDecodec?h=null:"h265"==f.a._vDecodec?n=null:"h264"==f.a._vDecodec&&(h=null,n=null),n&&(t.av1Url=n.sM3u8,1==o.a.vodAv1UseFirst)){let e=this.changeOffset(n.sTs1Offset);n.sTs1Url&&(t.tsAv1Info={initUrl:n.sM3u8.replace(".m3u8","/init.mp4"),tsUrl:n.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset})}if(h){t.h265Url=h.sM3u8;let e=this.changeOffset(h.sTs1Offset);h.sTs1Url&&t.duration&&(t.tsH265Info={tsUrl:h.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset,totalDuration:t.duration})}n&&i&&!a&&e&&s&&!r&&(this.av1State=1),t._av1State=this.av1State}let u=R.b.getAv1Support(s,e,r,a);this.statVod.setComDim(d.a.VOD_CORE.AV1_SVR,i?n?1:2:3),this.statVod.setComDim(d.a.VOD_CORE.AV1_SPT,u),this.statVod.setComDim(d.a.VOD_CORE.AV1_USE,1===this.av1State?1:2),t._vodStates={av1SvrOpen:i,av1Support:u}}statVStreamExtInfo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;const i=t.extParam||t.mpExtraParam,s=t.sCodec,r=i.value;r&&(r.vid&&(e.vid=r.vid),this.stat.setComDim(d.a.VOD_EXT_COM.VID,r.vid||0),this.stat.setComDim(d.a.VOD_EXT_COM.CLIENT,r.client||""),this.stat.setComDim(d.a.VOD_EXT_COM.PID,r.pid||0),this.stat.setComDim(d.a.VOD_EXT_COM.BITRATE,r.bitrate||0),this.stat.setComDim(d.a.VOD_EXT_COM.DEFINITION,r.definition||0),this.stat.setComDim(d.a.VOD_EXT_COM.SCENE,r.scene||""),this.statVod.setComDim(d.a.VOD_EXT_COM.VID,r.vid||0),this.statVod.setComDim(d.a.VOD_EXT_COM.CLIENT,r.client||""),this.statVod.setComDim(d.a.VOD_EXT_COM.PID,r.pid||0),this.statVod.setComDim(d.a.VOD_EXT_COM.BITRATE,r.bitrate||0),this.statVod.setComDim(d.a.VOD_EXT_COM.DEFINITION,r.definition||0),this.statVod.setComDim(d.a.VOD_EXT_COM.SCENE,r.scene||""),"h265"===s&&(this.h265StreamBitrate=r.bitrate),"av1"===s&&(this.av1StreamBitrate=r.bitrate),"h264"===s&&(this.h264StreamBitrate=r.bitrate))}changeOffset(t){var e=0,i=0,s=t.split("@");if(s.length>1){var r=parseInt(s[0],10),a=parseInt(s[1],10);e=a,i=a+r}return{byteRangeStartOffset:e,byteRangeEndOffset:i}}startChatStream(t){this.chatStreamMgr||(this.chatStreamMgr=new ih(this)),this.chatStreamMgr&&this.chatStreamMgr.play(t)}getAiSupportP2P(t){if(0===Number(o.a.isAiP2PToFlv))return;if(this.isGetAiSupportP2P)return void(this.isGetAiSupportP2P=!0);if(!o.a.playerdata)return;let e=o.a.playerdata.profileP2POpt;if(n.a.log("HYPlayer.getAiSupportP2P sProfileP2POpt",e),!e||""==e||0==e.length)return;if(t.type===pd.P2PFLV){if(!t.iIsP2PSupport)return}else if(t.type===pd.VR&&(!t.iIsP2PSupport||this.isForceFlv))return;let i=0==t.originalBitrate?0:t.curBitrate,s=t.lineType,r=this.h265Proxy.isSupported?"265":"264",a=JSON.parse(this.unescapeHTML(e));n.a.log("HYPlayer.getAiSupportP2P",a),a&&(a.p2pKa.split(",").map(t=>{let e=t.split("|"),a=e.length;4==e.length&&s==e[0]&&i==e[1]&&r==e[2]&&(this.isAiSupportP2P=0==e[a-1])}),this.isAiSupportP2P?this.aiStartP2PCnt++:this.aiStartFlvCnt++)}getAiStartStat(){let t={aiStartP2PCnt:this.aiStartP2PCnt,aiStartFlvCnt:this.aiStartFlvCnt};return this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,t}getRandomUseH265(t){let e=t.presenterUid,i=!0;return o.a.h265BlackUids.concat(o.a.useAV1PidList).forEach(t=>{e&&t.toString()==e.toString()&&(i=!1)}),!!i}isSupportedH265(t){let e=!1;return e=t.iIsHEVCSupport>0&&t.iHEVCBitRate>=0||this.getIsH265(t.iCodecType)&&0===t.iBitRate,this._type==pd.P2P?this.isP2PUseH265&&e:this._type==pd.FLV?this.isFlvUseH265&&e:void 0}getIsH265(t){return 1===t||4===t||6===t||8===t}getFrameData(){(new Date).getTime();let t=null;return this.player&&this.player.getFrameData&&(t=this.player.getFrameData()),t}updateLiveVodUrl(t,e){(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map(t=>{this.statVStreamExtInfo(t)}),this.player&&this.player.updateLiveVodUrl&&this.player.updateLiveVodUrl(t,e)}getExceptionStat(){return this.player.exceptionStat?this.player.exceptionStat.getStat():""}seek(t){this.player&&this.player.seek&&this.player.seek(t)}onNoPictureP2P(){this.player&&this.isP2P&&this.onNoPictureAll(),this.player&&this.isP2P&&!this.noPictureP2PSended&&(this.noPictureP2PSended=!0,this.onNoPicture(w.P2P))}onNoPictureWebrtc(){this.player&&this.isHuyaWebrtc&&this.onNoPictureAll(),this.player&&this.isHuyaWebrtc&&!this.noPictureWebrtcSended&&(this.noPictureWebrtcSended=!0,this.onNoPicture(w.HUYAWEBRTC))}onNoPictureFlv(){this.player&&this.isFlv&&this.onNoPictureAll(),this.player&&this.isFlv&&!this.noPictureFlvSended&&(this.noPictureFlvSended=!0,this.onNoPicture(w.FLV))}onNoPictureNew(){this.startInfo&&this.startInfo.liveType==Fn.a.LIVE&&this._type!=w.P2P&&this.player&&this.player.sendNoPicture&&this.player.sendNoPicture()}onNoPictureHls(){this.player&&this.isHls&&this.onNoPictureAll(),this.player&&this.isHls&&!this.noPictureHlsSended&&(this.noPictureHlsSended=!0,this.onNoPicture(w.HLS))}onNoPicturePlayBack(){this.player&&this.isPlayback&&this.onNoPictureAll(),this.player&&this.isPlayback&&!this.noPictureHlsSended&&(this.noPictureHlsSended=!0,this.onNoPicture(w.HLS))}onNoPictureAll(){let t=[this.player.hasPicture||this.hasPlayed?0:100,this.player.isTieStream?1:0],e=[this.stat.createAct(d.a.ACT.NO_PICTURE_ALL,{value:t})];this.sendMetrics(e)}onNoPicture(t){n.a.log("HYPlayer.onNoPicture, type=".concat(t,", hasPlayed=").concat(this.hasPlayed));let e=[this.player.hasPicture||this.hasPlayed?0:100],i=this.player.getRecvInfo?this.player.getRecvInfo():[];if((this.startInfo.type===pd.HLS||this.startInfo.type===pd.PLAYBACK||this.startInfo.type===pd.MP4)&&this.startInfo&&!this.startInfo.isLive){!this.player.hasPicture&&this.player.addNoPictureReason&&this.player.addNoPictureReason();const t=_.a.now()-this.hlsNoPictureStartTs;if(this.player.sendNoPicture&&this.player.sendNoPicture(t),this.player.getCostTimes){let t=this.player.getCostTimes();i=i.concat(t)}this.hasPlayed&&(e=[0])}let s=0;this.player&&this.player.mse&&(s=this.player.mse.isMediaSourceOpen?1:2),this.stat.setActDim(d.a.DIM_LINK_STA.name,this.getExceptionStat());let r=[this.stat.createAct(d.a.ACT.NO_PICTURE,{value:e.concat(i),str:[h.a.platform,s]})];const a=R.b.getBrowserHidden();a&&2==s?n.a.log("HYPlayer.onNoPicture browserHidden=".concat(a,", isMediaSourceOpen=").concat(s)):this.sendMetrics(r),1==o.a.isAutoNoPicture&&Math.floor(1e3*Math.random())<50&&this.player&&!this.player.hasPicture&&(n.a.log("HYPlayer.onNoPicture auto report"),this.trigger(m.P2P_REPORT))}onWebrtcVideoError(t){this.enableLowLatency=!0,this.trigger(m.WEBRTC_VIDEO_ERROR)}removeNoPictureEvents(){Vs.remove(this.onNoPictureNew,this),this.noPictureTimeoutFlv.delTimeout(),this.noPictureTimeoutP2p.delTimeout(),this.noPictureTimeoutPlayback.delTimeout(),this.noPictureTimeoutHls.delTimeout(),this.noPictureTimeoutWebrtc.delTimeout(),X.remove(this.onCheckTimer,this)}removeTafEvents(){r.off(r.TAFLINK_INITED,this._getPcdnScheduleByTafBind),r.off(r.TAFLINK_INITED,this._getMediaConfigByTafBind)}removeGetPcdnEvents(){X.remove(this.timeoutGetPcdn,this),X.remove(this.httpsFetch,this)}stop(t){"sdk"!=t&&(this.isBusiStop=!0,this.roomRecordStat.setBusiStop()),n.a.group("HYPlayer.stop type=".concat(this.startInfo&&this.startInfo.type)),this.removeNoPictureEvents(),this.removeGetPcdnEvents(),this.removeTafEvents(),this.player&&(this.player.stop(),this.player.destroy&&this.player.destroy(),this.player=null),this.visibility.delVisibilitychange(),this.h265Proxy&&this.h265Proxy.stop(),this.stopFlac(),this.stopChatStream(),5!==this._type&&this.voiceMgr&&(this.voiceMgr.huyaMgr&&this.voiceMgr.huyaMgr.stop(),this.stopLiveMeeting()),n.a.groupEnd(),this.player&&this.player.player&&this.player.player.voiceEliminationData&&(this.player.player.voiceEliminationData=[]),this.costUs=0,this.stat.reset(),this.statVod.reset(),this.isGetPcdnMode=!1,this.voiceMgr&&this.voiceMgr.pureAudioMgr&&this.voiceMgr.pureAudioMgr.reset(),this.isUseEnhance=!1,this.muteAudioBiPlayer.release()}stopStream(t){n.a.log("HYPlayer.stopStream",t),this.stopChatStream()}setTafHandler(t){n.a.log("HYPlayer.setTafHandler success"),r.setTafHandler(t),Ft.start(),this._loadMps()}_loadMps(){this.startInfo&&this.startInfo.liveType===Fn.a.LIVE&&this.startInfo.h5Root&&Lh.load(this.startInfo.h5Root,this.startInfo.presenterUid,this.startInfo.lineType)}onTurntoH264(t,e){n.a.log("HYPlayer.onTurntoH264, turn to h264",t,e),this.h265Proxy.isH265MseCodec?(this.h265Proxy.onTurnToH264(this._type),this.h265WasmProxy.onTurnToH264(this._type)):this.h265Proxy.onTurnToH264(this._type),this.isTurnTo264=!0,this.turnTo264Reason=e.reason,this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?this.start(this.lastP2PInfo):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}onTurntoH265Wasm(t,e){n.a.log("HYPlayer.onTurntoH265Wasm, turn to h265 wasm",t),this.stop("sdk"),1===Number(f.a._forceMseHevc)&&f.a.setItem&&f.a.setItem("_forceMseHevc",0),this.h265MseProxy.onTurntoH265Wasm(this.type),this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?this.start(this.lastP2PInfo):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}onH265Retry(t,e){n.a.log("HYPlayer.onH265Retry, H265 retry!",t),this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?this.start(this.lastP2PInfo):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}onAutoBitrateChanged(){if(this.player){let t=this.player.info;if(t){let e={curBitrate:t.curBitrate,originalBitrate:t.originalBitrate,iBitRate:t.iBitRate,iCodecType:t.iCodecType,iHEVCBitRate:t.iHEVCBitRate};this.lastP2PInfo&&Object.assign(this.lastP2PInfo,e),this.lastFlvInfo&&Object.assign(this.lastFlvInfo,e)}}}onTurnToMse(t,e){n.a.log("HYPlayer.onTurnToMse, turn to MSE"),this.isTurnToMse=!0,this.isTurnToWebcodecsSoft=!1,this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?(this.lastFlvInfo._isTurnTomse=1,this.start(this.lastFlvInfo)):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?(this.lastP2PInfo._isTurnTomse=1,this.start(this.lastP2PInfo)):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}onWebcodecsRetry(t,e){n.a.log("HYPlayer.onWebcodecsRetry"),this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?this.start(this.lastP2PInfo):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}onResetPlayer(){this.stop(),n.a.log("HYPlayer.onResetPlayer"),this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P&&this.start(this.lastP2PInfo)}onTurnToWebcodecsSoft(t,e){f.a._webcodecSoftNums||(f.a._webcodecSoftNums=0,f.a._webcodecSoftDate=Date.now());let i=Number(f.a._webcodecSoftNums)+1;f.a._webcodecSoftNums=i,this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!0,this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P?this.start(this.lastP2PInfo):this.lastHlsInfo&&this.lastHlsInfo.type===pd.HLS?(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastHlsInfo.seekTime=e.seekTime),this.start(this.lastHlsInfo)):this.lastPlayBackInfo&&this.lastPlayBackInfo.type===pd.PLAYBACK&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.lastPlayBackInfo.seekTime=e.seekTime),this.start(this.lastPlayBackInfo))}checkWebCodecSoft(t){if(f.a._webcodecSoftDate){const t=864e5;Date.now()-Number(f.a._webcodecSoftDate)>=t?(delete f.a._webcodecSoftDate,delete f.a._webcodecSoftNums):Number(f.a._webcodecSoftNums)>=3&&(this.isTurnToWebcodecsSoft=!0)}1==o.a.isQQSoft&&94==h.a.version.major&&-1!=navigator.userAgent.toLowerCase().indexOf("qq")&&"7"==D.a.osVersion&&(this.isTurnToWebcodecsSoft=!0),1!=o.a.isWin7WcsSoft||"7"!=D.a.osVersion&&(109!=h.a.version.major||R.b.isMseSupportedHevc()||-1===h.a.name.indexOf("chrome"))||(this.isTurnToWebcodecsSoft=!0),-1!=o.a.wcsSoftBrows.indexOf(h.a.version.major)&&-1!==h.a.name.indexOf("chrome")&&(this.isTurnToWebcodecsSoft=!0),-1!=o.a.wcsSoft264Uids.indexOf(Number(t.uid))&&(this.isTurnToWebcodecsSoft=!0),1==f.a._forceWebcodecsSoft&&(this.isTurnToWebcodecsSoft=!0)}onH5PlayerError(t,e){1===this.av1State&&(this.av1State=2),this._type==pd.P2P&&(this.sdkTurnToP2P=!0),this.stop("sdk"),this.trigger(m.H5_PLAYER_ERROR,e)}onFlvUrlUnavailable(t,e){this.stop("sdk"),this.trigger(m.FLV_URL_UNAVAILABLE,e)}onNoDataReceived(t,e){this.stop("sdk"),this.trigger(m.NO_DATA_RECEIVED,e)}resetWebcodecs(t){let e=t.iBitRate+"-"+t.presenterUid+"-"+t.lineType;""!=ud&&e!=ud&&(n.a.log("HYPlayer.resetWebcodecs"),this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!1,this.webcodecsErrCount=0),ud=e}switchLevel(t){this.player&&this.player.switchLevel(t)}loadlMainLib(t){0==cd&&(eh.loadLib(t,this),cd++)}initMeeting(){this.voiceMgr||(this.voiceMgr=new sh(this)),this.voiceMgr.init()}startLiveMeeting(t,e,i,s,r){this.loadlMainLib(r),this.initMeeting(),this.voiceMgr.startLiveMeeting(t,e,i),this.enableLowLatency=!0,this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(!0)}setMeetingStat(t){this.initMeeting(),this.voiceMgr&&this.voiceMgr.liveMeetingMgr&&this.voiceMgr.liveMeetingMgr.setMeetingStat&&this.voiceMgr.liveMeetingMgr.setMeetingStat(t)}stopLiveMeeting(){this.initMeeting(),this.voiceMgr&&this.voiceMgr.liveMeetingMgr&&this.voiceMgr.liveMeetingMgr.stop&&this.voiceMgr.liveMeetingMgr.stop()}startFlac(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=t.h5Root+this.flacLibURL;this.flacMgr||(this.flacMgr=new yn(this,e)),this.flacMgr&&this.flacMgr.play(t)}stopFlac(){this.flacMgr&&this.flacMgr.stop()}stopChatStream(){this.chatStreamMgr&&this.chatStreamMgr.stop()}updateAudioPlay(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;this.loadlMainLib(e),this.initMeeting(),this.voiceMgr.updateAudioPlay(t,!0)}flacPlayStatusChange(){this.setVolume(this.volume)}setPlaybackRate(t){this.player&&this.player.setPlaybackRate&&this.player.setPlaybackRate(t)}setVideoPlaybackrateAccess(t){this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(!!this.videoPlaybackrateAccess&&t)}unescapeHTML(t){return R.b.unescapeHTML(t)}getMuteStat(){return this.muffleAudio.getMuteStat()}getUsePcdn(t){return t.sStreamName?t.type!==pd.P2P&&t.type!==pd.FLV?3:o.a.isCloseP2P(t.uid)?4:o.a.isCloseAllFuncs(t.uid)?5:t.type===pd.P2P&&o.a.isCloseP2PBroVer()?6:o.a.isClosePcdnBroVer()?7:o.a.isNotUsePcdn(t.presenterUid,t.uid)?8:t.curBitrate&&Number(t.curBitrate)>Number(o.a.closePcdnBitrate)?9:t.type===pd.P2P?1:0:2}_getPcdnScheduleByTaf(){n.a.log("HYPlayer._getPcdnScheduleByTaf taf inited"),this.getPcdnSchedule(this.startInfo)}getPcdnSchedule(t){if(-1!==o.a.notUsePcdnBrowsers.indexOf(h.a.name))return void n.a.log("HYPlayer.getPcdnSchedule browser not support");const e=R.b.getSdkAbRandom(t,o.a.flvPcdn302Ab);if(n.a.log("HYPlayer.getPcdnReq abSwitch=",e),this.abSwitch=e,1==f.a._closeLocalPcdn)return;if(1!==t.usePcdn&&0!==t.usePcdn)return void n.a.log("HYPlayer.getPcdnSchedule usePcdn=".concat(t.usePcdn,", not use pcdn"));if(this.type==pd.P2P){if(this.decoderDecodeP2pErrCnt>=3)return void n.a.log("HYPlayer.getPcdnSchedule decoderDecodeP2pErrCnt=".concat(this.decoderDecodeP2pErrCnt))}else if(this.type==pd.FLV&&this.decoderDecodeFlvErrCnt>=3)return void n.a.log("HYPlayer.getPcdnSchedule decoderDecodeFlvErrCnt=".concat(this.decoderDecodeFlvErrCnt));if(!r.connected)return r.off(r.TAFLINK_INITED,this._getPcdnScheduleByTafBind),void r.on(r.TAFLINK_INITED,this._getPcdnScheduleByTafBind);let i=this.getPcdnReq(t);n.a.log("HYPlayer.getPcdnSchedule tqf req usePcdn=".concat(t.usePcdn),i),r.sendWup("hypcdngw","clientQueryPcdnSchedule",i,t=>{this.getPcdnRes(t)},!0,r.getRequestId()),this.removeGetPcdnEvents(),X.once(this.timeoutGetPcdn,this,1e3),X.once(this.httpsFetch,this,1e3)}getPcdnRes(t){n.a.log("HYPlayer.getPcdnSchedule res",t),this.isGetPcdnMode=!0,this.removeGetPcdnEvents(),!t||0!=t.iErrCode&&7!=t.iErrCode||this.player&&this.player.checkPcdnMode&&this.player.checkPcdnMode(t)}getPcdnReq(t){const e=this.abSwitch;let i=new tt.HUYA.ClientQueryPcdnScheduleReq;i.lReqTs=Date.now(),i.lUid=v.a.uid,i.sGuid=v.a.sGuid,i.lAnchorUid=t.presenterUid,i.iCdnLine=t.lineType,i.iCliType=tt.HUYA.EM_CLINET_TYPE.E_CLIENT_WEB,i.lBucketPara=1e4,i.iRatio=t.iBitRate,i.sCodec=this.player&&this.player.getFetchCodecType?this.player.getFetchCodecType():"264",i.vPcdnMode.value=[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream];let s=new tt.TafBase.Vector(new tt.TafBase.STRING);s.value=["xy","ppio","qn"];let r=1==o.a.pcdn302FlvCfg[0];return o.a.pcdn302BlackAids.length>0&&-1!=o.a.pcdn302BlackAids.indexOf(t.presenterUid)&&(r=!1),1==f.a._closeFLvPcdn302&&(r=!1),1===Number(o.a.pcdnFlv)&&(i.vPcdnMode.value.push(tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream),i.mPcdnModeCliSupportPcdns.value[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]=s,e&&r&&(i.vPcdnMode.value.push(tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream),i.mPcdnModeCliSupportPcdns.value[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream]=s)),i.vSupportMode.value=e&&r?[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream,tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvHttpFullstream,tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]:[tt.HUYA.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream,tt.HUYA.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream],i.iBusiType=tt.HUYA.EM_BUSI_TYPE.E_BusiType_Live,i.sStreamName=t.sStreamName,i}httpsFetch(){if(this.isGetPcdnMode)return;let t=this.pcdnInfo,e=this.getPcdnReq(t);n.a.log("HYPlayer.httpsFetch req usePcdn=".concat(t.usePcdn),e);let i=Date.now().toString(16),s="https://pcdngw.huya.com/huyalive/clientQueryPcdnSchedule";s+="?wsSecret=".concat(ti("clientQueryPcdnSchedule".concat(i,"1211huyalive")),"&wsTime=").concat(i);let r=new tt.TafBase.JceOutputStream;e.writeTo(r),fetch(s,{body:r.getBuffer(),method:"POST"}).then(t=>{const e=t.body.getReader();this.pump.call(this,e)})}pump(t){t.read().then((e=>{if(e.done)n.a.log("httpsFetch done");else{let r=e.value.buffer;this.pump(t);var i=new tt.TafBase.JceInputStream(r),s=new tt.HUYA.ClientQueryPcdnScheduleRsp;s.readFrom(i),this.getPcdnRes(s)}}).bind(this))}getAnticode(t,e){let i=e.split("&"),s={};return i.map(t=>{let e=t.split("=");2==e.length&&(s[e[0]]=e[1])}),s[t]?s[t]:""}getAnticodeSeqid(){let t=0;return this.player&&this.player.getAnticodeHandler&&(t=this.player.getAnticodeHandler().getSeqid()),t}timeoutGetPcdn(){n.a.log("HYPlayer.timeoutGetPcdn"),this.isGetPcdnMode||this.getPcdnSchedule(this.pcdnInfo)}setVideoPixelateData(t){const{config:e}=t;1==f.a._forceVideoMaskConfig&&(e.pixelateResource=[{key:1,url:"https://diy-assets.msstatic.com/OmpPixelate/focus.png"}]),n.a.log("HYPlayer.setVideoPixelateData.config=".concat(e&&JSON.stringify(e))),e&&e.pixelateResource&&e.pixelateResource.length>0&&this.videoPixelateMgr.setVideoPixelateData(e.pixelateResource)}pushVideoPixlateInfo(t){n.a.log("HYPlayer.pushVideoPixlateInfo, pixelateInfo=".concat(t&&JSON.stringify(t))),this.videoPixelateMgr.pushVideoPixlateInfo(t)}setVideoPixelateBox(t){this.videoPixelateMgr.setVideoPixelateBox(t)}setDoubleScreenPixelateBox(t,e){this.videoPixelateMgr.setDoubleScreenPixelateBox(t,e)}getMosaicStat(){return{data:this.videoPixelateMgr.getMosaicStat()}}getMosaicGrassMode(){return this.videoPixelateMgr.getMosaicGrassMode()}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.videoPixelateMgr&&this.videoPixelateMgr.containerResize(t),this.player&&this.player.containerResize&&this.player.containerResize(t),this.player&&this.player.mse&&this.player.mse.containerResize&&this.player.mse.containerResize(t)}containerResizeNew(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.player&&this.player.containerResizeNew&&this.player.containerResizeNew(t),this.videoPixelateMgr&&this.videoPixelateMgr.containerResizeNew(t)}getUseAuto(){return this.autoForce.getUseAuto()}getSupportAuto(){return!o.a.getEnableJumpBuffer()}_setEnablePixelate(t){this.videoPixelateMgr.setEnablePixelate(t)}getDelayInfo(){return this.player&&this.player.mse?this.player.mse.getDelayInfo():this.player.getDelayInfo?this.player.getDelayInfo():null}getRealBitrate(){return this.player&&this.player.mse?this.player.mse.getRealBitrate():this.player.getRealBitrate?this.player.getRealBitrate():0}getRandomUseAiP2PFlv(t){let e=t.presenterUid,i=!0,s=!0,r=o.a.aiBlackUids,a=o.a.aiBlackLines;return n.a.log("HYPlayer.getRandomUseAiP2PFlv blackUids",r),r.forEach(t=>{e&&t.toString()==e.toString()&&(i=!1)}),a.forEach(e=>{t.lineType&&e==t.lineType&&(s=!1)}),s&&i&&0!=t.iIsP2PSupport?o.a.isCloseP2P(t.uid)||o.a.isCloseAllFuncs(t.uid)||o.a.useAV1?2:1:2}setAiP2PFlvComp(t){let e=this.getRandomUseAiP2PFlv(t);this.aiComp=e,0==e||2==e?o.a.setAiP2PToFlv(0):1==e&&o.a.setAiP2PToFlv(1)}getAbTestConfig(){if(!this._initAb){this._initAb=!0;let t=f.a.abConfig;if(n.a.log("HYPlayer.getAbTestConfig abConfig",t),!t)return null;if(t=JSON.parse(t),""!=t.mpExperiment&&this.stat.setComDim(d.a.DIM_COM.OEXP,t.mpExperiment),t.mpConfig&&t.mpConfig.hasOwnProperty("pcdnConnectData2")&&(o.a.pcdnAbConnectData[0]=Number(t.mpConfig.pcdnConnectData2)),t.mpConfig&&t.mpConfig.hasOwnProperty("useAv1")&&(o.a.abUseAv1=Number(t.mpConfig.useAv1)),t.mpConfig&&t.mpConfig.hasOwnProperty("isWebAutoABBBB")&&(o.a.isWebAutoAB=Number(t.mpConfig.isWebAutoABBBB)),t.mpConfig&&t.mpConfig.hasOwnProperty("dropFrameTime")&&(o.a.dropTime=Number(t.mpConfig.dropFrameTime)),t.mpConfig){let e=["pcdnConnectData2","useAv1","isWebAutoABBBB","dropFrameTime"];for(let i in t.mpConfig)if(-1===e.indexOf(i)&&o.a.hasOwnProperty(i)){let e=o.a[i];"string"==typeof e||e instanceof Array?o.a[i]=t.mpConfig[i]:"number"==typeof e&&(o.a[i]=Number(t.mpConfig[i]))}}}}getSdkTestConfig(){return[].join(",")}onCheckTimer(t,e){this.videoEnhance&&this.videoEnhance.onCheckTimer&&this.videoEnhance.onCheckTimer(t,e)}setAv1Ab(t){o.a.useAV1&&dt.a.isMseSupportedAV01()&&R.b.getAv1Random(t,o.a.av1PercentConfig)}getCdnSip(){return this.player&&this.player.getCdnSip&&this.player.getCdnSip()}p2pFlvPlayerSetType(t){switch(this._type=t,t){case pd.FLV:this.roomRecordStat.liveType=d.a.LIVE_TYPE.FLV;break;case pd.P2P:this.roomRecordStat.liveType=d.a.LIVE_TYPE.P2P}}getIsSdkSupportH265(){return this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec}getAutoBitrateList(t){if(this.getIsH265(t.iCodecType)&&(t.hasAutoBitrate||t.isAuto)){let e=[],i=!0;t.bitrateList.forEach(e=>{e.iBitRate>=t.srcBitRate&&(i=!1)}),t.bitrateList.forEach(t=>{0==t.iBitRate||i||e.push(t)}),t.bitrateList=e}}handleH265Brodcast(t){this.getIsH265(t.iCodecType)&&(this.getIsSdkSupportH265()||this.isFakeHdr(t)||0==t.originalBitrate&&t.bitrateList.forEach(e=>{e.iBitRate>t.srcBitRate&&(t.iBitRate=e.iBitRate,t.curBitrate=e.bitrate)}))}isFakeHdr(t){return(Number(t.iCompatibleFlag)&Sh)===Sh}mappingFakeHdrBitrate(t){let e=this.getFakeHdrBitrate(t.presenterUid,t.iBitRate,t.iFrameRate);n.a.log("HYPlayer.mappingFakeHdrBitrate, fakeHdrBitrate=".concat(e)),t.iBitRate===t.iHEVCBitRate&&(t.iHEVCBitRate=e),t.iBitRate=e,t.curBitrate=e}getFakeHdrBitrate(t,e,i){return o.a.getFakeHdrBitrate(t,e,i)}shieldAudioChange(t){if(!t)return;n.a.log("HYPlayer.shieldAudioChange isStartShield=".concat(t.isStartShield));let e=t.sShieldStream,i=t.isStartShield;this.startInfo.isStartShield=i,i?(this.startInfo.sShieldStream=e,this.startInfo.commentorIdList=t.commentorIdList,this.shieldAudioStart(e)):this.player.stopShieldAudioPlayer()}shieldAudioStart(){this.start(this.startInfo)}teamCommunicateChange(t){if(!t)return;n.a.log("HYPlayer.shieldAudioChange isStartShield=".concat(t.isStartShield));let e=t.teamCommunicateStream,i=t.isTeamCommunicate;this.startInfo.isStartShield=i,i?(this.startInfo.sShieldStream=e,this.teamCommunicateStart()):this.player.stopShieldAudioPlayer()}teamCommunicateStart(){this.start(this.startInfo)}imgplusABTestNotice(t){if(this._type!==pd.STREAM&&(n.a.log("HYPlayer.imgplusABTestNotice",t),t&&this.startInfo)){const e=t.lPid,i=t.iSwitch;e==this.startInfo.presenterUid&&(1==i?n.a.log("HYPlayer.imgplusABTestNotice.open",i,e,this.startInfo.presenterUid):0==i&&(this.isCloseImgPlusAB=!0,n.a.log("HYPlayer.imgplusABTestNotice.close",i,e,this.startInfo.presenterUid)))}}getLocalImgplusTestNotice(t){if(f.a.closeABTestUids){const e=t.presenterUid;-1!=f.a.closeABTestUids.indexOf(e)&&(this.isCloseImgPlusAB=!0)}}_getMediaConfigByTaf(){n.a.log("HYPlayer._getMediaConfigByTaf taf inited"),this._getMediaConfig()}_getMediaConfig(){if(!r.connected)return r.off(r.TAFLINK_INITED,this._getMediaConfigByTafBind),void r.on(r.TAFLINK_INITED,this._getMediaConfigByTafBind);let t=new tt.HUYA.GetStreamInfoByRoomFakeReq;t.tId.iAppid=v.a.appid,t.tId.bAnonymous=0,t.tId.lUid=v.a.uid,t.tId.sGuid=v.a.sGuid,t.tId.sUA="media_web&2301031126&sea",t.tId.sUAppId=v.a.appid,n.a.log("HYPlayer._getMediaConfig",t),r.sendWup("mediaui","getStreamInfoByRoomFake",t,this._onGetMediaCofigBind,!0,r.getRequestId(),!0)}onGetMediaCofig(t){if(t&&t.mpConfig){let e=t.mpConfig.value;if(n.a.log("HYPlayer.onGetMediaCofig",e),e.hasOwnProperty("closeABTestUids")){f.a.closeABTestUids=e.closeABTestUids;const t=this.startInfo,i=t.presenterUid,s=t.sStreamName,r=e.closeABTestUids;this.streamChange.isImgPlusExp&&-1!=r.indexOf(i)&&(this.isCloseImgPlusAB=!0,""!=this.streamChange.extStreamName&&-1!=s.indexOf(this.streamChange.extStreamName)&&(this.lastFlvInfo&&this.lastFlvInfo.type===pd.FLV?this.start(this.lastFlvInfo):this.lastP2PInfo&&this.lastP2PInfo.type===pd.P2P&&this.start(this.lastP2PInfo)))}else delete f.a.closeABTestUids}else n.a.log("HYPlayer.onGetMediaCofig no rsp.mpConfig")}setEnhance(t){this._type!=pd.P2P&&this._type!=pd.FLV&&this._type!=pd.HLS&&this._type!=pd.PLAYBACK||(n.a.log("HYPlayer.setEnhance",t),this.isUseEnhance=!!t,this.videoEnhance.getSupport(this.startInfo,ct()),this.isUseEnhance&&(this.videoEnhance.isSupport||this.trigger(m.ON_VIDEO_ENHANCE_UNSUPPORT),this.isUseEnhance=this.videoEnhance.isSupport),this._type==pd.PLAYBACK?this.player&&this.player.player&&this.player.player.setEnhance&&this.player.player.setEnhance(this.isUseEnhance):this.player&&this.player.setEnhance&&this.player.setEnhance(this.isUseEnhance))}setMuted(t){n.a.log("HYPlayer.setMuted",t),this.player&&this.player.setMuted(t),this.stat.setComDim(d.a.DIM_COM.IS_MUTE,t?1:0),this.muteAudioBiPlayer.setMuted(t)}setRoomLive(t){this.roomRecordStat.setLive(t)}setSegmenttion(t){n.a.log("HYPlayer.setSegmenttion",t),this.player&&this.player.setSegmenttion(t)}getModelRes(){return this.videoEnhance.getModelRes()}onBrowserAutoplayFail(t,e){this.trigger(m.BROWSER_AUTOPLAY_FAIL,e),this.pause()}onVideoEhanceError(t,e){this._type==pd.PLAYBACK?this.player&&this.player.player&&this.player.player.setEnhance&&this.player.player.setEnhance(!1):this.player.setEnhance(!1),this.videoEnhance&&this.videoEnhance.onVideoEhanceErrorCb&&this.videoEnhance.onVideoEhanceErrorCb(e.type)}onVideoEhanceSuccess(){this.videoEnhance&&this.videoEnhance.onVideoEhanceSuccess&&this.videoEnhance.onVideoEhanceSuccess()}getEnhanceStats(){return this.videoEnhance.getEnhanceStats()}getRefreshRate(){return this.refreshRate}isSupport120Hz(t){return!t&&this.startInfo&&(t=this.startInfo.presenterUid),new Promise((e,i)=>{if(f.a._pageSdkFps>=60){const i=f.a._pageSdkFps,s=o.a.getFpsBitrate(t,i);n.a.log("HYPlayer.isFpsBitrate, res=".concat(s,", cache fps=").concat(i)),e(s),this.refreshRate=i,setTimeout(()=>{const t=Vs.getPageFpsMax();f.a._pageSdkFps=t},5e3)}else setTimeout(()=>{const i=Vs.getPageFpsMax(),s=o.a.getFpsBitrate(t,i);n.a.log("HYPlayer.isFpsBitrate, res=".concat(s,", fps=").concat(i)),e(s),this.refreshRate=i,f.a._pageSdkFps=i},3e3)})}pause(){this.player&&this.player.pause&&this.player.pause()}play(){this.player&&this.player.play&&this.player.play()}onVisibilitychange(t){this.videoPixelateMgr.onVisibilitychange(t)}getSyncTime(){const t=Ft.getSyncTime();return n.a.log("HYPlayer.getSyncTime",t),t}getRenderInfo(){return ct()}get isFlv(){return this._type==pd.FLV}get isP2P(){return this._type==pd.P2P}get isHls(){return this._type==pd.HLS||this._type==pd.MP4}get isPlayback(){return this._type==pd.PLAYBACK}get isHuya(){return this._type==pd.HUYA}get isHuyaWebrtc(){return this._type==pd.HUYAWEBRTC}get isP2pPlayIng(){return this.player&&this.player._isP2pPlayIng}}pd.FLV=1,pd.P2P=2,pd.HLS=3,pd.HUYA=4,pd.STREAM=5,pd.OBS=6,pd.VR=7,pd.HUYAWEBRTC=8,pd.PLAYBACK=9,pd.P2PFLV=10,pd.MP4=11,pd.MP4GX=110;var md=i.default=pd;window.HYPlayer=pd,window.H5Player=pd},function(t,e,i){"use strict";i.r(e);class s{constructor(t,e,i){this.timeStamp=e,this.frame=i,this.type=t,this.isEmptyAudioFrame=!1}setIsEmptyAudioFrame(t){this.isEmptyAudioFrame=t}}s.VIDEO=0,s.AUIDO=1;var r=s,a=i(7);class o{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.data=i,this.timeStamp=e,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=s,this.isKeyFrame=r}}o.VIDEO=0,o.AUIDO=1;var n=o,h=i(12),d=i(17);class l{constructor(t){this.samples=[],this.decodedFrames=[],this.decoder=null,this.decodingTimeStamp=0,this.decodingType=0,this.decodeState=l.DECODE_STATE_PENDDING,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,this.player=t,this.decodeDatas=[],this.decodIngAudioFrameTimeStamps=[],this.decodIngAudioFrameIsEmptyTypes=[],this.count=0,this.closed=!1,this.toDecodeFrameLocalTimeMap=new Map,this.frameDecodeDelays=[],this.smoothFrameDecodeDelay=0,this.decodedFrameStamp=0,this.printTodecodeCnt=0,this.printDecodedCnt=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.lastTodecodeDts=0}get configured(){return this.decoder&&"configured"==this.decoder.state}close(){this.closed=!0,this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.player=null,this.decodedFrameStamp=0}appendSamples(t,e){for(;t.length>0;)this.samples.push(t.shift());this.decodeState==l.DECODE_STATE_PENDDING&&this.decodeChunk(e)}getUnDecodeBuffer(){return this.lastToDecodePts>0&&this.lastDecodedPts>0?this.lastToDecodePts-this.lastDecodedPts:0}decodeFrame(t){this.toDecodeNums++,this.lastToDecodePts=t.timeStamp+(t.compositionTime||0),t.type==n.AUIDO?this.player.storeWorkerShared(h.StoreWorkerType.AUDIO_TODECODE_NUMS,this.toDecodeNums):t.type==n.VIDEO&&this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_TODECODE_NUMS,this.toDecodeNums),this.toDecodeFrameLocalTimeMap.set(t.timeStamp,a.default.getNow()),d.a.printTodecodeVideo&&t.type===n.VIDEO&&a.default.log("WebCodecsDecoder.decodeFrame isKey=".concat(t.isKeyFrame," dts=").concat(t.timeStamp," cts=").concat(t.compositionTime," pts=").concat(t.timeStamp+t.compositionTime," gap=").concat(t.timeStamp-this.lastTodecodeDts," lastDecodedPts=").concat(this.lastDecodedPts,"  samples=").concat(this.player.decodeJitter.videoSamples.length," decodedNum=").concat(this.player.videoRender.framelist.length)),d.a.printToDecodeAudio&&t.type===n.AUIDO&&a.default.log("WebCodecsDecoder.decodeFrame dts=".concat(t.timeStamp," gap=").concat(t.timeStamp-this.lastTodecodeDts," lastDecodedPts=").concat(this.lastDecodedPts," samples=").concat(this.player.decodeJitter.audioSamples.length," decodedNum=").concat(this.player.audioRender.framelist.length)),this.lastTodecodeDts=t.timeStamp;try{this.decoder.decode(t.data)}catch(e){console.error(e,t,t.naluType,t.isKeyFrame,t.timeStamp,this.toDecodeNums,"webCodecsDecoder"),this.onDecoderError(e)}}onFrame(t){let e=a.default.getNow();if(this.decodedFrameStamp=e,this.lastDecodedPts=t.timestamp,this.closed)return;this.decodeNums++;let i=0,s=!1;if(this.decodingType==n.AUIDO?(i=this.decodIngAudioFrameTimeStamps.shift(),s=this.decodIngAudioFrameIsEmptyTypes.shift(),this.player.storeWorkerShared(h.StoreWorkerType.AUDIO_DECODE_NUMS,this.decodeNums)):this.decodingType==n.VIDEO&&(this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_DECODE_NUMS,this.decodeNums),i=t.timestamp),this.toDecodeFrameLocalTimeMap.has(i)){let t=Math.floor(100*(a.default.getNow()-this.toDecodeFrameLocalTimeMap.get(i)))/100;d.a.printDecodedVideo&&this.decodingType===n.VIDEO&&a.default.log("WebcodecsDecoder.decode timeStamp=".concat(i," delay=").concat(t," samples=").concat(this.player.decodeJitter.videoSamples.length," frames=").concat(this.player.videoRender.framelist.length)),d.a.printDecodedAudio&&this.decodingType===n.AUIDO&&a.default.log("WebcodecsDecoder.decode timeStamp=".concat(i," delay=").concat(t," samples=").concat(this.player.decodeJitter.audioSamples.length," frames=").concat(this.player.audioRender.framelist.length)),this.frameDecodeDelays.push(t),this.toDecodeFrameLocalTimeMap.delete(i),0===this.smoothFrameDecodeDelay?this.smoothFrameDecodeDelay=t:this.smoothFrameDecodeDelay=(7*this.smoothFrameDecodeDelay+t)/8}let o=i,l=new r(this.decodingType,o,t);l.setIsEmptyAudioFrame(s),this.player.onFrameDecoded(l)}getDecodeDelay(){let[...t]=this.frameDecodeDelays;return this.frameDecodeDelays.length=0,t}onDecoderError(t){a.default.log("WebCodecsDecoder.onDecoderError, decodingType=".concat(this.decodingType));let e=h.ToMainMessageType.VIDEODECODEERROR;this.decodingType==n.VIDEO?e=h.ToMainMessageType.VIDEODECODEERROR:this.decodingType==n.AUIDO&&(e=h.ToMainMessageType.AUDIODECODEERROR),this.player.handlerError(e,{msg:t&&t.message})}getDecodeFps(){let t={toDecodeFps:this.toDecodeNums-this.lastToDecodeNums,decodeFps:this.decodeNums-this.lastDecodedNums};return this.lastDecodedNums=this.decodeNums,this.lastToDecodeNums=this.toDecodeNums,t}resetDecoder(){}}l.DECODE_STATE_PENDDING=0,l.DECODE_STATE_DECODEDING=1,l.DECODE_STATE_DECODEFINISH=2,l.DECODER_ERROR="video_deocde_error",l.DECODER_TYPE_VIDEO=0,l.DECODER_TYPE_AUDIO=1;var c=l,u=class extends c{constructor(t){super(t),this.decodingType=n.VIDEO,this.avcHeader=null,this.avcHeaderChanged=!1,this.lastToDecodeFrameTimeStamp=0,this.createDecoder(),this._isUseSoftAcceleration=!1,this.checkDecodedOutputFrameTypeTimes=0,this.lastDecodedFrameTimeStamp=0,this.outputFrameByPts=!1,this.outputFrameMode=-1,this.checkFrameCnt=0,this.hasCts=!1,this.codecType="",this._lastDecodedTs=-1e4,this.decodedNum=0,this.firstToDecodeTs=0,this.firstDecodedTs=0}resetDecoder(){this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.decodedFrameStamp=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.createDecoder(),this.setAVCConfig()}createDecoder(){this.decoder=new VideoDecoder({output:this.onFrame.bind(this),error:this.onDecoderError.bind(this)})}close(){super.close(),this.codecType=""}decodeFrame(t){t.isKeyFrame&&"av01"!=this.codecType&&!this.player.isVodAv1&&this.updateAVCConfig(t.sps,t.pps,t.vps,t.codec,t.width,t.height),this.lastToDecodeFrameTimeStamp=t.timeStamp,t.compositionTime>0&&(this.hasCts=!0),0==this.firstToDecodeTs&&(this.firstToDecodeTs=a.default.getNow()),super.decodeFrame(t)}onFrame(t){const e=a.default.getNow();this.decodedNum+=1,-1e4!=this._lastDecodedTs&&e-this._lastDecodedTs>=200&&a.default.log("WebCodecsVideoDecoder.onFrame ts delta=".concat(e-this._lastDecodedTs,", num=").concat(this.decodedNum));let i=0;0==this.firstDecodedTs&&0!=this.firstToDecodeTs&&(this.firstDecodedTs=e,i=this.firstDecodedTs-this.firstToDecodeTs,this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_FIRST_FRAME_DECODEC_COST,i)),this._lastDecodedTs=e,this.checkOutputMode(t.timestamp),this.checkFrameOutputByPts(t.timestamp),this.lastDecodedFrameTimeStamp=t.timestamp,super.onFrame(t)}checkFrameOutputByPts(t){!this.outputFrameByPts&&this.checkDecodedOutputFrameTypeTimes<100&&t<this.lastDecodedFrameTimeStamp&&(this.checkDecodedOutputFrameTypeTimes++,this.outputFrameByPts=!0,this.player.setVideoOutputByPts(this.outputFrameByPts))}checkOutputMode(t){-1===this.outputFrameMode&&this.checkFrameCnt<100&&(this.checkFrameCnt++,t<this.lastDecodedFrameTimeStamp?this.outputFrameMode=2:100===this.checkFrameCnt&&-1===this.outputFrameMode&&(this.hasCts?this.outputFrameMode=1:this.outputFrameMode=2))}isOutputFrameByDts(){return 1===this.outputFrameMode}updateAVCConfig(t,e,i,s,r,o){this.avcHeaderChanged=this.checkAVCConfigChanged(e,t,i),this.avcHeader={sps:t,pps:e,vps:i,codec:s,width:r,height:o},this.avcHeaderChanged&&(a.default.log("WebCodecsDecoder.updateVideoConfig codec=".concat(s," width=").concat(r," height=").concat(o)),this.setAVCConfig())}checkAVCConfigChanged(t,e,i){if(!this.avcHeader)return!0;if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("hvc")){if(this.avcHeader.pps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString()&&this.avcHeader.vps[0].nalu.toLocaleString()==i[0].nalu.toLocaleString())return!1}else if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("avc")&&this.avcHeader.pps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString())return!1;return!0}setAVCConfig(){a.default.log("WebCodecsDecoder.setAVCConfig"),this.setDecoderConfig(),this.avcHeaderChanged=!1}setDecoderConfig(){var t=this.getExtradata();if(!t)return void a.default.log("WebCodecsDecoder.setDecoderConfig extradata is null!");let e={codec:this.avcHeader.codec,codedWidth:this.avcHeader.width,codedHeight:this.avcHeader.height,description:t,optimizeForLatency:!1};this._isUseSoftAcceleration&&(e.hardwareAcceleration="prefer-software"),this.videoConfig=e,a.default.log("WebCodecsDecoder.setDecoderConfig",e.hardwareAcceleration,this._isUseSoftAcceleration),this.decoder.configure(e)}initAv1Seg(t){this.codecType="av01",this.setAv1DecoderConfig(t)}setAv1DecoderConfig(t){let e={codec:t.codec,codedWidth:t.width,codedHeight:t.height,description:t.configOBUs};this._isUseSoftAcceleration&&(e.hardwareAcceleration="prefer-software"),this.videoConfig=e,a.default.log("WebCodecsDecoder.setAv1DecoderConfig,codec=".concat(t.codec)),this.decoder.configure(e),this.isConfig=!0}seek(){this.decoder.reset(),this.decoder.configure(this.videoConfig)}getExtradata(){return-1!==this.avcHeader.codec.indexOf("hvc")?(this.codecType="265",this.getExtradata265()):-1!==this.avcHeader.codec.indexOf("avc")?this.getExtradata264():null}getExtradata265(){let t=this._getNumOfArrays(this.avcHeader.vps,32),e=this._getNumOfArrays(this.avcHeader.sps,33),i=this._getNumOfArrays(this.avcHeader.pps,34),s=this._getSPSOri(e),r=[1,s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18],s[19],240,0,252,253,248,248,0,0,15];return r.push(3),r=r.concat(t).concat(e).concat(i),new Uint8Array(r)}_getNumOfArrays(t,e){let i=[];i.push(128|e),i.push((65280&t.length)>>8),i.push(255&t.length);for(let e=0;e<t.length;e++){let s=t[e].nalu;i.push((65280&s.length)>>8),i.push(255&s.length),i=i.concat(Array.prototype.slice.call(s))}return i}_getSPSOri(t){let e=[],i=0;for(let s=0;s<t.length;){let r=t[s];2!==i||3!==r?(0===r?i++:i=0,e.push(r),++s):(++s,i=0)}return e}getExtradata264(){var t,e=7;for(t=0;t<this.avcHeader.sps.length;t++)e+=2+this.avcHeader.sps[t].length;for(t=0;t<this.avcHeader.pps.length;t++)e+=2+this.avcHeader.pps[t].length;var i=new class{constructor(t){this.data=new Uint8Array(t),this.idx=0,this.size=t}getData(){if(this.idx!=this.size)throw"Mismatch between size reserved and sized used";return this.data.slice(0,this.idx)}writeUint8(t){this.data.set([t],this.idx),this.idx++}writeUint16(t){var e=new Uint16Array(1);e[0]=t;var i=new Uint8Array(e.buffer);this.data.set([i[1],i[0]],this.idx),this.idx+=2}writeUint8Array(t){this.data.set(t,this.idx),this.idx+=t.length}}(e);let s=this.avcHeader.sps[0].nalu[1],r=this.avcHeader.sps[0].nalu[2],a=this.avcHeader.sps[0].nalu[3];for(i.writeUint8(1),i.writeUint8(s),i.writeUint8(r),i.writeUint8(a),i.writeUint8(255),i.writeUint8(this.avcHeader.sps.length+224),t=0;t<this.avcHeader.sps.length;t++)i.writeUint16(this.avcHeader.sps[t].length),i.writeUint8Array(this.avcHeader.sps[t].nalu);for(i.writeUint8(this.avcHeader.pps.length),t=0;t<this.avcHeader.pps.length;t++)i.writeUint16(this.avcHeader.pps[t].length),i.writeUint8Array(this.avcHeader.pps[t].nalu);return i.getData()}setUseSoftAcceleration(){this._isUseSoftAcceleration=!0}getDecodingBuffer(){return this.lastToDecodeFrameTimeStamp-this.lastDecodedFrameTimeStamp}},p=class extends c{constructor(t){super(t),this.decodingType=n.AUIDO,this.aacConfig=null,this.aacConfigChanged=!1,this.aacConfigInited=!1,this.decoder=new AudioDecoder({output:this.onFrame.bind(this),error:this.onDecoderError.bind(this)}),this._lastDecodedTs=-1e4,this.decodedNum=-1,this.aacTimeLen=1024e3/44100,this.firstToDecodeTs=0,this.firstDecodedTs=0}updateAudioConfig(t,e,i,s){this.aacConfig&&this.aacConfig.codec==t&&this.aacConfig.sampleRate==e&&this.aacConfig.numberOfChannels==i||(this.aacConfig={codec:t,sampleRate:e,numberOfChannels:i,timestamp:s},this.aacConfigChanged=!0),this.aacConfigInited||this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels)}setAACConfig(t,e,i){let s={codec:t,sampleRate:e,numberOfChannels:i};this.aacTimeLen=1024e3/e,this.audioConfig=s,a.default.log("WebCodecsAudioDecoder.setAACConfig,c=".concat(t,",sr=").concat(e,",nc=").concat(i,",aacT=").concat(this.aacTimeLen)),this.decoder.configure(s),this.aacConfigInited=!0}seek(){this.decoder.reset(),this.decoder.configure(this.audioConfig)}decodeFrame(t){this.aacConfigChanged&&this.aacConfig.timestamp<=t.timeStamp&&(this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels),this.aacConfigChanged=!1),0==this.firstToDecodeTs&&(this.firstToDecodeTs=a.default.getNow()),super.decodeFrame(t),this.decodIngAudioFrameTimeStamps.push(t.timeStamp),this.decodIngAudioFrameIsEmptyTypes.push(t.isEmptyAudioFrame)}onFrame(t){this.decodedNum+=1;const e=a.default.getNow();-1e4!=this._lastDecodedTs&&e-this._lastDecodedTs>=200&&a.default.log("WebCodecsVideoDecoder.onFrame ts delta=".concat(e-this._lastDecodedTs,", num=").concat(this.decodedNum));let i=0;0==this.firstDecodedTs&&0!=this.firstToDecodeTs&&(this.firstDecodedTs=e,i=this.firstDecodedTs-this.firstToDecodeTs,this.player.storeWorkerShared(h.StoreWorkerType.AUDIO_FIRST_FRAME_DECODEC_COST,i)),super.onFrame(t)}getAacTimeLen(){return this.aacTimeLen}},m=class{constructor(t){this._name=t,this._startTs=0,this._startDts=0,this._lastDts=0,this._jumpTime=0,this._lastDts=0,this._lastTs=0}setLast(t,e){this._lastDts=t,this._lastTs=e}getDtsSlowTime(t,e){if(this._lastDts>0){let i=t-this._lastDts;return e-this._lastTs-i}return 0}get lastDts(){return this._lastDts}setJumpTime(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._jumpTime+=t,e&&a.default.log("Timeline.setJumpTime name=".concat(this._name," jumpTime=").concat(t," totalJumpTime=").concat(this._jumpTime))}reset(){this._startTs=0,this._startDts=0,this._lastDts=0}start(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];0===this._startTs&&(i&&a.default.log("Timeline.start name=".concat(this._name," dts=").concat(e)),this._startTs=t,this._startDts=e)}getTsTime(t){return Math.floor(t-this._startTs+this._jumpTime)}getDtsNow(t){return this._startDts+this.getTsTime(t)}isDtsLess(t,e){return e<this.getDtsNow(t)}},_=i(9);const f=eval;class g{constructor(t){this._decodeHelper=t,this._decodeJitter=t.getDecodeJitter(),this._type="",this._initType(),this._timeline=new m("".concat(this._type,"_decode")),this._timelineSlow=new m("".concat(this._type,"_decode_slow")),this._state=S.FAST_DOING,this._fastBuf=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}get jitBuf(){return this._decodeJitter.player.latencyCfg.latencyBuf}get jitMin(){return this._decodeJitter.player.latencyCfg.latencyMin}get jitMax(){return this._decodeJitter.player.latencyCfg.latencyMax}get isNoGop(){return this._decodeJitter.player.latencyCfg.isNoGop}_initType(){}setFastEnding(){a.default.log("MediaDecodeHelper.setFastEnding type=".concat(this._type)),this._state=S.FAST_ENDING}setNormal(){a.default.log("MediaDecodeHelper.setNormal type=".concat(this._type)),this._timelineSlow.reset(),this._state=S.NORMAL}setSlow(){a.default.log("MediaDecodeHelper.setSlow type=".concat(this._type)),this._state=S.SLOW}setWaitKeyFrame(){a.default.log("MediaDecodeHelper.setWaitKeyFrame type=".concat(this._type)),this._state=S.WAIT_KEY_FRAME,this._waitKeyFrameTs=a.default.getNow()}isWaitForKeyFrame(){return this._state===S.WAIT_KEY_FRAME}checkDecode(t){let e=this._getSamples();if(e.length>0){let i=e[0];this._timeline.start(t,i.timeStamp),this._state===S.FAST_DOING?this._decodeInFastDoing(t,i):this._state===S.FAST_ENDING?this._decodeInFastEnding(t,i):this._state===S.NORMAL?this._decodeInNormal(t,i):this._state===S.SLOW?this._decodeInSlow(t,i):this._state===S.WAIT_KEY_FRAME&&this._decodeInWaitKeyFrame(t,i)}}_decodeInFastDoing(t,e){this._todecode(t,e)}_decodeInFastEnding(t,e){}_getWillDecodeBuffer(){let t=this._getSamples(),e=t.length,i=0,s=0;return e>0&&(i=t[e-1].timeStamp,s=this._timeline.lastDts),i-s}_decodeInNormal(t,e){if(0===this.jitBuf)this._decode(t,e);else{let i=this._timeline.getDtsSlowTime(e.timeStamp,t);i>=500?(a.default.log("MediaDecodeHelper._decodeInNormal type=".concat(this._type," sample slow dtsSlowTime=").concat(i," dts=").concat(e.timeStamp," samples=").concat(this._getSamples().length)),this.setSlow(),this._timelineSlow.start(t,e.timeStamp),this._todecodeSlow(t,e)):0===this.jitBuf?this._decode(t,e):this._todecode(t,e)}}_decodeInSlow(t,e){let i=this._getSamples(),s=this._findNextSample(t,i);if(-1!==s){let e=i[s],r=i[0],o=i[i.length-1];e.timeStamp-r.timeStamp<1e3&&this._decodeAllSlowSamples(t,i,s),a.default.log("MedisDecodeHelper._decodeInSlow type=".concat(this._type," done cur=").concat(e.timeStamp," first=").concat(r.timeStamp," last=").concat(o.timeStamp," lateBuf=").concat(e.timeStamp-r.timeStamp," buffer=").concat(o.timeStamp-e.timeStamp)),this._setSamples(i.slice(s)),this.setNormal()}else this._todecodeSlow(t,e)}_decodeAllSlowSamples(t,e,i){}_findNextSample(t,e){let i=e.length;if(i>0)for(let s=0;s<i;s++){let i=e[s];if((this._type!==g.Types.VIDEO||i.isKeyFrame)&&!this._timeline.isDtsLess(t,i.timeStamp))return s}return-1}_findLastSample(t,e,i,s){let r=e.length;if(r>0){let a=e[r-1];for(let o=r-1;o>=0;o--){let r=e[o];if(this._type!==g.Types.VIDEO||r.isKeyFrame){let e=a.timeStamp-r.timeStamp;if(i<=e&&e<=s&&!this._timeline.isDtsLess(t,r.timeStamp))return o}}}return-1}_decodeInWaitKeyFrame(t,e){(0===this._waitKeyFramePostTs||t-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=t,a.default.postMessage(h.ToMainMessageType.WAIT_KEY_FRAME,t-this._waitKeyFrameTs))}_todecode(t,e){this._timeline.isDtsLess(t,e.timeStamp)&&this._decode(t,e)}_todecodeSlow(t,e){this._timelineSlow.isDtsLess(t,e.timeStamp)&&this._decode(t,e)}_decode(t,e){}_getSamples(){return[]}_setSamples(t){}}const S={FAST_DOING:1,FAST_ENDING:2,NORMAL:3,SLOW:4,WAIT_KEY_FRAME:5};g.Types={VIDEO:"video",AUDIO:"audio"};var y=g,T=class extends y{constructor(t){super(t)}_initType(){this._type=y.Types.VIDEO}_getSamples(){return this._decodeJitter.videoSamples}_setSamples(t){this._decodeJitter.videoSamples=t}_decodeInFastEnding(t,e){let i=this._getWillDecodeBuffer();i<=this.jitBuf?(this._todecode(t,e),this.setNormal(),a.default.log("MediaDecodeHelper._decodeInFastEnding type=".concat(this._type," fastEnding to normal buffer=").concat(i))):this._lookupBuffer(t,e,i)}_lookupBuffer(t,e,i){let s=this._getSamples(),r=this._findLastSample(t,s,this.jitMin,this.jitMax,!0);if(-1!==r){let e=s[r],o=s[s.length-1].timeStamp-e.timeStamp;if(o===this.jitBuf){let n=s[0];a.default.log("VideoDecodeHelper._lookupBuffer done firstDts=".concat(n.timeStamp," buffer=").concat(o)),this._setSamples(s.slice(r)),this._updateJump(t,n.timeStamp,e.timeStamp,i),this._decode(t,e)}else this._fixToJitBuf(t,s,r,i);this.setNormal()}else this._todecode(t,e)}_fixToJitBuf(t,e,i,s){let r=e.length,o=e[0],n=e[i],h=e[r-1],d=h.timeStamp,l=r-1;for(let s=i;s<r;s++){let i=e[s];if(0===this.jitBuf)this._decodeJitter._decodeVideoSample(i,t);else{if(h.timeStamp-i.timeStamp<=this.jitBuf){d=i.timeStamp,l=s;break}this._decodeJitter._decodeVideoSample(i,t)}}a.default.log("VideoDecoderHelper._fixToJitBuf fitBuf=".concat(d-n.timeStamp)),this._setSamples(0===this.jitBuf?[]:e.slice(l)),this._updateJump(t,o.timeStamp,d,s)}_updateJump(t,e,i,s){let r=i-e;this._timeline.setJumpTime(r),this._timeline.setLast(i,t),this._decodeHelper.onVideoJump(t,{jumpTime:r}),this._fastBuf=this._getWillDecodeBuffer(),a.default.log("VideoDecodeHelper._updateJump jumpTime=".concat(r," jumpStartDts=").concat(e," endDts=").concat(i," before=").concat(s," after=").concat(this._fastBuf))}_decodeAllSlowSamples(t,e,i){for(let s=0;s<i;s++){let i=e[s];this._decodeJitter._decodeVideoSample(i,t)}}_decodeInWaitKeyFrame(t,e){super._decodeInWaitKeyFrame(t,e);let i=this._getSamples();if(e.isKeyFrame)this.setNormal();else{let t=i.length,s=-1;for(let r=0;r<t;r++){let t=i[r];if(t.isKeyFrame){e=t,s=r;break}}-1!==s?(i=i.slice(s),this.setNormal()):(e=null,i=[]),this._setSamples(i)}}_decode(t,e){this._timeline.setLast(e.timeStamp,t),this._decodeJitter._decodeVideoSample(e,t),this._decodeJitter.videoSamples.shift()}},P=class extends y{constructor(t){super(t),this._jumpEndDts=0}_initType(){this._type=y.Types.AUDIO}_getSamples(){return this._decodeJitter.audioSamples}_setSamples(t){this._decodeJitter.audioSamples=t}setJump(t){this._timeline.setJumpTime(t),this._jumpEndDts=this._timeline.lastDts+t}_decodeInFastEnding(t,e){if(this._jumpEndDts>0){let t=this._getSamples(),e=t.length;if(e>0){let i=t[0],s=t[e-1],r=-1,o=null;for(let i=0;i<e;i++){let e=t[i];if(e.timeStamp>=this._jumpEndDts){r=i,o=e;break}}-1!==r&&(this._jumpEndDts=0,t=t.slice(r),a.default.log("AudioDecodeHelper._decodeInFastEnding done firstDts=".concat(i.timeStamp," endDts=").concat(o.timeStamp,"  lastDts=").concat(s.timeStamp," before=").concat(s.timeStamp-i.timeStamp," after=").concat(s.timeStamp-o.timeStamp," dropBuffer=").concat(o.timeStamp-i.timeStamp)),this._setSamples(t),this.setNormal())}}else this._todecode(t,e)}_decodeAllSlowSamples(t,e,i){for(let s=0;s<i;s++){let i=e[s];this._decodeJitter._decodeAudioSample(i,t)}}_decode(t,e){this._timeline.setLast(e.timeStamp,t),this._decodeJitter._decodeAudioSample(e,t),this._decodeJitter.audioSamples.shift()}};e.default=class{constructor(){this.videoDecoder=new u(this),this.audioDecoder=new p(this),this.videoRender=new class{constructor(t){this.player=t,this.videoGlWrap=null,this.framelist=[],this.currentDts=0,this.lastCurrentAudioDts=0,this.lastPic=null,this.lastRenderRafTime=0,this.lastRafNow=0,this.renderFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.throwFps=0,this.curBitrate=0,this.ageneratorWriter=null,this.isTriggerPlay=!1,this.renderedFrameTs=0,this.printCnt=0,this.fastPlayEndDts=0,this.fastPlay=!1,this.checkLatencyTs=0,this.latencyRenderCnt=0,this.lastRenderTs=0,this.lastRenderPts=0,this.renderSecFps=0,this.videoRender5SecFpsList=[],this.timeline=new m("video_render"),this.isBrowserHidden=!1,this.isPaused=!1,this.videoEnhance=new class{constructor(t){this.isUseEnhance=!1,this.aiEnhanceCfg=null,this.modelRes=null,this.isError=!1,this.isSuccess=!1,this.isInitSuccess=!1,this.segmentation=0,this.width=0,this.height=0,this.enhanceNums=0,this.lastEnhanceSecNums=0,this.videoRender=t,this.enhanceState=0,this.isUpdateVideoCfg=!1,this.costLargeCnt=0,this.enhanceCostList=[],this.enhanceLess30Nums=0,this.enhanceLess150Nums=0,this.enhanceLess200Nums=0,this.enhanceLarge200Nums=0,this.enhanceTotal=0,this.realFps=24,this.enhanceSecTs=0,this.modelHeight=0,this.playbackRate=1}resetState(){this.modelHeight=0,this.enhanceState=2,this.m_cEnhance&&this.m_cEnhance.release(),this.m_cEnhance=null}setRealFps(t){}initConfig(t){t&&(this.aiEnhanceCfg=t)}loadHatSdk(){if(!this.aiEnhanceCfg)return;if(5!=this.enhanceState&&0!=this.enhanceState)return;const t=this.aiEnhanceCfg,{modelRes:e,h5Root:i}=t;this.modelRes=e;const s=i+"hatsdk.min.js";a.default.log("VideoEnhance.initConfig",JSON.stringify(t),s),this.enhanceState=1,fetch(s).then(t=>t.text()).then(t=>{this.enhanceState=2,f(t),a.default.log("VideoEnhance.loadSuccess"),this.isUpdateVideoCfg&&this.init(this.width,this.height),self.hatsdk.setLogLevel(self.hatsdk.LoggerLevel.info),self.hatsdk.setLogCallback((function(t){a.default.log("hatSDKMsg",t)}))}).catch(t=>{console.error("VideoEnhance.loadError",t),this.handError(1)})}setEnhance(t){a.default.log("VideoEnhance.setEnhance",JSON.stringify(t));let e=t.data;this.isUseEnhance=!!e,this.isUseEnhance||(this.enhanceSecTs=0,this.isSuccess=!1,this.isError=!1),this.isUseEnhance&&(this.loadHatSdk(),4==this.enhanceState?this.handSuccess():5==this.enhanceState&&this.handError(3))}setSegmenttion(t){a.default.log("VideoEnhance.setSegmenttion",JSON.stringify(t));let e=t.data;this.segmentation=e}setPlaybackRate(t){a.default.log("VideoEnhance.setPlaybackRate,rate=".concat(t)),this.playbackRate=t}initCfg(t,e){this.width=t,this.height=e,this.isUpdateVideoCfg=!0,2==this.enhanceState&&this.init(this.width,this.height)}init(t,e){this.isUpdateVideoCfg&&2==this.enhanceState&&this.initMEnhance(e)}initMEnhance(t){if(!this.modelRes)return;let e=this.modelRes[t+"p"];e?(this.modelHeight=t,a.default.log("VideoEnhance.initMEnhance,modelHeight=".concat(this.modelHeight)),3!=this.enhanceState&&(self.hatsdk&&self.hatsdk.CEnhance?(this.enhanceState=3,this.m_cEnhance=new hatsdk.CEnhance,this.m_cEnhance.setEventCallback(this.enhanceEventHandle.bind(this)),this.m_cEnhance.init({modelUrl:e,isEncrypt:!0})):this.handError(3))):this.handError(2)}enhanceEventHandle(t,e){const i=e.status;switch(t){case 1:a.default.log("VideoEnhance callback MODEL_INIT_STATUS: "+i),0==i?this.enhanceState=4:1==i?(this.enhanceState=5,this.isUseEnhance&&this.handError(3)):2==i?this.isUseEnhance&&this.handError(13):3==i&&this.isUseEnhance&&this.handError(14);break;case 2:a.default.log("VideoEnhance callback WARMUP_STATUS: "+e.status);break;case 3:a.default.log("VideoEnhance callback UNKNOWN_ERROR: "+e.status);let t=9;0==i?t=9:1==i?t=10:2==i?t=11:3==i&&(t=12),this.isUseEnhance&&this.handError(t)}}async enhance(t){if(this.enhanceTotal++,this.videoRender.setEnhanceTotal(this.enhanceTotal),this.playbackRate>1)return t;if(!this.m_cEnhance)return t;if(!this.isUseEnhance||4!==this.enhanceState)return t;if(this.videoRender.isBrowserHidden&&this.isUseEnhance)return this.enhanceCostList.push(0),this.enhanceLess30Nums++,this.videoRender.setEnhanceLess30Nums(this.enhanceLess30Nums),this.enhanceFrame(),t;const e=a.default.getNow();let i=t.displayHeight;if(0!=this.modelHeight&&i!=this.modelHeight)return a.default.log("VideoEnhance.displayHeightChange, displayHeight=".concat(codedHeight,", modelHeight=").concat(this.modelHeight)),this.resetState(),this.initMEnhance(i),t;const s=await this.m_cEnhance.run({videoFrame:t,segMode:2,segmentation:this.segmentation}),r=a.default.getNow()-e;return r>=50&&this.costLargeCnt++,this.costLargeCnt>=3&&this.handError(5),0==s.result?(this.enhanceCostList.push(r),r<=30?(this.enhanceLess30Nums++,this.videoRender.setEnhanceLess30Nums(this.enhanceLess30Nums)):r<=150?(this.enhanceLess150Nums++,this.videoRender.setEnhanceLess150Nums(this.enhanceLess150Nums)):r<=200?(this.enhanceLess200Nums++,this.videoRender.setEnhanceLess200Nums(this.enhanceLess200Nums)):(this.enhanceLarge200Nums++,this.videoRender.setEnhanceLarge200Nums(this.enhanceLarge200Nums)),this.enhanceFrame(),t.close(),s.videoFrame):(this.handError(4),t)}handError(t){if(this.isSuccess=!1,this.isError)return;const e={type:t};this.isError=!0,a.default.log("VideoEnhance enhance fail"),a.default.postMessage(h.ToMainMessageType.VIDEO_ENHANCE_ERROR,e),this.m_cEnhance&&(this.m_cEnhance&&this.m_cEnhance.release(),this.m_cEnhance=null)}enhanceFrame(){0==this.enhanceSecTs&&(this.enhanceSecTs=a.default.getNow()),this.enhanceNums++,this.videoRender.setEnhanceNums(this.enhanceNums),this.handSuccess()}handSuccess(){this.isSuccess||(this.isSuccess=!0,a.default.log("VideoEnhance enhance success",this.isUseEnhance),a.default.postMessage(h.ToMainMessageType.VIDEO_ENHANCE_SUCCESS))}onCheckTimer(t){if(!this.isError&&this.videoRender&&this.videoRender.player&&this.isSuccess){const t=this.videoRender.player.pageFps;if(0==t)return;t<40?this.lowFpsCnt++:t>=55&&(this.lowFpsCnt=0),this.lowFpsCnt>=5&&(this.handError(6),this.lowFpsCnt=0)}}rafHandler(t){this.isError}handleEnhanceError(){this.handError(8)}getEnhanceCostList(){let[...t]=this.enhanceCostList;return this.enhanceCostList.length=0,t}getEnhanceSuccess(){return this.isSuccess}close(){this.isError=!1,this.isSuccess=!1,this.enhanceNums=0,this.isUpdateVideoCfg=!1,this.costLargeCnt=0,this.enhanceCostList.length=0,this.lowFpsCnt=0,this.enhanceLess30Nums=0,this.enhanceLess150Nums=0,this.enhanceLess200Nums=0,this.enhanceLarge200Nums=0,this.enhanceTotal=0,this.m_cEnhance&&(this.m_cEnhance.release(),this.m_cEnhance=null)}}(this),this.isSync=!0}setNotSync(){this.isSync=!1,this.lastPic&&(this.startRenderTs=a.default.getNow()-30,this.firstTimeStamp=this.lastPic.timeStamp-30)}start(t,e,i,s){this.ageneratorWriter=i.getWriter()}seek(t){this.renderedFrameTs=0,this.framelist.map(t=>{this.closeVideoFrameInfo(t),this.setVieoCurrentDts(t.timeStamp)}),this.setVieoCurrentDts(t),this.framelist.length=0,this.isSeek=!0}setPlaybackRate(t){this.videoEnhance.setPlaybackRate(t)}onVideoSeek(){this.isSeek=!1}updateAVCConfig(t,e){this.videoEnhance.initCfg(t,e)}setEnhance(t){this.videoEnhance.setEnhance(t)}setSegmenttion(t){this.videoEnhance.setSegmenttion(t)}setRealFps(t){this.videoEnhance.setRealFps(t)}async renderVideo(t,e){if(this.checkSkipFrame(e),0==this.framelist.length)return;let i=this.framelist[0],s=this.getAudioDts(t);if(this.getIsRender(s,i)){this.lastPic=i,this.renderFps++,this.setVieoCurrentDts(i.timeStamp);const t=i.timeStamp-this.renderedFrameTs;0!=this.renderedFrameTs&&t>500&&a.default.log("VideoRender.renderVideo dis large, dis=".concat(t)),this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_RENDER_NUMS,this.renderFps),this.lastRenderRafTime=e,this.framelist.shift();let s=i.frame;this.renderedFrameTs=i.timeStamp,this.player.avRenderSync.setRenderVideoTs(e),this.timeline.setLast(i.timeStamp,e),this.noVideoRender?s.close():(d.a.printTorenderVideo&&a.default.log("VideoRender.renderVideo timeStamp=".concat(i.timeStamp," ptsNow=").concat(this.timeline.getDtsNow(e)," frames=").concat(this.framelist.length)),s=await this.videoEnhance.enhance(s),this.latencyRenderCnt++,this.ageneratorWriter.write(s).then(()=>{s.close()}).catch(t=>{a.default.postMessage(h.ToMainMessageType.VIDEORENDERERROR),s.close()}),a.default.postMessage(h.ToMainMessageType.WebGLPLAY),this.checkPause(),this.isTriggerPlay||(this.startRenderTs=e,this.firstTimeStamp=i.timeStamp,this.isTriggerPlay=!0)),this.renderedFrameTs=i.timeStamp}}onCheckTimer(t){if(0!=this.renderSecFps){const t=this.renderFps-this.renderSecFps;this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(t)}this.renderSecFps=this.renderFps,this.videoEnhance.onCheckTimer(t)}checkPause(){if(this.player.userPaused)return;const t=this.getCurrentDts(),e=a.default.getNow();if(this.isBrowserHidden)this.isPaused&&(a.default.postMessage(h.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1);else if(0!=this.lastRenderPts&&0!=this.lastRenderTs){let i=t-this.lastRenderPts,s=e-this.lastRenderTs;const r=s-i,o=this.videoRender5SecFpsList.length;let n=!1;o>=5&&(n=this.videoRender5SecFpsList.reduce((t,e)=>t+e,0)/o<=10),s-i>200||i>300&&s>200?(a.default.log("VideoRender.mobPaused tsDelta:".concat(s," ptsDelta:").concat(i," delta:").concat(r)),a.default.postMessage(h.ToMainMessageType.SET_FRAME_PAUSE),this.isPaused=!0):this.isPaused&&(a.default.postMessage(h.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1),n&&a.default.postMessage(h.ToMainMessageType.RENDER_FPS_PAUSE)}this.lastRenderTs=e,this.lastRenderPts=t}getBufferLen(){return this.player.getBufferLen()}checkSkipFrame(t){let e=this.player.latencyCfg;if(e.latencyMode){let i=this.player.getBufferLen(),s=this.framelist.length;if(i>=e.latencyBuf&&s>0){if(0===this.checkLatencyTs)this.checkLatencyTs=t;else if(t-this.checkLatencyTs>2e3&&this.latencyRenderCnt%e.skipFrameGap==0){let i=this.framelist[0];this.timeline.isDtsLess(t,i.timeStamp)&&(d.a.printRenderSkipFrame&&a.default.log("VideoRender.checkLatencySkip skipFrameGap=".concat(e.skipFrameGap," renderCnt=").concat(this.latencyRenderCnt," frames=").concat(s," skipDts=").concat(i.timeStamp)),this.framelist.shift(),this.timeline.setJumpTime(i.timeStamp-this.timeline.lastDts+1,!1),i.frame.close())}}else this.checkLatencyTs=0}}setVieoCurrentDts(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_PTS,t),this.videoCurrentDts=t,this.player.decodeJitter.onRenderVideo(t)}getAudioCurrentDts(){return self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,_.e.AUDIO_DTS):0}rafHandler(t){let e=this.getAudioCurrentDts();this.curBitrate>=4e3&&this.throwFrame(e),this.renderVideo(e,t),this.lastRafNow=t,this.videoEnhance.rafHandler(t)}getRealFps(){return self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,_.a.VIDEO_REAL_FPS):0}getDecodedBuffer(){let t=this.getRenderBuffer();return this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_NOT_RENDERD_BUFFER,t),t}getRenderBuffer(){let t=0;return this.framelist.length>0&&(t=null==this.lastPic?0:this.framelist[this.framelist.length-1].timeStamp-this.lastPic.timeStamp),t}throwFrame(t,e){let i=!1;if(0!=this.framelist.length)for(;!i&&this.framelist.length>=2;){if(!(t-this.framelist[0].timeStamp>=200)){i=!0;break}{let t=this.framelist.shift();this.throwFps++,this.setVieoCurrentDts(t),this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_THROW_FRAME_FPS,this.throwFps),t.frame.close()}}}getAudioDts(t){if(!this.isSync)return 0;let e=a.default.getNow(),i=0;return 0!=this.lastRafNow&&(i=e-this.lastRafNow),0==t?this.currentDts=0:t!=this.lastCurrentAudioDts?this.currentDts=t:this.currentDts+=i,this.lastCurrentAudioDts=t,this.currentDts}setJump(t){this.timeline.setJumpTime(t)}getIsRender(t,e){let i=a.default.getNow(),s=!1;if(null==this.lastPic)s=!0,this.timeline.start(i,e.timeStamp);else if(this.player.latencyCfg.latencyMode)this.timeline.isDtsLess(i,e.timeStamp)&&(s=!0);else if(null!=this.lastPic&&0==t){let t=this.lastPic.timeStamp,r=e.timeStamp,a=i-this.startRenderTs,o=e.timeStamp-this.firstTimeStamp;a>=o?(s=!0,a-o>100&&(this.startRenderTs=i,this.firstTimeStamp=e.timeStamp)):r-t>100&&(s=!0,this.startRenderTs=i,this.firstTimeStamp=e.timeStamp)}else 0!=t&&t>=e.timeStamp?s=!0:0!=t&&e.timeStamp;return s}appendFrame(t){return this.isSeek?(this.closeVideoFrameInfo(t),this.setVieoCurrentDts(t.timeStamp),void(this.lastPic=null)):t.timeStamp<this.renderedFrameTs?(a.default.log("VideoRender.appendFrame, frame timeStamp too small and  drop frame,rendered frame ts="+this.renderedFrameTs+",now ts="+t.timeStamp),void this.closeVideoFrameInfo(t)):(this.framelist.push(t),void this.framelist.sort((t,e)=>t.timeStamp>e.timeStamp?1:-1))}updateCanvasRect(t,e){this.videoGlWrap.updateCanvasRect(t,e)}updateRect(t,e){this.videoGlWrap.updateRect(t,e)}getCurrentDts(){return this.videoCurrentDts}setNoRender(){a.default.log("VideoRender.setNoRender"),this.noVideoRender=!0}updateCurBitrate(t){this.curBitrate=t}closeVideoFrameInfo(t){t.frame.close(),t=null}setBrowserHidden(t){this.isBrowserHidden=t}initConfig(t){this.videoEnhance.initConfig(t)}setEnhanceNums(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_NUMS,t)}setEnhanceLess30Nums(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_LESS30_NUMS,t)}setEnhanceLess150Nums(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_LESS150_NUMS,t)}setEnhanceLess200Nums(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_LESS200_NUMS,t)}setEnhanceLarge200Nums(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_LARGE200_NUMS,t)}setEnhanceTotal(t){this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_ENHANCE_TOTAL,t)}getEnhanceCostList(){return this.videoEnhance.getEnhanceCostList()}getEnhanceSuccess(){return this.videoEnhance.getEnhanceSuccess()}handleEnhanceError(){this.videoEnhance.handleEnhanceError()}getVideoRenderPts(){return this.renderedFrameTs}setLastPic(t){this.lastPic=t}close(){this.currentDts=0,this.lastCurrentAudioDts=0,this.framelist.map(t=>{this.closeVideoFrameInfo(t)}),this.lastPic=null,this.lastRafNow=0,this.renderFps=0,this.throwFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.curBitrate=0,this.isTriggerPlay=!1,this.isBrowserHidden=!1,this.isPaused=!1,this.videoEnhance.close()}}(this),this.audioRender=new class{constructor(t){this.player=t,this.audioDuration=0,this.framelist=[],this.ageneratorWriter=null,this.frameDuration=23,this.audioSampleRate=44100,this.isTriggerPlay=!1,this.lastRenderStamp=0,this.lastRenderNow=0,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.totalLocalTime=0,this.decodeTotolTime=0,this.decodeTimeStamp=0,this.timeline=new m("audio_render")}setJump(t){this.timeline.setJumpTime(t)}start(t){this.ageneratorWriter=t.getWriter()}updateAACSampleRate(t){this.audioSampleRate=t,this.frameDuration=Math.floor(1024e3/t),a.default.log("AudioRender.updateAACSampleRate, frameDuration=",this.frameDuration)}onQuickCheckTimer(t){if(this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0&&this.framelist.length>0){let e=this.framelist[0];this.timeline.start(t,e.timeStamp),this.player.setRenderAudioTs(t,this.timeline),d.a.printTorenderAudio&&a.default.log("AudioRender.toRender timeline dts=".concat(e.timeStamp," dtsNow=").concat(this.timeline.getDtsNow(t))),this.timeline.isDtsLess(t,e.timeStamp)&&(this.timeline.setLast(e.timeStamp,t),this.framelist.shift(),a.default.postMessage(h.ToMainMessageType.AUDIO_FRAME_DECODED,e))}if(this.ageneratorWriter&&this.framelist.length>0){let e=this.framelist[0],i=e.frame;this.getIsRender(e,t)&&(this.render(i,t,e),this.framelist.shift(),this.renderNums++,this.setAudioRenderNums(),this.lastRenderStamp=e.timeStamp,this.lastRenderNow=t,this.lastFrame=e,this.setAudioCurrentDts(e.timeStamp))}}getIsRender(t){let e=a.default.getNow();if(null==this.lastFrame)return!0;{let i=e-this.lastRenderNow,s=t.timeStamp-this.lastFrame.timeStamp;if(e-this.startRenderTs>=t.timeStamp-this.firstTimeStamp)return!0;if(i>2*this.frameDuration&&s>2*this.frameDuration)return this.startRenderTs=e,this.firstTimeStamp=t.timeStamp,!0}}render(t,e,i){return this.audioDuration+=t.duration/1e3,this.ageneratorWriter.ready.then(()=>this.ageneratorWriter.write(t)).then(()=>{t.close(),this.isTriggerPlay||(this.isTriggerPlay=!0,a.default.postMessage(h.ToMainMessageType.AUDIO_PLAY),this.startRenderTs=e,this.firstTimeStamp=i.timeStamp)}).catch(e=>{console.error(e),t.close(),a.default.postMessage(h.ToMainMessageType.AUDIORENDERERROR)}),!0}setAudioCurrentDts(t){this.audioCurrentDts=t,this.player.storeWorkerShared(h.StoreWorkerType.AUDIO_DTS,this.audioCurrentDts)}getDecodedBuffer(){return 0!=this.decodeTimeStamp&&0!=this.audioCurrentDts?this.decodeTimeStamp-this.audioCurrentDts:0}setAudioRenderNums(){this.player.storeWorkerShared(h.StoreWorkerType.AUDIO_RENDER_NUMS,this.renderNums)}getAudioCurrentDts(){let t=self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,h.StoreWorkerType.AUDIO_DTS):0;return this.audioCurrentDts=t,this.audioCurrentDts}setLastAudioData(t){this.setAudioCurrentDts(t.timeStamp)}onFrameDecoded(t){this.decodeTimeStamp=t.timeStamp,this.ageneratorWriter?this.appendFrame(t):this.sentAudioFrameData(t)}sentAudioFrameData(t){if(-1==t.frame.format.indexOf("32"))return void a.default.postMessage(h.ToMainMessageType.AUDIO_FORMAT_ERROR);let e=t.frame.numberOfChannels,i=[];for(let s=0;s<e;s++){let e=t.frame.allocationSize({planeIndex:s});const r=new ArrayBuffer(e);t.frame.copyTo(r,{planeIndex:s}),i.push(r)}let s=t.frame.allocationSize({planeIndex:0});const r=new ArrayBuffer(s);t.frame.copyTo(r,{planeIndex:0});let o={timeStamp:t.timeStamp,frameBuffer:r,frameBuffers:i,isEmptyAudioFrame:t.isEmptyAudioFrame,format:t.frame.format};this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0?this.framelist.push(o):(d.a.printTorenderAudio&&a.default.log("AudioRender.toRender rightnow dts=".concat(o.timeStamp)),a.default.postMessage(h.ToMainMessageType.AUDIO_FRAME_DECODED,o))}appendFrame(t){this.framelist.push(t)}appendFrames(t){for(;t.length>0;)this.framelist.push(t.shift())}seek(t){this.audioCurrentDts=0,this.decodeTimeStamp=0,this.setAudioCurrentDts(t)}close(){this.framelist.length=0,this.isTriggerPlay=!1,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.decodeTimeStamp=0}}(this),this.decodeJitter=new class{constructor(t){this.player=t,this.videoSamples=[],this.audioSamples=[],this.audioFrameDecodedQueueLimit=10,this.lastDecodedVideoTimeStamp=0,this.lastToDecodAudioTimeStamp=0,this.lastJumpBufferAudioTimeStamp=0,this.videoFPS=0,this.noReferFps=0,this.discardVideoTSGap=60,this.decodeAudioQueueTime=1e3,this.decodeVideoQueueTime=100,this.discardFrameDecodeDelay=200,this.lastToDecodeTimeStamp=0,this.minBuffer=2e3,this.videoToDecodedLocalTime=0,this.firstVideoTs=0,this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.discardNums=0,this.lastVideoDiscardNums=0,this.JITTER_BUFLEN=0,this.JITTER_BUFMIN=0,this.JITTER_BUFMAX=0,this.jumpBufferCfg=[120,1e3,1e4,5e3,120,25],this.JUMP_BUFFER=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=1e3,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList=[],this.videoMaxCts=0,this.decodeVideoQueueTimeToCtsMaxGap=100,this.decodeVideoQueueTimeMax=350,this.outputFrameByPts=!1,this.decodeVideoQueueTimeDefault=100,this.lastVideoStamp=0,this.lastAudioStamp=0,this.recvMap=new Map,this.lastAppendVideoPts=0,this.firstVideoDts=0,this.fastDecodeTime=500,this.realFps=0,this.shieldAudioCfgBufLen=3e3,this.isRemuxBuf=!1,this.isRevFastOver=!1,this._helper=new class{constructor(t){this._decodeJitter=t,this._videoHelper=new T(this),this._audioHelper=new P(this),this._videoFastHelper=new class{constructor(t){this._decodeJitter=t,this._lastTodecodeDts=0,this._lastTodecodeTs=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}checkDecode(t,e,i){let s=this._decodeJitter.videoSamples;if(this._waitKeyFrameTs>0)this._waitForKeyFrame(t,s);else if(s.length>0){let r=s[0];(i<2||t-this._lastTodecodeTs>=r.timeStamp-this._lastTodecodeDts)&&(s.shift(),this._lastTodecodeDts=r.timeStamp,this._lastTodecodeTs=t,d.a.printVideoDecodeFast&&a.default.log("VideoDecodeFastHelper.checkDecode dts=".concat(r.timeStamp," samples=").concat(s.length," videoDecodedFrames=").concat(e," queueSize=").concat(i)),this._decodeJitter._decodeVideoSample(r,a.default.getNow()))}}_waitForKeyFrame(t,e){if((0===this._waitKeyFramePostTs||t-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=t,a.default.postMessage(h.ToMainMessageType.WAIT_KEY_FRAME,t-this._waitKeyFrameTs)),e.length>0){let t=e.length,i=-1;for(let s=0;s<t;s++)if(e[s].isKeyFrame){i=s;break}-1!==i?(e=e.slice(i),this._waitKeyFrameTs=0):e=[],this._decodeJitter.videoSamples=e}}setWaitKeyFrame(){a.default.log("VideoDecodeFastHelper.setWaitKeyFrame"),this._waitKeyFrameTs=a.default.getNow()}isWaitForKeyFrame(){return this._waitKeyFrameTs>0}}(t),this._audioFastHelper=new class{constructor(t){this._decodeJitter=t}checkDecode(t){let e=this._decodeJitter.audioSamples;if(e.length>0){let t=e.shift();this._decodeJitter._decodeAudioSample(t)}}}(t)}getDecodeJitter(){return this._decodeJitter}decodeLowlatency(t,e){let i=a.default.getNow();this._decodeJitter.player.latencyCfg.fastMode?(this._videoFastHelper.checkDecode(i,t,e),this._audioFastHelper.checkDecode(i)):(this._videoHelper.checkDecode(i),this._audioHelper.checkDecode(i))}onVideoJump(t,e){let{jumpTime:i}=e;this._audioHelper.setJump(i),this._decodeJitter.player.audioRender.setJump(i),this._decodeJitter.player.videoRender.setJump(i)}fastAccessOver(){a.default.log("DecodeHelper.fastAccessOver"),this._videoHelper.setFastEnding(),this._audioHelper.setFastEnding()}setNormal(){this._videoHelper.setNormal(),this._audioHelper.setNormal()}updateSoftAcceleration(){this._videoHelper.setWaitKeyFrame(),this._videoFastHelper.setWaitKeyFrame()}isWaitForKeyFrame(){return this._decodeJitter.player.latencyCfg.fastMode?this._videoFastHelper.isWaitForKeyFrame():this._videoHelper.isWaitForKeyFrame()}}(this),this.isLive=!0,this.seekVideoDts=0,this.isVideoSeek=!1,this.isAudioSeek=!1}fastOver(){this.player.latencyCfg.latencyMode&&this._helper.fastAccessOver()}onRevFastOver(){this.isRevFastOver=!0}seek(t,e){a.default.log("DecodeJitter.seek",t),this.isVideoSeek=!0,this.isAudioSeek=!0,this.seekVideoDts=e,this.audioSamples.length=0,this.videoSamples.length=0,this.firstVideoDts=0,this.isFirstAudioStamp=0,this.lastAppendVideoPts=0}onVideoSeek(){}onAudioSeek(){}setJitter(t){this.JITTER_BUFLEN=t.bufLen,this.JITTER_BUFMIN=t.bufMin,this.JITTER_BUFMAX=t.bufMax,this.jumpBufferCfg=t.jumpBufferCfg,this.shieldAudioCfgBufLen=t.shieldAudioCfgBufLen,this.isRemuxBuf=t.isRemuxBuf,a.default.log("WebCodecsWorkerPlayer.setJitter bufMin=".concat(t.bufMin," bufLen=").concat(t.bufLen," bufMax=").concat(t.bufMax," jumpBufferCfg=").concat(this.jumpBufferCfg.toString()," shieldAudioCfgBufLen=").concat(this.shieldAudioCfgBufLen," isRemuxBuf=").concat(this.isRemuxBuf))}setLive(t){this.isLive=t}setVideoOutputByPts(t){this.outputFrameByPts=t,this.outputFrameByPts&&(this.decodeVideoQueueTime=this.decodeVideoQueueTimeDefault)}updateVideoCts(t){!this.outputFrameByPts&&t>this.videoMaxCts&&(this.videoMaxCts=t,this.decodeVideoQueueTime=Math.max(this.decodeVideoQueueTime,this.videoMaxCts+this.decodeVideoQueueTimeToCtsMaxGap),this.decodeVideoQueueTime=Math.min(this.decodeVideoQueueTime,this.decodeVideoQueueTimeMax),a.default.log("WebCodecsWorkerPlayer.updateVideoCts videoMaxCts=".concat(this.videoMaxCts," decodeAudioQueueTime=").concat(this.decodeVideoQueueTime," ")))}setStartPlayTime(t){this.startPlayTime=t}setPlayMinBuffer(t){this.minBuffer=t}decodeThread(t,e,i,s){if(this.player.latencyCfg.latencyMode)return void this._helper.decodeLowlatency(this.player.videoRender.framelist.length,s);let r=a.default.getNow(),o=this.player.audioDecoderReadyed&&!this.isAudioSeek,n=this.audioSamples.length>0,d=!this.isPauseAudioDecode,l=t<this.decodeAudioQueueTime;const c=Atomics.load(self.mainSharedArrayBuffer,h.StoreWorkerType.AUDIO_RENDER_NUMS),u=~~(Atomics.load(self.mainSharedArrayBuffer,h.StoreWorkerType.AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES)*this.player.getAacTimeLen());c>0&&!this.isLive&&(l=l||u<this.decodeAudioQueueTime),this.player.getAudioCurrentDts(),o&&l&&n&&d&&this.decodeAudioSamples(),this.isVideoSeek||(this.newDiscardVideoFrame(),this.player.videoDecoderReadyed&&this.videoSamples.length>0&&!this.isPauseVideoDecode&&(this.decodeVideoSamples(e,r,i,s),this.jumpBuffers(r)))}onCheckTimer(){this.checkTurnToSoft()}checkTurnToSoft(){if(this._helper.isWaitForKeyFrame())return;let t=5;this.isLive||(t=20);let e=this.player.delayDecode;if(this.decode10SecCostList.length>=t&&this.decode10SecCostList.shift(),this.decode10SecCostList.push(e),this.decode10SecCostList.length<t)return;let i=!0;this.decode10SecCostList.forEach(t=>{t<2e3&&(i=!1)}),this.player.getEnhanceSuccess()?i&&(this.player.handleEnhanceError(),this.decode10SecCostList.length=0):this.isSoftWebcodecs?i&&this.player.turnToMse():i&&this.player.turnToWebcodecsSoft()}decodeAudioSamples(){let t=this.audioSamples.shift();t.timeStamp&&(this.lastToDecodAudioTimeStamp=t.timeStamp,this._decodeAudioSample(t))}_decodeAudioSample(t){this.player.toDecodeFrame(t)}decodeVideoSamples(t,e,i,s){const r=this.decodeVideoQueueTime;this.lastToDecodAudioTimeStamp,this.player.getVideoCurrentDts();this.player.getAudioCurrentDts();let a=0;if(this.realFps>0&&(a=Math.floor(1e3/this.realFps)),t<r&&(s<2||(0!=a&&e-this.videoToDecodedTime)>=a)){let t=this.videoSamples.shift();this._decodeVideoSample(t,e)}}_decodeVideoSample(t,e){this.lastToDecodeTimeStamp=t.timeStamp,this.player.toDecodeFrame(t),0==this.videoToDecodedLocalTime&&(this.videoToDecodedLocalTime=e),this.videoToDecodedTime=e}updateAACSampleRate(t){this.audioSampleRate=t,this.frameDuration=1024e3/t,this.audioFrameDecodedQueueLimit=Math.ceil(this.decodeAudioQueueTime/this.frameDuration)}getBufferLength(t){if(this.isRemuxBuf&&self.mainSharedArrayBuffer)return Atomics.load(self.mainSharedArrayBuffer,h.MainSharedBufferType.LAST_VIDEO_RCV_TS)-t;if(this.isLive){if(this.lastAppendVideoPts>0&&t>0)return this.lastAppendVideoPts-t}else if(this.lastAppendVideoPts>0)return this.lastAppendVideoPts-t;return 0}getWillDecodeVBuf(){return 0==this.videoSamples.length?0:1==this.videoSamples.length?33:this.videoSamples.length>1?this.videoSamples[this.videoSamples.length-1].timeStamp-this.videoSamples[0].timeStamp:0}getAudioBufferLength(t){return 0==t?this.audioSamples.length>1?this.videoSamples[this.audioSamples.length-1].timeStamp-this.audioSamples[0].timeStamp:0:this.audioSamples.length>0?this.audioSamples[this.audioSamples.length-1].timeStamp-t:0}jumpBuffers(t){if(!this.isLive)return;const e=this.player.getVideoCurrentDts();let i=t,s=this.getBufferLength(e),r=s-this.JITTER_BUFLEN,a=!1;self.mainSharedArrayBuffer&&(a=1==Atomics.load(self.mainSharedArrayBuffer,h.MainSharedBufferType.IS_SHIELD_AUDIO));const o=this.jumpBufferCfg[1],n=this.jumpBufferCfg[3],d=1e3*this.jumpBufferCfg[4],l=1e3*this.jumpBufferCfg[5];if(a){let t=(self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,h.MainSharedBufferType.FRAME_BUFFER_LEN):0)+s;const e=this.JITTER_BUFLEN+this.shieldAudioCfgBufLen,i=this.JITTER_BUFLEN;if(r=t-e,r<=0)return;if(s-r<i&&(r=s-i),r<0)return}if(!(i-this.startPlayTime<n))if(this.isStartBuffer)r>=o&&(this.isRevFastOver||i-this.startPlayTime>=l)&&this.setJumpBuffer(r,s,1,e,t,a)&&(this.isStartBuffer=!1);else if(i-this.setVideoCurrentTime>=d||0==this.setVideoCurrentTime){if(i-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime&&this.setJumpBuffer(r,s,2,e,t,a))return void(this.startMoreBufferTime=0);r>=o?0==this.startMoreBufferTime&&(this.startMoreBufferTime=i):this.startMoreBufferTime=0}}setJumpBuffer(t,e,i,s,r,o){let n=!1;if(self.mainSharedArrayBuffer&&(n=1==Atomics.load(self.mainSharedArrayBuffer,h.MainSharedBufferType.BROWSER_PAUSE_STATUS)),0==this.videoSamples.length)return!1;if(0==this.audioSamples.length&&!n)return;const d=this.videoSamples.length,l=this.player.getVideoDecodedBuffer(),c=this.player.getVideoDecodingBuffer();let u=0,p=0,m=0,_=0,f=this.videoSamples[0].timeStamp;if(n)m=0;else if(this.videoSamples[0].timeStamp<this.audioSamples[0].timeStamp){for(let t=0;t<d;t++)if(this.videoSamples[t].timeStamp>=this.audioSamples[0].timeStamp){f=this.videoSamples[t].timeStamp,m=t;break}}else m=0;let g=f+t,S=0,y=0;for(let e=d-1;e>=0;e--){let i=this.videoSamples[e].timeStamp;if(this.videoSamples[e].isKeyFrame){const s=i-f;if(s-t<100&&s-t>=-100){_=e;break}}}if(-1==m)return;if(m>=0&&_>m&&(f=this.videoSamples[m].timeStamp,g=this.videoSamples[_].timeStamp),n){if(_-m<1)return!1;this.videoSamples.splice(m,_-m)}else{for(let t=0;t<this.audioSamples.length;t++)if(-1==u&&this.audioSamples[t].timeStamp>=f&&(0==t||this.audioSamples[t-1].timeStamp<f)&&(u=t),this.audioSamples[t].timeStamp>g){p=t;break}if(u>=0&&p>u&&(S=this.audioSamples[u].timeStamp,y=this.audioSamples[p].timeStamp),p-u<1||_-m<1)return!1;this.videoSamples.splice(m,_-m),this.audioSamples.splice(u,p-u)}let T="WebCodecs.DecodeJitter.setJumpBuffer,type=".concat(i,",isRemuxBuf=").concat(this.isRemuxBuf,",");return T+="bufLen=".concat(e,",decodedBuf=").concat(l,",decodingBuf=").concat(c,","),T+="aStartI=".concat(u,",aEndI=").concat(p,",vStartI=").concat(m,",vEndI=").concat(_,","),T+="currentTime=".concat(s,",aDrop=").concat(p-u,",vDrop=").concat(_-m,",'jumpABuflen'=").concat(y-S,",'jumpVbufLen'=").concat(g-f,",isShieldAudio=").concat(o),a.default.log(T),this.setVideoCurrentTime=a.default.getNow(),!0}discardDeltaVideoFrame(){if(!this.isEnableDiscard)return;if(0==this.videoSamples.length)return;let t=this.player.getVideoCurrentDts(),e=this.player.getAudioCurrentDts(),i=this.getBufferLength(t),s=e-t;if(i<=1e3)return!1;let r=this.videoSamples[0],o=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps;if(0==o)return!1;let n=~~(1e3/o*3);n<=50&&(n=50);let d=0;return!(s<=100||(s<=200?(d=1,this.discardVideoTSGap=6*n):s<=500?(d=2,this.discardVideoTSGap=4*n):s<=1e3?(d=3,this.discardVideoTSGap=2*n):(d=4,this.discardVideoTSGap=n),!r.discardAllow||r.timeStamp-this.lastDiscardFrameTimeStamp<this.discardVideoTSGap||(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),a.default.log("WebCodecs.DecodeJitter.discardDeltaVideoFrame discardNums=".concat(this.discardNums," dropLevel=").concat(d,", bufLen=").concat(i,", delta=").concat(s)),0)))}newDiscardVideoFrame(){return!!this.isEnableDiscard&&0!=this.videoSamples.length&&void(this.discardFrameByPending()||this.discardDeltaVideoFrame()||this.discardFrameByDecodeRate())}discardFrameByPending(){const t=a.default.getNow();if(0!=this.setVideoCurrentTime&&t-this.setVideoCurrentTime<1e3*this.jumpBufferCfg[0])return!1;const e=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,i=this.player.delayDecode,s=Number(e)*Number(i);if(0===e||0===i)return!1;const r=this.videoSamples[0],o=this.player.getVideoCurrentDts(),n=this.getWillDecodeVBuf(o),d=this.player.webcodecCfg;let l=2e3,c=1e4,u=2e4;d&&d[5]&&d[5].length>=3&&(l=d[5][0],c=d[5][1],u=d[5][2]);let p=this.player.getAudioCurrentDts()-o;if(p<100)return;const m=this.player.webcodecCfg[4]||1500;let _=!1,f=0;if(n>=l&&n<=c)n-l>=Math.random()*l&&r.discardAllow&&s>=m&&(_=!0,f=1);else if(n>c&&n<=u)s>=m&&r.discardAllow&&(_=!0,f=2);else if(n>u&&s>=m)return f=3,this.discardPendingIframe(f,n,p),!0;let g=~~(1e3/e*3);return g<=50&&(g=50),!(r.timeStamp-this.lastDiscardFrameTimeStamp<g)&&(_&&(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),a.default.log("WebCodecs.DecodeJitter.discardFrameByPending discardNums=".concat(this.discardNums," dropLevel=").concat(f,", bufLen=").concat(n))),_)}discardFrameByDecodeRate(){let t=this.player.getVideoCurrentDts(),e=!1;if(this.player.getAudioCurrentDts()-t<100)return;const i=this.videoSamples[0];if(!i.discardAllow)return e;const s=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,r=this.player.delayDecode;if(this.noReferFps<=0||s<=0||r<=0)return e;const o=Number(s)*Number(r),n=Number(this.noReferFps)*Number(r),d=(this.videoFPS-1e3/r)/this.noReferFps,l=this.player.webcodecCfg[4]||1500;let c=0;o>=l&&(o<n+l?100*d>=100*Math.random()&&(e=!0,c=1):(e=!0,c=2));let u=~~(1e3/s*3);return u<=50&&(u=50),!(i.timeStamp-this.lastDiscardFrameTimeStamp<u)&&(e&&(this.lastDiscardFrameTimeStamp=i.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(h.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),a.default.log("WebCodecs.DecodeJitter.discardFrameByDecodeRate discardNums=".concat(this.discardNums," dropLevel=").concat(c))),e)}discardPendingIframe(t,e,i){if(i<3e3)return;let s=this.videoSamples,r=s.length;if(r<=0)return;let o=-1,n=-1;for(let t=0;t<r;t++){const e=s[t];if(-1!=o&&e.isKeyFrame){n=t-1;break}e.isKeyFrame&&(o=t+1)}o>=0&&n>=0&&o<n&&(this.videoSamples.splice(o,n-o),this.discardNums+=n-o,a.default.log("WebCodecs.DecodeJitter.discardFrameByPending discard=".concat(n-o,",start=").concat(o,",end=").concat(n,",dropLevel=").concat(t,",bufLen=").concat(e,"}")))}addRecv(t,e){let i=t+e;i>this.lastAppendVideoPts&&(this.lastAppendVideoPts=i)}onRenderVideo(t){}appendAudioFrame(t){for(;t.length>0;){let e=t.shift();0==this.isFirstAudioStamp&&(this.isFirstAudioStamp=e.timeStamp),this.isAudioSeek&&e.timeStamp>=this.seekVideoDts&&(a.default.log("DecodeJitter.audioSeek recover!"),this.isAudioSeek=!1),this.checkAvDiff(this.lastVideoStamp,e.timeStamp),d.a.printAppendAudio&&a.default.log("DecodeJitter.appendAudioFrame dts=".concat(e.timeStamp," samples=").concat(this.audioSamples.length)),this.audioSamples.push(e),this.player.latencyCfg.latencyMode||this.player.audioDecoderReadyed&&(0!=this.isFirstAudioStamp&&e.timeStamp-this.isFirstAudioStamp<=500||this.isAudioSeek)&&this.decodeAudioSamples()}}appendVideoFrame(t){for(;t.length>0;){let e=t.shift();0===this.firstVideoDts&&(this.firstVideoDts=e.timeStamp),this.checkAvDiff(e.timeStamp,this.lastAudioStamp),this.addRecv(e.timeStamp,e.compositionTime),d.a.printAppendVideo&&a.default.log("DecodeJitter.appendVideoFrame dts=".concat(e.timeStamp," samples=").concat(this.videoSamples.length)),this.isVideoSeek&&e.timeStamp>=this.seekVideoDts&&(a.default.log("DecodeJitter.videoSeek recover!"),this.isVideoSeek=!1),this.videoSamples.push(e),this.player.latencyCfg.latencyMode||(this.player.isVodAv1?this.player.videoDecoderReadyed&&(e.timeStamp-this.firstVideoDts<this.fastDecodeTime||this.isVideoSeek)&&this.decodeVideoSamples(0,a.default.getNow(),0,0):(e.timeStamp-this.firstVideoDts<this.fastDecodeTime||this.isVideoSeek)&&this.decodeVideoSamples(0,a.default.getNow(),0,0))}}checkAvDiff(t,e){if(this.isLive&&this.player.dtsJumpOpen){if(this.player.videoRender.isSync&&t>0&&e>0){let i=t>e?t-e:e-t;i>this.player.dtsJumpThreshold&&(this.player.videoRender.setNotSync(),a.default.log("DecodeJitter.checkAvDiff diff=".concat(i)))}this.lastVideoStamp=t,this.lastAudioStamp=e}}updateVideoDecodedTimeStamp(t){this.lastDecodedVideoTimeStamp=t}updateVideoFPS(t,e){this.videoFPS=t,this.noReferFps=e}close(){this.player=null,this.videoSamples.length=0,this.videoSamples=null,this.audioSamples.length=0,this.lastAppendVideoPts=0,this.recvMap.clear(),this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.firstVideoDts=0,this.discardNums=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList.length=0,this.isRevFastOver=!1}checkAVSync(){if(a.default.getNow()-this.startPlayTime<startCD)return;let t=this.player.getVideoCurrentDts(),e=this.player.getAudioCurrentDts();if(t<=0||e<=0)return;let i=e-t;i>=1e3&&i>=0||i<0&&i<=-1e3&&this.checkDiscardAudio(e,t)}checkDiscardAudio(t,e){let i=this.getAudioBufferLength(t),s=i-this.JITTER_BUFLEN;if(a.default.log("DecodeJitter.checkDiscardAudio, bufLen=".concat(i,", audioCurrentDts=").concat(t,", videoCurrentDts=").concat(e,", minusBuffer=").concat(s,", delta=").concat(t-e)),i<=this.JITTER_BUFLEN)return;if(this.audioSamples.length<=1)return;let r=this.audioSamples[0].timeStamp;if(0==e||e<r)return;let o=r,n=0;for(;this.audioSamples.length>0;){let t=this.audioSamples[0];if(!(t.timeStamp<e&&t.timeStamp-o<=s))break;this.audioSamples.shift(),n=t.timeStamp}n>0&&a.default.log("DecodeJitter.checkDiscardAudio, startTs=".concat(o,", endTs=").concat(n,", discardBuffer=").concat(n-o))}checkDiscardVideo(t,e){let i=this.getBufferLength(e),s=i-this.JITTER_BUFLEN;if(a.default.log("DecodeJitter.checkDiscardVideo, bufLen=".concat(i,", audioCurrentDts=").concat(t,", videoCurrentDts=").concat(e,", minusBuffer=").concat(s,", delta=").concat(t-e)),i<=this.JITTER_BUFLEN)return;let r=this.videoSamples.length;if(r<=1)return;let o=this.videoSamples[0].timeStamp;if(0==t||t<o)return;let n=o,h=0;for(let e=0;e<r;e++){let i=this.videoSamples[e];if(!(i.timeStamp<t&&i.timeStamp-n<=s))break;i.discardAllow&&(this.videoSamples.shift(),h=i.timeStamp,r--)}h>0&&a.default.log("DecodeJitter.checkDiscardVideo, startTs=".concat(n,", endTs=").concat(h,", discardBuffer=").concat(h-n))}setPauseVideoDecode(t){this.isPauseVideoDecode=t.isPause}setPauseAudioDecode(t){this.isPauseAudioDecode=t.isPause}setEnableDiscard(t){this.isEnableDiscard=t.enableDiscard}setUseSoftAcceleration(){this.isSoftWebcodecs=!0}updateSoftAcceleration(){this.decode10SecCostList=[],this._helper.updateSoftAcceleration()}getVideoDiscardNums(){let t=this.discardNums-this.lastVideoDiscardNums;return this.lastVideoDiscardNums=this.discardNums,t}setRealFps(t){this.realFps=t}}(this),this.audioDecodedFrames=[],this.audioRenderStarted=!1,this.audioStartRenderFrameTimeLen=500,this.oneSecNow=0,this.fastCheckNow=0,this.frameDuration=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,this.quickTimerInterval=null,this.onQuickCheckTimerBind=this.onQuickCheckTimer.bind(this),this.videoFrameStampMap=new Map,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.webcodecCfg={},this.latencyCfg=new class{constructor(){this.openRenderSync=!1,this.latencyBuf=2500,this.latencyMin=3e3,this.latencyMax=3500,this.skipFrameGap=5,this.isNoGop=!1,this.fastMode=!1,this.latencyMode=!1}initConfig(t){this.latencyMode=!1,t&&(t.hasOwnProperty("openRenderSync")&&(this.openRenderSync=t.openRenderSync),t.hasOwnProperty("lowlatencyBuf")&&(this.latencyBuf=t.lowlatencyBuf,this.latencyMode=-1!==this.latencyBuf),t.hasOwnProperty("lowlatencyMin")&&(this.latencyMin=t.lowlatencyMin),t.hasOwnProperty("lowlatencyMax")&&(this.latencyMax=t.lowlatencyMax),t.hasOwnProperty("isNoGop")&&(this.isNoGop=t.isNoGop),t.hasOwnProperty("fastMode")&&(this.fastMode=t.fastMode),t.hasOwnProperty("skipFrameGap")&&(this.skipFrameGap=t.skipFrameGap))}},this.videoDecodeCostErrCnt=0,this.printCnt=0,this.avRenderSync=new class{constructor(){this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1,this._openSync=!1}reset(){this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1}set openSync(t){this._openSync=t}setRenderVideoTs(t){0===this._firstVideoRenderTs&&(this._firstVideoRenderTs=t)}setRenderAudioTs(t,e,i){if(0===this._firstAudioRenderTs&&(this._firstAudioRenderTs=t),this._openSync&&!this._syncDone&&this._firstAudioRenderTs>0&&this._firstVideoRenderTs>0&&this._firstVideoPts>0&&this._firstAudioPts>0){this._syncDone=!0;let t=this._firstVideoPts-this._firstAudioPts;a.default.log("AVRenderSync.syncAudio render done delta=".concat(t)),e.setJumpTime(t),i.setJumpTime(t)}}setVideoPts(t){0===this._firstVideoPts&&(this._firstVideoPts=t)}setAudioPts(t){0===this._firstAudioPts&&(this._firstAudioPts=t)}},this.isBrowserHidden=!1,this.renderNum=0,this.lastTs=0,this.pageFps=0,this.lowFpsCnt=0,this.dtsJumpOpen=!1,this.dtsJumpThreshold=1e4,this.seekTime=0,this.seekVideoDts=0,this.isSeek=!1,this.isAudioSeek=!1,this.firstVideoTs=-1e4,this.firstAudioTs=-1e4,this.seekAudioSamples=[],this.isVodAv1=!1}get audioDecoderReadyed(){return this.audioDecoder&&this.audioDecoder.configured}get videoDecoderReadyed(){return this.videoDecoder&&this.videoDecoder.configured}setVideoOutputByPts(t){this.decodeJitter.setVideoOutputByPts(t)}initWebcodecCfg(t){const{webcodecCfg:e,lowlatencyCfg:i,aiEnhanceCfg:s,isLive:r}=t;e&&(this.webcodecCfg=e),this.decodeJitter.setLive(r),this.latencyCfg.initConfig(i),this.avRenderSync.openSync=this.latencyCfg.openRenderSync,0===this.latencyCfg.latencyBuf&&this.decodeJitter._helper.setNormal(),this.dtsJumpOpen=!!t.dtsJumpOpen,this.dtsJumpThreshold=t.dtsJumpThreshold||1e4,this.videoRender.initConfig(s)}startVideoRender(t,e){const{width:i,height:s,agenerator:r}=t;let o=a.default.getNow();this.videoRender.start(i,s,r,e),clearInterval(this.quickTimerInterval),this.quickTimerInterval=setInterval(this.onQuickCheckTimerBind,4),this.decodeJitter.setStartPlayTime(o)}startAudioRender(t){this.audioRender.start(t)}onQuickCheckTimer(){a.default.postMessage(h.ToMainMessageType.INTERVAL);let t=!1;self.mainSharedArrayBuffer&&(t=1==Atomics.load(self.mainSharedArrayBuffer,_.a.PAUSE_STATUS),this.userPaused=t);let e=a.default.getNow();if(!this.userPaused){let t=this.getAudioDecodedBuffer(),i=this.videoRender.getDecodedBuffer(),s=this.getVideoCurrentDts();this.decodeJitter.decodeThread(t,i,s,this.videoDecoder.decoder.decodeQueueSize),this.audioRender.onQuickCheckTimer(e),this.videoRender.rafHandler(e)}0===this.oneSecNow?this.oneSecNow=e:e-this.oneSecNow>=1e3&&(this.onCheckTimer(e),this.oneSecNow=e),0===this.fastCheckNow?this.fastCheckNow=e:e-this.fastCheckNow>=100&&(this.onCheckFastTimer(e),this.fastCheckNow=e),this.storeWorkerShared(h.StoreWorkerType.VIDEO_BUFFER_LEN,this.getBufferLen())}rafHandler(t){if(this.renderNum++,0===this.lastTs)this.lastTs=t;else{let e=t-this.lastTs;if(e>=1e3){this.lastTs=t;let i=Math.floor(this.renderNum/(e/1e3));this.pageFps=i,this.renderNum=0}}}onCheckTimer(t){if(this.decodeJitter.onCheckTimer(t),a.default.logArr.length>0&&(a.default.postMessage(h.ToMainMessageType.LOG,a.default.logArr),a.default.logArr.length=0),this.statEverySec(t),self.mainSharedArrayBuffer){let t=Atomics.load(self.mainSharedArrayBuffer,_.a.VIDEO_REAL_FPS);this.decodeJitter.setRealFps(t),Atomics.store(self.mainSharedArrayBuffer,_.e.VIDEO_DECODED_DELAY_SMOOTH,this.videoDecoder.smoothFrameDecodeDelay)}this.videoRender.onCheckTimer(t)}onCheckFastTimer(t){this.decodeJitter&&this.decodeJitter.onCheckFastTimer&&this.decodeJitter.onCheckFastTimer(t)}getAudioDecodedBuffer(){return this.audioRender.getDecodedBuffer()}getVideoDecodedBuffer(){return this.videoRender.getDecodedBuffer()}getVideoDecodingBuffer(){return this.videoDecoder.getDecodingBuffer()}statEverySec(){let t=this.videoDecoder.getDecodeDelay(),e=0,i=0,s=-1;t.map(t=>{e+=t}),e>0&&(i=~~(e/t.length),s=i),this.delayDecode=i,s>-1&&s<15?this.videoDecodeCostErrCnt++:this.videoDecodeCostErrCnt=0;let r=this.videoDecoder.getDecodeFps();this.toDecodeVideoFps=r.toDecodeFps,this.storeWorkerShared(h.StoreWorkerType.VIDEO_DECODED_DELAY,i),this.storeWorkerShared(h.StoreWorkerType.VIDEO_READY_TO_RENDER_LIST_LEN,this.videoRender.framelist.length),this.videoDecodeCostErrCnt,this.videoDecoder.isOutputFrameByDts()&&"265"==this.videoDecoder.codecType&&this.handlerError(h.ToMainMessageType.DECODE_DTS);let a=this.videoRender.getEnhanceCostList(),o=0,n=0;a.map(t=>{o+=t}),o>0&&(n=~~(o/a.length)),this.storeWorkerShared(h.StoreWorkerType.VIDEO_ENAHNCE_COST,n)}storeWorkerShared(t,e){self.mainSharedArrayBuffer&&Atomics.store(self.mainSharedArrayBuffer,t,e)}updateRect(t,e){this.videoRender.updateRect(t,e)}updateAVCConfig(t){this.videoRender.updateAVCConfig(t.width,t.height)}updateAudioConfig(t,e,i,s){this.audioDecoder.updateAudioConfig(t,e,i,s),this.decodeJitter.updateAACSampleRate(e),this.audioRender.updateAACSampleRate(e),this.updateAACSampleRate(e)}updateAVCPPS(t,e){}updateAVCSPS(t,e){}updateAVCVPS(t,e){}toDecodeFrame(t){t.type==n.AUIDO?(this.avRenderSync.setAudioPts(t.timeStamp),this.lastToDecodeAudioTs=t.timeStamp,this.audioDecoder.decodeFrame(t)):t.type==n.VIDEO&&(this.avRenderSync.setVideoPts(t.timeStamp+t.compositionTime||0),this.lastToDecodeVideoTs=t.timeStamp,this.toDecodeVideoFrameNums++,this.videoDecoder.decodeFrame(t))}onFrameDecoded(t){const e=this.seekVideoDts;if(t.type==r.VIDEO){this.decodedVideoFrameNums++,this.decodeJitter.updateVideoDecodedTimeStamp(t.frame.timestamp),0==this.firstPerformentTime&&(this.firstPerformentTime=a.default.getNow()),t.noRenderCount=0;let i=t.timeStamp,s=this.videoFrameStampMap.get(i);void 0!==s&&(t.timeStamp+=s,this.videoFrameStampMap.delete(i)),this.isSeek?t.timeStamp-e>=0?(this.onVideoSeek(),this.videoRender.appendFrame(t)):(this.videoRender.setLastPic(t),t.frame.close()):this.videoRender.appendFrame(t)}else t.type==r.AUIDO&&(this.isAudioSeek?t.timeStamp-e>=0?(this.onAudioSeek(),this.seekAudioSamples.push(t)):(t.frame.close(),this.audioRender.setLastAudioData(t),t=null):this.isSeek?this.seekAudioSamples.push(t):this.audioRender.onFrameDecoded(t))}setRenderAudioTs(t,e){this.avRenderSync.setRenderAudioTs(t,e,this.decodeJitter._helper._audioHelper._timeline)}appendAudioFrame(t){0==this.startAppendAudioTime&&(this.startAppendAudioTime=a.default.getNow()),-1e4==this.firstAudioTs&&t.length>0&&(this.firstAudioTs=t[0].timeStamp),this.decodeJitter.appendAudioFrame(t)}appendVideoFrame(t){-1e4==this.firstVideoTs&&t.length>0&&(this.firstVideoTs=t[0].timeStamp),t.map(t=>{this.videoFrameStampMap.set(t.timeStamp,t.compositionTime),this.decodeJitter.updateVideoCts(t.compositionTime)}),this.decodeJitter.appendVideoFrame(t)}fastOver(){this.decodeJitter.fastOver()}updateAACSampleRate(t){this.frameDuration=1024e3/t}updateVideoFPS(t,e){this.decodeJitter.updateVideoFPS(t,e)}setPlayMinBuffer(t){this.decodeJitter.updateVideoFPS(t)}setJitter(t){this.decodeJitter.setJitter(t)}handlerError(t,e){a.default.postMessage(t,e)}getBufferLen(){return this.decodeJitter?this.decodeJitter.getBufferLength(this.videoRender.getCurrentDts()):0}getAudioCurrentDts(){return this.audioRender.getAudioCurrentDts()}getVideoCurrentDts(){return this.videoRender.getCurrentDts()}setUseSoftAcceleration(){a.default.log("WebCodecsWorkerPlayer.setUseSoftAcceleration"),this.videoDecoder.setUseSoftAcceleration(),this.decodeJitter.setUseSoftAcceleration()}updateSoftAcceleration(){a.default.log("WebCodecsWorkerPlayer.updateSoftAcceleration"),this.setUseSoftAcceleration(),this.videoDecoder.resetDecoder(),this.decodeJitter.updateSoftAcceleration()}setLocalConfig(t){1==t._webcodecsNoRenderVideo&&this.videoRender.setNoRender(),1==t._useSoftAcceleration&&this.setUseSoftAcceleration()}setPauseVideoDecode(t){this.decodeJitter.setPauseVideoDecode(t)}setPauseAudioDecode(t){this.decodeJitter.setPauseAudioDecode(t)}setEnableDiscard(t){this.decodeJitter.setEnableDiscard(t)}turnToWebcodecsSoft(){this.videoRender&&this.videoRender.videoEnhance.isSuccess||("265"==this.videoDecoder.codecType?a.default.postMessage(h.ToMainMessageType.SOFT_TURN_TO_MSE):a.default.postMessage(h.ToMainMessageType.TURN_TO_WEBCODECS_SOFT))}turnToMse(){this.videoRender&&this.videoRender.videoEnhance.isSuccess||a.default.postMessage(h.ToMainMessageType.SOFT_TURN_TO_MSE)}updateCurBitrate(t){this.videoRender.updateCurBitrate(t)}setRealFps(t){this.decodeJitter.setRealFps(t),this.videoRender.setRealFps(t)}setBrowserHidden(t){this.isBrowserHidden=t,this.videoRender.setBrowserHidden(t)}setEnhance(t){this.videoRender.setEnhance(t)}setSegmenttion(t){this.videoRender.setSegmenttion(t)}getEnhanceSuccess(){return this.videoRender.getEnhanceSuccess()}handleEnhanceError(){this.videoRender.handleEnhanceError()}onRevFastOver(){this.decodeJitter.onRevFastOver()}initAv1Seg(t){this.videoDecoder.initAv1Seg(t)}seek(t){this.isSeek=!0,this.isAudioSeek=!0,this.seekTime=t.seekTime,this.seekVideoDts=1e3*t.seekTime+t.initDts;const e=this.videoRender.getVideoRenderPts();e>this.seekVideoDts&&(this.isSeekBack=!0),0!=e&&(this.videoDecoder.seek(),this.audioDecoder.seek()),a.default.log("WebCodecsWorkerPlayer.seek",this.seekTime,this.seekVideoDts,this.isSeekBack),this.decodeJitter.seek(this.seekTime,this.seekVideoDts),this.videoRender.seek(this.seekVideoDts),this.audioRender.seek(this.seekVideoDts)}setPlaybackRate(t){this.videoRender.setPlaybackRate(t)}setVodAv1(){this.isVodAv1=!0}onVideoSeek(){a.default.log("WebCodecsWorkerPlayer.onVideoSeek, aLen=".concat(this.seekAudioSamples.length)),a.default.postMessage(h.ToMainMessageType.ON_WCS_VIDEO_SEEK,this.seekTime),this.seekTime=0,this.seekAudioSamples.forEach(t=>{this.audioRender.onFrameDecoded(t)}),this.seekAudioSamples.length=0,this.decodeJitter.onVideoSeek(),this.videoRender.onVideoSeek(),this.isSeek=!1,this.seekVideoDts=0,this.isSeekBack=!1,this.seekTime=0}onAudioSeek(){a.default.log("WebCodecsWorkerPlayer.onAudioSeek"),this.isAudioSeek=!1,this.decodeJitter.onAudioSeek()}getAacTimeLen(){return this.audioDecoder.getAacTimeLen()}destroy(){a.default.log("WebCodecsWorkerPlayer.destroy"),this.destroyed=!0,this.videoDecoder.close(),this.videoDecoder=null,this.audioDecoder.close(),this.audioDecoder=null,this.decodeJitter.close(),this.decodeJitter=null,this.videoRender.close(),this.videoRender=null,this.startAudioFastTs=0,this.startVideoFastTs=0,this.oneSecNow=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,clearInterval(this.quickTimerInterval),this.quickTimerInterval=null,this.videoFrameStampMap=null,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.isBrowserHidden=!1,this.pageFps=0,this.renderNum=0,this.lastTs=0}}}]).default}))},otlt:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(t,e,i,s,r){var a=e.split("\n"),o=Math.max(s-3,0),n=Math.min(a.length,s+3),h=r(i),d=a.slice(o,n).map((function(t,e){var i=e+o+1;return(i==s?" >> ":"    ")+i+"| "+t})).join("\n");throw t.path=h,t.message=(h||"ejs")+":"+s+"\n"+d+"\n\n"+t.message,t},escapeFn=escapeFn||function(t){return null==t?"":String(t).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(t){return _ENCODE_HTML_RULES[t]||t}var __line=1,__lines='<div id="pre-ab-video-container"></div>\n<div class="pre-ab-text">\n    <div class="pre-ab-live-wrap">\n        <div class="icon"></div>\n        <span> 直播中</span>\n    </div>\n    <div class="time ellipsis">5s后自动进入直播间</div>\n</div>\n',__filename="vsrc/small-video.ejs";try{var __output="";function __append(t){null!=t&&(__output+=t)}with(locals||{})__append('<div id="pre-ab-video-container"></div>\n<div class="pre-ab-text">\n    <div class="pre-ab-live-wrap">\n        <div class="icon"></div>\n        <span> 直播中</span>\n    </div>\n    <div class="time ellipsis">5s后自动进入直播间</div>\n</div>\n'),__line=9;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},xUJ5:function(t,e,i){"use strict";i.r(e);var s=/\s+/;function r(){}r.prototype.on=function(t,e,i){var r,a;if(!e)return this;for(r=this.__events||(this.__events={}),t=t.split(s);a=t.shift();)(r[a]||(r[a]=[])).push(e,i);return this},r.prototype.once=function(t,e,i){var s=this;return this.on(t,(function r(){s.off(t,r),e.apply(i||s,arguments)}),i)},r.prototype.off=function(t,e,i){var r,o,n,h;if(!(r=this.__events))return this;if(!(t||e||i))return delete this.__events,this;for(t=t?t.split(s):a(r);o=t.shift();)if(n=r[o])if(e||i)for(h=n.length-2;h>=0;h-=2)e&&n[h]!==e||i&&n[h+1]!==i||n.splice(h,2);else delete r[o];return this},r.prototype.trigger=function(t){var e,i,r,a,n,h,d=[],l=!0;if(!(e=this.__events))return this;for(t=t.split(s),n=1,h=arguments.length;n<h;n++)d[n-1]=arguments[n];for(;i=t.shift();)(r=e.all)&&(r=r.slice()),(a=e[i])&&(a=a.slice()),"all"!==i&&(l=o(a,d,this)&&l),l=o(r,[i].concat(d),this)&&l;return l},r.prototype.emit=r.prototype.trigger;var a=Object.keys;function o(t,e,i){var s=!0;if(t){var r=0,a=t.length,o=e[0],n=e[1],h=e[2];switch(e.length){case 0:for(;r<a;r+=2)s=!1!==t[r].call(t[r+1]||i)&&s;break;case 1:for(;r<a;r+=2)s=!1!==t[r].call(t[r+1]||i,o)&&s;break;case 2:for(;r<a;r+=2)s=!1!==t[r].call(t[r+1]||i,o,n)&&s;break;case 3:for(;r<a;r+=2)s=!1!==t[r].call(t[r+1]||i,o,n,h)&&s;break;default:for(;r<a;r+=2)s=!1!==t[r].apply(t[r+1]||i,e)&&s}}return s}a||(a=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}),r.mixTo=function(t){var e;e=t,t="[object Function]"===Object.prototype.toString.call(e)?t.prototype:t;var i=r.prototype,s=new r;!function(t,e){if(t.forEach)return t.forEach(e);for(var i=0,s=t.length;i<s;i+=1)e(t[i],i,t)}(Object.keys(i),(function(e){t[e]=function(){return i[e].apply(s,Array.prototype.slice.call(arguments)),this}}))};var n=r,h={};!function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},r={};if(s.browser){r[s.browser]=!0;var a=s.majorVersion.split(".");r.version={major:parseInt(s.majorVersion,10),string:s.version},a.length>1&&(r.version.minor=parseInt(a[1],10)),a.length>2&&(r.version.build=parseInt(a[2],10))}if(s.platform&&(r[s.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;s.browser="msie",r.msie=!0}if(r.edge){delete r.edge;s.browser="msedge",r.msedge=!0}if(r.opr){s.browser="opera",r.opera=!0}if(r.safari&&r.android){s.browser="android",r.android=!0}for(var o in r.name=s.browser,r.platform=s.platform,h)h.hasOwnProperty(o)&&delete h[o];Object.assign(h,r)}();var d=h,l={getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(e))return a.substr(e.length)}return""},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},unescapeHTML:function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},padNum:function(t,e){var i=t.toString().length;return"0".repeat(e-i)+t},getDateTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,s=(i=t?new Date(t):new Date).getFullYear(),r=l.padNum(i.getMonth()+1,2),a=l.padNum(i.getDate(),2),o=l.padNum(i.getHours(),2),n=l.padNum(i.getMinutes(),2),h=l.padNum(i.getSeconds(),2),d="".concat(s,"-").concat(r,"-").concat(a," ").concat(o,":").concat(n,":").concat(h);if(e){var c=l.padNum(i.getMilliseconds(),3);d+="."+c}return d},generateUUID:function(t,e){var i,s,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(e=e||r.length,t)for(i=0;i<t;i++)a[i]=r[0|Math.random()*e];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;i<36;i++)a[i]||(s=0|16*Math.random(),a[i]=r[19==i?3&s|8:s]);return a.join("")},hasJQuery:function(){return"undefined"!=typeof $},isFunction:function(t){return"function"==typeof t}},c=l;var u=1==localStorage.log?0:4,p=!0;//!!Number(localStorage._printLogTime);
function m(){return c.getDateTimeStr()+""}var _={_data:[],_length:0,_printAudioFrame:!!Number(localStorage._printAudioFrame),_printVideoFrame:!!Number(localStorage._printVideoFrame),getLogTimeState:function(){return p},setLogTimeState:function(t){p!=!!t&&(_.log("setLogTimeState to "+!!t),p=!!t)},debug:function(){var t=m(),e=Array.apply(null,arguments);u<=-1&&(p&&(e[0]=t+" "+e[0]),console.log.apply(console,e))},log:function(){var t;u<=0&&(t=console).info.apply(t,arguments)},info:function(t){m();var e=Array.apply(null,arguments);u<=1&&console.info.apply(console,e)},warn:function(t){var e=m(),i=Array.apply(null,arguments);u<=2&&(p&&(i[0]=e+" "+i[0]),console.warn.apply(console,i)),_.record(e,i,"warn")},error:function(t){var e=m(),i=Array.apply(null,arguments);u<=3&&(p&&(i[0]=e+" "+i[0]),console.error.apply(console,i)),_.record(e,i,"error")},group:function(t){var e=m(),i=Array.apply(null,arguments);if(u<=1){p&&(i[0]=e+" "+i[0]);var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}_.record(e,i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=u&&(console.log(m()+" set log level from "+u+" to "+t),u=t)},getLevel:function(){return u},record:function(t,e,i){},getLog:function(){return _._data.unshift(d.platform+" "+d.name+" "+d.version.string),_._data}},f=_;var g=new function(){var t=[],e={},i={},s="player",r="ext",a=200;function o(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];f.log.apply(f,e),y.h5Log.length>a&&(y.h5Log=y.h5Log.slice(10));var r=e.map((function(t){return JSON.stringify(t)})).join(", ");r=(new Date).toLocaleString()+"  "+r;var o=n(s);o?o.$$feedbackLimitModule.push(r):h(s,r),y.h5Log.push(r)}function n(t){return i[t]}function h(t,i){null==e[t]&&(e[t]=[]),e[t].push(i)}this.addLog=o,this.log=o,this.addExtLog=function(e){localStorage.extLog&&console.log(e);var i=n(r);i?i.$$feedbackLimitModule.push(e):h(r,e),t.push(e),t.length>300&&(t=t.slice(10))},this.getExtLog=function(){return t},this.feedbackSdkReady=function(){i[s]=y.feedbackSdk.setFbModule(s,a),i[r]=y.feedbackSdk.setFbModule(r,a),function(){for(var t in e){var i=n(t);if(i&&i.$$feedbackLimitModule)for(var s in e[t])i.$$feedbackLimitModule.push(e[t][s])}}(),i[s].livingInfo=JSON.stringify(y.livingInfo)}},S={ENV:null,vplayer:null,vplayerUI:null,logUtils:g,Event:v,menuItems:[],menuData:[[{text:"虎牙直播(H5)_2509100944"}],[],[{text:"查看视频信息",func:function(){v.fireEvent(v.SHOW_VIDEO_INFO)}},{text:"视频问题反馈",func:function(){S.vplayerUI.showFeedback()}}]],streamSetFlag:!1,sdkCommonAb:""},y=S;function T(t,e){if(!t)return!1;for(var i=t.split(","),s=i.length,r=0;r<s;r++)if(i[r]==e)return!0;return!1}S.menuItems=[],S.beginTime=Date.now(),S.serverTimeGap=0,S.getServerTime=function(){return Date.now()+S.serverTimeGap},S.yyuid=parseInt(c.getCookie("yyuid"))||parseInt(c.getCookie("udb_uid"))||0,S.isLogin=S.yyuid>0,S.anonymousUid=0,S.setAnonymousUid=function(){S.isLogin||(S.anonymousUid=localStorage.anonymousUid?parseInt(localStorage.anonymousUid):c.generateUUID(13,10))},S.setAnonymousUid(),S.resetLoginStatus=function(){S.yyuid=0,S.setAnonymousUid(),S.userId&&(S.userId.lUid=0)},S.appid=0,S.topsid=0,S.subsid=0,S.gameId=0,S.roomId=0,S.mute=0,S.adBlock="1"==localStorage.adBlock?1:0,S.vAppid=66,S.vAppidTest=67,S.videoLine=-1,S.flacFlv="",S.livingInfoRecorded=null,S.wsurl="",S.wsconnected=!1,S.badWsIps=[],S.badCode=[],S.badReason="",S.loginRegister=!1,S.userIn=!1,S.tafInited=!1,S.wsConnectTime=0,S.loginRegisterTime=0,S.userInTime=0,S.livingInfoTime=0,S.firstVideoTime=0,S.userId=null,S.presenterUid=0,S.hasVideo=!1,S.hasVideoPlay=function(){return S.isMakeFriend?!0===S.hasMFVideo:S.hasVideo},S.isPlaying=!1,S.isPause=!1,S.isUIPause=!1,S.isEndLive=!1,S.is360Video=!1,S.lLiveCompatibleFlag=0,S.isVideoMaster=function(){return""!=S.yyuid&&0!=S.yyuid&&0!=S.presenterUid&&S.yyuid==S.presenterUid},S.isPresenter=!1,S.livingInfo=null,S.streamInfo=null,S.iFrameRate=0,S.feedbackSdk=null,S.isH265=!1,S.isSupportedHevc=!0,S.isCanvasRender=!1,S.mMiscInfo={},S.SrcBitRate=0,S.curBitRate=0,S.hasAutoBitrate=!1,S.isAutoBitrate=!1,S.autoCurBitrate=-1,S.pullStreamFrom=0,S.getCurBitRate=function(){return S.curBitRate},S.isH265CodecType=function(t){return 1==t||4==t||6==t||8==t},S.fakeHDRBitrate=0,S.getTrueBitRate=function(){if(S.fakeHDRBitrate>0)return S.fakeHDRBitrate;var t=S.getCurBitRate();return S.isAutoBitrate&&S.autoCurBitrate>=0&&(t=S.autoCurBitrate),0==t&&(t=S.SrcBitRate),t},S.bitRateList1=[],S.getBitRateList=function(){return S.bitRateList1},S.getBitRateData=function(){for(var t in S.bitRateList1)if(S.curBitRate==S.bitRateList1[t].iBitRate)return S.bitRateList1[t];return null},S.targetBitrate=-1,S.H5ROOT="//a.msstatic.com/huya/h5player/room/2509100944/",function(){for(var t=document.scripts,e=0,i=t.length;e<i;e++){var s=t[e].src,r=s.match(/\/vplayer.*?\.js/);if(r){S.H5ROOT=s.substring(0,r.index+1);break}}}(),S.propData={},S.newPropDict={},S.curShowPropData=[],S.extPropData=[],S.userInfo=null,S.isUserInfoInited=function(){return null!=S.userInfo},S.getUserName=function(){return S.userInfo&&S.userInfo.sPassport||c.getCookie("username")},S.getNickName=function(){return S.userInfo&&S.userInfo.sNick||""},S.encryptIps=localStorage.wssips,S.isFullSize=!1,S.isFullscreen=!1,S.screenStatus=1,S.isShowDanmu=!0,S.isLoginTipShow=!1,S.ctrlIsShow=!1,S.isFromApp=!1,S.isYanzhi=!1,S.isPeiWan=!1,S.isParty=!1,S.isMobileStarShow=!1,S.isMakeFriend=!1,S.makeFriendData=[],S.subscribedCount=0,S.appSrc="HUYA&ZH&2052",S.videoTimeData=null,S.curSendGiftData=null,S.curSeriesGiftType=0,S.isAllSendGift=!1,S.currentAllSendGiftId=0,S.onceLimitGreenBean=0,S.allGiftShowNum=8,S.iAttendeeCount=0,S.useHttps=!0,S.isReplay=!1,S.lGroupId=0,S.lGroupType=0,S.isCFMiNi=!1,S.h5Log=[],S.iCdnPolicyLevel=0,S.specialGameId=[2135,2333,2356,2408,2409],S.useP2p=!0,S.isShowPresentRecommend=!1,S.isFirstVideoPlay=!1,S.isMaxDanmu=!1,S.ishowRecommend=!1,S.flvTokenList=[],S.volume=0,S.isP2pPlayIng=!1,S.questionBannerIdArr=[253,7],S.liveid="0",S.sSchedule="",S.sDescription="",S.extTafFunName={},S.extTafUri={},S.extVideoPlay=!1,S.extBarrageTags=[],S.extSeiPortMap={},S.isGodLiePlay=!1,S.accMasterData=null,S.isOBWatch=!1,S.isOBRoom=!1,S.obPerspectiveList=[],S.obCurrentPerspective={},S.videoPos={},S.videoOffset={width:0,height:0,left:0,top:0},S.obCurPid=0,S.obStatus=1,S.VideoState={state:1004},S.rewardAdStatus=0,S.vrSwitch=!0,S.extStreamVR=!1,S.vrNoStream=!1,S.matchReplayStatus=0,S.matchReplayUrl="",S.matchReplaySeekTime=0,S.matchReplayCdnName="",S.matchReplayStream=[],S.sShieldStream=null,S.isStartShield=!1,S.commentorIdList=[],S.matchTeamAudioH5Player=null,S.matchTeamAudioPlay=!1,S.matchTeamVideoStreamName="",S.matchTeamAudioStreamName="",S.currentPlayStreamName="",S.popupPosition=0,S.isDebug=function(){var t=window.location.host.split(".")[0];return"test"==t||"local"==t||"test-www"==t||"testws"==t||"www-webtest"==t},S.isPre=function(){return"www-pre"==window.location.host.split(".")[0]},S.isHttps=function(){return!S.isDebug()},S.baseinfo="",S.visibilityState="visible",S.lXid=0,S.isShieldingEffect=!1,S.isManager=!1,S.bDirector=!1,S.isOpenFlac=!1,S.flacSwitch=!0,S.freezeLevel=0,S.isCheckDefBit=!1,S.paymentStatus=0,S.isPip=!1,S.roomFeatures=null,S.uiActivated=!0,S.giftEffectEnable=!0,S.danmuGroudId=[],S.hasDanmuMask=!1,S.dropDanmuOpen=!0,S.dropDanmuCount=0,S.danmuShowCount=0,S.danmuWaitCount=0,S.videoBadQualityCount=0,S.isFilterDanmu=function(){return!!window.filterDanmuRatio&&window.filterDanmuRatio>Math.random()},S.verifyCookiePass=!0,S.yaInit=!1,S.followList=null,S.calljsCache=[],S.uiIsInited=!1,S.hasMFVideo=!1,S.useCdnAll=!1,S.hasVirtualPk=!1,S.isSuperFans=!1,S.curSendUid=0,S.superFanstime="",S.isForeign=!1,S.isCopyright=!1,S.isSecret=!1,S.password="",S.mountsList=[],S.from="",S.turnToFlv=!1,S.noLineInLive=!1,S.isWebrtcSupport=!0,S.isLowPerformance=!1,S.onlyLine4=!1,S.huyaLineList=[],S.getHuyaLineInfo=function(){var t=0,e=[];if(0==S.huyaLineList.length)return null;for(var i in S.huyaLineList){var s=S.huyaLineList[i];t+=s.iWebPriorityRate,e.push({rate:s.iWebPriorityRate,info:s})}for(var r=0,a=Math.random(),o=0,n=e.length;o<n;o++){var h=e[o];if(a<=(r+=h.rate/t))return h.info}return S.huyaLineList[Math.floor(Math.random()*S.huyaLineList.length)]},S.spliteSceenType=0,S.splitScreenId=0,S.doubleScreenStatus=0,S.splitScreenVideoContainer=null,S.guid=0,S.getGuid=function(){return S.guid||c.getCookie("guid")||""},S.isHuyaLine=function(t){return t.toUpperCase().indexOf("HUYA")>=0},S.judgPlayerData=function(t,e,i){return e[t]?1==e[t]||0!=e[t]&&i:i},S.playerConfig={},S.openMFVideo=!0,S.isLowLatency=!1,S.renderMode=1,S.obConfig={},S.hlsLivePid=!1,S.gzip=0,S.gzipExp=0,S.setPlayerConfig=function(){try{var t=S.ENV.conf.playerConfig;if(t=c.unescapeHTML(t),S.playerConfig=JSON.parse(t),S.openMFVideo=!("0"==S.playerConfig.openMFVideo),S.isLowLatency=T(S.playerConfig.lowLatencyPid,S.presenterUid)||T(S.playerConfig.lowLatencyGameId,S.gameId),S.obConfig=S.playerConfig.ob||{},S.hlsLivePid=T(S.playerConfig.hlsLivePid,S.presenterUid),S.danmuMaskOpen=!("0"==S.playerConfig.danmuMaskOpen),S.playerConfig&&S.playerConfig.gzipExp){var e=S.playerConfig.gzipExp;e?(S.gzip=Math.random()<Number(e)/100?0:1,0==S.gzip&&(S.gzipExp=1)):S.gzip=1}else S.gzip=1}catch(t){console.log("playerConfig error")}},S.sdkExtendConfig={},S._sdkExtendConfig={},S.p2pLineClose=[],S.danmuMask=!0,S.videoDns=!0,S.danmuP2P=!0,S.danmuMaskbroadcastGroup="",S.setConfigData=function(){var t=S.ENV,e={};try{e=t.conf.playerdata,e=c.unescapeHTML(e),S._sdkExtendConfig.sdk=JSON.parse(e).sdk,e=JSON.parse(e)}catch(t){console.log("playerdata error")}S.useHttps=S.judgPlayerData("usehttps",e,S.useHttps),S.flacSwitch=S.judgPlayerData("flacSwitch",e,S.flacSwitch),S.danmuMask=S.judgPlayerData("danmuMask",e,S.danmuMask),S.videoDns=S.judgPlayerData("videoDns",e,S.videoDns),S.danmuP2P=S.judgPlayerData("danmuP2P",e,S.danmuP2P),S.sdkExtendConfig.sdk=e.sdk;var i=e.p2pLineClose;i&&(S.p2pLineClose=i.split(","))},S.abConfig=null,S.aBTestShieldBitrate=-1,S.aBTestDefaultBitrate=-1,S.mpExperiment="",S.enableTrace=0,S.hasPreAd=!1,S.preAdStatus=0,S.preADPlayingFlag=!1,S.setABTestConfig=function(){var t=localStorage.abConfig;if(t)try{var e=(t=JSON.parse(t)).mpConfig;if(e&&e.webDefaultBitRate>0&&(S.aBTestDefaultBitrate=parseInt(e.webDefaultBitRate)),e&&e.delBitrate>0&&(S.aBTestShieldBitrate=parseInt(e.delBitrate)),S.abConfig=t,S.mpExperiment=t.mpExperiment||"",e.hasOwnProperty("trace.enableTrace"))S.enableTrace=e["trace.enableTrace"];else{var i=Math.random()<.1;S.enableTrace=i?1:0}}catch(t){console.log("abtest设置错误",t)}},S.getVRType=function(){var t=S.lLiveCompatibleFlag;return 1==(1&t)||128==(128&t)?2==(2&t)||256==(256&t)?6:4==(4&t)||512==(512&t)?5:4:1024==(1024&t)||64==(64&t)?2==(2&t)||256==(256&t)?3:4==(4&t)||512==(512&t)?2:1:4},S.isHDR=function(t){return 8192==(8192&t)},S.isFakeHDR=function(t){return 16384==(16384&t)},S.makeHttpsUrl=function(t){return t=t.replace("http://","https://")},S.getTraceId=function(){return"xxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},S.getVideoUrlByRoomId=function(t){return S.isDebug()?"https://test-www.huya.com/".concat(t):"https://www.huya.com/".concat(t)},S.browerPause=!1,S.browerAutoPlayFail=!1,S.isSupportWebp=!0;var P={addEvent:function(t,e){y.vplayer.on(t,e)},removeEvent:function(t,e){y.vplayer.off(t,e)},fireEvent:function(t,e){y.vplayer.trigger(t,e)},WEBSOCKET_INITED:"WEBSOCKET_INITED",VIDEO_FIRST_PLAY:"VIDEO_FIRST_PLAY",PLAYER_UI_INITED:"PLAYER_UI_INITED",USER_INFO_INITED:"USER_INFO_INITED",USER_INFO_INITED_DELAY:"USER_INFO_INITED_DELAY",VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PLAY_NEW:"VIDEO_PLAY_NEW",VIDEO_STOP:"VIDEO_STOP",DYNAMIC_LOGIN:"DYNAMIC_LOGIN",CHANGE_TO_FLASH:"CHANGE_TO_FLASH",SHOW_BITRATE_TIP:"SHOW_BITRATE_TIP",FUllSCREEN_CHANGE:"FUllSCREEN_CHANGE",FUll_OR_WEBFULL_SCREEN_CHANGE:"FUll_OR_WEBFULL_SCREEN_CHANGE",NEW_VIDEO:"NEW_VIDEO",SHOW_VIDEO_INFO:"SHOW_VIDEO_INFO",SHOW_MARQUEE:"SHOW_MARQUEE",ATTENDEE_COUNT_CHANGE:"ATTENDEE_COUNT_CHANGE",REPlAY_START_PLAY:"REPlAY_START_PLAY",PlAY_CHANNEl:"PlAY_CHANNEl",GET_GAMELIVE_HISUPON_REQ:"GET_GAMELIVE_HISUPON_REQ",PAUSE_VIDEO:"PAUSE_VIDEO",REFRESH_VISUALANGLE:"REFRESH_VISUALANGLE",SHOW_VR_UI:"SHOW_VR_UI",HIDE_VR_UI:"HIDE_VR_UI",SHOW_RECOMMEND:"SHOW_RECOMMEND",HIDE_RECOMMEND:"HIDE_RECOMMEND",SHOW_FORBID_RECOMMEND:"SHOW_FORBID_RECOMMEND",VOLUME_CHANGE:"VOLUME_CHANGE",AUTO_FEEDBACK:"AUTO_FEEDBACK",DATA_METRIC_SDK:"DATA_METRIC_SDK",DATA_METRIC_SIGNAL_P2P:"DATA_METRIC_SIGNAL_P2P",DATA_METRIC2:"DATA_METRIC2",DATA_METRIC_NO_COMMON_DIM:"DATA_METRIC_NO_COMMON_DIM",DATA_METRIC_AD:"DATA_METRIC_AD",DATA_METRIC_TEAM_VOICE:"DATA_METRIC_TEAM_VOICE",GIVE_GIFT:"giveGift",TONGJI_READY:"tongjiReady",PLAYER_FLOAT:"playerFloat",QUIT_FULL_SCREEN:"quitFullScreen",QUIT_FULL_MODE:"quitFullMode",MSG_SHIELD_CFG:"msgShieldCfg",BLOCK_WORDS_UPDATE:"blockWordsUpdate",SUBSCRIBE_STATUS_CHANGE:"subscribeStatusChangeToPlayer",SHIPIN_PLAY:"shipinPlay",SHIPIN_PAUSE:"shipinPause",CLEAR_DELIVERY_TIP:"clearDeliveryTips",SEND_METRIC:"sendMetric",PAYMENT_WATCH_STATUS_CHANGE:"paymentWatchStatusChange",SET_EMOTICON_DATA:"setEmoticonData",FOLLOW_LIST_READY:"followListReady",GET_FACE_DIRECTOR_ELM:"getFaceDirectorElm",FEEDBACK_SDK_READY:"feedbackSdkReady",OPEN_DIY_ACTIVITY_BY_ID:"openDIYActivityById",OPEN_NATIVE_URL:"openNativeUrl",ADD_DIY_ICON:"addDiyIcon",SHOW_GIFT_TIP:"showGiftTip",SHOW_DIY_BADGE:"showDiyBadge",DEL_DIY_ICON:"delDiyIcon",EXT_FEEDBACK:"extFeedBack",EXT_PLAYVIDEO:"playVideo",EXT_RESUMELIVE:"resumeLive",SEND_GIFT_EXT:"sendGiftExt",SET_DISPLAY_BARRAGE_TAGS:"setDisplayBarrageTags",DOUBLE_TAPPED:"doubleTapped",SET_PERSPECTIVE:"setPerspective",EXT_TRIGGER_VIDEO_CLICK:"EXT_TRIGGER_VIDEO_CLICK",EXT_HOVER:"EXT_HOVER",EXT_WS_CONNECT:"EXT_WS_CONNECT",EXT_WS_SEND:"EXT_WS_SEND",EXT_WS_CLOSE:"EXT_WS_CLOSE",SHOW_FEEDBACK_BY_EXT:"SHOW_FEEDBACK_BY_EXT",PLAY_AGAIN:"PLAY_AGAIN",SWITCH_LINE:"SWITCH_LINE",UPDATE_BTNS_VISIBLE:"updateBtnsVisible",CLEAR_PLAYER_EFFECT:"clearPlayerEffect",GET_FLAC_TOKEN:"GET_FLAC_TOKEN",SHOW_BROWER_PAUSE_TIPS:"SHOW_BROWER_PAUSE_TIPS",SET_SEI:"SET_SEI",LINK_MIC_STATE_CHANGE:"LINK_MIC_STATE_CHANGE",SHOW_COMMON_TOAST:"SHOW_COMMON_TOAST",SHOW_COMMON_TOAST_TOP:"SHOW_COMMON_TOAST_TOP",HLS_FIRST_PLAY:"HLS_FIRST_PLAY",FORENOTICE_UPDATE:"FORENOTICE_UPDATE",MAKE_FRIEND_AUDIO_SOUND:"MAKE_FRIEND_AUDIO_SOUND",TAF_SUCCESS_REPORT:"TAF_SUCCESS_REPORT",ACTIVITY_ICON_COUNT_UPDATE:"ACTIVITY_ICON_COUNT_UPDATE",SEND_CARDPACKAGE_ITEMRSP:"SEND_CARDPACKAGE_ITEMRSP",ENTER_PIP:"ENTER_PIP",CF_MINI_JUMP:"CF_MINI_JUMP",MAKEFIREND_TEMPLATE_CHANGE:"MAKEFIREND_TEMPLATE_CHANGE",HUYA_AD_PLAY:"HUYA_AD_PLAY",ENTER_P2P_AFTER_REGISTER_GOURP:"ENTER_P2P_AFTER_REGISTER_GOURP",SHOW_OPEN_SUPER_FANS:"SHOW_OPEN_SUPER_FANS",HUYA_REPORT:"HUYA_REPORT",SET_SUPERFANS_CARD_COUNT:"SET_SUPERFANS_CARD_COUNT",META_DATA_UPDATE:"META_DATA_UPDATE",STOP_SIGNAL_P2P:"STOP_SIGNAL_P2P",TAF_SIGNAL_READY:"TAF_SIGNAL_READY",WEBSOCKET_CONNECTED:"WEBSOCKET_CONNECTED",OPEN_ACTIVITY_PANNEL:"OPEN_ACTIVITY_PANNEL",CLEAR_VIDEO_REPORT:"CLEAR_VIDEO_REPORT",SET_MEETING_STAT:"setMeetingStat",VR_MODEL_CHANGE:"VR_MODEL_CHANGE",GET_LIVING_INFO:"GET_LIVING_INFO",GET_VR_STREAM_ERR:"GET_VR_STREAM_ERR",HIDE_NO_VR_TIPS:"HIDE_NO_VR_TIPS",SHOW_ACCOMPANY_PANEL:"SHOW_ACCOMPANY_PANEL",HIDE_BITRATE_MENU:"HIDE_BITRATE_MENU",GET_MOUNTS_LIST_COMPLETE:"GET_MOUNTS_LIST_COMPLETE",MATCH_REPLAY_MODE_CHANGE:"MATCH_REPLAY_MODE_CHANGE",NEED_UPDATE_M3U8:"NEED_UPDATE_M3U8",PLAYBACK_UPDATE:"PLAYBACK_UPDATE",MATCHREPLAY_BACK_LIVE:"MATCHREPLAY_BACK_LIVE",PLAYBACK_M3U8_UPDATED:"PLAYBACK_M3U8_UPDATED",PLAYBACK_DIF_CDN:"PLAYBACK_DIF_CDN",CHANGE_OTHER_LINE:"CHANGE_OTHER_LINE",BITRATE_AUTO_CHANGE:"BITRATE_AUTO_CHANGE",ABTEST_INITED:"ABTEST_INITED",SET_LIVEROOM_REATURES:"SET_LIVEROOM_REATURES",HY_ACTION:"HY_ACTION",HY_ACTION_APP:"HY_ACTION_APP",HY_ACTION_NEW:"HY_ACTION_NEW",SHIELD_DANMU_AREA:"SHIELD_DANMU_AREA",IS_IN_LOW_VOLUME:"IS_IN_LOW_VOLUME",ACTIVE_SHOW_CTRL:"ACTIVE_SHOW_CTRL",SET_MAKEFRIEND_VIDEO:"SET_MAKEFRIEND_VIDEO",VIDEO_PLAY_STAUS_CHANGE:"VIDEO_PLAY_STAUS_CHANGE",SHOW_SLAP_FACE:"SHOW_SLAP_FACE",GIFT_RESIZE:"GIFT_RESIZE",VIDEO_RESIZE:"VIDEO_RESIZE",POPUP_STATUS_CHANGE:"POPUP_STATUS_CHANGE"};y.Event=P;var v=P,E=0,C=function(t,e){clearTimeout(E),E=setTimeout((function(){0==y.preAdStatus&&(y.vplayer.hideLoading(),t.appendChild(e),v.fireEvent("updateDoubleScreenStatus",1),y.preAdStatus=3)}),5e3)},I=function(){try{if(y.adStatus&&!y.isSecret){var t=A();g.addLog("PreAdFrequencyConfig",t);var e=localStorage.preadShow?JSON.parse(localStorage.preadShow):{showDate:"",failCount:0,success:0,lastShowTime:0},i=(new Date).toLocaleDateString();if(g.addLog("PreAdFrequencyConfig preadShow currentDate",t,e,i),e.showDate!==i)e.showDate=i,e.success=0,e.failCount=0,y.hasPreAd=!0,g.addLog("有前贴片广告"),localStorage.preadShow=JSON.stringify(e);else{var s=parseInt(e.success);if(parseInt(e.failCount)>2)return;if(t){var r=Math.floor(Date.now()/1e3),a=e.lastShowTime,o=r-a;if(f.log("跟上次展示时间比较，如果小于间隔时间，则不展示",r,a,t.interval,o),o<t.interval)return void f.log("时间间隔太小忽略",o,t.interval)}s<(t?t.count:1)&&(g.addLog("有前贴片广告"),y.hasPreAd=!0)}}}catch(t){f.log("setHasPreAd",t)}},A=function(){var t=null;try{var e=(function(){var t=null;try{var e=y.abConfig;e&&e.mpConfig&&e.mpConfig.preAdFrequency&&(t=e.mpConfig.preAdFrequency,t=JSON.parse(t))}catch(e){t=null,f.warn("getPreAbConfig",e)}return t}()||{gidCfgList:[{gameid:"-1",count:"3",interval:"300"}]}).gidCfgList;e&&e.length>0&&e.some((function(e){var i=(e.gameid||"").split(",");if(i.includes("-1")||i.includes(y.gameId.toString())){var s=parseInt(e.count)||1,r=parseInt(e.interval)||60;t={count:s,interval:r}}else;}))}catch(t){f.warn("getPreAdFrequencyConfig",t)}return t},D=0,R=null,O=1,L=!1,M=null,w=null,F=function(){y.splitScreenVideoContainer=document.createElement("div"),y.splitScreenVideoContainer.className="split-screen-video-container",y.splitScreenVideoContainer.innerHTML='<div id="video-pixelate-box2" class="video-pixelate-box"></div>';var t=document.createElement("div");t.id="video-pixelate-box1",t.className="video-pixelate-box",document.getElementById("player-video").appendChild(t);var e=y.splitScreenVideoContainer.querySelector("#video-pixelate-box2");f.log("initScreenVideoContainer",t,e),w&&"function"==typeof w.setDoubleScreenPixelateBox&&w.setDoubleScreenPixelateBox(t,e)};y.initScreenVideoContainer=F;var b=function(t){1==y.doubleScreenStatus&&null==y.splitScreenVideoContainer&&F();var e={};if(R&&1==t){var i=y.splitScreenVideoContainer.querySelector("#split-screen-video");i&&i.remove();var s=R.canvas;y.splitScreenVideoContainer.appendChild(s),s.id="split-screen-video",e={video:y.splitScreenVideoContainer,width:R.width,height:R.height}}e.open=t,f.log("openDoubleScreen",e),g.addLog("openDoubleScreen",e),D!=t&&(g.addLog("trigger openDoubleScreen",e),L?y.vplayer.trigger("openDoubleScreen",e):M=e),D=t},V=function(t,e){R=t,w=e},N=function(){y.doubleScreenStatus&&R&&O?b(1):y.splitScreenVideoContainer&&b(0)};function B(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function k(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function U(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var x=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vplayer=e,this.h5player=null,this.video=null,this.canvas=null,this.container=document.querySelector("#player-video"),this.lastGetTime=0,this.isFirstPlay=!0,this.isFirstVideo=!0,this.cacheMetric2=[],this.isMeetPlaying=!1,this.OBTranslateDuration=.5,this.row_ob=4,this.column_ob=4,this.width_ob=1280,this.height_ob=720,this.x_ob=y.obConfig.x||.41,this.y_ob=y.obConfig.y||.31,this.scale_ob=y.obConfig.scale||.23,this.scaleMax_ob=y.obConfig.scaleMax||1,this.scaleMin_ob=y.obConfig.scaleMin||.15,this.renderMode_ob=y.obConfig.renderMode||1,this.vrViewWidth=0,this.vrViewHeight=0,this.isLoginMedia=!1,this.vrPort=null,this.vrZoomMin=.55,this.vrZoomMax=1.45,this.isDebug=y.isDebug(),this.curViewMode=0,this.needPlayAgain=!1,this.curVideoWidth=0,this.curVideoHeight=0,I(),this.initH5Player()}var e,s,r;return e=t,(s=[{key:"initH5Player",value:function(){var t=this;if(!H5Player.isSupported())return console.log("H5Player not support."),v.fireEvent("playerError"),void setTimeout((function(){v.fireEvent(v.SHOW_COMMON_TOAST_TOP,"当前浏览器不支持播放视频，请更换浏览器或者升级浏览器版本")}),2e3);var e=new H5Player;this.h5player=e,y.h5player=e,e.setIDs(y.presenterUid,y.topsid,y.subsid,y.yyuid),e.on(H5Player.Events.VIDEO_PLAY,this.onPlayVideo.bind(this)),e.on(H5Player.Events.FLV_URL_UNAVAILABLE,(function(e,i){return t.playAgain(e,i)})),e.on(H5Player.Events.H5_PLAYER_ERROR,(function(e,i){return t.playAgain(e,i)})),e.on(H5Player.Events.PLAY_STATUS,this.onPlayStatus.bind(this)),e.on(H5Player.Events.NO_DATA_RECEIVED,(function(e,i){return t.playAgain(e,i)})),e.on(H5Player.Events.DATA_METRIC2,this.onDataMetric2.bind(this)),e.on(H5Player.Events.P2P_TIMEOUT,this.onP2pTimeOut.bind(this)),e.on(H5Player.Events.FLAC_AUDIO_NEED_RETRY,this.reStartFlac.bind(this)),e.on(H5Player.Events.TRANS_END,this.onObTransEnd.bind(this)),e.on(H5Player.Events.P2P_PLAYING_EVENT,this.onP2PPlaying.bind(this)),e.on(H5Player.Events.BROWSER_PAUSE,this.onBrowerPause.bind(this)),e.on(H5Player.Events.BROWSER_AUTOPLAY_FAIL,this.onBrowerAutoFail.bind(this)),e.on(H5Player.Events.AUTO_BITRATE_CHANGED,this.onAutoBitrateChange.bind(this)),e.on(H5Player.Events.VIDEO_BAD_QUALITY,(function(e){return t.onVideoBadQuality(e)})),e.on(H5Player.Events.VIDEO_RESOLUTION_CHANGE,(function(e,i){return t.onVideoResolutionChange(e,i)})),e.on(H5Player.Events.SEI_DATACHANNEL_INFO,(function(e,i){return t.onSetDataChannelInfo(e,i)}));var i=parseInt(localStorage.sdkLogLevel);isNaN(i)||e.setLogLevel(i),e.setConfig("jitBufLen",4e3),e.setExtendConfig(y.sdkExtendConfig),e.setConfig("isProduce",this.isDebug?0:1),e.setConfig("playerdata",function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?B(i,!0).forEach((function(e){k(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):B(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},y.ENV)),y.isWebrtcSupport=e.isWebrtcSupport,c.isFunction(H5Player.isSupportedHevc)&&(y.isSupportedHevc=H5Player.isSupportedHevc(0)),f.log("是否支持webrtc",y.isWebrtcSupport),f.log("是否支持HEVC",y.isSupportedHevc),v.addEvent(v.PAUSE_VIDEO,this.pauseVideo.bind(this)),v.addEvent(v.WEBSOCKET_INITED,this.onWebsocketInited.bind(this)),v.addEvent(v.ENTER_PIP,this.enterPip.bind(this)),v.addEvent(v.EXT_PLAYVIDEO,this.extPlayVideo.bind(this)),v.addEvent(v.EXT_RESUMELIVE,this.extResumeLive.bind(this)),v.addEvent(v.SET_MEETING_STAT,this.setMeetingStat.bind(this)),v.addEvent(v.GET_FLAC_TOKEN,(function(){return t.playFlac()})),v.addEvent("videoPip",(function(){return t.enterPip()})),g.addLog("openDoubleScreen addEvent roomJsReady"),v.addEvent("roomJsReady",(function(){L=!0,g.addLog("openDoubleScreen roomJsReady"),M&&(y.vplayer.trigger("openDoubleScreen",M),M=null)})),v.addEvent("updateDoubleScreenStatus",(function(t){g.log("updateDoubleScreenStatus",t),O=t,N()})),localStorage._showH5Player&&(window.h5SdkPlayer=e)}},{key:"setTafHandler",value:function(t){this.h5player&&this.h5player.setTafHandler&&this.h5player.setTafHandler(t)}},{key:"getCurrentTime",value:function(){return this.h5player?this.h5player.getCurrentTime():0}},{key:"play",value:function(){if(1!=y.paymentStatus)if(y.extVideoPlay)this.startExtVideoPlay();else if(y.isMakeFriend&&(this.isMeetPlaying||this.makeFriendPlay()),!y.isMakeFriend||y.hasMFVideo||y.useCdnAll){this.isFirstPlay&&(this.isFirstPlay=!1,window.h5VideoRequest&&window.h5VideoRequest());var t=this.h5player,e=y.streamInfo;if(t)if(e){var i=-1!=y.p2pLineClose.indexOf(y.videoLine.toString());t.setConfig(100,e&&e.iIsP2PSupport>0&&e.sP2pUrl),t.setConfig(101,!i&&y.useP2p);var s=y.getCurBitRate(),r=y.hasAutoBitrate&&y.isAutoBitrate;r&&y.autoCurBitrate>=0&&(s=y.autoCurBitrate==y.SrcBitRate?0:y.autoCurBitrate);var a=0==s?0:1,o=e.mpExtArgs||{};o=o.value?o.value:o;var n={uid:y.isLogin?y.yyuid:y.anonymousUid,sGuid:y.getGuid(),sid:y.topsid,subSid:y.subsid,presenterUid:y.presenterUid,lineType:y.videoLine,roomId:y.ENV.profileRoom,sStreamName:e.sStreamName,h5Root:y.H5ROOT,liveType:1,gameId:y.gameId,mpExtArgs:o};1==y.gzipExp&&(n.gzip=y.gzip),y.hasMFVideo||y.hasVirtualPk||!y.useCdnAll||(n.isPureAudio=y.useCdnAll),n.appid=this.isDebug&&!y.ENV.online?y.vAppidTest:y.vAppid,n.originalBitrate=a,n.curBitrate=0==s?y.SrcBitRate:s,n.iBitRate=s,n.memoryBitrate=y.bitRateInCookie,n.recommendBitRate=y.iWebDefaultBitRate,n.maxAutoBitrate=y.iWebDefaultBitRate,n.bitrateList=this.getBitrateList(),n.pullStreamFrom=y.pullStreamFrom,n.srcBitRate=y.SrcBitRate,n.sShieldStream=y.sShieldStream,n.isStartShield=y.isStartShield,n.commentorIdList=y.commentorIdList,n.businessType="HUYA",n.adBlock=y.adBlock,n.autoMutedPlay=!0,n.mMiscInfo=y.mMiscInfo;var h=y.getBitRateData();if(h){var d=h.iCodecType,l=h.iHEVCBitRate,c=h.iCompatibleFlag,u=h.iFrameRate,p=h.sDisplayName;n.iCodecType=d,n.iHEVCBitRate=l,n.iCompatibleFlag=c,n.iFrameRate=u,n.sDisplayName=p;var m=y.isFakeHDR(c);y.fakeHDRBitrate=m?t.getFakeHdrBitrate(y.presenterUid,s,u):0}f.log("低延迟标志信息:"),f.log("isWebrtcSupport",t.isWebrtcSupport),this.curViewMode=0,y.videoCodec="h264";var _=e.sCdnType||e.sCdnName,S=y.isHuyaLine(_);if(1==y.matchReplayStatus)n.type=H5Player.PLAYBACK,n.isLive=!1,n.liveType=2,n.seekTime=y.matchReplaySeekTime,n.url=y.matchReplayUrl,n.cndName=y.matchReplayCdnName,n.vStreamInfo=y.matchReplayStream,t.start(n);else if(y.isOBWatch&&1==y.obStatus)n.type=H5Player.OBS,n.gridWidth=this.width_ob,n.gridHeight=this.height_ob,n.column=this.column_ob,n.row=this.row_ob,n.x=this.x_ob,n.y=this.y_ob,n.scale=this.scale_ob,n.scaleMax=this.scaleMax_ob,n.scaleMin=this.scaleMin_ob,n.renderMode=this.renderMode_ob,n.sFlvUrl=e.sFlvUrl,n.sFlvUrl=n.sFlvUrl.replace("http:","https:"),n.sFlvUrlSuffix=e.sFlvUrlSuffix,n.sFlvAntiCode=e.sFlvAntiCode,n.container=document.querySelector("#player-video"),y.videoDns&&e.vFlvIPList&&(n.domainList=e.vFlvIPList.value.concat()),t.start(n);else if(y.onlyLine4||t.isWebrtcSupport&&S)n.type=H5Player.HUYAWEBRTC,t.start(n),this.curViewMode=1;else if(y.hlsLivePid)n.isLive=!0,n.type=H5Player.HLS,n.sHlsUrl=e.sHlsUrl,n.sHlsAntiCode=e.sHlsAntiCode,n.sHlsAntiCode=e.sHlsAntiCode.replace(/&amp;/g,"&"),n.sHlsUrlSuffix=e.sHlsUrlSuffix,t.start(n);else{if(n.sFlvUrl=e.sFlvUrl,n.sFlvAntiCode=e.sFlvAntiCode,n.sFlvUrlSuffix=e.sFlvUrlSuffix,n.sP2pUrl=e.sP2pUrl,n.sP2pAntiCode=e.sP2pAntiCode.replace(/&amp;/g,"&"),n.sP2pUrlSuffix=e.sP2pUrlSuffix,n.iIsP2PSupport=e.iIsP2PSupport,n.iIsHEVCSupport=e.iIsHEVCSupport,n.type=H5Player.P2PFLV,n.useMultiVideo=!0,y.isOBWatch&&(2==y.obStatus||3==y.obStatus)){var T=e.sStreamName+"-objs";n.sStreamName=T}y.matchTeamAudioPlay&&y.matchTeamVideoStreamName&&(n.sStreamName=y.matchTeamVideoStreamName,n.team_port="s2"),n.isAuto=r,n.hasAutoBitrate=y.hasAutoBitrate,y.isLowLatency&&(n.latencyLevel=1),y.videoDns&&(n.p2pDomainList=e.vP2pIPList.value.concat()),y.videoDns&&e.vFlvIPList&&(n.domainList=e.vFlvIPList.value.concat()),y.is360Video&&(n.type=H5Player.VR,n.vr={type:y.getVRType(),viewWidth:this.container.offsetWidth,viewHeight:this.container.offsetHeight,zoomMin:this.vrZoomMin,zoomMax:this.vrZoomMax}),t.start(n)}y.currentPlayStreamName=n.sStreamName,y.lastIsAuto=n.isAuto,g.addLog("===start",n),y.isOpenFlac&&this.playFlac(),y.pullStreamFrom=0}else f.log("G.streamInfo 异常",e);else f.log("h5player实例不存在",t)}}},{key:"getSdkTestConfig",value:function(){var t="";return this.h5player.getSdkTestConfig&&(t=this.h5player.getSdkTestConfig()),f.log("sdkCommonAb",y.sdkCommonAb),t}},{key:"makeFriendPlay",value:function(){this.isMeetPlaying=!0,this.setDefaultVolume(),this.h5player.startLiveMeeting(y.presenterUid,y.topsid,y.subsid,y.yyuid,y.H5ROOT),this.makeFriendDeal()}},{key:"isP2PCooling",value:function(){var t=Number(localStorage.getItem("interval_long_time"));return t>0&&(!((new Date).getTime()-t>36e5)||(localStorage.removeItem("interval_long_time"),!1))}},{key:"getBitrateList",value:function(){var t=[],e=[];y.livingInfo?y.livingInfo.tNotice?e=y.livingInfo.tNotice.vMultiStreamInfo.value:y.livingInfo.vStreamGearInfo&&(e=y.livingInfo.vStreamGearInfo.value):e=y.ENV.stream.vMultiStreamInfo;for(var i=0,s=e.length;i<s;i++){var r=e[i],a=r.iBitRate,o={iBitRate:a,iCodecType:r.iCodecType,iHEVCBitRate:r.iHEVCBitRate,iIsHEVCSupport:y.streamInfo.iIsHEVCSupport||0};o.bitrate=0==a?y.SrcBitRate:a,t.push(o)}return t}},{key:"getP2pInfoList",value:function(){var t=[],e=[];y.livingInfo?y.livingInfo.tNotice?e=y.livingInfo.tNotice.vStreamInfo.value:y.livingInfo.vMediaStreamInfo&&(e=y.livingInfo.vMediaStreamInfo.value):e=y.ENV.stream.data[0].gameStreamInfoList;for(var i=0;i<e.length;i++){var s=e[i],r=s.iLineIndex,a=-1!=y.p2pLineClose.indexOf(r.toString());if(s.iIsP2PSupport>0&&s.sP2pUrl&&!a){var o=new Object;o.sP2pUrl=s.sP2pUrl,o.sP2pUrlSuffix=s.sP2pUrlSuffix,o.iLineIndex=r,t.push(o)}}return t}},{key:"reStartFlac",value:function(){var t=Date.now();if(t-this.lastGetTime<2e3)return!1;this.lastGetTime=t,y.isOpenFlac&&(this.h5player.stopFlac(),this.playFlac())}},{key:"playFlac",value:function(){var t=y.streamInfo,e={uid:y.isLogin?y.yyuid:y.anonymousUid,presenterUid:y.presenterUid,roomId:y.ENV.profileRoom,sStreamName:t.sStreamName,h5Root:y.H5ROOT,sFlvUrl:t.sFlvUrl,sFlvAntiCode:t.sFlvAntiCode,sFlvUrlSuffix:t.sFlvUrlSuffix,sP2pUrl:t.sP2pUrl,sP2pAntiCode:t.sP2pAntiCode.replace(/&amp;/g,"&"),sP2pUrlSuffix:t.sP2pUrlSuffix,iIsP2PSupport:t.iIsP2PSupport};this.h5player.startFlac(e)}},{key:"stopFlac",value:function(){this.h5player.stopFlac()}},{key:"playAgain",value:function(t,e){g.addLog("===playAgain",t,e),y.isPlaying=!1,y.hasVideo?(!y.isMakeFriend||y.hasMFVideo||y.useCdnAll)&&(y.tafInited?v.fireEvent(v.PLAY_AGAIN):this.needPlayAgain=!0,y.pullStreamFrom=3):this.stop()}},{key:"stop",value:function(){y.isMakeFriend&&this.h5player&&(this.h5player.stopLiveMeeting(),this.isMeetPlaying=!1),V(null,this.h5player),this.h5player&&this.h5player.stop(),this.resize()}},{key:"setMosaicBox",value:function(t){this.h5player.setMosaicBox(t)}},{key:"onPlayVideo",value:function(t,e){g.addLog(t,e),e.video&&(e.video.autoplay=!0);var s,r=this.video;r&&r.pause&&(r.pause(),r.removeEventListener("enterpictureinpicture",this.onEnterPIP.bind(this)),r.removeEventListener("leavepictureinpicture",this.onLeavePIP.bind(this)),r.src="",y.isPip&&document.exitPictureInPicture()),r=e.video,s=e.canvas,this.video=r,this.canvas=s,this.canvas1=e.canvas1,this.canvas2=e.canvas2,y.isCanvasRender=!!this.canvas,this.curVideoWidth=e.width||0,this.curVideoHeight=e.height||0,this.video&&(this.video.addEventListener("enterpictureinpicture",this.onEnterPIP.bind(this)),this.video.addEventListener("leavepictureinpicture",this.onLeavePIP.bind(this))),this.addExtVideoEvent();var a=document.querySelector("#hy-video");a&&a.remove();var o=y.hasPreAd&&3!=y.preAdStatus;o||this.vplayer.hideLoading();var n=s||r;if(y.doubleScreenStatus=this.canvas1&&this.canvas2?1:0,y.doubleScreenStatus&&(n=this.canvas1.canvas),n.id="hy-video",V(this.canvas2?this.canvas2:null,this.h5player),y.isMakeFriend?v.fireEvent(v.SET_MAKEFRIEND_VIDEO,n):(o?(g.addLog("onPlayVideo showSmallVideo"),function(t,e){var s=i("otlt")();document.querySelector("#pre-ab-video").innerHTML=s,(t=document.querySelector("#pre-ab-video-container")).appendChild(e),C(t,e)}(this.container,n)):(g.addLog("onPlayVideo appendChild"),this.container.appendChild(n),N()),y.isOBRoom&&this.vplayer.trigger("perspectiveChange",y.obCurrentPerspective),y.is360Video&&(this.vrPort&&this.setViewport(this.vrPort),y.vplayerUI&&y.vplayerUI.showPlayTip("vr-live"),v.fireEvent(v.SHOW_VR_UI)),this.resize()),y.isPause=!1,y.isPlaying=!0,v.fireEvent(v.NEW_VIDEO),this.isFirstVideo){this.isFirstVideo=!1,y.isFirstVideoPlay=!0;var h=e.connectTime,d=e.recvDataTime;y.videoTimeData={connectTime:h,recvDataTime:d},v.fireEvent("videoOnLoad");var l=Date.now()-y.beginTime;y.firstVideoTime=l,v.fireEvent(v.VIDEO_FIRST_PLAY),y.mute=c.getQueryString("mute"),y.mute||o||y.browerPause?this.h5player.setVolume(0):this.setDefaultVolume()}y.isPip&&(y.isPip=!1,setTimeout(this.enterPip.bind(this),1e3)),y.huyaLineList.length>0&&1==this.curViewMode&&v.fireEvent(v.SHOW_COMMON_TOAST,"低延迟观看"),e.videoCodec&&(y.videoCodec=e.videoCodec),this.vplayer.setVideoState(1==y.matchReplayStatus?1007:1e3)}},{key:"setDefaultVolume",value:function(){var t=c.getCookie("SoundValue");t=parseFloat(t),isNaN(t)&&(t=.5),t=Math.min(t,1),t=Math.max(t,0),this.h5player.setVolume(t)}},{key:"makeFriendDeal",value:function(){if(y.isPause=!1,y.isPlaying=!0,this.isFirstVideo){this.isFirstVideo=!1,y.isFirstVideoPlay=!0,v.fireEvent("videoOnLoad");var t=Date.now()-y.beginTime;y.firstVideoTime=t,v.fireEvent(v.VIDEO_FIRST_PLAY)}else y.hasMFVideo||y.useCdnAll||this.vplayer.hideLoading()}},{key:"onPlayStatus",value:function(t,e){var i=e.status;"VIDEO_STOP"==i?y.isPlaying=!1:"VIDEO_PLAYING"==i&&(y.isPlaying=!0)}},{key:"onDataMetric2",value:function(t,e){y.tafInited?v.fireEvent(v.DATA_METRIC_SDK,e):this.cacheMetric2.push(e)}},{key:"onP2pTimeOut",value:function(t,e){y.turnToFlv=!0}},{key:"onObTransEnd",value:function(t,e){var i=this.h5player.getViewport();this.x_ob=i.x,this.y_ob=i.y,this.scale_ob=i.scale,this.vplayer.trigger("viewportChange",i)}},{key:"onWebsocketInited",value:function(t){this.sendMetric2Cache(),this.needPlayAgain&&(this.playAgain(),this.needPlayAgain=!1)}},{key:"sendMetric2Cache",value:function(){for(var t=0,e=this.cacheMetric2.length;t<e;t++)this.onDataMetric2(H5Player.Events.DATA_METRIC2,this.cacheMetric2[t]);this.cacheMetric2=[]}},{key:"pauseVideo",value:function(){this.video&&this.stop()}},{key:"extPlayVideo",value:function(t){y.extVideoPlay=!0,this.stop(),this.extVideoUrl=t.url;var e=t.startTime;this.playExtVideo(e),document.querySelector(".player-videotype").style.display="none"}},{key:"extResumeLive",value:function(){y.isGodLiePlay||(y.extVideoPlay=!1,this.play(),document.querySelector(".player-videotype").style.display="block",y.extBarrageTags=[])}},{key:"startExtVideoPlay",value:function(){this.playExtVideo(0)}},{key:"extFastBackward",value:function(t){var e=this.h5player.getVideoInfo().currentTime+t.time;this.playExtVideo(e)}},{key:"playExtVideo",value:function(t){this.h5player.setConfig(100,""),this.h5player.setConfig(101,!1);var e={type:H5Player.HLS,url:this.extVideoUrl,isLive:!1,seekTime:t};this.h5player.start(e),y.vplayerUI&&y.vplayerUI.turnPlayButtonOn()}},{key:"setMeetingStat",value:function(t){this.isMeetPlaying&&(y.hasMFVideo||y.useCdnAll||this.h5player.setMeetingStat(t))}},{key:"getExtVideoInfo",value:function(){if(!y.extVideoPlay)return null;var t={},e=this.h5player.getVideoInfo();return t.currentTime=e.currentTime,t.duration=e.duration,t.isPlaying=y.isPlaying,t}},{key:"addExtVideoEvent",value:function(){y.extVideoPlay&&this.video&&(this.video.addEventListener("waiting",this.onVideoEvent.bind(this)),this.video.addEventListener("seeking",this.onVideoEvent.bind(this)),this.video.addEventListener("seeked",this.onVideoEvent.bind(this)),this.video.addEventListener("playing",this.onVideoEvent.bind(this)),this.video.addEventListener("ended",this.onVideoEvent.bind(this)),this.video.addEventListener("canplay",this.onVideoEvent.bind(this)),this.video.addEventListener("loadedmetadata",this.onVideoEvent.bind(this)),this.video.addEventListener("pause",this.onVideoEvent.bind(this)),this.video.addEventListener("play",this.onVideoEvent.bind(this)),this.video.addEventListener("timeupdate",this.onVideoEvent.bind(this)))}},{key:"onVideoEvent",value:function(t){this.vplayer.trigger("extVideoEvent",t.type)}},{key:"onP2PPlaying",value:function(t,e){f.log("onP2PPlaying",t,e),y.isP2pPlayIng=e.isP2pPlayIng}},{key:"onBrowerPause",value:function(t,e){f.log(t,e),y.browerPause=!0,v.fireEvent(v.SHOW_BROWER_PAUSE_TIPS),this.h5player.setVolume(0)}},{key:"onBrowerAutoFail",value:function(t,e){f.log(t,e),y.browerAutoPlayFail=!0,y.isPlaying=!1,v.fireEvent("BROWSER_AUTOPLAY_FAIL")}},{key:"onAutoBitrateChange",value:function(t,e){f.log("onAutoBitrateChange",t,e),e.lastBitrate;var i=e.curBitrate;y.autoCurBitrate=i,v.fireEvent(v.BITRATE_AUTO_CHANGE)}},{key:"onVideoBadQuality",value:function(t){f.log("onVideoBadQuality",t)}},{key:"enterPip",value:function(){if(1==y.doubleScreenStatus){var t=document.querySelector("#hy-video");t&&t.remove()}y.isPip||this.video&&this.video.requestPictureInPicture().catch((function(t){console.log("Video failed to enter Picture-in-Picture mode."),console.log(t.message)}))}},{key:"onEnterPIP",value:function(){y.isPip=!0,v.fireEvent("updateDoubleScreenStatus",0)}},{key:"onLeavePIP",value:function(){var t=this;window.requestAnimationFrame((function(){y.isPip=!1,t.play(),v.fireEvent("updateDoubleScreenStatus",1)}))}},{key:"setViewport",value:function(t){f.log("setViewport",t),t.duration=this.OBTranslateDuration,this.h5player.setViewport&&this.h5player.setViewport(t)}},{key:"getViewport",value:function(){return this.h5player.getViewport?this.h5player.getViewport():-1}},{key:"addViewport",value:function(t){this.h5player.addViewport&&this.h5player.addViewport(t)}},{key:"getFrameData",value:function(){return this.h5player.getFrameData?this.h5player.getFrameData():-1}},{key:"setSplitedOBStream",value:function(t){this.row_ob==t.row&&this.column_ob==t.column&&this.width_ob==t.width&&this.height_ob==t.height||(this.row_ob=t.row,this.column_ob=t.column,this.width_ob=t.width,this.height_ob=t.height,this.playAgain())}},{key:"loginMedia",value:function(t){this.isLoginMedia||(this.h5player.loginMedia(t.token,t.roomid,y.yyuid),this.isLoginMedia=!0)}},{key:"quitMedia",value:function(){this.isLoginMedia=!1,this.h5player.quitMedia()}},{key:"setVRPort",value:function(){y.is360Video&&(this.vrPort=this.h5player.getViewport?this.h5player.getViewport():null)}},{key:"seek",value:function(){1==y.matchReplayStatus&&(f.log("seek",y.matchReplaySeekTime),this.h5player.seek(y.matchReplaySeekTime))}},{key:"setVolume",value:function(t){this.h5player&&this.h5player.setVolume(t)}},{key:"updateLiveVodUrl",value:function(){1==y.matchReplayStatus&&this.h5player.updateLiveVodUrl(y.matchReplayUrl,y.matchReplayCdnName)}},{key:"getViewerLatencyMode",value:function(){return{res:0,msg:"",data:{mode:this.curViewMode}}}},{key:"setViewerLatencyMode",value:function(t){if(1==t.mode){if(this.h5player.isWebrtcSupport){if(0==y.huyaLineList.length)return{res:1,msg:"没有低延迟线路,设置失败"};this.curViewMode=1;var e=y.getHuyaLineInfo();return y.videoLine=e.iLineIndex,y.streamInfo=e,this.play(),{res:0,msg:"设置低延迟成功"}}return{res:2,msg:"当前浏览器不支持webrtc播放"}}return 0==t.mode?y.onlyLine4?{res:1,msg:"只有一条低延迟线路"}:(v.fireEvent(v.CHANGE_OTHER_LINE),{res:0,msg:"设置普通模式成功"}):{res:999,msg:"未开放的模式"}}},{key:"updateAudioPlay",value:function(t){f.log("=== updateAudioPlay",t),this.h5player.updateAudioPlay(t,y.H5ROOT)}},{key:"getVideoSize",value:function(){var t=this.canvas?this.canvas.width:this.video?this.video.videoWidth||this.curVideoWidth:0,e=this.canvas?this.canvas.height:this.video?this.video.videoHeight||this.curVideoHeight:0;return 1==y.doubleScreenStatus&&this.canvas1&&(t=this.canvas1.width,e=this.canvas1.height),{width:t,height:e}}},{key:"onVideoResolutionChange",value:function(t,e){g.log("=== onVideoResolutionChange",t,e),this.resize(e)}},{key:"onSetDataChannelInfo",value:function(t,e){f.log("=== onSetDataChannelInfo",t,e),y.extSeiPortMap[e.port]&&this.vplayer.trigger("setDataChannelInfo",e)}},{key:"videoPlay",value:function(){this.video&&this.video.play()}},{key:"resize",value:function(t){if(!y.isMakeFriend){var e=this.container.offsetWidth,i=this.container.offsetHeight,s=e,r=i;y.is360Video&&y.hasVideo&&y.isPlaying&&(this.vrViewWidth=e,this.vrViewHeight=i,this.h5player.setSize(this.vrViewWidth,this.vrViewHeight));var a=t||this.getVideoSize(),o=a.width,n=a.height,h=0,d=0;0!==o&&0!==n&&y.hasVideo?o/n>e/i?(s=e,d=(i-(r=n*e/o))/2):(r=i,h=(e-(s=o*i/n))/2):(s=0,r=0),y.videoPos={left:h,top:d,right:h,bottom:d},y.videoOffset={left:h,top:d,width:s,height:r},f.log("reszie resize",y.videoOffset),this.h5player&&c.isFunction(this.h5player.containerResize)&&this.h5player.containerResize({width:s,height:r}),this.h5player&&c.isFunction(this.h5player.containerResizeNew)&&this.h5player.containerResizeNew({width:e,height:i}),v.fireEvent(v.VIDEO_RESIZE)}}}])&&U(e.prototype,s),r&&U(e,r),t}(),H=!1,W=[],G="";var Y=!0,q=!1;function K(t){for(var e=0;e<t.length;e++)if(t[e].iBitRate==y.getCurBitRate())return!0;return!1}var j="";function z(t,e){if(t){v.fireEvent(v.HIDE_NO_VR_TIPS);var i=parseInt(t.lLiveCompatibleFlag);y.lLiveCompatibleFlag=i,y.extStreamVR=128==(128&i)||64==(64&i),y.is360Video=1==(1&i)||1024==(1024&i)||y.extStreamVR&&y.vrSwitch,y.SrcBitRate=t.iBitRate;var s=t.vMediaStreamInfo.value,r=t.vStreamGearInfo.value,a=t.iWebDefaultBitRate;if(y.hasVideo=s.length>0,y.hasAutoBitrate=!1,t.sAntiCode=t.sAntiCode.replace(/&amp;/g,"&"),y.huyaLineList=[],y.hasVideo){y.streamInfo=null;var o=[],n=0,h=-1,d=[];y.menuItems=[];for(var l=!1,c=function(e,i){var r=s[e];r.sFlvAntiCode=t.sAntiCode,r.sP2pAntiCode=t.sAntiCode;var a=r.sCdnName,c=y.isHuyaLine(a);if(r.iWebPriorityRate<0||c)return d.push(e),"continue";var u=r.iLineIndex,p=!1;r.iIsP2PSupport>0&&r.sP2pUrl&&(p=!0),y.videoLine==u&&(l=!0);var m,_={text:"直播线路"+u,p2p:p,line:u,func:(m=u,function(){v.fireEvent(v.SWITCH_LINE,m)})};y.menuItems[u]=_,n+=r.iWebPriorityRate,o.push({line:u,rate:r.iWebPriorityRate}),100==r.iWebPriorityRate&&(h=u)},u=0,p=s.length;u<p;u++)c(u);y.menuData[1]=y.menuItems;for(var m=d.length-1;m>=0;m--){var _=d[m];s.splice(_,1)}if(0==s.length)return void(e&&e());if(1==s.length)y.videoLine=s[0].iLineIndex;else if(-1!=h)y.videoLine=h;else if(l&&y.videoLine>0)y.videoLine=y.videoLine;else{y.videoLine=-1;for(var f=0,g=Math.random(),S=0,T=o.length;S<T;S++){var P=o[S];if(g<=(f+=P.rate/n)){y.videoLine=P.line;break}}}if(y.videoLine<0){var E=Math.floor(Math.random()*s.length);y.videoLine=s[E].iLineIndex}if(et(r),y.videoLine>0){tt(a);var C=y.getCurBitRate();y.vplayerUI.setBitRateList({list:y.getBitRateList(),default:C})}if(y.vplayerUI.setLineList(s),y.videoLine>0)for(var I=0,A=s.length;I<A;I++){var D=s[I];D.iLineIndex==y.videoLine&&(y.streamInfo=D,Z(t.sAntiCode))}y.livingInfo=t,y.isUIPause||(y.vplayer.showLoading(),y.vplayer.play()),v.fireEvent(v.UPDATE_BTNS_VISIBLE)}}else e&&e()}function J(){y.isPlaying=!1,y.vplayer.stop(),y.vrNoStream=!0,j="",v.fireEvent(v.GET_VR_STREAM_ERR)}function Q(t){var e="";for(var i in t)y.videoLine==t[i].iLineIndex&&(t[i].iWebPriorityRate<0&&(e+=t[i].iWebPriorityRate),e+=t[i].sCdnType,e+=t[i].sFlvUrl,e+=t[i].iIsP2PSupport);return e}var X=0;function Z(t){var e=y.streamInfo.sStreamName;y.flvTokenList[e]=t,y.streamInfo.sFlvAntiCode=t,clearTimeout(X),X=setTimeout((function(){for(var t in y.flvTokenList)y.flvTokenList[t]=""}),24e4,e)}function tt(t){if(!y.isCheckDefBit){if(y.curBitRate=0,y.isCheckDefBit=!0,!y.isLogin){var e=y.bitRateList1.length;if(e>0)return void(y.curBitRate=y.bitRateList1[e-1].iBitRate)}y.isAutoBitrate=y.h5player&&y.h5player.getUseAuto();var i=c.getCookie("videoBitRate");y.bitRateInCookie=""===i?-1:i,i=parseInt(i)||2147483647,t=y.aBTestDefaultBitrate>0?y.aBTestDefaultBitrate:t||2147483647,y.iWebDefaultBitRate=t;var s=Math.min(i,t),r=!1,a=0;for(a=0;a<y.bitRateList1.length;a++){var o=y.bitRateList1[a].iBitRate,n=o;if(0==n&&(n=y.SrcBitRate),n<=s){y.curBitRate=o,r=!0;break}}if(0==r)for(a=y.bitRateList1.length-1;a>=0;a--){y.curBitRate=y.bitRateList1[a].iBitRate;break}}}function et(t){for(var e=[],i=t,s=function(t){return t.length<=1?-1:y.aBTestShieldBitrate}(i),r=y.playerConfig&&"1"==y.playerConfig.closeHdr,a=0,o=i.length;a<o;a++){var n=i[a],h=n.iBitRate,d=n.iCodecType,l=n.iCompatibleFlag,c=y.isHDR(l),u=y.isFakeHDR(l);if((!c||u)&&!(u&&r||!c&&!u&&y.isSupportedHevc&&h>y.SrcBitRate&&it(i,n))){var p=y.isH265CodecType(d);if(y.isSupportedHevc||0!=h||!p){var m=st(n);s>0&&s==m.iBitRate||e.push(m)}}}y.bitRateList1=e}function it(t,e){var i=e.sDisplayName,s=e.sTagText,r=e.sTagUrl;return t.filter((function(t){return t&&t.sDisplayName===i&&t.sTagText===s&&t.sTagUrl===r})).length>=2}function st(t){return Object.assign({},t)}function rt(t){for(var e=t.domain_list||[],i=[],s=[],r=0,a=e.length;r<a;r++)if(y.videoLine==e[r].line_index){e[r].flv_domain_list&&(i=e[r].flv_domain_list.concat()),e[r].p2p_domain_list&&(s=e[r].p2p_domain_list.concat());break}y.streamInfo.vFlvIPList={value:i},y.streamInfo.vP2pIPList={value:s}}function at(t,e){var i=t.domain_list||[];g.addLog(t.domain_list);for(var s=0,r=i.length;s<r;s++)if(e==i[s].line_index){var a=i[s].line_ratio_web;if(a)return parseInt(a)}return null}var ot={setLiveInfoFromENV:function(t){if(1!=y.isForeign)if(function(t){var e=sessionStorage.roomIdStr,i=e&&e.split(",")||[],s=i.indexOf(t.profileRoom);return-1!=s?t.profileRoom!=i[0]&&(i.splice(s,1),i.unshift(t.profileRoom),sessionStorage.roomIdStr=i.join(","),!0):(i.unshift(t.profileRoom),sessionStorage.roomIdStr=i.join(","),!1)}(t))t.stream=null;else if(1!=y.isSecret)if(t&&t.stream&&t.stream.data&&0!=t.stream.data.length){g.addLog(t.stream),H=!0;var e=[],i=t.stream.data[0];e=i.gameStreamInfoList.concat(),W=e;var s=t.stream.vMultiStreamInfo,r=t.stream.iWebDefaultBitRate;y.iFrameRate=t.stream.iFrameRate||0;var a=i.gameLiveInfo,o=parseInt(a.liveCompatibleFlag);if(y.lLiveCompatibleFlag=o,y.isOBWatch=32==(32&o),y.isOBWatch&&(y.isOBRoom=!0),y.is360Video=1==(1&o)||1024==(1024&o),y.extStreamVR=128==(128&o)||64==(64&o),!y.extStreamVR&&(y.liveid=a.liveId,y.SrcBitRate=a.bitRate,y.isH265=y.isH265CodecType(a.codecType),y.hasVideo=e.length>0,y.mMiscInfo=a.mMiscInfo||{},t.roomInfo&&1==t.roomInfo.isAutoBitrate&&y.isLogin&&y.h5player&&y.h5player.getSupportAuto()&&(y.hasAutoBitrate=!0),y.hasVideo)){y.streamInfo=null;var n=[],h=0,d=-1,l=[];f.log("线路信息（直出）:",e.concat());for(var c=0,u=e.length;c<u;c++){var p=e[c],m=p.iLineIndex,_=p.sCdnType,S=y.isHuyaLine(_);S&&y.isWebrtcSupport&&y.huyaLineList.push(p);var T=at(t,m);null!=T&&(f.log("iWebPriorityRate已赋值:",m,p.iWebPriorityRate,T),p.iWebPriorityRate=T),p.iWebPriorityRate<0||S&&!y.isWebrtcSupport?l.push(c):(h+=p.iWebPriorityRate,n.push({line:m,rate:p.iWebPriorityRate}),100==p.iWebPriorityRate&&(d=m))}for(var P=l.length-1;P>=0;P--){var v=l[P];e.splice(v,1)}if(0==e.length)return;if(1==e.length)y.videoLine=e[0].iLineIndex;else if(-1!=d)y.videoLine=d;else for(var E=0,C=Math.random(),I=0,A=n.length;I<A;I++){var D=n[I];if(C<=(E+=D.rate/h)){y.videoLine=D.line;break}}if(y.videoLine<0&&(y.videoLine=e[Math.floor(Math.random()*e.length)].iLineIndex),4==y.videoLine&&(y.isPlaying=!0,y.loadUI=!0),function(t){for(var e in G="",t){var i=t[e],s=i.iWebPriorityRate,r=i.iLineIndex;-1!=s&&(G+=r+":"+s+";")}}(e),et(s),y.videoLine>0&&tt(r),y.videoLine>0)for(var R=0,O=e.length;R<O;R++){var L=e[R];if(L.iLineIndex==y.videoLine){y.streamInfo=L,rt(t);var M=L.newCFlvAntiCode||L.sFlvAntiCode;M=M.replace(/&amp;/g,"&"),L.newCFlvAntiCode=M,Z(L.newCFlvAntiCode)}}}}else f.warn("setLiveInfoFromENV NO stream!");else t.stream=null;else t.stream=null},setLivingInfo:function t(e){var i=y.ENV,s=!1;if(y.noLineInLive=!1,Y){Y=!1,window.infoRequestEnd&&infoRequestEnd();var r=Date.now();y.livingInfoTime=r-y.livingInfoTime,H&&0==(s=function(t){var e=y.ENV;if(!e.stream||!e.stream.data||0==e.stream.data.length)return!1;var i=t.tNotice.vStreamInfo.value,s=e.stream.data[0].gameStreamInfoList,r=Q(i),a=Q(s);if(""==a||r!=a)return!1;if(t.tStreamSettingNotice.iBitRate!=e.stream.data[0].gameLiveInfo.bitRate)return!1;return!0}(e))&&v.fireEvent(v.DATA_METRIC2,[{type:"web.live_info_diff",value:1}])}else s=function(t){if(y.livingInfoRecorded){var e=t.tNotice.vStreamInfo.value,i=0,s=y.livingInfoRecorded.tNotice.vMultiStreamInfo.value,r=t.tNotice.vMultiStreamInfo.value;if(y.livingInfoRecorded.tNotice.iSourceType!=t.tNotice.iSourceType)return!1;if(y.livingInfoRecorded.tNotice.lLiveCompatibleFlag!=t.tNotice.lLiveCompatibleFlag)return!1;if(s.length!=r.length)return!1;if(y.streamInfo&&e.length>0)for(i=0;i<e.length;i++){if(e[i].sStreamName!=y.streamInfo.sStreamName&&e[i].iLineIndex==y.streamInfo.iLineIndex)return y.streamSetFlag=!0,!1;if(e[i].iIsP2PSupport!=y.streamInfo.iIsP2PSupport&&e[i].iLineIndex==y.streamInfo.iLineIndex)return y.streamSetFlag=!0,!1}var a=y.getCurBitRate();if(a=0==a?y.SrcBitRate:a,y.livingInfoRecorded.tStreamSettingNotice.iBitRate==a)return y.curBitRate=0,!0;if(t.tNotice.vMultiStreamInfo.value.length>0&&K(s=t.tNotice.vMultiStreamInfo.value))return!0}return!1}(e);!function(t){var e="",i=t.tNotice.vStreamInfo.value;for(var s in i)-1!=i[s].iWebPriorityRate&&(e+=i[s].iLineIndex+":"+i[s].iWebPriorityRate+";");g.addLog("compareLinePriorityRateChange"+G+"变更为："+e),f.log("compareLinePriorityRateChange",G,"变更为：",e),G&&G!=e&&y.vplayer.trigger("line_priority");G=e}(e),f.log("isSame",s),g.addLog("getLivingInfoRsp");var a=e.tNotice,o=a.vStreamInfo.value;y.liveid=a.lLiveId;var n=e.bIsLiving;i.online||y.presenterUid==i.eu||(o=[]),y.hasVideo=o.length>0,y.SrcBitRate=e.tStreamSettingNotice.iBitRate,y.hasAutoBitrate=1==a.iEnableAutoBitRate&&y.isLogin&&y.h5player&&y.h5player.getSupportAuto(),y.isH265=y.isH265CodecType(a.iCodecType);var h=parseInt(a.lLiveCompatibleFlag);y.lLiveCompatibleFlag=h,y.isOBWatch=32==(32&h),y.isOBWatch&&(y.isOBRoom=!0),y.extStreamVR=128==(128&h)||64==(64&h),y.is360Video=1==(1&h)||1024==(1024&h)||y.extStreamVR&&y.vrSwitch,y.livingInfo=e,y.iFrameRate=e.tStreamSettingNotice.iFrameRate,y.mMiscInfo=a.mMiscInfo.value||{};var d=!1;if(y.hasVideo&&y.isMakeFriend&&n&&!y.isPlaying?(y.vplayer.makeFriendPlay(),d=!0):y.hasVideo||((n||e.bcode<0||905==e.bcode)&&y.streamInfo&&!t.hasIgnored?(t.hasIgnored=!0,o=W,y.hasVideo=!0):y.isMakeFriend?y.isMakeFriend&&!n&&(v.fireEvent(v.SHOW_RECOMMEND),y.vplayer.hideLoading(),y.isPlaying=!1,y.vplayer.stop()):(n?(y.vplayer.showLoading(),y.noLineInLive=!0,v.fireEvent(v.HIDE_BITRATE_MENU)):(v.fireEvent(v.SHOW_RECOMMEND),y.vplayer.hideLoading()),y.isPlaying=!1,y.vplayer.stop())),y.onlyLine4=!1,y.huyaLineList=[],f.log("线路信息:",o.concat()),y.hasVideo){y.streamInfo=null;var l=[],c=0,u=-1,p=!1,m=[],_=[];y.menuItems=[];for(var S=function(t,e){var i=o[t],s=i.sCdnType,r=y.isHuyaLine(s);if(r&&y.isWebrtcSupport&&y.huyaLineList.push(i),i.iWebPriorityRate<0||r&&!y.isWebrtcSupport)return m.push(t),"continue";var a=i.iLineIndex;y.videoLine==a&&(p=!0);var n=!1;i.iIsP2PSupport>0&&i.sP2pUrl&&(n=!0);var h,d={text:"直播线路"+a,p2p:n,line:a,func:(h=a,function(){v.fireEvent(v.SWITCH_LINE,h)})};if(y.menuItems[a]=d,p)return"continue";c+=i.iWebPriorityRate,l.push({line:a,rate:i.iWebPriorityRate}),100==i.iWebPriorityRate&&(u=a)},T=0,P=o.length;T<P;T++)S(T);y.menuData[1]=y.menuItems;for(var E=m.length-1;E>=0;E--){var C=m[E];_.push(o[C].iLineIndex),o.splice(C,1)}if(y.huyaLineList.length>0&&0==o.length){y.onlyLine4=!0;var I=y.getHuyaLineInfo();y.videoLine=I.iLineIndex,y.streamInfo=I}else{if(0==o.length&&!y.isMakeFriend)return n?(y.vplayer.showLoading(),y.noLineInLive=!0,v.fireEvent(v.HIDE_BITRATE_MENU)):(v.fireEvent(v.SHOW_RECOMMEND),y.vplayer.hideLoading()),y.hasVideo=!1,y.isPlaying=!1,y.vplayer.stop(),v.fireEvent(v.VIDEO_FIRST_PLAY),void y.vplayer.setVideoState(1003);v.fireEvent(v.HIDE_RECOMMEND)}if(!p)if(1==o.length)y.videoLine=o[0].iLineIndex;else if(-1!=u)y.videoLine=u;else{y.videoLine=-1;for(var A=0,D=Math.random(),R=0,O=l.length;R<O;R++){var L=l[R];if(D<=(A+=L.rate/c)){y.videoLine=L.line;break}}}if((y.videoLine<0||-1!=_.indexOf(y.videoLine))&&(y.videoLine=o[Math.floor(Math.random()*o.length)].iLineIndex),-1==y.specialGameId.indexOf(parseInt(i.gameId))&&(y.isCheckDefBit=!1),y.videoLine>0){var M=a.vMultiStreamInfo.value;if(M.length>0){et(M);var w=K(M);0!=s&&w&&!y.extStreamVR||tt(y.livingInfo.tNotice.iWebDefaultBitRate)}var F=y.getCurBitRate();y.vplayerUI.setBitRateList({list:y.getBitRateList(),default:F})}if(y.vplayerUI.setLineList(o),y.videoLine>0)for(var b=0,V=o.length;b<V;b++){var N=o[b];N.iLineIndex==y.videoLine&&(y.streamInfo=N,Z(N.sFlvAntiCode))}if(d)return;if(i.stream&&i.stream.data&&i.stream.data[0].gameLiveInfo){var B=i.stream.data[0].gameLiveInfo.liveCompatibleFlag,k=parseInt(a.lLiveCompatibleFlag);y.is360Video&&B!=k&&y.vplayer.play()}y.isUIPause||(y.isPlaying&&p?0!=y.videoLine&&(-1!=y.specialGameId.indexOf(parseInt(i.gameId))?s||y.vplayer.play():y.streamSetFlag&&(y.streamSetFlag=!1,s||y.vplayer.play())):y.vplayer.play())}else console.warn("[getLivingInfo]此频道当前无直播！"),v.fireEvent(v.VIDEO_FIRST_PLAY),y.vplayer.setVideoState(1001),!q&&n&&(q=!0,v.fireEvent(v.DATA_METRIC2,[{type:"web.no_video_line",value:1}]));v.fireEvent(v.UPDATE_BTNS_VISIBLE),y.livingInfoRecorded=e},setStreamInfoByRoom:function(t,e){var i=null,s=t.mMediaStreamInfoPack,r=["vr180","vr360"],a=parseInt(y.lLiveCompatibleFlag),o=64==(64&a)?r[0]:r[1];if(e&&""!=j){var n=!1;for(var h in s.value)if(h==j){i=d,n=!0;break}if(!n)return}else for(var h in s.value){var d=s.value[h];if(-1!=d.sStreamBusiProperty.indexOf(o)&&a==d.lLiveCompatibleFlag){j=h,i=d;break}}y.vrNoStream=!1,z(i,J)},setStreamInfoByStreamName:function(t){f.log("setStreamInfoByStreamName:",t),z(t,(function(){v.fireEvent(v.SHOW_RECOMMEND)}))},setFlvToken:Z},nt=0,ht=!1;function dt(){document.querySelector(".player-loading-changeline").display="none"}function lt(){y.noLineInLive?ct("#player-loading-text").innerText="当前直播间暂无可用线路，请稍后再试":function(){if(clearTimeout(nt),!y.livingInfo||!y.livingInfo.tNotice&&!y.livingInfo.vMediaStreamInfo)return;var t=0;y.livingInfo.tNotice?t=y.livingInfo.tNotice.vStreamInfo.value.length:y.livingInfo.vMediaStreamInfo&&(t=y.livingInfo.vMediaStreamInfo.value.length);if(t<2)return;document.querySelector(".player-loading-changeline").style.display="block",v.fireEvent(v.HUYA_REPORT,"pageview/zhibo/breakdown"),y.vplayer.setVideoState(1002)}()}function ct(t){return document.querySelector(t)}var ut,pt={showLoading:function(){if(!ht){var t="url("+y.H5ROOT+"src/img/output/videoloading.gif?"+Math.random()+") no-repeat";ct("#player-loading-progress").style.backgroundImage=t,ct("#player-loading-text").innerText="正在加载",ct("#player-loading").style.display="block",dt(),v.fireEvent(v.HIDE_NO_VR_TIPS),ht=!0,y.isReplay||(clearTimeout(nt),nt=setTimeout(lt,5e3),y.vplayer.setVideoState(1006))}},hideLoading:function(){ht=!1,ct("#player-loading").style.display="none",dt(),clearTimeout(nt)}};function mt(){return $("#player-ext-wrap")}function _t(){return $("#player-ext-wrap-under-barrage")}function ft(){return $("#player-video")}function gt(){var t=null;return ut.vcore&&(t=ut.vcore.getExtVideoInfo()),t}function St(t){ut.vcore&&ut.vcore.extFastBackward(t)}function yt(t){ut.vcore&&ut.vcore.extFastBackward({time:-t.time})}function Tt(){return ut.vcore?ut.vcore.getViewport():-1}function Pt(t){return ut.vcore?(ut.vcore.setViewport(t),0):-1}function vt(t){return ut.vcore?(ut.vcore.addViewport(t),0):-1}function Et(){return ut.vcore?ut.vcore.getFrameData():-1}function Ct(){return y.VideoState}function It(t){y.VideoState=t,ut.trigger("videoStateChange",{state:y.VideoState})}function At(){return y.videoPos}function Dt(t){return ut.vcore?(ut.vcore.setSplitedOBStream(t),0):-1}function Rt(){return this.vcore.getViewerLatencyMode()}function Ot(t){return this.vcore.setViewerLatencyMode(t)}function Lt(t){return this.vcore.updateAudioPlay(t),{res:0,msg:"成功",data:{}}}function Mt(){return ut.vcore.getVideoSize()}function wt(t,e){(function(t,e){var i=Ft.length;if(0==i)return!1;for(var s=[],r=0;r<i;r++){var a=Ft[r],o=a.value,n=a.callBack;o==t&&(n(e),s.push(r),f.log("callByJs callBack:",t,e))}for(var h=s.length,d=h-1;d>=0;d--)Ft.splice(s[d],1);return h>0})(t,e)||(1==y.uiIsInited?v.fireEvent(t,e):y.calljsCache.push({key:t,data:e}))}var Ft=[];function bt(t,e){for(var i=y.calljsCache.length,s=0;s<i;s++){var r=y.calljsCache[s],a=r.key,o=r.data;if(a==t)return void e(o)}Ft.push({value:t,callBack:e})}var Vt={initAPI:function(){(ut=y.vplayer).getExtPopupContainer=mt,ut.getExtContainerUnderBarrage=_t,ut.getVideoContainer=ft,ut.callByJs=wt,ut.getCallJsDataByKey=bt,ut.getVideoInfo=gt,ut.fastForward=St,ut.fastBackward=yt,ut.getViewport=Tt,ut.setViewport=Pt,ut.addViewport=vt,ut.getFrameData=Et,ut.setSplitedOBStream=Dt,ut.getVideoState=Ct,ut.getVideoPosition=At,ut.setVideoState=It,ut.getViewerLatencyMode=Rt,ut.setViewerLatencyMode=Ot,ut.updateAudioPlay=Lt,ut.getVideoSize=Mt}};function Nt(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i("f08Q");var Bt=function(){function t(e){var s=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f.warn("vplayer ".concat(2509100944," | ").concat("2025-09-10 09:44:38")),f.log("location",location.href,e),this.G=y;var r=e;y.ENV=this.ENV=r;var a=i("bfxC")();document.querySelector(r.idDom).innerHTML=a,y.vplayer=this,y.ENV.register(this),Vt.initAPI(),r.gameId=c.getQueryString("gameId")||r.gameId,r.online=c.getQueryString("online")||localStorage.online,r.isSimple=c.getQueryString("isSimple")||r.isSimple;var o=c.getQueryString("pid"),n=c.getQueryString("sourcetype")||r.iSourceType,h=c.getQueryString("from"),d=c.getQueryString("isReplay"),l=c.getQueryString("isSecret"),u=3==r.iSourceType?10506:u;y.topsid=Number(r.chTopId),y.subsid=Number(r.subChId),y.appid=Number(u||r.vappid),y.from=h||"",y.isReplay=d||r.replay,y.gameId=Number(r.gameId),y.roomId=Number(r.profileRoom),y.isFromApp=2==Number(n),y.isYanzhi=2168==y.gameId,y.isPeiWan=4079==y.gameId||3205==y.gameId,y.isMobileStarShow=11==Number(n),y.presenterUid=Number(o||r.eu),y.isPresenter=y.isVideoMaster(),y.freezeLevel=Number(r.freezeLevel),y.isMakeFriend=10==Number(n),y.isParty=7785==y.gameId||200071==y.gameId,y.isCFMiNi=window.IS_UNION,y.isForeign=r.isForeign||!1,y.isSecret=(1==l||1==r.isSecret)&&!r.isPayRoom,y.adStatus=r.adStatus||0,y.setConfigData(),y.setPlayerConfig(),y.setABTestConfig(),f.log("频道信息: ",y.topsid+"_"+y.subsid);var p=parseInt(localStorage.closep2p);if(isNaN(p)||(y.useP2p=!1),y.isReplay||(this.vcore=new x(this),ot.setLiveInfoFromENV(r),y.isMakeFriend?this.makeFriendPlay():this.play()),this.isUILoaded=!1,this.vplayerUI=null,y.loadUI||y.isMakeFriend||!y.streamInfo)this.checkLoadVplayerUI();else{var m=function t(){clearTimeout(s.loadtime),v.removeEvent(v.VIDEO_FIRST_PLAY,t),s.checkLoadVplayerUI()};v.addEvent(v.VIDEO_FIRST_PLAY,m),this.loadtime=setTimeout((function(){v.removeEvent(v.VIDEO_FIRST_PLAY,m),s.checkLoadVplayerUI()}),1e3)}}var e,s,r;return e=t,(s=[{key:"play",value:function(){f.log("VPlayer.play"),(y.streamInfo||y.livingInfo)&&this.vcore&&this.vcore.play()}},{key:"makeFriendPlay",value:function(){this.vcore&&this.vcore.makeFriendPlay()}},{key:"stop",value:function(){f.log("VPlayer.stop"),this.vcore&&this.vcore.stop()}},{key:"playFlac",value:function(){this.vcore.playFlac()}},{key:"stopFlac",value:function(){this.vcore.stopFlac()}},{key:"checkLoadVplayerUI",value:function(){var t=this;c.hasJQuery()?this.loadVPlayerUI():this.getCallJsDataByKey("jqReady",(function(){return t.loadVPlayerUI()}))}},{key:"loadVPlayerUI",value:function(){var t=this;if(!this.isUILoaded){this.isUILoaded=!0;var e=Date.now();$.ajax({url:"https://cdn.jsdelivr.net/gh/donwinn/win/JS/playerUI.js",dataType:"script",cache:!0,success:function(){var i=Date.now();f.log("vplayerUI loaded in "+(i-e)+"ms");try{y.vplayerUI=t.vplayerUI=new VPlayerUI(t,2509100944)}catch(t){f.error("vplayerUI init error",t)}}.bind(this)})}}},{key:"setLivingInfo",value:function(t){f.log("VPlayer.setLivingInfo"),ot.setLivingInfo(t)}},{key:"setStreamInfoByRoom",value:function(t,e){ot.setStreamInfoByRoom(t,e)}},{key:"setStreamInfoByStreamName",value:function(t){ot.setStreamInfoByStreamName(t)}},{key:"setFlvToken",value:function(t){ot.setFlvToken(t)}},{key:"switchBitrate",value:function(t){f.log("VPlayer.switchBitrate",t),t=Number(t),y.curBitRate=t}},{key:"getVolume",value:function(){return this.vcore.h5player.getVolume()}},{key:"setVolume",value:function(t){this.vcore&&this.vcore.h5player&&this.vcore.setVolume(t)}},{key:"setConfig",value:function(t,e){this.vcore.h5player.setConfig(t,e)}},{key:"setTafHandler",value:function(t){this.vcore&&this.vcore.setTafHandler(t)}},{key:"getSDKLog",value:function(){return this.vcore.h5player.getLog()}},{key:"getMetrics",value:function(){return this.vcore.h5player.getMetrics()}},{key:"getCurrentTime",value:function(){return this.vcore.getCurrentTime()}},{key:"getCurrentSeiDts",value:function(){return this.vcore.h5player.getCurrentSeiDts()}},{key:"showLoading",value:function(){pt.showLoading()}},{key:"hideLoading",value:function(){pt.hideLoading()}},{key:"videoPlay",value:function(){this.vcore&&this.vcore.videoPlay()}},{key:"resize",value:function(){this.vcore&&this.vcore.resize()}},{key:"checkLogin",value:function(t){y.isLogin!=t&&(y.isLogin=t,y.isLogin||y.resetLoginStatus())}},{key:"loginMedia",value:function(t){this.vcore.loginMedia(t)}},{key:"quitMedia",value:function(){this.vcore.quitMedia()}},{key:"setVRPort",value:function(){this.vcore&&this.vcore.setVRPort()}},{key:"seek",value:function(){this.vcore&&this.vcore.seek()}},{key:"updateLiveVodUrl",value:function(){this.vcore&&this.vcore.updateLiveVodUrl()}},{key:"userId",get:function(){return y.userId}},{key:"videoStreamType",get:function(){return y.isReplay?2:y.isP2pPlayIng?1:0}},{key:"videoData",get:function(){if(!y.streamInfo)return null;var t={},e=y.getCurBitRate();t.video_p2p=y.isP2pPlayIng?1:0,t.video_encode="h264",t.video_bitrate=e||y.SrcBitRate,t.video_line=y.streamInfo.sCdnType,t.line=y.videoLine+"";for(var i=y.getBitRateList(),s=0;s<i.length;s++)i[s].iBitRate==e&&(t.video_definition=i[s].sDisplayName);return t}},{key:"videoTime",get:function(){return y.videoTimeData?y.videoTimeData:null}},{key:"videoStatus",get:function(){return y.isPlaying&&!y.isPause?0:!y.isPlaying&&y.isPause?1:2}},{key:"hasVideo",get:function(){return y.hasVideoPlay()}},{key:"getGiftData",get:function(){return y.extPropData}}])&&Nt(e.prototype,s),r&&Nt(e,r),t}();e.default=Bt;n.mixTo(Bt),window.VPlayer=Bt}});